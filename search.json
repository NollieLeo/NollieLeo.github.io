[{"title":"diffç®—æ³•åŸç†å’Œæ€»ç»“","path":"/2023/01/28/diffç®—æ³•åŸç†å’Œæ€»ç»“/","content":"è¿™é‡Œä¸¾ä¾‹é‡‡ç”¨ vue çš„æ¡†æ¶è®¾è®¡è¿›è¡Œè§£é‡Š diff diff ç®—æ³•çš„æ ¸å¿ƒå…¶å®æ˜¯éƒ½æ˜¯åªå…³å¿ƒæ–°æ—§çš„è™šæ‹ŸèŠ‚ç‚¹éƒ½å­˜åœ¨ä¸€ç»„å­èŠ‚ç‚¹çš„æƒ…å†µã€‚ç›®çš„éƒ½æ˜¯è¾¾åˆ°å‡å°‘æ€§èƒ½çš„å¼€é”€ï¼Œå…¶ä¸­æœ‰æ¯”è¾ƒç›´è§‚çš„å°±æ˜¯â€“å‡å°‘ dom èŠ‚ç‚¹çš„æ“ä½œ åœ¨Vue3 æ¸²æŸ“å™¨è®¾è®¡ä¸æ€»ç»“ä¸­ å½“æ¶‰åŠåˆ°ä¸¤ç»„å­èŠ‚ç‚¹çš„æ›´æ–°çš„æ—¶å€™ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯å…¨é‡å¸è½½å¹¶ä¸”é‡æ–°æŒ‚è½½çš„å½¢å¼å»è¿›è¡Œå­èŠ‚ç‚¹çš„æ›´æ–°çš„ï¼Œè¿™æ ·æ˜¯éå¸¸ä¸åˆç†ã€‚ å¦‚æœåªä» â€œæŒ‚è½½â€å’Œâ€œå¸è½½â€çš„ä¸¤ä¸ªç®€å•è§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å®ç°ä¸€ä¸ªå‡å°‘ dom å¼€é”€çš„æ›´æ–°é€»è¾‘ï¼Œå¦‚ä¸‹å‡ å›¾æ‰€ç¤º æƒ…å†µä¸€ï¼šæ•°é‡ç›¸åŒçš„æƒ…å†µ æƒ…å†µäºŒï¼šæ—§èŠ‚ç‚¹å¤šäºæ–°èŠ‚ç‚¹ æƒ…å†µä¸‰ï¼šæ—§èŠ‚ç‚¹å°‘äºæ–°èŠ‚ç‚¹ ç»¼ä¸Šï¼šæ•°é‡ç›¸åŒçš„èŠ‚ç‚¹æˆ‘ä»¬å…ˆè¿›è¡Œ patch ä»è€Œè¿›è¡Œæ›´æ–°æ“ä½œï¼Œå¸è½½å’ŒæŒ‚è½½ä»å‰©ä½™çš„èŠ‚ç‚¹å‡ºå‘åšå¤„ç†ã€‚ å› æ­¤æˆ‘ä»¬å¯ä»¥æ”¹é€  patchChildren çš„å‡½æ•°ç®€å•å®ç°è¿™å¥—é€»è¾‘ 1234567891011121314151617181920212223242526272829303132/** æ›´æ–°children */function pacthChildren(n1, n2, container) &#123; // åˆ¤æ–­æ–°å­èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦æ˜¯æ–‡æœ¬èŠ‚ç‚¹ if (typeof n2.children === &quot;string&quot;) &#123; // ... &#125; else if (Array.isArray(n2.children)) &#123; const oldChildren = n1.children; const newChildren = n2.children; /** æ—§èŠ‚ç‚¹é•¿åº¦ */ const oldL = oldChildren.length; /** æ–°èŠ‚ç‚¹é•¿åº¦ */ const newL = newChildren.length; // æ¯”è¾ƒä¸¤è€…é•¿åº¦ï¼Œå–æœ€çŸ­çš„ï¼Œç„¶åè¿›è¡Œpacthæ“ä½œ const minL = Math.min(oldL, newL); // éå†ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†è¾¾åˆ°å‡å°‘domçš„æ“ä½œ for (let i = 0; i &lt; minL; i++) &#123; patch(oldChildren[i], newChildren[i]); &#125; // å¦‚æœæœ‰æ–°å¢èŠ‚ç‚¹ï¼ŒåŠnewL &gt; oldL, è¯´æ˜æœ‰èŠ‚ç‚¹è¦è¿›è¡ŒæŒ‚è½½ if (newL &gt; oldL) &#123; for (let i = minL; i &lt; newL; i++) &#123; patch(null, newChildren[i], container); &#125; &#125; else if (oldL &gt; newL) &#123; for (let i = minL; i &lt; oldL; i++) &#123; unmount(oldChildren[i]); &#125; &#125; &#125; else &#123; // ... &#125;&#125; ä½†æ˜¯è¿™ç§æ–¹å¼ä»ç„¶ä¸æ˜¯æœ€ä¼˜çš„è§£æ³•ï¼Œå½“æˆ‘ä»¬è€ƒè™‘ä»¥ä¸‹è¿™ç§æƒ…å†µã€‚ 12345678910111213// æ—§èŠ‚ç‚¹ï¼š[ &#123;type:&#x27;p&#x27;&#125;, &#123;type:&#x27;span&#x27;&#125;, &#123;type:&#x27;div&#x27;&#125;]// æ–°èŠ‚ç‚¹[ &#123;type:&#x27;div&#x27;&#125;, &#123;type:&#x27;p&#x27;&#125;, &#123;type:&#x27;span&#x27;&#125;,] ä»–ä»¬åªæ˜¯ç®€å•çš„è¿›è¡Œäº†ä½ç½®çš„ç§»åŠ¨ï¼Œå´è¦è¿›è¡Œ 3 æ¬¡çš„å¸è½½å’Œ 3 æ¬¡çš„æŒ‚è½½ dom çš„æ“ä½œã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ä» dom çš„å¤ç”¨è§’åº¦å‡ºå‘ï¼Œä»è€Œå¼•å‡º diff ç®—æ³•å®ç°æ›´ä¼˜è§£ ç®€å• diff ç®—æ³•è¦æƒ³çŸ¥é“å‰åçš„èŠ‚ç‚¹è¿›è¡Œäº†ç§»åŠ¨ä»è€Œå»å¤ç”¨ï¼Œå¿…é¡»è¦æœ‰æ ‡è¯†ï¼Œåœ¨ react å’Œ vue ä¸­éƒ½æ˜¯é‡‡ç”¨ key çš„å½¢å¼å»ç»™è™šæ‹Ÿ dom åšæ ‡è¯†çš„ï¼› 1234567891011121314151617[ &#123; &quot;type&quot;: &quot;p&quot;, &quot;key&quot;: &quot;123&quot;, &quot;children&quot;: &quot;123&quot; &#125;, &#123; &quot;type&quot;: &quot;span&quot;, &quot;key&quot;: &quot;234&quot;, &quot;children&quot;: &quot;234&quot; &#125;, &#123; &quot;type&quot;: &quot;div&quot;, &quot;key&quot;: &quot;345&quot;, &quot;children&quot;: &quot;345&quot; &#125;] æ‰“è¡¥ä¸åœ¨æˆ‘ä»¬æœ‰äº†æ ‡è¯†äº†å°±å¯ä»¥çŸ¥é“å‰åèŠ‚ç‚¹å¯¹åº”çš„ä½ç½®ï¼Œä½†æ˜¯ key å€¼çš„å‰åä¸å˜ï¼Œä¸ä»£è¡¨èŠ‚ç‚¹ä¸éœ€è¦æ›´æ–°ï¼Œå› ä¸ºå‰åçš„ children æˆ–è€…ç›¸å…³çš„å±æ€§ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œå¦‚ä¸‹ 123456789101112131415161718/** æ—§ */const oldVNode = &#123; type: &quot;div&quot;, children: [ &#123; type: &quot;p&quot;, children: &quot;1&quot;, key: &quot;1&quot; &#125;, &#123; type: &quot;p&quot;, children: &quot;2&quot;, key: &quot;2&quot; &#125;, &#123; type: &quot;p&quot;, children: &quot;weng&quot;, key: &quot;3&quot; &#125;, ],&#125;;/** æ–° */const newVNode = &#123; type: &quot;div&quot;, children: [ &#123; type: &quot;p&quot;, children: &quot;kaimin&quot;, key: &quot;3&quot; &#125;, &#123; type: &quot;p&quot;, children: &quot;1&quot;, key: &quot;1&quot; &#125;, &#123; type: &quot;p&quot;, children: &quot;2&quot;, key: &quot;2&quot; &#125;, ],&#125;; å› æ­¤æˆ‘ä»¬ä»æ–°çš„èŠ‚ç‚¹ä¸­æ‰¾åˆ°å¯¹åº” key å€¼çš„æ—§èŠ‚ç‚¹ä»è€Œå…ˆè¿›è¡Œæ‰“è¡¥ä¸çš„ä¸€ä¸ªæ“ä½œ 12345678910111213141516171819202122232425/** æ›´æ–°children */function pacthChildren(n1, n2, container) &#123; // åˆ¤æ–­æ–°å­èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦æ˜¯æ–‡æœ¬èŠ‚ç‚¹ if (typeof n2.children === &quot;string&quot;) &#123; // ... &#125; else if (Array.isArray(n2.children)) &#123; const oldChildren = n1.children; const newChildren = n2.children; // éå†æ–°children for (let i = 0; i &lt; newChildren.length; i++) &#123; const newVNode = array[i]; for (let j = 0; j &lt; oldChildren.length; j++) &#123; const oldVNode = array[j]; // å¦‚æœæ‰¾åˆ°äº†å‰åæƒ³ç­‰keyçš„vnodeï¼Œé‚£ä¹ˆå…ˆè¿›è¡Œæ‰“è¡¥ä¸æ“ä½œ if (newVNode.key === oldVNode.key) &#123; patch(oldVNode, newVNode, container); break; // æ‰¾åˆ°äº†ç›´æ¥é€€å‡ºå¾ªç¯ &#125; &#125; &#125; &#125; else &#123; // ... &#125;&#125; æ‰“å®Œè¡¥ä¸ä¹‹åï¼Œå‰åèŠ‚ç‚¹çš„é¡ºåºä»ç„¶æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è¿›è¡Œç§»åŠ¨å¯å¤ç”¨èŠ‚ç‚¹ æ‰¾åˆ°å¯ç§»åŠ¨çš„å…ƒç´ åˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦éœ€è¦ç§»åŠ¨ï¼Œåˆ™å°±æ˜¯åˆ¤æ–­æ›´æ–°å‰åçš„èŠ‚ç‚¹é¡ºåºæœ‰æ— å‘ç”Ÿå˜åŒ– å‰åèŠ‚ç‚¹çš„ key å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¯¹åº”çš„ç´¢å¼•æ›´æ–°åä¹Ÿæ˜¯ 0ï¼Œ1ï¼Œ2 å’Œæ—§ children çš„ç´¢å¼•ä¿æŒä¸€ä¸ªä¸€ä¸ªé€’å¢çš„çŠ¶æ€ï¼Œå› æ­¤è¿™ç§æƒ…å†µæ˜¯ä¸éœ€è¦èŠ‚ç‚¹ç§»åŠ¨çš„ p-[key] å¦‚æœèŠ‚ç‚¹å‰åé¡ºåºæ”¹å˜äº† æ›´æ–°åï¼ŒèŠ‚ç‚¹çš„ç´¢å¼•ä¸ºï¼Œ2ï¼Œ0ï¼Œ1ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œæ­¤æ¬¡æ›´æ–°æ‰“ç ´äº†åŸæœ‰çš„ç´¢å¼•é€’å¢è§„åˆ™ï¼ŒåŸå§‹èŠ‚ç‚¹ç´¢å¼•ä¸º 0 å’Œ 1 çš„èŠ‚ç‚¹éœ€è¦è¿›è¡Œç§»åŠ¨ï¼Œä¸”çœŸå®çš„ dom å…ƒç´ éœ€è¦ç§»åŠ¨åˆ° p-3 dom èŠ‚ç‚¹çš„åå¤´ å…¶å®å¯ä»¥å°† p-3 åœ¨æ—§ children ä¸­å¯¹åº”çš„ç´¢å¼•å®šä¹‰ä¸ºï¼šåœ¨æ—§ children ä¸­å¯»æ‰¾ç›¸åŒ key å€¼èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°çš„æœ€å¤§ç´¢å¼•å€¼ï¼Œå¦‚æœåç»­åœ¨å¯»æ‰¾è¿‡ç¨‹ä¸­å‘ç°èŠ‚ç‚¹ç´¢å¼•å€¼æ¯”è¿™ä¸ªè¿˜è¦å°ï¼Œè¯´æ˜éœ€è¦è¿›è¡Œç§»åŠ¨ å› æ­¤æˆ‘ä»¬æ”¹åŠ¨ä»£ç ï¼Œç”¨ä¸€ä¸ª â€œé‡åˆ°çš„æœ€å¤§ç´¢å¼•â€ â€“ lastIndexæ¥åšæ ‡è®° 1234567891011121314151617181920212223242526272829303132333435/** æ›´æ–°children */function pacthChildren(n1, n2, container) &#123; // åˆ¤æ–­æ–°å­èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦æ˜¯æ–‡æœ¬èŠ‚ç‚¹ if (typeof n2.children === &quot;string&quot;) &#123; // ... &#125; else if (Array.isArray(n2.children)) &#123; const oldChildren = n1.children; const newChildren = n2.children; /** å¯»æ‰¾æ—§æ•°ç»„ç›¸åŒkeyå€¼èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°çš„æœ€å¤§ç´¢å¼• */ let lastIndex = 0; // â• // éå†æ–°children for (let i = 0; i &lt; newChildren.length; i++) &#123; const newVNode = array[i]; for (let j = 0; j &lt; oldChildren.length; j++) &#123; const oldVNode = array[j]; // å¦‚æœæ‰¾åˆ°äº†å‰åæƒ³ç­‰keyçš„vnodeï¼Œé‚£ä¹ˆå…ˆè¿›è¡Œæ‰“è¡¥ä¸æ“ä½œ if (newVNode.key === oldVNode.key) &#123; patch(oldVNode, newVNode, container); if (j &lt; lastIndex) &#123; // â• // è¯´æ˜éœ€è¦ç§»åŠ¨èŠ‚ç‚¹äº† &#125; else &#123; // è¡¨æ˜jæ¯”lastIndexè¿˜å¤§ï¼Œéœ€è¦æ›´æ–° lastIndex = j; // â• &#125; break; // æ‰¾åˆ°äº†ç›´æ¥é€€å‡ºå¾ªç¯ &#125; &#125; &#125; &#125; else &#123; // ... &#125;&#125; ç°åœ¨å°±æ‰¾åˆ°äº†éœ€è¦ç§»åŠ¨çš„èŠ‚ç‚¹ï¼Œåªè¦è¿™ä¸ªèŠ‚ç‚¹çš„æ—§èŠ‚ç‚¹çš„ç´¢å¼•ï¼Œå°äº lastIndexï¼Œåˆ™å°±éœ€è¦ç§»åŠ¨ï¼Œæ¥ä¸‹æ¥è¯´å¦‚ä½•ç§»åŠ¨ä»– ç§»åŠ¨èŠ‚ç‚¹å¦‚ä¸Šçš„ä¾‹å­ï¼Œç§»åŠ¨å®Œ p-1 ä¹‹å vNode å’ŒçœŸå® dom çš„å¯¹åº”å…³ç³»ï¼Œæˆ‘ä»¬çŸ¥é“æ–° children çš„é¡ºåºå…¶å®å°±æ˜¯æ›´æ–°åçš„çœŸå® dom çš„é¡ºåºï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬æŠŠ p-1 ç§»åŠ¨åˆ° p-3 å¯¹åº”çš„çœŸå® dom åé¢ï¼Œp-2 åŒç†ï¼Œp-3 åœ¨è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¿æŒä¸åŠ¨çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æ ¹æ®è¿™ç§æƒ…å†µå¯¹ dom é¡ºåºè¿›è¡Œæ“ä½œ å› æ­¤æˆ‘ä»¬åŠ å…¥ç§»åŠ¨çœŸå® dom çš„ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344/** æ›´æ–°children */function pacthChildren(n1, n2, container) &#123; // åˆ¤æ–­æ–°å­èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦æ˜¯æ–‡æœ¬èŠ‚ç‚¹ if (typeof n2.children === &quot;string&quot;) &#123; // ... &#125; else if (Array.isArray(n2.children)) &#123; const oldChildren = n1.children; const newChildren = n2.children; /** å¯»æ‰¾æ—§æ•°ç»„ç›¸åŒkeyå€¼èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°çš„æœ€å¤§ç´¢å¼• */ let lastIndex = 0; // éå†æ–°children for (let i = 0; i &lt; newChildren.length; i++) &#123; const newVNode = array[i]; for (let j = 0; j &lt; oldChildren.length; j++) &#123; const oldVNode = array[j]; // å¦‚æœæ‰¾åˆ°äº†å‰åæƒ³ç­‰keyçš„vnodeï¼Œé‚£ä¹ˆå…ˆè¿›è¡Œæ‰“è¡¥ä¸æ“ä½œ if (newVNode.key === oldVNode.key) &#123; patch(oldVNode, newVNode, container); if (j &lt; lastIndex) &#123; // è¯´æ˜éœ€è¦ç§»åŠ¨èŠ‚ç‚¹äº† /** å…ˆè·å–newVNodeçš„å‰ä¸€ä¸ªVnode */ const prevVnode = newChildren[i - 1]; // å¦‚æœprevVnodeä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜å½“å‰newVNodeæ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»–ä¸éœ€è¦è¿›è¡Œç§»åŠ¨ if (prevVnode) &#123; // ç”±äºéœ€è¦å°†newVNodeæ‰€å¯¹åº”çš„çœŸå®DOMç§»åˆ°prevVnodeæ‰€å¯¹åº”çš„çœŸå®DOMçš„åé¢ // æ‰€ä»¥éœ€è¦è·å–prevVNodeæ‰€å¯¹åº”çš„çœŸå®DOMçš„ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ï¼Œå°†å…¶ä½œä¸ºé”šç‚¹ const anchor = prevVnode.el.nextSibling; // è°ƒç”¨inseræ–¹æ³•å°†å…¶æ’å…¥åˆ°anchoré”šç‚¹çš„å‰é¢ï¼Œä¹Ÿå°±æ˜¯prevVNodeå¯¹åº”çœŸå®DOMçš„åé¢ insert(newVNode.el, container, anchor); &#125; &#125; else &#123; // è¡¨æ˜jæ¯”lastIndexè¿˜å¤§ï¼Œéœ€è¦æ›´æ–° lastIndex = j; &#125; break; // æ‰¾åˆ°äº†ç›´æ¥é€€å‡ºå¾ªç¯ &#125; &#125; &#125; &#125; else &#123; // ... &#125;&#125; æ·»åŠ æ–°èŠ‚ç‚¹ä»¥ä¸Šè¯´çš„éƒ½æ˜¯å‰åèŠ‚ç‚¹æ•°é‡ç›¸åŒçš„æƒ…å†µï¼Œç°åœ¨è¯´æ–°èŠ‚ç‚¹æ•°å¤§äºæ—§èŠ‚ç‚¹æ•°çš„æƒ…å†µï¼› å‡ºå‘ç‚¹å°±æ˜¯ï¼š æ‰¾åˆ°éœ€è¦æ·»åŠ çš„æ–°èŠ‚ç‚¹ æƒ³åŠæ³•å¼„è¿›å» æ‰¾åˆ°éœ€è¦æ·»åŠ çš„èŠ‚ç‚¹æ‰¾åˆ°éœ€è¦æ·»åŠ çš„èŠ‚ç‚¹ï¼Œè¿™å±‚å¥½ç†è§£ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨å¤–å±‚ï¼ˆnewChildrenï¼‰éå†å»æ‰¾å†…å±‚çš„ï¼ˆoldChildrenï¼‰key ç›¸åŒèŠ‚ç‚¹çš„è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰æ‰¾è§ï¼Œè¯´æ˜è¿™ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªæ–°å¢çš„èŠ‚ç‚¹ã€‚ åœ¨å†…å±‚éå†çš„æ—¶å€™ï¼Œè¿™é‡Œé‡‡ç”¨ä¸€ä¸ªfindçš„å­—æ®µå»è¡¨ç¤ºæ˜¯å¦æ‰¾åˆ°äº†èŠ‚ç‚¹æ˜¯ key ç›¸åŒçš„ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647/** æ›´æ–°children */function pacthChildren(n1, n2, container) &#123; // åˆ¤æ–­æ–°å­èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦æ˜¯æ–‡æœ¬èŠ‚ç‚¹ if (typeof n2.children === &quot;string&quot;) &#123; // ... &#125; else if (Array.isArray(n2.children)) &#123; const oldChildren = n1.children; const newChildren = n2.children; /** å¯»æ‰¾æ—§æ•°ç»„ç›¸åŒkeyå€¼èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°çš„æœ€å¤§ç´¢å¼• */ let lastIndex = 0; /** è¡¨æ˜æ˜¯å¦åœ¨oldChildrenä¸­æ‰¾åˆ°äº†å¯å¤ç”¨èŠ‚ç‚¹ */ let find = false; // â• // éå†æ–°children for (let i = 0; i &lt; newChildren.length; i++) &#123; const newVNode = array[i]; for (let j = 0; j &lt; oldChildren.length; j++) &#123; const oldVNode = array[j]; // å¦‚æœæ‰¾åˆ°äº†å‰åæƒ³ç­‰keyçš„vnodeï¼Œé‚£ä¹ˆå…ˆè¿›è¡Œæ‰“è¡¥ä¸æ“ä½œ if (newVNode.key === oldVNode.key) &#123; // æ‰¾åˆ°äº†å¤ç”¨çš„èŠ‚ç‚¹ï¼Œè®¾ç½®ä¸ºtrue find = true; // â• patch(oldVNode, newVNode, container); if (j &lt; lastIndex) &#123; // è¯´æ˜éœ€è¦ç§»åŠ¨èŠ‚ç‚¹äº† /** å…ˆè·å–newVNodeçš„å‰ä¸€ä¸ªVnode */ const prevVnode = newChildren[i - 1]; // å¦‚æœprevVnodeä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜å½“å‰newVNodeæ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»–ä¸éœ€è¦è¿›è¡Œç§»åŠ¨ if (prevVnode) &#123; // ç”±äºéœ€è¦å°†newVNodeæ‰€å¯¹åº”çš„çœŸå®DOMç§»åˆ°prevVnodeæ‰€å¯¹åº”çš„çœŸå®DOMçš„åé¢ï¼Œæ‰€ä»¥éœ€è¦è·å–prevVNodeæ‰€å¯¹åº”çš„çœŸå®DOMçš„ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ï¼Œå°†å…¶ä½œä¸ºé”šç‚¹ const anchor = prevVnode.el.nextSibling; // è°ƒç”¨inseræ–¹æ³•å°†å…¶æ’å…¥åˆ°anchoré”šç‚¹çš„å‰é¢ï¼Œä¹Ÿå°±æ˜¯prevVNodeå¯¹åº”çœŸå®DOMçš„åé¢ insert(newVNode.el, container, anchor); &#125; &#125; else &#123; // è¡¨æ˜jæ¯”lastIndexè¿˜å¤§ï¼Œéœ€è¦æ›´æ–° lastIndex = j; &#125; break; // æ‰¾åˆ°äº†ç›´æ¥é€€å‡ºå¾ªç¯ &#125; &#125; &#125; &#125; else &#123; // ... &#125;&#125; æ­£ç¡®æ·»åŠ èŠ‚ç‚¹é€šè¿‡ find å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ é€»è¾‘ï¼Œå½“æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„å¤ç”¨èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå°±å¯ä»¥æ‰§è¡Œæ’å…¥ï¼š æ’å…¥çš„èŠ‚ç‚¹å¿…é¡»æ’å…¥åœ¨ newVNode çš„å‰ä¸€ä¸ªèŠ‚ç‚¹çš„åå¤´ï¼Œå› æ­¤éœ€è¦æ‰¾åˆ°å‰é¢ä¸€ä¸ªèŠ‚ç‚¹é”šç‚¹ å¦‚æœæ²¡æœ‰å‰ä¸€ä¸ªèŠ‚ç‚¹çš„æƒ…å†µï¼Œé‚£è¯´æ˜ï¼Œè¿™ä¸ª newVNode æ‰€å¯¹åº”çš„ DOM æ˜¯æ•´ä¸ª dom æ ‘çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ å› æ­¤æ”¹é€ é€»è¾‘ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869/** æ›´æ–°children */function pacthChildren(n1, n2, container) &#123; // åˆ¤æ–­æ–°å­èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦æ˜¯æ–‡æœ¬èŠ‚ç‚¹ if (typeof n2.children === &quot;string&quot;) &#123; // å½“æ–°èŠ‚ç‚¹ä¸ºæ–‡æœ¬èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¦‚æœæ—§èŠ‚ç‚¹æ˜¯ä¸€ç»„å­çš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦é€ä¸ªå»å¸è½½ï¼Œå…¶ä»–æƒ…å†µå•¥ä¹Ÿä¸åš if (Array.isArray(n1.children)) &#123; n1.children.forEach((node) =&gt; unmount(node)); &#125; // æœ€åè®¾ç½®æ–°çš„èŠ‚ç‚¹å†…å®¹ setElementText(container, n2.children); &#125; else if (Array.isArray(n2.children)) &#123; const oldChildren = n1.children; const newChildren = n2.children; /** å¯»æ‰¾æ—§æ•°ç»„ç›¸åŒkeyå€¼èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°çš„æœ€å¤§ç´¢å¼• */ let lastIndex = 0; /** è¡¨æ˜æ˜¯å¦åœ¨oldChildrenä¸­æ‰¾åˆ°äº†å¯å¤ç”¨èŠ‚ç‚¹ */ let find = false; // éå†æ–°children for (let i = 0; i &lt; newChildren.length; i++) &#123; const newVNode = array[i]; for (let j = 0; j &lt; oldChildren.length; j++) &#123; const oldVNode = array[j]; // å¦‚æœæ‰¾åˆ°äº†å‰åæƒ³ç­‰keyçš„vnodeï¼Œé‚£ä¹ˆå…ˆè¿›è¡Œæ‰“è¡¥ä¸æ“ä½œ if (newVNode.key === oldVNode.key) &#123; // æ‰¾åˆ°äº†å¤ç”¨çš„èŠ‚ç‚¹ï¼Œè®¾ç½®ä¸ºtrue find = true; patch(oldVNode, newVNode, container); if (j &lt; lastIndex) &#123; // è¯´æ˜éœ€è¦ç§»åŠ¨èŠ‚ç‚¹äº† /** å…ˆè·å–newVNodeçš„å‰ä¸€ä¸ªVnode */ const prevVnode = newChildren[i - 1]; // å¦‚æœprevVnodeä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜å½“å‰newVNodeæ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»–ä¸éœ€è¦è¿›è¡Œç§»åŠ¨ if (prevVnode) &#123; // ç”±äºéœ€è¦å°†newVNodeæ‰€å¯¹åº”çš„çœŸå®DOMç§»åˆ°prevVnodeæ‰€å¯¹åº”çš„çœŸå®DOMçš„åé¢ï¼Œæ‰€ä»¥éœ€è¦è·å–prevVNodeæ‰€å¯¹åº”çš„çœŸå®DOMçš„ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ï¼Œå°†å…¶ä½œä¸ºé”šç‚¹ const anchor = prevVnode.el.nextSibling; // è°ƒç”¨inseræ–¹æ³•å°†å…¶æ’å…¥åˆ°anchoré”šç‚¹çš„å‰é¢ï¼Œä¹Ÿå°±æ˜¯prevVNodeå¯¹åº”çœŸå®DOMçš„åé¢ insert(newVNode.el, container, anchor); &#125; &#125; else &#123; // è¡¨æ˜jæ¯”lastIndexè¿˜å¤§ï¼Œéœ€è¦æ›´æ–° lastIndex = j; &#125; break; // æ‰¾åˆ°äº†ç›´æ¥é€€å‡ºå¾ªç¯ &#125; &#125; // å¦‚æœèµ°åˆ°è¿™é‡Œfindä»ç„¶ä¸ºfalseï¼Œè¯´æ˜è¿™ä¸ªnewNodeæ˜¯æ–°èŠ‚ç‚¹ï¼ŒoldChildrenä¸­æ²¡æ‰¾åˆ°å¯å¤ç”¨çš„èŠ‚ç‚¹ if (!find) &#123; /** å…ˆè·å–newVNodeçš„å‰ä¸€ä¸ªVnode */ const prevVnode = newChildren[i - 1]; /** é”šç‚¹ */ let anchor = null; if (prevVnode) &#123; // å¦‚æœæœ‰å‰ä¸€ä¸ªvnodeèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±èµ‹å€¼ç»™ä»–çš„ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ anchor = prevVnode.el.nextSibling; &#125; else &#123; // è¯´æ²¡æœ‰å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå½“å‰çš„èŠ‚ç‚¹å°±æ˜¯æ•´ä¸ªå®¹å™¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ anchor = container.firstChild; &#125; // æ‰§è¡Œæ–°èŠ‚ç‚¹çš„æŒ‚è½½æ“ä½œ patch(null, newVNode, container, anchor); &#125; &#125; &#125; else &#123; // ... &#125;&#125; ç§»é™¤èŠ‚ç‚¹å¦‚ä¸‹è®¨è®ºèŠ‚ç‚¹è¢«åˆ é™¤çš„æƒ…å†µ å¦‚å›¾ p-2 èŠ‚ç‚¹åœ¨æ›´æ–°ä¹‹åè¢«åˆ é™¤äº†ï¼ŒæŒ‰ç…§åŸæœ‰æ–°èŠ‚ç‚¹éå†éå†ä¹‹åï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œæ—§çš„æ•°ç»„ä¸­è¿˜æœ‰æ®‹ä½™ï¼Œå› æ­¤è¿˜éœ€è¦å¢åŠ å¤„ç†è€èŠ‚ç‚¹ä¸­è¢«åˆ é™¤çš„èŠ‚ç‚¹å¤„ç†é€»è¾‘ å¯¹äºè€èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¢åŠ å¦‚ä¸‹é€»è¾‘ï¼š éå†è€èŠ‚ç‚¹ï¼Œä»ä¸­æ‰¾åˆ°æ–°èŠ‚ç‚¹ä¸­ä¸å­˜åœ¨çš„èŠ‚ç‚¹ å¸è½½è€èŠ‚ç‚¹ 123456789101112131415161718192021222324252627282930313233/** æ›´æ–°children */function pacthChildren(n1, n2, container) &#123; // åˆ¤æ–­æ–°å­èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦æ˜¯æ–‡æœ¬èŠ‚ç‚¹ if (typeof n2.children === &quot;string&quot;) &#123; //... &#125; else if (Array.isArray(n2.children)) &#123; const oldChildren = n1.children; const newChildren = n2.children; /** å¯»æ‰¾æ—§æ•°ç»„ç›¸åŒkeyå€¼èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°çš„æœ€å¤§ç´¢å¼• */ let lastIndex = 0; /** è¡¨æ˜æ˜¯å¦åœ¨oldChildrenä¸­æ‰¾åˆ°äº†å¯å¤ç”¨èŠ‚ç‚¹ */ let find = false; // éå†æ–°children for (let i = 0; i &lt; newChildren.length; i++) &#123; // ... &#125; // éå†è€children for (let i = 0; i &lt; oldChildren.length; i++) &#123; const oldVNode = oldChildren[i]; // æ‹¿æ—§å­èŠ‚ç‚¹oldVNodeå»æ–°çš„ä¸€ç»„ä¸­å¯»æ‰¾ç›¸åŒkeyå€¼çš„èŠ‚ç‚¹ const has = newChildren.find((vnode) =&gt; vnode.key === oldVNode.key); // å¦‚æœå‘ç°æ–°èŠ‚ç‚¹ä¸­ä¸å­˜åœ¨ï¼Œæ‹©è¦åˆ æ‰ if (!has) &#123; unmount(oldVNode); &#125; &#125; &#125; else &#123; //... &#125;&#125; ç®€å• diff ç®—æ³•å°±åˆ°è¿™é‡Œã€‚ åŒç«¯ diff ç®—æ³• åŒç«¯ diff ç®—æ³•æŒ‡çš„å°±æ˜¯ - åŒæ—¶å¯¹æ–°æ—§ä¸¤ç»„å­èŠ‚ç‚¹çš„ä¸¤ä¸ªç«¯ç‚¹è¿›è¡Œæ¯”è¾ƒçš„ç®—æ³• ç›¸è¾ƒäºç®€å• diff ç®—æ³•ï¼ŒåŒç«¯ diff æœ‰ä¸ªä¼˜åŠ¿ï¼Œé€šè¿‡ 4 ä¸ªæŒ‡é’ˆå»è¿›è¡ŒèŠ‚ç‚¹æ¯”è¾ƒæ‰¾åˆ°å¯å¤ç”¨çš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚æ¶‰åŠåˆ°ç®€å• diff ä¸­çš„ä¸€ä¸ªä¾‹å­ ç®€å• diff è¦è¿›è¡Œ 2 æ¬¡çš„ dom èŠ‚ç‚¹çš„ä½ç½®æ”¹å˜ è€ŒåŒç«¯ diff åœ¨è¿™ç§æƒ…å†µä¸‹åªéœ€è¦ 1 æ¬¡ dom æ“ä½œï¼ˆè¿ç§» p-3 èŠ‚ç‚¹åˆ° p-1 çš„å‰é¢ï¼‰ å››ä¸ªç«¯ç‚¹çš„è¡¨ç¤º ä»¥ä¸‹ä½¿ç”¨ä»£ç è¡¨ç¤ºï¼š 123456789101112131415/** åŒç«¯diffç®—æ³• */function patchKeyedChildren(n1, n2, container) &#123; const oldChildren = n1.children; const newChildren = n2.children; // å››ä¸ªç´¢å¼• let oldStartIdx = 0; let oldEndIdx = oldChildren.length - 1; let newStartIdx = 0; let newEndIdx = newChildren.length - 1; // å››ä¸ªç´¢å¼•å¯¹åº”çš„vNode let oldStartVNode = oldChildren[oldStartIdx]; let oldEndVNode = oldChildren[oldEndIdx]; let newStartVNode = newChildren[newStartIdx]; let newEndVNode = newChildren[newEndIdx];&#125; æ¯”è¾ƒæ–¹å¼ ä¸»è¦åˆ†ä¸º 4 ä¸ªæ­¥éª¤ï¼ŒæŒ‰ç…§å¦‚å›¾ 1ï¼Œ2ï¼Œ3ï¼Œ4 çš„æ­¥éª¤è¿›è¡Œæ¯”è¾ƒ 12345678910111213141516171819202122232425/** åŒç«¯diffç®—æ³• */function patchKeyedChildren(n1, n2, container) &#123; const oldChildren = n1.children; const newChildren = n2.children; // å››ä¸ªç´¢å¼• let oldStartIdx = 0; let oldEndIdx = oldChildren.length - 1; let newStartIdx = 0; let newEndIdx = newChildren.length - 1; // å››ä¸ªç´¢å¼•å¯¹åº”çš„vNode let oldStartVNode = oldChildren[oldStartIdx]; let oldEndVNode = oldChildren[oldEndIdx]; let newStartVNode = newChildren[newStartIdx]; let newEndVNode = newChildren[newEndIdx]; if (oldStartVNode.key === newStartVNode.key) &#123; // ç¬¬ä¸€æ­¥ï¼šæ¯”è¾ƒoldStartVNode å’ŒnewStartVNode &#125; else if (oldEndVNode.key === newEndVNode.key) &#123; // ç¬¬äºŒæ­¥ï¼šæ¯”è¾ƒoldEndVNode å’Œ newEndVNode &#125; else if (oldStartVNode.key === newEndVNode.key) &#123; // ç¬¬ä¸‰æ­¥ï¼šæ¯”è¾ƒoldStartVNodeå’Œ newEndVNode &#125; else if (oldEndVNode.key === newStartVNode.key) &#123; // ç¬¬å››æ­¥ï¼šæ¯”è¾ƒoldEndVNodeå’Œ newStartVNode &#125;&#125; å‡å¦‚ åœ¨æ­¥éª¤ 1 æˆ–è€… 2 ä¸­æ‰¾åˆ°å¯¹åº”å¤ç”¨çš„èŠ‚ç‚¹ï¼Œè¯´æ˜ä»–ä»¬çš„ä½ç½®ç›¸å¯¹è€Œè¨€æ²¡æœ‰æ”¹å˜ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿›è¡Œç§»åŠ¨ï¼Œè¿™æ—¶å€™åªéœ€è¦è¿›è¡ŒèŠ‚ç‚¹çš„æ‰“è¡¥ä¸æ“ä½œå³å¯ï¼Œä¹‹åå°†å¯¹åº”çš„ç´¢å¼•åŒæ—¶ä¸Šç§»æˆ–è€…æ˜¯ä¸‹ç§»ã€‚ 1234567891011121314151617181920212223242526272829303132333435/** åŒç«¯diffç®—æ³• */function patchKeyedChildren(n1, n2, container) &#123; const oldChildren = n1.children; const newChildren = n2.children; // å››ä¸ªç´¢å¼• let oldStartIdx = 0; let oldEndIdx = oldChildren.length - 1; let newStartIdx = 0; let newEndIdx = newChildren.length - 1; // å››ä¸ªç´¢å¼•å¯¹åº”çš„vNode let oldStartVNode = oldChildren[oldStartIdx]; let oldEndVNode = oldChildren[oldEndIdx]; let newStartVNode = newChildren[newStartIdx]; let newEndVNode = newChildren[newEndIdx]; if (oldStartVNode.key === newStartVNode.key) &#123; // ç¬¬ä¸€æ­¥ï¼šæ¯”è¾ƒoldStartVNode å’ŒnewStartVNode // æ‰“è¡¥ä¸ patch(oldStartVNode, newStartVNode, container); // æ›´æ–°ç´¢å¼• oldStartVNode = oldChildren[++oldStartIdx]; newStartVNode = newChildren[++newStartIdx]; &#125; else if (oldEndVNode.key === newEndVNode.key) &#123; // ç¬¬äºŒæ­¥ï¼šæ¯”è¾ƒoldEndVNode å’Œ newEndVNode // æ‰“è¡¥ä¸ patch(oldEndVNode, newEndVNode, container); // æ›´æ–°ç´¢å¼• oldEndVNode = oldChildren[--oldEndIdx]; newEndVNode = newChildren[--newEndIdx]; &#125; else if (oldStartVNode.key === newEndVNode.key) &#123; // ç¬¬ä¸‰æ­¥ï¼šæ¯”è¾ƒoldStartVNodeå’Œ newEndVNode &#125; else if (oldEndVNode.key === newStartVNode.key) &#123; // ç¬¬å››æ­¥ï¼šæ¯”è¾ƒoldEndVNodeå’Œ newStartVNode &#125;&#125; å‡å¦‚æ˜¯æ­¥éª¤ 4 å‘½ä¸­ï¼Œè¯´æ˜åŸæœ¬åœ¨ oldChildren ä¸­æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½†æ˜¯åœ¨æ–°é¡ºåºä¸­ï¼Œå˜æˆäº†ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¯¹åº”åˆ°ä»£ç ä¸­çš„é€»è¾‘å°±æ˜¯ï¼šå°†ç´¢å¼• oldEndIdx æŒ‡å‘çš„çœŸå® dom èŠ‚ç‚¹ï¼Œç§»åŠ¨åˆ°ç´¢å¼• oldStartIdx æŒ‡å‘çš„è™šæ‹ŸèŠ‚ç‚¹æ‰€å¯¹åº”çš„çœŸå® dom å‰é¢ï¼ŒåŒæ—¶æ›´æ–°ç´¢å¼• 123456789101112131415161718192021222324252627282930313233343536373839404142/** åŒç«¯diffç®—æ³• */function patchKeyedChildren(n1, n2, container) &#123; const oldChildren = n1.children; const newChildren = n2.children; // å››ä¸ªç´¢å¼• let oldStartIdx = 0; let oldEndIdx = oldChildren.length - 1; let newStartIdx = 0; let newEndIdx = newChildren.length - 1; // å››ä¸ªç´¢å¼•å¯¹åº”çš„vNode let oldStartVNode = oldChildren[oldStartIdx]; let oldEndVNode = oldChildren[oldEndIdx]; let newStartVNode = newChildren[newStartIdx]; let newEndVNode = newChildren[newEndIdx]; if (oldStartVNode.key === newStartVNode.key) &#123; // ç¬¬ä¸€æ­¥ï¼šæ¯”è¾ƒoldStartVNode å’ŒnewStartVNode // æ‰“è¡¥ä¸ patch(oldStartVNode, newStartVNode, container); // æ›´æ–°ç´¢å¼• oldStartVNode = oldChildren[++oldStartIdx]; newStartVNode = newChildren[++newStartIdx]; &#125; else if (oldEndVNode.key === newEndVNode.key) &#123; // ç¬¬äºŒæ­¥ï¼šæ¯”è¾ƒoldEndVNode å’Œ newEndVNode // æ‰“è¡¥ä¸ patch(oldEndVNode, newEndVNode, container); // æ›´æ–°ç´¢å¼•å’Œå¤´å°¾éƒ¨èŠ‚ç‚¹å˜é‡ oldEndVNode = oldChildren[--oldEndIdx]; newEndVNode = newChildren[--newEndIdx]; &#125; else if (oldStartVNode.key === newEndVNode.key) &#123; // ç¬¬ä¸‰æ­¥ï¼šæ¯”è¾ƒoldStartVNodeå’Œ newEndVNode &#125; else if (oldEndVNode.key === newStartVNode.key) &#123; // ç¬¬å››æ­¥ï¼šæ¯”è¾ƒoldEndVNodeå’Œ newStartVNode // æ‰“è¡¥ä¸ patch(oldEndVNode, newStartVNode, container); // ç§»åŠ¨dom insert(oldEndVNode.el, container, newStartVNode.el); // ç§»åŠ¨å®Œdomä¹‹åï¼Œæ›´æ–°ç´¢å¼• oldEndVNode = oldChildren[--oldEndIdx]; newStartVNode = newChildren[++newStartIdx]; &#125;&#125; å‡å¦‚æ˜¯æ­¥éª¤ 3 å‘½ä¸­ï¼Œè¯´æ˜åŸæœ¬åœ¨ oldChildren ä¸­æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½†æ˜¯åœ¨æ–°é¡ºåºä¸­ï¼Œå˜æˆäº†æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¯¹åº”åˆ°ä»£ç ä¸­çš„é€»è¾‘æ˜¯ï¼šå°†ç´¢å¼• oldStartIdx æŒ‡å‘çš„çœŸå® dom èŠ‚ç‚¹ï¼Œç§»åŠ¨åˆ°ç´¢å¼• oldEndIdx æŒ‡å‘çš„è™šæ‹ŸèŠ‚ç‚¹å¯¹åº”çš„çœŸå® dom çš„åé¢ï¼ŒåŒæ—¶æ›´æ–°ç´¢å¼• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** åŒç«¯diffç®—æ³• */function patchKeyedChildren(n1, n2, container) &#123; const oldChildren = n1.children; const newChildren = n2.children; // å››ä¸ªç´¢å¼• let oldStartIdx = 0; let oldEndIdx = oldChildren.length - 1; let newStartIdx = 0; let newEndIdx = newChildren.length - 1; // å››ä¸ªç´¢å¼•å¯¹åº”çš„vNode let oldStartVNode = oldChildren[oldStartIdx]; let oldEndVNode = oldChildren[oldEndIdx]; let newStartVNode = newChildren[newStartIdx]; let newEndVNode = newChildren[newEndIdx]; if (oldStartVNode.key === newStartVNode.key) &#123; // ç¬¬ä¸€æ­¥ï¼šæ¯”è¾ƒoldStartVNode å’ŒnewStartVNode // æ‰“è¡¥ä¸ patch(oldStartVNode, newStartVNode, container); // æ›´æ–°ç´¢å¼• oldStartVNode = oldChildren[++oldStartIdx]; newStartVNode = newChildren[++newStartIdx]; &#125; else if (oldEndVNode.key === newEndVNode.key) &#123; // ç¬¬äºŒæ­¥ï¼šæ¯”è¾ƒoldEndVNode å’Œ newEndVNode // æ‰“è¡¥ä¸ patch(oldEndVNode, newEndVNode, container); // æ›´æ–°ç´¢å¼•å’Œå¤´å°¾éƒ¨èŠ‚ç‚¹å˜é‡ oldEndVNode = oldChildren[--oldEndIdx]; newEndVNode = newChildren[--newEndIdx]; &#125; else if (oldStartVNode.key === newEndVNode.key) &#123; // ç¬¬ä¸‰æ­¥ï¼šæ¯”è¾ƒoldStartVNodeå’Œ newEndVNode // æ‰“è¡¥ä¸ patch(oldStartVNode, newEndVNode, container); insert(oldStartVNode.el, container, oldEndVNode.el.nextSibling); // æ›´æ–°ä¸‹ä¸€ä¸ªç´¢å¼• oldStartVNode = oldChildren[++oldStartIdx]; newEndVNode = newChildren[--newEndIdx]; &#125; else if (oldEndVNode.key === newStartVNode.key) &#123; // ç¬¬å››æ­¥ï¼šæ¯”è¾ƒoldEndVNodeå’Œ newStartVNode // æ‰“è¡¥ä¸ patch(oldEndVNode, newStartVNode, container); // ç§»åŠ¨dom insert(oldEndVNode.el, container, newStartVNode.el); // ç§»åŠ¨å®Œdomä¹‹åï¼Œæ›´æ–°ç´¢å¼• oldEndVNode = oldChildren[--oldEndIdx]; newStartVNode = newChildren[++newStartIdx]; &#125;&#125; å†å°†æ›´æ–°çš„é€»è¾‘å°è£…åˆ°ä¸€ä¸ª while å¾ªç¯ä¸­ï¼Œç”±äºæ¯ä¸€è½®çš„å¾ªç¯ï¼Œéƒ½ä¼šæ›´æ–°ç›¸å¯¹åº”çš„ç´¢å¼•å€¼ï¼Œæ‰€ä»¥å¾ªç¯çš„æ¡ä»¶ï¼šå¤´éƒ¨çš„ç´¢å¼•å€¼è¦å°äºç­‰äºå°¾éƒ¨ç´¢å¼•å€¼ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** åŒç«¯diffç®—æ³• */function patchKeyedChildren(n1, n2, container) &#123; const oldChildren = n1.children; const newChildren = n2.children; // å››ä¸ªç´¢å¼• let oldStartIdx = 0; let oldEndIdx = oldChildren.length - 1; let newStartIdx = 0; let newEndIdx = newChildren.length - 1; // å››ä¸ªç´¢å¼•å¯¹åº”çš„vNode let oldStartVNode = oldChildren[oldStartIdx]; let oldEndVNode = oldChildren[oldEndIdx]; let newStartVNode = newChildren[newStartIdx]; let newEndVNode = newChildren[newEndIdx]; while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123; if (oldStartVNode.key === newStartVNode.key) &#123; // ç¬¬ä¸€æ­¥ï¼šæ¯”è¾ƒoldStartVNode å’ŒnewStartVNode // æ‰“è¡¥ä¸ patch(oldStartVNode, newStartVNode, container); // æ›´æ–°ç´¢å¼• oldStartVNode = oldChildren[++oldStartIdx]; newStartVNode = newChildren[++newStartIdx]; &#125; else if (oldEndVNode.key === newEndVNode.key) &#123; // ç¬¬äºŒæ­¥ï¼šæ¯”è¾ƒoldEndVNode å’Œ newEndVNode // æ‰“è¡¥ä¸ patch(oldEndVNode, newEndVNode, container); // æ›´æ–°ç´¢å¼•å’Œå¤´å°¾éƒ¨èŠ‚ç‚¹å˜é‡ oldEndVNode = oldChildren[--oldEndIdx]; newEndVNode = newChildren[--newEndIdx]; &#125; else if (oldStartVNode.key === newEndVNode.key) &#123; // ç¬¬ä¸‰æ­¥ï¼šæ¯”è¾ƒoldStartVNodeå’Œ newEndVNode // æ‰“è¡¥ä¸ patch(oldStartVNode, newEndVNode, container); insert(oldStartVNode.el, container, oldEndVNode.el.nextSibling); // æ›´æ–°ä¸‹ä¸€ä¸ªç´¢å¼• oldStartVNode = oldChildren[++oldStartIdx]; newEndVNode = newChildren[--newEndIdx]; &#125; else if (oldEndVNode.key === newStartVNode.key) &#123; // ç¬¬å››æ­¥ï¼šæ¯”è¾ƒoldEndVNodeå’Œ newStartVNode // æ‰“è¡¥ä¸ patch(oldEndVNode, newStartVNode, container); // ç§»åŠ¨dom insert(oldEndVNode.el, container, newStartVNode.el); // ç§»åŠ¨å®Œdomä¹‹åï¼Œæ›´æ–°ç´¢å¼• oldEndVNode = oldChildren[--oldEndIdx]; newStartVNode = newChildren[++newStartIdx]; &#125; &#125;&#125; åŒç«¯ diff çš„ä¼˜åŠ¿æ¯”å¦‚ç®€å• diff ä¸­çš„æ‰€è¯´çš„ä¸€ä¸ªä¾‹å­ åœ¨ç®€å•çš„ diff ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°† p-1 å’Œ p-2 çš„èŠ‚ç‚¹ç§»åŠ¨åˆ° p-3 çš„èŠ‚ç‚¹åé¢ï¼Œè¿›è¡Œä¸¤æ¬¡çš„ dom ç§»åŠ¨æ“ä½œã€‚ åŒç«¯ diff é’ˆå¯¹è¿™ç§æƒ…å†µæµç¨‹å¦‚ä¸‹ï¼š ç¬¬ä¸€è½®å¾ªç¯ 1~3 æ­¥éª¤ï¼šæ¯”è¾ƒï¼Œä¸¤è€… key ä¸åŒï¼Œä¸èƒ½å¤ç”¨ 4 æ­¥éª¤ï¼šæ¯”è¾ƒå‘ç°æ–°çš„å­èŠ‚ç‚¹å¤´éƒ¨èŠ‚ç‚¹å’Œæ—§å­èŠ‚ç‚¹çš„å°¾éƒ¨èŠ‚ç‚¹ key ç›¸åŒï¼Œå› æ­¤æˆ‘ä»¬æ‰§è¡Œç¬¬å››ä¸ª else if æ‰§è¡Œé€»è¾‘ï¼Œæ—§çš„å°¾éƒ¨èŠ‚ç‚¹ç§»åŠ¨åˆ° oldStartVNode å¯¹åº”çš„çœŸå® dom å‰é¢ æ¥ä¸‹æ¥å¼€å§‹æ–°çš„ä¸€è½®å¾ªç¯ 1 æ­¥éª¤ï¼šæ¯”è¾ƒæ–°æ—§å­èŠ‚ç‚¹çš„å¤´éƒ¨èŠ‚ç‚¹ keyï¼Œå‘ç°ç›¸ç­‰ï¼Œéƒ½åœ¨å¤´éƒ¨æ‰€ä»¥åªéœ€è¦æ‰“è¡¥ä¸å³å¯ï¼Œä¸éœ€è¦ç§»åŠ¨ï¼Œå¹¶ä¸”æ›´æ–°ç´¢å¼•å€¼ å†å¼€å§‹æ–°çš„ä¸€è½®å¾ªç¯ 1 æ­¥éª¤ç›´æ¥åŒ¹é…ï¼ŒåŒä¸Šï¼Œåªéœ€è¦æ‰“è¡¥ä¸å’Œæ›´æ–°ç´¢å¼•å€¼å°±å¥½äº†ã€‚åˆ°è¿™ä¸€æ­¥ä¸æ»¡è¶³å¾ªç¯æ¡ä»¶å°±ç›´æ¥è·³å‡ºäº† éç†æƒ³çŠ¶æ€æƒ…å†µè€ƒè™‘ä¸Šé¢çš„å‡ ç§æƒ…å†µéƒ½æ˜¯æ¯”è¾ƒç†æƒ³çš„æƒ…å†µï¼Œåœ¨æ¯ä¸€è½®çš„å¾ªç¯ä¸­ï¼Œéƒ½å¯ä»¥åŒ¹é…åˆ°ç›¸ç­‰çš„ key å€¼ï¼Œä½†æ˜¯éç†æƒ³çš„çŠ¶æ€ä¸‹åªèƒ½é€šè¿‡å¢åŠ é¢å¤–çš„å¤„ç†æ–¹å¼æ¥è¿›è¡Œã€‚ æ¯”å¦‚å¦‚ä¸‹çš„è¿™ç§æƒ…å†µï¼š è¿™ç§æƒ…å†µï¼Œæ— è®ºæ˜¯å“ªä¸€è½®ï¼Œéƒ½ä¸èƒ½åŒ¹é…ä¸Šï¼Œå¦‚æœæˆ‘ä»¬ç”¨ä¹‹å‰çš„ä»£ç ï¼Œå¾ªç¯ç›´æ¥å°±æ­»äº† è¿™é‡Œæœ‰ä¸ªéªšæ“ä½œï¼Œå°±æ˜¯æ‹¿æ–°å­èŠ‚ç‚¹çš„å¤´éƒ¨èŠ‚ç‚¹ï¼Œå»æ—§å­èŠ‚ç‚¹ä¸­å¯»æ‰¾ä¸ä¹‹ç›¸åŒçš„ key çš„èŠ‚ç‚¹ã€‚ åœ¨è¿™é‡Œæˆ‘ä»¬ç”¨ p-2 å»æ‰¾æ—§å­èŠ‚ç‚¹ä¸­çš„åŒ¹é…èŠ‚ç‚¹ï¼Œå‘ç°ä¸‹æ ‡æ˜¯ 1ï¼Œè€Œæ–°çš„ä½ç½®ä¸‹æ ‡æ˜¯ 0ï¼Œæ¯”ä»–å¤§ï¼Œè¯´æ˜ p-2 èŠ‚ç‚¹å¯¹åº”çš„çœŸå® dom åº”è¯¥ç§»åŠ¨åˆ° oldStartVNode å¯¹åº” dom ä½ç½®ä¹‹å‰ï¼Œå› æ­¤æˆ‘ä»¬è¿½åŠ é€»è¾‘ 1234567891011121314151617181920212223242526272829303132333435363738394041424344/** åŒç«¯diffç®—æ³• */function patchKeyedChildren(n1, n2, container) &#123; const oldChildren = n1.children; const newChildren = n2.children; // å››ä¸ªç´¢å¼• let oldStartIdx = 0; let oldEndIdx = oldChildren.length - 1; let newStartIdx = 0; let newEndIdx = newChildren.length - 1; // å››ä¸ªç´¢å¼•å¯¹åº”çš„vNode let oldStartVNode = oldChildren[oldStartIdx]; let oldEndVNode = oldChildren[oldEndIdx]; let newStartVNode = newChildren[newStartIdx]; let newEndVNode = newChildren[newEndIdx]; while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123; if (oldStartVNode.key === newStartVNode.key) &#123; // ... &#125; else if (oldEndVNode.key === newEndVNode.key) &#123; // ... &#125; else if (oldStartVNode.key === newEndVNode.key) &#123; // ... &#125; else if (oldEndVNode.key === newStartVNode.key) &#123; // ... &#125; else &#123; // éå†æ—§çš„å­èŠ‚ç‚¹ç»„ï¼Œæ‰¾åˆ°ä¸newStartIdxæ‹¥æœ‰ç›¸åŒçš„keyå€¼çš„å…ƒç´  const idxInOld = oldChildren.findIndex( (node) =&gt; node.key === newStartVNode.key ); // idxInOldå¤§äº0ï¼Œè¯´æ˜æ‰¾åˆ°äº†å¯å¤ç”¨çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”éœ€è¦å°†å…¶å¯¹åº”çš„çœŸå®domç§»åŠ¨åˆ°å¤´éƒ¨ if (idxInOld &gt; 0) &#123; const vnodeToMove = oldChildren[idxInOld]; // å…ˆæ‰“è¡¥ä¸ patch(vnodeToMove, newStartVNode, container); // å°†vnodeToMove.elç§»åŠ¨åˆ°oldStartVnode.elä¹‹å‰ï¼Œç”¨å…¶åšé”šç‚¹ insert(vnodeToMove.el, container, oldStartVNode.el); // ç”±äºä½ç½®idxInOldå¤„çš„èŠ‚ç‚¹æ‰€å¯¹åº”çš„çœŸå®domå·²ç»ç§»åˆ°äº†åˆ«å¤„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç›´æ¥è®¾ç½®è¿™ä¸ªvnodeä¸ºundefined oldChildren[idxInOld] = undefined; // æœ€åæ›´æ–°newStartIdxåˆ°ä¸‹ä¸€ä¸ªä½ç½® newStartIdx = newChildren[++newStartIdx]; &#125; &#125; &#125;&#125; ç§»åŠ¨ä¹‹åçš„çŠ¶æ€å›¾å¦‚ä¸‹ï¼š ä¹‹åå†è¿›è¡Œ 2 è½®çš„å¾ªç¯ï¼Œæœ€ç»ˆç´¢å¼•ä¼šåŒ¹é…åˆ°æˆ‘ä»¬ä¸Šé¢ç‰¹æ®Šå¤„ç†åè¢«ç½®ä¸º undefined çš„èŠ‚ç‚¹ï¼Œåˆ°äº†è¿™ä¸€æ­¥æˆ‘ä»¬ä¹Ÿéœ€è¦å¯¹ undefined çš„æƒ…å†µåšç‰¹æ®Šå¤„ç†ï¼Œæ­¤æ—¶èŠ‚ç‚¹çš„çŠ¶æ€å¦‚ä¸‹ å†å¾ªç¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ç»•è¿‡ undefined çš„è¿™ä¸€ä¸ªå·²ç»å¤„ç†è¿‡çš„èŠ‚ç‚¹ï¼Œå¯èƒ½æ¶‰åŠçš„æƒ…å†µå°±æ˜¯ï¼Œå¤´éƒ¨èŠ‚ç‚¹å’Œå°¾éƒ¨èŠ‚ç‚¹éƒ½ä¸å­˜åœ¨çš„æƒ…å†µï¼Œå› æ­¤åŠ å…¥åˆ¤æ–­é€»è¾‘ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** åŒç«¯diffç®—æ³• */function patchKeyedChildren(n1, n2, container) &#123; const oldChildren = n1.children; const newChildren = n2.children; // å››ä¸ªç´¢å¼• let oldStartIdx = 0; let oldEndIdx = oldChildren.length - 1; let newStartIdx = 0; let newEndIdx = newChildren.length - 1; // å››ä¸ªç´¢å¼•å¯¹åº”çš„vNode let oldStartVNode = oldChildren[oldStartIdx]; let oldEndVNode = oldChildren[oldEndIdx]; let newStartVNode = newChildren[newStartIdx]; let newEndVNode = newChildren[newEndIdx]; while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123; if (!oldStartVNode) &#123; // â• oldStartVNode = oldChildren[++oldStartIdx]; // â• &#125; else if (!oldEndVNode) &#123; // â• oldEndVNode = oldChildren[--oldEndIdx]; // â• &#125; else if (oldStartVNode.key === newStartVNode.key) &#123; // ... &#125; else if (oldEndVNode.key === newEndVNode.key) &#123; // ... &#125; else if (oldStartVNode.key === newEndVNode.key) &#123; // ... &#125; else if (oldEndVNode.key === newStartVNode.key) &#123; // ... &#125; else &#123; // éå†æ—§çš„å­èŠ‚ç‚¹ç»„ï¼Œæ‰¾åˆ°ä¸newStartIdxæ‹¥æœ‰ç›¸åŒçš„keyå€¼çš„å…ƒç´  const idxInOld = oldChildren.findIndex( (node) =&gt; node.key === newStartVNode.key ); // idxInOldå¤§äº0ï¼Œè¯´æ˜æ‰¾åˆ°äº†å¯å¤ç”¨çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”éœ€è¦å°†å…¶å¯¹åº”çš„çœŸå®domç§»åŠ¨åˆ°å¤´éƒ¨ if (idxInOld &gt; 0) &#123; const vnodeToMove = oldChildren[idxInOld]; // å…ˆæ‰“è¡¥ä¸ patch(vnodeToMove, newStartVNode, container); // å°†vnodeToMove.elç§»åŠ¨åˆ°oldStartVnode.elä¹‹å‰ï¼Œç”¨å…¶åšé”šç‚¹ insert(vnodeToMove.el, container, oldStartVNode.el); // ç”±äºä½ç½®idxInOldå¤„çš„èŠ‚ç‚¹æ‰€å¯¹åº”çš„çœŸå®domå·²ç»ç§»åˆ°äº†åˆ«å¤„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç›´æ¥è®¾ç½®è¿™ä¸ªvnodeä¸ºundefined oldChildren[idxInOld] = undefined; // æœ€åæ›´æ–°newStartIdxåˆ°ä¸‹ä¸€ä¸ªä½ç½® newStartIdx = newChildren[++newStartIdx]; &#125; &#125; &#125;&#125; ä¹‹åçš„æµç¨‹å°±å¯ä»¥æ­£å¸¸çš„è¿›è¡Œäº†ã€‚ æ·»åŠ æ–°å…ƒç´ æƒ…å†µå¦‚ä¸‹è¿™ç§æƒ…å†µ ç»è¿‡ä¸€è½®çš„å¾ªç¯ä¼šå‘ç°ï¼Œ1 2 3 4 æ­¥éª¤å…¨éƒ¨æ²¡æœ‰å‘½ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šæ‰§è¡Œç‰¹æ®Šçš„é€»è¾‘ï¼Œä»¥æ–°èŠ‚ç‚¹çš„å¤´éƒ¨å»æ—§å­èŠ‚ç‚¹ä¸­å»å¯»æ‰¾ä¸ä¹‹ key ç›¸ç­‰çš„ï¼Œå‘ç°ä¹Ÿæ²¡æœ‰å‘½ä¸­ã€‚è¿™é‡Œå°±éœ€è¦è¡¥å……é€»è¾‘ï¼Œå»å¼¥è¡¥æ²¡æœ‰æŸ¥æ‰¾åˆ°çš„æƒ…å†µã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152/** åŒç«¯diffç®—æ³• */function patchKeyedChildren(n1, n2, container) &#123; const oldChildren = n1.children; const newChildren = n2.children; // å››ä¸ªç´¢å¼• let oldStartIdx = 0; let oldEndIdx = oldChildren.length - 1; let newStartIdx = 0; let newEndIdx = newChildren.length - 1; // å››ä¸ªç´¢å¼•å¯¹åº”çš„vNode let oldStartVNode = oldChildren[oldStartIdx]; let oldEndVNode = oldChildren[oldEndIdx]; let newStartVNode = newChildren[newStartIdx]; let newEndVNode = newChildren[newEndIdx]; while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123; if (!oldStartVNode) &#123; // ... &#125; else if (!oldEndVNode) &#123; // ... &#125; else if (oldStartVNode.key === newStartVNode.key) &#123; // ... &#125; else if (oldEndVNode.key === newEndVNode.key) &#123; // ... newEndVNode = newChildren[--newEndIdx]; &#125; else if (oldStartVNode.key === newEndVNode.key) &#123; // ... &#125; else if (oldEndVNode.key === newStartVNode.key) &#123; // ... &#125; else &#123; // éå†æ—§çš„å­èŠ‚ç‚¹ç»„ï¼Œæ‰¾åˆ°ä¸newStartIdxæ‹¥æœ‰ç›¸åŒçš„keyå€¼çš„å…ƒç´  const idxInOld = oldChildren.findIndex( (node) =&gt; node.key === newStartVNode.key ); // idxInOldå¤§äº0ï¼Œè¯´æ˜æ‰¾åˆ°äº†å¯å¤ç”¨çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”éœ€è¦å°†å…¶å¯¹åº”çš„çœŸå®domç§»åŠ¨åˆ°å¤´éƒ¨ if (idxInOld &gt; 0) &#123; const vnodeToMove = oldChildren[idxInOld]; // å…ˆæ‰“è¡¥ä¸ patch(vnodeToMove, newStartVNode, container); // å°†vnodeToMove.elç§»åŠ¨åˆ°oldStartVnode.elä¹‹å‰ï¼Œç”¨å…¶åšé”šç‚¹ insert(vnodeToMove.el, container, oldStartVNode.el); // ç”±äºä½ç½®idxInOldå¤„çš„èŠ‚ç‚¹æ‰€å¯¹åº”çš„çœŸå®domå·²ç»ç§»åˆ°äº†åˆ«å¤„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç›´æ¥è®¾ç½®è¿™ä¸ªvnodeä¸ºundefined oldChildren[idxInOld] = undefined; &#125; else &#123; // æ²¡æœ‰å‘½ä¸­è¯´æ˜ï¼Œæ˜¯æ–°èŠ‚ç‚¹åœ¨newChildrenä¸­çš„å¤´éƒ¨ï¼Œå› æ­¤éœ€è¦å°†æ­¤æ–°èŠ‚ç‚¹æŒ‚è½½åˆ°oldStartVNodeå¯¹åº”domçš„å‰é¢ patch(null, newStartVNode, container, oldStartVNode.el); &#125; // æœ€åæ›´æ–°newStartIdxåˆ°ä¸‹ä¸€ä¸ªä½ç½® newStartVNode = newChildren[++newStartIdx]; &#125; &#125;&#125; ä»¥ä¸Šæ˜¯åœ¨ 1 2 3 4 è½®ä¸­ï¼Œéƒ½æ²¡æœ‰å‘½ä¸­çš„æƒ…å†µæ‰ä¼šè€ƒè™‘åˆ°æ–°èŠ‚ç‚¹çš„æƒ…å†µï¼Œå¦‚æœå…¶ä¸­ä¸€è½®å‘½ä¸­äº†ï¼Œé‚£ä¹ˆæ–°èŠ‚ç‚¹ä¼šè¢«å¿½ç•¥æ‰ï¼Œå¦‚ä¸‹è¿™ç§æƒ…å†µ åœ¨ç¬¬ 2 è½®çš„æ¯”è¾ƒä¸­ï¼Œèƒ½å¤ŸåŒ¹é…åˆ°ç›¸å¯¹åº”çš„ key å€¼ï¼Œå¹¶ä¸”åœ¨åç»­çš„å¾ªç¯ä¸­éƒ½èƒ½ä¸€ä¸€å¯¹åº”æ‰¾åˆ°èŠ‚ç‚¹ï¼Œç›´è‡³ä»¥ä¸‹è¿™ç§çŠ¶æ€ è¿™ç§çŠ¶æ€å·²ç»è¡¨æ˜ï¼Œç´¢å¼•è¶Šç•Œï¼Œå¾ªç¯è·³å‡ºäº†ï¼Œä½†æ˜¯æ­¤æ—¶çš„ p-4 æ–°å¢çš„è¿™ä¸ªå‡ ç‚¹ä¹Ÿè¢«å¿½ç•¥äº†ï¼Œ å› æ­¤æˆ‘ä»¬è¿˜éœ€è¦å¢åŠ é€»è¾‘ï¼Œå»å¤„ç†é—æ¼çš„æ–°å¢èŠ‚ç‚¹ã€‚ é—æ¼çš„èŠ‚ç‚¹ä½äºçš„åŒºé—´å°±åœ¨äº newStartIdx å’Œ newEndIdx ä¹‹é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬å»å¾ªç¯éå†æŒ¨ä¸ªæŒ‚è½½ï¼ŒæŒ‚è½½æ—¶å€™çš„é”šç‚¹ä»ç„¶æ˜¯å¤„äº oldStartVNode å¯¹åº” dom 12345678910111213141516171819202122232425262728/** åŒç«¯diffç®—æ³• */function patchKeyedChildren(n1, n2, container) &#123; const oldChildren = n1.children; const newChildren = n2.children; // å››ä¸ªç´¢å¼• let oldStartIdx = 0; let oldEndIdx = oldChildren.length - 1; let newStartIdx = 0; let newEndIdx = newChildren.length - 1; // å››ä¸ªç´¢å¼•å¯¹åº”çš„vNode let oldStartVNode = oldChildren[oldStartIdx]; let oldEndVNode = oldChildren[oldEndIdx]; let newStartVNode = newChildren[newStartIdx]; let newEndVNode = newChildren[newEndIdx]; while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123; // ... &#125; // å¾ªç¯ç»“æŸåæ£€æŸ¥ç´¢å¼•çš„æƒ…å†µï¼Œé¿å…éœ€è¦æ–°å¢çš„èŠ‚ç‚¹è¢«é—æ¼ if (oldEndIdx &lt; oldStartIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123; // å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œæˆ‘ä»¬å»éå†é—æ¼èŠ‚ç‚¹ï¼Œé€ä¸ªæŒ‚è½½ for (let i = newStartIdx; i &lt;= newEndIdx; i++) &#123; // ä»¥oldStartVNodeå¯¹åº”çš„domä¸ºé”šç‚¹ patch(null, newChildren[i], container, oldStartVNode.el); &#125; &#125;&#125; ç§»é™¤ä¸å­˜åœ¨çš„å…ƒç´ ç§»é™¤å’Œæ–°å¢çš„ç±»ä¼¼ï¼Œéƒ½æ˜¯åœ¨æœ€åä¸€æ­¥æ£€æŸ¥ç´¢å¼•å€¼ï¼Œå¦‚ä¸‹è¿™ç§æƒ…å†µï¼š é€šè¿‡å‡ æ¬¡å¾ªç¯ä¹‹åç›´åˆ°ä»¥ä¸‹è¿™ç§æƒ…å†µï¼Œæ­¤æ—¶çš„å˜é‡ newStartIdx çš„å€¼å¤§äºå˜é‡ newEndIdx çš„å€¼ï¼Œåœæ­¢å¾ªç¯ï¼Œä½†æ˜¯æ—§çš„ä¸€ç»„èŠ‚ç‚¹ä¸­è¿˜å­˜åœ¨æœªè¢«å¤„ç†çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥åº”è¯¥å°†å…¶ç§»é™¤ï¼ŒåŒç†ï¼Œæ­¤æ—¶æ˜¯æ—§èŠ‚ç‚¹å‰©ä½™ï¼Œæ‰€ä»¥åº”è¯¥å¸è½½åœ¨åŒºé—´ oldStartIdx å’Œ oldEndIdx ä¹‹é—´çš„èŠ‚ç‚¹ 12345678910111213141516171819202122232425262728293031/** åŒç«¯diffç®—æ³• */function patchKeyedChildren(n1, n2, container) &#123; const oldChildren = n1.children; const newChildren = n2.children; // å››ä¸ªç´¢å¼• let oldStartIdx = 0; let oldEndIdx = oldChildren.length - 1; let newStartIdx = 0; let newEndIdx = newChildren.length - 1; // å››ä¸ªç´¢å¼•å¯¹åº”çš„vNode let oldStartVNode = oldChildren[oldStartIdx]; let oldEndVNode = oldChildren[oldEndIdx]; let newStartVNode = newChildren[newStartIdx]; let newEndVNode = newChildren[newEndIdx]; while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123; // ... &#125; // å¾ªç¯ç»“æŸåæ£€æŸ¥ç´¢å¼•çš„æƒ…å†µï¼Œé¿å…éœ€è¦æ–°å¢çš„èŠ‚ç‚¹è¢«é—æ¼ if (oldEndIdx &lt; oldStartIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123; // å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œæˆ‘ä»¬å»éå†é—æ¼èŠ‚ç‚¹ï¼Œé€ä¸ªæŒ‚è½½ for (let i = newStartIdx; i &lt;= newEndIdx; i++) &#123; patch(null, newChildren[i], container, oldStartVNode.el); &#125; &#125; else if (newEndIdx &lt; newStartIdx &amp;&amp; oldStartIdx &lt;= oldEndIdx) &#123; for (let i = oldStartIdx; i &lt;= oldEndIdx; i++) &#123; unmount(oldChildren[i]); &#125; &#125;&#125; åˆ°è¿™é‡Œå°±éƒ½å¤„ç†å®Œäº† å¿«é€Ÿdiffç®—æ³•","tags":["React","diff","Vue"],"categories":["Vue"]},{"title":"vue3æ¸²æŸ“å™¨è®¾è®¡ä¸æ€»ç»“","path":"/2022/12/03/vue3æ¸²æŸ“å™¨è®¾è®¡ä¸æ€»ç»“/","content":"å‰ç½®æ¦‚å¿µè™šæ‹Ÿ domvdomï¼Œè™šæ‹Ÿ dom å°±æ˜¯ç”¨æ¥è¡¨ç¤ºçœŸå®çš„ dom å…ƒç´ çš„å±æ€§æˆ–è€…ç‰¹ç‚¹çš„ä¸€å¥—æ•°æ®ç»“æ„ï¼Œå’ŒçœŸå® dom ä¸€æ ·å…·æœ‰æ ‘å½¢ç»“æ„ï¼Œå…·æœ‰è®¸å¤šæ ‘å½¢èŠ‚ç‚¹ vnode å¯ä»¥ç®€è¦çš„è¡¨ç¤º 123456789const vnode = &#123; type: &quot;h1&quot;, children: [ &#123; type: &quot;h2&quot;, children: &quot;æˆ‘æ˜¯h2&quot;, &#125;, ],&#125;; æ¸²æŸ“å™¨æ¸²æŸ“å™¨çš„åŸºæœ¬ä½œç”¨å°±æ˜¯æŠŠè™šæ‹Ÿ dom æ¸²æŸ“ä¸ºå¹³å°ä¸Šé¢çš„çœŸå® å…ƒç´ ï¼Œæµè§ˆå™¨ä¸Šå°±æ˜¯çœŸå®çš„ dom å…ƒç´ ã€‚ æŒ‚è½½mountedï¼Œæ„æ€å°±æ˜¯æ¸²æŸ“å™¨è¯»å–è§£æ vnode/vdom å±æ€§ä¹‹åï¼Œä½¿ç”¨çœŸå®çš„ dom å½¢å¼å¹¶ä¸”è¡¨ç°åœ¨é¡µé¢ä¸Š/æˆ–è€…æ˜¯å…·ä½“çš„é¡µé¢æŸä¸ªä½ç½®ä¸Š å®ç°æ¸²æŸ“å™¨ç®€å•çš„æ¸²æŸ“åŸç†renderer: æ¸²æŸ“å‡½æ•° å°±æ˜¯é€šè¿‡ innerHTML çš„å½¢å¼å°†ç¬¬ä¸€ä¸ªå‚æ•° domString æ’å…¥åˆ°å¯¹åº”å®¹å™¨å½“ä¸­ 12345function renderer(domString, container) &#123; container.innerHTML = domString;&#125;renderer(&quot;&lt;h1&gt;vue3 renderer&lt;/h1&gt;&quot;, document.getElementById(&quot;app&quot;)); ç»“åˆ reactivityå¼•å…¥ vue3 çš„ reactivity åŒ…ï¼Œä»–ä¼šåœ¨å…¨å±€æš´éœ²ä¸€ä¸ª VueReactivity å˜é‡ cdn åœ°å€ 12345678910111213141516171819&lt;script src=&quot;https://cdn.jsdelivr.net/npm/@vue/reactivity@3.2.45/dist/reactivity.global.min.js&quot;&gt;&lt;/script&gt;&lt;script type=&quot;module&quot;&gt; import &#123; renderer &#125; from &quot;./render.js&quot;; const &#123; effect, ref &#125; = VueReactivity; const count = ref(1); effect(() =&gt; &#123; renderer( `&lt;h1&gt;vue3 renderer times: $&#123;count.value&#125;&lt;/h1&gt;`, document.getElementById(&quot;app&quot;) ); &#125;); setTimeout(() =&gt; &#123; count.value++; &#125;, 2000);&lt;/script&gt; é€šè¿‡å¼•å…¥ vue3 çš„ reactivityï¼Œæˆ‘ä»¬èƒ½å¤Ÿå®ç°ä¸€ä¸ªåŠ¨æ€æ¸²æŸ“çš„åŸºæœ¬é€»è¾‘ è‡ªå®šä¹‰æ¸²æŸ“å™¨ vue3 ä¸­çš„æ¸²æŸ“å™¨ï¼Œæ˜¯è®¾è®¡ä¸ºé€šç”¨å¯é…ç½®çš„ï¼Œå³å¯å®ç°æ¸²æŸ“åˆ°ä»»æ„ç›®æ ‡çš„å¹³å°ä¸Šï¼Œæˆ‘ä»¬ç›®å‰è¯´çš„ç›®æ ‡å¹³å°ï¼Œå…ˆæŒ‡å®šæµè§ˆå™¨ï¼›åç»­å¯ä»¥å°†ä¸€äº›å¯æŠ½è±¡çš„ API æŠ½ç¦»ï¼Œä½¿å¾—æ¸²æŸ“å™¨çš„æ ¸å¿ƒä¸ä¾èµ–ä¸æµè§ˆå™¨çš„ api è¿™ä¹Ÿå°±æ˜¯ vue çš„æ ¸å¿ƒä¹‹ä¸€ï¼Œå°†ç›¸å…³æµè§ˆå™¨çš„ api å°è£…åˆ°äº†runtime-domçš„ä¸€ä¸ªåŒ…ï¼Œæä¾›äº†å¾ˆå¤šé’ˆå¯¹æµè§ˆå™¨çš„ dom apiï¼Œå±æ€§ä»¥åŠäº‹ä»¶å¤„ç† å·¥å‚å‡½æ•°é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª createRenderer çš„å·¥å‚å‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨, å¹¶ä¸”æŠ›å‡ºè®¸å¤šçš„æ–¹æ³• 12345678910/** åˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨ */function createRenderer() &#123; const render = (vnode, container) =&gt; &#123; // ... &#125;; // åç»­ä¼šæœ‰å„ç§æ–¹æ³• return &#123; render &#125;;&#125; ä¹‹åè¿›è¡Œç›¸å…³çš„æ¸²æŸ“è°ƒç”¨ 12const renderer = createRenderer();renderer.render(vNode, document.getElementById(&quot;app&quot;)); åŠ å…¥æ›´æ–°çš„æ¦‚å¿µç¬¬ä¸€æ¬¡è°ƒç”¨ 1renderer.render(vNode, document.getElementById(&quot;app&quot;)); ç¬¬äºŒæ¬¡è°ƒç”¨æ¸²æŸ“çš„æ—¶å€™è¿˜æ˜¯åœ¨åŒä¸€ä¸ª container ä¸Šè°ƒç”¨çš„ 1renderer.render(newVNode, document.getElementById(&quot;app&quot;)); ç”±äºé¦–æ¬¡çš„æ¸²æŸ“å·²ç»å°†å¯¹åº”çš„ dom æ¸²æŸ“åˆ°äº† container å†…éƒ¨äº†ï¼Œæ‰€ä»¥å†æ¬¡è°ƒç”¨ render å‡½æ•°çš„æ—¶å€™ï¼Œæ¸²æŸ“ä¸€ä¸ªæ–°çš„è™šæ‹Ÿ domï¼Œå°±å•å•æ˜¯åšä¸€ä¸ªç®€å•çš„æŒ‚è½½çš„åŠ¨ä½œäº†ï¼Œè€Œæ˜¯è¦è¿›è¡Œæ›´æ–°å¯¹æ¯”ï¼Œæ‰¾å‡ºå˜åŠ¨çš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åš - æ‰“è¡¥ä¸ï¼ˆæ›´æ–°ï¼‰ å› æ­¤æˆ‘ä»¬å¯ä»¥ç›¸å…³çš„æ”¹é€ ä¸€ä¸‹ä»£ç ï¼š å¼•å…¥ä¸€ä¸ªæ›´æ–°çš„æ¦‚å¿µå¤„ç†çš„é€»è¾‘ 12345678910111213141516171819/** åˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨ */function createRenderer() &#123; const render = (vnode, container) =&gt; &#123; if (vnode) &#123; // æ–°çš„nodeå­˜åœ¨çš„æƒ…å†µï¼Œå°†å…¶æ—§çš„vnodeä¸€èµ·ä¼ é€’ç»™patchå‡½æ•°è¿›è¡Œè¡¥ä¸çš„æ›´æ–° patch(container._vnode, vnode, container); &#125; else &#123; if (container._vnode) &#123; // æ—§çš„vnodeå­˜åœ¨ï¼Œæ–°çš„vnodeä¸å­˜åœ¨çš„æƒ…å†µï¼Œè¯´æ˜æ˜¯ä¸€ä¸ª unmountï¼ˆå¸è½½ï¼‰çš„æ“ä½œ // è¿™é‡Œåªéœ€è¦å°†containerå†…domæ¸…ç©ºå°±å¯ä»¥, ç›®å‰æš‚æ—¶è¿™æ ·æ¸…ç©º container.innerHTML = &quot;&quot;; &#125; &#125; // æ¯ä¸€æ¬¡éƒ½éœ€è¦ä¿å­˜ä¸Šä¸€æ¬¡çš„vnodeï¼Œå­˜å‚¨åœ¨containerä¸‹ container._vnode = vnode; // æš‚æ—¶ä½¿ç”¨è¿™æ®µä»£ç æ¸…ç©ºï¼Œåç»­ä¼šå®Œå–„ &#125;; return &#123; render &#125;;&#125; patch ç®€å•å®ç°å…¶ä¸­ patch çš„å‡½æ•°ï¼Œæ˜¯æœ€æœ€é‡è¦çš„ä¸€ä¸ªæ¸²æŸ“å™¨çš„æ ¸å¿ƒï¼Œä¸»è¦æ˜¯åšåˆå§‹åŒ–å’Œç›¸å…³çš„ diff æ“ä½œ ç›®å‰è¿›è¡Œç®€å•å®ç°ï¼Œåç»­ç€é‡è¯´ 123456789/** æ›´æ–°å¯¹æ¯” */function patch(n1, n2, container) &#123; // å¦‚æœä¸å­˜åœ¨ if (!n1) &#123; mountElement(n2, container); &#125; else &#123; // n1å­˜åœ¨çš„æƒ…å†µä¸‹é¢ï¼Œæˆ‘ä»¬è¿›è¡Œæ›´æ–°ï¼ˆæ‰“è¡¥ä¸ï¼‰ &#125;&#125; n1: è€çš„ vnode n2: æ–°çš„ vnode container: å®¹å™¨ å¦‚æœä¸å­˜åœ¨æ—§çš„ vnode çš„æƒ…å†µä¸‹ï¼Œè¯´æ˜åªæ˜¯éœ€è¦è¿›è¡Œå…ƒç´ çš„æŒ‚è½½å³å¯ å®ç° mountElement æŒ‚è½½123456789101112/** æŒ‚è½½ */function mountElement(vnode, container) &#123; // åˆ›å»ºdomå…ƒç´  const el = document.createElement(vnode.type); //å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹ if (typeof vnode.children === &quot;string&quot;) &#123; // åªéœ€è¦è®¾ç½®å…ƒç´ çš„textContentçš„å±æ€§å³å¯ el.textContent = vnode.children; &#125; // å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­ container.appendChild(el);&#125; é€šè¿‡ vnode çš„ type æ ‡ç­¾åç§°åˆ›å»ºä¸€ä¸ªæ–°çš„ dom å…ƒç´ ï¼Œæ¥ç€å¤„ç† childrenï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²çš„ç±»å‹ï¼Œè¯´æ˜æ˜¯æ–‡æœ¬çš„ child èŠ‚ç‚¹ï¼Œç›´æ¥è®¾ç½® textContent å°±å¯ä»¥äº†ï¼Œä¹‹å appendChild æ’å…¥å®¹å™¨å½“ä¸­ é…ç½®é¡¹å½¢å¼æŠ½ç¦»å› ä¸ºæˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ªç›¸å½“äºæ˜¯ä¸ä¾èµ–äºå¹³å°çš„ä¸€ä¸ªé€šç”¨æ¸²æŸ“å™¨ï¼Œæ‰€ä»¥ï¼Œéœ€è¦å°†ä¸Šè¿°æ‰€ç”¨åˆ°çš„æ‰€æœ‰ä¾èµ–äºæµè§ˆå™¨çš„ api éƒ½ç»™æŠ½ç¦»å‡ºæ¥ï¼Œå®ç°ç‹¬ç«‹å°è£…çš„é…ç½®é¡¹ ä¾‹å¦‚ï¼Œæˆ‘ä»¬æŠ½ç¦»mountElementå‡½æ•°ä½¿ç”¨åˆ°çš„ä¸€äº›æµè§ˆå™¨æ–¹æ³• 12345678910111213141516171819/** æµè§ˆå™¨ç«¯çš„ç›¸å…³api */const BROWSER_APIS = &#123; // ç”¨äºåˆ›å»ºå…ƒç´  createElement(tag) &#123; return document.createElement(tag); &#125;, /** ç”¨äºè®¾ç½®å…ƒç´ çš„æ–‡æœ¬èŠ‚ç‚¹ */ setElementText(el, text) &#123; el.textContent = text; &#125;, /** ç»™ç‰¹å®šçš„parentä¸‹æ·»åŠ æŒ‡å®šçš„å…ƒç´  */ insert(el, parent, anchor = null) &#123; parent.insertBefore(el, anchor); &#125;,&#125;;export default BROWSER_APIS; ä¹‹åæˆ‘ä»¬æ”¹é€ createRendererå‡½æ•° å°†ç›¸å…³çš„ api ä»¥ options çš„å½¢å¼ä¼ å…¥ 1234567891011121314151617181920212223/** åˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨ */function createRenderer(options) &#123; const &#123; createElement, insert, setElementText &#125; = options; /** æŒ‚è½½ */ function mountElement(vnode, container) &#123; // ... &#125; /** æ›´æ–°å¯¹æ¯” */ function patch(n1, n2, container) &#123; // ... &#125; /** æ¸²æŸ“æ–¹æ³• */ const render = (vnode, container) =&gt; &#123; // ... &#125;; return &#123; render &#125;;&#125;export &#123; createRenderer &#125;; ä¹‹åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¼ é€’è¿›æ¥çš„å¯é…ç½®çš„ apis å»å®ç°ç›¸å…³çš„æ¸²æŸ“å™¨æ“ä½œ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹é€ mountElementå¹¶ä¸”ä½¿ç”¨åˆ°ç›¸å…³çš„ apis 123456789101112/** æŒ‚è½½ */function mountElement(vnode, container) &#123; // åˆ›å»ºdomå…ƒç´  const el = createElement(vnode.type); // â• //å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹ if (typeof vnode.children === &quot;string&quot;) &#123; // åªéœ€è¦è®¾ç½®å…ƒç´ çš„textContentçš„å±æ€§å³å¯ setElementText(e, vnode.children); // â• &#125; // å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­ insert(el, container); // â•&#125; é€šè¿‡äº†ä»¥ä¸Šé…ç½®ä¹‹åï¼Œæ¸²æŸ“å™¨å°†ä¸ä»…ä»…å¯ä»¥åœ¨æµè§ˆå™¨ç«¯è¿›è¡Œä½¿ç”¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®ä¸åŒçš„å¹³å°ï¼Œä¼ å…¥ä¸åŒçš„è‡ªå®šä¹‰çš„ç›¸å…³ api å‚æ•° æŒ‚è½½å’Œæ›´æ–°å­èŠ‚ç‚¹æŒ‚è½½ä¸Šè¿°æˆ‘ä»¬åªè€ƒè™‘åˆ°äº†ä¸€ä¸ª vnode çš„ children ä¸º string çš„æƒ…å†µä¸‹çš„æŒ‚è½½ï¼Œä½¿ç”¨ setElementText å¯¹å…ƒç´ è¿›è¡ŒæŒ‚è½½ï¼Œä½†æ˜¯ children å¯èƒ½å­˜åœ¨å¤šä¸ª vnode é string ç±»å‹çš„æƒ…å†µ ä¾‹å¦‚ï¼šä»¥ä¸‹çš„ vnodeï¼Œæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ 12345678910111213const vNode = &#123; type: &quot;div&quot;, children: [ &#123; type: &quot;p&quot;, children: &quot;111&quot;, &#125;, &#123; type: &quot;p&quot;, children: &quot;222&quot;, &#125;, ],&#125;; å› æ­¤éœ€è¦æ”¹é€ æŒ‚è½½å‡½æ•°ï¼Œä½¿å…¶å…·æœ‰æŒ‚è½½å­èŠ‚ç‚¹çš„èƒ½åŠ›ã€‚è¿™é‡ŒåŠ å…¥ä¸€å±‚ children èŠ‚ç‚¹çš„åˆ¤æ–­ 123456789101112131415161718/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */function mountElement(vnode, container) &#123; // åˆ›å»ºdomå…ƒç´  const el = createElement(vnode.type); //å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹ if (typeof vnode.children === &quot;string&quot;) &#123; // åªéœ€è¦è®¾ç½®å…ƒç´ çš„textContentçš„å±æ€§å³å¯ setElementText(el, vnode.children); &#125; else if (Array.isArray(vnode.children)) &#123; // â• // å¦‚æœchildrenæ˜¯æ•°ç»„ï¼Œåˆ™ä¾¿éå†æ¯ä¸€ä¸ªå­—èŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨patchçš„æ–¹æ³• vnode.children.forEach((child) =&gt; &#123; patch(null, child, el); &#125;); &#125; // å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­ insert(el, container);&#125; æŒ‚è½½èŠ‚ç‚¹çš„å±æ€§ä¸€ä¸ªå…ƒç´ å¯ä»¥ç”¨å¤šä¸ªå±æ€§æ¥è¿›è¡Œæè¿°ï¼Œå½“ç„¶æ˜ å°„åˆ°è™šæ‹Ÿ dom ä¸Šçš„è¯ï¼Œç”¨ä¸€ä¸ª props çš„å±æ€§è¿›è¡Œè¡¨ç¤ºã€‚ 12345678910111213141516const vNode = &#123; type: &quot;div&quot;, props: &#123; id: &quot;foo&quot;, &#125;, children: [ &#123; type: &quot;p&quot;, children: &quot;111&quot;, &#125;, &#123; type: &quot;p&quot;, children: &quot;222&quot;, &#125;, ],&#125;; å› æ­¤æˆ‘ä»¬åœ¨æŒ‚è½½å…ƒç´ çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦å°†è¿™äº›å±æ€§å€¼æ¸²æŸ“åˆ°å¯¹åº”çš„å…ƒç´ ä¸Šé¢ æ”¹é€ æŒ‚è½½å‡½æ•° 12345678910111213141516171819202122232425262728293031/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */function mountElement(vnode, container) &#123; // åˆ›å»ºdomå…ƒç´  const el = createElement(vnode.type); //å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹ if (typeof vnode.children === &quot;string&quot;) &#123; // åªéœ€è¦è®¾ç½®å…ƒç´ çš„textContentçš„å±æ€§å³å¯ setElementText(el, vnode.children); &#125; else if (Array.isArray(vnode.children)) &#123; // å¦‚æœchildrenæ˜¯æ•°ç»„ï¼Œåˆ™ä¾¿éå†æ¯ä¸€ä¸ªå­—èŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨patchçš„æ–¹æ³• vnode.children.forEach((child) =&gt; &#123; patch(null, child, el); &#125;); &#125; // å¤„ç†props, å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œå¤„ç† if (vnode.props) &#123; // â• // éå† for (const key in vnode.props) &#123; if (key in el) &#123; const prop = vnode.props[key]; // è°ƒç”¨setAttributeå°†å±æ€§è®¾ç½®åˆ°å…ƒç´ ä¸Š el.setAttribute(key, prop); // ğŸŒŸ &#125; &#125; &#125; // å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­ insert(el, container);&#125; åœ¨æ ‡è®°â€œğŸŒŸâ€œçš„åœ°æ–¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ el[key] = vnode.props[key]ï¼Œä½†æ˜¯ç”±äºè¿™éƒ½æ˜¯å±äºç›´æ¥æ“ä½œ dom å¯¹è±¡çš„è¡Œä¸ºï¼Œæ‰€ä»¥éƒ½ä¼šå­˜åœ¨ç¼ºé™·ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æƒ³åŠæ³•å¦‚ä½•çš„æ­£ç¡®è®¾ç½®å…ƒç´ çš„å±æ€§ ğŸŒŸHTML attribute å’Œ DOM properties åŒºåˆ«HTML attribute æŒ‡çš„å°±æ˜¯å®šä¹‰åœ¨ HMTL æ ‡ç­¾ä¸Šçš„å±æ€§ 1&lt;input id=&quot;my-input&quot; type=&quot;text&quot; value=&quot;foo&quot; /&gt; document æ–‡æ¡£è§£æä¹‹åï¼Œä¼šç”Ÿæˆä¸€ä¸ªä¸ä¹‹ç›¸ç¬¦çš„ dom å…ƒç´ å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸Šé¢åŒ…å«äº†å¾ˆå¤šçš„å±æ€§ è¿™äº›å°±æ˜¯æ‰€è°“çš„ dom propertyã€‚ ä¸¤è€…çš„åŒºåˆ†å¤§è‡´å¦‚ä¸‹ å¾ˆå¤šçš„ HTMl attribute åœ¨ DOM å¯¹è±¡ä¸Šé¢éƒ½æœ‰ä¸ä¹‹åŒåçš„ DOM propertiesï¼Œä½†æ˜¯å‘½åè§„åˆ™å´ä¸ä¸€æ · ä¾‹å¦‚ï¼šHTML attribute çš„ class å¯¹åº”çš„ dom property å°±æ˜¯ className ä¸¤è€…å­˜åœ¨å…³è”ï¼šä¾‹å¦‚ä¸Šè¿°è®¾ç½®äº† HTML attribute çš„ id ä¸ºâ€˜fooâ€™ï¼Œé‚£ä¹ˆå¯¹åº”çš„ DOM properties å½“ä¸­å­˜åœ¨ç›¸åŒå±æ€§åç§°ä¸º id ä¹Ÿä¸º fooï¼Œä¸¤è€…å¯ä»¥å½“ä½œç›´æ¥æ˜ å°„çš„å…³ç³» å¹¶ä¸æ˜¯éƒ½å­˜åœ¨ç›´æ¥ç›´æ¥æ˜ å°„å…³ç³»ï¼šä¾‹å¦‚ value å±æ€§ï¼Œä¸Šè¿° input è®¾ç½®äº† value å€¼ï¼Œä½†æ˜¯åœ¨ DOM properties å¯¹åº”çš„å€¼ä¸ä»…ä»…æ˜¯ valueï¼Œè¿˜æœ‰ defaultValue å€¼ï¼›å¦‚æœåç»­åœ¨ input æ¡†ä¸­è¾“å…¥äº†å…¶ä»–çš„ value å€¼ bar ç„¶åæˆ‘ä»¬å†å»è¯»å–å…¶ç›¸å…³çš„ HTML Attribute å’Œ DOM properties ä¼šå‘ç° å…¶å® HTML Attribute åªæ˜¯åšäº†ä¸€ä¸ªåˆå§‹å€¼çš„èµ‹å€¼ï¼Œä½†æ˜¯å´æ˜¯å¯¹å…¶ä»–çš„ DOM property ä¹Ÿæœ‰ç›¸å…³å½±å“ éæ³•å±æ€§å€¼ä¼šè¢«æµè§ˆå™¨æ ¡éªŒå¤„ç†æ‰ï¼šä¾‹å¦‚æˆ‘ä»¬åœ¨ input çš„ HTML attribute ä¸Šé¢è®¾ç½®äº†ä¸€ä¸ª type ç­‰äºä¸€ä¸ªâ€˜fooâ€˜çš„å±æ€§ï¼Œé‚£ä¹ˆä¼šè¢«æµè§ˆå™¨è‡ªåŠ¨å¤„ç†æ‰ã€‚æœ€ç»ˆæˆ‘ä»¬è¯»å– DOM property çš„æ—¶å€™ï¼Œæ˜¯è¢«çŸ«æ­£ä¹‹åçš„å€¼ â€˜textâ€™ HTMl Atrribute çš„ä½œç”¨å°±æ˜¯è®¾ç½®ä¸ä¹‹å¯¹åº”çš„ DOM properties çš„åˆå§‹å€¼ æ‰€ä»¥æŒ‰ç…§ä¸Šè¿°çš„ HTML attribute å’Œ DOM props çš„åŒºåˆ«ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹é€ ç›¸å…³çš„ mountElement çš„æ“ä½œ 12345678910111213141516171819202122232425262728293031323334/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */function mountElement(vnode, container) &#123; // åˆ›å»ºdomå…ƒç´  const el = createElement(vnode.type); console.log(el); //å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹ if (typeof vnode.children === &quot;string&quot;) &#123; // åªéœ€è¦è®¾ç½®å…ƒç´ çš„textContentçš„å±æ€§å³å¯ setElementText(el, vnode.children); &#125; else if (Array.isArray(vnode.children)) &#123; // å¦‚æœchildrenæ˜¯æ•°ç»„ï¼Œåˆ™ä¾¿éå†æ¯ä¸€ä¸ªå­—èŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨patchçš„æ–¹æ³• vnode.children.forEach((child) =&gt; &#123; patch(null, child, el); &#125;); &#125; // å¤„ç†props, å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œå¤„ç† if (vnode.props) &#123; // éå† for (const key in vnode.props) &#123; const value = vnode.props[key]; // è·å–propså¯¹åº”keyçš„value // dom propertieså­˜åœ¨çš„æƒ…å†µ if (key in el) &#123; el[key] = value; &#125; else &#123; // è®¾ç½®çš„å±æ€§æ²¡æœ‰å¯¹åº”çš„DOM propertiesçš„æƒ…å†µï¼Œè°ƒç”¨setAttributeå°†å±æ€§è®¾ç½®åˆ°å…ƒç´ ä¸Š el.setAttribute(key, value); &#125; &#125; &#125; // å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­ insert(el, container);&#125; æ­£ç¡®çš„è®¾ç½®èŠ‚ç‚¹çš„å±æ€§æµè§ˆå™¨ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬è§£æ HTML æ–‡ä»¶ä¸­çš„ dom å…ƒç´ ï¼Œä»¥åŠç›¸å…³çš„ props çš„å±æ€§è®¾ç½®æ“ä½œã€‚ ä½†æ˜¯åœ¨ vue ä¸­ï¼Œå› ä¸ºç”¨åˆ°äº†è‡ªèº«çš„æ¨¡æ¿æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨è§£æç›¸å…³çš„èŠ‚ç‚¹çš„æ—¶å€™éœ€è¦è‡ªèº«å¤„ç†è¿™äº›å±æ€§çš„æŒ‚è½½æ“ä½œ å¸ƒå°”ç±»å‹å±æ€§å¤„ç†ä¾‹å¦‚ä¸‹é¢è¿™æ®µ html ä»£ç ï¼š 1&lt;button disabled /&gt; åœ¨æµè§ˆå™¨ä¸­ä¼šå°†å…¶å±æ€§ disabled è‡ªåŠ¨çŸ«æ­£ä¸º disabled=true åœ¨ç›®å‰çš„æˆ‘ä»¬æ¸²æŸ“å™¨ä¸­ï¼Œç±»ä¼¼ä¸ç­‰ä»·äºå¦‚ä¸‹ vnode 123456const vNode = &#123; type: &quot;button&quot;, props: &#123; disabled: &quot;&quot;, &#125;,&#125;; æœ€ç»ˆåœ¨æŒ‚è½½çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨è®¾ç½®æ–¹æ³•å°†ç©ºå­—ç¬¦ä¸² è®¾ç½®åˆ° dom å±æ€§ä¸Šé¢ã€‚ ç±»ä¼¼äºï¼šel.disabled=&#39;&#39; ä½†æ˜¯ç”±äºæµè§ˆå™¨çš„è‡ªåŠ¨çŸ«æ­£åŠŸèƒ½ï¼Œä¼šå°†æˆ‘ä»¬çš„ç©ºå­—ç¬¦ä¸²ï¼Œè‡ªåŠ¨çŸ«æ­£ä¸º falseï¼Œè¿™å°±ä¸ç¬¦åˆç”¨æˆ·çš„æœ¬æ„äº†ã€‚ å› æ­¤æˆ‘ä»¬è¦å¯¹è¿™ç§ DOM attribute å¸ƒå°”ç±»å‹çš„å±æ€§ï¼Œåœ¨èµ‹å€¼çš„æ—¶å€™åŠ å…¥ä¸€å±‚åˆ¤æ–­ 1234567891011121314151617181920212223242526272829303132/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */function mountElement(vnode, container) &#123; // åˆ›å»ºdomå…ƒç´  // ... çœç•¥ä»£ç  // å¤„ç†props, å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œå¤„ç† if (vnode.props) &#123; // éå† for (const key in vnode.props) &#123; const value = vnode.props[key]; // è·å–propså¯¹åº”keyçš„value // dom propertieså­˜åœ¨çš„æƒ…å†µ if (key in el) &#123; // è·å–è¿™ä¸ªDOM propertieså…ƒç´ çš„å±æ€§ç±»å‹ const type = typeof el[key]; // â• // å¦‚æœåŸç”Ÿå±æ€§ç±»å‹ä¸ºå¸ƒå°”ç±»å‹ï¼Œå¹¶ä¸”valueæ˜¯ç©ºçš„å­—ç¬¦ä¸²çš„è¯ï¼Œç»™ä»–å€¼çŸ«æ­£ä¸ºtrue if (type === &quot;boolean&quot; &amp;&amp; value === &quot;&quot;) &#123; // â• el[key] = true; &#125; else &#123; // å…¶ä»–æƒ…å†µ el[key] = value; &#125; &#125; else &#123; // è®¾ç½®çš„å±æ€§æ²¡æœ‰å¯¹åº”çš„DOM propertiesçš„æƒ…å†µï¼Œè°ƒç”¨setAttributeå°†å±æ€§è®¾ç½®åˆ°å…ƒç´ ä¸Š el.setAttribute(key, value); &#125; &#125; &#125; // å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­ insert(el, container);&#125; åªè¯»ç±»å‹å±æ€§å¤„ç†DOM properties å½“ä¸­è¿˜å­˜åœ¨å¾ˆå¤šåªè¯»çš„å±æ€§ï¼Œä¾‹å¦‚ï¼šform å¦‚ä¸‹ä¾‹å­ï¼š 12&lt;form id=&quot;form1&quot;&gt;&lt;/form&gt;&lt;input form=&quot;form1&quot; /&gt; ç±»ä¼¼ form è¿™ç§ DOM properties åœ¨æ‰€æœ‰çš„ form æ§ä»¶ä¸Šéƒ½æ˜¯ï¼Œåªè¯»çš„å±æ€§çš„ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡ setAttributeæ¥è®¾ç½®ä»–çš„å±æ€§ï¼Œæ‰€ä»¥è¿™æ—¶å€™è¿˜å¾—è¦ä¿®æ”¹æˆ‘ä»¬çš„é€»è¾‘ï¼Œåˆ¤æ–­å½“å‰çš„å±æ€§åœ¨æµè§ˆå™¨ä¸­æ˜¯å¦æ˜¯åªè¯»çš„ï¼Œå¦‚æœæ˜¯åŒ¹é…ä¸Šè¿™ç§åªè¯»çš„æƒ…å†µçš„å±æ€§ï¼Œä½¿ç”¨setAttributeæ¥è¿›è¡Œèµ‹å€¼ 1234567891011121314151617181920212223242526272829303132333435363738// åˆ¤æ–­æ˜¯å¦åº”è¯¥ä½œä¸ºDOM propertiesçš„è®¾ç½®function shouldSetAsProps(el, key, value) &#123; // å¯¹ç‰¹æ®Šåªè¯»å±æ€§çš„å¤„ç† if (key === &quot;form&quot; &amp;&amp; el.tagName === &quot;INPUT&quot;) return false; return key in el;&#125;/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */function mountElement(vnode, container) &#123; // åˆ›å»ºdomå…ƒç´  // ... çœç•¥ä»£ç  // å¤„ç†props, å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œå¤„ç† if (vnode.props) &#123; // éå† for (const key in vnode.props) &#123; const value = vnode.props[key]; // è·å–propså¯¹åº”keyçš„value // dom propertieså­˜åœ¨çš„æƒ…å†µ if (shouldSetAsProps(el, key, value)) &#123; // è·å–è¿™ä¸ªDOM propertieså…ƒç´ çš„å±æ€§ç±»å‹ const type = typeof el[key]; // å¦‚æœåŸç”Ÿå±æ€§ç±»å‹ä¸ºå¸ƒå°”ç±»å‹ï¼Œå¹¶ä¸”valueæ˜¯ç©ºçš„å­—ç¬¦ä¸²çš„è¯ï¼Œç»™ä»–å€¼çŸ«æ­£ä¸ºtrue if (type === &quot;boolean&quot; &amp;&amp; value === &quot;&quot;) &#123; el[key] = true; &#125; else &#123; el[key] = value; &#125; &#125; else &#123; // è®¾ç½®çš„å±æ€§æ²¡æœ‰å¯¹åº”çš„DOM propertiesçš„æƒ…å†µï¼Œè°ƒç”¨setAttributeå°†å±æ€§è®¾ç½®åˆ°å…ƒç´ ä¸Š el.setAttribute(key, value); &#125; &#125; &#125; // å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­ insert(el, container);&#125; æå–å¹³å°æ— å…³ä»£ç æˆ‘ä»¬å°†éå† props æ—¶å€™çš„ åˆ¤æ–­è®¾å€¼çš„ä»£ç ï¼Œæå–åˆ° BROWSE_APIS å½“ä¸­ï¼Œä½œä¸ºæµè§ˆå™¨ç«¯çš„æ–¹æ³•ï¼Œå–åä¸ºpatchProps 1234567891011121314151617181920212223242526/** å°†å±æ€§è®¾ç½®ç›¸å…³çš„æ“ä½œå°è£…åˆ°patchPropsçš„å‡½æ•°ä¸­ï¼Œå¹¶ä½œä¸ºæ¸²æŸ“å™¨é€‰é¡¹ä¼ é€’ */ patchProps(el, key, preValue, nextValue) &#123; // åˆ¤æ–­æ˜¯å¦åº”è¯¥ä½œä¸ºDOM propertiesçš„è®¾ç½® function shouldSetAsProps(el, key, value) &#123; // å¯¹ç‰¹æ®Šåªè¯»å±æ€§çš„å¤„ç† if (key === &quot;form&quot; &amp;&amp; el.tagName === &quot;INPUT&quot;) return false; // ...è¿˜æœ‰æ›´å¤šç‰¹æ®Šå¤„ç†æƒ…å†µtodo return Object.hasOwnProperty.call(vnode.props, key); &#125; // dom propertieså­˜åœ¨çš„æƒ…å†µ if (shouldSetAsProps(el, key, nextValue)) &#123; // è·å–è¿™ä¸ªDOM propertieså…ƒç´ çš„å±æ€§ç±»å‹ const type = typeof el[key]; // å¦‚æœåŸç”Ÿå±æ€§ç±»å‹ä¸ºå¸ƒå°”ç±»å‹ï¼Œå¹¶ä¸”valueæ˜¯ç©ºçš„å­—ç¬¦ä¸²çš„è¯ï¼Œç»™ä»–å€¼çŸ«æ­£ä¸ºtrue if (type === &quot;boolean&quot; &amp;&amp; nextValue === &quot;&quot;) &#123; el[key] = true; &#125; else &#123; el[key] = nextValue; &#125; &#125; else &#123; // è®¾ç½®çš„å±æ€§æ²¡æœ‰å¯¹åº”çš„DOM propertiesçš„æƒ…å†µï¼Œè°ƒç”¨setAttributeå°†å±æ€§è®¾ç½®åˆ°å…ƒç´ ä¸Š el.setAttribute(key, nextValue); &#125; &#125;, æœ€ç»ˆåœ¨ mountElement ä¸­å°±è¿™æ ·è°ƒç”¨ 123456789101112131415161718192021222324252627/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */function mountElement(vnode, container) &#123; // åˆ›å»ºdomå…ƒç´  const el = createElement(vnode.type); console.log(el); //å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹ if (typeof vnode.children === &quot;string&quot;) &#123; // åªéœ€è¦è®¾ç½®å…ƒç´ çš„textContentçš„å±æ€§å³å¯ setElementText(el, vnode.children); &#125; else if (Array.isArray(vnode.children)) &#123; // å¦‚æœchildrenæ˜¯æ•°ç»„ï¼Œåˆ™ä¾¿éå†æ¯ä¸€ä¸ªå­—èŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨patchçš„æ–¹æ³• vnode.children.forEach((child) =&gt; &#123; patch(null, child, el); &#125;); &#125; // å¤„ç†props, å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œå¤„ç† if (vnode.props) &#123; // éå† for (const key in vnode.props) &#123; patchProps(el, key, null, vnode.props[key]); // â• &#125; &#125; // å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­ insert(el, container);&#125; class å’Œ style çš„å¤„ç†åœ¨ vue ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ 3 ç§æ–¹å¼å»ä¼ é€’ä¸€ä¸ª class çš„å€¼ å­—ç¬¦ä¸² 1&lt;p class=&quot;foo bar&quot;&gt;&lt;/p&gt; å¯¹è±¡ 1&lt;p :class=&quot;&#123; foo:true, bar:false &#125;&quot;&gt;&lt;/p&gt; æ•°ç»„ 1&lt;p :class=&quot;[&#x27;foo bar&#x27;, &#123;foo:true, bar:false &#125;]&quot;&gt;&lt;/p&gt; æ— è®ºæ˜¯ä½•ç§ç»“æ„ï¼Œæˆ‘ä»¬æœ€ç»ˆè½¬åŒ–åˆ° vNode ä¸Šé¢éƒ½æ˜¯è¦æˆä¸ºä¸€ä¸ªå­—ç¬¦ä¸²çš„ 123456const vNode = &#123; type: &quot;p&quot;, props: &#123; class: &quot;foo bar&quot;, &#125;,&#125;; å› æ­¤åœ¨ç”Ÿæˆ vnode çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ normalizeClass çš„æ–¹æ³•å»è½¬æ¢ class 123456789101112const vNode = &#123; type: &quot;p&quot;, props: &#123; class: normalizeClass([ &quot;foo&quot;, &#123; foo: false, bar: true, &#125;, ]), &#125;,&#125;; å®ç° normalizeClassnormalizeClass 12345678910111213141516171819202122/** æ ¼å¼åŒ–class */function normalizeClass(value) &#123; let res = &quot;&quot;; if (isString(value)) &#123; res = value; &#125; else if (isArray(value)) &#123; // ç±»ä¼¼æ•°ç»„ join(&#x27; &#x27;) for (let i = 0; i &lt; value.length; i++) &#123; const normalized = normalizeClass(value[i]); if (normalized) &#123; res += normalized + &quot; &quot;; &#125; &#125; &#125; else if (isObject(value)) &#123; for (const name in value) &#123; if (value[name]) &#123; res += name + &quot; &quot;; &#125; &#125; &#125; return res.trim();&#125; è®¾ç½® classè®¾ç½® dom class å±æ€§çš„æ–¹å¼æœ‰å¤šç§ï¼ŒsetAttribute, el.className, el.classList å…¶ä¸­el.classNameçš„æ€§èƒ½æœ€å¥½å› æ­¤æˆ‘ä»¬æ”¹ä¹‹æˆ‘ä»¬çš„patchPropsæ–¹æ³• 123456789101112131415/** å°†å±æ€§è®¾ç½®ç›¸å…³çš„æ“ä½œå°è£…åˆ°patchPropsçš„å‡½æ•°ä¸­ï¼Œå¹¶ä½œä¸ºæ¸²æŸ“å™¨é€‰é¡¹ä¼ é€’ */ patchProps(el, key, preValue, nextValue) &#123; // åˆ¤æ–­æ˜¯å¦åº”è¯¥ä½œä¸ºDOM propertiesçš„è®¾ç½® function shouldSetAsProps(el, key, value) &#123; // ... &#125; if (key === &quot;class&quot;) &#123; // â• el.className = nextValue || &quot;&quot;; // â• &#125; else if (shouldSetAsProps(el, key, nextValue)) &#123; // ... &#125; else &#123; // ... &#125; &#125;, å½“ç„¶ style ä¹Ÿæ˜¯ç±»ä¼¼çš„å¤„ç†æ–¹æ¡ˆï¼Œåªä¸è¿‡åœ¨ vue ä¸­è°ƒç”¨çš„æ˜¯normalizeStyleçš„æ–¹æ³• å¸è½½æ“ä½œä¸Šè¿°è¯´åˆ°ï¼Œæˆ‘ä»¬åœ¨ render å‡½æ•°ä¸­ä½¿ç”¨äº† container.innerHTML = &#39;&#39;çš„æ–¹å¼å»æ¸…ç©ºå¸è½½; 123456789101112131415/** æ¸²æŸ“æ–¹æ³• */const render = (vnode, container) =&gt; &#123; if (vnode) &#123; // æ–°çš„nodeå­˜åœ¨çš„æƒ…å†µï¼Œå°†å…¶æ—§çš„vnodeä¸€èµ·ä¼ é€’ç»™patchå‡½æ•°è¿›è¡Œè¡¥ä¸çš„æ›´æ–° patch(container._vnode, vnode, container); &#125; else &#123; if (container._vnode) &#123; // æ—§çš„vnodeå­˜åœ¨ï¼Œæ–°çš„vnodeä¸å­˜åœ¨çš„æƒ…å†µï¼Œè¯´æ˜æ˜¯ä¸€ä¸ª unmountï¼ˆå¸è½½ï¼‰çš„æ“ä½œ // è¿™é‡Œåªéœ€è¦å°†containerå†…domæ¸…ç©ºå°±å¯ä»¥ container.innerHTML = &quot;&quot;; // âœ¨ &#125; &#125; // æ¯ä¸€æ¬¡éƒ½éœ€è¦ä¿å­˜ä¸Šä¸€æ¬¡çš„vnodeï¼Œå­˜å‚¨åœ¨containerä¸‹ container._vnode = vnode;&#125;; è¿™ä¹ˆåšä¸ä¸¥è°¨ï¼ŒåŸå› å¦‚ä¸‹ï¼š å®¹å™¨çš„å†…å®¹å¯èƒ½æ˜¯æŸä¸ªç»„ä»¶æˆ–è€…å¤šä¸ªæ¸²æŸ“çš„ï¼Œåœ¨å¸è½½çš„æ—¶å€™åº”è¯¥å»è§¦å‘ç»„ä»¶ç›¸å…³çš„å¸è½½ç”Ÿå‘½å‘¨æœŸå‡½æ•° è‡ªå®šä¹‰æŒ‡ä»¤ï¼Œæ²¡åŠæ³•æ­£ç¡®æ‰§è¡Œ dom èº«ä¸Šç»‘å®šçš„ä¸€äº›äº‹ä»¶ï¼Œä¸ä¼šè¿›è¡Œç§»é™¤ æ­£ç¡®çš„å¸è½½æ–¹å¼ï¼š æ ¹æ® vnode å¯¹è±¡è·å–å…¶å…³è”çš„çœŸå® dom å…ƒç´  ä½¿ç”¨åŸç”Ÿçš„ dom ç§»é™¤æ“ä½œå°†å…¶ç§»é™¤ å»ºç«‹ dom ä¸ vnode è”ç³»è¦æƒ³æ ¹æ® vnode å¯¹è±¡è·å–å…¶å…³è”çš„çœŸå® dom å…ƒç´ ï¼Œé¦–å…ˆå¿…é¡»è¦å…ˆå»ºç«‹è”ç³» åœ¨æŒ‚è½½é˜¶æ®µæˆ‘ä»¬åˆ©ç”¨ createElementåˆ›å»ºäº†çœŸå®çš„ domï¼Œä¹‹åå°†å…¶ç»‘å®šåœ¨ vnode ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥å°† vNode å’ŒçœŸå® dom ä¹‹é—´çš„è”ç³»å»ºç«‹èµ·æ¥ 123456789101112131415161718192021/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */function mountElement(vnode, container) &#123; // åˆ›å»ºdomå…ƒç´  const el = createElement(vnode.type); console.log(el); vnode.el = el; // å°†å…¶åˆ›å»ºå‡ºæ¥çš„domæ·»åŠ åˆ°vnodeä¸Šï¼Œå»ºç«‹è”ç³» â• //å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹ if (typeof vnode.children === &quot;string&quot;) &#123; // ... &#125; else if (Array.isArray(vnode.children)) &#123; // ... &#125; // å¤„ç†props, å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œå¤„ç† if (vnode.props) &#123; // ... &#125; // å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­ insert(el, container);&#125; æ”¹é€  render å‡½æ•°12345678910111213141516171819/** æ¸²æŸ“æ–¹æ³• */const render = (vnode, container) =&gt; &#123; if (vnode) &#123; // æ–°çš„nodeå­˜åœ¨çš„æƒ…å†µï¼Œå°†å…¶æ—§çš„vnodeä¸€èµ·ä¼ é€’ç»™patchå‡½æ•°è¿›è¡Œè¡¥ä¸çš„æ›´æ–° patch(container._vnode, vnode, container); &#125; else &#123; if (container._vnode) &#123; // æ—§çš„vnodeå­˜åœ¨ï¼Œæ–°çš„vnodeä¸å­˜åœ¨çš„æƒ…å†µï¼Œè¯´æ˜æ˜¯ä¸€ä¸ª unmountï¼ˆå¸è½½ï¼‰çš„æ“ä½œ // æ ¹æ®vnodeè·å–è¦å¸è½½çš„çœŸå®domå…ƒç´  const el = container._vnode.el; // â• // è·å–elçš„çˆ¶çº§å…ƒç´  const parent = el.parentNode; // â• // è°ƒç”¨removeChildåˆ é™¤å…ƒç´  if (parent) parent.removeChild(el); // â• &#125; &#125; // æ¯ä¸€æ¬¡éƒ½éœ€è¦ä¿å­˜ä¸Šä¸€æ¬¡çš„vnodeï¼Œå­˜å‚¨åœ¨containerä¸‹ container._vnode = vnode;&#125;; å…¶ä¸­çš„ container._vnode ä»£è¡¨çš„å°±æ˜¯æ—§çš„ vnodeï¼ˆå³å°†è¦è¢«å¸è½½çš„ï¼‰ï¼Œç”±äºæˆ‘ä»¬ä¹‹å‰ç»‘å®šä¸Šäº†ç›¸å…³çš„ dom åœ¨ vnode ä¸Šï¼Œå°±å¯ä»¥è°ƒç”¨å…¶çˆ¶çº§çš„ç§»é™¤å…ƒç´ çš„æ“ä½œ å°è£… unmountå°†ä¸Šè¿°çš„å¸è½½æ“ä½œå°è£…æˆä¸€ä¸ª unmount çš„å‡½æ•°ï¼Œæ–¹ä¾¿åç»­åŠŸèƒ½å¢åŠ  unmount 123456789/** å¸è½½æ“ä½œ */function unmount(vnode) &#123; // æ ¹æ®vnodeè·å–è¦å¸è½½çš„çœŸå®domå…ƒç´  // è·å–elçš„çˆ¶çº§å…ƒç´  const parent = vnode.el.parentNode; if (parent) &#123; parent.removeChild(vnode.el); &#125;&#125; render 12345678910111213const render = (vnode, container) =&gt; &#123; if (vnode) &#123; // æ–°çš„nodeå­˜åœ¨çš„æƒ…å†µï¼Œå°†å…¶æ—§çš„vnodeä¸€èµ·ä¼ é€’ç»™patchå‡½æ•°è¿›è¡Œè¡¥ä¸çš„æ›´æ–° patch(container._vnode, vnode, container); &#125; else &#123; if (container._vnode) &#123; // æ—§çš„vnodeå­˜åœ¨ï¼Œæ–°çš„vnodeä¸å­˜åœ¨çš„æƒ…å†µï¼Œè¯´æ˜æ˜¯ä¸€ä¸ª unmountï¼ˆå¸è½½ï¼‰çš„æ“ä½œ unmount(container._vnode); // â• &#125; &#125; // æ¯ä¸€æ¬¡éƒ½éœ€è¦ä¿å­˜ä¸Šä¸€æ¬¡çš„vnodeï¼Œå­˜å‚¨åœ¨containerä¸‹ container._vnode = vnode;&#125;; åŒºåˆ† vnode ç±»å‹åœ¨ render å‡½æ•°ä¸­ï¼Œvnode å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œä¼šå°†è€çš„ vnode å’Œæ–°çš„ vnode éƒ½ä¼ é€’ç»™ patch å‡½æ•°å»åšä¸€ä¸ªæ›´æ–°ï¼Œå½“ç„¶æ˜¯æˆ‘ä»¬çš„ node çš„ç±»å‹éƒ½æ˜¯ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ‰æœ‰å»åšæ¯”è¾ƒçš„æ„ä¹‰ã€‚ æ¯”å¦‚ï¼š 12const vnode = &#123; type: &quot;p&quot; &#125;; //ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼šconst vnode = &#123; type: &quot;input&quot; &#125;; // ç¬¬äºŒæ¬¡æ¸²æŸ“ è¿™ç§æƒ…å†µå°±æ²¡æœ‰å¯¹æ¯”æ›´æ–°çš„ä¸€ä¸ªå¿…è¦äº†ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼š å…ˆå»å¸è½½ p å…ƒç´  å†å°† input æŒ‚è½½åˆ°å®¹å™¨ä¸­ å› æ­¤æˆ‘ä»¬éœ€è¦æ”¹é€  patch çš„ä»£ç  12345678910111213141516/** æ›´æ–°å¯¹æ¯”, å¹¶ä¸”åšæŒ‚è½½ç›¸å…³çš„åŠŸèƒ½ */function patch(n1, n2, container) &#123; // n1è€èŠ‚ç‚¹å­˜åœ¨ï¼Œå¯¹æ¯”n1å’Œn2çš„ç±»å‹ if (n1 &amp;&amp; n1.type !== n2.type) &#123; // â• // å¦‚æœæ–°æ—§vnodeçš„ç±»å‹ä¸åŒï¼Œåˆ™ç›´æ¥å°†æ—§çš„vnodeå¸è½½ unmount(n1); // â• n1 = null; // â• &#125; // å¦‚æœä¸å­˜åœ¨ if (!n1) &#123; mountElement(n2, container); &#125; else &#123; // n1å­˜åœ¨çš„æƒ…å†µä¸‹é¢ï¼Œæˆ‘ä»¬è¿›è¡Œæ›´æ–°ï¼ˆæ‰“è¡¥ä¸ï¼‰ &#125;&#125; è¿™ç§æƒ…å†µéƒ½æ˜¯ vnode ä¸ºæ™®é€šæ ‡ç­¾å…ƒç´ çš„ç±»å‹æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç¨å¾®æ”¹é€ ä¸€äº›å¯¹ç»„ä»¶ç±»å‹ç­‰ç­‰çš„æ”¯æŒ 1234567891011121314151617181920212223242526/** æ›´æ–°å¯¹æ¯”, å¹¶ä¸”åšæŒ‚è½½ç›¸å…³çš„åŠŸèƒ½ */function patch(n1, n2, container) &#123; // n1è€èŠ‚ç‚¹å­˜åœ¨ï¼Œå¯¹æ¯”n1å’Œn2çš„ç±»å‹ if (n1 &amp;&amp; n1.type !== n2.type) &#123; // å¦‚æœæ–°æ—§vnodeçš„ç±»å‹ä¸åŒï¼Œåˆ™ç›´æ¥å°†æ—§çš„vnodeå¸è½½ unmount(n1); n1 = null; &#125; const &#123; type &#125; = n2; if (typeof type === &quot;string&quot;) &#123; // è¯´æ˜æ˜¯æ™®é€šçš„æ ‡ç­¾å…ƒç´  if (!n1) &#123; // å¦‚æœä¸å­˜åœ¨, å°±è¿›è¡ŒæŒ‚è½½ mountElement(n2, container); &#125; else &#123; // n1å­˜åœ¨çš„æƒ…å†µä¸‹é¢ï¼Œæˆ‘ä»¬è¿›è¡Œæ›´æ–°ï¼ˆæ‰“è¡¥ä¸ï¼‰ patchElement(n1, n2); &#125; &#125; else if (typeof type === &quot;object&quot;) &#123; // ç»„ä»¶ &#125; else &#123; // å…¶ä»– &#125;&#125; äº‹ä»¶å¤„ç†é¦–å…ˆæˆ‘ä»¬è¦åœ¨ vnode ä¸­å»æè¿°äº‹ä»¶ï¼Œå‡å®šä¸€ä¸ªè§„åˆ™ï¼Œä»¥å­—ç¬¦ä¸² on å¼€å¤´çš„éƒ½è§†ä½œäº‹ä»¶ 1234567const vnode = &#123; type: &quot;p&quot;, props: &#123; onClick: () =&gt; &#123;&#125;, &#125;, children: &quot;text&quot;,&#125;; ç»‘å®šäº‹ä»¶å’Œæ›´æ–°äº‹ä»¶ç»‘å®šå’Œæ›´æ–°æˆ‘ä»¬å°±éœ€è¦åœ¨ patchProps å‡½æ•°ä¸­åšç›¸å…³çš„å¤„ç† 123456789101112131415161718/** å°†å±æ€§è®¾ç½®ç›¸å…³çš„æ“ä½œå°è£…åˆ°patchPropsçš„å‡½æ•°ä¸­ï¼Œå¹¶ä½œä¸ºæ¸²æŸ“å™¨é€‰é¡¹ä¼ é€’ */ patchProps(el, key, preValue, nextValue) &#123; // åŒ¹é…äº‹ä»¶ï¼Œä»¥onå¼€å¤´ if (/^on/.test(key)) &#123; // â• // æ ¹æ®å±æ€§åç§°å¾—åˆ°å¯¹åº”çš„äº‹ä»¶åç§° const name = key.slice(2).toLowerCase(); // â• // ç§»é™¤ä¸Šä¸€æ¬¡ç»‘å®šçš„äº‹ä»¶å¤„ç†å‡½æ•° prevValue &amp;&amp; el.removeEventListener(name, prevValue); // â• // ç»‘å®šäº‹ä»¶, nextvalueä¸ºäº‹ä»¶å‡½æ•° el.addEventListener(name, nextValue); // â• &#125; else if (key === &quot;class&quot;) &#123; // ... &#125; else if (shouldSetAsProps(el, key, nextValue)) &#123; // ... &#125; else &#123; // ... &#125; &#125; æŒ‰å¦‚ä¸Šçš„é€»è¾‘ï¼Œå°±æ˜¯ç›¸å½“äºæ¯æ¬¡æ›´æ–°éƒ½è¦å»ç§»é™¤ä¹‹å‰ç»‘å®šçš„å‡½æ•°ï¼Œç„¶åå†å¯¹æ–°çš„å€¼é‡æ–°è¿›è¡Œç›‘å¬ã€‚ä½†æ˜¯è¿™ä¹ˆåšæ€§èƒ½å¹¶ä¸æ˜¯æœ€ä¼˜çš„ã€‚ æˆ‘ä»¬å¯ä»¥ç»‘å®šä¸€ä¸ªä¼ªé€ çš„äº‹ä»¶å¤„ç†å‡½æ•° invokerï¼Œç„¶åæŠŠçœŸæ­£çš„äº‹ä»¶å¤„ç†å‡½æ•°è®¾ç½®ä¸º invoker.valueï¼Œåç»­æ›´æ–°å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ–° invoker.value å€¼å°±å¯ä»¥ 1234567891011121314151617181920212223242526272829303132333435363738394041424344/** å°†å±æ€§è®¾ç½®ç›¸å…³çš„æ“ä½œå°è£…åˆ°patchPropsçš„å‡½æ•°ä¸­ï¼Œå¹¶ä½œä¸ºæ¸²æŸ“å™¨é€‰é¡¹ä¼ é€’ */function patchProps(el, key, prevValue, nextValue) &#123; // åŒ¹é…äº‹ä»¶ï¼Œä»¥onå¼€å¤´ if (/^on/.test(key)) &#123; // å®šä¹‰el.veiä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå­˜åœ¨äº‹ä»¶åç§°åˆ°äº‹ä»¶å¤„ç†å‡½æ•°çš„æ˜ å°„ const invokers = el._vei || (el._vei = &#123;&#125;); // è·å–è¯¥å…ƒç´ ä¼ªé€ çš„äº‹ä»¶å¤„ç†å‡½æ•°, æ ¹æ®key let invoker = invokers[key]; // æ ¹æ®å±æ€§åç§°å¾—åˆ°å¯¹åº”çš„äº‹ä»¶åç§° const name = key.slice(2).toLowerCase(); if (nextValue) &#123; if (!invoker) &#123; // å¦‚æœæ²¡æœ‰invokerï¼Œä¸ºé¦–æ¬¡ç›‘å¬ï¼Œåˆ™å»ä¼ªé€ ä¸€ä¸ªç¼“å­˜åˆ°el.veiä¸­ invoker = el._vei[key] = (e) =&gt; &#123; // å¦‚æœinvokeræ˜¯æ•°ç»„çš„æƒ…å†µï¼Œéœ€è¦éå†æ‰§è¡Œ if (Array.isArray(invoker.value)) &#123; invoker.value.forEach((fn) =&gt; fn(e)); &#125; else &#123; // è¿™é‡Œæ‰æ˜¯å¤„ç†çœŸæ­£çš„äº‹ä»¶å‡½æ•° invoker.value(e); &#125; &#125;; // èµ‹å€¼äº‹ä»¶å¤„ç†å‡½æ•°åˆ°invokerçš„valueä¸Š invoker.value = nextValue; // ç»‘å®šinvoker el.addEventListener(name, invoker); &#125; else &#123; // å­˜åœ¨invokerè¯´æ˜æ˜¯æ›´æ–°ï¼Œåªéœ€è¦æ›´æ–°invoker.valueå€¼å°±è¡Œ invoker.value = nextValue; &#125; &#125; else if (invoker) &#123; // æ–°çš„äº‹ä»¶å‡½æ•°ä¸å­˜åœ¨ï¼Œéœ€è¦é”€æ¯invoker el.removeEventListener(name, invoker); &#125; &#125; else if (key === &quot;class&quot;) &#123; // ... &#125; else if (shouldSetAsProps(el, key, nextValue)) &#123; // .... &#125; else &#123; // ... &#125;&#125; invokersï¼šå­˜äº‹ä»¶åç§°ä¸å¯¹åº”å‡½æ•°çš„æ˜ å°„ el._veiï¼švue event invokerï¼Œåœ¨ el ä¸Šç¼“å­˜ invoker æ›´æ–°å±æ€§ä»¥åŠå­èŠ‚ç‚¹ æ›´æ–°å¿…å®šæ¶‰åŠåˆ°æ•´ä¸ª vnode ä¸Šé¢çš„å±æ€§çš„å˜åŒ–ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹çš„å±æ€§ä»¥åŠèŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„å˜åŒ– å…ƒç´ çš„æŒ‚è½½æ˜¯ç”± mountElement è§¦å‘çš„ 12345678910111213141516171819202122232425262728/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */function mountElement(vnode, container) &#123; // åˆ›å»ºdomå…ƒç´  const el = createElement(vnode.type); console.log(el); vnode.el = el; // å°†å…¶åˆ›å»ºå‡ºæ¥çš„domæ·»åŠ åˆ°vnodeä¸Šï¼Œå»ºç«‹è”ç³» //å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹ if (typeof vnode.children === &quot;string&quot;) &#123; // åªéœ€è¦è®¾ç½®å…ƒç´ çš„textContentçš„å±æ€§å³å¯ setElementText(el, vnode.children); &#125; else if (Array.isArray(vnode.children)) &#123; // å¦‚æœchildrenæ˜¯æ•°ç»„ï¼Œåˆ™ä¾¿éå†æ¯ä¸€ä¸ªå­—èŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨patchçš„æ–¹æ³• vnode.children.forEach((child) =&gt; &#123; patch(null, child, el); &#125;); &#125; // å¤„ç†props, å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œå¤„ç† if (vnode.props) &#123; // éå† for (const key in vnode.props) &#123; patchProps(el, key, null, vnode.props[key]); &#125; &#125; // å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­ insert(el, container);&#125; åœ¨æŒ‚è½½å­èŠ‚ç‚¹çš„æ—¶å€™ï¼Œé¦–å…ˆæœ‰ä¸¤ç§çš„ç±»å‹çš„åŒºåˆ† å­—ç¬¦ä¸²ï¼šå…·æœ‰æ–‡æœ¬çš„å­èŠ‚ç‚¹ æ•°ç»„ï¼šå¤šä¸ªå­èŠ‚ç‚¹ æ€»çš„æ¥è¯´ï¼Œå­èŠ‚ç‚¹åˆ†ä¸º 3 ç§ç±»å‹ï¼š æ²¡æœ‰å­èŠ‚ç‚¹çš„æƒ…å†µ 1234vnode = &#123; type: &quot;div&quot;, children: null,&#125;; å­—ç¬¦ä¸²çš„æƒ…å†µ 1234vnode = &#123; type: &quot;div&quot;, children: &quot;222&quot;,&#125;; æ•°ç»„çš„æƒ…å†µ 1234vnode = &#123; type: &quot;div&quot;, children: [&quot;111&quot;, &#123; type: &quot;p&quot; &#125;],&#125;; å¯¹åº”åˆ°æ›´æ–°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯¹åº”çš„æ–°æ—§èŠ‚ç‚¹éƒ½åˆ†åˆ«æ˜¯ 3 ç§æƒ…å†µ æ¥ä¸‹æ¥æˆ‘ä»¬å»å®ç° patchElementå‡½æ•° n1: æ—§ vnode n2: æ–° vnode å®ç°æ­¥éª¤ é¦–å…ˆæˆ‘ä»¬å»æ›´æ–°ä»–ä»¬çš„ props çš„å˜åŒ–ï¼Œè°ƒç”¨ä¹‹å‰å°è£…å¥½çš„ patchProps å‡½æ•°åšæ›´æ–°å˜åŒ– ä¹‹åå»æ›´æ–°ä»–ä»¬çš„ childrenï¼Œè¿™é‡Œè¦å¯¹ä»¥ä¸Š 9 ç§çš„æƒ…å†µè¿›è¡Œè¦†ç›–ã€‚ å®ç° props å˜åŒ–æ›´æ–°å®ç° props çš„æ›´æ–° ä»æ–°çš„ props å‚æ•°ä¸­æ‰¾å‡ºæ—§çš„ props ä¸­ä¸ä¹‹å¯¹åº”çš„ key valueï¼Œè°ƒç”¨ pacthProps æ–¹æ³•å¯¹ dom å…ƒç´ è¿›è¡Œå¯¹æ¯”æ›´æ–° ä»æ—§çš„ props ä¸­æ‰¾å‡ºä¸å­˜åœ¨æ–° props ä¸­çš„å±æ€§ï¼Œè°ƒç”¨ pacthProps çš„æ–¹æ³•è¿›è¡Œ dom å±æ€§çš„å¸è½½ 123456789101112131415161718192021/** æ›´æ–°å­èŠ‚ç‚¹ */function pacthElement(n1, n2) &#123; n2.el = n1.el; const el = n2.el; const &#123; props: oldProps &#125; = n1; const &#123; props: newProps &#125; = n2; // step 1 æ›´æ–°props for (const key in newProps) &#123; if (newProps[key] !== oldProps[key]) &#123; patchProps(el, key, oldProps[key], newProps[key]); &#125; &#125; for (const key in oldProps) &#123; if (!(key in newProps)) &#123; patchProps(el, key, oldProps[key], null); &#125; &#125; // step 2ï¼šæ›´æ–°children pacthChildren(n1, n2, el);&#125; é¡ºæ‰‹æ”¹é€  patchProps å‡½æ•°æˆ‘ä»¬ä¾æ® patchProps çš„å„ä¸ªåˆ†æ”¯ï¼Œå»ç›¸å¯¹åº”å°è£…æˆ‘ä»¬çš„æ›´æ–°æ–¹æ³• æœ€ç»ˆçš„æ”¹é€ å¦‚ä¸‹ 12345678910111213141516// æ¯”å¯¹propsåšæ›´æ–°const patchProp = (el, key, prevValue, nextValue) =&gt; &#123; if (key === &quot;class&quot;) &#123; // classçš„å¤„ç† patchClass(el, nextValue); &#125; else if (key === &quot;style&quot;) &#123; // styleçš„å¤„ç† patchStyle(el, prevValue, nextValue); &#125; else if (/^on[^a-z]/.test(key)) &#123; // äº‹ä»¶çš„å¤„ç† patchEvent(el, key, nextValue); &#125; else &#123; // å…¶ä»–å±æ€§çš„å¤„ç† patchAttr(el, key, nextValue); &#125;&#125;; æ“ä½œ class æ›´æ–°123456789/** æ¯”å¯¹classå±æ€§ */function patchClass(el, value) &#123; // æ ¹æ®æœ€æ–°å€¼è®¾ç½®ç±»å if (value == null) &#123; el.removeAttribute(&quot;class&quot;); &#125; else &#123; el.className = value; &#125;&#125; æ“ä½œæ ·å¼çš„æ›´æ–°1234567891011121314151617/** æ¯”å¯¹classå±æ€§ */function patchStyle(el, prev, next) &#123; // æ›´æ–°style const style = el.style; for (const key in next) &#123; // ç”¨æœ€æ–°çš„ç›´æ¥è¦†ç›– style[key] = next[key]; &#125; if (prev) &#123; for (const key in prev) &#123; // è€çš„æœ‰æ–°çš„æ²¡æœ‰åˆ é™¤ if (next[key] == null) &#123; style[key] = null; &#125; &#125; &#125;&#125; æ“ä½œäº‹ä»¶çš„æ›´æ–°1234567891011121314151617181920212223242526/** åˆ›å»ºä¸€ä¸ªinvoker */function createInvoker(initialValue) &#123; const invoker = (e) =&gt; invoker.value(e); invoker.value = initialValue; return invoker;&#125;/** æ¯”å¯¹äº‹ä»¶æ›´æ–° */function patchEvent(el, rawName, nextValue) &#123; // æ›´æ–°äº‹ä»¶ const invokers = el._vei || (el._vei = &#123;&#125;); const exisitingInvoker = invokers[rawName]; // æ˜¯å¦ç¼“å­˜è¿‡ if (nextValue &amp;&amp; exisitingInvoker) &#123; exisitingInvoker.value = nextValue; &#125; else &#123; const name = rawName.slice(2).toLowerCase(); // è½¬åŒ–äº‹ä»¶æ˜¯å°å†™çš„ if (nextValue) &#123; // ç¼“å­˜å‡½æ•° const invoker = (invokers[rawName] = createInvoker(nextValue)); el.addEventListener(name, invoker); &#125; else if (exisitingInvoker) &#123; el.removeEventListener(name, exisitingInvoker); invokers[rawName] = undefined; &#125; &#125;&#125; æ“ä½œå±æ€§çš„æ›´æ–°12345678910111213141516171819202122/** æ¯”å¯¹dom propertiesæˆ–è€…æ˜¯html attributes */function patchAttr(el, key, value) &#123; // æ›´æ–°å±æ€§ if (value == null) &#123; // å¦‚æœå€¼ä¸å­˜åœ¨ï¼Œè¯´æ˜æ˜¯å¸è½½propsçš„æ“ä½œ el.removeAttribute(key); &#125; else &#123; if (shouldSetAsProps(el, key, nextValue)) &#123; // dom propertieså­˜åœ¨çš„æƒ…å†µ // è·å–è¿™ä¸ªDOM propertieså…ƒç´ çš„å±æ€§ç±»å‹ const type = typeof el[key]; // å¦‚æœåŸç”Ÿå±æ€§ç±»å‹ä¸ºå¸ƒå°”ç±»å‹ï¼Œå¹¶ä¸”valueæ˜¯ç©ºçš„å­—ç¬¦ä¸²çš„è¯ï¼Œç»™ä»–å€¼çŸ«æ­£ä¸ºtrue if (type === &quot;boolean&quot; &amp;&amp; nextValue === &quot;&quot;) &#123; el[key] = true; &#125; else &#123; el[key] = nextValue; &#125; &#125; else &#123; el.setAttribute(key, value); &#125; &#125; &#125; æ›´æ–° children èŠ‚ç‚¹å¯¹ç…§ä»¥ä¸Š 3*3 çš„èŠ‚ç‚¹æƒ…å†µ 1. æ–°å­èŠ‚ç‚¹æ˜¯æ–‡æœ¬èŠ‚ç‚¹123456789101112/** æ›´æ–°children */function pacthChildren(n1, n2, container) &#123; // åˆ¤æ–­æ–°å­èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦æ˜¯æ–‡æœ¬èŠ‚ç‚¹ if (typeof n2.children === &quot;string&quot;) &#123; // å½“æ–°èŠ‚ç‚¹ä¸ºæ–‡æœ¬èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¦‚æœæ—§èŠ‚ç‚¹æ˜¯ä¸€ç»„å­çš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦é€ä¸ªå»å¸è½½ï¼Œå…¶ä»–æƒ…å†µå•¥ä¹Ÿä¸åš if (Array.isArray(n1.children)) &#123; n1.children.forEach((node) =&gt; unmount(node)); &#125; // æœ€åè®¾ç½®æ–°çš„èŠ‚ç‚¹å†…å®¹ setElementText(container, n2.children); &#125;&#125; 2. æ–°å­èŠ‚ç‚¹æ˜¯ä¸€ç»„123456789101112131415161718/** æ›´æ–°children */function pacthChildren(n1, n2, container) &#123; // åˆ¤æ–­æ–°å­èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦æ˜¯æ–‡æœ¬èŠ‚ç‚¹ if (typeof n2.children === &quot;string&quot;) &#123; // ... &#125; else if (Array.isArray(n2.children)) &#123; // å½“æ–°çš„å­èŠ‚ç‚¹æ˜¯ä¸€ç»„ // æˆ‘ä»¬åˆ¤æ–­æ—§çš„å­èŠ‚ç‚¹æ˜¯å¦ä¹Ÿæ˜¯ä¸€ç»„ if (Array.isArray(n1.children)) &#123; // diffç®—æ³• todo &#125; else &#123; // åˆ°è¿™é‡Œï¼Œå­˜åœ¨ä¸¤ç§æƒ…å†µï¼Œè¦ä¹ˆæ˜¯æ–‡æœ¬èŠ‚ç‚¹è¦ä¹ˆæ—  // ä»€ä¹ˆæƒ…å†µä¸‹éƒ½å»æ¸…ç©ºï¼Œç„¶åå°†ä¸€ç»„æ–°çš„å­èŠ‚ç‚¹æ·»åŠ è¿›æ¥ setElementText(container, &quot;&quot;); n2.children.forEach((node) =&gt; patch(null, node, container)); &#125; &#125;&#125; diff ç®—æ³•ï¼Œç›®å‰å…ˆç”¨å‚»ç“œé€»è¾‘å®ç°ï¼Œå…¨éƒ¨å¸è½½ç„¶åå†å…¨éƒ¨æŒ‚è½½ 12n1.children.forEach((node) =&gt; unmount(node));n2.children.forEach((node) =&gt; patch(null, node, container)); 3. æ–°å­èŠ‚ç‚¹å•¥ä¹Ÿæ²¡æœ‰123456789101112131415161718192021222324/** æ›´æ–°children */function pacthChildren(n1, n2, container) &#123; // åˆ¤æ–­æ–°å­èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦æ˜¯æ–‡æœ¬èŠ‚ç‚¹ if (typeof n2.children === &quot;string&quot;) &#123; // å½“æ–°èŠ‚ç‚¹ä¸ºæ–‡æœ¬èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¦‚æœæ—§èŠ‚ç‚¹æ˜¯ä¸€ç»„å­çš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦é€ä¸ªå»å¸è½½ï¼Œå…¶ä»–æƒ…å†µå•¥ä¹Ÿä¸åš if (Array.isArray(n1.children)) &#123; n1.children.forEach((node) =&gt; unmount(node)); &#125; // æœ€åè®¾ç½®æ–°çš„èŠ‚ç‚¹å†…å®¹ setElementText(container, n2.children); &#125; else if (Array.isArray(n2.children)) &#123; // .... &#125; else &#123; // åˆ°è¿™é‡Œï¼Œè¯´æ˜æ–°çš„å­èŠ‚ç‚¹ä¸å­˜åœ¨ // å¦‚æœæ—§çš„èŠ‚ç‚¹æ˜¯ä¸€ç»„å­èŠ‚ç‚¹ï¼Œåªéœ€è¦é€ä¸ªå¸è½½å°±å¯ä»¥ if (Array.isArray(n1.children)) &#123; n1.children.forEach((node) =&gt; unmount(node)); &#125; else if (typeof n1.children === &quot;string&quot;) &#123; // æ—§èŠ‚ç‚¹æ˜¯æ–‡æœ¬ï¼Œæ¸…ç©º setElementText(container, &quot;&quot;); &#125; // å…¶ä»–æƒ…å†µä¸ç”¨ç®¡ &#125;&#125; ç‰¹æ®ŠèŠ‚ç‚¹ç±»å‹ä¸€èˆ¬æˆ‘ä»¬ç”¨ vnode æè¿°èŠ‚ç‚¹ï¼Œéƒ½æ˜¯ç”¨ type å»æè¿°èŠ‚ç‚¹ç±»å‹ ä½†æ˜¯ åƒ æ–‡æœ¬èŠ‚ç‚¹ æ³¨é‡ŠèŠ‚ç‚¹ ä»¥åŠ vue3 çš„ fragmentï¼Œéƒ½è¾ƒä¸ºç‰¹æ®Š 1234&lt;Fragment&gt; &lt;!-- æ³¨é‡ŠèŠ‚ç‚¹ --&gt; æ–‡æœ¬èŠ‚ç‚¹&lt;/Fragment&gt; æ–‡æœ¬èŠ‚ç‚¹å’Œæ³¨é‡ŠèŠ‚ç‚¹å¤„ç†è¿™ä¸¤è€…å¯¹äºæ™®é€šæ ‡ç­¾èŠ‚ç‚¹æ¥è¯´ï¼Œä¸å…·å¤‡æ ‡ç­¾åç§°ï¼Œæ‰€ä»¥éœ€è¦æ¡†æ¶è®¤ä¸ºçš„å»åˆ›é€ ä¸€äº›å”¯ä¸€çš„æ ‡è¯†ï¼Œå¹¶ä¸”å°†å…¶ä½œä¸ºæ³¨é‡ŠèŠ‚ç‚¹å’Œæ–‡æœ¬èŠ‚ç‚¹çš„ type æè¿°æ–‡æœ¬å’Œæ³¨é‡ŠèŠ‚ç‚¹ï¼š 123456789101112// åŠ å…¥äººä¸ºçš„æ–‡æœ¬èŠ‚ç‚¹æ ‡è¯†const Text = Symbol();const newVnode = &#123; type: Text, children: &quot;æ–‡æœ¬èŠ‚ç‚¹&quot;,&#125;;// åŠ å…¥äººä¸ºçš„æ³¨é‡ŠèŠ‚ç‚¹æ ‡è¯†const Comment = Symbol();const newVnode = &#123; type: Comment, children: &quot;æ³¨é‡Šçš„èŠ‚ç‚¹&quot;,&#125;; åŠ å…¥ä¸¤è€…ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨ patch ä¸­å»åšç›¸å…³çš„æ”¹é€  123456789101112131415161718192021222324252627282930/** æ›´æ–°å¯¹æ¯”, å¹¶ä¸”åšæŒ‚è½½ç›¸å…³çš„åŠŸèƒ½ */ function patch(n1, n2, container) &#123; // n1è€èŠ‚ç‚¹å­˜åœ¨ï¼Œå¯¹æ¯”n1å’Œn2çš„ç±»å‹ if (n1 &amp;&amp; n1.type !== n2.type) &#123; // å¦‚æœæ–°æ—§vnodeçš„ç±»å‹ä¸åŒï¼Œåˆ™ç›´æ¥å°†æ—§çš„vnodeå¸è½½ unmount(n1); n1 = null; &#125; const &#123; type &#125; = n2; if (typeof type === &quot;string&quot;) &#123; // .... &#125; else if (typeof type === &quot;object&quot;) &#123; // ç»„ä»¶ &#125; else if (type === Text) &#123; // æ–‡æœ¬æ ‡ç­¾ if (!n1) &#123; // ä½¿ç”¨åŸç”ŸcreateTextNodeå»åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹ const el = (n2.el = document.createTextNode(n2.children)); // å°†æ–‡æœ¬èŠ‚ç‚¹æ’å…¥åˆ°å®¹å™¨ä¸­ insert(el, container); &#125; else &#123; // å¦‚æœæ—§çš„vnodeå­˜åœ¨ï¼Œåªéœ€è¦ä½¿ç”¨å¿ƒå¾—æ–‡æœ¬èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹æ›´æ–°æ—§æ–‡æœ¬èŠ‚ç‚¹å°±å¯ä»¥äº† const el = (n2.el = n1.el); if (n2.children !== n1.children) &#123; el.nodeValue = n2.children; &#125; &#125; &#125; å½“ç„¶ä¸Šè¿°ç”¨åˆ°äº†ç›¸å…³æµè§ˆå™¨çš„ api æˆ‘ä»¬éœ€è¦ç»™ä»–æå–å‡ºæ¥document.createTextNodeä»¥åŠel.nodeValue 12345678910111213141516171819202122232425262728293031323334/** æµè§ˆå™¨ç«¯çš„ç›¸å…³api */const BROWSER_APIS = &#123; // ç”¨äºåˆ›å»ºå…ƒç´  createElement(tag) &#123; // ... &#125;, /** ç”¨äºè®¾ç½®å…ƒç´ çš„æ–‡æœ¬èŠ‚ç‚¹ */ setElementText(el, text) &#123; // ... &#125;, /** ç»™ç‰¹å®šçš„parentä¸‹æ·»åŠ æŒ‡å®šçš„å…ƒç´  */ insert(el, parent, anchor = null) &#123; // ... &#125;, /** åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹ */ createText(text) &#123; // â• return document.createTextNode(text); &#125;, /** è®¾ç½®æ–‡æœ¬å€¼ */ setText(el, text) &#123; // â• el.nodeValue = text; &#125;, /** å°†å±æ€§è®¾ç½®ç›¸å…³çš„æ“ä½œå°è£…åˆ°patchPropsçš„å‡½æ•°ä¸­ï¼Œå¹¶ä½œä¸ºæ¸²æŸ“å™¨é€‰é¡¹ä¼ é€’ */ patchProps(el, key, prevValue, nextValue) &#123; // ... &#125;,&#125;; å¤„ç†æ³¨é‡Šçš„èŠ‚ç‚¹å’Œå…¶ç±»ä¼¼ï¼Œè°ƒç”¨åŸç”Ÿçš„ document.createCommentå‡½æ•°æ¥åˆ›å»ºå³å¯ FragmentFragment å’Œ tex ä»¥åŠæ³¨é‡Šç±»ä¼¼ï¼Œtype ä¹Ÿéœ€è¦äººä¸ºåŠ å…¥æ ‡è¯† 1const Fragment = Symbol(); åœ¨é¡¹ç›®ä¸­ç»å¸¸ä¼šæœ‰ç±»ä¼¼è¿™æ ·çš„ vNodeï¼Œ 123456789101112131415161718const vNode = &#123; type: &quot;ul&quot;, children: [ &#123; type: Fragment, children: [ &#123; type: &quot;li&quot;, children: &quot;1&quot;, &#125;, &#123; type: &quot;li&quot;, children: &quot;2&quot;, &#125;, ], &#125;, ],&#125;; ç”±äº Fragment æœ¬èº«æ˜¯ä¸å±äºä¸€ä¸ªçœŸæ­£çš„èŠ‚ç‚¹çš„ï¼Œæ‰€ä»¥åœ¨åšæ¸²æŸ“çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦æ¸²æŸ“å®ƒçš„å­èŠ‚ç‚¹å°±å¯ä»¥äº† å› æ­¤æˆ‘ä»¬æ”¹é€  patch å‡½æ•° 12345678910111213141516171819202122232425262728/** æ›´æ–°å¯¹æ¯”, å¹¶ä¸”åšæŒ‚è½½ç›¸å…³çš„åŠŸèƒ½ */function patch(n1, n2, container) &#123; // n1è€èŠ‚ç‚¹å­˜åœ¨ï¼Œå¯¹æ¯”n1å’Œn2çš„ç±»å‹ if (n1 &amp;&amp; n1.type !== n2.type) &#123; // å¦‚æœæ–°æ—§vnodeçš„ç±»å‹ä¸åŒï¼Œåˆ™ç›´æ¥å°†æ—§çš„vnodeå¸è½½ unmount(n1); n1 = null; &#125; const &#123; type &#125; = n2; if (typeof type === &quot;string&quot;) &#123; // ... &#125; else if (typeof type === &quot;object&quot;) &#123; // ç»„ä»¶ &#125; else if (type === Text) &#123; // ... &#125; else if (type === Fragment) &#123; // å¦‚æœæ˜¯ ç‰‡æ®µèŠ‚ç‚¹ if (!n1) &#123; // å¦‚æœä¸å­˜åœ¨æ—§èŠ‚ç‚¹çš„è¯ï¼Œåªéœ€è¦å°†Fragmentçš„childrené€ä¸ªæŒ‚è½½å°±å¯ä»¥ n2.children.forEach((node) =&gt; patch(null, node, container)); &#125; else &#123; // å¦‚æœæ—§çš„vnodeå­˜åœ¨çš„è¯ï¼Œ åˆ™åªéœ€è¦æ›´æ–°fragmentçš„childrenå°±å¯ä»¥ pacthChildren(n1, n2, container); &#125; &#125;&#125; å¹¶ä¸”å¯¹äºæˆ‘ä»¬åœ¨å¸è½½çš„æ—¶å€™ï¼Œä¹Ÿè¦åšç›¸å…³çš„å¤„ç† 1234567891011121314/** å¸è½½æ“ä½œ */function unmount(vnode) &#123; // åœ¨å¸è½½çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯å¸è½½çš„vnodeç±»å‹ä¸ºFragmentï¼Œ åˆ™éœ€è¦å¸è½½ä»–çš„children if (vnode.type === Fragment) &#123; vnode.children.forEach((node) =&gt; unmount(node)); return; &#125; // æ ¹æ®vnodeè·å–è¦å¸è½½çš„çœŸå®domå…ƒç´  // è·å–elçš„çˆ¶çº§å…ƒç´  const parent = vnode.el.parentNode; if (parent) &#123; parent.removeChild(vnode.el); &#125;&#125; åé¢å†è¯´ diff diff ç®—æ³•// todoâ€¦. ç®€å•çš„ diff ç®—æ³•åŒç«¯ diff ç®—æ³•å¿«é€Ÿ diff ç®—æ³•","tags":["diff","Vue"]},{"title":"åŒå‡»äº‹ä»¶å’Œå•æœºäº‹ä»¶å†²çªè§£å†³æ–¹æ¡ˆ","path":"/2022/11/09/åŒå‡»äº‹ä»¶å’Œå•æœºäº‹ä»¶å†²çªè§£å†³æ–¹æ¡ˆ/","content":"åŒå‡»äº‹ä»¶ï¼ˆdblclickï¼‰æ—¶ï¼Œä¸è§¦å‘å•å‡»äº‹ä»¶(click)äº‹ä»¶ç»‘å®šä¸­ï¼Œæ‰§è¡ŒåŒå‡»äº‹ä»¶(dblclick)æ—¶èƒ½è§¦å‘ä¸¤æ¬¡å•å‡»äº‹ä»¶(click)ã€‚å³ä¸€ä¸ªæ ‡ç­¾å…ƒç´ ï¼ˆå¦‚buttonç­‰ï¼‰ï¼Œå¦‚æœå…ƒç´ åŒæ—¶ç»‘å®šäº†å•å‡»äº‹ä»¶(click)å’ŒåŒå‡»äº‹ä»¶(dblclick),é‚£ä¹ˆæ‰§è¡Œå•å‡»äº‹ä»¶(click)æ—¶ï¼Œä¸ä¼šè§¦å‘åŒå‡»äº‹ä»¶(dblclick)ï¼Œ æ‰§è¡ŒåŒå‡»äº‹ä»¶(dblclick)æ—¶å´ä¼šè§¦å‘ä¸¤æ¬¡å•å‡»äº‹ä»¶(click)ã€‚ æ‰§è¡Œé¡ºåºå•å‡»(click)ï¼šmousedownï¼Œmouseoutï¼Œclickï¼›åŒå‡»(dblclick)ï¼šmousedownï¼Œmouseoutï¼Œclick ï¼Œ mousedownï¼Œmouseoutï¼Œclickï¼Œdblclickï¼› åœ¨å•å‡»çš„æ—¶å€™ä¸ä¼šæ‰§è¡ŒåŒå‡»ï¼Œä½†æ˜¯åŒå‡»çš„æ—¶å€™ä¼šæ‰§è¡Œä¸¤æ¬¡å•å‡»å†æ‰§è¡ŒåŒå‡»äº‹ä»¶ã€‚è§£å†³çš„æ€è·¯ï¼šä½¿ç”¨å®šæ—¶å™¨æ¸…é™¤æ‰ä¸¤ä¸ªå•å‡»äº‹ä»¶ï¼Œç•™ä¸‹ä¸€ä¸ªåŒå‡»äº‹ä»¶ã€‚ setTimeout ç„¶åç°åœ¨ï¼Œå•å‡»æŒ‰é’®æ‰“å°â€œå•å‡»â€ï¼ŒåŒå‡»æŒ‰é’®æ‰“å°â€œåŒå‡»â€ã€‚ å…³äº time=200ï¼Œå¤§å®¶çŸ¥é“jsçš„äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œç‚¹å‡»äº‹ä»¶ä¼šæ·»åŠ ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ã€‚time=0ï¼Œ ä¹Ÿä¼šæ·»åŠ ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ã€‚é‚£ä¹ˆtime=0ä¸time=200æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ å› ä¸ºç¬¬ä¸€æ¬¡å•å‡»äº‹ä»¶åï¼Œä¸»çº¿ç¨‹æ²¡æœ‰ä»»ä½•ä»»åŠ¡ï¼Œå°±ä¼šç«‹é©¬æ‰§è¡Œè¿™ä¸ªå•å‡»äº‹ä»¶çš„ä»»åŠ¡ã€‚å¾…ç¬¬äºŒæ¬¡å•å‡»çš„æ—¶å€™ï¼Œå‡è®¾è·ç¦»ç¬¬ä¸€æ¬¡å•å‡»äº‹ä»¶æ˜¯150ms, å¦‚æœä½ çš„å®šæ—¶å™¨å°äº150ms, é‚£ä¹ˆç¬¬ä¸€æ¬¡çš„ä»»åŠ¡é˜Ÿåˆ—å°±ä¼šæ‰§è¡Œå®Œã€‚è¦æƒ³ä¸æ‰§è¡Œç¬¬ä¸€æ¬¡çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå®šæ—¶å™¨æ—¶é—´é—´éš”å°±å¿…é¡»å¤§äºä¸¤æ¬¡å•å‡»çš„æ—¶é—´é—´éš”äº†ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ª200æ˜¯é…Œæƒ…å€¼ï¼Œå¤§äºé—´éš”å°±è¡Œã€‚ ç¬¬ä¸€æ¬¡å•å‡»ä»»åŠ¡ä¸æ‰§è¡Œäº†ï¼Œæ˜¯è¢«å®šæ—¶å™¨å»¶æ—¶ï¼Œç„¶åç¬¬äºŒæ¬¡ç‚¹å‡»çš„æ—¶å€™ç»™æ¸…é™¤äº†ã€‚é‚£ä¹ˆç¬¬äºŒæ¬¡ç‚¹å‡»äº‹ä»¶å‘¢ï¼Ÿåœ¨ä¸¤æ¬¡å•å‡»ä¹‹åï¼Œä¼šç«‹é©¬æ‰§è¡Œä¸€ä¸ªåŒå‡»äº‹ä»¶ï¼ŒåŒå‡»äº‹ä»¶çš„ä¸€å¼€å¤´å°±æŠŠè¿™ä¸ªç¬¬äºŒæ¬¡ç‚¹å‡»äº‹ä»¶ç»™æ¸…é™¤äº†ã€‚ è¿™å°±æ˜¯åŒå‡»äº‹ä»¶çš„å¤§æ¦‚è¿‡ç¨‹ã€‚","tags":["Javascript"],"categories":["Javascript"]},{"title":"viteå­¦ä¹ è®°å½•","path":"/2022/11/03/viteå­¦ä¹ è®°å½•/","content":"viteå‰ç½®çŸ¥è¯† no-bundleï¼šåˆ©ç”¨æµè§ˆå™¨åŸç”Ÿ ES æ¨¡å—çš„æ”¯æŒï¼Œå®ç°å¼€å‘é˜¶æ®µçš„ Dev Serverï¼Œè¿›è¡Œæ¨¡å—çš„æŒ‰éœ€åŠ è½½ï¼Œè€Œä¸æ˜¯å…ˆæ•´ä½“æ‰“åŒ…å†è¿›è¡ŒåŠ è½½ã€‚ importï¼šviteä¸­çš„ä¸€ä¸ª import è¯­å¥ä»£è¡¨ä¸€ä¸ª HTTP è¯·æ±‚ åˆå§‹åŒ–æ¨¡æ¿ è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨pnpmå’Œviteï¼Œå½“ç„¶éœ€è¦å…¨å±€å®‰è£…ä¸€ä¸‹ã€‚å­¦ä¹ è®°å½•ä¸­ä½¿ç”¨çš„æ˜¯react + tsæŠ€æœ¯æ ˆ 1pnpm create vite åˆå§‹åŒ–ä¹‹åçš„æ–‡ä»¶æ ¼å¼æ˜¯ 12345678910111213â”œâ”€â”€ index.htmlâ”œâ”€â”€ package.jsonâ”œâ”€â”€ pnpm-lock.yamlâ”œâ”€â”€ srcâ”‚ â”œâ”€â”€ App.cssâ”‚ â”œâ”€â”€ App.tsxâ”‚ â”œâ”€â”€ favicon.svgâ”‚ â”œâ”€â”€ index.cssâ”‚ â”œâ”€â”€ logo.svgâ”‚ â”œâ”€â”€ main.tsxâ”‚ â””â”€â”€ vite-env.d.tsâ”œâ”€â”€ tsconfig.jsonâ””â”€â”€ vite.config.ts index.htmlï¼šå…¥å£æ–‡ä»¶ï¼Œviteä¼šé»˜è®¤æŠŠæ ¹ç›®å½•ä¸‹çš„index.htmlä½œä¸ºæ‰“åŒ…å…¥å£ 12345678910111213&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot; /&gt; &lt;link rel=&quot;icon&quot; type=&quot;image/svg+xml&quot; href=&quot;/vite.svg&quot; /&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt; &lt;title&gt;Vite + React + TS&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div id=&quot;root&quot;&gt;&lt;/div&gt; &lt;script type=&quot;module&quot; src=&quot;/src/main.tsx&quot;&gt;&lt;/script&gt; &lt;/body&gt;&lt;/html&gt; è¿™æ®µä»£ç ä»£è¡¨äº†æˆ‘ä»¬è„šæœ¬æ–‡ä»¶çš„å…¥å£ï¼Œä½¿ç”¨type=â€moduleâ€çš„ESæ¨¡å—åŠ è½½çš„æ¨¡å¼ï¼Œå½“æˆ‘ä»¬è®¿é—®é¡¹ç›®çš„æ—¶å€™ä¼šå»é€šè¿‡æœ¬åœ°çš„å»è¯·æ±‚main.tsxæ–‡ä»¶ 1&lt;script type=&quot;module&quot; src=&quot;/src/main.tsx&quot;&gt;&lt;/script&gt; main.tsx: å…¥å£æ–‡ä»¶å¼•ç”¨çš„è„šæœ¬æ–‡ä»¶ ä¿®æ”¹å…¥å£æ–‡ä»¶ä½ç½® ä¸€èˆ¬æ¥è¯´é¡¹ç›®çš„å…¥å£æ–‡ä»¶ï¼Œå¯èƒ½éšç€é¡¹ç›®çš„å˜åŒ–è€Œæ”¹åŠ¨ ä¾‹å¦‚æˆ‘ä»¬å°†å…¥å£æ–‡ä»¶æ”¹åˆ° srcçš„æ ¹ä¸‹ï¼› è¦æ³¨æ„ä¸¤ä¸ªç‚¹ï¼š ç›¸å¯¹è·¯å¾„ pathåŒ…è¦æ³¨æ„tsç±»å‹æŠ¥é”™ ä½ éœ€è¦é€šè¿‡ pnpm i @types/node -D å®‰è£…ç±»å‹ tsconfig.node.json ä¸­è®¾ç½® allowSyntheticDefaultImports: trueï¼Œä»¥å…è®¸ä¸‹é¢çš„ default å¯¼å…¥æ–¹å¼ // vite.config.ts 12345678910111213// vite.config.tsimport &#123; defineConfig &#125; from &#x27;vite&#x27;// å¼•å…¥ path åŒ…æ³¨æ„ä¸¤ç‚¹:// 1. ä¸ºé¿å…ç±»å‹æŠ¥é”™ï¼Œä½ éœ€è¦é€šè¿‡ `pnpm i @types/node -D` å®‰è£…ç±»å‹// 2. tsconfig.node.json ä¸­è®¾ç½® `allowSyntheticDefaultImports: true`ï¼Œä»¥å…è®¸ä¸‹é¢çš„ default å¯¼å…¥æ–¹å¼import path from &#x27;path&#x27;import react from &#x27;@vitejs/plugin-react&#x27;export default defineConfig(&#123; // æ‰‹åŠ¨æŒ‡å®šé¡¹ç›®æ ¹ç›®å½•ä½ç½® root: path.join(__dirname, &#x27;src&#x27;) plugins: [react()]&#125;) // tsconfig.node.json 12345678910&#123; &quot;compilerOptions&quot;: &#123; &quot;composite&quot;: true, &quot;module&quot;: &quot;ESNext&quot;, &quot;moduleResolution&quot;: &quot;Node&quot;, // ä»¥å…è®¸ nodeç›¸å…³çš„é»˜è®¤ å¯¼å…¥æ–¹å¼ &quot;allowSyntheticDefaultImports&quot;: true &#125;, &quot;include&quot;: [&quot;vite.config.ts&quot;]&#125; é»˜è®¤æŒ‡ä»¤12345678&quot;scripts&quot;: &#123; // å¼€å‘é˜¶æ®µå¯åŠ¨ Vite Dev Server &quot;dev&quot;: &quot;vite&quot;, // ç”Ÿäº§ç¯å¢ƒæ‰“åŒ… &quot;build&quot;: &quot;tsc &amp;&amp; vite build&quot;, // ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…å®Œé¢„è§ˆäº§ç‰© &quot;preview&quot;: &quot;vite preview&quot;&#125;, â€œdevâ€: é€šè¿‡å¯åŠ¨viteçš„Dev Serverï¼Œåœ¨å¼€å‘é˜¶æ®µå®ç°ä¸æ‰“åŒ…çš„ç‰¹æ€§ â€œbuildâ€: å› ä¸ºå½“å‰åˆå§‹åŒ–æ¨¡æ¿é€‰ç”¨çš„æ˜¯tsï¼Œæ‰€ä»¥åœ¨çœŸæ­£çš„ä½¿ç”¨viteæ‰“ç”Ÿäº§åŒ…çš„æ—¶å€™ï¼Œè¦ç¼–è¯‘ TypeScript ä»£ç å¹¶è¿›è¡Œç±»å‹æ£€æŸ¥ æ­¤ä»ç”¨åˆ°çš„æ—¶å€™tscï¼Œæ˜¯TypeScript çš„å®˜æ–¹ç¼–è¯‘å‘½ä»¤ã€‚åœ¨tsconfig.tsæ–‡ä»¶ä¸­å…¶å®æœ‰è¿™æ ·çš„é…ç½® 12345678&#123; &quot;compilerOptions&quot;: &#123; // çœç•¥å…¶ä»–é…ç½® // 1. noEmit è¡¨ç¤ºåªåšç±»å‹æ£€æŸ¥ï¼Œè€Œä¸ä¼šè¾“å‡ºäº§ç‰©æ–‡ä»¶ // 2. è¿™è¡Œé…ç½®ä¸ tsc --noEmit å‘½ä»¤ç­‰æ•ˆ &quot;noEmit&quot;: true, &#125;,&#125; åœ¨vueçš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°±å¾—ä½¿ç”¨åˆ° vue-tsc â€œpreviewâ€: é¢„è§ˆæ‰“åŒ…äº§ç‰©çš„æ‰§è¡Œæ•ˆæœã€‚ cssç›¸å…³æ”¹é€ ç‚¹æ ·å¼æ–¹æ¡ˆçš„æ„ä¹‰åŸç”Ÿ CSS å¼€å‘çš„å„ç§é—®é¢˜ å¼€å‘ä½“éªŒæ¬ ä½³ã€‚æ¯”å¦‚åŸç”Ÿ CSS ä¸æ”¯æŒé€‰æ‹©å™¨çš„åµŒå¥—: 123456789// é€‰æ‹©å™¨åªèƒ½å¹³é“ºï¼Œä¸èƒ½åµŒå¥—.container .header .nav .title .text &#123; color: blue;&#125;.container .header .nav .box &#123; color: blue; border: 1px solid grey;&#125; æ ·å¼æ±¡æŸ“é—®é¢˜ã€‚å¦‚æœå‡ºç°åŒæ ·çš„ç±»åï¼Œå¾ˆå®¹æ˜“é€ æˆä¸åŒçš„æ ·å¼äº’ç›¸è¦†ç›–å’Œæ±¡æŸ“ã€‚ 12345678910// a.css.container &#123; color: red;&#125;// b.css// å¾ˆæœ‰å¯èƒ½è¦†ç›– a.css çš„æ ·å¼ï¼.container &#123; color: blue;&#125; æµè§ˆå™¨å…¼å®¹é—®é¢˜ã€‚ä¸ºäº†å…¼å®¹ä¸åŒçš„æµè§ˆå™¨ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¸€äº›å±æ€§(å¦‚transition)åŠ ä¸Šä¸åŒçš„æµè§ˆå™¨å‰ç¼€ï¼Œæ¯”å¦‚ -webkit-ã€-moz-ã€-ms-ã€-o-ï¼Œæ„å‘³ç€å¼€å‘è€…è¦é’ˆå¯¹åŒä¸€ä¸ªæ ·å¼å±æ€§å†™å¾ˆå¤šçš„å†—ä½™ä»£ç ã€‚ æ‰“åŒ…åçš„ä»£ç ä½“ç§¯é—®é¢˜ã€‚å¦‚æœä¸ç”¨ä»»ä½•çš„ CSS å·¥ç¨‹åŒ–æ–¹æ¡ˆï¼Œæ‰€æœ‰çš„ CSS ä»£ç éƒ½å°†æ‰“åŒ…åˆ°äº§ç‰©ä¸­ï¼Œå³ä½¿æœ‰éƒ¨åˆ†æ ·å¼å¹¶æ²¡æœ‰åœ¨ä»£ç ä¸­ä½¿ç”¨ï¼Œå¯¼è‡´äº§ç‰©ä½“ç§¯è¿‡å¤§ã€‚ é’ˆå¯¹å¦‚ä¸ŠåŸç”Ÿ CSS çš„ç—›ç‚¹ï¼Œç¤¾åŒºä¸­è¯ç”Ÿäº†ä¸å°‘è§£å†³æ–¹æ¡ˆï¼Œå¸¸è§çš„æœ‰ 5 ç±»ã€‚ CSS é¢„å¤„ç†å™¨ï¼šä¸»æµçš„åŒ…æ‹¬Sass/Scssã€Lesså’ŒStylusã€‚è¿™äº›æ–¹æ¡ˆå„è‡ªå®šä¹‰äº†ä¸€å¥—è¯­æ³•ï¼Œè®© CSS ä¹Ÿèƒ½ä½¿ç”¨åµŒå¥—è§„åˆ™ï¼Œç”šè‡³èƒ½åƒç¼–ç¨‹è¯­è¨€ä¸€æ ·å®šä¹‰å˜é‡ã€å†™æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯è¯­å¥ï¼Œå¤§å¤§å¢å¼ºäº†æ ·å¼è¯­è¨€çš„çµæ´»æ€§ï¼Œè§£å†³åŸç”Ÿ CSS çš„å¼€å‘ä½“éªŒé—®é¢˜ã€‚ CSS Modulesï¼šèƒ½å°† CSS ç±»åå¤„ç†æˆå“ˆå¸Œå€¼ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…åŒåçš„æƒ…å†µä¸‹æ ·å¼æ±¡æŸ“çš„é—®é¢˜ã€‚ CSS åå¤„ç†å™¨PostCSSï¼Œç”¨æ¥è§£æå’Œå¤„ç† CSS ä»£ç ï¼Œå¯ä»¥å®ç°çš„åŠŸèƒ½éå¸¸ä¸°å¯Œï¼Œæ¯”å¦‚å°† px è½¬æ¢ä¸º remã€æ ¹æ®ç›®æ ‡æµè§ˆå™¨æƒ…å†µè‡ªåŠ¨åŠ ä¸Šç±»ä¼¼äºâ€“mozâ€“ã€-o-çš„å±æ€§å‰ç¼€ç­‰ç­‰ã€‚ CSS in JS æ–¹æ¡ˆï¼Œä¸»æµçš„åŒ…æ‹¬emotionã€styled-componentsç­‰ç­‰ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™ç±»æ–¹æ¡ˆå¯ä»¥å®ç°ç›´æ¥åœ¨ JS ä¸­å†™æ ·å¼ä»£ç ï¼ŒåŸºæœ¬åŒ…å«CSS é¢„å¤„ç†å™¨å’Œ CSS Modules çš„å„é¡¹ä¼˜ç‚¹ï¼Œéå¸¸çµæ´»ï¼Œè§£å†³äº†å¼€å‘ä½“éªŒå’Œå…¨å±€æ ·å¼æ±¡æŸ“çš„é—®é¢˜ã€‚ CSS åŸå­åŒ–æ¡†æ¶ï¼Œå¦‚Tailwind CSSã€Windi CSSï¼Œé€šè¿‡ç±»åæ¥æŒ‡å®šæ ·å¼ï¼Œå¤§å¤§ç®€åŒ–äº†æ ·å¼å†™æ³•ï¼Œæé«˜äº†æ ·å¼å¼€å‘çš„æ•ˆç‡ï¼Œä¸»è¦è§£å†³äº†åŸç”Ÿ CSS å¼€å‘ä½“éªŒçš„é—®é¢˜ã€‚ ä¸è¿‡ï¼Œå„ç§æ–¹æ¡ˆæ²¡æœ‰å­°ä¼˜å­°åŠ£ï¼Œå„è‡ªè§£å†³çš„æ–¹æ¡ˆæœ‰é‡å çš„éƒ¨åˆ†ï¼Œä½†ä¹Ÿæœ‰ä¸€å®šçš„å·®å¼‚ cssé¢„å¤„ç†å™¨ Vite æœ¬èº«å¯¹ CSS å„ç§é¢„å¤„ç†å™¨è¯­è¨€(Sass/Scssã€Lesså’ŒStylus)åšäº†å†…ç½®æ”¯æŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ä½ ä¸ç»è¿‡ä»»ä½•çš„é…ç½®ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å„ç§ CSS é¢„å¤„ç†å™¨ã€‚ ä½†æ˜¯ç”±äº Vite åº•å±‚ä¼šè°ƒç”¨ CSS é¢„å¤„ç†å™¨çš„å®˜æ–¹åº“è¿›è¡Œç¼–è¯‘ï¼Œè€Œ Vite ä¸ºäº†å®ç°æŒ‰éœ€åŠ è½½ï¼Œå¹¶æ²¡æœ‰å†…ç½®è¿™äº›å·¥å…·åº“ï¼Œè€Œæ˜¯è®©ç”¨æˆ·æ ¹æ®éœ€è¦å®‰è£… ä¾‹å¦‚æˆ‘ä»¬è¦ä½¿ç”¨ sassé¢„å¤„ç† 1pnpm install sass ä¹‹åä¸éœ€è¦ä»»ä½•é…ç½®å°±å¯ä»¥ä½¿ç”¨scssäº† å…¨å±€å˜é‡çš„å¼•å…¥æ¯”å¦‚æˆ‘ä»¬åœ¨å…¨å±€æœ‰è®¸å¤šçš„æ ·å¼å˜é‡ 1$theme-color: #17c2c2; åœ¨å…¶ä»–scssæ–‡ä»¶ä¸­å¼•å…¥çš„æ—¶å€™ï¼Œå¸¸å¸¸ä¼šéœ€è¦å…ˆå¯¼å…¥è¿™ä¸ªæ ·å¼å˜é‡çš„æ–‡ä»¶ 1@import &#x27;./variable.scss&#x27;; viteä¸­æœ‰å¯é…ç½®å‚æ•°ï¼Œèƒ½å¤Ÿé…ç½®å…¨å±€å¼•å…¥çš„æ–‡ä»¶ // vite.config.ts 1234567891011121314151617181920212223242526272829303132333435// vite.config.tsimport &#123; normalizePath &#125; from &#x27;vite&#x27;;// å¦‚æœç±»å‹æŠ¥é”™ï¼Œéœ€è¦å®‰è£… @types/node: pnpm i @types/node -Dimport path from &#x27;path&#x27;;// å…¨å±€ scss æ–‡ä»¶çš„è·¯å¾„// ç”¨ normalizePath è§£å†³ window ä¸‹çš„è·¯å¾„é—®é¢˜const variablePath = normalizePath(path.resolve(&#x27;./xxxxx&#x27;));export default defineConfig(&#123;// css ç›¸å…³çš„é…ç½®css: &#123; preprocessorOptions: &#123; scss: &#123; // additionalData çš„å†…å®¹ä¼šåœ¨æ¯ä¸ª scss æ–‡ä»¶çš„å¼€å¤´è‡ªåŠ¨æ³¨å…¥ additionalData: `@import &quot;$&#123;variablePath&#125;&quot;;` &#125; &#125; &#125;&#125;) css modules CSS Modules åœ¨ Vite ä¹Ÿæ˜¯ä¸€ä¸ªå¼€ç®±å³ç”¨çš„èƒ½åŠ›ï¼ŒVite ä¼šå¯¹åç¼€å¸¦æœ‰.moduleçš„æ ·å¼æ–‡ä»¶è‡ªåŠ¨åº”ç”¨ CSS Modulesã€‚ ç›´æ¥å°†ç›¸å…³çš„æ ·å¼æ–‡ä»¶æ”¹ä¸ºï¼Œ[name].module.scss CSS Modules é…ç½® ä¾‹å¦‚ä¸€ä¸ªHeaderç»„ä»¶ æ”¹é€ æ ·å¼æ–‡ä»¶åç§°ä¸ºindex.module.scss 12345.page-header &#123; display: flex; color: #fff; background-color: $theme-color;&#125; åœ¨tsxä¸­å¼•å…¥ 1234567891011121314151617181920import &#123; useState &#125; from &quot;react&quot;;import style from &quot;./index.module.scss&quot;;function PageHeader() &#123; const prefixCls = &quot;w-page-header&quot;; const [count, setCount] = useState(0); return ( &lt;div className=&#123;style[&#x27;page-header&#x27;]&#125;&gt; page header &lt;button onClick=&#123;() =&gt; setCount(1)&#125;&gt;add&lt;/button&gt; &#123;count&#125; &lt;/div&gt; );&#125;export default PageHeader; ä¿®æ”¹é…ç½®ï¼Œç”Ÿæˆçš„hash 12345678910111213141516171819202122232425import &#123; defineConfig, normalizePath &#125; from &#x27;vite&#x27;import react from &#x27;@vitejs/plugin-react&#x27;import path from &#x27;path&#x27;;const variablePath = normalizePath(path.resolve(&#x27;./src/assets/style/variable.scss&#x27;));// https://vitejs.dev/config/export default defineConfig(&#123; root: path.join(__dirname, &#x27;src&#x27;), plugins: [react()], css: &#123; modules: &#123; // ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥é€šè¿‡ generateScopedName å±æ€§æ¥å¯¹ç”Ÿæˆçš„ç±»åè¿›è¡Œè‡ªå®šä¹‰ // å…¶ä¸­ï¼Œname è¡¨ç¤ºå½“å‰æ–‡ä»¶åï¼Œlocal è¡¨ç¤ºç±»å generateScopedName: &quot;[name]__[local]___[hash:base64:5]&quot; &#125;, preprocessorOptions: &#123; scss: &#123; // additionalData çš„å†…å®¹ä¼šåœ¨æ¯ä¸ª scss æ–‡ä»¶çš„å¼€å¤´è‡ªåŠ¨æ³¨å…¥ additionalData: `@import &quot;$&#123;variablePath&#125;&quot;;` &#125; &#125; &#125;&#125;) å°±å¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„ç±»åä¸º postcss ä¸€èˆ¬ä½ å¯ä»¥é€šè¿‡ postcss.config.js æ¥é…ç½® postcss ï¼Œä¸è¿‡åœ¨ Vite é…ç½®æ–‡ä»¶ä¸­å·²ç»æä¾›äº† PostCSS çš„é…ç½®å…¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ Vite é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œæ“ä½œã€‚ autoprefixer è¿™ä¸ªæ’ä»¶ä¸»è¦ç”¨æ¥è‡ªåŠ¨ä¸ºä¸åŒçš„ç›®æ ‡æµè§ˆå™¨æ·»åŠ æ ·å¼å‰ç¼€ï¼Œè§£å†³çš„æ˜¯æµè§ˆå™¨å…¼å®¹æ€§çš„é—®é¢˜ è£…ä¸Šè¿™ä¸ªæ’ä»¶ï¼ˆä¸å†éœ€è¦æ‰‹åŠ¨å®‰è£…postcssäº†ï¼Œåªéœ€è¦è£…å¯¹åº”æ’ä»¶ï¼‰ 1pnpm i autoprefixer -D é…ç½®vite.config.ts 12345678910111213141516171819202122232425262728import &#123; defineConfig &#125; from &#x27;vite&#x27;import react from &#x27;@vitejs/plugin-react&#x27;import autoprefixer from &#x27;autoprefixer&#x27;;// https://vitejs.dev/config/export default defineConfig(&#123; root: path.join(__dirname, &#x27;src&#x27;), plugins: [react()], css: &#123; ..... postcss: &#123; plugins: [ autoprefixer(&#123; // æŒ‡å®šç›®æ ‡æµè§ˆå™¨ overrideBrowserslist: [ &#x27;Android 4.1&#x27;, &#x27;iOS 7.1&#x27;, &#x27;Chrome &gt; 31&#x27;, &#x27;ff &gt; 31&#x27;, &#x27;ie &gt;= 8&#x27;, &#x27;&gt; 1%&#x27;,] &#125;) ] &#125; &#125;&#125;) ä¹‹åæ‰“åŒ…ç”Ÿæˆçš„æ–‡ä»¶ä¸­å°±èƒ½è‡ªåŠ¨æ·»åŠ å‰ç¼€äº† å…¶ä»–æ’ä»¶ æ¨èä¸€ä¸ªç«™ç‚¹ï¼šwww.postcss.parts/ postcss-pxtoremï¼š ç”¨æ¥å°† px è½¬æ¢ä¸º rem å•ä½ï¼Œåœ¨é€‚é…ç§»åŠ¨ç«¯çš„åœºæ™¯ä¸‹å¾ˆå¸¸ç”¨ã€‚ postcss-preset-env: é€šè¿‡å®ƒï¼Œä½ å¯ä»¥ç¼–å†™æœ€æ–°çš„ CSS è¯­æ³•ï¼Œä¸ç”¨æ‹…å¿ƒå…¼å®¹æ€§é—®é¢˜ã€‚ cssnano: ä¸»è¦ç”¨æ¥å‹ç¼© CSS ä»£ç ï¼Œè·Ÿå¸¸è§„çš„ä»£ç å‹ç¼©å·¥å…·ä¸ä¸€æ ·ï¼Œå®ƒèƒ½åšå¾—æ›´åŠ æ™ºèƒ½ï¼Œæ¯”å¦‚æå–ä¸€äº›å…¬å…±æ ·å¼è¿›è¡Œå¤ç”¨ã€ç¼©çŸ­ä¸€äº›å¸¸è§çš„å±æ€§å€¼ç­‰ç­‰ã€‚ css in js ç¤¾åŒºä¸­æœ‰ä¸¤æ¬¾ä¸»æµçš„CSS In JS æ–¹æ¡ˆ: styled-componentså’Œemotionã€‚ å¯¹äºcss in jsçš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬è¦è€ƒè™‘å¤šä¸ªé—®é¢˜ é€‰æ‹©å™¨å‘½åé—®é¢˜ DCE(Dead Code Elimination å³æ— ç”¨ä»£ç åˆ é™¤) ä»£ç å‹ç¼© ç”Ÿæˆ SourceMap æœåŠ¡ç«¯æ¸²æŸ“(SSR) è€Œstyled-componentså’Œemotionå·²ç»æä¾›äº†å¯¹åº”çš„ babel æ’ä»¶æ¥è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ Vite ä¸­è¦åšçš„å°±æ˜¯é›†æˆè¿™äº› babel æ’ä»¶ã€‚ é…ç½®12345678910111213141516171819202122232425// vite.config.tsimport &#123; defineConfig &#125; from &#x27;vite&#x27;import react from &#x27;@vitejs/plugin-react&#x27;// https://vitejs.dev/config/export default defineConfig(&#123; plugins: [ react(&#123; babel: &#123; // åŠ å…¥ babel æ’ä»¶ // ä»¥ä¸‹æ’ä»¶åŒ…éƒ½éœ€è¦æå‰å®‰è£… // å½“ç„¶ï¼Œé€šè¿‡è¿™ä¸ªé…ç½®ä½ ä¹Ÿå¯ä»¥æ·»åŠ å…¶å®ƒçš„ Babel æ’ä»¶ plugins: [ // é€‚é… styled-component &quot;babel-plugin-styled-components&quot; // é€‚é… emotion &quot;@emotion/babel-plugin&quot; ] &#125;, // æ³¨æ„: å¯¹äº emotionï¼Œéœ€è¦å•ç‹¬åŠ ä¸Šè¿™ä¸ªé…ç½® // é€šè¿‡ `@emotion/react` åŒ…ç¼–è¯‘ emotion ä¸­çš„ç‰¹æ®Š jsx è¯­æ³• jsxImportSource: &quot;@emotion/react&quot; &#125;) ]&#125;)","tags":["Vite"],"categories":["Vite"]},{"title":"ç†è§£Proxyå’ŒReflect","path":"/2022/09/03/ç†è§£Proxyå’ŒReflect/","content":"ç†è§£Proxy Vue3ä¸­åˆ©ç”¨çš„æ˜¯Proxyä»¥åŠReflectå»ä»£ç†å¯¹è±¡çš„ æˆ‘ä»¬çŸ¥é“Proxyæ˜¯åªèƒ½ä»£ç†å¯¹è±¡ç±»å‹çš„ï¼Œéå¯¹è±¡ç±»å‹ä¸å¯ä»¥è¿›è¡Œä»£ç† æ‰€è°“ä»£ç†ï¼š æŒ‡çš„æ˜¯å¯¹ä¸€ä¸ª å¯¹è±¡ çš„ åŸºæœ¬è¯­ä¹‰ çš„ä»£ç† ä½•ä¸ºåŸºæœ¬è¯­ä¹‰æ¯”å¦‚æˆ‘ä»¬å¯¹å¯¹è±¡çš„ä¸€å †ç®€å•æ“ä½œ 12console.log(obj.a); // è¯»å–å±æ€§æ“ä½œobj.a++; // è®¾ç½®å±æ€§å€¼æ“ä½œ ç±»ä¼¼è¿™ç§è¯»å–ï¼Œè®¾ç½®å±æ€§å€¼çš„æ“ä½œï¼Œå°±æ˜¯å±äºåŸºæœ¬çš„è¯­ä¹‰æ“ä½œ â€”- åŸºæœ¬æ“ä½œ ç±»ä¼¼è¿™ç§çš„åŸºæœ¬æ“ä½œå°±å¯ä»¥ç”¨Proxyè¿›è¡Œä»£ç†æ‹¦æˆª åŸºæœ¬æ“ä½œçš„åŸºæœ¬ç”¨æ³• 123456const data = new Proxy(obj, &#123; // æ‹¦æˆªè¯»å–å±æ€§æ“ä½œ get()&#123; .... &#125;, // æ‹¦æˆªè®¾ç½®å±æ€§æ“ä½œ set()&#123; .... &#125;&#125;) ä¾‹å¦‚å‡½æ•°ï¼šæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨applyå¯¹å‡½æ•°è¿›è¡Œæ‹¦æˆª 123456789const fn = ()=&gt;&#123; console.log(&#x27;wengkaimin&#x27;)&#125;const proFn = new Proxy(fn, &#123; apply(target, thisArg, argArray)&#123; target.call(thisArg, ...argArray) &#125;&#125;) å¤åˆæ“ä½œæ—¢ç„¶æœ‰åŸºæœ¬æ“ä½œï¼Œå¯ä»¥ä¹Ÿæœ‰éåŸºæœ¬æ“ä½œï¼Œåœ¨jsé‡Œå¤´ï¼Œæˆ‘ä»¬å«ä»–å¤åˆæ“ä½œ 1obj.fn() è¿™ä¸ªæ˜¾è€Œæ˜“è§ï¼Œæ˜¯åˆå¤šä¸ªè¯­ä¹‰æ„æˆçš„ï¼ˆè°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„ä¸€ä¸ªå‡½æ•°å±æ€§ï¼‰ã€ ä¸¤ä¸ªè¯­ä¹‰æ˜¯ï¼š é¦–å…ˆé€šè¿‡getè·å–åˆ°objçš„fnå±æ€§ é€šè¿‡è·å–åˆ°çš„fnè¿›è¡Œè°ƒç”¨ ç†è§£Reflect Reflectæ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œå…¶ä¸­å­˜åœ¨å’ŒProxyçš„æ‹¦æˆªå™¨å¾ˆå¤šåå­—ç›¸åŒçš„æ–¹æ³• å¦‚ä¸‹çš„ç­‰ä»·æ“ä½œ 123const obj = &#123; a: &#x27;wengkaimin&#x27; &#125;;console.log(obj.a);console.log(Reflect.get(obj, &#x27;a&#x27;)); ä½†æ˜¯Reflectå®ƒèƒ½å¤Ÿä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•° reveiver å°±ç›¸å½“äºå‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒæŒ‡å‘çš„this 1console.log(Reflect.get(obj, &#x27;a&#x27;, &#123; a: &#x27;kaimin&#x27; &#125;)); // kaimin åœ¨vue3å“åº”å¼å­¦ä¹  æ•´ç†çš„é‚£ç¯‡æ–‡ç« ä¸­ï¼Œè®°å½•äº†å®ç° å“åº”å¼ä»£ç†çš„ä»£ç  123456789101112const obj = new Proxy(data, &#123; get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ // è¿™é‡Œæ²¡æœ‰ç”¨Reflect.getå®ç°è¯»å–æ•°æ® return target[key]; &#125;, set(target, key, newVal) &#123; target[key] = newVal; trigger(target, key); &#125;,&#125;); æˆ‘ä»¬åœ¨Proxyä¸­æ— è®ºè®¾ç½®getè¿˜æ˜¯setæ‹¦æˆªï¼Œéƒ½æ˜¯ç›´æ¥ç”¨çš„åŸå§‹å¯¹è±¡targetæ¥è¿›è¡Œè¯»å–æˆ–è€…èµ‹å€¼ å‡å¦‚ç›®å‰çš„objä¸ºï¼Œè¿”å›äº†this.fooçš„å€¼ã€‚ æ¥ç€æˆ‘ä»¬åœ¨effectå‰¯ä½œç”¨å‡½æ•°ä¸­é€šè¿‡ä»£ç†å¯¹è±¡dataè¯»å–bçš„å€¼ã€‚ ä¹‹åæˆ‘ä»¬ä¿®æ”¹äº†açš„å€¼ 1234567891011121314151617181920212223242526const obj = &#123; a:1, get b()&#123; return this.a + 1; &#125;&#125;const data = new Proxy(obj, &#123; get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ // è¿™é‡Œæ²¡æœ‰ç”¨Reflect.getå®ç°è¯»å–æ•°æ® return target[key]; &#125;, set(target, key, newVal) &#123; // è¿™é‡Œæ²¡æœ‰ç”¨Reflect.set target[key] = newVal; trigger(target, key); &#125;,&#125;)effect(()=&gt;&#123; console.log(data.b) // 2&#125;)data.a++ ä¿®æ”¹äº†açš„å€¼ä¹‹åï¼Œå¹¶ä¸ä¼šç›¸å¯¹åº”çš„è§¦å‘å‰¯ä½œç”¨å‡½æ•°çš„é‡æ–°æ‰§è¡Œ æ¢³ç†ä¸‹è¯»å–æ­¥éª¤ï¼š é¦–å…ˆæˆ‘ä»¬åœ¨å‰¯ä½œç”¨å‡½æ•°ä¸­è¯»å–äº†data.bçš„å€¼ ä¼šè§¦å‘dataä»£ç†å¯¹è±¡çš„getæ‹¦æˆªå™¨ï¼Œåœ¨getæ‹¦æˆªå™¨ä¸­ï¼Œé€šè¿‡target[key]è¯»å–; æ­¤æ—¶targetå°±æŒ‡çš„æ˜¯ obj åŸå§‹å¯¹è±¡ï¼Œkeyå°±æ˜¯ â€˜bâ€™ï¼Œæ‰€ä»¥ç›¸å½“ç›´æ¥è¯»äº†obj.b è®¿é—®obj.bçš„æ—¶å€™ï¼Œå…¶å®æ˜¯ä¸€ä¸ªgetterå‡½æ•°ï¼Œè¿™ä¸ªgetterçš„thisæŒ‡å‘äº†objï¼Œæœ€ç»ˆå®è´¨ä¸Šæ˜¯è®¿é—®äº† obj.a å¹¶ä¸”ç»™ä»–åŠ äº†ä¸ª1 å½“ç„¶ï¼Œåœ¨å‰¯ä½œç”¨å‡½æ•°effectå½“ä¸­ç›¸å½“äºï¼Œç›´æ¥è¯»å–äº†åŸç”Ÿå¯¹è±¡objçš„å±æ€§ï¼Œè™½ç„¶çœ‹ä¸Šå»èµ°äº†ä»£ç†ï¼Œä½†ä¸å¤šã€‚æ‰€ä»¥è¿™è‚¯å®šæ˜¯æ²¡æœ‰è¿½è¸ªåˆ°çš„ï¼Œå»ºç«‹ä¸èµ·ç›¸åº”çš„è”ç³» å°±ç±»ä¼¼ 123effect(()=&gt;&#123; console.log(obj.a + 1) // 2&#125;) åœ¨è¿™ç§åœºæ™¯ä¸‹Reflectçš„ç¬¬ä¸‰ä¸ªå‚æ•°receiverå°±æ´¾ä¸Šç”¨åœºäº† ä½¿ç”¨Reflectæ”¹é€ å®Œgetæ‹¦æˆªå™¨ 1234567891011const obj = new Proxy(data, &#123; get(target, key, receiver) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return Reflect.get(target, key, receiver) &#125;, set(target, key, newVal) &#123; target[key] = newVal; trigger(target, key); &#125;,&#125;); ä½¿ç”¨äº†Relfectä¹‹åï¼ŒthisæŒ‡å‘å°±è½¬ä¸ºäº†dataä»£ç†å¯¹è±¡ï¼Œå°±å¯ä»¥æˆåŠŸçš„å»ºç«‹è”ç³»äº† Reflectçš„ä½œç”¨ä¸ä»…äºæ­¤","tags":["Vue","Proxy","Reflect","å“åº”å¼"],"categories":["Javascript"]},{"title":"typescriptåˆ·é¢˜è®°å½•","path":"/2022/08/02/typescriptåˆ·é¢˜è®°å½•/","content":"typescriptåˆ·é¢˜è®°å½•é¢˜ç›®ä¸€è§£å†³å¦‚ä¸‹é”™è¯¯ 1234567891011121314type User = &#123; id: number; kind: string;&#125;;function makeCustomer&lt;T extends User&gt;(u: T): T &#123; // Errorï¼ˆTS ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼šv4.4.2ï¼‰ // Type &#x27;&#123; id: number; kind: string; &#125;&#x27; is not assignable to type &#x27;T&#x27;. // &#x27;&#123; id: number; kind: string; &#125;&#x27; is assignable to the constraint of type &#x27;T&#x27;, // but &#x27;T&#x27; could be instantiated with a different subtype of constraint &#x27;User&#x27;. return &#123; id: u.id, kind: &#x27;customer&#x27; &#125;&#125; å› ä¸ºTå—Userç±»å‹çš„çº¦æŸï¼Œä½†æ˜¯ä¹Ÿæœ‰å¯èƒ½æœ‰å…¶ä»–æƒ…å†µï¼Œæ¯”å¦‚&#123;id:1, kind:&#39;2&#39;,name:&#39;test&#39;&#125;ï¼Œæ‰€ä»¥è¿”å›å€¼ä¸­ç¼ºå°‘äº†name æ–¹æ³•ä¸€ç›´æ¥æŠŠå‰©ä½™çš„uçš„keyè¿”å›å‡ºå» 1234567891011type User = &#123; id: number; kind: string;&#125;;function makeCustomer&lt;T extends User&gt;(u: T): T &#123; return &#123; ...u, id: u.id, kind: &#x27;customer&#x27; &#125;&#125; æ–¹æ³•äºŒ1234567891011121314function makeCustomer&lt;T extends User&gt;(u: T): ReturnMake&lt;T, User&gt; &#123;// Errorï¼ˆTS ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼šv4.4.2ï¼‰// Type &#x27;&#123; id: number; kind: string; &#125;&#x27; is not assignable to type &#x27;T&#x27;.// &#x27;&#123; id: number; kind: string; &#125;&#x27; is assignable to the constraint of type &#x27;T&#x27;, // but &#x27;T&#x27; could be instantiated with a different subtype of constraint &#x27;User&#x27;. return &#123; id: u.id, kind: &#x27;customer&#x27; &#125;&#125;type ReturnMake&lt;T extends User, U&gt; = &#123; [K in keyof R as K extends keyof T ? K: never]: U[K]&#125; éå† Userä¸­çš„ key ï¼Œå¹¶ä½¿ç”¨ as æ–­è¨€ï¼Œå¦‚æœKï¼ˆä¹Ÿå°±æ˜¯ User ç±»å‹çš„ keyï¼‰ï¼Œçº¦æŸäº æ³›å‹ç±»å‹çš„ key å°±è¿”å› Kï¼Œå¦ä¾§è¿”å› neverï¼ŒU[K] å–é”®å€¼ã€‚ é¢˜ç›®äºŒï¼ˆè€ƒå¯Ÿå‡½æ•°é‡è½½ï¼‰æœ¬é“é¢˜æˆ‘ä»¬å¸Œæœ›å‚æ•° a å’Œ b çš„ç±»å‹éƒ½æ˜¯ä¸€è‡´çš„ï¼Œå³ a å’Œ b åŒæ—¶ä¸º number æˆ– string ç±»å‹ã€‚å½“å®ƒä»¬çš„ç±»å‹ä¸ä¸€è‡´çš„å€¼ï¼ŒTS ç±»å‹æ£€æŸ¥å™¨èƒ½è‡ªåŠ¨æç¤ºå¯¹åº”çš„é”™è¯¯ä¿¡æ¯ã€‚ 12345678function f(a: string | number, b: string | number) &#123; if (typeof a === &#x27;string&#x27;) &#123; return a + &#x27;:&#x27; + b; // no error but b can be number! &#125; else &#123; // error: è¿ç®—ç¬¦â€œ+â€ä¸èƒ½åº”ç”¨äºç±»å‹â€œnumberâ€å’Œâ€œstring | numberâ€ã€‚ts(2365) return a + b; // error as b can be number | string &#125;&#125; è§£å†³æ–¹æ¡ˆï¼šå‡½æ•°é‡è½½123456789function f(a:string, b:string ):stringfunction f(a:number, b:number):number;function f(a: string | number, b: string | number) &#123; if (typeof a === &#x27;string&#x27; || typeof b === &#x27;string&#x27;) &#123; return a + &#x27;:&#x27; + b; // no error but b can be number! &#125; else &#123; return a + b; // error as b can be number | string &#125;&#125; é¢˜ç›®ä¸‰ï¼ˆSetOptional || SetRequiredï¼‰å¦‚ä½•å®šä¹‰ä¸€ä¸ª SetOptional å·¥å…·ç±»å‹ï¼Œæ”¯æŒæŠŠç»™å®šçš„keyså¯¹åº”çš„å±æ€§å˜æˆå¯é€‰çš„ï¼Ÿå¯¹åº”çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112131415type Foo = &#123;\ta: number;\tb?: string;\tc: boolean;&#125;// æµ‹è¯•ç”¨ä¾‹type SomeOptional = SetOptional&lt;Foo, &#x27;a&#x27; | &#x27;b&#x27;&gt;;// type SomeOptional = &#123;// a?: number; // è¯¥å±æ€§å·²å˜æˆå¯é€‰çš„// b?: string; // ä¿æŒä¸å˜// c: boolean; // &#125; è§£å†³æ–¹æ³•1234567891011121314151617type Foo = &#123;\ta: number;\tb?: string;\tc: boolean;&#125;// æµ‹è¯•ç”¨ä¾‹type SomeOptional = SetOptional&lt;Foo, &#x27;a&#x27; | &#x27;b&#x27;&gt;;// type SomeOptional = &#123;// a?: number; // è¯¥å±æ€§å·²å˜æˆå¯é€‰çš„// b?: string; // ä¿æŒä¸å˜// c: boolean; // &#125;type SetOptional&lt;T, R extends keyof T&gt; = Omit&lt;T,R&gt; &amp; Partial&lt;Pick&lt;T,R&gt;&gt; setRequriedä¹Ÿæ˜¯ä¸€æ ·çš„å¦‚ä¸‹ 1type SetRequired&lt;T, K extends keyof T&gt; = Omit&lt;T, K&gt; &amp; Required&lt;Pick&lt;T, K&gt;&gt;; é¢˜ç›®å››ï¼ˆConditionalPickï¼‰Pick&lt;T, K extends keyof T&gt;çš„ä½œç”¨æ˜¯å°†æŸä¸ªç±»å‹ä¸­çš„å­å±æ€§æŒ‘å‡ºæ¥ï¼Œå˜æˆåŒ…å«è¿™ä¸ªç±»å‹éƒ¨åˆ†å±æ€§çš„å­ç±»å‹ã€‚ 12345678910111213interface Todo &#123; title: string; description: string; completed: boolean;&#125;type TodoPreview = Pick&lt;Todo, &quot;title&quot; | &quot;completed&quot;&gt;;const todo: TodoPreview = &#123; title: &quot;Clean room&quot;, completed: false&#125;; é‚£ä¹ˆå¦‚ä½•å®šä¹‰ä¸€ä¸ª ConditionalPickå·¥å…·ç±»å‹ï¼Œæ”¯æŒæ ¹æ®æŒ‡å®šçš„ Condition æ¡ä»¶æ¥ç”Ÿæˆæ–°çš„ç±»å‹ï¼Œå¯¹åº”çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910interface Example &#123;\ta: string;\tb: string | number;\tc: () =&gt; void;\td: &#123;&#125;;&#125;// æµ‹è¯•ç”¨ä¾‹ï¼štype StringKeysOnly = ConditionalPick&lt;Example, string&gt;;//=&gt; &#123;a: string&#125; è§£å†³æ–¹æ¡ˆ1ã€in keyoféå† V æ³›å‹ï¼› 2ã€é€šè¿‡ç±»å‹æ–­è¨€åˆ¤æ–­ V[K] å¯¹åº”é”®å€¼æ˜¯å¦çº¦æŸäºä¼ å…¥çš„ stringå¦‚æœæ˜¯ trueé‚£ä¹ˆæ–­è¨€æˆè¿”å›éå†çš„å½“å‰ Kï¼Œå¦åˆ™ä¸º neverã€‚ è¿”å› neveråœ¨ TypeScript ç¼–è¯‘å™¨ä¸­ï¼Œä¼šé»˜è®¤è®¤ä¸ºè¿™æ˜¯ä¸ªç”¨ä¸å­˜åœ¨çš„ç±»å‹ï¼Œä¹Ÿç›¸å½“äºæ²¡æœ‰è¿™ä¸ª Kä¼šè¢«è¿‡æ»¤ï¼Œå¯¹åº”å€¼åˆ™æ˜¯ V[K] è·å–ã€‚ 12345678910111213141516interface Example &#123;\ta: string;\tb: string | number;\tc: () =&gt; void;\td: &#123;&#125;;&#125;// æµ‹è¯•ç”¨ä¾‹ï¼štype StringKeysOnly = ConditionalPick&lt;Example, string&gt;;//=&gt; &#123;a: string&#125;type ConditionalPick&lt;T,R&gt; = &#123; [K in keyof T as T[K] extends R ? K : never ]: T[K]&#125; é¢˜ç›®äº”ï¼ˆè¿½åŠ argsï¼‰å®šä¹‰ä¸€ä¸ªå·¥å…·ç±»å‹ AppendArgumentï¼Œä¸ºå·²æœ‰çš„å‡½æ•°ç±»å‹å¢åŠ æŒ‡å®šç±»å‹çš„å‚æ•°ï¼Œæ–°å¢çš„å‚æ•°åæ˜¯xï¼Œå°†ä½œä¸ºæ–°å‡½æ•°ç±»å‹çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š 12345type Fn = (a: number, b: string) =&gt; numbertype AppendArgument&lt;F, A&gt; = // ä½ çš„å®ç°ä»£ç type FinalFn = AppendArgument&lt;Fn, boolean&gt; // (x: boolean, a: number, b: string) =&gt; number è§£å†³æ–¹æ¡ˆ1 ï¼ˆä½¿ç”¨æ³›å‹å·¥å…·ï¼‰ä½¿ç”¨æ³›å‹å·¥å…·Parametersä»¥åŠReturnType 123456type Fn = (a: number, b: string) =&gt; numbertype FinalFn = AppendArgument&lt;Fn, boolean&gt; // (x: boolean, a: number, b: string) =&gt; numbertype AppendArgument&lt;F extends (...args:any[]) =&gt; any, A&gt; = (arg1:A , ...args2:Parameters&lt;F&gt;) =&gt; ReturnType&lt;F&gt; // ä½ çš„å®ç°ä»£ç  è§£å†³æ–¹æ¡ˆ2 ï¼ˆä½¿ç”¨inferï¼‰inferæ¨å¯¼æ‹¿åˆ°å‚æ•°ç±»å‹Tè¿”å›å€¼ç±»å‹ä¸ºRï¼Œå†ä»æ–°è¿”å›ä¸€ä¸ªæ–°å‡½æ•°arg1å‚æ•°ä¸ºAï¼Œ...argså‚æ•°ç±»å‹ä¸ºå‰é¢æ¨å¯¼ä¿ç•™çš„Tï¼Œè¿”å›å€¼å³Rã€‚ 1type AppendArgument&lt;F extends (...args:any[]) =&gt; any, A&gt; = F extends (...args:infer T)=&gt; infer R ? (agr1:A, ...args:T)=&gt;R : never é¢˜ç›®äº”ï¼ˆæ•°ç»„ç±»å‹æ‹å¹³ï¼‰å®šä¹‰ä¸€ä¸ªNativeFlatå·¥å…·ç±»å‹ï¼Œæ”¯æŒæŠŠæ•°ç»„ç±»å‹æ‹å¹³ï¼ˆæ‰å¹³åŒ–ï¼‰ã€‚å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567type NaiveFlat&lt;T extends any[]&gt; = // ä½ çš„å®ç°ä»£ç // æµ‹è¯•ç”¨ä¾‹ï¼štype NaiveResult = NaiveFlat&lt;[[&#x27;a&#x27;], [[&#x27;b&#x27;, &#x27;c&#x27;]], [&#x27;d&#x27;]]&gt; // NaiveResultçš„ç»“æœï¼š &quot;a&quot; | &quot;b&quot; | &quot;c&quot; | &quot;d&quot; è§£å†³æ–¹æ¡ˆï¼ˆé€’å½’ï¼‰123456type NaiveFlat&lt;T extends any[]&gt; = T extends (infer R)[] ? (R extends any[] ? NaiveFlat&lt;R&gt;: R ): never// ä½ çš„å®ç°ä»£ç // æµ‹è¯•ç”¨ä¾‹ï¼štype NaiveResult = NaiveFlat&lt;[[&#x27;a&#x27;], [[&#x27;b&#x27;, &#x27;c&#x27;]], [&#x27;d&#x27;]]&gt; // NaiveResultçš„ç»“æœï¼š &quot;a&quot; | &quot;b&quot; | &quot;c&quot; | &quot;d&quot; 1ã€é¦–å…ˆéœ€è¦åœ¨çº¦æŸæ¡ä»¶ä¸­ä½¿ç”¨inferå…³é”®å­—æ¨å¯¼å‡º T ä¼ å…¥çš„æ•°ç»„ç±»å‹ï¼Œå¹¶ç”¨ P ä¿å­˜æ•°ç»„ç±»å‹ã€‚ 2ã€ä¸‰å…ƒåµŒå¥—åˆ¤æ–­Rç±»å‹æ˜¯å¦çº¦æŸäºç±»å‹any[]å¦‚æœè¿˜æ˜¯æ˜¯æ•°ç»„ç»§ç»­é€’å½’éå†è°ƒç”¨NaiveFlat&lt;R&gt;å¹¶ä¼ å…¥Rï¼Œæ”¾ Rç±»å‹ä¸æ»¡è¶³ any[]ï¼Œè¿”å›æœ€åçš„æ‰å¹³å®ŒæˆRç±»å‹æ‰€ä»¥å¾—åˆ°æœ€ç»ˆè”åˆç±»å‹&quot;a&quot; | &quot;b&quot; | &quot;c&quot; | &quot;d&quot; ã€‚ é¢˜ç›®å…­ (æ•°ç»„ä¸ä¸ºç©º)å®šä¹‰NonEmptyArrayå·¥å…·ç±»å‹ï¼Œç”¨äºç¡®ä¿æ•°æ®éç©ºæ•°ç»„ã€‚ 123type NonEmptyArray&lt;T&gt; = // ä½ çš„å®ç°ä»£ç const a: NonEmptyArray&lt;string&gt; = [] // å°†å‡ºç°ç¼–è¯‘é”™è¯¯const b: NonEmptyArray&lt;string&gt; = [&#x27;Hello TS&#x27;] // éç©ºæ•°æ®ï¼Œæ­£å¸¸ä½¿ç”¨ è§£å†³æ–¹æ¡ˆ1234const a: NonEmptyArray&lt;string&gt; = [] // å°†å‡ºç°ç¼–è¯‘é”™è¯¯const b: NonEmptyArray&lt;string&gt; = [&#x27;Hello TS&#x27;] // éç©ºæ•°æ®ï¼Œæ­£å¸¸ä½¿ç”¨type NonEmptyArray&lt;T&gt; = [T, ...T[]] [T, ...T[]]ç¡®ä¿ç¬¬ä¸€é¡¹ä¸€å®šæ˜¯Tï¼Œ[...T[]]ï¼Œä¸ºå‰©ä½™æ•°ç»„ç±»å‹ã€‚ é¢˜ç›®ä¸ƒå®šä¹‰ä¸€ä¸ªJoinStrArrayå·¥å…·ç±»å‹ï¼Œç”¨äºæ ¹æ®æŒ‡å®šçš„Separatoråˆ†éš”ç¬¦ï¼Œå¯¹å­—ç¬¦ä¸²æ•°ç»„ç±»å‹è¿›è¡Œæ‹¼æ¥ã€‚å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567type JoinStrArray&lt;Arr extends string[], Separator extends string&gt; = // ä½ çš„å®ç°ä»£ç // æµ‹è¯•ç”¨ä¾‹type Names = [&quot;Sem&quot;, &quot;Lolo&quot;, &quot;Kaquko&quot;]type NamesComma = JoinStrArray&lt;Names, &quot;,&quot;&gt; // &quot;Sem,Lolo,Kaquko&quot;type NamesSpace = JoinStrArray&lt;Names, &quot; &quot;&gt; // &quot;Sem Lolo Kaquko&quot;type NamesStars = JoinStrArray&lt;Names, &quot;â­ï¸&quot;&gt; // &quot;Semâ­ï¸Loloâ­ï¸Kaquko&quot; è§£å†³æ–¹æ³•12345678910// æµ‹è¯•ç”¨ä¾‹type Names = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]type NamesComma = JoinStrArray&lt;Names, &quot;,&quot;&gt; // &quot;Sem,Lolo,Kaquko&quot;type NamesSpace = JoinStrArray&lt;Names, &quot; &quot;&gt; // &quot;Sem Lolo Kaquko&quot;type NamesStars = JoinStrArray&lt;Names, &quot;â­ï¸&quot;&gt; // &quot;Semâ­ï¸Loloâ­ï¸Kaquko&quot;type JoinStrArray&lt;Arr extends string[], Separator extends string&gt; = Arr extends [infer A,...infer B] ? (`$&#123;A extends string ? A : &#x27;&#x27;&#125;$&#123;B extends [string, ...string[]] ? `$&#123;Separator&#125;$&#123;JoinStrArray&lt;B, Separator&gt;&#125;` : &#x27;&#x27;&#125;`):&#x27;&#x27; // ä½ çš„å®ç°ä»£ç  JoinStrArrayå·¥å…·æ–¹æ³•ï¼ŒArræ³›å‹å¿…é¡»çº¦æŸäºstring[]ç±»å‹ï¼ŒSeparatorä¸ºåˆ†éš”ç¬¦ï¼Œä¹Ÿå¿…é¡»çº¦æŸäºstringç±»å‹ï¼› 1ã€é¦–å…ˆArrçº¦æŸäºåé¢[infer A, ...infer B]å¹¶é€šè¿‡inferå…³é”®å­—æ¨å¯¼æ‹¿åˆ°ç¬¬ä¸€ä¸ªç´¢å¼•Açš„ç±»å‹ï¼Œä»¥åŠå‰©ä½™ï¼ˆrestï¼‰æ•°ç»„çš„ç±»å‹ä¸ºBï¼› 2ã€å¦‚æœæ»¡è¶³çº¦æŸï¼Œåˆ™è¿æ¥å­—ç¬¦ï¼Œè¿æ¥å­—ç¬¦ä½¿ç”¨æ¨¡æ¿å˜é‡ï¼Œå…ˆåˆ¤æ–­Aï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªç´¢å¼•ï¼‰æ˜¯å¦çº¦æŸäºstringç±»å‹ï¼Œæ»¡è¶³å°±å–ç¬¬ä¸€ä¸ªAå¦åˆ™ç›´æ¥è¿”å›ç©ºå­—ç¬¦ä¸²ï¼› 3ã€åé¢è¿æ¥çš„Bï¼ˆâ€¦restï¼‰åˆ¤æ–­æ˜¯å¦æ»¡è¶³äº[string, ...string[]]ï¼Œæ„æ€å°±æ˜¯æ˜¯ä¸æ˜¯è¿˜æœ‰å¤šä¸ªç´¢å¼•ã€‚å¦‚æœæœ‰ï¼Œç”¨åˆ†å‰²ç¬¦å·ï¼ŒåŠ ä¸Šé€’å½’å†è°ƒç”¨JoinStrArrayå·¥å…·ç±»å‹æ–¹æ³•ï¼ŒArræ³›å‹å°±å†ä¸º B ï¼Œåˆ†éš”ç¬¦æ³›å‹Separatorä¸å˜ã€‚å‡æ²»æ€æƒ³ï¼Œæ‹¿å‡ºæ•°ç»„çš„æ¯ä¸€é¡¹ï¼Œç›´è‡³æ•°ç»„ä¸ºç©ºã€‚ æœ€å¼€å§‹çš„è¯ï¼Œå¦‚æœArrä¸æ»¡è¶³çº¦æŸï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ä¸ºç©ºå­—ç¬¦ä¸²ã€‚ é¢˜ç›®å…«å®ç°ä¸€ä¸ªTrimå·¥å…·ç±»å‹ï¼Œç”¨äºå¯¹å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹è¿›è¡Œå»ç©ºæ ¼å¤„ç†ã€‚å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š 12345type Trim&lt;V extends string&gt; = // ä½ çš„å®ç°ä»£ç // æµ‹è¯•ç”¨ä¾‹Trim&lt;&#x27; semlinker &#x27;&gt;//=&gt; &#x27;semlinker&#x27; è§£å†³æ–¹æ¡ˆ12345678type TrimLeft&lt;V extends string&gt; = V extends ` $&#123;infer R&#125;` ? TrimLeft&lt;R&gt; : V;type TrimRight&lt;V extends string&gt; = V extends `$&#123;infer R&#125; ` ? TrimRight&lt;R&gt; : V;type Trim&lt;V extends string&gt; = TrimLeft&lt;TrimRight&lt;V&gt;&gt;;// æµ‹è¯•ç”¨ä¾‹type Result = Trim&lt;&#x27; semlinker &#x27;&gt;//=&gt; &#x27;semlinker&#x27; é¢˜ç›®ä¹å®ç°ä¸€ä¸ªIsEqualå·¥å…·ç±»å‹ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªç±»å‹æ˜¯å¦ç›¸ç­‰ã€‚å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š 123456type IsEqual&lt;A, B&gt; = // ä½ çš„å®ç°ä»£ç // æµ‹è¯•ç”¨ä¾‹type E0 = IsEqual&lt;1, 2&gt;; // falsetype E1 = IsEqual&lt;&#123; a: 1 &#125;, &#123; a: 1 &#125;&gt; // truetype E2 = IsEqual&lt;[1], []&gt;; // false è§£å†³æ–¹æ¡ˆ12345// æµ‹è¯•ç”¨ä¾‹type E0 = IsEqual&lt;1, 2&gt;; // falsetype E1 = IsEqual&lt;&#123; a: 1 &#125;, &#123; a: 1 &#125;&gt; // truetype E2 = IsEqual&lt;[1], []&gt;; // falsetype IsEqual&lt;A, B&gt; = [A] extends [B]? ([B] extends [A]? true:false ): false // ä½ çš„å®ç°ä»£ç  é¢˜ç›®å ä»¥ä¸‹ä¸¤è€…éƒ½æ˜¯ç›¸ç±»ä¼¼çš„ç±»å‹æ¨å€’ å®ç°ä¸€ä¸ªè·å–æ•°ç»„ç¬¬ä¸€ä¸ªä½ç½®çš„ç±»å‹ HEAD 12345// æµ‹è¯•ç”¨ä¾‹type H0 = Head&lt;[]&gt; // nevertype H1 = Head&lt;[1]&gt; // 1type H2 = Head&lt;[3, 2]&gt; // 3type Head&lt;T extends Array&lt;any&gt;&gt; = T extends [infer A, ...infer B] ? A :never// ä½ çš„å®ç°ä»£ç  å®ç°ä¸€ä¸ªè·å–æ•°ç»„æœ€åä¸€ä¸ªä½ç½®çš„ç±»å‹TAIL 123456// æµ‹è¯•ç”¨ä¾‹type T0 = Tail&lt;[]&gt; // []type T1 = Tail&lt;[1, 2]&gt; // [2]type T2 = Tail&lt;[1, 2, 3, 4, 5]&gt; // [2, 3, 4, 5]type Tail&lt;T extends Array&lt;any&gt;&gt; = T extends [...any, infer A] ? A : never // ä½ çš„å®ç°ä»£ç  é¢˜ç›®åä¸€å®ç°ä¸€ä¸ªUnshiftå·¥å…·ç±»å‹ï¼Œç”¨äºæŠŠæŒ‡å®šç±»å‹Eä½œä¸ºç¬¬ä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ° T æ•°ç»„ç±»å‹ä¸­ã€‚å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š 123456type Unshift&lt;T extends any[], E&gt; = // ä½ çš„å®ç°ä»£ç // æµ‹è¯•ç”¨ä¾‹type Arr0 = Unshift&lt;[], 1&gt;; // [1]type Arr1 = Unshift&lt;[1, 2, 3], 0&gt;; // [0, 1, 2, 3]å¤åˆ¶ä»£ç  å®ç°æ–¹æ³•123456type Unshift&lt;T extends any[], E&gt; = [E, ...T];// æµ‹è¯•ç”¨ä¾‹type Arr0 = Unshift&lt;[], never&gt;; // [1]type Arr1 = Unshift&lt;[1, 2, 3], 0&gt;; // [0, 1, 2, 3]å¤åˆ¶ä»£ç  æ–°å»ºä¸€ä¸ªæ•°ç»„ï¼Œç¬¬ä¸€é¡¹ç±»å‹ä¸ºEï¼Œå‰©ä½™ä½¿ç”¨...Tè¿æ¥ã€‚ é¢˜ç›®åäºŒå®ç°ä¸€ä¸ªShiftå·¥å…·ç±»å‹ï¼Œç”¨äºç§»é™¤Tæ•°ç»„ç±»å‹ä¸­çš„ç¬¬ä¸€ä¸ªç±»å‹ã€‚å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š 123456type Shift&lt;T extends any[]&gt; = // ä½ çš„å®ç°ä»£ç // æµ‹è¯•ç”¨ä¾‹type S0 = Shift&lt;[1, 2, 3]&gt; type S1 = Shift&lt;[string,number,boolean]&gt; å®ç°æ–¹æ¡ˆ1234// æµ‹è¯•ç”¨ä¾‹type S0 = Shift&lt;[1, 2, 3]&gt; type S1 = Shift&lt;[string,number,boolean]&gt; type Shift&lt;T extends any[]&gt; = T extends [infer A, ...infer B] ? B : [] // ä½ çš„å®ç°ä»£ç  ...infer Bå»é™¤ç¬¬ä¸€é¡¹ä¹‹åçš„é›†åˆï¼Œä½¿ç”¨å˜é‡Bä¿å­˜è¯¥ç±»å‹ã€‚å¦‚æœæ»¡è¶³çº¦æŸï¼Œè¿”å›å‰©ä½™å‚æ•°ç±»å‹ï¼Œä¹Ÿå°±æ˜¯Bã€‚ é¢˜ç›®åä¸‰å®ç°ä¸€ä¸ªPushå·¥å…·ç±»å‹ï¼Œç”¨äºæŠŠæŒ‡å®šç±»å‹Eä½œä¸ºç¬¬æœ€åä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ°Tæ•°ç»„ç±»å‹ä¸­ã€‚å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š 12345type Push&lt;T extends any[], V&gt; = // ä½ çš„å®ç°ä»£ç // æµ‹è¯•ç”¨ä¾‹type Arr0 = Push&lt;[], 1&gt; // [1]type Arr1 = Push&lt;[1, 2, 3], 4&gt; // [1, 2, 3, 4] è§£å†³æ–¹æ¡ˆ1234// æµ‹è¯•ç”¨ä¾‹type Arr0 = Push&lt;[], 1&gt; // [1]type Arr1 = Push&lt;[1, 2, 3], 4&gt; // [1, 2, 3, 4]type Push&lt;T extends any[], E&gt; = [...T, E] // ä½ çš„å®ç°ä»£ç  é¢˜ç›®åå››å®ç°ä¸€ä¸ªIncludeså·¥å…·ç±»å‹ï¼Œç”¨äºåˆ¤æ–­æŒ‡å®šçš„ç±»å‹Eæ˜¯å¦åŒ…å«åœ¨Tæ•°ç»„ç±»å‹ä¸­ã€‚å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š 1234type Includes&lt;T extends Array&lt;any&gt;, E&gt; = // ä½ çš„å®ç°ä»£ç type I0 = Includes&lt;[], 1&gt; // falsetype I1 = Includes&lt;[2, 2, 3, 1], 2&gt; // truetype I2 = Includes&lt;[2, 3, 3, 1], 1&gt; // true è§£å†³æ–¹æ³•12345type I0 = Includes&lt;[], 1&gt; // falsetype I1 = Includes&lt;[2, 2, 3, 1], 2&gt; // truetype I2 = Includes&lt;[2, 3, 3, 1], 1&gt; // truetype Includes&lt;T extends Array&lt;any&gt;, E&gt; = E extends T[number] ? true :false è¿™é‡ŒT[number]å¯ä»¥ç†è§£è¿”å›Tæ•°ç»„å…ƒç´ çš„ç±»å‹ï¼Œæ¯”å¦‚ä¼ å…¥çš„æ³›å‹Tä¸º[2, 2, 3, 1]ï¼Œé‚£ä¹ˆT[number]è¢«è§£æä¸ºï¼š2 | 2 | 3 | 1ã€‚ *é¢˜ç›®åäº”å®ç°ä¸€ä¸ªUnionToIntersectionå·¥å…·ç±»å‹ï¼Œç”¨äºæŠŠè”åˆç±»å‹è½¬æ¢ä¸ºäº¤å‰ç±»å‹ã€‚å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š 12345type UnionToIntersection&lt;U&gt; = // ä½ çš„å®ç°ä»£ç // æµ‹è¯•ç”¨ä¾‹type U0 = UnionToIntersection&lt;string | number&gt; // nevertype U1 = UnionToIntersection&lt;&#123; name: string &#125; | &#123; age: number &#125;&gt; // &#123; name: string; &#125; &amp; &#123; age: number; &#125; è§£å†³æ–¹æ¡ˆ1234567// æµ‹è¯•ç”¨ä¾‹type U0 = UnionToIntersection&lt;string | number&gt; // nevertype U1 = UnionToIntersection&lt;&#123; name: string &#125; | &#123; age: number &#125;&gt; // &#123; name: string; &#125; &amp; &#123; age: number; &#125;type UnionToIntersection&lt;U&gt; = ( U extends unknown ? (props: U)=&gt;void : never) extends (props2: infer P) =&gt; void ? P : never 1ã€extends unknownå§‹ç»ˆä¸ºtrueï¼Œé»˜è®¤è¿›å…¥åˆ°åˆ†å‘æƒ…å†µ 2ã€ä¼šå£°æ˜ä¸€ä¸ªä»¥Uä¸ºå…¥å‚ç±»å‹çš„å‡½æ•°ç±»å‹Aï¼Œå³(props: U) =&gt; voidï¼Œè¯¥å‡½æ•°çº¦æŸäºä»¥props2ç±»å‹ä¸ºå…¥å‚çš„å‡½æ•°ç±»å‹Bï¼Œå³(props2: infer P) =&gt; voidã€‚ 3ã€å¦‚æœå‡½æ•°Aèƒ½ç»§æ‰¿å‡½æ•°Båˆ™ è¿”å›infer På£°æ˜çš„Pï¼Œå¦åˆ™è¿”å›neverï¼Œå†åˆ©ç”¨å‡½æ•°å‚æ•°ç±»å‹é€†å˜ï¼Œä»è€Œå®ç°å¾—åˆ°çš„ç»“æœä»è”åˆç±»å‹åˆ°äº¤å‰ç±»å‹çš„è½¬å˜ã€‚ è¿™é‡Œæ˜¯ä¹Ÿè®¾è®¡åˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼šåˆ†å¸ƒå¼æ¡ä»¶ç±»å‹ï¼Œæ¡ä»¶ç±»å‹çš„ç‰¹æ€§ï¼šåˆ†å¸ƒå¼æ¡ä»¶ç±»å‹ã€‚åœ¨ç»“åˆè”åˆç±»å‹ä½¿ç”¨æ—¶ï¼ˆåªé’ˆå¯¹\\**extends**\\å·¦è¾¹çš„è”åˆç±»å‹**ï¼‰ï¼Œåˆ†å¸ƒå¼æ¡ä»¶ç±»å‹ä¼šè¢«è‡ªåŠ¨åˆ†å‘æˆè”åˆç±»å‹ã€‚ä¾‹å¦‚ï¼ŒT extends U ? X : Yï¼ŒTçš„ç±»å‹ä¸ºA | B | Cï¼Œä¼šè¢«è§£æä¸º(A extends U ? X : Y) | (B extends U ? X : Y) | (C extends U ? X : Y)ã€‚ éƒ½çŸ¥é“inferå£°æ˜éƒ½æ˜¯åªèƒ½å‡ºç°åœ¨extendså­è¯­å¥ä¸­ã€‚ä½†æ˜¯ï¼Œåœ¨åå˜çš„ä½ç½®ä¸Šï¼ŒåŒä¸€ç±»å‹å˜é‡çš„å¤šä¸ªå€™é€‰ç±»å‹ä¼šè¢«æ¨æ–­ä¸ºè”åˆç±»å‹ï¼š 123type Foo&lt;T&gt; = T extends &#123; a: infer U, b: infer U &#125; ? U : never;type T10 = Foo&lt;&#123; a: string, b: string &#125;&gt;; // stringtype T11 = Foo&lt;&#123; a: string, b: number &#125;&gt;; // string | number åœ¨é€†å˜çš„ä½ç½®ä¸Šï¼ŒåŒä¸€ä¸ªç±»å‹å¤šä¸ªå€™é€‰ç±»å‹ä¼šè¢«æ¨æ–­ä¸ºäº¤å‰ç±»å‹ï¼š 123type Bar&lt;T&gt; = T extends &#123; a: (x: infer U) =&gt; void, b: (x: infer U) =&gt; void &#125; ? U : never;type T20 = Bar&lt;&#123; a: (x: string) =&gt; void, b: (x: string) =&gt; void &#125;&gt;; // stringtype T21 = Bar&lt;&#123; a: (x: string) =&gt; void, b: (x: number) =&gt; void &#125;&gt;; // string &amp; number é¢˜ç›®åå…­ï¼ˆå…ƒç»„è½¬åŒ–ä¸ºå¯¹è±¡ï¼‰tså†…ç½®æ–¹æ³•å®ç°Exclude æ’é™¤ç±»å‹ä¾‹å­ï¼š 1234type Dir=&#x27;1&#x27;|&#x27;2&#x27;|&#x27;3&#x27;|&#x27;4&#x27;// type dir1 = &quot;3&quot; | &quot;4&quot;type dir1=Exclude&lt;Dir,&#x27;1&#x27;|&#x27;2&#x27;&gt; å®ç°ï¼š 1type MyExclude&lt;T, R&gt; = T extends R ? never :T Pick è·å– key ç±»å‹123type MyPick&lt;T, R extends keyof T&gt; = &#123; [Key in R]: T[Key]&#125; Omit æ’é™¤ key ç±»å‹1type MyOmit&lt;T, R extends keyof T&gt; = MyPick&lt;T, MyExclude&lt;keyof T, R&gt;&gt; Readonly å±æ€§åªè¯»123type MyReadonly&lt;T&gt; = &#123; readonly [Key in keyof T]: T[Key]&#125; Required å±æ€§å¿…é€‰123type MyRequired&lt;T&gt; = &#123; [Key in keyof T]-?:T[Key]&#125; Partial å±æ€§å¯é€‰123type MyPartial&lt;T&gt; = &#123; [Key in keyof T]?: T[Key]&#125; ReturnType è·å–å‡½æ•°è¿”å›ç±»å‹1type MyReturnType&lt;T extends (...args:any[])=&gt;any&gt; = T extends (...args:any[]) =&gt; infer R ? R :never Parameters è·å–å‡½æ•°å‚æ•°ç±»å‹1type MyParameters&lt;T extends (...args:any[])=&gt;any&gt; = T extends (...args:infer B) =&gt; any? B:never ts å®ç”¨èŒƒå‹å·¥å…·OptionalRequired éƒ¨åˆ†å±æ€§å¿…é€‰å®ç°ä¸€123456789101112131415161718/* * @Description: éƒ¨åˆ†å±æ€§å¿…é€‰ */export type OptionalRequired&lt;T,R extends keyof T&gt; = &#123; [key in R]-?: T[key]&#125; &amp; &#123; [key in Exclude&lt;keyof T, R&gt;]: T[key]&#125;type TestObj = &#123; a?:string, b:number, c?:object&#125;type OptionRequiredObjType = OptionalRequired&lt;TestObj,&#x27;a&#x27; | &#x27;c&#x27;&gt; å®ç°äºŒ1export type OptionRequired&lt;T,R extends keyof T&gt; = Required&lt;T&gt; &amp; Omit&lt;T, R&gt; OptionalReadonly éƒ¨åˆ†å±æ€§åªè¯»å®ç°ä¸€12345678910111213141516/* * @Description: éƒ¨åˆ†å±æ€§åªè¯» */export type OptionalReadonly&lt;T,R extends keyof T&gt; = &#123; readonly [key in R]: T[key]&#125; &amp; &#123; [key in Exclude&lt;keyof T, R&gt;]: T[key]&#125;type TestObj = &#123; a?:string, b:number, c?:object&#125;type OptionReadonlyObjType = OptionalReadonly&lt;TestObj,&#x27;a&#x27; | &#x27;c&#x27;&gt; å®ç°äºŒ1export type OptionalReadonly&lt;T,R extends keyof T&gt; = Omit&lt;T,R&gt; &amp; Readonly&lt;Pick&lt;T,R&gt;&gt; OptionalPartial éƒ¨åˆ†å±æ€§å¯é€‰å®ç°ä¸€1234567891011121314151617/* * @Description: éƒ¨åˆ†å¯é€‰ */type OptionalPartial&lt;T, R extends keyof T&gt; = &#123; [key in R]?: T[key]&#125; &amp; &#123; [key in Exclude&lt;keyof T, R&gt;]: T[key]&#125;type TestObj = &#123; a:string, b:number, c:object&#125;type OptionPartialObjType = OptionalPartial&lt;TestObj,&#x27;a&#x27; | &#x27;c&#x27;&gt; å®ç°äºŒ1type OptionalPartial&lt;T, R extends keyof T&gt; = Omit&lt;T, R&gt; &amp; Partial&lt;Pick&lt;T,R&gt;&gt;;","tags":["Typescript"],"categories":["Typescript"]},{"title":"tsä¹‹åå˜å’Œé€†å˜","path":"/2022/06/05/tsä¹‹åå˜å’Œé€†å˜/","content":"åå˜å’Œé€†å˜åå˜å’Œé€†å˜æ˜¯ç¼–ç¨‹ç†è®ºä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„è¯é¢˜ã€‚ç”¨äºè¡¨è¾¾çˆ¶ç±»å­ç±»åœ¨å®‰å…¨ç±»å‹è½¬æ¢åçš„å…¼å®¹æ€§ï¼ˆæˆ–è€…è¯´ç»§æ‰¿å…³ç³»ï¼‰ã€‚å®šä¹‰ä¸ºï¼šå¦‚æœAï¼ŒBä»£è¡¨ä¸¤ä¸ªç±»å‹ï¼›f()è¡¨ç¤ºç±»å‹è½¬æ¢ï¼›A -&gt; Bè¡¨ç¤ºAæ˜¯Bçš„å­ç±»ã€‚ å½“f()æ˜¯åå˜æ—¶ï¼šè‹¥ A -&gt; Bï¼Œåˆ™f(A) -&gt; f(B) å½“f()æ˜¯é€†å˜æ—¶ï¼šè‹¥ A -&gt; Bï¼Œåˆ™f(B) -&gt; f(A) å½“f()æ˜¯åŒå˜æ—¶ï¼šè‹¥ A -&gt; Bï¼Œåˆ™ä»¥ä¸Šå‡æˆç«‹ å½“f()æ˜¯ä¸å˜æ—¶ï¼šè‹¥ A -&gt; Bï¼Œåˆ™ä»¥ä¸Šå‡ä¸æˆç«‹ï¼Œæ²¡æœ‰å…¼å®¹å…³ç³» 1234567891011121314151617class Animal &#123; move()&#123; console.log(&quot;animal is moving&quot;); &#125;&#125;class Cat extends Animal &#123; purr() &#123; console.log(&quot;cat is purring&quot;); &#125;&#125;class WhiteCat extends Cat &#123; showoffColor() &#123; console.log(&quot;see my hair color&quot;); &#125;&#125; æˆ‘ä»¬æœ‰åä¸ºAnimialçš„çˆ¶ç±»ï¼ŒCatæ˜¯Animalçš„å­ç±»ã€‚WhiteCatæ˜¯Catçš„å­ç±»ï¼Œ å³WhiteCat -&gt; Cat -&gt; Animalã€‚æ ¹æ®çˆ¶ç±»å…¼å®¹å­ç±»çš„åŸåˆ™å¯çŸ¥ï¼š 1234567let animal: Animal;let cat: Cat;let whiteCat: WhiteCat;animal = cat;animal = whiteCat;cat = whiteCat; æŠ›å‡ºé—®é¢˜å‡å¦‚ç°åœ¨æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œç±»å‹ä¸º(param: Cat) =&gt; Catã€‚é‚£ä¹ˆå®ƒçš„å…¼å®¹ç±»å‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªé—®é¢˜åˆ†è§£æˆä¸¤ä¸ªéƒ¨åˆ†å‚æ•°å…¼å®¹æ€§å’Œè¿”å›å€¼å…¼å®¹æ€§ã€‚ (param: Cat) =&gt; voidçš„å…¼å®¹ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿ () =&gt; Catçš„å…¼å®¹ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿ å‚æ•°å…¼å®¹æ€§æˆ‘ä»¬å‡è®¾(param: Cat) =&gt; voidä¸ºAï¼Œæ­¤æ—¶æœ‰ä»¥ä¸‹ä¸¤ç§å‡½æ•°ï¼š B: (param: WhiteCat) =&gt; void Cï¼š(param: Animal) =&gt; void é‚£ä¹ˆAå…¼å®¹å“ªä¸€ä¸ªå‡½æ•°ï¼Ÿ å‡è®¾å…¼å®¹Bé‚£ä¹ˆæ­¤æ—¶ A = Bæˆç«‹ï¼š 12345678910let A: (param: Cat) =&gt; void;const B = (param: WhiteCat) =&gt; &#123; param.move(); param.purr(); param.showoffColor();&#125;;A = B;A(new Cat()); å‡½æ•°è¿è¡Œåˆ°param.showoffColor()ä¼šæŠ¥é”™ã€‚é‚£ä¹ˆå‡è®¾ä¸æˆç«‹ã€‚ å‡è®¾å…¼å®¹Cé‚£ä¹ˆæ­¤æ—¶ A = Cæˆç«‹ï¼š 12345678let A: (param: Cat) =&gt; void;const C = (param: Animal) =&gt; &#123; param.move();&#125;;A = C;A(new Cat()); æ­¤æ—¶å‡½æ•°æˆåŠŸè¿è¡Œã€‚é‚£ä¹ˆå‡è®¾æˆç«‹ã€‚ æ‰€ä»¥(param: Animal) =&gt; void -&gt; (param: Cat) =&gt; void ã€‚æ ¹æ®å‰é¢çš„å®šä¹‰å¯ä»¥çœ‹å‡ºå‡½æ•°å‚æ•°æ˜¯é€†å˜çš„ã€‚ è¿”å›å€¼å…¼å®¹æ€§æˆ‘ä»¬å‡è®¾() =&gt; Catä¸ºAï¼Œæ­¤æ—¶æœ‰ä»¥ä¸‹ä¸¤ç§å‡½æ•°ï¼š B: () =&gt; Animal Cï¼š() =&gt; WhiteCat é‚£ä¹ˆAå…¼å®¹å“ªä¸€ä¸ªå‡½æ•°ï¼Ÿ å‡è®¾å…¼å®¹Bé‚£ä¹ˆæ­¤æ—¶ A = Bæˆç«‹ï¼š 12345678let A: () =&gt; Cat;const B = () =&gt; new Animal();A = B;const result = A();result.move();result.purr(); å‡½æ•°è¿è¡Œåˆ°result.purr()ä¼šæŠ¥é”™ã€‚é‚£ä¹ˆå‡è®¾ä¸æˆç«‹ã€‚ å‡è®¾å…¼å®¹Cé‚£ä¹ˆæ­¤æ—¶ A = Cæˆç«‹ï¼š 12345678let A: () =&gt; Cat;const C = () =&gt; new WhiteCat();A = C;const result = A();result.move();result.purr(); æ­¤æ—¶å‡½æ•°æˆåŠŸè¿è¡Œã€‚é‚£ä¹ˆå‡è®¾æˆç«‹ã€‚ æ‰€ä»¥() =&gt; WhiteCat -&gt; () =&gt; Catã€‚æ ¹æ®å‰é¢çš„å®šä¹‰å¯ä»¥çœ‹å‡ºå‡½æ•°è¿”å›å€¼æ˜¯åå˜çš„ã€‚ å‡½æ•°å‚æ•°ç±»å‹çš„ç°å®åœ¨tsä¸­ï¼Œå‚æ•°ç±»å‹æ˜¯åŒå˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ—¢æ˜¯åå˜ï¼Œä¹Ÿæ˜¯é€†å˜ã€‚è¿™å½“ç„¶ä¸å®‰å…¨ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å¼€å¯strictFunctionTypesä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œä¿è¯å‚æ•°ç±»å‹æ˜¯é€†å˜ã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆtsä¼šè®©å‡½æ•°å‚æ•°ç±»å‹ä¿ç•™åŒå˜è½¬æ¢å‘¢ï¼Ÿä¸‹é¢æ˜¯ä¸€ä¸ªååˆ†å¸¸è§çš„ä¾‹å­ï¼š 1234567891011121314interface Event &#123; timestamp: number; &#125;interface MouseEvent extends Event &#123; x: number; y: number &#125;function listenEvent(eventType: EventType, handler: (n: Event) =&gt; void) &#123; /* ... */&#125;// è™½ç„¶ä¸å®‰å…¨ï¼Œä¸”ç¼–è¯‘æ— æ³•é€šè¿‡ï¼Œä½†æ˜¯ååˆ†å¸¸è§çš„ä½¿ç”¨æ–¹å¼listenEvent(EventType.Mouse, (e: MouseEvent) =&gt; console.log(e.x, e.y));// ä¸ºäº†ä¿è¯ç¼–è¯‘é€šè¿‡ï¼Œåªèƒ½é€šè¿‡ä»¥ä¸‹æ–¹å¼listenEvent(EventType.Mouse, (e: Event) =&gt; console.log((e as MouseEvent).x, (e as MouseEvent).y));listenEvent(EventType.Mouse, ((e: MouseEvent) =&gt; console.log(e.x, e.y)) as (e: Event) =&gt; void); è€Œå¦‚æœå‡½æ•°å‚æ•°ç±»å‹æ˜¯åŒå˜ï¼Œé‚£ä¹ˆä¸Šé¢ç¬¬ä¸€ç§å½¢å¼çš„ä»£ç ä¹Ÿèƒ½é¡ºåˆ©é€šè¿‡ç¼–è¯‘ï¼Œæ— éœ€ä½¿ç”¨åä¸¤ç§ç»•è·¯çš„æ–¹å¼ã€‚","tags":["Typescript","åå˜å’Œé€†å˜"],"categories":["Typescript"]},{"title":"vueçš„å“åº”å¼ç³»ç»Ÿè®¾è®¡æ€»ç»“","path":"/2022/05/08/vueçš„å“åº”å¼ç³»ç»Ÿè®¾è®¡æ€»ç»“/","content":"vue3 - å“åº”å¼å­¦ä¹ å‰ç½®çŸ¥è¯†å‰¯ä½œç”¨å‡½æ•°å‰¯ä½œç”¨å‡½æ•°å°±æ˜¯æŒ‡çš„ä¼šäº§ç”Ÿå‰¯ä½œç”¨çš„å‡½æ•° 123function effect()&#123; document.body.innerHTML = &#x27;hello world&#x27;&#125; effectå‡½æ•°ä¼šç›´æ¥æˆ–è€…é—´æ¥çš„å½±å“åˆ°å…¶ä»–åœ°æ–¹å‡½æ•°çš„æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯”å¦‚ä¿®æ”¹ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå˜é‡å…¶ä»–åœ°æ–¹ä¹Ÿè¯»å–åˆ°äº† å“åº”å¼æ•°æ®å‡å¦‚ï¼Œæœ‰ä¸€ä¸ªå¼•ç”¨ç±»å‹å˜é‡, æœ‰ä¸€ä¸ªå‡½æ•°è¯»å–åˆ°ä»–çš„å±æ€§ 12345const obj = &#123; a: &#x27;wengkaimin&#x27; &#125;;function read()&#123; document.body.innerText = obj.a&#125; å½“æˆ‘ä»¬ä¿®æ”¹äº†obj.açš„å€¼çš„æ—¶å€™ï¼Œå¸Œæœ›readè¿™ä¸ªå‡½æ•°é‡æ–°æ‰§è¡Œï¼›å¦‚æœreadå‡½æ•°èƒ½å¤Ÿå› ä¸ºobj.açš„å€¼å˜åŒ–ï¼Œé‡æ–°è‡ªåŠ¨çš„æ‰§è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´objæ˜¯ä¸€ä¸ªå“åº”æ•°æ® å®ç°å“åº”å¼æ•°æ®æœ‰ä¸€ä¸ªdataæ•°æ® 1const data = &#123; a: 1 &#125;; ä»ä¸¤ä¸ªç‚¹å‡ºå‘å»å®ç°ï¼š å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šè§¦å‘è¯»å– data.açš„æ“ä½œ å½“ä¿®æ”¹äº†data.açš„å€¼çš„æ—¶å€™ï¼Œä¼šè§¦å‘data.açš„è®¾ç½®æ“ä½œ ä¸éš¾è”æƒ³åˆ°es5çš„Object.definePropertyå’Œes6çš„Proxyä»£ç†ï¼Œéƒ½æ˜¯ç”¨äºæ•°æ®çš„æ‹¦æˆªæ“ä½œï¼Œæˆ‘ä»¬åªè¦åšå¥½è¯»å’Œå–çš„æ‹¦æˆªæ“ä½œï¼Œå°±èƒ½å®ç°æ•°æ®çš„å“åº” åŸºæœ¬å®ç°å®ç°è¯»å– æ‹¦æˆªå½“æˆ‘ä»¬è¯»å–data.açš„æ—¶å€™ï¼Œé€šè¿‡æ‹¦æˆªå°†å‰¯ä½œç”¨å‡½æ•°åŠ å…¥åˆ°ä¸€ä¸ª â€œæ¡¶â€ çš„æ•°æ®ç»“æ„ä¸­ æ¥ç€æˆ‘ä»¬è®¾ç½®data.açš„æ—¶å€™æŠŠå‰¯ä½œç”¨å‡½æ•°å–å‡ºæ¥ æ¥ä¸‹æ¥æ‰§è¡Œå¯¹dataçš„ä»£ç†, objå°±æ˜¯ä»£ç†çš„å¯¹è±¡ 12345678910111213141516171819202122232425262728const buckect = new Set(); // æ¡¶const data = &#123; a: 1,&#125;;const obj = new Proxy(data, &#123; get(target, key) &#123; buckect.add(effect); return target[key]; &#125;, set(target, key, newVal) &#123; target[key] = newVal; // å–å‡ºå‰¯ä½œç”¨å‡½æ•°effect buckect.forEach((fn) =&gt; fn()); return true; &#125;,&#125;);const effect = () =&gt; &#123; document.body.innerText = obj.a;&#125;;effect();setTimeout(() =&gt; &#123; obj.a = 2;&#125;, 2000); Step1: å®Œå–„ç³»ç»Ÿä¸Šé¢çš„åŸºæœ¬å®ç°å­˜åœ¨å¾ˆå¤šç¼ºé™· ç¡¬ç¼–ç äº†å‰¯ä½œç”¨å‡½æ•°åç§° effect è¦æƒ³å‰¯ä½œç”¨å‡½æ•°è¢«æ­£ç¡®çš„æ”¶é›†åˆ° bucketå½“ä¸­ï¼Œå°±ä¸èƒ½ä½¿ç”¨ç¡¬ç¼–ç çš„å‡½æ•°å å› æ­¤ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªå‡½æ•°çš„æ³¨å†Œæœºåˆ¶ï¼Œç”¨äºæ³¨å†Œå‰¯ä½œç”¨å‡½æ•° 1234567let activeEffect;// æ³¨å†Œå‡½æ•°function effect(fn)&#123; activeEffect = fn; fn();&#125; ä½¿ç”¨effectåŒ…è£¹ è¯»å»äº†objçš„é‚£ä¸ªç®¡ä»–ä»€ä¹ˆå‡½æ•° 123effect(()=&gt;&#123; document.body.innerText = obj.a&#125;) ä¹‹åéœ€è¦åœ¨è¯»çš„æ‹¦æˆªå™¨ä¸­åšåˆ¤æ–­ 1234567891011121314const obj = new Proxy(data, &#123; get(target, key)&#123; if(activeEffect)&#123; // â• buckect.add(activeEffect); &#125; return target[key] &#125;, set(target, key, newVal)&#123; target[key] = newVal; // å–å‡ºå‰¯ä½œç”¨å‡½æ•°effect buckect.forEach(fn =&gt; fn()); return true &#125;&#125;) å±æ€§å’Œå‰¯ä½œç”¨å‡½æ•°å…³ç³»ä¸æ˜ç¡® ä¸Šé¢çš„æ¡¶æ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªsetï¼Œè¿™è‚¯å®šæ˜¯ä¸ç¬¦åˆæƒ…ç†çš„ï¼Œå› ä¸ºä¸€ä¸ªå¯¹è±¡å¯èƒ½å­˜åœ¨å¤šä¸ªå±æ€§ï¼Œä¸åŒçš„å±æ€§ä¹‹é—´å¯¹åº”çš„å‰¯ä½œç”¨å‡½æ•°ä¹Ÿæœ‰å¯èƒ½ä¸ä¸€æ · è¿™æ ·å°±ä¼šå¯¼è‡´ï¼Œæ— è®ºè¯»å–ä»€ä¹ˆå€¼ï¼ˆæ˜¯å¦å­˜åœ¨ï¼‰éƒ½ä¼šå»è§¦å‘å‰¯ä½œç”¨å‡½æ•°çš„é‡æ–°æ‰§è¡Œ 1234567891011121314151617181920212223242526272829303132333435363738394041const buckect = new Set(); // æ¡¶let activeEffect;const data = &#123; a: 1, b: 2,&#125;;const obj = new Proxy(data, &#123; get(target, key) &#123; if (activeEffect) &#123; // new buckect.add(activeEffect); &#125; return target[key]; &#125;, set(target, key, newVal) &#123; target[key] = newVal; // å–å‡ºå‰¯ä½œç”¨å‡½æ•°effect buckect.forEach((fn) =&gt; fn()); return true; &#125;,&#125;);// æ³¨å†Œå‡½æ•°function effect(fn) &#123; activeEffect = fn; fn();&#125;function setDoc() &#123; document.body.innerText = obj.a; console.log(&#x27;è§¦å‘äº†&#x27;)// obj.bçš„ä¿®æ”¹ä¹Ÿä¼šå¼•èµ·effecté‡æ–°&#125;effect(setDoc);setTimeout(() =&gt; &#123; obj.a = 2; obj.b = 3; // â•&#125;, 2000); å› æ­¤éœ€è¦é‡æ–°çš„è®¾è®¡æ¡¶ç»“æ„ï¼Œå°±ä¸èƒ½ç®€å•çš„ç”¨Setäº† å¤šä¸ªå±æ€§ï¼Œå¤šä¸ªå“åº”å¼æ•°æ®ï¼Œè¦æœ‰ä¸€ä¸€çš„å¯¹åº”å…³ç³» targetï¼šè¡¨ç¤ºä¸åŒçš„éœ€è¦ä»£ç†çš„å¼•ç”¨ç±»å‹æ•°æ®ï¼ˆå½“ç„¶ä¼šå­˜åœ¨å¾ˆå¤šä¸åŒçš„å¼•ç”¨æ•°æ®å•Šï¼‰ keyï¼šè¡¨ç¤ºå½“å‰çš„targeté‡Œå¤´ä¸åŒçš„keyï¼ˆä¸åŒçš„keyï¼Œè§¦å‘çš„å‰¯ä½œç”¨å‡½æ•°ä»¬ä¹Ÿä¸ä¸€æ ·ï¼Œè¿™é‡Œè¦åšåŒºåˆ†ï¼‰ targetå­˜åœ¨ä¸åŒçš„keyï¼Œæ‰€ä»¥ä¸åŒçš„keyä¹Ÿæœ‰ä¸åŒçš„å‰¯ä½œç”¨ 123function someFn()&#123; console.log(obj.a, obj.b)&#125; effectFnï¼šè¡¨ç¤ºtargetä¸‹é¢ï¼Œè¿™ä¸ªkeyæ‰€å¯¹åº”çš„æ‰€æœ‰å‰¯ä½œç”¨å‡½æ•° å› ä¸ºå­˜åœ¨ï¼Œä¾‹å¦‚obj.a è¢«Aå’ŒBæˆ–è€…Cç­‰ç­‰å…¶ä»–ä¸åŒå¼•ç”¨åœ°å€çš„å‡½æ•°è¯»å–çš„æƒ…å†µ 1234567function someFn()&#123; console.log(obj.a)&#125;function someFn2()&#123; console.log(obj.a)&#125; ç»¼ä¸Š è¿™ä¸ªbucketæ•°æ®ç»“æ„å¯ä»¥ä¸º bucket â€“ &gt; WeakMap ï¼ˆweakMapç”±targetçš„å¼•ç”¨ç»„æˆï¼‰ target â€” &gt; Map ï¼ˆmapç”±keyç»„æˆï¼‰ key â€” &gt; Set ï¼ˆSetå­˜å‚¨äº†å½“å‰keyå¯¹åº”çš„å‰¯ä½œç”¨å‡½æ•°ï¼‰ ä¿®æ”¹getæ‹¦æˆªå™¨123456789101112131415161718192021get(target, key)&#123; // å¦‚æœæ²¡æœ‰ activeEffectè¯´æ˜æ²¡æœ‰æ³¨å†Œè¿‡è¿™ä¸ªå‰¯ä½œç”¨å‡½æ•°ï¼Œç›´æ¥return if(!activeEffect) return; // â• // æ ¹æ®targtä»£ç†å¼•ç”¨ï¼Œå–å¾—å®ƒå¯¹åº”çš„mapï¼Œå¯¹åº”å…³ç³»target --- &gt; Map const depsMap = buckect.get(target); // â• // å‡å¦‚è¯´è¿™ä¸ªmapä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±newä¸€ä¸ªmapï¼Œä¸targetå¼•ç”¨å…³è” if(!depsMap) &#123; // â• buckect.set(target, (depsMap = new Map())) // â• &#125; // å†æ ¹æ®keyä»mapä¸­å–å¾—keyå¯¹åº”çš„Setï¼Œkey ---&gt; Set // Seté‡Œå¤´å­˜å‚¨äº†è¿™ä¸ªkeyå¯¹åº”çš„å‰¯ä½œç”¨å‡½æ•° const deps = depsMap.get(key); // â• if(!deps)&#123; // â• depsMap.set(key, (deps = new Set())) // â• &#125; // æœ€åå°†activeEffectåŠ å…¥åˆ°keyå¯¹åº”çš„Setå½“ä¸­ deps.add(activeEffect);// â• // è¿”å›å‡½æ•°å±æ€§ return target[key]&#125;, ä¿®æ”¹setæ‹¦æˆª12345678910111213 set(target, key, newVal)&#123; target[key] = newVal; // æ ¹æ®targetå¼•ç”¨ä»æ¡¶ä¸­å–å¾—å¯¹åº”çš„Map const depsMap = buckect.get(target); // â• if(!depsMap) return; // â• // å–å¾—target ä¸Škeyå¯¹åº”çš„Setæ•°æ®ï¼Œéå†ï¼Œæ‰§è¡Œé‡Œå¤´çš„å‰¯ä½œç”¨ const effects = depsMap.get(key);// â• if(effects)&#123; effects.forEach(fn =&gt; fn()) &#125; return true&#125; è¿™æ ·å°±å¯ä»¥é¿å…ä¿®æ”¹å…¶ä»–keyå€¼å¸¦æ¥çš„ä¸å¿…è¦çš„å‰¯ä½œç”¨æ‰§è¡Œï¼Œå¹¶ä¸”æ˜ç¡®äº†ä»£ç†ç›®æ ‡å’Œå‰¯ä½œç”¨å‡½æ•°ä¹‹é—´çš„å…³ç³» ä¼˜åŒ–è¿™ä¸€æ­¥éª¤æå–ä¸€ä¸‹getå’Œsetçš„é‡Œå¤´çš„ä¸€äº›é€»è¾‘ï¼Œä½œä¸ºå°è£…å‡½æ•°ã€‚ trackï¼šè¡¨ç¤ºè¿½è¸ªçš„å«ä¹‰ï¼Œè¿½è¸ªå‰¯ä½œç”¨å‡½æ•° triggerï¼šæ˜¯è¡¨ç¤ºè§¦å‘å‰¯ä½œç”¨çš„å‡½æ•° å®Œæ•´ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950let activeEffect;// æ³¨å†Œå‡½æ•°function effect(fn)&#123; activeEffect = fn; fn();&#125;function track(target,key)&#123; // å¦‚æœæ²¡æœ‰ activeEffectè¯´æ˜æ²¡æœ‰æ³¨å†Œè¿‡è¿™ä¸ªå‰¯ä½œç”¨å‡½æ•°ï¼Œç›´æ¥return if(!activeEffect) return; // æ ¹æ®targtä»£ç†å¼•ç”¨ï¼Œå–å¾—å®ƒå¯¹åº”çš„mapï¼Œå¯¹åº”å…³ç³»target --- &gt; Map let depsMap = buckect.get(target); // å‡å¦‚è¯´è¿™ä¸ªmapä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±newä¸€ä¸ªmapï¼Œä¸targetå¼•ç”¨å…³è” if(!depsMap) &#123; buckect.set(target, (depsMap = new Map())) &#125; // å†æ ¹æ®keyä»mapä¸­å–å¾—keyå¯¹åº”çš„Setï¼Œkey ---&gt; Set // Seté‡Œå¤´å­˜å‚¨äº†è¿™ä¸ªkeyå¯¹åº”çš„å‰¯ä½œç”¨å‡½æ•° let deps = depsMap.get(key); if(!deps)&#123; depsMap.set(key, (deps = new Set())) &#125; // æœ€åå°†activeEffectåŠ å…¥åˆ°keyå¯¹åº”çš„Setå½“ä¸­ deps.add(activeEffect);&#125;function trigger(target, key)&#123; // æ ¹æ®targetå¼•ç”¨ä»æ¡¶ä¸­å–å¾—å¯¹åº”çš„Map const depsMap = buckect.get(target); if(!depsMap) return; // å–å¾—target ä¸Škeyå¯¹åº”çš„Setæ•°æ®ï¼Œéå†ï¼Œæ‰§è¡Œé‡Œå¤´çš„å‰¯ä½œç”¨ const effects = depsMap.get(key); if(effects)&#123; effects.forEach(fn =&gt; fn()) &#125;&#125;const obj = new Proxy(data, &#123; get(target, key)&#123; track(target,key) // è¿”å›å‡½æ•°å±æ€§ return target[key] &#125;, set(target, key, newVal)&#123; target[key] = newVal; trigger(target, key) &#125;&#125;) ä¸ºä½•ç”¨WeakMapï¼šå› ä¸ºtargetçš„æ•°æ®æºæ˜¯ä¸ç¡®å®šçš„ï¼Œå­˜åœ¨æ•°æ®é‡éå¸¸å¤§çš„æƒ…å†µï¼Œå‡å¦‚ç”¨Mapä½œä¸ºæ•°æ®ç»“æ„ï¼Œåœ¨IIFEå½“ä¸­å…¶å®æ˜¯å¾ˆå¯èƒ½å­˜åœ¨å†…å­˜æº¢å‡ºçš„ç°è±¡ï¼› Step2: åŠ å¼ºç³»ç»Ÿå¥å£®æ€§è€ƒè™‘åˆ‡æ¢åˆ†æ”¯æƒ…å†µï¼ˆclean upï¼‰åœ¨å¼€å‘è¿‡ç¨‹ç»å¸¸ä¼šæœ‰æ¡ä»¶åˆ¤æ–­çš„æƒ…å†µï¼Œä¾‹å¦‚ï¼š 123456const data = &#123; a: true, b: &#x27;weng&#x27; &#125;;const obj = new Proxy(data, &#123;....&#125;);effect(function someFn()&#123; console.log(obj.a ? obj.b : &#x27;yes!&#x27;)&#125;) å½“someFnè§¦å‘çš„æ—¶å€™ï¼Œä¼šè¯»å–obj.aå’Œobj.bï¼Œä½†æ˜¯obj.båªæœ‰åœ¨obj.aä¸ºtrueçš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šæ‰“å°å‡ºæ¥ï¼Œè¿™æ—¶å€™someFnå·²ç»è¢«æ”¶é›†åˆ°äº†aå’Œbå„è‡ªå¯¹åº”çš„Setå½“ä¸­äº† å‡å¦‚æ”¹å˜obj.a ä¸ºfalseï¼Œä¼šè§¦å‘someFnå‰¯ä½œç”¨é‡æ–° æ‰§è¡Œï¼Œä½†æ˜¯ç”±äºobj.aå·²ç»æ˜¯falseäº†ï¼Œæ‰€ä»¥å°±ä¸å†è¯»å–åˆ°obj.bäº†ï¼› 1obj.a = false ä½†æ˜¯ç”±äºç¬¬ä¸€æ¬¡è¯»å–äº†bï¼Œå·²ç»å°†bçš„å‰¯ä½œç”¨å‡½æ•°someFnæ”¶é›†åˆ°äº†å¯¹äºçš„key â€“ &gt; Setå½“ä¸­äº† è¿™æ—¶å€™å¦‚æœå»æ”¹å˜obj.bçš„å€¼ï¼Œå…¶å®è¿˜æ˜¯ä¼šè§¦å‘someFn 123456789101112131415161718192021222324252627282930const data = &#123;a: true,b: &quot;weng&quot;,&#125;;const obj = new Proxy(data, &#123;get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return target[key];&#125;,set(target, key, newVal) &#123; target[key] = newVal; trigger(target, key);&#125;,&#125;);function someFn() &#123;console.log(obj.a ? obj.b : &quot;yes!&quot;);console.log(&#x27;è§¦å‘äº†&#x27;, bucket);&#125;effect(someFn);obj.a = false;setTimeout(() =&gt; &#123;obj.b = &#x27;kaimin&#x27;; // ä»ç„¶ä¼šè§¦å‘someFn&#125;, 1000); åˆ°è¿™é‡Œï¼Œç›®å‰è¿™å¥—ç³»ç»Ÿè¿˜æ²¡æœ‰ä¸€ç§èƒ½å¤Ÿæ¸…ç†è¿™ç§ åˆ†æ”¯åˆ‡æ¢ çš„æƒ…å†µçš„èƒ½åŠ› è§£å†³è¿™ç§é—®é¢˜çš„æ€è·¯ï¼š å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œç¬¬ä¸€æ­¥ï¼Œå…ˆæŠŠå®ƒä»ä¸ä¹‹å…³è”çš„ keyâ€”&gt;Setä¸­åˆ é™¤ å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œå®Œï¼Œå»é‡æ–°å»ºç«‹è”ç³»ï¼Œä½†æ˜¯åœ¨æ–°çš„è”ç³»ä¸­ï¼Œå°±ä¸ä¼šå†åŒ…å«å…¶ä»–é—ç•™çš„å‰¯ä½œç”¨å‡½æ•°äº† æ”¹é€ effect - 1è¦æƒ³çŸ¥é“è¿™ä¸ªå‰¯ä½œç”¨å‡½æ•°è¢«å“ªäº›å¯¹è±¡çš„å“ªäº›key â€“ &gt; Setæ”¶é›†äº†ï¼Œå¿…é¡»è¦çŸ¥é“å¦‚ä½•å»æ”¶é›†ä»¥åŠæ ‡è®°ä¸‹è¿™äº› key â€”&gt; Set æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ”¹é€ ä¸€ä¸‹å‰¯ä½œç”¨å‡½æ•°çš„æ³¨å†Œå‡½æ•°effectï¼Œç›®çš„åœ¨äºæ”¶é›† 12345678910// æ³¨å†Œå‡½æ•°function effect(fn)&#123; const effectFn = ()=&gt;&#123; activeEffect = effectFn; fn(); &#125; // ç”¨äºå­˜å‚¨æ‰€æœ‰ä¸è¯¥å‰¯ä½œç”¨å‡½æ•°ç›¸å…³çš„ä¾èµ–åˆé›† bucketæ¡¶ä¸­ key---&gt; Set çš„ Seté›†åˆ effectFn.deps = []; // deps: Array&lt;Set&gt; effectFn();&#125; depså°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ï¼Œç”¨äºæ”¶é›† ç”¨åˆ°è¿™ä¸ªå‰¯ä½œç”¨å‡½æ•°çš„é›†åˆçš„åœ°æ–¹ï¼Œå­˜å‚¨çš„å°†æ˜¯Setçš„å¼•ç”¨ æ”¹é€ trackæœ‰äº† æ”¶é›† Setçš„é›†åˆdepsï¼Œæ”¶é›†çš„æ—¶æœºä¹Ÿå¾ˆé‡è¦ï¼› çœ‹ä¹‹å‰çš„trackå‡½æ•°ï¼Œæ˜¯ä½œç”¨åœ¨getæ‹¦æˆªå™¨å½“ä¸­çš„ï¼Œå°† å½“å‰æ¿€æ´»çš„å‰¯ä½œç”¨å‡½æ•° å­˜å…¥Setå½“ä¸­ï¼Œå¦‚æœæ²¡æœ‰keyå¯¹åº”çš„Setï¼Œåˆ™ä¼šnewä¸€ä¸ªï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼Œæ”¶é›†depsçš„æ—¶æœºæ˜¯æœ€å¥½çš„ å› æ­¤æˆ‘ä»¬æ”¹é€ trackå‡½æ•° 1234567891011121314151617181920function track(target,key)&#123; // å¦‚æœæ²¡æœ‰ activeEffectè¯´æ˜æ²¡æœ‰æ³¨å†Œè¿‡è¿™ä¸ªå‰¯ä½œç”¨å‡½æ•°ï¼Œç›´æ¥return if(!activeEffect) return; // æ ¹æ®targtä»£ç†å¼•ç”¨ï¼Œå–å¾—å®ƒå¯¹åº”çš„mapï¼Œå¯¹åº”å…³ç³»target --- &gt; Map let depsMap = buckect.get(target); // å‡å¦‚è¯´è¿™ä¸ªmapä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±newä¸€ä¸ªmapï¼Œä¸targetå¼•ç”¨å…³è” if(!depsMap) &#123; buckect.set(target, (depsMap = new Map())) &#125; // å†æ ¹æ®keyä»mapä¸­å–å¾—keyå¯¹åº”çš„Setï¼Œkey ---&gt; Set // Seté‡Œå¤´å­˜å‚¨äº†è¿™ä¸ªkeyå¯¹åº”çš„å‰¯ä½œç”¨å‡½æ•° let deps = depsMap.get(key); if(!deps)&#123; depsMap.set(key, (deps = new Set())) &#125; // æœ€åå°†activeEffectåŠ å…¥åˆ°keyå¯¹åº”çš„Setå½“ä¸­ deps.add(activeEffect); // å°† é›†åˆ Set çš„å¼•ç”¨æ¨å…¥ å‰¯ä½œç”¨å‡½æ•°çš„depsé›†åˆé‡Œå¤´ â• activeEffect.caller.deps.push(deps); // â•&#125; æ”¹é€ effect - 2ï¼Œå®ç°cleanupæ¸…é™¤å‡½æ•°ä¸Šé¢æåˆ°ï¼Œè¦åœ¨å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œä¹‹å‰ï¼Œå°†äº‹å…ˆæ”¶é›†åˆ°çš„depsä¸­çš„æ‰€æœ‰å¯¹åº”çš„Setä¸­someFnåˆ æ‰ 123456789101112131415161718192021function cleanup(effectFn)&#123; for (let i = 0; i &lt; effectFn.caller.deps.length; i++) &#123; const deps = effectFn.deps[i]; // å°† effectFn ä»ä¾èµ–é›†åˆä»ç§»é™¤ deps.delete(effectFn) &#125; // æœ€åé‡ç½®ä¸€ä¸‹ deps effectFn.deps.length = 0&#125;// æ³¨å†Œå‡½æ•°function effect(fn)&#123; const effectFn = ()=&gt;&#123; cleanup(effectFn) activeEffect = effectFn; fn(); &#125; // ç”¨äºå­˜å‚¨æ‰€æœ‰ä¸è¯¥å‰¯ä½œç”¨å‡½æ•°ç›¸å…³çš„ä¾èµ–åˆé›† bucketæ¡¶ä¸­ key---&gt; Set çš„ Seté›†åˆ effectFn.deps = []; effectFn();&#125; æ”¹é€ triggerå‡½æ•°å› ä¸ºåœ¨å‰¯ä½œç”¨æ‰§è¡Œä¹‹å‰ï¼Œæˆ‘ä»¬è°ƒç”¨cleanupæ¸…é™¤åŒ…å«å‰¯ä½œç”¨å‡½æ•°çš„æ‰€æœ‰Setï¼Œä½†æ˜¯æ‰§è¡Œä¹‹ååˆæ”¶é›†äº†è¿›å»ã€‚é—®é¢˜å°±åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨triggerçš„æ—¶å€™ï¼Œå»éå†è¿™ä¸ªSetæ‰§è¡Œfnï¼ˆä½¿ç”¨çš„foreachï¼‰ foreachåœ¨éå†Setçš„æ—¶å€™ï¼Œå¦‚æœï¼Œä¸€ä¸ªå€¼è™½ç„¶è¢«è®¿é—®äº†ï¼Œä½†æ˜¯åœ¨éå†è¿‡ç¨‹ä¸­è¢«åˆ é™¤äº†ï¼Œåˆè¢«é‡æ–°çš„æ·»åŠ åˆ°äº†é›†åˆå½“ä¸­ï¼Œå¦‚æœéå†è¿‡ç¨‹è¿˜æ²¡æœ‰ç»“æŸçš„è¯ï¼Œå°±ä¼šé‡æ–°è¢«è®¿é—®ï¼Œä¸€ç›´åœ¨éå†ï¼Œæ‰€ä»¥éœ€è¦æ”¹é€ ä¸€ä¸‹ 12345678910function trigger(target, key)&#123; // æ ¹æ®targetå¼•ç”¨ä»æ¡¶ä¸­å–å¾—å¯¹åº”çš„Map const depsMap = bucket.get(target); if(!depsMap) return; // å–å¾—target ä¸Škeyå¯¹åº”çš„Setæ•°æ®ï¼Œéå†ï¼Œæ‰§è¡Œé‡Œå¤´çš„å‰¯ä½œç”¨ const effects = depsMap.get(key); if(effects)&#123; effects.forEach(fn =&gt; fn()); // é—®é¢˜æ‰€åœ¨ï¼Œ éå†çš„æ—¶å€™åœ¨æ‰§è¡Œå‰¯ä½œç”¨ï¼Œæ‰§è¡Œçš„æ—¶å€™åˆè¢«æ”¶é›†è¿›å»åˆ°åŒä¸€ä¸ªSetå½“ä¸­äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿è¿™ä¸ªéå†çš„effects Setæ›´æ¢ä¸ºå¦å¤–ä¸€ä¸ªå¼•ç”¨ &#125;&#125; æ”¹é€ å 1234567891011function trigger(target, key)&#123; // æ ¹æ®targetå¼•ç”¨ä»æ¡¶ä¸­å–å¾—å¯¹åº”çš„Map const depsMap = bucket.get(target); if(!depsMap) return; // å–å¾—target ä¸Škeyå¯¹åº”çš„Setæ•°æ®ï¼Œéå†ï¼Œæ‰§è¡Œé‡Œå¤´çš„å‰¯ä½œç”¨ const effects = depsMap.get(key); if(effects)&#123; const effectsClone = new Set(effects) // â• effectsClone.forEach(fn =&gt; fn()); // â• &#125;&#125; è¿™æ ·ï¼Œé‡æ–°çš„åˆ›å»ºä¸€ä¸ªSetçš„é›†åˆï¼Œå°±å¯ä»¥é¿å…æ— é™é€’å½’çš„æƒ…å†µäº† 123456789101112131415161718192021222324252627282930const data = &#123; a: true, b: &quot;weng&quot;,&#125;;const obj = new Proxy(data, &#123; get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return target[key]; &#125;, set(target, key, newVal) &#123; target[key] = newVal; trigger(target, key); &#125;,&#125;);function someFn() &#123; console.log(obj.a ? obj.b : &quot;yes!&quot;); console.log(&quot;è§¦å‘äº†&quot;, bucket);&#125;effect(someFn);obj.a = false;setTimeout(() =&gt; &#123; obj.b = &quot;kaimin&quot;; // ä¿®æ”¹bå€¼çš„æ—¶å€™ï¼Œä¸ä¼šå†è§¦å‘someFnäº†&#125;, 1000); è€ƒè™‘åµŒå¥—æ‰§è¡Œçš„æƒ…å†µ åœ¨MVVMæˆ–è€…MVCçš„æ¡†æ¶ä¸­ï¼Œéƒ½ä¼šå­˜åœ¨ï¼Œå¤šå±‚ç»„å»ºåµŒå¥—çš„æƒ…å†µ åœ¨vueä¸­çš„æ¯ä¸€ä¸ªç»„å»ºï¼Œå…¶å®éƒ½æ˜¯å­˜åœ¨ä¸€ä¸ªrenderå‡½æ•°çš„ã€‚ å¤šå±‚ç»„å»ºä¹‹é—´çš„åµŒå¥—ï¼Œåœ¨vueä¸­åˆæ¶‰åŠåˆ°äº†å“åº”å¼çš„æ•°æ®ï¼Œå› æ­¤å¯ä»¥å½“ä½œæ¯ä¸€ä¸ªç»„å»ºå¦‚æœä½¿ç”¨åˆ°äº†å“åº”å¼çš„æ•°æ®ï¼Œæ¯ä¸€ä¸ªrenderçš„å‡½æ•°å…¶å®éƒ½æ˜¯å¯ä»¥çœ‹æˆæ˜¯éœ€è¦åœ¨æ•°æ®å˜æ›´æ—¶å€™é‡æ–°æ‰§è¡Œçš„å‰¯ä½œç”¨ ç»„å»ºä¹‹é—´å‘ç”Ÿäº†åµŒå¥—ï¼Œå¯ä»¥çœ‹æˆ 12345678910111213141516171819// ç»„å»ºBconst B = &#123; render()&#123; return &#123;.....&#125; &#125;&#125;// ç»„å»ºAconst A = &#123; render()&#123; return &lt;B /&gt; &#125;&#125;// ç”±äºAä¸­åµŒå¥—äº†Bï¼Œæ‰€ä»¥å¯ä»¥ç†è§£ä¸ºeffect(()=&gt;&#123; A.render(); effect(()=&gt;&#123; B.render(); &#125;)&#125;) è¿™ç§ç±»ä¼¼çš„åµŒå¥—æƒ…å†µæ˜¯éå¸¸å¸¸è§çš„ï¼›ä½†æ˜¯æˆ‘ä»¬ç›®å‰çš„ç³»ç»Ÿæ˜¯ä¸æ”¯æŒåµŒå¥—çš„ ä¾‹ï¼š 12345678910111213141516171819202122const data = &#123; a:true, b:false &#125;;const obj = new Proxy(data, &#123;....&#125;);let temp1, temp2;function innerFn() &#123; console.log(&quot;run effect inner&quot;); temp2 = obj.b;&#125;function outerFn() &#123; console.log(&quot;run effect outer&quot;); effect(innerFn); temp1 = obj.a;&#125;effect(outerFn);setTimeout(() =&gt; &#123; obj.a = 3;&#125;, 2000); å¸¸ç†ä¸Šæˆ‘ä»¬ï¼Œç†æƒ³æˆ‘ä»¬éœ€è¦è¿™ç§æ”¶é›†çš„æƒ…å†µ åˆå§‹åŒ–æ‰§è¡Œç»“æœæ˜¯è¿™æ ·çš„ 12run effect outerrun effect inner è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å»æ”¹åŠ¨obj.açš„å€¼ è¾“å‡ºçš„ç»“æœä¸º 1run effect inner å‘ç°å¤–å±‚çš„effectå‡½æ•°å¹¶æ²¡æœ‰æ‰§è¡Œï¼Œè€Œåªæ˜¯æ‰§è¡Œäº†å†…å±‚çš„ è¿™æ˜¯ç”±äºï¼Œæˆ‘ä»¬çš„effectå‰¯ä½œç”¨çš„åŒ…è£¹å‡½æ•°çš„é—®é¢˜ï¼š 12345678910111213let activeEffect;// æ³¨å†Œå‡½æ•°function effect(fn)&#123; const effectFn = ()=&gt;&#123; cleanup(effectFn) activeEffect = effectFn; fn(); &#125; // ç”¨äºå­˜å‚¨æ‰€æœ‰ä¸è¯¥å‰¯ä½œç”¨å‡½æ•°ç›¸å…³çš„ä¾èµ–åˆé›† bucketæ¡¶ä¸­ key---&gt; Set çš„ Seté›†åˆ effectFn.deps = []; effectFn();&#125; æ¯æ¬¡æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°çš„æ—¶å€™ä¹‹å‰ï¼Œä¼šå°†å‰¯ä½œç”¨å‡½æ•°å¼•ç”¨èµ‹å€¼ç»™å…¨å±€éå†activeEffectï¼Œè€Œä¸”activeEffectåœ¨åŒä¸€æ—¶åˆ»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªã€‚ ç”±äºå‘ç”Ÿäº†åµŒå¥—ï¼Œç¬¬äºŒæ¬¡æ‰§è¡Œçš„å‰¯ä½œç”¨å‡½æ•°ç›´æ¥è¦†ç›–äº†ä¸Šä¸€å±‚èµ‹å€¼çš„activeEffect åœ¨trackå‡½æ•°ä¸­ï¼Œæœ€ç»ˆæ”¶é›†åˆ°çš„æ˜¯å†…å±‚çš„innerEffectå‰¯ä½œç”¨ ä½¿ç”¨å‰¯ä½œç”¨å‡½æ•°æ ˆå› ä¸ºåµŒå¥—å­˜åœ¨å¤šå±‚çš„æƒ…å†µï¼Œæ‰€ä»¥ï¼Œè€ƒè™‘ç”¨ä¸€ä¸ªå‰¯ä½œç”¨çš„å‡½æ•°æ ˆ è¿›è¡Œå­˜å‚¨ä¹‹å‰çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œä¿è¯ä¸ä¼šä¸¢å¤±ä¸Šä¸€å±‚çš„å‰¯ä½œç”¨å‡½æ•° æ¯æ¬¡çš„æ‰§è¡Œä¹‹å‰ï¼Œå°†å‰¯ä½œç”¨å‡½æ•°å‹å…¥è¿™ä¸ªæ ˆå½“ä¸­ï¼Œç­‰å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œå®Œä¹‹åï¼Œå†å°†å½“å‰æ‰§è¡Œå®Œçš„è¿™ä¸ªå‰¯ä½œç”¨å‡½æ•°ä»æ ˆä¸­å¼¹å‡ºï¼Œ å¹¶å§‹ç»ˆå°†activeEffectè¿™ä¸ªå…¨å±€ï¼ˆæ­£è¢«æ¿€æ´»çš„å‰¯ä½œç”¨å‡½æ•°ï¼‰æŒ‡å‘è¿™ä¸ªæ ˆé¡¶ 12// å…¨å±€åŠ å…¥effectStackæ ˆç»“æ„let effectStack=[] ä¸Šè¿°ä¾‹å­çš„æµç¨‹å¦‚ä¸‹ï¼š æ”¹é€ effectå‡½æ•° 1234567891011121314151617// æ³¨å†Œå‡½æ•°function effect(fn)&#123; const effectFn = ()=&gt;&#123; cleanup(effectFn) // å½“è°ƒç”¨effectæ³¨å†Œå‰¯ä½œç”¨å‡½æ•°æ—¶ï¼Œå°†å‰¯ä½œç”¨å‡½æ•°å¤åˆ¶ç»™activeEffect activeEffect = effectFn; // åœ¨è°ƒç”¨å‰¯ä½œç”¨å‡½æ•°ä¹‹å‰å°†å½“å‰å‰¯ä½œç”¨å‡½æ•°å‹å…¥æ ˆä¸­ effectStack.push(effectFn) // â• fn(); effectStack.pop(); // â• // æ‰§è¡Œå®Œä¹‹åï¼Œå¼¹å‡ºæ ˆï¼Œå¹¶æŠŠactiveEffectè¿˜åŸä¸ºä¹‹å‰çš„å€¼, æŒ‡å‘æ ˆé¡¶ activeEffect = effectStack[effectStack.length - 1] // â• &#125; // ç”¨äºå­˜å‚¨æ‰€æœ‰ä¸è¯¥å‰¯ä½œç”¨å‡½æ•°ç›¸å…³çš„ä¾èµ–åˆé›† bucketæ¡¶ä¸­ key---&gt; Set çš„ Seté›†åˆ effectFn.deps = []; effectFn();&#125; ä¿®æ”¹ä¹‹åï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œä¿®æ”¹äº†açš„å±æ€§ä¹‹åï¼Œä¼šæ­£å¸¸æ‰“å°ä¸¤æ¬¡æ•°æ® è€ƒè™‘è‡ªå¢ï¼ˆè‡ªå‡ï¼‰å€¼çš„æƒ…å†µ è‡ªå¢å°±æ˜¯ä¾‹å¦‚obj.a++è¿™æ ·çš„ è¿™ç§æƒ…å†µï¼Œç­‰ä»·äº obj.a = obj.a + 1 12345678910111213141516171819202122const data = &#123; a: 1,&#125;;const obj = new Proxy(data, &#123; get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return target[key]; &#125;, set(target, key, newVal) &#123; target[key] = newVal; trigger(target, key); &#125;,&#125;);function someFn() &#123; console.log((obj.a = obj.a + 1));&#125;effect(someFn); è¿™ç§æƒ…å†µå°±æ˜¯æ—¢è¯»å–äº†obj.açš„å€¼ï¼Œåˆè®¾ç½®äº†obj.açš„å€¼ï¼Œä¼šç›´æ¥çˆ†æ ˆï¼ŒåŸå› å¦‚ä¸‹ åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ï¼ˆè¿™é‡Œæˆ‘ä»¬å«åšAï¼Œè¡¨ç¤ºåˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œçš„ï¼‰ï¼Œé¦–å…ˆè¯»å–äº†obj.açš„å€¼ï¼Œè§¦å‘äº†trackå‡½æ•°ï¼Œä¼šå°†å½“å‰çš„å‰¯ä½œç”¨å‡½æ•°æ”¶é›†åˆ°æ¡¶ä¸­ã€‚ æ¥ç€å°†å…¶ + 1ä¹‹å é‡æ–°è®¾ç½®obj.açš„å€¼çš„æ—¶å€™ï¼Œè¢«setteræ‹¦æˆªï¼Œè¿™æ—¶å€™è§¦å‘äº†triggerå‡½æ•°ï¼ŒæŠŠå‰¯ä½œç”¨å‡½æ•°ï¼ˆè¿™é‡Œå«åšBï¼Œè¡¨ç¤ºèµ‹å€¼é€ æˆçš„ç¬¬äºŒæ¬¡æ‰§è¡Œï¼‰ä»æ¡¶ä¸­å–å‡ºæ‰§è¡Œ ä½†æ˜¯è¿™ä¸ªæ—¶å€™åˆå§‹åŒ–çš„é‚£æ¬¡å‰¯ä½œç”¨å‡½æ•°ï¼ˆAï¼‰è¿˜åœ¨æ‰§è¡Œï¼Œèµ‹å€¼æ“ä½œåªä¼šå†æ¬¡è§¦å‘è¢«æ”¶é›†çš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆäº§ç”Ÿäº†Bï¼‰ï¼Œå› æ­¤ä¼šæ— é™çš„é€’å½’èµ‹å€¼æ“ä½œåˆ°çˆ†æ ˆ å¢åŠ å®ˆå«å…¶å®ï¼Œè¿™ç§æƒ…å†µå¾ˆæ™®éï¼Œä¸å•å•æ˜¯è‡ªå¢çš„æƒ…å†µï¼Œä¹Ÿæœ‰å¯èƒ½å‰¯ä½œç”¨å‡½æ•°è¯»å–obj.aä¹‹åï¼Œç»è¿‡ä¸€ç•ªå¤„ç†è¿›è¡Œäº†é‡æ–°èµ‹å€¼ã€‚ 1234function someFn()&#123; const b = obj.a + ....; obj.a = b;&#125; é€ æˆä¸Šè¿°çš„é€’å½’ï¼Œæ˜¯å› ä¸ºä¸æ–­çš„è°ƒç”¨è‡ªèº«çš„å‰¯ä½œç”¨å‡½æ•°é€ æˆçš„ æ‰€ä»¥æˆ‘ä»¬åœ¨ç¬¬ä¸‰æ­¥éª¤æ‰§è¡Œçš„æ—¶å€™ï¼ŒåŠ ä¸€ä¸ªå®ˆå«ï¼Œå¦‚æœå½“å‰æ­£åœ¨æ‰§è¡Œçš„å‰¯ä½œç”¨å‡½æ•°å’Œtriggerè§¦å‘çš„å‰¯ä½œç”¨å‡½æ•°ç›¸åŒï¼Œåˆ™ä¸æ‰§è¡Œ æ”¹é€ triggerå‡½æ•° 12345678910111213141516171819function trigger(target, key)&#123; // æ ¹æ®targetå¼•ç”¨ä»æ¡¶ä¸­å–å¾—å¯¹åº”çš„Map const depsMap = buckect.get(target); if(!depsMap) return; // å–å¾—target ä¸Škeyå¯¹åº”çš„Setæ•°æ®ï¼Œéå†ï¼Œæ‰§è¡Œé‡Œå¤´çš„å‰¯ä½œç”¨ const effects = depsMap.get(key); const effectsToRun = new Set(); if(effects)&#123; effects.forEach((current)=&gt;&#123; if(current !== activeEffect)&#123; // å¦‚æœå½“å‰triggeræ‰§è¡Œçš„ï¼Œå’ŒactiveEffectä¸ä¸€æ ·ï¼ŒåŠ å…¥ effectsToRun.add(current) &#125; &#125;) &#125; effectsToRun.forEach((fn)=&gt;fn())&#125; æ”¹é€ ä¹‹åï¼Œå°±å¯ä»¥æ­£å¸¸çš„è¿›è¡Œå‰¯ä½œç”¨å‡½æ•°çš„æ”¶é›†å’Œæ‰§è¡Œäº† 123456789101112131415161718192021222324252627const data = &#123; a: 1,&#125;;const obj = new Proxy(data, &#123; get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return target[key]; &#125;, set(target, key, newVal) &#123; target[key] = newVal; trigger(target, key); &#125;,&#125;);function someFn() &#123; console.log((obj.a = obj.a + 1)); // ä¸ä¼šçˆ†æ ˆäº†&#125;effect(someFn);setTimeout(()=&gt;&#123; obj.a = 3; // æ­£å¸¸è§¦å‘æ”¶é›†åˆ°çš„å‰¯ä½œç”¨å‡½æ•°&#125;) è€ƒè™‘è°ƒåº¦å®ç°å“åº”å¼ç³»ç»Ÿæ¯”è¾ƒé‡è¦çš„å°±æ˜¯ï¼Œä¸€ä¸ªå¯è°ƒåº¦æ€§ï¼Œå¯è°ƒåº¦æ€§å¯ä»¥å°†æ§åˆ¶æƒåŠ›äº¤æ¥ç»™ç”¨æˆ·ã€‚ å¯è°ƒåº¦æ€§ï¼šæœ‰èƒ½åŠ› å†³å®šå‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œæ—¶æœºï¼Œæ‰§è¡Œæ¬¡æ•°ï¼Œä»¥åŠæ‰§è¡Œæ–¹å¼ æ¯”å¦‚ä¿®æ”¹äº†obj.açš„å€¼ï¼Œæ‰§è¡Œé¡ºåºæ˜¯ 123456789101112131415function someFn()&#123; console.log(obj.a)&#125;effect(someFn)obj.a++;console.log(&#x27;æˆ‘æ˜¯åˆ†å‰²&#x27;);// 1// 2// æˆ‘æ˜¯åˆ†å‰² å‡å¦‚æˆ‘æƒ³è°ƒæ•´æ‰“å°çš„é¡ºåºï¼Œéœ€è¦åœ¨æŸäº›æ¡ä»¶å»¶è¿Ÿå»æ‰§è¡Œè¿™ä¸ªå‰¯ä½œç”¨å‡½æ•° 123// 1// æˆ‘æ˜¯åˆ†å‰²// 2 æˆ‘ä»¬å¯ä»¥è¿™æ ·è®¾è®¡ ç»™effectå‡½æ•°åŠ ä¸Šè°ƒåº¦çš„å‚æ•° 1234567effect(effectFn, options)options = &#123; scheduler(effectFn)&#123; .... &#125;&#125; å› æ­¤ï¼Œå¯ä»¥æƒ³åˆ°ï¼Œæˆ‘ä»¬åœ¨triggerå‡½æ•°ä¸­è¿›è¡Œå‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œå¦‚æœæœ‰è°ƒåº¦å™¨ï¼Œæˆ‘ä»¬å°±å»æ‰§è¡Œç”¨æˆ·ä¼ é€’è¿›æ¥çš„è°ƒåº¦å™¨ï¼Œå°†å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œæƒåˆ©æŠ›ç»™å¤–ç•Œæ§åˆ¶ effectåŠ å…¥è°ƒåº¦å‡½æ•°å‚æ•°åŠ å…¥optionsï¼ŒæŒ‚è½½åˆ°effectFnä¸Š 123456789101112131415161718// æ³¨å†Œå‡½æ•°function effect(fn, options)&#123; // â• const effectFn = ()=&gt;&#123; cleanup(effectFn) // å½“è°ƒç”¨effectæ³¨å†Œå‰¯ä½œç”¨å‡½æ•°æ—¶ï¼Œå°†å‰¯ä½œç”¨å‡½æ•°å¤åˆ¶ç»™activeEffect activeEffect = effectFn; // åœ¨è°ƒç”¨å‰¯ä½œç”¨å‡½æ•°ä¹‹å‰å°†å½“å‰å‰¯ä½œç”¨å‡½æ•°å‹å…¥æ ˆä¸­ effectStack.push(effectFn) fn(); // æ‰§è¡Œå®Œä¹‹åï¼Œå¼¹å‡ºæ ˆï¼Œå¹¶æŠŠactiveEffectè¿˜åŸä¸ºä¹‹å‰çš„å€¼, æŒ‡å‘æ ˆé¡¶ activeEffect = effectStack[effectStack.length - 1] // â• &#125; // å°†è°ƒåº¦ç›¸å…³çš„å‚æ•°åŠ å…¥åˆ°å‰¯ä½œç”¨å‡½æ•°å½“ä¸­ effectFn.options = options; // â• // ç”¨äºå­˜å‚¨æ‰€æœ‰ä¸è¯¥å‰¯ä½œç”¨å‡½æ•°ç›¸å…³çš„ä¾èµ–åˆé›† bucketæ¡¶ä¸­ key---&gt; Set çš„ Seté›†åˆ effectFn.deps = []; effectFn();&#125; triggerè§¦å‘è°ƒåº¦éå† æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°çš„æ—¶å€™ï¼Œå»åˆ¤å®šæ˜¯å¦å…·æœ‰è°ƒåº¦å™¨ï¼Œæœ‰è°ƒåº¦å™¨å°±æ‰§è¡Œè°ƒåº¦å™¨ï¼Œå¹¶å°†å‰¯ä½œç”¨å‡½æ•°æ‰§è¡ŒæƒåŠ›äº¤ç»™ç”¨æˆ·ï¼Œå¦åˆ™å°±é»˜è®¤æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•° 12345678910111213141516171819202122232425function trigger(target, key)&#123; // æ ¹æ®targetå¼•ç”¨ä»æ¡¶ä¸­å–å¾—å¯¹åº”çš„Map const depsMap = buckect.get(target); if(!depsMap) return; // å–å¾—target ä¸Škeyå¯¹åº”çš„Setæ•°æ®ï¼Œéå†ï¼Œæ‰§è¡Œé‡Œå¤´çš„å‰¯ä½œç”¨ const effects = depsMap.get(key); const effectsToRun = new Set(); if(effects)&#123; effects.forEach((current)=&gt;&#123; if(current !== activeEffect)&#123; // å¦‚æœå½“å‰triggeræ‰§è¡Œçš„ï¼Œå’ŒactiveEffectä¸ä¸€æ ·ï¼ŒåŠ å…¥ effectsToRun.add(current) &#125; &#125;) &#125; effectsToRun.forEach((fn)=&gt;&#123; if(fn.options.scheduler)&#123; // â• fn.options.scheduler(fn) // â• &#125;else&#123; fn() &#125; &#125;) &#125; ä¸Šè¿°çš„ä¾‹å­å°±å¯ä»¥è¿™æ ·å®ç°äº† 1234567891011121314151617181920212223242526272829303132const data = &#123; a: 1,&#125;;const obj = new Proxy(data, &#123; get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return target[key]; &#125;, set(target, key, newVal) &#123; target[key] = newVal; trigger(target, key); &#125;,&#125;);function someFn() &#123; console.log(obj.a);&#125;effect(someFn, &#123; scheduler(fn) &#123; setTimeout(() =&gt; &#123; fn(); &#125;, 0); &#125;,&#125;);obj.a++;console.log(&quot;æˆ‘æ˜¯åˆ†å‰²&quot;); è€ƒè™‘é˜²æŠ–æƒ…å†µåœ¨vue3ä¸­ï¼Œæˆ‘ä»¬å¤šæ¬¡åœ¨ä¸€æ¬¡æ‰§è¡Œä¸­ï¼Œä¾‹å¦‚å¯¹obj.aåšäº†3æ¬¡èµ‹å€¼æ“ä½œ 12345678910111213const data = &#123; a: 1 &#125;;const obj = new Proxy(data, &#123;...&#125;);function someFn()&#123; console.log(obj.a)&#125;effect(someFn)obj.a++;obj.a++;obj.a++; 3æ¬¡çš„è‡ªå¢æ“ä½œï¼Œvue3ä¸­åªä¼šæ‰“å°2æ¬¡ 121 // ç¬¬ä¸€æ¬¡æ˜¯åˆå§‹åŒ–çš„æ—¶å€™æ‰“å°çš„4 ä½†æ˜¯æˆ‘ä»¬çš„ç³»ç»Ÿä¼šæ‰“å°4æ¬¡ 12341234 å…¶å®æˆ‘ä»¬å…³æ³¨çš„åªæ˜¯æœ€åçš„ç»“æœï¼Œæ‰€ä»¥ç¬¬2 3æ¬¡çš„æ‰“å°æ•°æ®æˆ‘ä»¬å¹¶ä¸å…³å¿ƒï¼› å› æ­¤æˆ‘ä»¬å¯ä»¥åŸºäºè°ƒåº¦å™¨ï¼Œæ¥å…¥é˜²æŠ–ç³»ç»Ÿ å¾®ä»»åŠ¡é˜Ÿåˆ—å®ç°é˜²æŠ–1234567891011121314151617181920// å®šä¹‰ä»»åŠ¡é˜Ÿåˆ—const jobQueue = new Set();// ä½¿ç”¨promise.resolveåˆ›å»ºå¾®ä»»åŠ¡ï¼Œæ·»åŠ åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—const p = Promise.resolve();// ä¸€ä¸ªæ ‡å¿—ä»£è¡¨æ˜¯å¦æ­£åœ¨åˆ·æ–°é˜Ÿåˆ—let isFlushing = false;function flushJob()&#123; // å¦‚æœé˜Ÿåˆ—æ­£åœ¨åˆ·æ–°ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åš if(isFlushing) return; // è®¾ç½®true, ä»£ç æ­£åœ¨åˆ·æ–° isFlushing = true; // åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆ·æ–° jobQueue é˜Ÿåˆ— p.then(()=&gt;&#123; jobQueue.forEach((fn =&gt; fn())) &#125;).finally(()=&gt;&#123; // ç»“æŸåé‡ç½®isFlushing isFlushing = false; &#125;)&#125; 123456789effect(someFn, &#123; scheduler(fn)&#123; // æ¯æ¬¡è°ƒåº¦æ—¶ï¼Œå°†å‰¯ä½œç”¨å‡½æ•°æ·»åŠ åˆ°jobQueueé˜Ÿåˆ—ä¸­ jobQueue.add(fn); // è°ƒç”¨ flushJob åˆ·æ–°é˜Ÿåˆ— flushJob(); &#125;&#125;) å®šä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—jobQueue â€”&gt; Setï¼Œç›®çš„æ˜¯åˆ©ç”¨Setæ•°æ®ç»“æ„çš„è‡ªåŠ¨å»é‡èƒ½åŠ›ã€‚ scheduleråœ¨æ¯æ¬¡è°ƒç”¨ä¸€ä¸ªå‰¯ä½œç”¨å‡½æ•°çš„æ—¶å€™ï¼Œå°† å‰¯ä½œç”¨å‡½æ•°åŠ å…¥jobQueueï¼Œç„¶åå†è°ƒç”¨flushJobåˆ·æ–°é˜Ÿåˆ— flushJobå‡½æ•°å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œé€šè¿‡isFlushingå­—æ®µè¿›è¡Œé™åˆ¶ï¼Œåªæœ‰falseçš„æ—¶å€™æ‰æ‰§è¡Œï¼›åœ¨è¿›è¡Œçš„æ—¶å€™å°±æ˜¯true è¿™æ ·å¯ä»¥çŸ¥é“ï¼Œæ— è®ºæˆ‘ä»¬èµ°äº†å¤šå°‘æ¬¡çš„flushJobï¼Œæ¯ä¸ªå¾®ä»»åŠ¡çš„å‘¨æœŸå†…éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ï¼›ä¹‹ååœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œå¤´å®Œæˆå¯¹jobQueueçš„éå† å¤šæ¬¡ä¿®æ”¹å“åº”å¼çš„å€¼ï¼Œå…¶å®åœ¨vueä¸­ä¹Ÿæ˜¯ç±»ä¼¼è¿™æ ·çš„å®ç°ï¼Œåªæ˜¯æ¯”è¿™ä¸ªæ›´å®Œå–„ å¦‚ä¸Šçš„ä¾‹å­å°±å¯ä»¥å®ç°é˜²æŠ–çš„æ•ˆæœäº† 123456789101112131415161718192021const data = &#123; a: 1 &#125;;const obj = new Proxy(data, &#123;...&#125;);function someFn()&#123; console.log(obj.a)&#125;effect(someFn, &#123; scheduler(fn) &#123; jobQueue.add(fn); flushJob(); &#125;,&#125;)obj.a++;obj.a++;obj.a++;// æœ€ç»ˆåªä¼šæ‰“å°1 4 æ€»ç»“ä¸‹æ¥çš„ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141let activeEffect;const effectStack = [];const buckect = new WeakMap();const source = &#123; a: &#x27;wengkaimin&#x27;, b: &#x27;weng&#x27;&#125;// å®šä¹‰ä»»åŠ¡é˜Ÿåˆ—const jobQueue = new Set();// ä½¿ç”¨promise.resolveåˆ›å»ºå¾®ä»»åŠ¡ï¼Œæ·»åŠ åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—const p = Promise.resolve();// ä¸€ä¸ªæ ‡å¿—ä»£è¡¨æ˜¯å¦æ­£åœ¨åˆ·æ–°é˜Ÿåˆ—let isFlushing = false;function flushJob()&#123; // å¦‚æœé˜Ÿåˆ—æ­£åœ¨åˆ·æ–°ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åš if(isFlushing) return; // è®¾ç½®true, ä»£ç æ­£åœ¨åˆ·æ–° isFlushing = true; // åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆ·æ–° jobQueue é˜Ÿåˆ— p.then(()=&gt;&#123; jobQueue.forEach((fn =&gt; fn())) &#125;).finally(()=&gt;&#123; // ç»“æŸåé‡ç½®isFlushing isFlushing = false; &#125;)&#125;function cleanup(effectFn)&#123; for (let i = 0; i &lt; effectFn.deps.length; i++) &#123; const deps = effectFn.deps[i]; // å°† effectFn ä»ä¾èµ–é›†åˆä»ç§»é™¤ deps.delete(effectFn) &#125; // æœ€åé‡ç½®ä¸€ä¸‹ deps effectFn.deps.length = 0&#125;// æ³¨å†Œå‡½æ•°function effect(fn, options)&#123; // â• const effectFn = ()=&gt;&#123; cleanup(effectFn); // å½“è°ƒç”¨effectæ³¨å†Œå‰¯ä½œç”¨å‡½æ•°æ—¶ï¼Œå°†å‰¯ä½œç”¨å‡½æ•°å¤åˆ¶ç»™activeEffect activeEffect = effectFn; // åœ¨è°ƒç”¨å‰¯ä½œç”¨å‡½æ•°ä¹‹å‰å°†å½“å‰å‰¯ä½œç”¨å‡½æ•°å‹å…¥æ ˆä¸­ effectStack.push(effectFn); fn(); // æ‰§è¡Œå®Œä¹‹åï¼Œå¼¹å‡ºæ ˆï¼Œå¹¶æŠŠactiveEffectè¿˜åŸä¸ºä¹‹å‰çš„å€¼, æŒ‡å‘æ ˆé¡¶ activeEffect = effectStack[effectStack.length - 1]; // â• &#125; // å°†è°ƒåº¦ç›¸å…³çš„å‚æ•°åŠ å…¥åˆ°å‰¯ä½œç”¨å‡½æ•°å½“ä¸­ effectFn.options = options; // â• // ç”¨äºå­˜å‚¨æ‰€æœ‰ä¸è¯¥å‰¯ä½œç”¨å‡½æ•°ç›¸å…³çš„ä¾èµ–åˆé›† bucketæ¡¶ä¸­ key---&gt; Set çš„ Seté›†åˆ effectFn.deps = []; effectFn();&#125;function someFn()&#123; console.log(source.a)&#125;function someFn2()&#123; console.log(source.a)&#125;effect(someFn, &#123; scheduler(fn)&#123; // æ¯æ¬¡è°ƒåº¦æ—¶ï¼Œå°†å‰¯ä½œç”¨å‡½æ•°æ·»åŠ åˆ°jobQueueé˜Ÿåˆ—ä¸­ jobQueue.add(fn); // è°ƒç”¨ flushJob åˆ·æ–°é˜Ÿåˆ— flushJob(); &#125;&#125;)function track(target,key)&#123; // å¦‚æœæ²¡æœ‰ activeEffectè¯´æ˜æ²¡æœ‰æ³¨å†Œè¿‡è¿™ä¸ªå‰¯ä½œç”¨å‡½æ•°ï¼Œç›´æ¥return if(!activeEffect) return; // æ ¹æ®targtä»£ç†å¼•ç”¨ï¼Œå–å¾—å®ƒå¯¹åº”çš„mapï¼Œå¯¹åº”å…³ç³»target --- &gt; Map let depsMap = buckect.get(target); // å‡å¦‚è¯´è¿™ä¸ªmapä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±newä¸€ä¸ªmapï¼Œä¸targetå¼•ç”¨å…³è” if(!depsMap) &#123; buckect.set(target, (depsMap = new Map())) &#125; // å†æ ¹æ®keyä»mapä¸­å–å¾—keyå¯¹åº”çš„Setï¼Œkey ---&gt; Set // Seté‡Œå¤´å­˜å‚¨äº†è¿™ä¸ªkeyå¯¹åº”çš„å‰¯ä½œç”¨å‡½æ•° let deps = depsMap.get(key); if(!deps)&#123; depsMap.set(key, (deps = new Set())) &#125; // æœ€åå°†activeEffectåŠ å…¥åˆ°keyå¯¹åº”çš„Setå½“ä¸­ deps.add(activeEffect); // å°† é›†åˆ Set çš„å¼•ç”¨æ¨å…¥ å‰¯ä½œç”¨å‡½æ•°çš„depsé›†åˆé‡Œå¤´ activeEffect.deps.push(deps);&#125;function trigger(target, key)&#123; // æ ¹æ®targetå¼•ç”¨ä»æ¡¶ä¸­å–å¾—å¯¹åº”çš„Map const depsMap = buckect.get(target); if(!depsMap) return; // å–å¾—target ä¸Škeyå¯¹åº”çš„Setæ•°æ®ï¼Œéå†ï¼Œæ‰§è¡Œé‡Œå¤´çš„å‰¯ä½œç”¨ const effects = depsMap.get(key); const effectsToRun = new Set(); if(effects)&#123; effects.forEach((current)=&gt;&#123; if(current !== activeEffect)&#123; // å¦‚æœå½“å‰triggeræ‰§è¡Œçš„ï¼Œå’ŒactiveEffectä¸ä¸€æ ·ï¼ŒåŠ å…¥ effectsToRun.add(current) &#125; &#125;) &#125; effectsToRun.forEach((fn)=&gt;&#123; if(fn.options.scheduler)&#123; // â•è°ƒåº¦å™¨ fn.options.scheduler(fn) // â•è°ƒåº¦å™¨ &#125;else&#123; fn() &#125; &#125;) &#125;const obj = new Proxy(data, &#123; get(target, key)&#123; track(target,key) // è¿”å›å‡½æ•°å±æ€§ return target[key] &#125;, set(target, key, newVal)&#123; target[key] = newVal; trigger(target, key) &#125;&#125;) Step3: å®ç°lazy+computedç»¼ä¸Šæ‰€è¯´çš„ï¼Œå‰¯ä½œç”¨å‡½æ•°ï¼Œå…¶å®åœ¨æˆ‘ä»¬ç›®å‰çš„ç³»ç»Ÿéƒ½æ˜¯ä¼šç«‹å³æ‰§è¡Œçš„ï¼Œä½†æ˜¯å…¶å®æœ‰äº›æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯ä¸éœ€è¦å»åšç«‹åˆ»æ‰§è¡Œæˆ‘ä»¬çš„å‰¯ä½œç”¨å‡½æ•°çš„ æ‰€ä»¥ç»“åˆä¸Šé¢çš„optionså‰¯ä½œç”¨å‡½æ•°çš„å‚æ•°ï¼Œå…¶å®èƒ½å¤Ÿå’Œè°ƒåº¦å™¨ä¸€æ ·å»å®ç°æˆ‘ä»¬çš„lazyçš„èƒ½åŠ›ã€‚ 123456effect(()=&gt;&#123; console.log(obj.a)&#125;,&#123; scheduler()&#123;....&#125;, lazy:true // â•&#125;) å®ç°lazyæ•ˆæœ - æ”¹é€ effectå‡½æ•°å½“æˆ‘ä»¬åˆ¤æ–­lazyå­—æ®µä¸ºtrueçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¸ç«‹å³æ‰§è¡Œeffectå‡½æ•° 1234567891011121314151617181920212223// æ³¨å†Œå‡½æ•°function effect(fn, options)&#123; const effectFn = ()=&gt;&#123; cleanup(effectFn); // å½“è°ƒç”¨effectæ³¨å†Œå‰¯ä½œç”¨å‡½æ•°æ—¶ï¼Œå°†å‰¯ä½œç”¨å‡½æ•°å¤åˆ¶ç»™activeEffect activeEffect = effectFn; // åœ¨è°ƒç”¨å‰¯ä½œç”¨å‡½æ•°ä¹‹å‰å°†å½“å‰å‰¯ä½œç”¨å‡½æ•°å‹å…¥æ ˆä¸­ effectStack.push(effectFn); fn(); effectStack.pop(); // æ‰§è¡Œå®Œä¹‹åï¼Œå¼¹å‡ºæ ˆï¼Œå¹¶æŠŠactiveEffectè¿˜åŸä¸ºä¹‹å‰çš„å€¼, æŒ‡å‘æ ˆé¡¶ activeEffect = effectStack[effectStack.length - 1]; &#125; // å°†è°ƒåº¦ç›¸å…³çš„å‚æ•°åŠ å…¥åˆ°å‰¯ä½œç”¨å‡½æ•°å½“ä¸­ effectFn.options = options; // ç”¨äºå­˜å‚¨æ‰€æœ‰ä¸è¯¥å‰¯ä½œç”¨å‡½æ•°ç›¸å…³çš„ä¾èµ–åˆé›† bucketæ¡¶ä¸­ key---&gt; Set çš„ Seté›†åˆ effectFn.deps = []; // â• å¦‚æœoptionsä¸­ lazyä¸ºfalseï¼Œæ‰ç«‹å³æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•° if(!options.lazy)&#123; effectFn(); &#125; return effectFn // â•å°†å‰¯ä½œç”¨å‡½æ•°ä½œä¸ºè¿”å›å€¼è¿”å›å‡ºå»&#125; ä½†æ˜¯å…¶å®ï¼Œä½œä¸ºè¿”å›å€¼ï¼Œè¿”å›å‰¯ä½œç”¨å‡½æ•°å…¶å®æ„ä¹‰ä¸å¤§çš„ï¼Œå› ä¸ºä½ è¿˜å¾—æ‰‹åŠ¨æ‰§è¡Œ 1234const effectFn = effect(someFn, &#123; lazy:true // â•&#125;)effectFn() æ‰€ä»¥æˆ‘ä»¬å¼•å‡ºcomputed å®ç°computedä½†æ˜¯å‡å¦‚è¯´ï¼Œæˆ‘ä»¬çš„someFnï¼Œä¹Ÿå°±æ˜¯å‰¯ä½œç”¨å‡½æ•°æ˜¯ä¸€ä¸ª æœ‰è¿”å›å€¼çš„ å‡½æ•°ï¼Œç±»ä¼¼ getterï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æœ‰æ„æ€äº† 123456789function someFn()&#123; return obj.a + 1;&#125;const effectFn = effect(someFn, &#123; lazy:true // â•&#125;)const value = effectFn() å› æ­¤æˆ‘ä»¬å¯ä»¥å»é™¤æ‰‹åŠ¨æ‰§è¡Œçš„è¿™ä¸ªé€»è¾‘ï¼Œæ‰§è¡Œçš„æ—¶å€™ï¼Œå°†æ‰§è¡Œç»“æœè¿”å›ã€‚ å»å®ç°ä¸€ä¸ªcomputedçš„å·¥å‚å‡½æ•° 123456789101112131415161718function computed(getter)&#123; // æŠŠgetter ä½œä¸ºå‰¯ä½œç”¨å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªlazyçš„effect const effectFn = effect(getter, &#123; lazy: true &#125;) const obj = &#123; get value()&#123; return effectFn() // æ‰‹åŠ¨æ‰§è¡Œ &#125; &#125; return obj &#125;const testA = computed(()=&gt;&#123; return obj.a + 1&#125;) computedå‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ä¸€ä¸ªvalueå±æ€§ã€‚getterå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œç„¶ågetterå…¶å®å°±æ˜¯å‰¯ä½œç”¨å‡½æ•°ï¼Œç”¨ä»–åˆ›å»ºä¸€ä¸ªlazyçš„effectFnï¼Œç„¶åæˆ‘ä»¬å®šä¸€ä¸ªobjï¼Œåœ¨è®¿é—®objçš„æ—¶å€™å»æ‰§è¡Œgetterã€‚ æ”¹é€ effectå‡½æ•°æˆ‘ä»¬åœ¨effectFnå‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œå°†æ‰§è¡Œç»“æœè¿”å›å‡ºå» 12345678910111213141516171819202122232425// æ³¨å†Œå‡½æ•°function effect(fn, options)&#123; const effectFn = ()=&gt;&#123; cleanup(effectFn); // å½“è°ƒç”¨effectæ³¨å†Œå‰¯ä½œç”¨å‡½æ•°æ—¶ï¼Œå°†å‰¯ä½œç”¨å‡½æ•°å¤åˆ¶ç»™activeEffect activeEffect = effectFn; // åœ¨è°ƒç”¨å‰¯ä½œç”¨å‡½æ•°ä¹‹å‰å°†å½“å‰å‰¯ä½œç”¨å‡½æ•°å‹å…¥æ ˆä¸­ effectStack.push(effectFn); const res = fn(); // â• effectStack.pop(); // æ‰§è¡Œå®Œä¹‹åï¼Œå¼¹å‡ºæ ˆï¼Œå¹¶æŠŠactiveEffectè¿˜åŸä¸ºä¹‹å‰çš„å€¼, æŒ‡å‘æ ˆé¡¶ activeEffect = effectStack[effectStack.length - 1]; return res; // â• å°†å‡½æ•°æ‰§è¡Œç»“æœè¿”å›å‡ºå»ï¼Œå®ç°getterçš„æ•ˆæœ &#125; // å°†è°ƒåº¦ç›¸å…³çš„å‚æ•°åŠ å…¥åˆ°å‰¯ä½œç”¨å‡½æ•°å½“ä¸­ effectFn.options = options; // ç”¨äºå­˜å‚¨æ‰€æœ‰ä¸è¯¥å‰¯ä½œç”¨å‡½æ•°ç›¸å…³çš„ä¾èµ–åˆé›† bucketæ¡¶ä¸­ key---&gt; Set çš„ Seté›†åˆ effectFn.deps = []; // å¦‚æœoptionsä¸­ lazyä¸ºfalseï¼Œæ‰ç«‹å³æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•° if(!options.lazy)&#123; effectFn(); &#125; return effectFn // å°†å‰¯ä½œç”¨å‡½æ•°ä½œä¸ºè¿”å›å€¼è¿”å›å‡ºå»&#125; æ€»ç»“ä¸‹æ¥ï¼Œå°±æ˜¯lazyé…åˆgetterå®ç°ä¸€å¥—computedå‡½æ•° è¯•éªŒä¸€ä¸‹ï¼Œå°±å¯ä»¥å®ç°computedçš„æ•ˆæœäº† 1234567891011121314151617181920212223242526272829const data = &#123; a: 1,&#125;;const obj = new Proxy(data, &#123; get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return target[key]; &#125;, set(target, key, newVal) &#123; target[key] = newVal; trigger(target, key); &#125;,&#125;);function someFn() &#123; console.log(&quot;æ‰§è¡Œäº†getter&quot;); return obj.a + 1;&#125;const computedData = computed(someFn);console.log(computedData.value);setTimeout(() =&gt; &#123; obj.a = 3; // åœ¨æ”¹å˜å€¼å¾—çš„æ—¶å€™ä¹Ÿä¼šåšåˆ°åŒæ­¥çš„é‡æ–°è®¡ç®—&#125;, 2000); å®ç°ç¼“å­˜ ä¼˜åŒ–å¦‚ä¸Šçš„ä¾‹å­ï¼Œå‡å¦‚æˆ‘ä»¬è¯»å–äº†ä¸¤æ¬¡computedData 1234567891011121314151617181920212223242526272829const data = &#123; a: 1,&#125;;const obj = new Proxy(data, &#123; get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return target[key]; &#125;, set(target, key, newVal) &#123; target[key] = newVal; trigger(target, key); &#125;,&#125;);function someFn() &#123; console.log(&quot;æ‰§è¡Œäº†getter&quot;); return obj.a + 1;&#125;const computedData = computed(someFn);console.log(computedData.value);setTimeout(() =&gt; &#123; console.log(computedData.value);&#125;, 2000); ä¼šå‘ç°ï¼Œæ‰§è¡Œäº†ä¸¤æ¬¡çš„getter 1234æ‰§è¡Œäº†getter2æ‰§è¡Œäº†getter2 æˆ‘ä»¬å¹¶æ²¡æœ‰å¯¹açš„å€¼è¿›è¡Œä¿®æ”¹ï¼Œè€Œæ˜¯é‡å¤è¯»å–äº†è€Œå·² åŸå› å¦‚ä¸‹ï¼š å½“æˆ‘ä»¬è¯»å– computedDataå€¼çš„æ—¶å€™ï¼Œæ‰ä¼šå»æ‰§è¡Œgetterå‰¯ä½œç”¨å‡½æ•°ã€‚ ä½†æ˜¯ç›®å‰çš„å®ç°ï¼Œæˆ‘ä»¬åœ¨æ¯æ¬¡è¯»å– computedDataçš„æ—¶å€™å…¶å®éƒ½ä¼šå°†getterå‰¯ä½œç”¨å‡½æ•°é‡æ–°æ‰§è¡Œä¸€éï¼Œå°±ç®—æ˜¯obj.aæ²¡æœ‰å˜åŒ–çš„æƒ…å†µä¸‹ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨obj.aæ²¡æœ‰å˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬å…¶å®å¹¶ä¸éœ€è¦å»é‡æ–°æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦å°†ç¬¬ä¸€æ¬¡è¯»å–çš„å€¼ç¼“å­˜ä¸‹æ¥å°±å¯ä»¥äº†ã€‚ æ”¹é€ computedå‡½æ•°åŠ å…¥ç¼“å­˜ï¼Œæˆ‘ä»¬å¯ä»¥å†computedä¸­ï¼Œåœ¨ç¬¬ä¸€æ¬¡è®¡ç®—çš„æ—¶å€™åŠ å…¥ç¼“å­˜å­—æ®µ - valueï¼Œé€šè¿‡dirtyè¡¨ç¤ºåˆ¤æ–­ï¼Œæ˜¯å¦éœ€è¦é‡æ–°è®¡ç®—æ–°çš„å€¼ï¼Œç»“åˆè°ƒåº¦å™¨å‚æ•°ï¼Œåœ¨ä¾èµ–æ”¹å˜çš„æ—¶å€™ï¼Œå»å›å½’dirtyå‚æ•° 123456789101112131415161718192021222324function computed(getter)&#123; let value; // â• ç¼“å­˜å€¼ let dirty = true; // trueè¡¨ç¤ºéœ€è¦é‡æ–°è®¡ç®—å€¼ â• // æŠŠgetter ä½œä¸ºå‰¯ä½œç”¨å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªlazyçš„effect const effectFn = effect(getter, &#123; lazy: true, scheduler()&#123; // â• dirty = true; // æ‰§è¡Œè°ƒåº¦ï¼Œtriggeræ‰§è¡Œçš„æ—¶å€™ï¼Œé‡æ–°è§¦å‘è°ƒåº¦ &#125; &#125;) const obj = &#123; get value()&#123; if(dirty)&#123; value = effectFn();// æ‰‹åŠ¨æ‰§è¡Œ dirty = false; // è®¾ç½®ä¸ºfalse â• &#125; return value // â• &#125; &#125; return obj &#125; è¿™æ ·æˆ‘ä»¬å°±èƒ½å°†è®¡ç®—å€¼ç¼“å­˜èµ·æ¥ã€‚ å¦‚ä¸‹çš„ä¾‹å­ï¼š 123456789101112131415161718192021222324252627const data = &#123; a: 1,&#125;;const obj = new Proxy(data, &#123; get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return target[key]; &#125;, set(target, key, newVal) &#123; target[key] = newVal; trigger(target, key); &#125;,&#125;);function someFn() &#123; console.log(&quot;æ‰§è¡Œäº†getter&quot;); return obj.a + 1;&#125;const computedData = computed(someFn);console.log(computedData.value)obj.a = 8; æˆ‘ä»¬å…ˆè®¿é—®äº†computedDataï¼Œä¼šè¿›è¡Œä¸€å±‚è®¡ç®—ï¼Œæ­¤åˆ»å¾—å€¼ä¸º2 ä¹‹åæˆ‘ä»¬ä¿®æ”¹äº†obj.açš„å€¼ï¼Œä¼šå»èµ°getter - ä¹Ÿå°±æ˜¯someFnï¼Œå› ä¸ºå­˜åœ¨è°ƒåº¦å™¨ï¼Œæ‰€ä»¥è¿™æ—¶å€™æ‰§è¡Œçš„æ˜¯someFnçš„è°ƒåº¦ï¼Œå°†dirtyè®¾ç½®ä¸ºäº†true æ‰€ä»¥åœ¨ä¸‹ä¸€æ¬¡è®¿é—®computedData.valueçš„æ—¶å€™ï¼Œå°±ä¼šé‡æ–°è®¡ç®—ï¼› å½“ç„¶ï¼Œå¦‚æœæ²¡æœ‰å»è°ƒç”¨obj.açš„èµ‹å€¼æ“ä½œï¼Œè¿™æ—¶å€™è®¿é—®çš„computedDataçš„æ—¶å€™å°±ä¸ä¼šé‡æ–°è®¡ç®—getter åµŒå¥—è¯»å–è®¡ç®—å±æ€§å€¼ ç¼ºé™·æˆ‘ä»¬ä½¿ç”¨è®¡ç®—å±æ€§çš„æ—¶å€™ï¼Œç»å¸¸ä¼šåœ¨æ¨¡æ¿æˆ–è€…æ˜¯å¦å¤–ä¸€ä¸ªå‰¯ä½œç”¨å‡½æ•°é‡Œå¤´ä½¿ç”¨ï¼Œä¾‹å¦‚ 12345678910111213141516171819202122232425262728293031323334const data = &#123; a: 1, b: 2,&#125;;const obj = new Proxy(data, &#123; get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return target[key]; &#125;, set(target, key, newVal) &#123; target[key] = newVal; trigger(target, key); &#125;,&#125;);function someFn() &#123; console.log(&quot;æ‰§è¡Œäº†getter&quot;); return obj.a + obj.b;&#125;const computedData = computed(someFn);function effectOuter() &#123; console.log(computedData.value);&#125;effect(effectOuter);setTimeout(() =&gt; &#123; obj.a++;&#125;, 2000); å¦å¤–ä¸€ä¸ªeffectå‡½æ•°ä¸­è¯»å–äº†è®¡ç®—æ•°æ®ï¼Œå½“æˆ‘ä»¬ä¿®æ”¹äº†obj.açš„å€¼ä¹‹åï¼Œå‘ç°å¹¶ä¸ä¼š æ‰“å°å‡º computedSum.valueä¹‹åçš„å€¼ å›å¤´çœ‹computedå‡½æ•°ï¼Œä¼šå‘ç°ï¼Œgetterå‡½æ•°ä½¿ç”¨åˆ°äº†obj.aå’Œobj.bï¼Œgetterè¢«æ”¶é›†åˆ°äº†a,bå¯¹åº”çš„Setå½“ä¸­ getteræ˜¯ä¸€ä¸ªå‰¯ä½œç”¨å‡½æ•°ï¼Œä¹Ÿæ˜¯æ˜¯è¢«effectåŒ…è£¹å¹¶ä¸”å¤„ç†ä¸ºæ‡’æ‰§è¡Œçš„å‡½æ•° å¦‚ä¸Šçš„æƒ…å†µï¼Œå°±æ˜¯å‘ç”Ÿäº†åµŒå¥—ï¼Œå¤–å±‚çš„effectåŒ…è£¹äº†å†…å±‚effectï¼Œè€Œå¤–å±‚çš„effectçœŸæ­£è¯»å–çš„æ˜¯computedSum.valueï¼Œè€Œè¿™ç©æ„å¹¶ä¸æ˜¯å“åº”å¼æ•°æ®ï¼Œä¹Ÿæ— æ³•æ”¶é›†åˆ°è¿™ä¸ªå¤–å±‚effectåŒ…è£¹çš„è¿™ä¸ªå‡½æ•°ã€‚ è€ŒçœŸæ­£å¤–å±‚å‰¯ä½œç”¨å‡½æ•°è¯»å–çš„å¼•ç”¨æ˜¯computedå†…å±‚çš„è¿™ä¸ªæ•°æ® computedSum.value â€”&gt; obj.value 123456789const obj = &#123; get value()&#123; if(dirty)&#123; value = effectFn();// æ‰‹åŠ¨æ‰§è¡Œ dirty = false; // è®¾ç½®ä¸ºfalse â• &#125; return value // â• &#125; &#125; æ‰€ä»¥ä¸ºäº†èƒ½å¤Ÿè¿½è¸ªåˆ°è¯»å–è®¡ç®—å±æ€§çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åµŒå…¥ trackå’Œtriggerï¼Œç”¨äºobjçš„è¿½è¸ªå’Œè§¦å‘ï¼Œè¿½è¸ªçš„æ˜¯objå¯¹è±¡çš„key ä¸ºvalue æ”¹é€ computedå‡½æ•°123456789101112131415161718192021222324252627function computed(getter)&#123; let value; // let dirty = true; // trueè¡¨ç¤ºéœ€è¦é‡æ–°è®¡ç®—å€¼ // æŠŠgetter ä½œä¸ºå‰¯ä½œç”¨å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªlazyçš„effect const effectFn = effect(getter, &#123; lazy: true, scheduler()&#123; dirty = true; // æ‰§è¡Œè°ƒåº¦ï¼Œtriggeræ‰§è¡Œçš„æ—¶å€™ï¼Œé‡æ–°è§¦å‘è°ƒåº¦ // å½“è®¡ç®—å±æ€§ä¾èµ–çš„å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæ‰‹åŠ¨çš„å»è°ƒç”¨triggerå‡½æ•°è§¦å‘ç›¸åº” trigger(obj, &#x27;value&#x27;) // â• &#125; &#125;) const obj = &#123; get value()&#123; if(dirty)&#123; value = effectFn();// æ‰‹åŠ¨æ‰§è¡Œ dirty = false; // è®¾ç½®ä¸ºfalse &#125; track(obj, &#x27;value&#x27;); // å½“è¯»å–è¿™ä¸ªvalueå€¼çš„æ—¶å€™ï¼Œæ‰‹åŠ¨è°ƒç”¨trackå‡½æ•° // â• return value; &#125; &#125; return obj &#125; å› æ­¤è¿™æ ·å°±å¯ä»¥è§£å†³è¯»å–è®¡ç®—å±æ€§çš„é—®é¢˜äº†ã€‚ 12345678910111213const data = &#123; a: 1, b: 2 &#125;;const obj = new Proxy(data, &#123;...&#125;);const computedData = computed(()=&gt; obj.a + obj.b);effect(function effectOuter()&#123; console.log(computedData.value)&#125;)setTimeout(()=&gt;&#123; obj.a++;&#125;, 2000) è¿™å°±æ ·å¯ä»¥æ‰“å°å‡ºä¿®æ”¹çš„ä¹‹åçš„computedçš„å€¼äº†ï¼Œå¹¶ä¸”æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•° ä»–ä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»å°±å¦‚å›¾æ‰€ç¤º Step4: å®ç°watchvue3ä¸­çš„wacthå‡½æ•°ç”¨æ³• 123456wactch(obj, ()=&gt;&#123; console.log(&#x27;å˜åŒ–æ•°æ®&#x27;)&#125;)// ä¿®æ”¹obj.a++; è§‚æµ‹objçš„å€¼çš„æ”¹å˜ï¼Œä»è€Œè§¦å‘æ•°æ®å˜åŒ– ä¸»è¦æ˜¯ç”±ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯è§‚æµ‹çš„æ•°æ®ï¼Œç¬¬äºŒä¸ªæ˜¯æ•°æ®å˜åŒ–æ—¶å€™è§¦å‘çš„å›è°ƒå‡½æ•° watchçš„å®ç°æœ¬è´¨å°±æ˜¯åˆ©ç”¨äº†effectå‡½æ•°options.schedulerè°ƒåº¦å™¨é€‰é¡¹ã€‚ å¯ä»¥ç†è§£ä¸ºï¼š 1234567effect(()=&gt;&#123; console.log(obj.a)&#125;, &#123; scheduler()&#123; // å½“obj.aå˜åŒ–çš„æ—¶å€™ï¼Œæ‰§è¡Œè°ƒåº¦å‡½æ•° &#125;&#125;) ä»ä¹‹å‰çš„è°ƒåº¦å™¨å±æ€§å¯ä»¥çœ‹åˆ°ï¼Œå½“å­˜åœ¨è°ƒåº¦å™¨çš„æ—¶å€™ï¼Œæ•°æ®å˜åŒ–ä¼šè§¦å‘è°ƒåº¦å™¨çš„æ‰§è¡Œ é¦–å…ˆè¦å…ˆè¯»å–watchçš„é‚£ä¸ªæ•°æ®ã€‚ åŸå§‹å€¼å¦‚ä½•å¤„ç† å¯¹è±¡é€’å½’å¤„ç† ç›®å‰æš‚æ—¶ä¸è€ƒè™‘å…¶ä»–çš„æ•°æ®ç»“æ„ watchçš„å›è°ƒå‡½æ•°ï¼Œå¯ä»¥ç›´æ¥åŠ å…¥è°ƒåº¦å™¨ä¸­æ‰§è¡Œï¼Œåˆ©ç”¨effectçš„getteréªšæ“ä½œè¿›è¡Œå“åº”å¼æ•°æ®çš„trackï¼Œä½†æ˜¯æœ€ç»ˆtriggerè§¦å‘çš„å‰¯ä½œç”¨å‡½æ•°å¹¶ä¸æ˜¯getterï¼Œè€Œæ˜¯è°ƒåº¦å™¨ å‡å¦‚æ˜¯å¦‚ä¸‹çš„åœºæ™¯ 123456789101112131415161718192021222324const data = &#123; a: 1,&#125;;const obj = new Proxy(data, &#123; get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return target[key]; &#125;, set(target, key, newVal) &#123; target[key] = newVal; trigger(target, key); &#125;,&#125;);watch(obj, () =&gt; &#123; console.log(&quot;æ”¹å˜äº†å€¼&quot;);&#125;);setTimeout(() =&gt; &#123; obj.a = 2;&#125;, 2000); è¿™ä¸ªæ—¶å€™å»æ”¹å˜açš„å€¼ï¼Œå¸Œæœ›èƒ½å¤Ÿå®ç°å’Œvueä¸­çš„ä¸€æ ·ï¼Œç›´æ¥æ‰§è¡Œè¿™ä¸ªå›è°ƒå‡½æ•° åŸºç¡€å®ç°scheduler + effect effectè¿›è¡Œæ•°æ®çš„è¯»å–è¿½è¸ªï¼Œschedulerä½œä¸ºè°ƒåº¦å™¨ 12345678// wacthåŸºæœ¬function watch(source, callback)&#123; effect(()=&gt; traverse(source),&#123; scheduler()&#123; callback() &#125; &#125;)&#125; é¦–å…ˆæˆ‘ä»¬è¦å¯¹watchçš„æ•°æ®è¿›è¡Œè¯»å– sourceåœ¨è¿™é‡ŒæŒ‡çš„æ˜¯ æ•°æ®æº å®ç°traverseå°è£…ä¸€ä¸ªé€šç”¨çš„è¯»å–æ“ä½œï¼Œèƒ½å¤Ÿä¿è¯sourceèƒ½å¤Ÿè¢«å®Œå…¨çš„è¯»å– 1234567891011121314function traverse(value, seen = new Set())&#123; // å¦‚æœè¦è¯»å–çš„æ•°æ®æ˜¯åŸå§‹å€¼ï¼Œæˆ–è€…å·²ç»è¢«è¯»å–è¿‡äº†ï¼Œé‚£ä¹ˆä»€ä¹ˆéƒ½ä¸åš if(typeof value !== &#x27;object&#x27; || value === null || seen.has(value)) return // å°†æ•°æ®æ·»åŠ åˆ°seenä¸­ï¼Œä»£è¡¨éå†çš„æ—¶å€™è¯»å–è¿‡äº†ï¼Œé¿å…å¾ªç¯å¼•ç”¨ seen.add(value); // ã€‚ã€‚ã€‚ã€‚ç›®å‰ä¸è€ƒè™‘æ•°ç»„ç­‰å…¶ä»–æ•°æ®ç»“æ„ // å‡è®¾valueæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä½¿ç”¨for...in...è¯»å–å¯¹è±¡çš„æ¯ä¸€ä¸ªå€¼ï¼Œé€’å½’è°ƒç”¨traverse for (const key in value) &#123; traverse(value[key], seen) &#125; return value;&#125; seen: æ˜¯ä¸€ä¸ªSetç»“æ„ï¼Œ è¿™å—é˜²æ­¢é‡å¤è¯»å–å¼•ç”¨ç±»å‹æ•°æ®é€ æˆstack overflow è¿™é‡Œç›´æ¥è€ƒè™‘vueä¸­deepçš„æƒ…å†µï¼Œç›®å‰æš‚æ—¶ä¸è€ƒè™‘å…¶ä»–çš„æ•°æ®ç»“æ„ï¼Œåªè€ƒè™‘å¯¹è±¡ç±»å‹ å‡½æ•°ç±»å‹å…¼å®¹åœ¨vueä¸­ï¼Œwatchç¬¬ä¸€ä¸ªå‚æ•°è¿˜èƒ½æ˜¯ä¸€ä¸ªgetterï¼Œåœ¨getterå†…éƒ¨ï¼Œå¯ä»¥æŒ‡å®šwacthå“ªäº›å“åº”å¼æ•°æ®ï¼Œåªæœ‰æ•°æ®å˜åŒ–çš„æ—¶å€™ï¼Œæ‰ä¼šè§¦å‘å›è°ƒ 123watch(()=&gt;obj.a,()=&gt;&#123; console.log(&#x27;ä¿®æ”¹äº†å€¼&#x27;)&#125;) å› æ­¤å¯¹sourceç±»å‹åšåˆ¤æ–­ï¼Œæ”¹é€ watch 12345678910111213141516// wacthåŸºæœ¬function watch(source, callback) &#123; // å®šä¹‰ä¸€ä¸ªgetter let getter; // â• // å¦‚æœsourceä¸ºå‡½æ•°, è¯´æ˜ä¼ è¿›æ¥äº†getterï¼Œæ‰€ä»¥sourceç›´æ¥ç­‰äºgetter if (typeof source === &quot;function&quot;) &#123; // â• getter = source; &#125; else &#123; getter = () =&gt; traverse(source); &#125; effect(() =&gt; getter(source), &#123; scheduler() &#123; callback(); &#125;, &#125;);&#125; è¿™æ ·æˆ‘ä»¬åœ¨ä¿®æ”¹aå€¼å¾—æ—¶å€™å°±å¯ä»¥å¦‚æ„¿æ£€æµ‹åˆ°æ•°æ®å˜åŒ–å¹¶ä¸”æ‰§è¡Œå›è°ƒå‡½æ•° 1234567891011121314151617181920212223242526const data = &#123; a: 1,&#125;;const obj = new Proxy(data, &#123; get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return target[key]; &#125;, set(target, key, newVal) &#123; target[key] = newVal; trigger(target, key); &#125;,&#125;);watch(obj, () =&gt; &#123; console.log(&quot;æ”¹å˜äº†å€¼&quot;);&#125;);// or ()=&gt; obj.asetTimeout(() =&gt; &#123; obj.a = 2;&#125;, 2000); æ–°å€¼å’Œæ—§å€¼åœ¨vueä¸­ä½¿ç”¨watchçš„æ—¶å€™ï¼Œç»å¸¸éœ€è¦ çŸ¥é“æ–°çš„å€¼ å’Œæ—§çš„å€¼ ä¼ å…¥å›è°ƒå‡½æ•°ä¹‹ä¸­ 123watch(obj, (newVal, oldVal) =&gt; &#123; console.log(&quot;æ”¹å˜äº†å€¼&quot;, newVal, oldVal);&#125;); æ‰€ä»¥éœ€è¦å®ç°ä¸€ä¸‹è¿™ç§èƒ½åŠ› éœ€è¦çŸ¥é“çš„ç‚¹ æ–°å€¼å’Œæ—§å€¼éƒ½æ˜¯ getterå‡½æ•°è§¦å‘æœ€ç»ˆçš„returnç»“æœ æ–°å€¼å’Œæ—§å€¼éœ€è¦ä¼ å…¥æˆ‘ä»¬çš„callbackå‡½æ•°å½“ä¸­ä½œä¸ºå‚æ•°æä¾›ç»™å¤–ç•Œ éœ€è¦å­˜å‚¨æ–°å€¼å’Œæ—§å€¼ éœ€è¦åŠ å…¥lazyå±æ€§ï¼Œåˆ›å»ºæ‡’æ‰§è¡Œeffect æ”¹é€ watch123456789101112131415161718192021// wacthåŸºæœ¬function watch(source, callback) &#123; // å®šä¹‰ä¸€ä¸ªgetter let getter; // å¦‚æœsourceä¸ºå‡½æ•°, è¯´æ˜ä¼ è¿›æ¥äº†getterï¼Œæ‰€ä»¥sourceç›´æ¥ç­‰äºgetter if (typeof source === &quot;function&quot;) &#123; getter = source; &#125; else &#123; getter = () =&gt; traverse(source); &#125; let oldValue; // â• æ—§å€¼ let newValue; // â• æ–°å€¼ const effectFn = effect(() =&gt; getter(source), &#123; lazy: true, // â• scheduler() &#123; newValue = effectFn(); // å°†æ‰§è¡Œç»“æœè¿”å›ç»™æ–°å€¼ â• ğŸ‚ğŸ‘ƒ callback(newValue, oldValue); oldValue = newValue; // æ¯æ¬¡è®°å½•ä¸Šä¸€æ¬¡çš„å€¼ â• &#125;, &#125;);&#125; è¿™é‡Œæœ€æ ¸å¿ƒçš„åœ°æ–¹å°±æ˜¯ä½¿ç”¨åˆ°äº†lazyåˆ›å»ºæ‡’æ‰§è¡Œçš„effectï¼› å¦‚ä¸‹è¿™ä¸ªä¾‹ï¼š 123456789101112131415161718192021222324252627const data = &#123; a: 1,&#125;;const obj = new Proxy(data, &#123; get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return target[key]; &#125;, set(target, key, newVal) &#123; target[key] = newVal; trigger(target, key); &#125;,&#125;);watch( () =&gt; obj.a, (newVal, oldVal) =&gt; &#123; console.log(&quot;æ”¹å˜äº†å€¼&quot;, oldVal, &quot;---&gt;&quot;, newVal); &#125;);setTimeout(() =&gt; &#123; obj.a = 2;&#125;, 2000); è¿™æ ·çš„è¯å°±å¯ä»¥è®°å½•ä¸‹æ¥æ—§å€¼äº† ç«‹å³æ‰§è¡Œvue3ä¸­çš„watchèƒ½å¤Ÿé€šè¿‡ immediateå‚æ•°ç«‹å³è¿›è¡Œæ‰§è¡Œ å½“immediateå‚æ•°èƒƒtrueçš„æ—¶å€™ï¼Œå›è°ƒå‡½æ•°å°±ä¼šåœ¨watchå‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œç«‹åˆ»æ‰§è¡Œä¸€æ¬¡å›è°ƒå‡½æ•° æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ”¹é€ ä¸‹watchåŠ å…¥immediateé…ç½®é¡¹ 1234567891011121314151617181920212223242526272829303132// wacthfunction watch(source, callback, options = &#123;&#125;) &#123; // å®šä¹‰ä¸€ä¸ªgetter let getter; // å¦‚æœsourceä¸ºå‡½æ•°, è¯´æ˜ä¼ è¿›æ¥äº†getterï¼Œæ‰€ä»¥sourceç›´æ¥ç­‰äºgetter if (typeof source === &quot;function&quot;) &#123; getter = source; &#125; else &#123; getter = () =&gt; traverse(source); &#125; let oldValue; // â• æ—§å€¼ let newValue; // â• æ–°å€¼ // æå–schedulerè°ƒåº¦å‡½æ•°ä¸ºä¸€ä¸ªç‹¬ç«‹çš„jobå‡½æ•° const job = () =&gt; &#123; newValue = effectFn(); // å°†æ‰§è¡Œç»“æœè¿”å›ç»™æ–°å€¼ â• callback(newValue, oldValue); oldValue = newValue; // æ¯æ¬¡è®°å½•ä¸Šä¸€æ¬¡çš„å€¼ â• &#125;; const effectFn = effect(() =&gt; getter(source), &#123; lazy: true, // â• scheduler: job, &#125;); if (options.immediate) &#123; job(); &#125; else &#123; oldValue = effectFn(); // ä¸æ˜¯immediateçš„æ—¶å€™ï¼Œå…¶å®åªæ˜¯å°†getterç¬¬ä¸€æ¬¡çš„æ‰§è¡Œç»“æœä¿å­˜ä¸ºoldValueï¼Œå¹¶ä¸æ‰§è¡Œcallback &#125;&#125; ç”±äºæ˜¯ç«‹å³æ‰§è¡Œï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡æ²¡æœ‰oldValueæ˜¯æ­£å¸¸çš„ å›è°ƒçš„æ—¶æœº å¤„ç†ç«‹å³æ‰§è¡Œä¹‹å¤–ï¼Œvueä¸­è¿˜èƒ½æŒ‡å®šå›è°ƒå‡½æ•°çš„æ‰§è¡Œæ—¶æœºï¼Œé€šè¿‡flushå‚æ•°è¿›è¡Œé™åˆ¶ flushï¼š â€™preâ€˜ â€˜postâ€™ â€˜syncâ€™ â€˜preâ€™çš„æ‰§è¡Œæ—¶æœºæš‚æ—¶å…ˆä¸å¤„ç†ï¼Œåç»­å¯ä»¥åŠ ä¸Šï¼Œå› ä¸ºæ¶‰åŠåˆ°ç»„ä»¶çš„æ›´æ–°æ—¶æœºã€‚ â€˜syncâ€˜çš„è¯ç›¸å½“äºåŒæ­¥æ‰§è¡Œ â€˜postâ€™åˆ™æ˜¯ä»£è¡¨è°ƒåº¦çš„å‡½æ•°éœ€è¦å°†å‰¯ä½œç”¨å‡½æ•°æ”¾åˆ°ä¸€ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç­‰domæ›´æ–°åè¿›è¡Œæ‰§è¡Œ æ”¹é€ watch123456789101112131415161718192021222324252627282930313233343536373839// wacthfunction watch(source, callback, options = &#123;&#125;) &#123; // å®šä¹‰ä¸€ä¸ªgetter let getter; // å¦‚æœsourceä¸ºå‡½æ•°, è¯´æ˜ä¼ è¿›æ¥äº†getterï¼Œæ‰€ä»¥sourceç›´æ¥ç­‰äºgetter if (typeof source === &quot;function&quot;) &#123; getter = source; &#125; else &#123; getter = () =&gt; traverse(source); &#125; let oldValue; // let newValue; // // æå–schedulerè°ƒåº¦å‡½æ•°ä¸ºä¸€ä¸ªç‹¬ç«‹çš„jobå‡½æ•° const job = () =&gt; &#123; newValue = effectFn(); // å°†æ‰§è¡Œç»“æœè¿”å›ç»™æ–°å€¼ callback(newValue, oldValue); oldValue = newValue; // æ¯æ¬¡è®°å½•ä¸Šä¸€æ¬¡çš„å€¼ &#125;; const effectFn = effect(() =&gt; getter(source), &#123; lazy: true, scheduler: ()=&gt; &#123; if(options.flush === &#x27;post&#x27;)&#123; // â• const p = Promise.resolve(); // â• p.then(job) // â• &#125;else&#123; job() &#125; &#125;, &#125;); if (options.immediate) &#123; job(); &#125; else &#123; oldValue = effectFn(); // ä¸æ˜¯immediateçš„æ—¶å€™ï¼Œå…¶å®åªæ˜¯å°†getterç¬¬ä¸€æ¬¡çš„æ‰§è¡Œç»“æœä¿å­˜ä¸ºoldValueï¼Œå¹¶ä¸æ‰§è¡Œcallback &#125;&#125; æˆ‘ä»¬åœ¨è°ƒåº¦å™¨è§¦å‘çš„æ—¶å€™ï¼Œæ£€æµ‹flushçš„ç±»å‹ï¼Œè¿›è€Œè¿›è¡Œä¸ä¸€æ ·çš„æ‰§è¡Œæ­¥éª¤ *ç«æ€æƒ…å†µä¾‹å¦‚å¦‚ä¸‹çš„æƒ…å†µ 1234567let data;watch(obj, async ()=&gt;&#123; // å‘é€è¯·æ±‚ç½‘ç»œè¯·æ±‚ const res = await axios.get(&#x27;/getData&#x27;); data = res&#125;) æˆ‘ä»¬ä¿®æ”¹äº†objçš„æŸä¸ªå€¼ï¼Œä¼šè§¦å‘getDataçš„è¯·æ±‚ï¼Œå‡å¦‚ï¼Œæˆ‘ä»¬åœ¨çŸ­æ—¶é—´å†…è¿ç»­ä¿®æ”¹äº†ï¼Œobjçš„å±æ€§ä¸¤æ¬¡ï¼Œå…¶å®ä¼šè§¦å‘ä¸¤æ¬¡getDataçš„è¯·æ±‚ å‡è®¾ç¬¬ä¸€æ¬¡å«åšAï¼Œç¬¬äºŒæ¬¡å«åšBã€‚å› ä¸ºä¸¤æ¬¡è¯·æ±‚è½åœ°çš„æ—¶æœºä¸ç›¸åŒï¼Œå¯èƒ½Bä¼šæ¯”Aå…ˆè½å®šï¼Œä½†æ˜¯ç”±äºï¼Œæˆ‘ä»¬ç¬¬äºŒæ¬¡ä¿®æ”¹è§¦å‘çš„è¯·æ±‚å¾—åˆ°çš„ç»“æœï¼Œæ‰æ˜¯æˆ‘ä»¬çœŸå®æƒ³è¦çš„ï¼Œä½†æ˜¯ç”±äºABè½å®šæ—¶æœºä¸ç¡®å®šï¼Œæˆ‘ä»¬æ— æ³•æ˜ç¡®æœ€ç»ˆæ˜¯å“ªä¸€æ¬¡è¯·æ±‚çš„å€¼èµ‹ç»™äº†dataã€‚è¿™ç§å°±å­˜åœ¨äº†ç«æ€çš„æƒ…å†µ ç”±äºBæ‰æ˜¯æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„ç»“æœï¼Œæ‰€ä»¥ æˆ‘ä»¬å¯ä»¥å½“Bä¸º â€œæœ€æ–°â€ï¼ŒAä¸ºâ€œè¿‡æœŸâ€çš„å‰¯ä½œç”¨å‡½æ•°äº§ç”Ÿçš„ åœ¨vueä¸­watchçš„å›è°ƒå‡½æ•°æœ‰ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå«åšonInvalidateï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯å½“å‰å‰¯ä½œç”¨å‡½æ•°è¿‡æœŸçš„æ—¶å€™æ‰§è¡Œçš„å›è°ƒ 1234567891011121314151617watch(obj, async (newValue, oldValue, onInvalidate)=&gt;&#123; // å®šä¹‰ä¸€ä¸ªæ ‡å¿—ï¼Œ ä»£è¡¨å½“å‰å‰¯ä½œç”¨å‡½æ•°æ˜¯å¦è¿‡æœŸï¼Œé»˜è®¤ä¸ºfalseï¼Œä»£è¡¨æ²¡æœ‰è¿‡æœŸ let expired = false; // è°ƒç”¨onInvalidate()å‡½æ•°æ³¨å†Œä¸€ä¸ªè¿‡æœŸçš„å›è°ƒ onInvalidate(()=&gt; &#123; // å½“è¿‡æœŸçš„æ—¶å€™ï¼Œå°†expiredçš„å­—æ®µè®¾ç½®ä¸ºtrue expired = true &#125;) // è·å–serveræ•°æ® const res = await axios.get(&#x27;/getData&#x27;); // åªæœ‰å½“è¯¥å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œæ²¡æœ‰è¿‡æœŸçš„æ—¶å€™ï¼Œæ‰ä¼šæ‰§è¡Œåç»­çš„æ“ä½œ if(!expired)&#123; data = res; &#125;&#125;) é€šè¿‡expiredçš„å˜é‡æ ‡è¯†ï¼Œåˆ¤æ–­å½“å‰å‰¯ä½œç”¨æ˜¯ä¸æ˜¯è¿‡æœŸäº†ã€‚æ²¡æœ‰è¿‡æœŸæ‰é‡‡ç”¨è¯·æ±‚ç»“æœ onInvalidateçš„åŸç†ï¼Œå°±æ˜¯æ¯æ¬¡watchå†…éƒ¨æ¯æ¬¡æ£€æµ‹åˆ°å˜åŒ–çš„æ—¶å€™ï¼Œåœ¨å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œä¹‹å‰ï¼Œé¦–å…ˆè°ƒç”¨onInvalidateå°±å¯ä»¥äº† å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨watchå‡½æ•°çš„å†…éƒ¨åŠ å…¥onInvalidtaeçš„é€»è¾‘ æ”¹é€ watch1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950// wacthfunction watch(source, callback, options = &#123;&#125;) &#123; // å®šä¹‰ä¸€ä¸ªgetter let getter; // å¦‚æœsourceä¸ºå‡½æ•°, è¯´æ˜ä¼ è¿›æ¥äº†getterï¼Œæ‰€ä»¥sourceç›´æ¥ç­‰äºgetter if (typeof source === &quot;function&quot;) &#123; getter = source; &#125; else &#123; getter = () =&gt; traverse(source); &#125; let cleanupEffect; // â• let oldValue; // æ—§å€¼ let newValue; // æ–°å€¼ function onInvalidate(fn)&#123; // â• // å°†è¿‡æœŸçš„å›è°ƒå­˜å‚¨åˆ° cleanupEffectä¸­ï¼Œä»¥æ–¹ä¾¿ä¸‹ä¸€æ¬¡è§¦å‘å›è°ƒä¹‹å‰è°ƒç”¨ cleanupEffect = fn; &#125; // æå–schedulerè°ƒåº¦å‡½æ•°ä¸ºä¸€ä¸ªç‹¬ç«‹çš„jobå‡½æ•° const job = () =&gt; &#123; newValue = effectFn(); // å°†æ‰§è¡Œç»“æœè¿”å›ç»™æ–°å€¼ // åœ¨è°ƒç”¨å›è°ƒå‡½æ•°callbackä¹‹å‰ï¼Œå…ˆè°ƒç”¨è¿‡æœŸçš„å›è°ƒå‡½æ•° if(cleanupEffect)&#123; // â• cleanupEffect() // â• &#125; callback(newValue, oldValue, onInvalidate); // â• oldValue = newValue; // æ¯æ¬¡è®°å½•ä¸Šä¸€æ¬¡çš„å€¼ &#125;; const effectFn = effect(() =&gt; getter(source), &#123; lazy: true, scheduler: ()=&gt; &#123; if(options.flush === &#x27;post&#x27;)&#123; const p = Promise.resolve(); p.then(job) &#125;else&#123; job() &#125; &#125;, &#125;); if (options.immediate) &#123; job(); &#125; else &#123; oldValue = effectFn(); // ä¸æ˜¯immediateçš„æ—¶å€™ï¼Œå…¶å®åªæ˜¯å°†getterç¬¬ä¸€æ¬¡çš„æ‰§è¡Œç»“æœä¿å­˜ä¸ºoldValueï¼Œå¹¶ä¸æ‰§è¡Œcallback &#125;&#125; å¼•å…¥onInvalidateçš„æ³¨å†Œå‡½æ•°ï¼Œæ¯æ¬¡æ‰§è¡Œjobçš„æ—¶å€™ï¼Œéƒ½ä¼šå»æå‰æŸ¥çœ‹ä¹‹å‰æ˜¯å¦æ³¨å†Œè¿‡cleanupEffectï¼Œæœ‰çš„è¯åœ¨æ‰§è¡Œä¹‹å‰éœ€è¦å»æ‰§è¡Œä¸€éã€‚ æ–¹ä¾¿ç†è§£çš„ä¸€ä¸ªä¾‹å­ä¾‹å¦‚å¦‚ä¸‹åœºæ™¯ 123456789101112131415161718192021222324watch(obj, async (newValue, oldValue, onInvalidate)=&gt;&#123; // å®šä¹‰ä¸€ä¸ªæ ‡å¿—ï¼Œ ä»£è¡¨å½“å‰å‰¯ä½œç”¨å‡½æ•°æ˜¯å¦è¿‡æœŸï¼Œé»˜è®¤ä¸ºfalseï¼Œä»£è¡¨æ²¡æœ‰è¿‡æœŸ let expired = false; // è°ƒç”¨onInvalidate()å‡½æ•°æ³¨å†Œä¸€ä¸ªè¿‡æœŸçš„å›è°ƒ onInvalidate(()=&gt; &#123; // å½“è¿‡æœŸçš„æ—¶å€™ï¼Œå°†expiredçš„å­—æ®µè®¾ç½®ä¸ºtrue expired = true &#125;) // è·å–serveræ•°æ® const res = await axios.get(&#x27;/getData&#x27;); // åªæœ‰å½“è¯¥å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œæ²¡æœ‰è¿‡æœŸçš„æ—¶å€™ï¼Œæ‰ä¼šæ‰§è¡Œåç»­çš„æ“ä½œ if(!expired)&#123; data = res; &#125;&#125;)// ç¬¬ä¸€æ¬¡ä¿®æ”¹obj.a++;setTimeout(()=&gt;&#123; obj.a++;&#125;,200) ä»¥ä¸Šä»£ç æˆ‘ä»¬ä¿®æ”¹äº†ä¸¤æ¬¡obj.a ç¬¬ä¸€æ¬¡syncç«‹å³æ‰§è¡Œï¼Œå¯¼è‡´watchçš„å›è°ƒæ‰§è¡Œã€‚åœ¨å›è°ƒå†…éƒ¨ï¼Œæˆ‘ä»¬è°ƒç”¨äº†onInvalidateï¼Œè¿™æ—¶å€™å°±ä¼šåœ¨watchå†…éƒ¨æ³¨å†Œä¸€ä¸ªcleanupEffectï¼Œç„¶åå‘é€è¯·æ±‚Aï¼ˆå‡è®¾Aç”¨äº†2000msæ‰è¿”å›ï¼‰ ç¬¬äºŒæ¬¡200msååˆä¿®æ”¹äº†obj.aï¼Œåˆæ‰§è¡Œäº†watchçš„å›è°ƒå‡½æ•°ï¼Œè¿™æ—¶å€™ç”±äºç¬¬ä¸€æ¬¡å·²ç»æ³¨å†Œäº†ä¸€ä¸ªcleanupEffectï¼Œåœ¨jobæ‰§è¡Œä¹‹å‰å‘¢ï¼Œå…¶å®ä¼šå…ˆå»å¤„ç†ä¹‹å‰æ³¨å†Œçš„å›è°ƒå‡½æ•°ï¼Œè¿™æ—¶å€™ä¹‹å‰çš„é‚£ä¸ªé—­åŒ…å˜é‡expiredå°±ä¼šè¢«è®¾ç½®ä¸ºtrueï¼Œä¹‹åå°±ç®—æ˜¯Aè¯·æ±‚è½å®šäº†ï¼Œä¹Ÿä¸ä¼šè¿›è¡Œdataçš„èµ‹å€¼æ“ä½œ Step5: æ·±å…¥ä»£ç†å‰ç½®çŸ¥è¯† Vue3ä¸­åˆ©ç”¨çš„æ˜¯Proxyä»¥åŠReflectå»ä»£ç†å¯¹è±¡çš„ æˆ‘ä»¬çŸ¥é“Proxyæ˜¯åªèƒ½ä»£ç†å¯¹è±¡ç±»å‹çš„ï¼Œéå¯¹è±¡ç±»å‹ä¸å¯ä»¥è¿›è¡Œä»£ç† æ‰€è°“ä»£ç†ï¼š æŒ‡çš„æ˜¯å¯¹ä¸€ä¸ª å¯¹è±¡ çš„ åŸºæœ¬è¯­ä¹‰ çš„ä»£ç† ä½•ä¸ºproxyåŸºæœ¬è¯­ä¹‰æ¯”å¦‚æˆ‘ä»¬å¯¹å¯¹è±¡çš„ä¸€å †ç®€å•æ“ä½œ 12console.log(obj.a); // è¯»å–å±æ€§æ“ä½œobj.a++; // è®¾ç½®å±æ€§å€¼æ“ä½œ ç±»ä¼¼è¿™ç§è¯»å–ï¼Œè®¾ç½®å±æ€§å€¼çš„æ“ä½œï¼Œå°±æ˜¯å±äºåŸºæœ¬çš„è¯­ä¹‰æ“ä½œ â€”- åŸºæœ¬æ“ä½œ ç±»ä¼¼è¿™ç§çš„åŸºæœ¬æ“ä½œå°±å¯ä»¥ç”¨Proxyè¿›è¡Œä»£ç†æ‹¦æˆª åŸºæœ¬æ“ä½œçš„åŸºæœ¬ç”¨æ³• 123456const data = new Proxy(obj, &#123; // æ‹¦æˆªè¯»å–å±æ€§æ“ä½œ get()&#123; .... &#125;, // æ‹¦æˆªè®¾ç½®å±æ€§æ“ä½œ set()&#123; .... &#125;&#125;) ä¾‹å¦‚å‡½æ•°ï¼šæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨applyå¯¹å‡½æ•°è¿›è¡Œæ‹¦æˆª 123456789const fn = ()=&gt;&#123; console.log(&#x27;wengkaimin&#x27;)&#125;const proFn = new Proxy(fn, &#123; apply(target, thisArg, argArray)&#123; target.call(thisArg, ...argArray) &#125;&#125;) proxyå¤åˆæ“ä½œæ—¢ç„¶æœ‰åŸºæœ¬æ“ä½œï¼Œå¯ä»¥ä¹Ÿæœ‰éåŸºæœ¬æ“ä½œï¼Œåœ¨jsé‡Œå¤´ï¼Œæˆ‘ä»¬å«ä»–å¤åˆæ“ä½œ 1obj.fn() è¿™ä¸ªæ˜¾è€Œæ˜“è§ï¼Œæ˜¯åˆå¤šä¸ªè¯­ä¹‰æ„æˆçš„ï¼ˆè°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„ä¸€ä¸ªå‡½æ•°å±æ€§ï¼‰ã€ ä¸¤ä¸ªè¯­ä¹‰æ˜¯ï¼š é¦–å…ˆé€šè¿‡getè·å–åˆ°objçš„fnå±æ€§ é€šè¿‡è·å–åˆ°çš„fnè¿›è¡Œè°ƒç”¨ ReflectåŸºæœ¬æ”¹é€ getter Reflectæ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œå…¶ä¸­å­˜åœ¨å’ŒProxyçš„æ‹¦æˆªå™¨å¾ˆå¤šåå­—ç›¸åŒçš„æ–¹æ³• å¦‚ä¸‹çš„ç­‰ä»·æ“ä½œ 123const obj = &#123; a: &#x27;wengkaimin&#x27; &#125;;console.log(obj.a);console.log(Reflect.get(obj, &#x27;a&#x27;)); ä½†æ˜¯Reflectå®ƒèƒ½å¤Ÿä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•° reveiver å°±ç›¸å½“äºå‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒæŒ‡å‘çš„this 1console.log(Reflect.get(obj, &#x27;a&#x27;, &#123; a: &#x27;kaimin&#x27; &#125;)); // kaimin åœ¨æˆ‘ä»¬çš„å“åº”å¼ä»£ç å½“ä¸­ 123456789101112const obj = new Proxy(data, &#123; get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ // è¿™é‡Œæ²¡æœ‰ç”¨Reflect.getå®ç°è¯»å–æ•°æ® return target[key]; &#125;, set(target, key, newVal) &#123; target[key] = newVal; trigger(target, key); &#125;,&#125;); æˆ‘ä»¬åœ¨Proxyä¸­æ— è®ºè®¾ç½®getè¿˜æ˜¯setæ‹¦æˆªï¼Œéƒ½æ˜¯ç›´æ¥ç”¨çš„åŸå§‹å¯¹è±¡targetæ¥è¿›è¡Œè¯»å–æˆ–è€…èµ‹å€¼ ä¾‹å­ï¼š å‡å¦‚ç›®å‰çš„objä¸ºï¼Œè¿”å›äº†this.fooçš„å€¼ã€‚ æ¥ç€æˆ‘ä»¬åœ¨effectå‰¯ä½œç”¨å‡½æ•°ä¸­é€šè¿‡ä»£ç†å¯¹è±¡dataè¯»å–bçš„å€¼ã€‚ ä¹‹åæˆ‘ä»¬ä¿®æ”¹äº†açš„å€¼ 1234567891011121314151617181920212223242526const data = &#123; a:1, get b()&#123; return this.a + 1; &#125;&#125;const obj = new Proxy(data, &#123; get(target, key) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ // è¿™é‡Œæ²¡æœ‰ç”¨Reflect.getå®ç°è¯»å–æ•°æ® return target[key]; &#125;, set(target, key, newVal) &#123; // è¿™é‡Œæ²¡æœ‰ç”¨Reflect.set target[key] = newVal; trigger(target, key); &#125;,&#125;)effect(()=&gt;&#123; console.log(obj.b) // 2&#125;)obj.a++ ä¿®æ”¹äº†açš„å€¼ä¹‹åï¼ŒæŒ‰é“ç†åº”è¯¥æ‰§è¡Œè¯»å–äº†bå±æ€§çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œä½†æ˜¯å®é™…å¹¶ä¸ä¼šç›¸å¯¹åº”çš„è§¦å‘å‰¯ä½œç”¨å‡½æ•°çš„é‡æ–°æ‰§è¡Œ æ¢³ç†ä¸‹è¯»å–æ­¥éª¤ï¼š é¦–å…ˆæˆ‘ä»¬åœ¨å‰¯ä½œç”¨å‡½æ•°ä¸­è¯»å–äº†obj.bçš„å€¼ ä¼šè§¦å‘objä»£ç†å¯¹è±¡çš„getæ‹¦æˆªå™¨ï¼Œåœ¨getæ‹¦æˆªå™¨ä¸­ï¼Œé€šè¿‡target[key]è¯»å–; æ­¤æ—¶targetå°±æŒ‡çš„æ˜¯ data åŸå§‹å¯¹è±¡ï¼Œkeyå°±æ˜¯ â€˜bâ€™ï¼Œæ‰€ä»¥ç›¸å½“ç›´æ¥è¯»äº†data.b è®¿é—®obj.bçš„æ—¶å€™ï¼Œå…¶å®æ˜¯ä¸€ä¸ªgetterå‡½æ•°ï¼Œè¿™ä¸ªgetterçš„thisæŒ‡å‘äº†dataï¼Œæœ€ç»ˆå®è´¨ä¸Šæ˜¯è®¿é—®äº† data.a å¹¶ä¸”ç»™ä»–åŠ äº†ä¸ª1 å½“ç„¶ï¼Œåœ¨å‰¯ä½œç”¨å‡½æ•°effectå½“ä¸­ç›¸å½“äºï¼Œç›´æ¥è¯»å–äº†åŸç”Ÿå¯¹è±¡dataçš„å±æ€§ï¼Œè™½ç„¶çœ‹ä¸Šå»èµ°äº†ä»£ç†ï¼Œä½†ä¸å¤šã€‚æ‰€ä»¥è¿™è‚¯å®šæ˜¯æ²¡æœ‰è¿½è¸ªåˆ°çš„ï¼Œå»ºç«‹ä¸èµ·ç›¸åº”çš„è”ç³» å°±ç±»ä¼¼ 123effect(()=&gt;&#123; console.log(data.a + 1) // 2&#125;) åœ¨è¿™ç§åœºæ™¯ä¸‹Reflectçš„ç¬¬ä¸‰ä¸ªå‚æ•°receiverå°±æ´¾ä¸Šç”¨åœºäº† æ”¹é€ getteræ‹¦æˆªä½¿ç”¨Reflectæ”¹é€ å®Œgetæ‹¦æˆªå™¨ 12345678const obj = new Proxy(data, &#123; get(target, key, receiver) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return Reflect.get(target, key, receiver) // â• &#125;, ...&#125;); ä½¿ç”¨äº†Relfectä¹‹åï¼ŒthisæŒ‡å‘å°±è½¬ä¸ºäº†objä»£ç†å¯¹è±¡ï¼Œå°±å¯ä»¥æˆåŠŸçš„å»ºç«‹è”ç³»äº† Reflectçš„ä½œç”¨ä¸ä»…äºæ­¤ æ”¹é€ setteræ‹¦æˆªä½¿ç”¨Reflectæ”¹é€ å®Œsetteræ‹¦æˆªå™¨ 1234567891011const obj = new Proxy(data, &#123; set(target, key, newVal, receiver) &#123; // è®¾ç½®å±æ€§å€¼ const res = Reflect.set(target, key, newVal, receiver) // æ‰§è¡Œå‰¯ä½œç”¨ trigger(target, key); return res &#125;, ...&#125;); ä»£ç†objä½¿ä¸€ä¸ªobjæˆä¸ºå“åº”å¼çš„æ•°æ®ï¼Œæˆ‘ä»¬å¿…é¡»è¦åšçš„å°±æ˜¯åšå¥½å®ƒä»£ç†ã€‚ é¦–å…ˆéœ€è¦çŸ¥é“ä¸€ä¸ªæ™®é€šå¯¹è±¡çš„æ‰€æœ‰å¯èƒ½çš„è¯»å–æ“ä½œ è®¿é—®å±æ€§ ob.a ä½¿ç”¨inæ“ä½œç¬¦ï¼Œkey in obj ä½¿ç”¨forâ€¦.inâ€¦.è®¿é—®å¯¹è±¡å±æ€§ å±æ€§çš„è¯»å–æ“ä½œï¼Œä¸Šé¢æˆ‘ä»¬å·²ç»å®ç°è¿‡äº†, obj.aç›´æ¥ä½¿ç”¨getteræ‹¦æˆªå™¨æ¥å®ç°æ‹¦æˆª inæ“ä½œç¬¦æ‹¦æˆªæ¯”å¦‚å¦‚ä¸‹çš„å‰¯ä½œç”¨éœ€è¦å®ç°æ•°æ®ä»£ç† 123effect(()=&gt;&#123; &#x27;a&#x27; in obj;&#125;) æƒ³æ‰¾æ‹¦æˆªinæ“ä½œç¬¦å¿…é¡»çŸ¥é“inæ“ä½œç¬¦çš„åŸç†ï¼Œå…¶å®éœ€è¦ç†è§£ECMA-262çš„è§„èŒƒ ç¬¬å…­ç‚¹çš„ HasProperty(rval, ? ToPropertyKey(lval)) è¿™å—çš„ Return ? O.[[HasProperty]](P). çš„æ„æ€å°±æ˜¯ï¼Œè°ƒç”¨åŸç”Ÿå¯¹è±¡çš„hasæ–¹æ³•å»åˆ¤æ–­ï¼Œæ˜¯å¦æœ‰keyå€¼ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼Œinæ“ä½œç¬¦çš„è¯»å–æ“ä½œæˆ‘ä»¬éœ€è¦è°ƒç”¨[[HasProperty]]å‡½æ•°æ§½å¯¹åº”çš„hasæ–¹æ³•ï¼Œå»åšæ‹¦æˆª å› æ­¤æˆ‘ä»¬å¯ä»¥ä¿®æ”¹æˆ‘ä»¬çš„æ‹¦æˆªå™¨ 1234567const obj = new Proxy(data, &#123; has(target, key)&#123; // â• track(target, key); // â• return Reflect.has(target, key) // â• &#125; ...&#125;); æ‹¦æˆªforâ€¦inâ€¦forâ€¦inâ€¦ä¼šåœ¨æˆ‘ä»¬ä¸ºå“åº”å¼å¯¹è±¡æ·»åŠ æ–°çš„å±æ€§çš„æ—¶å€™ï¼Œé‡æ–°è§¦å‘å‰¯ä½œç”¨å‡½æ•°ã€‚ 123456789const data = &#123; a:1, b:2 &#125;;const obj = new Proxy(data, &#123;....&#125;);effect(()=&gt;&#123; // for...in... for(const key in obj)&#123; console.log(key) &#125;&#125;) æˆ‘ä»¬æŸ¥çœ‹ECMAè§„èŒƒ14.7.5.6 ç¬¬å…­æ­¥çš„c. Let iterator be EnumerateObjectProperties(obj). å¦‚ä¸‹æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ŒEnumerateObjectPropertiesè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ å®é™…ä¸Šï¼Œå¯ä»¥çœ‹å‡ºï¼Œå¦‚æœçš„objå°±æ˜¯è¢«forâ€¦inâ€¦å¾ªç¯éå†çš„å¯¹è±¡ï¼Œå…¶å…³é”®ç‚¹åœ¨ä¸ ä½¿ç”¨åˆ°äº† Reflect.ownKeys()æ¥è·å–åªå±äºå¯¹è±¡è‡ªèº«æ‹¥æœ‰çš„é”®ã€‚ å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Proxyçš„ownKeysæ¥è¿›è¡Œæ‹¦æˆªã€‚ æ”¹é€ ä»£ç†ï¼ŒåŠ å…¥ownKeysæ‹¦æˆª1234567891011const ITERATE_KEY = Symbol()const obj = new Proxy(data, &#123; ..... // æ‹¦æˆªfor...in..., è·å–æ‰€æœ‰å¯¹è±¡æ‰€æœ‰key ownKeys(target) &#123; // å°†å‰¯ä½œç”¨å‡½æ•°ä¸ITERATE_KEYå…³è”èµ·æ¥ track(target, ITERATE_KEY); return Reflect.ownKeys(target) &#125;,&#125;); ç†è§£ï¼š å°†ITERATE_KEYä½œä¸ºtrackè¿½è¸ªçš„keyï¼šå› ä¸ºownKeysæ‹¦æˆªå‡½æ•°å’Œget/setä¸åŒï¼Œæ— æ³•å…·ä½“åˆ°æŸä¸ªkeyå€¼ï¼ŒownKeysä»£è¡¨çš„æ—¶å€™æ‹¿åˆ°æ‰€æœ‰å¯¹è±¡å±äºè‡ªå·±çš„keyå€¼ï¼Œå› æ­¤æ˜¯æ— æ³•å…·ä½“çš„å¯¹åº”åˆ°å“ªä¸ªkeyçš„ æ—¢ç„¶è¿½è¸ªçš„æ˜¯ ITERATE_KEYï¼Œåœ¨è§¦å‘å“åº”çš„æ—¶å€™ä¹Ÿåº”è¯¥è§¦å‘ trigger(target, ITERATE_KEY) æ”¹é€ triggerä¸Šé¢çš„forå¾ªç¯çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œä¼šä¸ITERATE_KEYå»ºç«‹è”ç³»ï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å»æ–°å¢objçš„keyï¼Œä¼šè§¦å‘setteræ‹¦æˆª 1obj.c=3; æŒ‰é“ç†æ¥è¯´æ˜¯èƒ½å¤Ÿè§¦å‘ä¸Šé¢çš„forå¾ªç¯çš„å‰¯ä½œç”¨å‡½æ•°ã€‚ä½†æ˜¯å®é™…å´ä¸èƒ½æ­£å¸¸è§¦å‘ã€‚ é‚£æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬æ˜¯å°† objä½œä¸ºä¸€ä¸ªå…ƒç´ å¯¹åº”çš„ITERATE_KEYåšå…³è” å…¶ä»–çš„Keyçš„Setå‰¯ä½œç”¨å‡½æ•°é›†åˆå¹¶æ²¡æœ‰å°†è¿™ä¸ªforâ€¦inâ€¦å¯¹åº”çš„å‰¯ä½œç”¨å‡½æ•°æ”¶èµ·èµ·æ¥ æ‰€ä»¥åœ¨è®¾ç½®æ–°çš„å±æ€§ c çš„æ—¶å€™ï¼Œforâ€¦inâ€¦å¯¹åº”çš„å‰¯ä½œç”¨å‡½æ•° å’Œ c å®Œå…¨æ²¡æœ‰ä»»ä½•å…³ç³» æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼Œæˆ‘ä»¬åœ¨triggerçš„æ—¶å€™ï¼Œå°†é‚£äº›ä¸ITERATE_KEYç›¸å…³å‰¯ä½œç”¨å‡½æ•°è€¶å–å‡ºæ¥æ‰§è¡Œå°±å¯ä»¥äº†ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738function trigger(target, key) &#123; // æ ¹æ®targetå¼•ç”¨ä»æ¡¶ä¸­å–å¾—å¯¹åº”çš„Map const depsMap = buckect.get(target); if (!depsMap) return; // å–å¾—target ä¸Škeyå¯¹åº”çš„Setæ•°æ®ï¼Œéå†ï¼Œæ‰§è¡Œé‡Œå¤´çš„å‰¯ä½œç”¨ const effects = depsMap.get(key); // å–å¾—for...in... ä¹Ÿå°±æ˜¯ITERATE_KEYç›¸å…³çš„å‰¯ä½œç”¨å‡½æ•° const iterateEffects = depsMap.get(ITERATE_KEY); // â• const effectsToRun = new Set(); if (effects) &#123; effects.forEach((current) =&gt; &#123; if (current !== activeEffect) &#123; // å¦‚æœå½“å‰triggeræ‰§è¡Œçš„ï¼Œå’ŒactiveEffectä¸ä¸€æ ·ï¼ŒåŠ å…¥ effectsToRun.add(current); &#125; &#125;); &#125; // å°†ä¸ITERATE_KEYæŒ‚é’©çš„å‰¯ä½œç”¨å‡½æ•°ä¹ŸåŠ å…¥åˆ°effectsToRun â• if(iterateEffects)&#123; // â• iterateEffects.forEach((current) =&gt; &#123; // â• if (current !== activeEffect) &#123; // â• // å¦‚æœå½“å‰triggeræ‰§è¡Œçš„ï¼Œå’ŒactiveEffectä¸ä¸€æ ·ï¼ŒåŠ å…¥ // â• effectsToRun.add(current); // â• &#125; &#125;); &#125; effectsToRun.forEach((fn) =&gt; &#123; if (fn.options.scheduler) &#123; // è°ƒåº¦å™¨ fn.options.scheduler(fn); // è°ƒåº¦å™¨ &#125; else &#123; fn(); &#125; &#125;);&#125; æ”¹é€ ä¹‹åï¼Œæˆ‘ä»¬å»æ–°å¢æ–°çš„å±æ€§å€¼ï¼Œå°±ä¼šé‡æ–°è§¦å‘forâ€¦inâ€¦çš„é‚£ä¸ªå‰¯ä½œç”¨å‡½æ•° 12345678910111213141516171819202122232425262728293031323334353637383940414243const data = &#123; a: 1,&#125;;const obj = new Proxy(data, &#123; get(target, key, receiver) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return Reflect.get(target, key, receiver); // â• &#125;, set(target, key, newVal, receiver) &#123; // è®¾ç½®å±æ€§å€¼ const res = Reflect.set(target, key, newVal, receiver); // æ‰§è¡Œå‰¯ä½œç”¨ trigger(target, key); return res; &#125;, has(target, key) &#123; track(target, key); return Reflect.has(target, key); &#125;, // æ‹¦æˆªfor...in..., è·å–æ‰€æœ‰å¯¹è±¡æ‰€æœ‰key ownKeys(target) &#123; // å°†å‰¯ä½œç”¨å‡½æ•°ä¸ITERATE_KEYå…³è”èµ·æ¥ track(target, ITERATE_KEY); return Reflect.ownKeys(target); &#125;,&#125;);effect(() =&gt; &#123; // for...in... for (const key in obj) &#123; console.log(key); &#125;&#125;);setTimeout(() =&gt; &#123; obj.b = 2;&#125;, 2000); ä¼˜åŒ–ï¼ˆåŒºåˆ†æ–°å±æ€§å’Œæ—§å±æ€§ï¼‰å‡å¦‚æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸ªå·²å­˜åœ¨çš„å±æ€§ï¼ŒæŒ‰é“ç†æ˜¯ä¸åº”è¯¥å»é‡æ–°å‡ºå‘forâ€¦inâ€¦å‰¯ä½œç”¨å‡½æ•°çš„ 12345678910111213141516171819202122232425262728293031323334353637383940414243const data = &#123; a: 1,&#125;;const obj = new Proxy(data, &#123; get(target, key, receiver) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return Reflect.get(target, key, receiver); // â• &#125;, set(target, key, newVal, receiver) &#123; // è®¾ç½®å±æ€§å€¼ const res = Reflect.set(target, key, newVal, receiver); // æ‰§è¡Œå‰¯ä½œç”¨ trigger(target, key); return res; &#125;, has(target, key) &#123; track(target, key); return Reflect.has(target, key); &#125;, // æ‹¦æˆªfor...in..., è·å–æ‰€æœ‰å¯¹è±¡æ‰€æœ‰key ownKeys(target) &#123; // å°†å‰¯ä½œç”¨å‡½æ•°ä¸ITERATE_KEYå…³è”èµ·æ¥ track(target, ITERATE_KEY); return Reflect.ownKeys(target); &#125;,&#125;);effect(() =&gt; &#123; // for...in... for (const key in obj) &#123; console.log(key); &#125;&#125;);setTimeout(() =&gt; &#123; obj.a = 2;&#125;, 2000); ä½†æ˜¯ï¼Œç›®å‰æˆ‘ä»¬ä¼šé‡æ–°å»è§¦å‘å‰¯ä½œç”¨å‡½æ•°ï¼Œè¿™ä¼šé€ æˆä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ã€‚éœ€è¦åšé™åˆ¶ æ‰€ä»¥æˆ‘ä»¬çœŸæ­£è¦åšçš„æ˜¯ï¼Œåœ¨setçš„æ‹¦æˆªå™¨ä¸­å»å¯¹æ–°å¢å±æ€§å’Œè®¾ç½® åœºæ™¯ åšåŒºåˆ† é¦–å…ˆå®šä¹‰ä¸€ä¸ªå…¨å±€çš„æšä¸¾ï¼Œè¡¨ç¤ºåœºæ™¯ 12345// æšä¸¾ -- è§¦å‘ç±»å‹ï¼Œsetä¸ºè®¾ç½®å±æ€§ï¼Œaddä¸ºæ·»åŠ å±æ€§const TRIGGER_TYPE = &#123; SET:&#x27;set&#x27;, ADD:&#x27;add&#x27;&#125; æ”¹é€ setter 1234567891011121314const obj = new Proxy(data, &#123; set(target, key, newVal, receiver) &#123; // å¦‚æœå±æ€§ä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜æ˜¯åœ¨æ·»åŠ å±æ€§ï¼Œå¦åˆ™æ˜¯åœ¨è®¾ç½®å±æ€§ const triggerType = Object.prototype.hasOwnProperty.call(target, key) // â• ? TRIGGER_TYPE.SET : TRIGGER_TYPE.ADD; // è®¾ç½®å±æ€§å€¼ const res = Reflect.set(target, key, newVal, receiver); // æ‰§è¡Œå‰¯ä½œç”¨ // å°†triggerTypeä½œä¸ºtriggerçš„ç¬¬ä¸‰ä¸ªå‚æ•° trigger(target, key, triggerType); return res; &#125;,&#125;); é€šè¿‡hasOwnPropertyå»åˆ¤æ–­ï¼Œå½“å‰å¯¹è±¡ä¸Šæ˜¯å¦å­˜åœ¨è¿™ä¸ªå±æ€§äº†ï¼Œä»è€ŒçŸ¥é“æ˜¯æ–°çš„å±æ€§è¿˜æ˜¯æ—§çš„å±æ€§ æ”¹é€ triggerå‡½æ•° 1234567891011121314151617181920212223242526272829303132333435363738394041function trigger(target, key, triggerType) &#123; // æ ¹æ®targetå¼•ç”¨ä»æ¡¶ä¸­å–å¾—å¯¹åº”çš„Map const depsMap = bucket.get(target); if (!depsMap) return; // å–å¾—target ä¸Škeyå¯¹åº”çš„Setæ•°æ®ï¼Œéå†ï¼Œæ‰§è¡Œé‡Œå¤´çš„å‰¯ä½œç”¨ const effects = depsMap.get(key); const effectsToRun = new Set(); if (effects) &#123; effects.forEach((current) =&gt; &#123; if (current !== activeEffect) &#123; // å¦‚æœå½“å‰triggeræ‰§è¡Œçš„ï¼Œå’ŒactiveEffectä¸ä¸€æ ·ï¼ŒåŠ å…¥ effectsToRun.add(current); &#125; &#125;); &#125; // åªæœ‰å½“ triggerTypeä¸º ADDçš„æ—¶å€™æ‰ä¼šå»è§¦å‘ä¸ITERATE_KEYç›¸å…³è”çš„å‰¯ä½œç”¨å‡½æ•°çš„é‡æ–°æ‰§è¡Œ if (triggerType === TRIGGER_TYPE.ADD) &#123; // â• // å–å¾—for...in... ä¹Ÿå°±æ˜¯ITERATE_KEYç›¸å…³çš„å‰¯ä½œç”¨å‡½æ•° const iterateEffects = depsMap.get(ITERATE_KEY); // å°†ä¸ITERATE_KEYæŒ‚é’©çš„å‰¯ä½œç”¨å‡½æ•°ä¹ŸåŠ å…¥åˆ°effectsToRun if (iterateEffects) &#123; iterateEffects.forEach((current) =&gt; &#123; if (current !== activeEffect) &#123; // å¦‚æœå½“å‰triggeræ‰§è¡Œçš„ï¼Œå’ŒactiveEffectä¸ä¸€æ ·ï¼ŒåŠ å…¥ effectsToRun.add(current); &#125; &#125;); &#125; &#125; effectsToRun.forEach((fn) =&gt; &#123; if (fn.options.scheduler) &#123; // è°ƒåº¦å™¨ fn.options.scheduler(fn); // è°ƒåº¦å™¨ &#125; else &#123; fn(); &#125; &#125;);&#125; åŠ å…¥triggerTypeåšåŒºåˆ†ï¼Œåªæœ‰åœ¨triggerTypeä¸ºADDçš„æ—¶å€™æ‰å»è§¦å‘ä¸ITERATE_KEYç›¸å…³çš„å‰¯ä½œç”¨å‡½æ•° æ‹¦æˆªdeleteæ“ä½œç¬¦1delete obj.a åˆ é™¤äº†aå±æ€§æ—¶å€™ï¼Œå…¶å®æˆ‘ä»¬è¦åšçš„ä¸æ˜¯å»è§¦å‘ï¼Œé‚£äº›å’Œaå…³è”çš„å‰¯ä½œç”¨å‡½æ•°ï¼› å…¶å®å’Œforâ€¦inâ€¦ä¸€æ ·ï¼Œåˆ é™¤äº†æŸä¸ªå¯¹è±¡çš„keyï¼Œå…¶å®ä¼šå½±å“forâ€¦inâ€¦å…³è”çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œä¼šå¯¼è‡´forâ€¦inâ€¦å‡å°‘ä¸€å±‚å¾ªç¯ï¼Œåº”è¯¥åˆç†çš„å»è§¦å‘è¿™ä¸ªå‰¯ä½œç”¨å‡½æ•° åŒæ ·ï¼Œæˆ‘ä»¬éœ€è¦æ‹¦æˆªdeleteæ“ä½œç¬¦ï¼Œä¹Ÿéœ€è¦æå‰äº†è§£EcMAçš„è§„èŒƒ ä» 5.d çš„æ­¥éª¤å¯ä»¥çŸ¥é“ï¼Œdeleteæ“ä½œç¬¦çš„è¡Œä¸ºä¾èµ– [[Delete]] å‡½æ•°æ§½ã€‚å¯¹åº”çš„æ˜¯Proxy deletePropertyæ‹¦æˆªå‡½æ•° ä»ä¸Šå°±çŸ¥é“äº†å…¶å®æˆ‘ä»¬è¦åšçš„å°±æ˜¯åœ¨ åˆ é™¤ æŸä¸ªå¯¹è±¡çš„å±æ€§ çš„æ—¶å€™å»è§¦å‘ é‚£ä¸ªå’Œ ITERATE_KEY ç»‘å®šçš„å‰¯ä½œç”¨å‡½æ•° åŠ å…¥â€œåˆ é™¤â€ç±»å‹çš„TRIGGER_TYPE123456// æšä¸¾ -- è§¦å‘ç±»å‹ï¼Œsetä¸ºè®¾ç½®å±æ€§ï¼Œaddä¸ºæ·»åŠ å±æ€§ï¼Œdeleteä¸ºåˆ é™¤å±æ€§const TRIGGER_TYPE = &#123; SET: &quot;set&quot;, ADD: &quot;add&quot;, DELETE: &quot;delete&quot;,&#125;; æ”¹é€ ä»£ç†ï¼ŒåŠ å…¥deletePropertyæ‹¦æˆª åˆ¤æ–­å½“å‰åˆ é™¤çš„å±æ€§æ˜¯å¦å­˜åœ¨äºè‡ªèº«å¯¹è±¡ä¸Šï¼ˆå¦‚æœä¸åœ¨è‡ªå·±çš„å¯¹è±¡ä¸Šï¼Œå°±ä¸åº”è¯¥è§¦å‘å¯¹åº”çš„å‰¯ä½œç”¨ï¼‰ ä½¿ç”¨Reflect.deletePropertyè¿›è¡Œåˆ é™¤ å½“1 2ä¸¤è€…çš„æ¡ä»¶å…¨éƒ¨éƒ½æ»¡è¶³çš„æ—¶å€™ï¼Œåˆ™å»è§¦å‘triggerå‡½æ•°ï¼Œå¹¶ä¸”ä¼ å…¥ DELETEçš„æ ‡è¯†å‘Šè¯‰triggerå‡½æ•°ï¼Œç›®å‰è¿›è¡Œçš„æ˜¯åˆ é™¤å±æ€§æ“ä½œã€‚ 1234567891011121314151617const obj = new Proxy(data, &#123; // æ‹¦æˆªdeleteæ“ä½œç¬¦ deleteProperty(target, key)&#123; // æ£€æŸ¥è¢«æ“ä½œçš„å±æ€§æ˜¯å¦æ˜¯å¯¹è±¡è‡ªå·±çš„å±æ€§ const hasKey = Object.prototype.hasOwnProperty.call(target,key); // ä½¿ç”¨Reflect.deleteProperty å®Œæˆå±æ€§çš„åˆ é™¤ const res = Reflect.deleteProperty(target,key); if(hasKey &amp;&amp; res)&#123; // åªæœ‰åˆ é™¤çš„æ˜¯è‡ªå·±çš„å±æ€§ï¼Œå¹¶ä¸”æˆåŠŸåˆ é™¤ï¼Œæ‰å›å»è§¦å‘triggerå‡½æ•° trigger(target, key, TRIGGER_TYPE.DELETE) &#125; return res; &#125; ....&#125;); æ”¹é€ triggerå‡½æ•°ï¼ŒåŠ å…¥deleteåˆ¤æ–­æ¡ä»¶1234567891011121314151617181920212223242526272829303132333435363738394041function trigger(target, key, triggerType) &#123; // æ ¹æ®targetå¼•ç”¨ä»æ¡¶ä¸­å–å¾—å¯¹åº”çš„Map const depsMap = buckect.get(target); if (!depsMap) return; // å–å¾—target ä¸Škeyå¯¹åº”çš„Setæ•°æ®ï¼Œéå†ï¼Œæ‰§è¡Œé‡Œå¤´çš„å‰¯ä½œç”¨ const effects = depsMap.get(key); const effectsToRun = new Set(); if (effects) &#123; effects.forEach((current) =&gt; &#123; if (current !== activeEffect) &#123; // å¦‚æœå½“å‰triggeræ‰§è¡Œçš„ï¼Œå’ŒactiveEffectä¸ä¸€æ ·ï¼ŒåŠ å…¥ effectsToRun.add(current); &#125; &#125;); &#125; // åªæœ‰å½“ triggerTypeä¸º ADD æˆ–è€… DELETE çš„![]()æ—¶å€™æ‰ä¼šå»è§¦å‘ä¸ITERATE_KEYç›¸å…³è”çš„å‰¯ä½œç”¨å‡½æ•°çš„é‡æ–°æ‰§è¡Œ // â• if ([TRIGGER_TYPE.ADD, TRIGGER_TYPE.DELETE].includes(triggerType)) &#123; // â• // å–å¾—for...in... ä¹Ÿå°±æ˜¯ITERATE_KEYç›¸å…³çš„å‰¯ä½œç”¨å‡½æ•° const iterateEffects = depsMap.get(ITERATE_KEY); // å°†ä¸ITERATE_KEYæŒ‚é’©çš„å‰¯ä½œç”¨å‡½æ•°ä¹ŸåŠ å…¥åˆ°effectsToRun if (iterateEffects) &#123; iterateEffects.forEach((current) =&gt; &#123; if (current !== activeEffect) &#123; // å¦‚æœå½“å‰triggeræ‰§è¡Œçš„ï¼Œå’ŒactiveEffectä¸ä¸€æ ·ï¼ŒåŠ å…¥ effectsToRun.add(current); &#125; &#125;); &#125; &#125; effectsToRun.forEach((fn) =&gt; &#123; if (fn.options.scheduler) &#123; // è°ƒåº¦å™¨ fn.options.scheduler(fn); // è°ƒåº¦å™¨ &#125; else &#123; fn(); &#125; &#125;);&#125; åŠ å…¥ type === â€˜DELETEâ€™çš„åˆ¤æ–­ï¼Œä»è€Œæ˜¯åˆ é™¤å±æ€§çš„æ“ä½œä¹Ÿèƒ½å¤Ÿè§¦å‘ ä¸ ITERATE_KEY ç»‘å®šçš„æ“ä½œã€‚ Step6: åˆç†çš„è§¦å‘å“åº” åˆç†çš„è§¦å‘å“åº”ï¼Œå°±æ˜¯åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å…¶å®æ˜¯ä¸éœ€è¦å»åšå‰¯ä½œç”¨å‡½æ•°çš„é‡æ–°æ‰§è¡Œçš„ å‰åå€¼ä¸æ”¹å˜æƒ…å†µçš„å¤„ç†å¦‚ä¸‹ä¾‹å­ 12345678910const data = &#123; a: 1 &#125;;const obj = new Proxy(obj, &#123; ....&#125;)effect(()=&gt;&#123; console.log(obj.a)&#125;)obj.a = 1; åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å»ä¿®æ”¹açš„å€¼ä¸º1ï¼Œå…¶å®å®è´¨ä¸Šæ˜¯å¹¶æ²¡æœ‰æ”¹åŠ¨åˆ°objçš„aå±æ€§å€¼å¾—ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹è¿˜æ˜¯ä¼šç–«æƒ…å‰¯ä½œç”¨å‡½æ•°çš„é‡æ–°æ‰§è¡Œ é‚£æ˜¯å› ä¸ºå¹¶æ²¡æœ‰åšå€¼æ¯”è¾ƒçš„æ‹¦æˆª ä¿®æ”¹setteræ‹¦æˆªæˆ‘ä»¬åœ¨setæ‹¦æˆªå™¨ä¸­ï¼Œè¿›è¡Œå‰åå€¼çš„å…¨ç­‰æ¯”è¾ƒ 12345678910111213141516171819202122const obj = new Proxy(data, &#123; set(target, key, newVal, receiver) &#123; // é¦–å…ˆè·å–æ—§å€¼ const oldValue = target[key]; // å¦‚æœå±æ€§ä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜æ˜¯åœ¨æ·»åŠ å±æ€§ï¼Œå¦åˆ™æ˜¯åœ¨è®¾ç½®å±æ€§ const triggerType = Object.prototype.hasOwnProperty(target, key) ? TRIGGER_TYPE.SET : TRIGGER_TYPE.ADD; // è®¾ç½®å±æ€§å€¼ const res = Reflect.set(target, key, newVal, receiver); if (oldValue !== newVal) &#123; // â• // æ‰§è¡Œå‰¯ä½œç”¨ // å°†triggerTypeä½œä¸ºtriggerçš„ç¬¬ä¸‰ä¸ªå‚æ•° trigger(target, key, triggerType); &#125; return res; &#125;, .....&#125;) å¦‚ä¸ŠåŠ å…¥äº†ä¸€ä¸ªå…¨ç­‰çš„æ¯”è¾ƒï¼Œä½†æ˜¯å…¶å®è¿™æ ·æ˜¯ä¸å¦¥å½“çš„ã€‚ æˆ‘ä»¬æ²¡æœ‰è€ƒè™‘åˆ°NaNçš„æƒ…å†µ åœ¨jsä¸­NaNå’ŒNaNæ— è®ºå¦‚ä½•å…¨ç­‰æ¯”è¾ƒéƒ½æ˜¯å¾—åˆ°falseçš„ã€‚ NaN !== NaN NaN === NaN å› æ­¤åŠ å…¥NaNçš„é™åˆ¶ 12345678910111213141516171819202122232425262728const obj = new Proxy(data, &#123; get(target, key, receiver) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return Reflect.get(target, key, receiver); &#125;, set(target, key, newVal, receiver) &#123; // é¦–å…ˆè·å–æ—§å€¼ const oldValue = target[key]; // å¦‚æœå±æ€§ä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜æ˜¯åœ¨æ·»åŠ å±æ€§ï¼Œå¦åˆ™æ˜¯åœ¨è®¾ç½®å±æ€§ const triggerType = Object.prototype.hasOwnProperty(target, key) ? TRIGGER_TYPE.SET : TRIGGER_TYPE.ADD; // è®¾ç½®å±æ€§å€¼ const res = Reflect.set(target, key, newVal, receiver); // æ¯”è¾ƒæ–°å€¼å’Œæ—§å€¼ï¼Œåªæœ‰ä»–ä»¬ä¸å…¨ç­‰ï¼Œå¹¶ä¸”éƒ½ä¸æ˜¯NaNçš„æ—¶å€™æ‰è§¦å‘å“åº”çš„ â• if (oldValue !== newVal &amp;&amp; (oldValue === oldValue || newVal === newVal)) &#123; // â• // æ‰§è¡Œå‰¯ä½œç”¨ // å°†triggerTypeä½œä¸ºtriggerçš„ç¬¬ä¸‰ä¸ªå‚æ•° trigger(target, key, triggerType); &#125; return res; &#125;, ...&#125;); å°è£…ä¸ºreactiveæˆ‘ä»¬å°†ä¸Šè¿°çš„æ‰€æœ‰çš„æ‹¦æˆªå™¨éƒ½å°è£…åˆ°ä¸€ä¸ªreactiveçš„å‡½æ•°å½“ä¸­ï¼Œåç»­ç›´æ¥ä»¥reactiveä¸ºä¾‹å­ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455function reactive(data) &#123; return new Proxy(data, &#123; get(target, key, receiver) &#123; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return Reflect.get(target, key, receiver); &#125;, set(target, key, newVal, receiver) &#123; // é¦–å…ˆè·å–æ—§å€¼ const oldValue = target[key]; // å¦‚æœå±æ€§ä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜æ˜¯åœ¨æ·»åŠ å±æ€§ï¼Œå¦åˆ™æ˜¯åœ¨è®¾ç½®å±æ€§ const triggerType = Object.prototype.hasOwnProperty(target, key) ? TRIGGER_TYPE.SET : TRIGGER_TYPE.ADD; // è®¾ç½®å±æ€§å€¼ const res = Reflect.set(target, key, newVal, receiver); // æ¯”è¾ƒæ–°å€¼å’Œæ—§å€¼ï¼Œåªæœ‰ä»–ä»¬ä¸å…¨ç­‰ï¼Œå¹¶ä¸”éƒ½ä¸æ˜¯NaNçš„æ—¶å€™æ‰è§¦å‘å“åº”çš„ if (oldValue !== newVal &amp;&amp; (oldValue === oldValue || newVal === newVal)) &#123; // æ‰§è¡Œå‰¯ä½œç”¨ // å°†triggerTypeä½œä¸ºtriggerçš„ç¬¬ä¸‰ä¸ªå‚æ•° trigger(target, key, triggerType); &#125; return res; &#125;, // æ‹¦æˆªinæ“ä½œç¬¦ has(target, key) &#123; track(target, key); return Reflect.has(target, key); &#125;, // æ‹¦æˆªfor...in..., è·å–æ‰€æœ‰å¯¹è±¡æ‰€æœ‰key ownKeys(target) &#123; // å°†å‰¯ä½œç”¨å‡½æ•°ä¸ITERATE_KEYå…³è”èµ·æ¥ track(target, ITERATE_KEY); return Reflect.ownKeys(target); &#125;, // æ‹¦æˆªdeleteæ“ä½œç¬¦ deleteProperty(target, key) &#123; // æ£€æŸ¥è¢«æ“ä½œçš„å±æ€§æ˜¯å¦æ˜¯å¯¹è±¡è‡ªå·±çš„å±æ€§ const hasKey = Object.prototype.hasOwnProperty.call(target, key); // ä½¿ç”¨Reflect.deleteProperty å®Œæˆå±æ€§çš„åˆ é™¤ const res = Reflect.deleteProperty(target, key); if (hasKey &amp;&amp; res) &#123; // åªæœ‰åˆ é™¤çš„æ˜¯è‡ªå·±çš„å±æ€§ï¼Œå¹¶ä¸”æˆåŠŸåˆ é™¤ï¼Œæ‰å›å»è§¦å‘triggerå‡½æ•° trigger(target, key, TRIGGER_TYPE.DELETE); &#125; return res; &#125;, &#125;);&#125; è¿™æ ·å°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº† 123456const data = &#123; a: 1, b: 2,&#125;;const obj = reactive(data); è€ƒè™‘åŸå‹æƒ…å†µå­˜åœ¨ä¸€ç§æƒ…å†µï¼ŒåŸå‹å’Œä»£ç†çš„å¯¹è±¡éƒ½æ˜¯å“åº”å¼æ•°æ®çš„æƒ…å†µä¸‹ ä¾‹å¦‚ï¼š 1234567891011121314const obj = &#123;&#125;;const prototype = &#123; a: &#x27;weng&#x27; &#125;;const child = reactive(obj);const parent = reactive(prototype);Object.setPrototypeOf(child, parent);effect(()=&gt;&#123; console.log(child.a);&#125;);child.a = &#x27;kaimin&#x27;; // ä¼šèµ°ä¸¤æ¬¡å‰¯ä½œç”¨å‡½æ•° ä¸ºä»€ä¹ˆä¼šå­˜åœ¨ä¸¤æ¬¡æ‰§è¡Œçš„æƒ…å†µï¼Ÿ åˆ†æå¦‚ä¸‹ï¼š åœ¨è¯»å–child.açš„æ—¶å€™ï¼Œä¼šè§¦å‘getæ‹¦æˆªå‡½æ•° æœ€ç»ˆçš„ç»“æœå¦‚ä¸‹ 123Reflect.get(obj, &#x27;a&#x27;, child)// objæ˜¯childçš„åŸç”Ÿå¯¹è±¡// childåœ¨è¿™é‡Œå°±ç›¸å½“äºreceiver å…¶å®æœ€ç»ˆæ˜¯é€šè¿‡è®¿é—®obj.aæ¥è®¿é—®å±æ€§çš„é»˜è®¤è¡Œä¸ºçš„ã€‚ å¼•æ“å†…éƒ¨æ˜¯é€šè¿‡è°ƒç”¨objå¯¹è±¡æ‰€éƒ¨ç½²çš„[[Get]]å†…éƒ¨æ–¹æ³•å¾—åˆ°æœ€ç»ˆç»“æœ æŸ¥çœ‹ECMAçš„è§„èŒƒï¼š åœ¨ç¬¬ä¸‰æ­¥éª¤ï¼Œåˆ¤å®šï¼Œå¦‚æœæˆ‘ä»¬è‡ªèº«çš„è¯»å–å¯¹è±¡ä¸Šæ²¡æœ‰è¿™ä¸ªå±æ€§çš„æ—¶å€™ï¼Œä¼šå»åŸå‹ä¸Šå»è°ƒç”¨åŸå‹å¯¹è±¡å±æ€§çš„[[Get]]ï¼Œå› æ­¤è¿™é‡Œå°±æ˜¯parent.aï¼Œè€Œparentçš„æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå“åº”å¼æ•°æ®ï¼Œæ‰€ä»¥åœ¨å‰¯ä½œç”¨å‡½æ•°ä¸­ç›¸å½“äºä¹Ÿè®¿é—®äº†parent.açš„å€¼ï¼›è¿™æ ·å°±å¯¼è‡´ child.a å’Œparent.aéƒ½ä¸å‰¯ä½œç”¨å‡½æ•°å»ºç«‹çš„å“åº”çš„è”ç³» åœ¨æˆ‘ä»¬ä¿®æ”¹child.açš„å€¼çš„æ—¶å€™ï¼Œä¼šè§¦å‘objåŸç”Ÿå¯¹è±¡çš„[[Set]] å¼•æ“å†…éƒ¨çš„å®šä¹‰å¦‚ä¸‹ï¼š ç”±ç¬¬äºŒæ­¥çš„æ­¥éª¤çŸ¥é“ï¼Œå¦‚æœå¯¹è±¡ä¸Šé¢è®¾ç½®çš„è¿™ä¸ªå±æ€§ä¸å­˜åœ¨çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šè·å–å®ƒçš„åŸå‹ï¼Œè¿™é‡Œå°±æ˜¯parentï¼Œç”±äºparentæ˜¯å“åº”æ•°æ®ï¼Œå°±ä¼šè°ƒç”¨parentçš„[[Set]]ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä¿®æ”¹child.açš„å€¼çš„æ—¶å€™ï¼Œç”±äºåœ¨[[Get]]çš„æ—¶å€™ï¼Œchild.aå’Œparent.aéƒ½æ”¶é›†åˆ°äº†å‰¯ä½œç”¨å‡½æ•°ï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œä¸¤æ¬¡å‰¯ä½œç”¨å‡½æ•°ã€‚ æ€»ç»“æ¥è¯´ï¼Œä¸¤æ¬¡çš„è§¦å‘åˆ†åˆ«æ˜¯è¿™æ ·çš„æ•ˆæœçš„ ç¬¬ä¸€æ¬¡ï¼Œä½œç”¨åœ¨receiver ä¸ºchildå’Œtargetä¸º objåŸç”Ÿå¯¹è±¡ä¸Š 1Reflect.set(obj, &#x27;a&#x27;, &#x27;kaimin&#x27;, child) ç”±äºå¼•æ“çš„[[Get]]æœºåˆ¶ï¼Œå‘ç°æ²¡æœ‰aå±æ€§ï¼Œå°±å»parentä¸Šæ‰¾äº† ç¬¬äºŒæ¬¡ï¼Œä½œç”¨åœ¨åœ¨receiver ä¸ºchildå’Œtargetä¸º prototypeåŸç”Ÿå¯¹è±¡ä¸Š 1Reflect.set(prototype, &#x27;a&#x27;, &#x27;kaimin&#x27;, child) ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡çš„å·®è·å°±æ˜¯ï¼Œæ‰€è®¾ç½®çš„targetçš„åŸç”Ÿå¯¹è±¡ä¸ä¸€æ ·çš„ã€‚ä½†æ˜¯receiveræ°¸è¿œæ˜¯é‚£ä¸ªchildå“åº”æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹æ¥ä½œåŒºåˆ†ã€‚ targetå˜åŒ–ï¼Œreceiverä¸å˜ï¼Œæˆ‘ä»¬åªéœ€è¦åšåˆ°ä¸€æ¬¡çš„å±è”½æ›´æ–°å°±å¯ä»¥äº†ã€‚å»æ‰é‚£ä¸€æ¬¡ç”±äºåŸå‹è€Œå¼•èµ·çš„æ›´æ–° æ‰€ä»¥æ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯ç¡®å®šreceiveræ˜¯ä¸æ˜¯targetçš„ä»£ç†å¯¹è±¡å°±å¯ä»¥äº†ã€‚ ä¿®æ”¹getteræ‹¦æˆªæ–°å¢åŠ ä¸€ä¸ªä»£ç†å¯¹è±¡çš„rawå±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯æŒ‡å‘è¿™ä¸ªéœ€è¦ä»£ç†çš„å¯¹è±¡çš„ï¼Œå½“æˆ‘ä»¬è®¿é—®è¿™ä¸ªä»£ç†å¯¹è±¡çš„æ—¶å€™ï¼Œå¦‚æœkeyä¸ºrawï¼Œé‚£æˆ‘ä»¬å°±ç›´æ¥è¿”å›è¿™ä¸ªä»£ç†çš„å¯¹è±¡ï¼Œä¸ºåç»­çš„setterè§¦å‘æ—¶é—´åšåˆ¤æ–­ 12345678910111213function reactive(data) &#123; return new Proxy(data, &#123; get(target, key, receiver) &#123; // ä»£ç†å¯¹è±¡å¯ä»¥é€šè¿‡rawçš„å±æ€§ï¼Œè®¿é—®åŸå§‹çš„æ•°æ® if (key === &quot;raw&quot;) &#123; // â• return target; // â• &#125; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return Reflect.get(target, key, receiver); &#125;,&#125; è¿™æ ·ä»£ç†å¯¹è±¡å°±å¯ä»¥è¿™ä¹ˆæäº† 12child.raw === obj; // true;parent.raw === prototype; // true æœ‰äº†å®ƒï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿåœ¨setterå½“ä¸­æ‹¦æˆªäº† ä¿®æ”¹setteræœ‰äº†rawçš„å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨setterå½“ä¸­å»è®¿é—®receiverçš„rawå±æ€§ï¼Œä»è€Œå°†å…¶å’Œå½“å‰çš„targetåšåˆ¤æ–­ï¼Œè¿›è¡Œæ‹¦æˆª 12345678910111213141516171819202122232425262728function reactive(data) &#123; return new Proxy(data, &#123; set(target, key, newVal, receiver) &#123; // é¦–å…ˆè·å–æ—§å€¼ const oldValue = target[key]; // å¦‚æœå±æ€§ä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜æ˜¯åœ¨æ·»åŠ å±æ€§ï¼Œå¦åˆ™æ˜¯åœ¨è®¾ç½®å±æ€§ const triggerType = Object.prototype.hasOwnProperty(target, key) ? TRIGGER_TYPE.SET : TRIGGER_TYPE.ADD; // è®¾ç½®å±æ€§å€¼ const res = Reflect.set(target, key, newVal, receiver); // å¦‚æœtarget === receiver.rawï¼ˆrawæŒ‡å‘åŸç”Ÿå¯¹è±¡ï¼‰å°±è¯´æ˜receiverå°±æ˜¯targetçš„ä»£ç†å¯¹è±¡ if (receiver.raw === target) &#123; // â• // æ¯”è¾ƒæ–°å€¼å’Œæ—§å€¼ï¼Œåªæœ‰ä»–ä»¬ä¸å…¨ç­‰ï¼Œå¹¶ä¸”éƒ½ä¸æ˜¯NaNçš„æ—¶å€™æ‰è§¦å‘å“åº”çš„ if ( oldValue !== newVal &amp;&amp; (oldValue === oldValue || newVal === newVal) ) &#123; // æ‰§è¡Œå‰¯ä½œç”¨ // å°†triggerTypeä½œä¸ºtriggerçš„ç¬¬ä¸‰ä¸ªå‚æ•° trigger(target, key, triggerType); &#125; &#125; return res; &#125;,&#125; ç»è¿‡å¦‚ä¸Šçš„æ”¹é€ ï¼Œæˆ‘ä»¬å¢åŠ äº†åˆ¤æ–­æ¡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥å±è”½é‚£äº› ç”±åŸå‹å€¼å¼•èµ·çš„ä¸å¿…è¦çš„æ›´æ–°ã€‚ å› æ­¤ä¸Šé¢çš„ä¾‹å­å°±èƒ½è§£å†³ä¸¤æ¬¡æ‰§è¡Œå‰¯ä½œç”¨çš„é—®é¢˜ Step7: å¼•å…¥â€œæ·±â€å’Œâ€œæµ…â€æ¦‚å¿µæµ…ä¸æ·±å“åº” åœ¨vueä¸­ï¼Œæœ‰shallowReactiveçš„æµ…å“åº”çš„æ–¹æ³•ï¼Œä¹Ÿæœ‰reactiveæ·±å“åº”çš„æ–¹æ³• ç›®å‰æˆ‘ä»¬æ‰€å®ç°çš„reactiveæ˜¯æµ…å“åº” 123456789const data = &#123; a: &#123; b: &#x27;weng &#x27;&#125; &#125;;const obj = reactive(data);effect(()=&gt;&#123; console.log(obj.a.b)&#125;);// ä¿®æ”¹bçš„å€¼å¹¶ä¸ä¼šè§¦å‘å‰¯ä½œç”¨å‡½æ•°obj.a.b = &#x27;kaimin&#x27; ç›®å‰è¿™ç§æƒ…å†µé€ æˆçš„åŸå› æ˜¯å› ä¸ºï¼Œåœ¨æˆ‘ä»¬getteræ‹¦æˆªå™¨ä¸­ 12345678910 get(target, key, receiver) &#123; // ä»£ç†å¯¹è±¡å¯ä»¥é€šè¿‡rawçš„å±æ€§ï¼Œè®¿é—®åŸå§‹çš„æ•°æ® if (key === &quot;raw&quot;) &#123; return target; &#125; track(target, key); // è¿”å›å‡½æ•°å±æ€§ return Reflect.get(target, key, receiver);&#125;, æˆ‘ä»¬åœ¨è¯»å–obj.a.bçš„æ—¶å€™ éœ€è¦å…ˆè®¿é—®obj.aï¼Œé€šè¿‡getteræ‹¿åˆ°çš„æ˜¯Reflect.get(data, &#39;a&#39;, obj) ç»“æœæ‹¿åˆ°çš„data.aå…¶å®æ˜¯éå“åº”å¼çš„æ•°æ®ï¼š&#123; b: &#39;weng&#39; &#125; æ‰€ä»¥è¯´è¿™ç§æƒ…å†µæˆ‘ä»¬æˆ‘ä»¬æ— æ³•è¿½è¸ªè¿™ä¸ªå¯¹è±¡çš„ï¼Œå¾—ä¸åˆ°å“åº” å› æ­¤æˆ‘ä»¬ç§°è¿™ç§ä¸ºæµ…å“åº”ï¼Œå¦‚æœéœ€è¦åœ¨ä¿®æ”¹bå€¼çš„æ—¶å€™ï¼Œä¹Ÿè§¦å‘å“åº”ï¼Œé‚£å°±æ˜¯æ·±å…¥åˆ°äº†ä¸‹é¢ä¸€å±‚çº§ï¼Œæˆ–è€…æ›´æ·±ä¸€å±‚çº§ï¼Œè¿™æ ·çš„å°±å«åšæ·±å“åº”ã€‚ å¦‚æœè¦å®ç°æ·±å“åº”çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹é€ getterï¼Œè®©ä»–æ·±å…¥åˆ°ä¸‹ä¸€å±‚çš„æ•°æ® æ”¹é€ reactiveå’Œgetterå®ç°æ·±å“åº”å½“è¯»å–ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªå±æ€§çš„æ—¶å€™ å…ˆåˆ¤æ–­è¿™ä¸ªå±æ€§æ˜¯å¦æ˜¯å¯¹è±¡ å¦‚æœæ˜¯å¯¹è±¡çš„è¯ï¼Œåˆ™é€’å½’åœ°è°ƒç”¨reactiveå‡½æ•°å°†å…¶åŒ…è£…æˆå“åº”å¼æ•°æ®å¹¶ä¸”è¿”å›ã€‚ è¿™æ ·çš„è¯åœ¨ä¸‹ä¸€å±‚çº§è®¿é—®å±æ€§çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç®€å†å“åº”çš„è”ç³»äº†ã€‚ 1234567891011121314151617181920function reactive(data) &#123; return new Proxy(data, &#123; get(target, key, receiver) &#123; // ä»£ç†å¯¹è±¡å¯ä»¥é€šè¿‡rawçš„å±æ€§ï¼Œè®¿é—®åŸå§‹çš„æ•°æ® if (key === &quot;raw&quot;) &#123; return target; &#125; track(target, key); // è¿”å›å‡½æ•°å±æ€§ï¼Œå¾—åˆ°åŸå§‹å€¼ç»“æœ const res = Reflect.get(target, key, receiver); // â• if (typeof res === &quot;object&quot; &amp;&amp; res !== null) &#123; // â• // è°ƒç”¨ reactive å°†ç»“æœåŒ…è£…æˆå“åº”å¼æ•°æ®å¹¶è¿”å› return reactive(res); // â• &#125; // è¿”å›res return res; &#125;, &#125;);&#125; å°è£…æ·±å“åº”reactiveå’Œæµ…å“åº”shallowReactiveå®ç°äº†ä¸Šå±‚çš„æ·±å“åº”çš„æ–¹æ¡ˆä¹‹åæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå°†ä¸¤è€…å˜æˆvueä¸­çš„reactiveå’ŒshallowReactiveå‡½æ•°ã€‚ å°è£…ä¸€ä¸ªcreateReactiveå…¬å…±å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå‚æ•°isShallowå‚æ•°ï¼Œåœ¨è¿™é‡Œä»£è¡¨æ˜¯å¦ä¸ºæµ…å±‚ï¼Œé»˜è®¤ä¸ºfalseï¼Œå³æ·±å±‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677// å°è£…function createReactive(data, isShallow = false) &#123; return new Proxy(data, &#123; get(target, key, receiver) &#123; // ä»£ç†å¯¹è±¡å¯ä»¥é€šè¿‡rawçš„å±æ€§ï¼Œè®¿é—®åŸå§‹çš„æ•°æ® if (key === &quot;raw&quot;) &#123; return target; &#125; track(target, key); // è¿”å›å‡½æ•°å±æ€§ï¼Œå¾—åˆ°åŸå§‹å€¼ç»“æœ const res = Reflect.get(target, key, receiver); // å¦‚æœæ˜¯æµ…å“åº”ç›´æ¥è¿”å› if (isShallow) &#123; // â• return res; // â• &#125; if (typeof res === &quot;object&quot; &amp;&amp; res !== null) &#123; // è°ƒç”¨ reactive å°†ç»“æœåŒ…è£…æˆå“åº”å¼æ•°æ®å¹¶è¿”å› return reactive(res); &#125; // è¿”å›res return res; &#125;, set(target, key, newVal, receiver) &#123; // é¦–å…ˆè·å–æ—§å€¼ const oldValue = target[key]; // å¦‚æœå±æ€§ä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜æ˜¯åœ¨æ·»åŠ å±æ€§ï¼Œå¦åˆ™æ˜¯åœ¨è®¾ç½®å±æ€§ const triggerType = Object.prototype.hasOwnProperty(target, key) ? TRIGGER_TYPE.SET : TRIGGER_TYPE.ADD; // è®¾ç½®å±æ€§å€¼ const res = Reflect.set(target, key, newVal, receiver); // å¦‚æœtarget === receiver.rawï¼ˆrawæŒ‡å‘åŸç”Ÿå¯¹è±¡ï¼‰å°±è¯´æ˜receiverå°±æ˜¯targetçš„ä»£ç†å¯¹è±¡ if (receiver.raw === target) &#123; // æ¯”è¾ƒæ–°å€¼å’Œæ—§å€¼ï¼Œåªæœ‰ä»–ä»¬ä¸å…¨ç­‰ï¼Œå¹¶ä¸”éƒ½ä¸æ˜¯NaNçš„æ—¶å€™æ‰è§¦å‘å“åº”çš„ if ( oldValue !== newVal &amp;&amp; (oldValue === oldValue || newVal === newVal) ) &#123; // æ‰§è¡Œå‰¯ä½œç”¨ // å°†triggerTypeä½œä¸ºtriggerçš„ç¬¬ä¸‰ä¸ªå‚æ•° trigger(target, key, triggerType); &#125; &#125; return res; &#125;, // æ‹¦æˆªinæ“ä½œç¬¦ has(target, key) &#123; track(target, key); return Reflect.has(target, key); &#125;, // æ‹¦æˆªfor...in..., è·å–æ‰€æœ‰å¯¹è±¡æ‰€æœ‰key ownKeys(target) &#123; // å°†å‰¯ä½œç”¨å‡½æ•°ä¸ITERATE_KEYå…³è”èµ·æ¥ track(target, ITERATE_KEY); return Reflect.ownKeys(target); &#125;, // æ‹¦æˆªdeleteæ“ä½œç¬¦ deleteProperty(target, key) &#123; // æ£€æŸ¥è¢«æ“ä½œçš„å±æ€§æ˜¯å¦æ˜¯å¯¹è±¡è‡ªå·±çš„å±æ€§ const hasKey = Object.prototype.hasOwnProperty.call(target, key); // ä½¿ç”¨Reflect.deleteProperty å®Œæˆå±æ€§çš„åˆ é™¤ const res = Reflect.deleteProperty(target, key); if (hasKey &amp;&amp; res) &#123; // åªæœ‰åˆ é™¤çš„æ˜¯è‡ªå·±çš„å±æ€§ï¼Œå¹¶ä¸”æˆåŠŸåˆ é™¤ï¼Œæ‰å›å»è§¦å‘triggerå‡½æ•° trigger(target, key, TRIGGER_TYPE.DELETE); &#125; return res; &#125;, &#125;);&#125; ä¹‹åçš„reactiveå’ŒshallowReactiveå°±è°ƒç”¨ç©¿ä¸åŒå‚æ•°å°±å¥½äº† 1234567function reactive(data) &#123; return createReactive(data)&#125;function shallowReactive(data)&#123; return createReactive(data, true)&#125; å¦‚ä¸‹ä¾‹å­ï¼š 12345678910111213141516const data = &#123; a: &#123; b: &quot;weng&quot; &#125; &#125;;const data2 = &#123; a: &#123; b: &quot;weng2&quot; &#125; &#125;;const obj = reactive(data);const obj2 = shallowReactive(data2);effect(() =&gt; &#123; console.log(obj.a.b);&#125;);effect(() =&gt; &#123; console.log(obj2.a.b);&#125;);obj.a.b = &quot;kaimin&quot;;obj2.a.b = &quot;kaimin2&quot;; è¿™æ ·å°±OK æµ…ä¸æ·±çš„åªè¯»åªè¯»çš„æ¦‚å¿µï¼Œå°±æ˜¯å°è¯•ä¿®æ”¹åªè¯»æ•°æ®çš„æ—¶å€™ï¼Œä¼šé˜»æ­¢å…¶å€¼çš„ä¿®æ”¹ï¼Œæˆ–è€…åˆ é™¤æŸä¸ªåªè¯»æ•°æ®çš„æ—¶å€™ï¼Œä¼šé˜»æ­¢ï¼Œå¹¶ä¸”æŠ›å‡ºè­¦å‘Šã€‚ æˆ‘ä»¬æä¾›ä¸€ä¸ª readonlyçš„å‡½æ•°ï¼Œå°†æŸä¸ªæ•°æ®å˜æˆåªè¯»çš„ã€‚ 1234567const obj = readonly(&#123; a: &#x27;weng&#x27; &#125;);effect(()=&gt;&#123; console.log(obj.a); // å¯ä»¥è¯»ï¼Œä½†æ˜¯åœ¨è¿™é‡Œå°±ä¸éœ€è¦åœ¨è¿½è¸ªæ•°æ®&#125;)obj.a = &#x27;kaimin&#x27;; // ä¿®æ”¹å¤±è´¥ï¼Œå¹¶ä¸”æŠ›å‡ºè­¦å‘Š åªè¯»æœ¬è´¨ä¹Ÿæ˜¯å¯¹æ•°æ®å¯¹è±¡åšäº†ä¸€å±‚ä»£ç†ï¼Œæˆ‘ä»¬å¯ä»¥æœç”¨ä¸Šè¿°å°è£…çš„createReactiveçš„å‡½æ•°æ¥æ”¹é€ ï¼Œå¹¶ä¸”åŠ å…¥isReadonlyå‚æ•° æ”¹é€ createReative12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091// æ–°å¢isShallowè¡¨ç¤ºæµ…è¿˜æ˜¯æ·±å“åº”ï¼ŒisReadonlyè¡¨ç¤ºæµ…è¿˜æ˜¯æ·±åªè¯»function createReactive(data, isShallow = false, isReadonly = false) &#123; return new Proxy(data, &#123; get(target, key, receiver) &#123; // ä»£ç†å¯¹è±¡å¯ä»¥é€šè¿‡rawçš„å±æ€§ï¼Œè®¿é—®åŸå§‹çš„æ•°æ® if (key === &quot;raw&quot;) &#123; return target; &#125; // éåªè¯»çš„æ•°æ®æ‰éœ€è¦å»ºç«‹å“åº”å¼çš„è”ç³» if (!isReadonly) &#123; // â• track(target, key); &#125; // è¿”å›å‡½æ•°å±æ€§ï¼Œå¾—åˆ°åŸå§‹å€¼ç»“æœ const res = Reflect.get(target, key, receiver); // å¦‚æœæ˜¯æµ…å“åº”ç›´æ¥è¿”å› if (isShallow) &#123; return res; &#125; if (typeof res === &quot;object&quot; &amp;&amp; res !== null) &#123; // è°ƒç”¨ reactive å°†ç»“æœåŒ…è£…æˆå“åº”å¼æ•°æ®å¹¶è¿”å› return reactive(res); &#125; // è¿”å›res return res; &#125;, set(target, key, newVal, receiver) &#123; // å¦‚æœæ˜¯åªè¯»çš„ï¼Œåˆ™æ‰“å°è­¦å‘Šä¿¡æ¯å¹¶è¿”å› if (isReadonly) &#123; // â• console.warn(`the param $&#123;key&#125; is readonly`); return true; &#125; // é¦–å…ˆè·å–æ—§å€¼ const oldValue = target[key]; // å¦‚æœå±æ€§ä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜æ˜¯åœ¨æ·»åŠ å±æ€§ï¼Œå¦åˆ™æ˜¯åœ¨è®¾ç½®å±æ€§ const triggerType = Object.prototype.hasOwnProperty(target, key) ? TRIGGER_TYPE.SET : TRIGGER_TYPE.ADD; // è®¾ç½®å±æ€§å€¼ const res = Reflect.set(target, key, newVal, receiver); // å¦‚æœtarget === receiver.rawï¼ˆrawæŒ‡å‘åŸç”Ÿå¯¹è±¡ï¼‰å°±è¯´æ˜receiverå°±æ˜¯targetçš„ä»£ç†å¯¹è±¡ if (receiver.raw === target) &#123; // æ¯”è¾ƒæ–°å€¼å’Œæ—§å€¼ï¼Œåªæœ‰ä»–ä»¬ä¸å…¨ç­‰ï¼Œå¹¶ä¸”éƒ½ä¸æ˜¯NaNçš„æ—¶å€™æ‰è§¦å‘å“åº”çš„ if ( oldValue !== newVal &amp;&amp; (oldValue === oldValue || newVal === newVal) ) &#123; // æ‰§è¡Œå‰¯ä½œç”¨ // å°†triggerTypeä½œä¸ºtriggerçš„ç¬¬ä¸‰ä¸ªå‚æ•° trigger(target, key, triggerType); &#125; &#125; return res; &#125;, // æ‹¦æˆªinæ“ä½œç¬¦ has(target, key) &#123; track(target, key); return Reflect.has(target, key); &#125;, // æ‹¦æˆªfor...in..., è·å–æ‰€æœ‰å¯¹è±¡æ‰€æœ‰key ownKeys(target) &#123; // å°†å‰¯ä½œç”¨å‡½æ•°ä¸ITERATE_KEYå…³è”èµ·æ¥ track(target, ITERATE_KEY); return Reflect.ownKeys(target); &#125;, // æ‹¦æˆªdeleteæ“ä½œç¬¦ deleteProperty(target, key) &#123; // å¦‚æœæ˜¯åªè¯»çš„ï¼Œåˆ é™¤å¤±è´¥ï¼Œæç¤º if (isReadonly) &#123; // â• console.warn(`the param $&#123;key&#125; is readonly`); return true; &#125; // æ£€æŸ¥è¢«æ“ä½œçš„å±æ€§æ˜¯å¦æ˜¯å¯¹è±¡è‡ªå·±çš„å±æ€§ const hasKey = Object.prototype.hasOwnProperty.call(target, key); // ä½¿ç”¨Reflect.deleteProperty å®Œæˆå±æ€§çš„åˆ é™¤ const res = Reflect.deleteProperty(target, key); if (hasKey &amp;&amp; res) &#123; // åªæœ‰åˆ é™¤çš„æ˜¯è‡ªå·±çš„å±æ€§ï¼Œå¹¶ä¸”æˆåŠŸåˆ é™¤ï¼Œæ‰å›å»è§¦å‘triggerå‡½æ•° trigger(target, key, TRIGGER_TYPE.DELETE); &#125; return res; &#125;, &#125;);&#125; æ”¹é€ ç‚¹ï¼š åŠ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°isReadonlyè¡¨ç¤ºæ˜¯åªè¯»è¿˜æ˜¯éåªè¯» åœ¨getterä¸­åŠ å…¥åˆ¤æ–­ï¼Œå½“åªæœ‰éåªè¯»çš„æ•°æ®ï¼Œæ‰éœ€è¦è¿›è¡Œå“åº”å¼çš„è¿½è¸ªï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨trackå‡½æ•° åœ¨setterå½“ä¸­åŠ å…¥åˆ¤æ–­ï¼Œåªè¯»çš„æ•°æ®ç›´æ¥è¿”å›trueï¼Œå¹¶ä¸”æŠ›å‡ºè­¦å‘Š åœ¨æ‹¦æˆªdeleteæ“ä½œç¬¦ä¸­ï¼ŒåŠ å…¥åˆ¤æ–­ï¼Œåªè¯»çš„æ•°æ®ç›´æ¥è¿”å›trueï¼Œå¹¶ä¸”æŠ›å‡ºè­¦å‘Š å°è£…æ·±å“åº”readonlyå’Œæµ…å“åº”shallowReadonlyå¦‚ä¸Šçš„å®ç°ï¼Œåªæ˜¯å¯¹æ•°æ®è¿›è¡Œäº†ä¸€å±‚æµ…å±‚çš„readonlyï¼Œä¹Ÿå°±æ˜¯vueä¸­çš„shallowReadonlyï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰æ·±åªè¯»readonlyå‡½æ•°ï¼Œå¯¹æ•°æ®è¿›è¡Œæ·±å±‚çš„åªè¯»ï¼Œå¹¶ä¸”å¯¹getterè¿›è¡Œæ”¹é€ ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495function readonly(data)&#123; return createReactive(data, false, true)&#125;// æ–°å¢isShallowè¡¨ç¤ºæµ…è¿˜æ˜¯æ·±å“åº”ï¼ŒisReadonlyè¡¨ç¤ºæµ…è¿˜æ˜¯æ·±åªè¯»function createReactive(data, isShallow = false, isReadonly = false) &#123; return new Proxy(data, &#123; get(target, key, receiver) &#123; // ä»£ç†å¯¹è±¡å¯ä»¥é€šè¿‡rawçš„å±æ€§ï¼Œè®¿é—®åŸå§‹çš„æ•°æ® if (key === &quot;raw&quot;) &#123; return target; &#125; // éåªè¯»çš„æ•°æ®æ‰éœ€è¦å»ºç«‹å“åº”å¼çš„è”ç³» if (!isReadonly) &#123; track(target, key); &#125; // è¿”å›å‡½æ•°å±æ€§ï¼Œå¾—åˆ°åŸå§‹å€¼ç»“æœ const res = Reflect.get(target, key, receiver); // å¦‚æœæ˜¯æµ…å“åº”ç›´æ¥è¿”å› if (isShallow) &#123; return res; &#125; if (typeof res === &quot;object&quot; &amp;&amp; res !== null) &#123; // è°ƒç”¨ reactive / readonly å°†ç»“æœåŒ…è£…æˆå“åº”å¼æ•°æ®å¹¶è¿”å› return isReadonly ? readonly(res) : reactive(res); // â• &#125; // è¿”å›res return res; &#125;, set(target, key, newVal, receiver) &#123; // å¦‚æœæ˜¯åªè¯»çš„ï¼Œåˆ™æ‰“å°è­¦å‘Šä¿¡æ¯å¹¶è¿”å› if (isReadonly) &#123; console.warn(`the param $&#123;key&#125; is readonly`); return true; &#125; // é¦–å…ˆè·å–æ—§å€¼ const oldValue = target[key]; // å¦‚æœå±æ€§ä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜æ˜¯åœ¨æ·»åŠ å±æ€§ï¼Œå¦åˆ™æ˜¯åœ¨è®¾ç½®å±æ€§ const triggerType = Object.prototype.hasOwnProperty(target, key) ? TRIGGER_TYPE.SET : TRIGGER_TYPE.ADD; // è®¾ç½®å±æ€§å€¼ const res = Reflect.set(target, key, newVal, receiver); // å¦‚æœtarget === receiver.rawï¼ˆrawæŒ‡å‘åŸç”Ÿå¯¹è±¡ï¼‰å°±è¯´æ˜receiverå°±æ˜¯targetçš„ä»£ç†å¯¹è±¡ if (receiver.raw === target) &#123; // æ¯”è¾ƒæ–°å€¼å’Œæ—§å€¼ï¼Œåªæœ‰ä»–ä»¬ä¸å…¨ç­‰ï¼Œå¹¶ä¸”éƒ½ä¸æ˜¯NaNçš„æ—¶å€™æ‰è§¦å‘å“åº”çš„ if ( oldValue !== newVal &amp;&amp; (oldValue === oldValue || newVal === newVal) ) &#123; // æ‰§è¡Œå‰¯ä½œç”¨ // å°†triggerTypeä½œä¸ºtriggerçš„ç¬¬ä¸‰ä¸ªå‚æ•° trigger(target, key, triggerType); &#125; &#125; return res; &#125;, // æ‹¦æˆªinæ“ä½œç¬¦ has(target, key) &#123; track(target, key); return Reflect.has(target, key); &#125;, // æ‹¦æˆªfor...in..., è·å–æ‰€æœ‰å¯¹è±¡æ‰€æœ‰key ownKeys(target) &#123; // å°†å‰¯ä½œç”¨å‡½æ•°ä¸ITERATE_KEYå…³è”èµ·æ¥ track(target, ITERATE_KEY); return Reflect.ownKeys(target); &#125;, // æ‹¦æˆªdeleteæ“ä½œç¬¦ deleteProperty(target, key) &#123; // å¦‚æœæ˜¯åªè¯»çš„ï¼Œåˆ é™¤å¤±è´¥ï¼Œæç¤º if (isReadonly) &#123; console.warn(`the param $&#123;key&#125; is readonly`); return true; &#125; // æ£€æŸ¥è¢«æ“ä½œçš„å±æ€§æ˜¯å¦æ˜¯å¯¹è±¡è‡ªå·±çš„å±æ€§ const hasKey = Object.prototype.hasOwnProperty.call(target, key); // ä½¿ç”¨Reflect.deleteProperty å®Œæˆå±æ€§çš„åˆ é™¤ const res = Reflect.deleteProperty(target, key); if (hasKey &amp;&amp; res) &#123; // åªæœ‰åˆ é™¤çš„æ˜¯è‡ªå·±çš„å±æ€§ï¼Œå¹¶ä¸”æˆåŠŸåˆ é™¤ï¼Œæ‰å›å»è§¦å‘triggerå‡½æ•° trigger(target, key, TRIGGER_TYPE.DELETE); &#125; return res; &#125;, &#125;);&#125; æˆ‘ä»¬åœ¨getterè¿”å›å±æ€§ä¹‹å‰ï¼Œåˆ¤æ–­ä»–æ˜¯å¦æ˜¯åªè¯»çš„ï¼Œå†å»è°ƒç”¨readonlyå¯¹å€¼åŒ…è£…å¹¶ä¸”è¿”å› å¯¹äºshallowReadonlyæˆ‘ä»¬åªéœ€è¦æŠŠç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸ºtrueå°±å¥½äº†ï¼ˆisShallowï¼‰ 123function shallowReadonly(data) &#123; return createReactive(data, true, true);&#125; å¦‚ä¸‹ä¾‹å­ï¼š 12345678910111213141516const data = &#123; a: &#123; b: &quot;weng&quot; &#125; &#125;;const data2 = &#123; a: &#123; b: &quot;weng2&quot; &#125; &#125;;const obj = readonly(data);const obj2 = shallowReadonly(data2);effect(() =&gt; &#123; console.log(obj.a.b);&#125;);effect(() =&gt; &#123; console.log(obj2.a.b);&#125;);obj.a.b = &quot;kaimin&quot;;obj2.a.b = &quot;kaimin2&quot;; Step8ï¼šåŸå§‹å€¼çš„å“åº”å®ç°å¦‚ä¸Šçš„step1ï½step7éƒ½æ˜¯åœ¨è®¨è®º å¼•ç”¨ç±»å‹çš„æ•°æ®å“åº”å¼ï¼ˆç›®å‰åˆ°è¿™é‡Œåªè®²è¿‡objçš„å¼•ç”¨ä»£ç†ï¼‰ å› ä¸ºæˆ‘ä»¬ä¸Šè¿°çš„è®¨è®ºéƒ½æ˜¯åŸºäºjs çš„proxyçš„æ¥å®ç°çš„ï¼Œä½†æ˜¯Proxyä¸èƒ½ç”¨äºåŸå§‹å€¼çš„ä»£ç† ç°åœ¨è¯´ä¸€ä¸‹åŸå§‹æ•°æ®ç±»å‹çš„å“åº”å¼æ–¹æ¡ˆï¼ˆBooleanï¼ŒNumberï¼ŒBigIntï¼ŒStringï¼ŒSymbolï¼Œundifinedï¼Œnullï¼‰ã€‚ å®ç°refåœ¨vue3ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨refæˆ–è€…reactiveå®ç°æ•°æ®çš„å“åº”ï¼Œæ¯”è¾ƒå¸¸ç”¨å®ç°åŸå§‹æ•°æ®çš„ä»£ç†å°±æ˜¯ç”¨refåŒ…è£¹å®ç° 123456const num = ref(2);// è¯»å–console.log(num.value)// ä¿®æ”¹num.value = 3; å‚ç…§vue3çš„å®ç°æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å®ç°ä¸€ä¸ªrefçš„å·¥å‚å‡½æ•° refå‡½æ•°ï¼š 123456789// refå‡½æ•°function ref(val) &#123; // åœ¨refå‡½æ•°å†…éƒ¨åˆ›å»ºåŒ…è£¹å¯¹è±¡ const wrapper = &#123; value: val, &#125;; // å°†åŒ…è£¹å¯¹è±¡å˜æˆå“åº”å¼æ•°æ® return reactive(wrapper);&#125; vue3ä¸­å¯¹refç±»å‹çš„æ•°æ®åšäº†å¾ˆå¤šåˆ¤æ–­ï¼Œæ‰€ä»¥å‰ææ˜¯æˆ‘ä»¬éœ€è¦å‘Šè¯‰ä½¿ç”¨åˆ°è¿™ä¸ªrefçš„åœ°æ–¹ï¼Œæˆ–è€…æŸäº›åœºæ™¯ä¸‹ï¼ˆä¾‹å¦‚æ¨¡æ¿ä¸­è‡ªåŠ¨è„±ç¦»refçš„æ“ä½œï¼‰ã€‚æ‰€ä»¥ åŠ å…¥refæ ‡è¯†12345678910111213141516// refå‡½æ•°function ref(val) &#123; // åœ¨refå‡½æ•°å†…éƒ¨åˆ›å»ºåŒ…è£¹å¯¹è±¡ const wrapper = &#123; value: val, &#125;; // åœ¨wrapperå¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªä¸å¯æšä¸¾çš„å±æ€§__v_isRefï¼Œè®¾ç½®å€¼ä¸ºtrue Object.defineProperties(wrapper, &quot;__v_isRef&quot;, &#123; value: true, enumerable: false, &#125;); // å°†åŒ…è£¹å¯¹è±¡å˜æˆå“åº”å¼æ•°æ® return reactive(wrapper);&#125; å®ç°toRefä»¥åŠtoRefsåœ¨å®ç°toRefå’ŒtoRefsä¹‹å‰ï¼Œéœ€è¦äº†è§£ä¸€ä¸ªVue3å¸¸ç”¨åœºæ™¯ï¼Œå°±æ˜¯å“åº”å¼ä¸¢å¤±çš„åœºæ™¯ åœ¨vue3ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨setupè¿™ä¹ˆæ 12345678export default &#123; setup()&#123; const obj = reactive(&#123; a:1, b:2 &#125;); return &#123; ...obj &#125; &#125;&#125; ç„¶ååœ¨æ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬å°±èƒ½è¯»å–a, bçš„å€¼ 123&lt;temlplate&gt; &lt;span&gt;&#123;&#123; a &#125;&#125; / &#123;&#123; b &#125;&#125;&lt;/span&gt;&lt;/template&gt; ä½†æ˜¯å…¶å®è¿™ä¹ˆåšä¼šé€ æˆå“åº”å¼çš„ä¸¢å¤±ã€‚ å› ä¸ºåœ¨æˆ‘ä»¬çš„setupä¸­ï¼Œæœ€ç»ˆreturnçš„æ˜¯ä¸€ä¸ª æ–°çš„å¯¹è±¡ 12345678return &#123; ...obj&#125;// ç­‰ä»·äºreturn &#123; a: 1, b: 2,&#125; ç”¨å¦å¤–ä¸€ä¸ªç§æ–¹å¼æè¿°å“åº”å¼ä¸¢å¤±å°±æ˜¯ï¼š 123456789101112131415const data = &#123; a: 1 &#125;;const obj = reactive(data);const newObj = &#123; ...obj,&#125;;effect(() =&gt; &#123; console.log(newObj.a);&#125;);setTimeout(() =&gt; &#123; obj.a = 2; // æ— æ³•è§¦å‘å‰¯ä½œç”¨å‡½æ•°çš„é‡æ–°æ‰§è¡Œ&#125;, 2000); æˆ‘ä»¬æœ€ç»ˆçš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆæ¨¡æ¿é‡Œå¤´å°±æ˜¯renderå‡½æ•°ï¼‰è¯»å–çš„å…¶å®æ˜¯newObjå¯¹è±¡ï¼Œè¿™ä¸ªå¹¶ä¸æ˜¯å“åº”çš„æ•°æ® å½“ç„¶ä¹Ÿæ˜¯æœ‰è§£å†³çš„æ–¹æ³• 1234567891011121314151617181920212223const data = &#123; a: 1 &#125;;const obj = reactive(data);const newObj = &#123; a: &#123; get value() &#123; return obj.a; &#125;, &#125;, b: &#123; get value() &#123; return obj.b; &#125;, &#125;,&#125;;effect(() =&gt; &#123; console.log(newObj.a.value);&#125;);setTimeout(() =&gt; &#123; obj.a = 2; // æ— æ³•è§¦å‘å‰¯ä½œç”¨å‡½æ•°çš„é‡æ–°æ‰§è¡Œ&#125;, 2000); æˆ‘ä»¬å¯¹newObjçš„aå±æ€§æˆ–è€…bå±æ€§éƒ½æ¤å…¥ä¸€ä¸ªè®¿é—®å™¨çš„å±æ€§valueï¼Œå½“å»è¯»å–valueçš„å€¼çš„æ—¶å€™ï¼Œæœ€ç»ˆè¯»å–çš„æ˜¯å“åº”å¼æ•°æ®objä¸‹é¢çš„åŒåå±æ€§ã€‚è¿™æ ·å°±å¯ä»¥ä¸å‰¯ä½œç”¨å‡½æ•°å»ºç«‹èµ·å“åº”è”ç³» å› æ­¤æˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸‹ç»“æ„ä½“ï¼Œæå–å…¬å…±çš„ä¸€ä¸ªå°è£…å‡½æ•°toRef toRef123456789101112function toRef(obj, key)&#123; const wrapper = &#123; get value()&#123; return obj[key] &#125;, set value(val)&#123; return obj[key] = val &#125; &#125; return wrapper&#125; toRefæ¥å—ä¸¤ä¸ªå‚æ•° obj: å“åº”å¼æ•°æ® key: å“åº”å¼æ•°æ®çš„ä¸€ä¸ªkey return: è¿”å›ä¸€ä¸ªç±»ä¼¼ä¸refçš„ä¸€ä¸ªwrapperå¯¹è±¡ å¹¶ä¸”åŠ å…¥setter è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡æ–°å®šä¹‰newObjå¯¹è±¡ 1234const newObj = &#123; a: toRef(obj, &#x27;a&#x27;), b: toRef(obj, &#x27;b&#x27;),&#125; toRefså¦‚ä¸Šçš„toRefåªèƒ½å®ç°å•ä¸€çš„keyå€¼è½¬åŒ– å¦‚æœéœ€è¦è½¬åŒ–çš„é”®å€¼å¾ˆå¤šï¼Œå°±éœ€è¦toRefsæ‰¹é‡è½¬æ¢çš„èƒ½åŠ› 123456789function toRefs(obj)&#123; const res = &#123;&#125;; // ä½¿ç”¨for...in...å¾ªç¯éå†å¯¹è±¡ for(const key in obj) &#123; // é€ä¸ªè°ƒç”¨toRefå®Œæˆè½¬æ¢ res[key] = toRef(obj, key) &#125; return res;&#125; å› æ­¤å¦‚ä¸Šçš„ä¾‹å­å¯ä»¥ç®€åŒ–ä¸ºï¼š 12345678910111213const data = &#123; a: 1 &#125;;const obj = reactive(data);const &#123; a &#125; = toRefs(obj);effect(() =&gt; &#123; console.log(a.value);&#125;);setTimeout(() =&gt; &#123; obj.a = 2; // é‡æ–°è§¦å‘è¯»äº†açš„å‰¯ä½œç”¨å‡½æ•°&#125;, 2000); åŠ å…¥refæ ‡è¯†å› ä¸ºæˆ‘ä»¬æ— è®ºä½¿ç”¨toRefè¿˜æ˜¯toRefsè½¬åŒ–å‡ºæ¥çš„æ•°æ®ï¼Œåœ¨vue3ä¸­éƒ½æ˜¯è¢«æ ‡è¯†ä¸ºrefç±»å‹çš„æ•°æ®çš„ã€‚æ‰€ä»¥éœ€è¦åœ¨toRefä¸­å¢åŠ å’Œå¦‚ä¸Šä¸€è‡´çš„ __v_isRefæ ‡è¯† 123456789101112131415function toRef(obj, key) &#123; const wrapper = &#123; get value() &#123; return obj[key]; &#125;, &#125;; // åœ¨wrapperå¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªä¸å¯æšä¸¾çš„å±æ€§__v_isRefï¼Œè®¾ç½®å€¼ä¸ºtrue Object.defineProperties(wrapper, &quot;__v_isRef&quot;, &#123; value: true, enumerable: false, &#125;); return wrapper;&#125; è„±ç¦»refä¸Šé¢çš„toRefåŒ…è£¹å¯¹è±¡ï¼Œæœ€ç»ˆç”Ÿæˆçš„refæ•°æ®æ˜¯éœ€è¦é€šè¿‡â€™.valueâ€™å±æ€§è®¿é—® 123456789const obj = reactive(&#123; a: 1, b: 2,&#125;)const newObj = toRefs(obj);console.log(newObj.a.value) åœ¨vue3ä¸­çš„æ¨¡æ¿å†…ï¼Œä»–æ˜¯å­˜åœ¨è‡ªåŠ¨è„±ç¦»refçš„èƒ½åŠ› 1234567891011&lt;template&gt; &lt;span&gt; &#123;&#123; newObj.a &#125;&#125; &lt;/span&gt;&lt;/template&gt;&lt;script setup&gt; const obj = reactive(&#123; a: 1, b: 2, &#125;) const newObj = toRefs(obj);&lt;/script&gt; æˆ–è€… 123456789&lt;script&gt;export default &#123; setup()&#123; const count = ref(12121) return &#123; count &#125; &#125;&#125;&lt;/script&gt; æœ€ç»ˆè¿™ä¸ªè¿”å›çš„å¯¹è±¡éƒ½ä¼šåœ¨vue3ä¸­è¢«å¤„ç†ä¸€æ¬¡ï¼Œå°†refçš„æ•°æ®è„±ç¦»ref å…¶å®æœ€ç»ˆåœ¨setupé‡Œå¤´è¿”å›çš„å¯¹è±¡ï¼Œä¼šè¢«vue3é€šè¿‡ proxyRefsè„±ç¦»ref å®ç°proxyRefsç»“åˆä¹‹å‰åŠ å…¥çš„ __v_isRefæ ‡è¯†ï¼Œä½¿ç”¨proxyä¸ºrefåˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚ 12345678910111213141516171819function proxyRefs(target)&#123; return new Proxy(target, &#123; get(target, key, receiver)&#123; const value = Reflect.get(target, key, receiver) // è‡ªåŠ¨è„±ç¦»refï¼Œé€šè¿‡__v_isRefçš„æ ‡è¯†ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯refï¼Œæ˜¯çš„è¯è¿”å›valueå€¼ return value.__v_isRef ? value.value : value &#125;, set(target, key, newValue, receiver)&#123; // é€šè¿‡targetè¯»å–çœŸå®çš„å€¼ const value = target[key]; // å¦‚æœæ˜¯Refï¼Œ åˆ™è®¾ç½®å…¶å¯¹åº”çš„valueçš„å±æ€§å€¼ if(value.__v_isRef)&#123; value.value = newValue; return true &#125; return Reflect.set(target, key, newValue, receiver) &#125; &#125;)&#125; è¿™æ ·å°±å¯ä»¥å®ç°è‡ªåŠ¨è„±ç¦»refçš„åŠŸèƒ½ 123const newObj = proxyRefs(&#123; ...toRefs(obj) &#125;);console.log(newObj.a); // 1","tags":["Vue"]},{"title":"ä¸ºä½•Vue3 Proxy æ›´å¿«","path":"/2022/04/21/ä¸ºä½•Vue3-Proxy-æ›´å¿«/","content":"ç›¸æ¯”äºVue2.x Object.definePropertyçš„å“åº”å¼åŸç†ï¼ŒVue3 Proxyçš„ä¼˜åŠ¿åœ¨å“ªé‡Œå‘¢ã€‚ä»¥ä¸‹æˆ‘ä»¬ä»ä¸¤è€…æºç è§’åº¦åˆ†æä¸‹ä½¿ç”¨Proxyçš„ä¼˜åŠ¿ã€‚ Proxyä¼˜åŠ¿ï¼š ES6åŸç”ŸProxyè¯­æ³•ï¼Œæ›´å¿«çš„åˆå§‹åŒ–ï¼Œæ‡’åŠ è½½ï¼Œä¸ç”¨é€’å½’çš„å®šä¹‰Object.defineProperty æ”¯æŒåŠ¨æ€çš„æ·»åŠ objectæ–°å±æ€§ æ”¯æŒåŸç”Ÿarrayæ•°ç»„æ“ä½œ å‡è®¾æœ‰å¦‚ä¸‹çš„å“åº”å¼å¯¹è±¡æ—¶ï¼š 12345678910111213data() &#123; return &#123; a: &#123; b: &#123; c: &#123; d: &#123; e: 11 &#125; &#125; &#125; &#125; &#125;&#125;// ä»¥ä¸Šç­‰ä»·äºä»¥ä¸‹ä»£ç const data = &#123; a: &#123; b: &#123; c: &#123; d: &#123; e: 11 &#125; &#125; &#125; &#125; &#125;// Vue2.xVue.observe(data)// Vue3ï¼šreactive(data) Copied! #Vue2.x Object.definePropertyvue2åˆå§‹åŒ–æ—¶ï¼Œä¼šé€’å½’çš„è°ƒç”¨Object.definePropertyã€‚å½“ç¬¬ä¸€å±‚å¯¹è±¡å±æ€§å®šä¹‰åï¼Œå†ä¼šé€’å½’è°ƒç”¨ä¸‹ä¸€å±‚å±æ€§çš„Object.definePropertyï¼ˆä¸ºäº†æ˜¯ä¾èµ–æ”¶é›†ï¼‰ã€‚æ‰€ä»¥åœ¨åˆå§‹åŒ–æ—¶Vue2.xéœ€è¦æ›´å¤šæ—¶é—´ï¼Œå»åŒæ­¥é€’å½’å®šä¹‰Object.definePropertyæ“ä½œã€‚ å¦å¤–ä¸€ä¸ªç¼ºç‚¹ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œåˆå§‹åŒ–æ—¶æŠŠdataçš„å±æ€§é€’å½’éå†æ”¶é›†äº†ï¼Œå½“dataåœ¨ä¸šåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒåŠ¨æ€æ–°å¢å±æ€§è¯¥æ€ä¹ˆåŠï¼Ÿåœ¨Vue2.xä¸­ç”±äºä¸æ˜¯æ‡’åŠ è½½ï¼Œæ‰€ä»¥éœ€è¦ç”¨æˆ·ä¸»åŠ¨å‘Šè¯‰Vueæ¡†æ¶ï¼Œå‘Šè¯‰å“ªäº›æ–°å¢å±æ€§æ˜¯è¦å»ä¾èµ–æ”¶é›†çš„ï¼Œè¿™å°±æ˜¯Vue.set (opens new window)APIçš„æ¥ç”±ã€‚åŒç†Vue.delete (opens new window)ã€‚ ä»¥ä¸‹æ˜¯ç²¾ç®€ä¸»æµç¨‹çš„æºç ï¼ŒVue2.xä¸­å®šä¹‰å“åº”å¼å¯¹è±¡APIæ˜¯ï¼šVue.observe(data) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051// https://github.com/vuejs/vue/blob/dev/src/core/observer/index.jsexport function observe (value: any, asRootData: ?boolean): Observer | void &#123; let ob = new Observer(value) return ob&#125;export class Observer &#123; constructor (value: any) &#123; this.walk(value) &#125; walk (obj: Object) &#123; const keys = Object.keys(obj) for (let i = 0; i &lt; keys.length; i++) &#123; defineReactive(obj, keys[i]) &#125; &#125;&#125;export function defineReactive ( obj: Object, key: string, val: any, customSetter?: ?Function, shallow?: boolean // default: false) &#123; const dep = new Dep() const getter = property &amp;&amp; property.get const setter = property &amp;&amp; property.setter // åŒæ­¥å®æ—¶ï¼šé€’å½’å­å±‚çº§ let childOb = !shallow &amp;&amp; observe(val) Object.defineProperty(obj, key, &#123; enumerable: true, configurable: true, get: function reactiveGetter () &#123; const value = getter ? getter.call(obj) : val // ... depä¾èµ–æ”¶é›† return value &#125;, set: function reactiveSetter (newVal) &#123; setter.call(obj, newVal) // ... depè§¦å‘æ›´æ–° &#125; &#125;)&#125; Copied! #Vue3 Proxyå¤„ç†Vue3ä¸­å®šä¹‰å“åº”å¼å¯¹è±¡APIæ˜¯ï¼šreactive(data)ã€‚ Proxyæä¾›äº†å¯¹JSçš„å…ƒæ•°æ®ç¼–ç¨‹ï¼Œå³å¯ä»¥ä½¿ç”¨JSæä¾›çš„è¯­æ³•ç‰¹æ€§ï¼Œåˆ›å»ºæ–°çš„JSè¯­æ³•ã€‚ å¯ä»¥çœ‹åˆ°Vue3ä¸­å®šä¹‰å“åº”å¼éå¸¸ç®€å•ï¼Œå³åŸç”Ÿçš„ new Proxy(target, handlers)ã€‚æ­¤æ—¶è¿™é‡Œæ²¡æœ‰é€’å½’è°ƒç”¨åˆå§‹åŒ–ï¼Œå³å¯çœ‹æˆæ˜¯æ‡’åŠ è½½å»ä¾èµ–æ”¶é›†ï¼ˆç”¨åˆ°æ‰å»ä¾èµ–æ”¶é›†ï¼‰ã€‚ å†çœ‹çœ‹ä»£ç†æ“ä½œbaseHandlersä¸­getå®šä¹‰æ˜¯å¦‚ä½•çš„ã€‚ 12345678910111213141516// https://github.com/vuejs/vue-next/blob/master/packages/reactivity/src/reactive.tsexport function reactive(target: object) &#123; return createReactiveObject(target)&#125;function createReactiveObject(target: Target) &#123; const observed = new Proxy( target, baseHandlers // &#123;get, set, deleteProperty&#125; ) return observed&#125; Copied! getå®šä¹‰ï¼Œä¸»è¦ç”¨æ¥ä¾èµ–æ”¶é›†ï¼ŒåŒæ—¶å¦‚æœå±æ€§çš„valueä¸ºObjectå¯¹è±¡æ—¶ï¼Œè‡ªå®šè¿›è¡ŒProxyä»£ç†ã€‚ 123456789101112131415161718192021// https://github.com/vuejs/vue-next/blob/master/packages/reactivity/src/baseHandlers.tsconst get = createGetter()function createGetter(isReadonly = false, shallow = false) &#123; return function get(target: Target, key: string | symbol, receiver: object) &#123; const res = Reflect.get(target, key, receiver) // ...ä¾èµ–æ”¶é›† // æ‡’åŠ è½½ï¼Œå½“è®¿é—®å“åº”å¼å¯¹è±¡æ—¶ï¼Œå†å»æ„é€ ä¸‹ä¸€ä¸ªProxy(res, &#123; getter &#125;) if (isObject(res)) &#123; return reactive(res) &#125; return res &#125;&#125; Copied!","tags":["Vue","Proxy","Object.defineProperty"],"categories":["Javascript"]},{"title":"tsconfig.jsonå…¨è§£æ","path":"/2022/04/21/tsconfig-jsonå…¨è§£æ/","content":"è§£æ TypeScriptå¸¦æ¥çš„ç±»å‹ç³»ç»Ÿä»¥åŠå¼ºå¤§çš„IDEæ”¯æŒï¼Œè®©å‰ç«¯å¼€å‘ä¹Ÿå˜å¾—ä¸¥è°¨è€Œæµç•…ã€‚ä½†TypeScriptä¸æ˜¯åŸç”Ÿçš„Javascriptä»£ç ï¼Œéœ€è¦è¿›è¡Œç¼–è¯‘æ‰èƒ½è½¬æ¢ä¸ºJavascriptä»£ç ã€‚ tsconfig.jsonæ˜¯ç¼–è¯‘TypeScriptçš„é…ç½®æ–‡ä»¶ï¼Œå¯¹ä¹¦å†™TypeScriptä»£ç ååˆ†é‡è¦ã€‚å› ä¸ºæœ‰äº›é€‰é¡¹å¦‚æœä½ æ²¡é…ç½®ï¼Œåˆ™éœ€è¦ä¸¥æ ¼æŒ‰ç…§TypeScriptçš„è§„åˆ™æ¥ä¹¦å†™ï¼Œå¯¹åˆæœŸä½¿ç”¨TypeScriptçš„åŒå­¦è€Œè¨€ï¼Œç¨ä¸ç•™ç¥å°±ä¼šä¹¦å†™å‡ºä¸ç¬¦åˆè§„åˆ™çš„ä»£ç ï¼Œä»è€Œå¯¼è‡´ç¼–è¯‘æŠ¥é”™ï¼Œæ‰“å‡»è‡ªä¿¡å¿ƒã€‚å…¶å®æ—©æœŸå¯ä»¥é€šè¿‡å…³é—­ä¸€äº›è§„åˆ™è®¾ç½®ï¼Œä»è€Œæ›´æ„‰å¿«çš„ä»jsè½¬ä¸ºtså¼€å‘ã€‚ç¬”è€…æ ¹æ®é¡¹ç›®å®æˆ˜ç»å†æ¥è§£é‡Šä¸€äº›å¸¸ç”¨çš„ç¼–è¯‘é€‰é¡¹ï¼Œæ–‡æœ«ä¹Ÿä¼šé™„ä¸Šç¬”è€…æ•´ç†çš„æ‰€æœ‰tsconfig.jsoné€‰é¡¹çš„è§£é‡Šã€‚ 1. experimentalDecoratorsæ˜¯å¦å¯ç”¨å®éªŒæ€§çš„ESè£…é¥°å™¨ã€‚booleanç±»å‹ï¼Œé»˜è®¤å€¼ï¼šfalseã€‚å®˜æ–¹è§£é‡Š(opens new window) TypeScriptå’ŒES6ä¸­å¼•å…¥äº†Classçš„æ¦‚å¿µï¼ŒåŒæ—¶åœ¨stage 2 proposal (opens new window)æå‡ºäº†Javaç­‰æœåŠ¡å™¨ç«¯è¯­è¨€æ—©å°±æœ‰çš„è£…é¥°å™¨æ¨¡å¼ã€‚é€šè¿‡å¼•å…¥è£…é¥°å™¨æ¨¡å¼ï¼Œèƒ½æå¤§ç®€åŒ–ä¹¦å†™ä»£ç ï¼ŒæŠŠä¸€äº›é€šç”¨é€»è¾‘å°è£…åˆ°è£…é¥°å™¨ä¸­ã€‚å¾ˆå¤šåº“éƒ½æœ‰ç”¨åˆ°è¯¥ç‰¹æ€§ï¼Œæ¯”å¦‚vue-class-component åŠ vuex-classç­‰åº“ã€‚å½“ä½ ä½¿ç”¨è¿™äº›åº“æ—¶ï¼Œå¿…é¡»å¼€å¯experimentalDecoratorsã€‚ 1234567891011function f() &#123; console.log(&quot;f(): evaluated&quot;); return function (target, propertyKey: string, descriptor: PropertyDescriptor) &#123; console.log(&quot;f(): called&quot;); &#125;&#125;class C &#123; @f() method() &#123;&#125;&#125; å¯ç”¨ vuex-classåŒæ—¶éœ€è¦è®¾ç½®strictFunctionTypesé€‰é¡¹ä¸ºfalse 2. strictPropertyInitializationæ˜¯å¦ç±»çš„éundefinedå±æ€§å·²ç»åœ¨æ„é€ å‡½æ•°é‡Œåˆå§‹åŒ–ã€‚ booleanç±»å‹ï¼Œé»˜è®¤å€¼ï¼šfalse ç›´ç™½ç‚¹ï¼Œå°±æ˜¯æ‰€æœ‰çš„å±æ€§å€¼ï¼Œéƒ½éœ€è¦èµ‹æœ‰åˆå§‹å€¼ã€‚å»ºè®®æŠŠstrictPropertyInitializationè®¾ç½®ä¸ºfalseï¼Œè¿™æ ·å°±ä¸éœ€è¦å®šä¹‰ä¸€ä¸ªå˜é‡å°±å¿…é¡»èµ‹æœ‰åˆå§‹å€¼ã€‚å¯¹ä½¿ç”¨vuex-classåº“çš„åŒå­¦ï¼Œå»ºè®®è¯·æŠŠè¿™ä¸ªå€¼è®¾ä¸ºfalseï¼Œç»å¯¹èƒ½çœå¾ˆå¤šäº‹ã€‚ 12345678export default class Home extend Vue&#123; jobId: string // å¦‚æœå¼€å¯strictPropertyInitializationï¼Œåˆ™è¿™é‡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºæ²¡æœ‰èµ‹å€¼é»˜è®¤å€¼ method1() :void &#123; console.log(this.jobId) &#125;&#125; å¦‚æœè®¾ç½®è¯¥é€‰é¡¹ä¸ºtrueï¼Œéœ€è¦åŒæ—¶å¯ç”¨â€“strictNullChecksæˆ–å¯ç”¨â€“strict 3. noImplicitAnyæœ‰éšå«çš„ anyç±»å‹æ—¶æ˜¯å¦æŠ¥é”™ã€‚booleanå€¼ï¼Œé»˜è®¤å€¼ï¼šfalse tsæ˜¯æœ‰é»˜è®¤æ¨å¯¼çš„ï¼ŒåŒæ—¶è¿˜æœ‰anyç±»å‹ï¼Œæ‰€ä»¥ä¸æ˜¯æ¯ä¸ªå˜é‡æˆ–å‚æ•°å®šä¹‰éœ€è¦æ˜ç¡®å‘ŠçŸ¥ç±»å‹æ˜¯ä»€ä¹ˆã€‚å¦‚æœå¼€å¯è¯¥å€¼ï¼Œå½“æœ‰éšå«anyç±»å‹æ—¶ï¼Œä¼šæŠ¥é”™ã€‚å»ºè®®åˆæ¬¡ä¸Šæ‰‹TypeScriptï¼ŒæŠŠè¯¥é€‰é¡¹è®¾ç½®ä¸ºfalseã€‚ 123// å½“å¼€å¯noImplicitAnyæ—¶ï¼Œéœ€è¦éšå«å½“anyéœ€è¦æ˜ç¡®æŒ‡å‡ºarr.find(item =&gt; item.name === name) // errorarr.find((item: any) =&gt; item.name === name) // ok 4. targetæŒ‡å®šç¼–è¯‘çš„ECMAScriptç›®æ ‡ç‰ˆæœ¬ã€‚æšä¸¾å€¼ï¼šâ€ES3â€ï¼Œ â€œES5â€ï¼Œ â€œES6â€/ â€œES2015â€ï¼Œ â€œES2016â€ï¼Œ â€œES2017â€ï¼Œâ€ESNextâ€ã€‚é»˜è®¤å€¼ï¼š â€œES3â€ TypeScriptæ˜¯ES6çš„è¶…é›†ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨ES6æ¥ç¼–å†™tsä»£ç ï¼ˆé€šå¸¸æˆ‘ä»¬ä¹Ÿçš„ç¡®è¿™ä¹ˆåšï¼‰ã€‚ç„¶è€Œï¼Œå½“ç¼–è¯‘tsä»£ç æ—¶ï¼Œå¯ä»¥æŠŠtsè½¬ä¸ºES5æˆ–æ›´æ—©çš„jsä»£ç ã€‚æ‰€ä»¥éœ€è¦é€‰æ‹©ä¸€ä¸ªç¼–è¯‘çš„ç›®æ ‡ç‰ˆæœ¬ã€‚vue-cli3çš„typescriptæ¨¡æ¿ï¼Œè®¾ç½®ä¸ºâ€œESNextâ€ï¼Œå› ä¸ºç°ä»£å¤§éƒ¨åˆ†åº”ç”¨é¡¹ç›®éƒ½ä¼šä½¿ç”¨Webpackï¼ˆParcelä¹Ÿå¾ˆæ£’ï¼‰è¿›è¡Œæ‰“åŒ…ï¼ŒWebpackä¼šæŠŠä½ çš„ä»£ç è½¬æ¢æˆåœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­å¯è¿è¡Œçš„ä»£ç ã€‚ target: â€œESNextâ€ æ˜¯æŒ‡tc39æœ€æ–°çš„ES proposed features(opens new window) 5. moduleæŒ‡å®šç”Ÿæˆå“ªä¸ªæ¨¡å—ç³»ç»Ÿä»£ç ã€‚æšä¸¾å€¼ï¼šâ€Noneâ€ï¼Œ â€œCommonJSâ€ï¼Œ â€œAMDâ€ï¼Œ â€œSystemâ€ï¼Œ â€œUMDâ€ï¼Œ â€œES6â€ï¼Œ â€œES2015â€ï¼Œâ€ESNextâ€ã€‚é»˜è®¤å€¼æ ¹æ®â€“targeté€‰é¡¹ä¸åŒè€Œä¸åŒï¼Œå½“targetè®¾ç½®ä¸ºES6æ—¶ï¼Œé»˜è®¤moduleä¸ºâ€œES6â€ï¼Œå¦åˆ™ä¸ºâ€œcommonjsâ€ é€šå¸¸ä½¿ç”¨ES6çš„æ¨¡å—æ¥å†™tsä»£ç ï¼Œç„¶è€Œ2016å¹´1æœˆä»¥å‰ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰æµè§ˆå™¨åŸç”Ÿæ”¯æŒES6çš„æ¨¡å—ç³»ç»Ÿï¼Œæ‰€ä»¥éœ€è¦è½¬æ¢ä¸ºä¸åŒçš„æ¨¡å—ç³»ç»Ÿï¼Œå¦‚ï¼šCommonJSã€AMDã€SystemJSç­‰ï¼Œè€Œmoduleé€‰é¡¹å°±æ˜¯æŒ‡å®šç¼–è¯‘ä½¿ç”¨å¯¹åº”çš„æ¨¡å—ç³»ç»Ÿã€‚ 6. libç¼–è¯‘è¿‡ç¨‹ä¸­éœ€è¦å¼•å…¥çš„åº“æ–‡ä»¶çš„åˆ—è¡¨ã€‚string[]ç±»å‹ï¼Œå¯é€‰çš„å€¼æœ‰å¾ˆå¤šï¼Œå¸¸ç”¨çš„æœ‰ES5ï¼ŒES6ï¼ŒESNextï¼ŒDOMï¼ŒDOM.Iterableã€WebWorkerã€ScriptHostç­‰ã€‚è¯¥å€¼é»˜è®¤å€¼æ˜¯æ ¹æ®â€“targeté€‰é¡¹ä¸åŒè€Œä¸åŒã€‚å½“targetä¸ºES5æ—¶ï¼Œé»˜è®¤å€¼ä¸º[â€˜DOM â€˜, â€˜ES5â€™, â€˜ScriptHostâ€™];å½“targetä¸ºES6æ—¶ï¼Œé»˜è®¤å€¼ä¸º[â€˜DOMâ€™, â€˜ES6â€™, â€˜DOM.Iterableâ€™, â€˜ScriptHostâ€™] ä¸ºäº†åœ¨tsä»£ç ä¸­ä½¿ç”¨ES6ä¸­çš„ç±»ï¼Œæ¯”å¦‚Array.formã€Setã€Reflectç­‰ï¼Œéœ€è¦è®¾ç½®libé€‰é¡¹ï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æŠŠè¿™äº›æ ‡å‡†åº“å¼•å…¥ã€‚è¿™æ ·åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°å±äºè¿™äº›æ ‡å‡†åº“çš„classæˆ–apiæ—¶ï¼Œtsç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ã€‚ 7. moduleResolutionå†³å®šå¦‚ä½•å¤„ç†æ¨¡å—ã€‚stringç±»å‹ï¼Œâ€œnodeâ€æˆ–è€…â€œclassicâ€ï¼Œé»˜è®¤å€¼ï¼šâ€œclassicâ€ã€‚å®˜æ–¹è§£é‡Š(opens new window) è¯´ç›´ç™½ç‚¹ï¼Œä¹Ÿå°±æ˜¯é‡åˆ°import { AAA } from â€˜./aaaâ€™è¯¥å¦‚ä½•å»æ‰¾å¯¹åº”æ–‡ä»¶æ¨¡å—è§£æã€‚å¯¹äºå·¥ç¨‹é¡¹ç›®ï¼Œç¬”è€…å»ºè®®å¤§å®¶ä½¿ç”¨nodeï¼ˆvue-cli3 tsæ¨¡æ¿é»˜è®¤è®¾ç½®ä¸ºnodeç­–ç•¥ï¼‰ï¼Œå› ä¸ºè¿™ä¸ªæ›´ç¬¦åˆå¹³æ—¶æˆ‘ä»¬çš„ä¹¦å†™ä¹ æƒ¯ä»¥åŠè®¤çŸ¥ï¼ˆå¹³æ—¶éƒ½æ˜¯webpackæ‰“åŒ…ï¼ŒwebpackåˆåŸºäºnodeä¹‹ä¸Šï¼‰ã€‚ 12345678910111213141516// åœ¨æºæ–‡ä»¶/root/src/A.tsä¸­import &#123; b &#125; from &quot;./moduleB&quot;// ä¸¤ç§è§£ææ–¹å¼æŸ¥æ‰¾æ–‡ä»¶æ–¹å¼ä¸åŒ// classicæ¨¡å—è§£ææ–¹å¼1. /root/src/moduleB.ts2. /root/src/moduleB.d.ts// nodeæ¨¡å—è§£ææ–¹å¼1. /root/src/moduleB.ts2. /root/src/moduleB.tsx3. /root/src/moduleB.d.ts4. /root/src/moduleB/package.json (if it specifies a &quot;types&quot; property)5. /root/src/moduleB/index.ts6. /root/src/moduleB/index.tsx7. /root/src/moduleB/index.d.ts 8. pathsæ¨¡å—åæˆ–è·¯å¾„æ˜ å°„çš„åˆ—è¡¨ã€‚Objectå€¼ è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„é€‰é¡¹ï¼Œæ¯”å¦‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨â€˜@/util/helpâ€™æ¥ä»£æ›¿â€™./src/util/helpâ€™ï¼Œçœçš„æ¯æ¬¡åœ¨ä¸åŒå±‚çº§æ–‡ä»¶importæ¨¡å—æ—¶,éƒ½çº ç»“äºæ˜¯â€™./â€˜è¿˜æ˜¯â€™../â€˜ã€‚è¯¥é€‰é¡¹å‘Šè¯‰ç¼–è¯‘å™¨é‡åˆ°åŒ¹é…çš„å€¼æ—¶ï¼Œå»æ˜ å°„çš„è·¯å¾„ä¸‹åŠ è½½æ¨¡å—ã€‚ 12345678910111213141516&#123; &quot;baseUrl&quot;: &quot;.&quot;, // æ³¨æ„ï¼šbaseUrlä¸å¯å°‘ &quot;paths&quot;: &#123; // æ˜ å°„åˆ—è¡¨ &quot;@/*&quot;: [ &quot;src/*&quot; ], &quot;moduleA&quot;: [ &quot;src/libs/moduleA&quot; ] &#125;&#125;// in ts codeimport Setting from &#x27;@/components/Setting.vue&#x27; // æ¨¡å—å®é™…ä½ç½®: src/components/Setting.vueimport TestModule from &#x27;moduleA/index.js&#x27; // æ¨¡å—å®é™…ä½ç½®: src/libs/moduleA/index.js 9. strictNullChecksæ˜¯å¦å¯ç”¨ä¸¥æ ¼çš„ nullæ£€æŸ¥æ¨¡å¼ã€‚booleanå€¼ï¼Œé»˜è®¤å€¼ï¼šfalse æœªå¤„ç†çš„nullå’Œundefinedç»å¸¸ä¼šå¯¼è‡´BUGçš„äº§ç”Ÿï¼Œæ‰€ä»¥TypeScriptåŒ…å«äº†strictNullChecksé€‰é¡¹æ¥å¸®åŠ©æˆ‘ä»¬å‡å°‘å¯¹è¿™ç§æƒ…å†µçš„æ‹…å¿§ã€‚å½“å¯ç”¨äº†strictNullChecksï¼Œnullå’Œundefinedè·å¾—äº†å®ƒä»¬è‡ªå·±å„è‡ªçš„ç±»å‹nullå’Œundefinedã€‚å¼€å¯è¯¥æ¨¡å¼æœ‰åŠ©äºå‘ç°å¹¶å¤„ç†å¯èƒ½ä¸ºundefinedçš„èµ‹å€¼ã€‚å¦‚æœæ˜¯æ­£å¼é¡¹ç›®ï¼Œç¬”è€…å»ºè®®å¼€å¯è¯¥é€‰é¡¹ï¼›å¦‚æœåªæ˜¯ç»ƒæ‰‹TypeScirptï¼Œå¯ä»¥å…³é—­è¯¥é€‰é¡¹ï¼Œä¸ç„¶æ‰€æœ‰å¯èƒ½ä¸ºnull/undefinedçš„èµ‹å€¼ï¼Œéƒ½éœ€è¦å†™è”åˆç±»å‹ã€‚ 123456789// æœªå¼€å¯strictNullChecksï¼Œnumberç±»å‹åŒ…å«äº†nullå’Œundefinedç±»å‹let foo: number = 123;foo = null; // Okayfoo = undefined; // Okay// å¼€å¯strictNullCheckslet foo: string[] | undefined = arr.find(key =&gt; key === &#x27;test&#x27;)// foo.push(&#x27;1&#x27;) // error - &#x27;foo&#x27; is possibly &#x27;undefined&#x27;foo &amp;&amp; foo.push(&#x27;1&#x27;) // okay æ³¨æ„ï¼šå¯ç”¨ â€“strictç›¸å½“äºå¯ç”¨ â€“noImplicitAny, â€“noImplicitThis, â€“alwaysStrict, â€“strictNullChecks, â€“strictFunctionTypeså’Œâ€“strictPropertyInitialization 10. noUnusedLocalsæœ‰æœªä½¿ç”¨çš„å˜é‡æ—¶ï¼Œæ˜¯å¦æŠ›å‡ºé”™è¯¯ã€‚booleanå€¼ï¼Œé»˜è®¤å€¼ï¼š false é¡¾åæ€ä¹‰ï¼Œå½“å‘ç°å˜é‡å®šä¹‰ä½†æ²¡æœ‰ä½¿ç”¨æ—¶ï¼Œç¼–è¯‘ä¸æŠ¥é”™ã€‚eslintçš„ruleä¸­ä¹Ÿæœ‰è¯¥æ¡ï¼Œå»ºè®®æ­£å¼é¡¹ç›®å°†è¯¥é€‰é¡¹å¼€å¯ï¼Œè®¾ç½®ä¸ºtrueï¼Œä½¿å¾—ä»£ç å¹²å‡€æ•´æ´ã€‚ 11. noUnusedParametersæœ‰æœªä½¿ç”¨çš„å‚æ•°æ—¶ï¼Œæ˜¯å¦æŠ›å‡ºé”™è¯¯ã€‚booleanå€¼ï¼Œé»˜è®¤å€¼ï¼š false å»ºè®®æ­£å¼é¡¹ç›®å¼€å¯è¯¥é€‰é¡¹ï¼Œè®¾ç½®ä¸ºtrueï¼Œç†ç”±åŒä¸Šã€‚ 12. allowJsæ˜¯å¦å…è®¸ç¼–è¯‘javascriptæ–‡ä»¶ã€‚booleanå€¼ï¼Œé»˜è®¤å€¼ï¼šfalse å¦‚æœè®¾ç½®ä¸ºtrueï¼Œjsåç¼€çš„æ–‡ä»¶ä¹Ÿä¼šè¢«typescriptè¿›è¡Œç¼–è¯‘ã€‚ 13. typeRootså’Œtypesé»˜è®¤æ‰€æœ‰å¯è§çš„â€@typesâ€åŒ…ä¼šåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­è¢«åŒ…å«è¿›æ¥ã€‚å¦‚æœæŒ‡å®šäº†typeRootsï¼Œåªæœ‰typeRootsä¸‹é¢çš„åŒ…æ‰ä¼šè¢«åŒ…å«è¿›æ¥ã€‚å¦‚æœæŒ‡å®šäº†typesï¼Œåªæœ‰è¢«åˆ—å‡ºæ¥çš„npmåŒ…æ‰ä¼šè¢«åŒ…å«è¿›æ¥ã€‚è¯¦ç»†å†…å®¹å¯çœ‹æ­¤å¤„(opens new window) å¯ä»¥æŒ‡å®šâ€typesâ€: []æ¥ç¦ç”¨è‡ªåŠ¨å¼•å…¥@typesåŒ… 14. filesã€includeå’Œexcludeç¼–è¯‘æ–‡ä»¶åŒ…å«å“ªäº›æ–‡ä»¶ä»¥åŠæ’é™¤å“ªäº›æ–‡ä»¶ã€‚ æœªè®¾ç½®includeæ—¶ï¼Œç¼–è¯‘å™¨é»˜è®¤åŒ…å«å½“å‰ç›®å½•å’Œå­ç›®å½•ä¸‹æ‰€æœ‰çš„TypeScriptæ–‡ä»¶ï¼ˆ.ts, .d.ts å’Œ .tsxï¼‰ã€‚å¦‚æœallowJsè¢«è®¾ç½®æˆtrueï¼ŒJSæ–‡ä»¶ï¼ˆ.jså’Œ.jsxï¼‰ä¹Ÿè¢«åŒ…å«è¿›æ¥ã€‚excludeæ’é™¤é‚£äº›ä¸éœ€è¦ç¼–è¯‘çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚ 12345678910&#123; &quot;compilerOptions&quot;: &#123;&#125;, &quot;include&quot;: [ &quot;src/**/*&quot; ], &quot;exclude&quot;: [ &quot;node_modules&quot;, &quot;**/*.spec.ts&quot; ]&#125; é…ç½®é¡¹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970&#123; &quot;compilerOptions&quot;: &#123; /* åŸºæœ¬é€‰é¡¹ */ &quot;target&quot;: &quot;es5&quot;, // æŒ‡å®š ECMAScript ç›®æ ‡ç‰ˆæœ¬: &#x27;ES3&#x27; (default), &#x27;ES5&#x27;, &#x27;ES2015&#x27;, &#x27;ES2016&#x27;, &#x27;ES2017&#x27;, or &#x27;ESNEXT&#x27;ï¼ˆ&quot;ESNext&quot;è¡¨ç¤ºæœ€æ–°çš„ESè¯­æ³•ï¼ŒåŒ…æ‹¬è¿˜å¤„åœ¨stage Xé˜¶æ®µï¼‰ &quot;module&quot;: &quot;commonjs&quot;, // æŒ‡å®šä½¿ç”¨æ¨¡å—: &#x27;commonjs&#x27;, &#x27;amd&#x27;, &#x27;system&#x27;, &#x27;umd&#x27; or &#x27;es2015&#x27; &quot;lib&quot;: [], // æŒ‡å®šè¦åŒ…å«åœ¨ç¼–è¯‘ä¸­çš„åº“æ–‡ä»¶ &quot;allowJs&quot;: true, // å…è®¸ç¼–è¯‘ javascript æ–‡ä»¶ &quot;checkJs&quot;: true, // æŠ¥å‘Š javascript æ–‡ä»¶ä¸­çš„é”™è¯¯ &quot;jsx&quot;: &quot;preserve&quot;, // æŒ‡å®š jsx ä»£ç çš„ç”Ÿæˆ: &#x27;preserve&#x27;, &#x27;react-native&#x27;, or &#x27;react&#x27; &quot;declaration&quot;: true, // ç”Ÿæˆç›¸åº”çš„ &#x27;.d.ts&#x27; æ–‡ä»¶ &quot;sourceMap&quot;: true, // ç”Ÿæˆç›¸åº”çš„ &#x27;.map&#x27; æ–‡ä»¶ &quot;outFile&quot;: &quot;./&quot;, // å°†è¾“å‡ºæ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶ &quot;outDir&quot;: &quot;./&quot;, // æŒ‡å®šè¾“å‡ºç›®å½• &quot;rootDir&quot;: &quot;./&quot;, // ç”¨æ¥æ§åˆ¶è¾“å‡ºç›®å½•ç»“æ„ --outDir. &quot;removeComments&quot;: true, // åˆ é™¤ç¼–è¯‘åçš„æ‰€æœ‰çš„æ³¨é‡Š &quot;noEmit&quot;: true, // ä¸ç”Ÿæˆè¾“å‡ºæ–‡ä»¶ &quot;importHelpers&quot;: true, // ä» tslib å¯¼å…¥è¾…åŠ©å·¥å…·å‡½æ•° &quot;isolatedModules&quot;: true, // å°†æ¯ä¸ªæ–‡ä»¶åšä¸ºå•ç‹¬çš„æ¨¡å— ï¼ˆä¸ &#x27;ts.transpileModule&#x27; ç±»ä¼¼ï¼‰. /* ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥é€‰é¡¹ */ &quot;strict&quot;: true, // å¯ç”¨æ‰€æœ‰ä¸¥æ ¼ç±»å‹æ£€æŸ¥é€‰é¡¹ &quot;noImplicitAny&quot;: true, // åœ¨è¡¨è¾¾å¼å’Œå£°æ˜ä¸Šæœ‰éšå«çš„ anyç±»å‹æ—¶æŠ¥é”™ &quot;strictNullChecks&quot;: true, // å¯ç”¨ä¸¥æ ¼çš„ null æ£€æŸ¥ &quot;noImplicitThis&quot;: true, // å½“ this è¡¨è¾¾å¼å€¼ä¸º any ç±»å‹çš„æ—¶å€™ï¼Œç”Ÿæˆä¸€ä¸ªé”™è¯¯ &quot;alwaysStrict&quot;: true, // ä»¥ä¸¥æ ¼æ¨¡å¼æ£€æŸ¥æ¯ä¸ªæ¨¡å—ï¼Œå¹¶åœ¨æ¯ä¸ªæ–‡ä»¶é‡ŒåŠ å…¥ &#x27;use strict&#x27; /* é¢å¤–çš„æ£€æŸ¥ */ &quot;noUnusedLocals&quot;: true, // æœ‰æœªä½¿ç”¨çš„å˜é‡æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯ &quot;noUnusedParameters&quot;: true, // æœ‰æœªä½¿ç”¨çš„å‚æ•°æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯ &quot;noImplicitReturns&quot;: true, // å¹¶ä¸æ˜¯æ‰€æœ‰å‡½æ•°é‡Œçš„ä»£ç éƒ½æœ‰è¿”å›å€¼æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯ &quot;noFallthroughCasesInSwitch&quot;: true, // æŠ¥å‘Š switch è¯­å¥çš„ fallthrough é”™è¯¯ã€‚ï¼ˆå³ï¼Œä¸å…è®¸ switch çš„ case è¯­å¥è´¯ç©¿ï¼‰ /* æ¨¡å—è§£æé€‰é¡¹ */ &quot;moduleResolution&quot;: &quot;node&quot;, // é€‰æ‹©æ¨¡å—è§£æç­–ç•¥ï¼š &#x27;node&#x27; (Node.js) or &#x27;classic&#x27; (TypeScript pre-1.6)ã€‚é»˜è®¤æ˜¯classic &quot;baseUrl&quot;: &quot;./&quot;, // ç”¨äºè§£æéç›¸å¯¹æ¨¡å—åç§°çš„åŸºç›®å½• &quot;paths&quot;: &#123;&#125;, // æ¨¡å—ååˆ°åŸºäº baseUrl çš„è·¯å¾„æ˜ å°„çš„åˆ—è¡¨ ä¾‹å¦‚ï¼š&quot;@/*&quot;: [&quot;src/*&quot;] &quot;rootDirs&quot;: [], // æ ¹æ–‡ä»¶å¤¹åˆ—è¡¨ï¼Œå…¶ç»„åˆå†…å®¹è¡¨ç¤ºé¡¹ç›®è¿è¡Œæ—¶çš„ç»“æ„å†…å®¹ &quot;typeRoots&quot;: [], // åŒ…å«ç±»å‹å£°æ˜çš„æ–‡ä»¶åˆ—è¡¨ &quot;types&quot;: [], // éœ€è¦åŒ…å«çš„ç±»å‹å£°æ˜æ–‡ä»¶ååˆ—è¡¨ &quot;allowSyntheticDefaultImports&quot;: true, // å…è®¸ä»æ²¡æœ‰è®¾ç½®é»˜è®¤å¯¼å‡ºçš„æ¨¡å—ä¸­é»˜è®¤å¯¼å…¥ã€‚ /* Source Map Options */ &quot;sourceRoot&quot;: &quot;./&quot;, // æŒ‡å®šè°ƒè¯•å™¨åº”è¯¥æ‰¾åˆ° TypeScript æ–‡ä»¶è€Œä¸æ˜¯æºæ–‡ä»¶çš„ä½ç½® &quot;mapRoot&quot;: &quot;./&quot;, // æŒ‡å®šè°ƒè¯•å™¨åº”è¯¥æ‰¾åˆ°æ˜ å°„æ–‡ä»¶è€Œä¸æ˜¯ç”Ÿæˆæ–‡ä»¶çš„ä½ç½® &quot;inlineSourceMap&quot;: true, // ç”Ÿæˆå•ä¸ª soucemaps æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å°† sourcemaps ç”Ÿæˆä¸åŒçš„æ–‡ä»¶ &quot;inlineSources&quot;: true, // å°†ä»£ç ä¸ sourcemaps ç”Ÿæˆåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¦æ±‚åŒæ—¶è®¾ç½®äº† --inlineSourceMap æˆ– --sourceMap å±æ€§ /* å…¶ä»–é€‰é¡¹ */ &quot;experimentalDecorators&quot;: true, // å¯ç”¨è£…é¥°å™¨ &quot;emitDecoratorMetadata&quot;: true, // ä¸ºè£…é¥°å™¨æä¾›å…ƒæ•°æ®çš„æ”¯æŒ &quot;strictFunctionTypes&quot;: false // ç¦ç”¨å‡½æ•°å‚æ•°åŒå‘åå˜æ£€æŸ¥ã€‚ &#125;, /* æŒ‡å®šç¼–è¯‘æ–‡ä»¶æˆ–æ’é™¤æŒ‡å®šç¼–è¯‘æ–‡ä»¶ */ &quot;include&quot;: [ &quot;src/**/*&quot; ], &quot;exclude&quot;: [ &quot;node_modules&quot;, &quot;**/*.spec.ts&quot; ], &quot;files&quot;: [ &quot;core.ts&quot;, &quot;sys.ts&quot; ], // ä»å¦ä¸€ä¸ªé…ç½®æ–‡ä»¶é‡Œç»§æ‰¿é…ç½® &quot;extends&quot;: &quot;./config/base&quot;, // è®©IDEåœ¨ä¿å­˜æ–‡ä»¶çš„æ—¶å€™æ ¹æ®tsconfig.jsoné‡æ–°ç”Ÿæˆæ–‡ä»¶ &quot;compileOnSave&quot;: true // æ”¯æŒè¿™ä¸ªç‰¹æ€§éœ€è¦Visual Studio 2015ï¼Œ TypeScript1.8.4ä»¥ä¸Šå¹¶ä¸”å®‰è£…atom-typescriptæ’ä»¶&#125;","tags":["Typescript"]},{"title":"vue2~vue3è¿ç§»è®°å½•","path":"/2022/04/16/vue2-vue3è¿ç§»è®°å½•/","content":"è®°å½•vue2åˆ°vue3ç‰ˆæœ¬è¿ç§»äº‹é¡¹ å®˜æ–¹è¿ç§»æ–‡æ¡£ apiå˜åŒ–å…¨å±€apiå˜åŒ–new Vue â€”&gt; createApp ğŸš© â• vue2ä¸­æ²¡æœ‰app çš„æ¦‚å¿µï¼Œé€šè¿‡Vueçš„ç»Ÿä¸€æ„é€ å‡½æ•°è¿›è¡Œå…¨å±€çš„é…ç½®ï¼Œå•é¡µåº”ç”¨ä¸­æ— æ³•åˆ›å»ºå¤šä¸ªä¸åŒå…¨å±€é…ç½®çš„æ ¹åº”ç”¨ï¼ˆä¼šé€ æˆå…¨å±€é…ç½®æ±¡æŸ“ï¼‰ vue3ä¸­æœ‰äº†appæ¦‚å¿µï¼Œé€šè¿‡createAppåˆ›å»ºè¿”å›çš„å®ä¾‹æš´éœ²å…¨å±€apiï¼Œè§£å†³äº†vue2ä¸­çš„é—®é¢˜ Vue2 123456import Vue from &quot;vue&quot;;import App from &#x27;./App.vue&#x27;new Vue(&#123; render: (h) =&gt; h(App)&#125;).$mount(&quot;#app&quot;); Vue3 createApp ç”Ÿæˆä¸€ä¸ªappå®ä¾‹ï¼Œè¯¥å®ä¾‹æ‹¥æœ‰å…¨å±€çš„å¯é…ç½®ä¸Šä¸‹æ–‡ 1234import &#123; createApp &#125; from &#x27;vue&#x27;import App from &#x27;./App.vue&#x27;const app = createApp(App).mount(&#x27;#app&#x27;); æ‰€ä»¥ç°åœ¨æ‰€æœ‰å…¨å±€ä¼šæ”¹å˜Vueè¡Œä¸ºçš„apiéƒ½æ”¹åˆ°äº†appåº”ç”¨å®ä¾‹ä¸Šäº† internal Apis ğŸš©æ–‡æ¡£ vue2ä¸­ä¸å°‘global-apiæ˜¯ä½œä¸ºé™æ€å‡½æ•°ç›´æ¥æŒ‚åœ¨æ„é€ å‡½æ•°ä¸Šçš„ï¼Œä¾‹å¦‚Vue.nextTick()ï¼Œå¦‚æœæˆ‘ä»¬ä»æœªåœ¨ä»£ç ä¸­ç”¨è¿‡å®ƒä»¬ï¼Œå°±ä¼šå½¢æˆæ‰€è°“çš„dead codeï¼Œè¿™ç±»global-apié€ æˆçš„dead codeæ— æ³•ä½¿ç”¨webpackçš„tree-shakingæ’é™¤æ‰ã€‚ vue3ä¸­åšäº†ç›¸åº”çš„å˜åŒ–ï¼Œå°†å®ƒä»¬æŠ½å–æˆä¸ºç‹¬ç«‹å‡½æ•°ï¼Œè¿™æ ·æ‰“åŒ…å·¥å…·çš„æ‘‡æ ‘ä¼˜åŒ–å¯ä»¥å°†è¿™äº›dead codeæ’é™¤æ‰ã€‚ Vue2 12import Vue from &#x27;vue&#x27;;Vue.nextTick(()=&gt;&#123;&#125;) Vue3 12import &#123; nextTick &#125; from &#x27;vue&#x27;nextTick(() =&gt; &#123;&#125;) å®˜æ–¹æ–‡æ¡£åˆ—å‡ºå—å½±å“çš„api ![image-20220416125617961](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/vue2-vue3è¿ç§»è®°å½•/image-20220416125617961.png) app.configglobalProperties ğŸš©â• æ·»åŠ å¯åœ¨ç¨‹åºå†…çš„ä»»ä½•ç»„ä»¶å®ä¾‹ä¸­è®¿é—®çš„å…¨å±€å±æ€§ã€‚ Vue2 12import Vue from &#x27;vue&#x27;Vue.prototype.$http = axios vue3 123// Vue3const app = Vue.createApp(&#123;&#125;)app.config.globalProperties.$http = axios devtools é…ç½®æ˜¯å¦å…è®¸ vue-devtools æ£€æŸ¥ä»£ç ã€‚å¼€å‘ç‰ˆæœ¬é»˜è®¤ä¸º trueï¼Œç”Ÿäº§ç‰ˆæœ¬é»˜è®¤ä¸º falseã€‚ç”Ÿäº§ç‰ˆæœ¬è®¾ä¸º true å¯ä»¥å¯ç”¨æ£€æŸ¥ã€‚ 123- Vue.config.devtools = true+ app.config.devtools = true errorHandler1234567891011- Vue.config.errorHandler = function (err, vm, info) &#123; // handle error // `info` æ˜¯ Vue ç‰¹å®šçš„é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚é”™è¯¯æ‰€åœ¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­ // åªåœ¨ 2.2.0+ å¯ç”¨&#125;+ app.config.errorHandler = (err, vm, info) =&gt; &#123; // handle error // `info` æ˜¯ Vue ç‰¹å®šçš„é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚é”™è¯¯æ‰€åœ¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­ // è¿™é‡Œèƒ½å‘ç°é”™è¯¯&#125; æŒ‡å®šç»„ä»¶çš„æ¸²æŸ“å’Œè§‚å¯ŸæœŸé—´æœªæ•è·é”™è¯¯çš„å¤„ç†å‡½æ•°ã€‚è¿™ä¸ªå¤„ç†å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå¯è·å–é”™è¯¯ä¿¡æ¯å’Œ Vue å®ä¾‹ã€‚ é”™è¯¯è¿½è¸ªæœåŠ¡ Sentry å’Œ Bugsnag éƒ½é€šè¿‡æ­¤é€‰é¡¹æä¾›äº†å®˜æ–¹æ”¯æŒã€‚ warnHandler1234567- Vue.config.warnHandler = function (msg, vm, trace) &#123; // `trace` æ˜¯ç»„ä»¶çš„ç»§æ‰¿å…³ç³»è¿½è¸ª&#125;+ app.config.warnHandler = function(msg, vm, trace) &#123; // `trace` æ˜¯ç»„ä»¶çš„ç»§æ‰¿å…³ç³»è¿½è¸ª&#125; ä¸º Vue çš„è¿è¡Œæ—¶è­¦å‘Šèµ‹äºˆä¸€ä¸ªè‡ªå®šä¹‰å¤„ç†å‡½æ•°ã€‚æ³¨æ„è¿™åªä¼šåœ¨å¼€å‘è€…ç¯å¢ƒä¸‹ç”Ÿæ•ˆï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹å®ƒä¼šè¢«å¿½ç•¥ã€‚ isCustomElement â• æ›¿ä»£æ‰Vue2.xçš„ignoredElements 123456789- Vue.config.ignoredElements = [ // ç”¨ä¸€ä¸ª `RegExp` å¿½ç•¥æ‰€æœ‰â€œion-â€å¼€å¤´çš„å…ƒç´  // ä»…åœ¨ 2.5+ æ”¯æŒ /^ion-/]// ä¸€äº›ç»„ä»¶ä»¥&#x27;ion-&#x27;å¼€å¤´å°†ä¼šè¢«è§£æä¸ºè‡ªå®šä¹‰ç»„ä»¶+ app.config.isCustomElement = tag =&gt; tag.startsWith(&#x27;ion-&#x27;) æŒ‡å®šä¸€ä¸ªæ–¹æ³•æ¥è¯†åˆ«åœ¨Vueä¹‹å¤–å®šä¹‰çš„è‡ªå®šä¹‰ç»„ä»¶(ä¾‹å¦‚ï¼Œä½¿ç”¨Web Component API)ã€‚å¦‚æœç»„ä»¶ç¬¦åˆè¿™ä¸ªæ¡ä»¶ï¼Œå®ƒå°±ä¸éœ€è¦æœ¬åœ°æˆ–å…¨å±€æ³¨å†Œï¼ŒVueä¹Ÿä¸ä¼šæŠ›å‡ºå…³äºUnknown custom elementçš„è­¦å‘Š æ³¨æ„ï¼Œè¿™ä¸ªå‡½æ•°ä¸­ä¸éœ€è¦åŒ¹é…æ‰€æœ‰åŸç”ŸHTMLå’ŒSVGæ ‡è®°â€”Vueè§£æå™¨ä¼šè‡ªåŠ¨æ‰§è¡Œæ­¤æ£€æŸ¥ optionMergeStrategies12345678910111213141516const app = Vue.createApp(&#123; mounted() &#123; console.log(this.$options.hello) &#125;&#125;)app.config.optionMergeStrategies.hello = (parent, child, vm) =&gt; &#123; return `Hello, $&#123;child&#125;`&#125;app.mixin(&#123; hello: &#x27;Vue&#x27;&#125;)// &#x27;Hello, Vue å®šä¹‰è‡ªå®šä¹‰é€‰é¡¹çš„åˆå¹¶ç­–ç•¥ã€‚ åˆå¹¶ç­–ç•¥æ¥æ”¶åœ¨çˆ¶å®ä¾‹optionså’Œâˆ—âˆ—å­å®ä¾‹âˆ—âˆ—optionså’Œå­å®ä¾‹optionså’Œâˆ—âˆ—å­å®ä¾‹âˆ—âˆ—optionsï¼Œåˆ†åˆ«ä½œä¸ºç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå‚æ•°ã€‚ä¸Šä¸‹æ–‡Vueå®ä¾‹ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’ ã€è‡ªå®šä¹‰é€‰é¡¹åˆå¹¶ç­–ç•¥ã€‘mixin123456789101112131415161718const app = Vue.createApp(&#123; custom: &#x27;hello!&#x27;&#125;)app.config.optionMergeStrategies.custom = (toVal, fromVal) =&gt; &#123; console.log(fromVal, toVal) // =&gt; &quot;goodbye!&quot;, undefined // =&gt; &quot;hello!&quot;, &quot;goodbye!&quot; return fromVal || toVal&#125;app.mixin(&#123; custom: &#x27;goodbye!&#x27;, created() &#123; console.log(this.$options.custom) // =&gt; &quot;hello!&quot; &#125;&#125;) optionMergeStrategieså…ˆè·å–åˆ°å­å®ä¾‹çš„$optionsçš„mixinè€Œæ²¡æœ‰çˆ¶å®ä¾‹ã€customç¬¬ä¸€æ¬¡æ”¹å˜ä»undefinedåˆ°goodbyeâ€”&gt;æ‰“å°â€goodbye!â€, undefinedã€‘ çˆ¶å®ä¾‹çš„optionsæ›¿æ¢æ‰å­å®ä¾‹çš„optionsæ›¿æ¢æ‰å­å®ä¾‹çš„optionsæ›¿æ¢æ‰å­å®ä¾‹çš„optionsã€customç¬¬äºŒæ¬¡ä»goodbyeåˆ°hello!â€”&gt;æ‰“å°äº†â€helloâ€, â€œgoodbye!â€ã€‘ æœ€ååœ¨æ‰“å°app.config.optionMergeStrategies.customè¿”å›çš„çˆ¶å®ä¾‹çš„$options æ— è®ºå¦‚ä½•this.options.customæœ€åä¼šè¿”å›åˆå¹¶ç­–ç•¥çš„returnçš„å€¼ã€ä½¿ç”¨åœºæ™¯åˆ©ç”¨çˆ¶å­ç»„ä»¶çš„options.customæœ€åä¼šè¿”å›åˆå¹¶ç­–ç•¥çš„returnçš„å€¼ã€ä½¿ç”¨åœºæ™¯åˆ©ç”¨çˆ¶å­ç»„ä»¶çš„options.customæœ€åä¼šè¿”å›åˆå¹¶ç­–ç•¥çš„returnçš„å€¼ã€ä½¿ç”¨åœºæ™¯åˆ©ç”¨çˆ¶å­ç»„ä»¶çš„options,ç„¶åè¿”å›è®¡ç®—ç­‰æ“ä½œå¾—åˆ°æ‰€éœ€è¦çš„å€¼ã€‘optionMergeStrategiesåˆå¹¶$optionså˜åŒ– performance123- Vue.config.performance=true;+ app.config.performance=true; è®¾ç½®ä¸º true ä»¥åœ¨æµè§ˆå™¨å¼€å‘å·¥å…·çš„æ€§èƒ½/æ—¶é—´çº¿é¢æ¿ä¸­å¯ç”¨å¯¹ç»„ä»¶åˆå§‹åŒ–ã€ç¼–è¯‘ã€æ¸²æŸ“å’Œæ‰“è¡¥ä¸çš„æ€§èƒ½è¿½è¸ªã€‚åªé€‚ç”¨äºå¼€å‘æ¨¡å¼å’Œæ”¯æŒ performance.mark API çš„æµè§ˆå™¨ä¸Šã€‚ app.directive æ•™ç¨‹æ–‡æ¡£ æ³¨å†Œæˆ–è·å–å…¨å±€æŒ‡ä»¤ã€‚ 12345678910111213141516171819202122232425262728import &#123; createApp &#125; from &#x27;vue&#x27;const app = createApp(&#123;&#125;)// æ³¨å†Œapp.directive(&#x27;my-directive&#x27;, &#123; // æŒ‡ä»¤çš„ç”Ÿå‘½å‘¨æœŸ // åœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶è¢«æŒ‚è½½ä¹‹å‰è°ƒç”¨ beforeMount(el, binding, vnode) &#123;&#125;, // åœ¨æŒ‚è½½ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶æ—¶è°ƒç”¨ mounted(el, binding, vnode) &#123;&#125;, // åœ¨æ›´æ–°åŒ…å«ç»„ä»¶çš„VNodeä¹‹å‰è°ƒç”¨ beforeUpdate(el, binding, vnode, prevNode) &#123;&#125;, // ç»„ä»¶çš„VNodeåŠå…¶å­ç»„ä»¶çš„VNodeæ›´æ–°ä¹‹åè°ƒç”¨ updated(el, binding, vnode, prevNode) &#123;&#125;, // åœ¨å¸è½½ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶ä¹‹å‰è°ƒç”¨ beforeUnmount(el, binding, vnode) &#123;&#125;, // åœ¨å¸è½½ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶æ—¶è°ƒç”¨ unmounted(el, binding, vnode) &#123;&#125;&#125;)// æ³¨å†Œ (æŒ‡ä»¤å‡½æ•°)app.directive(&#x27;my-directive&#x27;, (el, binding, vnode, prevNode) =&gt; &#123; // è¿™é‡Œå°†ä¼šè¢« `mounted` å’Œ `updated` è°ƒç”¨&#125;)// getterï¼Œè¿”å›å·²æ³¨å†Œçš„æŒ‡ä»¤const myDirective = app.directive(&#x27;my-directive&#x27;) el: æŒ‡ä»¤ç»‘å®šåˆ°çš„å…ƒç´ ã€‚è¿™å¯ä»¥ç”¨æ¥ç›´æ¥æ“ä½œDOMã€‚ bindingã€åŒ…å«ä¸‹åˆ—å±æ€§çš„å¯¹è±¡ã€‘ instanceï¼šä½¿ç”¨æŒ‡ä»¤çš„ç»„ä»¶çš„å®ä¾‹ valueï¼šæŒ‡ä»¤çš„ç»‘å®šå€¼ï¼Œä¾‹å¦‚ï¼šv-my-directive=&quot;1 + 1&quot;ä¸­ï¼Œç»‘å®šå€¼ä¸º 2 oldValueï¼šæŒ‡ä»¤ç»‘å®šçš„å‰ä¸€ä¸ªå€¼ï¼Œä»…åœ¨ beforeUpdate å’Œ updated é’©å­ä¸­å¯ç”¨ã€‚æ— è®ºå€¼æ˜¯å¦æ”¹å˜éƒ½å¯ç”¨ argï¼šä¼ ç»™æŒ‡ä»¤çš„å‚æ•°ï¼Œå¯é€‰ã€‚ä¾‹å¦‚ v-my-directive:foo ä¸­ï¼Œå‚æ•°ä¸º &quot;foo&quot; modifiersï¼šä¸€ä¸ªåŒ…å«ä¿®é¥°ç¬¦çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼šv-my-directive.foo.bar ä¸­ï¼Œä¿®é¥°ç¬¦å¯¹è±¡ä¸º &#123; foo: true, bar: true &#125; dirï¼šä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨æ³¨å†ŒæŒ‡ä»¤æ—¶ä½œä¸ºå‚æ•°ä¼ é€’; ä¸¾ä¸ªä¾‹å­ï¼Œçœ‹ä¸‹é¢æŒ‡ä»¤ 123456app.directive(&#x27;focus&#x27;, &#123; mounted(el) &#123; el.focus() &#125;&#125;) dirå°±æ˜¯ä¸‹é¢çš„å¯¹è±¡ 123456&#123; mounted(el) &#123; el.focus() &#125;&#125; vnode ç¼–è¯‘ç”Ÿæˆçš„è™šæ‹ŸèŠ‚ç‚¹ prevNode å‰ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œä»…åœ¨beforeUpdateå’Œupdatedé’©å­ä¸­å¯ç”¨ tips:é™¤äº† el ä¹‹å¤–ï¼Œå…¶å®ƒå‚æ•°éƒ½åº”è¯¥æ˜¯åªè¯»çš„ï¼Œåˆ‡å‹¿è¿›è¡Œä¿®æ”¹ã€‚å¦‚æœéœ€è¦åœ¨é’©å­ä¹‹é—´å…±äº«æ•°æ®ï¼Œå»ºè®®é€šè¿‡å…ƒç´ çš„ dataset æ¥è¿›è¡Œ app.unmount ğŸš©â• åœ¨æ‰€æä¾›çš„DOMå…ƒç´ ä¸Šå¸è½½åº”ç”¨ç¨‹åºå®ä¾‹çš„æ ¹ç»„ä»¶ 12345678import &#123; createApp &#125; from &#x27;vue&#x27;const app = createApp(&#123;&#125;)// åšä¸€äº›å¿…è¦çš„å‡†å¤‡app.mount(&#x27;#my-app&#x27;)// åº”ç”¨ç¨‹åºå°†åœ¨æŒ‚è½½å5ç§’è¢«å¸è½½setTimeout(() =&gt; app.unmount(&#x27;#my-app&#x27;), 5000) app.component Vue2.xã€æ³¨å†Œæˆ–è·å–å…¨å±€ç»„ä»¶ã€‚æ³¨å†Œè¿˜ä¼šè‡ªåŠ¨ä½¿ç”¨ç»™å®šçš„ id è®¾ç½®ç»„ä»¶çš„åç§°ã€‘ 1234567// æ³¨å†Œç»„ä»¶ï¼Œä¼ å…¥ä¸€ä¸ªé€‰é¡¹å¯¹è±¡ (è‡ªåŠ¨è°ƒç”¨ Vue.extend) Vue.component(&#x27;my-component&#x27;, &#123; /* ... */ &#125;) // è·å–æ³¨å†Œçš„ç»„ä»¶ (å§‹ç»ˆè¿”å›æ„é€ å™¨) var MyComponent = Vue.component(&#x27;my-component&#x27;) Vue3ã€æ³¨å†Œæˆ–è·å–å…¨å±€ç»„ä»¶. æ³¨å†Œè¿˜ä¼šè‡ªåŠ¨ä½¿ç”¨ç»™å®šçš„ nameç»„ä»¶ è®¾ç½®ç»„ä»¶çš„åç§°ã€‘å…¨å±€ç»„ä»¶ åŸºæœ¬vue2å†™æ³•ä¸€è‡´ 1234567891011import &#123; createApp &#125; from &#x27;vue&#x27;const app = createApp(&#123;&#125;)// æ³¨å†Œç»„ä»¶ï¼Œä¼ å…¥ä¸€ä¸ªé€‰é¡¹å¯¹è±¡app.component(&#x27;my-component&#x27;, &#123; /* ... */&#125;)// è·å–æ³¨å†Œçš„ç»„ä»¶ (å§‹ç»ˆè¿”å›æ„é€ å™¨) const MyComponent = app.component(&#x27;my-component&#x27;, &#123;&#125;) watch ä»¥.åˆ†å‰²çš„è¡¨è¾¾å¼ä¸å†è¢«watchæ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨è®¡ç®—å‡½æ•°ä½œä¸ºw*atc*hæ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨è®¡ç®—å‡½æ•°ä½œä¸ºwatchå‚æ•°å®ç°ã€‚ Vue2 1234watch: &#123; &quot;data.id&quot;(val) &#123; &#125;,&#125;, Vue3 1234const data = reactive(&#123; id:121&#125;);watch(data.id,()=&gt;&#123;&#125;) emits â• å®˜æ–¹æ–‡æ¡£ emits å¯ä»¥æ˜¯æ•°ç»„æˆ–å¯¹è±¡ è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ å¦‚æœemitsæ˜¯å¯¹è±¡ï¼Œåˆ™å…è®¸æˆ‘ä»¬é…ç½®å’Œäº‹ä»¶éªŒè¯ã€‚éªŒè¯å‡½æ•°åº”è¿”å›å¸ƒå°”å€¼ï¼Œä»¥è¡¨ç¤ºäº‹ä»¶å‚æ•°æ˜¯å¦æœ‰æ•ˆã€‚ ä¾èµ–æ³¨å…¥provide/inject ä¸vue2ä¸­ä½¿ç”¨æ–¹æ³•æ²¡æœ‰ä»€ä¹ˆå¾ˆå¤§çš„å·®å¼‚ï¼Œä½†æ˜¯äº®ç‚¹æ˜¯å¯ä»¥æä¾›ç›¸åº”å¼çš„æ•°æ® åŸºç¡€ä½¿ç”¨æ–¹æ³•çœ‹æ–‡æ¡£ å“åº”å¼æ–¹æ³• ğŸš©â•ä¾‹å¦‚ï¼š 123456789101112131415import &#123; ref, reactive &#125; from &#x27;vue&#x27;// æä¾›è€…setup() &#123; const book = reactive(&#123; title: &#x27;Vue 3 Guide&#x27;, author: &#x27;Vue Team&#x27; &#125;) const year = ref(&#x27;2020&#x27;) /*æä¾›reactiveå“åº”å¼*/ provide(&#x27;book&#x27;, book) /*æä¾›refå“åº”å¼*/ provide(&#x27;year&#x27;, year)&#125; å¼Šç«¯æä¾›ç›¸åº”å¼çš„æ–¹æ³•ä¹‹åï¼Œå­ç»„å»ºå°±å¯ä»¥å°è¯•å¯¹è¿™ä¸ªå¼•ç”¨å€¼è¿›è¡Œä¿®æ”¹ï¼Œä»è€Œå¯¼è‡´å•å‘æ•°æ®æµé€šçš„ç´Šä¹± ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼ŒåŸºäºprovideè¿›è¡Œå°è£… 12345678910111213141516171819202122232425262728/* * @Author: ç¿æºæ• * @Date: 2022-04-10 16:11:32 * @LastEditors: ç¿æºæ• * @LastEditTime: 2022-04-16 15:21:11 * @FilePath: /vue3-vite-test/src/hooks/useProvide.ts * @Description: provide ï¼ˆobserverable provideï¼‰ */import &#123; provide, readonly, reactive, ref, isReactive &#125; from &quot;vue&quot;;import forEach from &quot;lodash/forEach&quot;;const useProvide = (shouldReactive: Boolean = true) =&gt; &#123; const handleProvide = (providers: Record&lt;string, any&gt;): void =&gt; &#123; forEach(providers, (value, key) =&gt; &#123; let provideValue; const isFunction = typeof value === &quot;function&quot;; if (!isFunction) &#123; provideValue = shouldReactive &amp;&amp; !isReactive(value) ? ref(value) : value; &#125; provide(key, isFunction ? provideValue : readonly(provideValue)); &#125;); &#125;; return handleProvide;&#125;;export default useProvide; defineAsyncComponent(å¼‚æ­¥ç»„ä»¶)ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸ 2.x ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸç›¸å¯¹åº”çš„ç»„åˆå¼ API ğŸš©â• beforeCreate -&gt; ä½¿ç”¨ setup() created -&gt; ä½¿ç”¨ setup() beforeMount -&gt; onBeforeMount mounted -&gt; onMounted beforeUpdate -&gt; onBeforeUpdate updated -&gt; onUpdated beforeDestroy -&gt; onBeforeUnmount destroyed -&gt; onUnmounted errorCaptured -&gt; onErrorCaptured éç»„åˆå¼apiåªæ˜¯æ”¹äº†åå­— å†…ç½®æŒ‡ä»¤å˜åŒ–v-model ğŸš© å®˜æ–¹æ–‡æ¡£ ç»„ä»¶ä½¿ç”¨vue2 â€” v-model 1234&lt;ChildComponent v-model=&quot;pageTitle&quot; /&gt;&lt;!-- ç®€å†™: --&gt;&lt;ChildComponent :value=&quot;pageTitle&quot; @input=&quot;pageTitle = $event&quot; /&gt; å¦‚æœè¦å°†å±æ€§æˆ–äº‹ä»¶åç§°æ›´æ”¹ä¸ºå…¶ä»–åç§°ï¼Œåˆ™éœ€è¦åœ¨ ChildComponent ç»„ä»¶ä¸­æ·»åŠ  model é€‰é¡¹ï¼š 12&lt;!-- ParentComponent.vue --&gt;&lt;ChildComponent v-model=&quot;pageTitle&quot; /&gt; 12345678910111213141516// ChildComponent.vueexport default &#123; model: &#123; prop: &#x27;title&#x27;, event: &#x27;change&#x27; &#125;, props: &#123; // è¿™å°†å…è®¸ `value` å±æ€§ç”¨äºå…¶ä»–ç”¨é€” value: String, // ä½¿ç”¨ `title` ä»£æ›¿ `value` ä½œä¸º model çš„ prop title: &#123; type: String, default: &#x27;Default title&#x27; &#125; &#125;&#125; æ‰€ä»¥ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ v-model çš„ç®€å†™å¦‚ä¸‹ï¼š 1&lt;ChildComponent :title=&quot;pageTitle&quot; @change=&quot;pageTitle = $event&quot; /&gt; Vue2 â€” v-bind.sync åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¯¹æŸä¸€ä¸ª prop è¿›è¡Œâ€œåŒå‘ç»‘å®šâ€(é™¤äº†å‰é¢ç”¨ v-model ç»‘å®š prop çš„æƒ…å†µ)ã€‚å»ºè®®ä½¿ç”¨ update:myPropName æŠ›å‡ºäº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œå¯¹äºåœ¨ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­å¸¦æœ‰ title prop çš„ ChildComponentï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼å°†åˆ†é…æ–° value çš„æ„å›¾ä¼ è¾¾ç»™çˆ¶çº§ï¼š 1this.$emit(&#x27;update:title&#x27;, newValue) å¦‚æœéœ€è¦çš„è¯ï¼Œçˆ¶çº§å¯ä»¥ç›‘å¬è¯¥äº‹ä»¶å¹¶æ›´æ–°æœ¬åœ° data propertyã€‚ä¾‹å¦‚ï¼š 1&lt;ChildComponent :title=&quot;pageTitle&quot; @update:title=&quot;pageTitle = $event&quot; /&gt; ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ .sync ä¿®é¥°ç¬¦æ¥ç¼©å†™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1&lt;ChildComponent :title.sync=&quot;pageTitle&quot; /&gt; Vue3 â€” v-model 1234567891011121314151617&lt;ChildComponent v-model=&quot;pageTitle&quot; /&gt;&lt;!-- ç®€å†™: --&gt;&lt;ChildComponent :modelValue=&quot;pageTitle&quot; @update:modelValue=&quot;pageTitle = $event&quot;/&gt;&lt;ChildComponent v-model:title=&quot;pageTitle&quot; /&gt;&lt;!-- ç®€å†™: --&gt;&lt;ChildComponent :title=&quot;pageTitle&quot; @update:title=&quot;pageTitle = $event&quot;/&gt; v-is ğŸš©â• V-is ä»…é™äºindomçš„æ¨¡ç‰ˆ Vue3ä¸­åªèƒ½ä½¿ç”¨isåœ¨å†…ç½®çš„componentç»„ä»¶ä¸Šé¢ vue2 123&lt;table&gt; &lt;tr :is=&quot;&#x27;my-component&#x27;&quot;&gt;&lt;/tr&gt;&lt;/table&gt; vue3 :isä¸å†é€‚ç”¨äºindomçš„æ¨¡ç‰ˆ 123&lt;table&gt; &lt;tr v-is=&quot;&#x27;my-component&#x27;&quot;&gt;&lt;/tr&gt;&lt;/table&gt; v-slot ğŸš©â• æ’æ§½åœ¨vue3ä¸­ç»Ÿä¸€äº†vue2çš„slotå’Œscope-slot Vue2 1234567&lt;!-- å­ç»„ä»¶ä¸­ï¼š--&gt;&lt;slotÂ name=&quot;title&quot;&gt;&lt;/slot&gt;&lt;!-- çˆ¶ç»„ä»¶ä¸­ï¼š--&gt;&lt;template slot=&quot;title&quot;&gt; &lt;h1&gt;æ­Œæ›²ï¼šæˆéƒ½&lt;/h1&gt;&lt;template&gt; å¦‚æœæˆ‘ä»¬è¦åœ¨ slot ä¸Šé¢ç»‘å®šæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ä½œç”¨åŸŸæ’æ§½ï¼Œå®ç°å¦‚ä¸‹ï¼š 1234567891011121314// å­ç»„ä»¶&lt;slot name=&quot;content&quot; :data=&quot;data&quot;&gt;&lt;/slot&gt;export default &#123; data()&#123; return&#123; data:[&quot;èµ°è¿‡æ¥äººæ¥äººå¾€&quot;,&quot;ä¸å–œæ¬¢ä¹Ÿå¾—æ¬£èµ&quot;,&quot;é™ªä¼´æ˜¯æœ€é•¿æƒ…çš„å‘Šç™½&quot;] &#125; &#125;&#125;&lt;!-- çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨ --&gt;&lt;template slot=&quot;content&quot; slot-scope=&quot;scoped&quot;&gt; &lt;div v-for=&quot;item in scoped.data&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/div&gt;&lt;template&gt; Vue3 åœ¨ Vue2.x ä¸­å…·åæ’æ§½å’Œä½œç”¨åŸŸæ’æ§½åˆ†åˆ«ä½¿ç”¨slotå’Œslot-scopeæ¥å®ç°ï¼Œ åœ¨ Vue3.0 ä¸­å°†slotå’Œslot-scopeè¿›è¡Œäº†åˆå¹¶åŒæ„ä½¿ç”¨ã€‚ Vue3.0 ä¸­v-slotï¼š 123456789&lt;!-- çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨ --&gt; &lt;template v-slot:content=&quot;scoped&quot;&gt; &lt;div v-for=&quot;item in scoped.data&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/div&gt;&lt;/template&gt;&lt;!-- ä¹Ÿå¯ä»¥ç®€å†™æˆï¼š --&gt;&lt;template #content=&quot;&#123;data&#125;&quot;&gt; &lt;div v-for=&quot;item in data&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/div&gt;&lt;/template&gt; è‡ªå®šä¹‰æŒ‡ä»¤å˜åŒ– ğŸš©â•vue3ä¸­æŒ‡ä»¤apiå’Œç»„ä»¶ä¿æŒä¸€è‡´ï¼Œå…·ä½“è¡¨ç°åœ¨ï¼š bind â†’ beforeMount inserted â†’ mounted beforeUpdate: new! å…ƒç´ è‡ªèº«æ›´æ–°å‰è°ƒç”¨, å’Œç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­å¾ˆåƒ update â†’ removed! å’ŒupdatedåŸºæœ¬ç›¸åŒï¼Œå› æ­¤è¢«ç§»é™¤ä¹‹ï¼Œä½¿ç”¨updatedä»£æ›¿ã€‚ componentUpdated â†’ updated beforeUnmount new! å’Œç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­ç›¸ä¼¼, å…ƒç´ å°†è¦è¢«ç§»é™¤ä¹‹å‰è°ƒç”¨ã€‚ unbind â†’ unmounted å†…ç½®ç»„ä»¶teleport ğŸš©â•æºç  Props to - string å¿…å¡«å±æ€§ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„queryé€‰æ‹©å™¨ï¼Œæˆ–è€…æ˜¯å…ƒç´ (å¦‚æœåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ä½¿ç”¨ï¼‰ã€‚ä¸­çš„å†…å®¹å°†ä¼šè¢«æ”¾ç½®åˆ°æŒ‡å®šçš„ç›®æ ‡å…ƒç´ ä¸­ 12345678910&lt;!-- æ­£ç¡®çš„ --&gt;&lt;teleport to=&quot;#some-id&quot; /&gt;&lt;teleport to=&quot;.some-class&quot; /&gt; /*å…ƒç´ */&lt;teleport to=&quot;[data-teleport]&quot; /&gt;&lt;!-- é”™è¯¯çš„ --&gt;&lt;teleport to=&quot;h1&quot; /&gt;&lt;teleport to=&quot;some-string&quot; /&gt; disabled - boolean è¿™æ˜¯ä¸€ä¸ªå¯é€‰é¡¹ ï¼Œåšä¸€ä¸ªæ˜¯å¯ä»¥ç”¨æ¥ç¦ç”¨çš„åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€å®ƒçš„æ’æ§½å†…å®¹ä¸ä¼šç§»åŠ¨åˆ°ä»»ä½•åœ°æ–¹ï¼Œè€Œæ˜¯æŒ‰æ²¡æœ‰teleportç»„ä»¶ä¸€èˆ¬æ¥å‘ˆç°ã€é»˜è®¤ä¸ºfalseã€‘ 1234&lt;teleport to=&quot;#popup&quot; :disabled=&quot;displayVideoInline&quot;&gt; &lt;h1&gt;999999&lt;/h1&gt;&lt;/teleport&gt; æ³¨æ„ï¼Œè¿™å°†ç§»åŠ¨å®é™…çš„DOMèŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯é”€æ¯å’Œé‡æ–°åˆ›å»ºï¼Œå¹¶ä¸”è¿˜å°†ä¿æŒä»»ä½•ç»„ä»¶å®ä¾‹æ˜¯æ´»åŠ¨çš„ã€‚æ‰€æœ‰æœ‰çŠ¶æ€HTMLå…ƒç´ (æ¯”å¦‚ä¸€ä¸ªæ­£åœ¨æ’­æ”¾çš„è§†é¢‘)å°†ä¿æŒå®ƒä»¬çš„çŠ¶æ€ã€‚ã€æ§åˆ¶displayVideoInlineå¹¶ä¸æ˜¯é”€æ¯é‡å»ºï¼Œå®ƒä¿æŒå®ä¾‹æ˜¯å­˜åœ¨çš„ï¼Œä¸ä¼šè¢«æ³¨é”€ã€‘ Suspense ğŸš©â• å®˜æ–¹æ–‡æ¡£ å®˜æ–¹æ–‡æ¡£ç›®å‰è¿˜æ˜¯æ ‡æ³¨ä¸ºè¯•éªŒæ€§ è¯¥ &lt;suspense&gt; ç»„ä»¶æä¾›äº†å¦ä¸€ä¸ªæ–¹æ¡ˆï¼Œå…è®¸å°†ç­‰å¾…è¿‡ç¨‹æå‡åˆ°ç»„ä»¶æ ‘ä¸­å¤„ç†ï¼Œè€Œä¸æ˜¯åœ¨å•ä¸ªç»„ä»¶ä¸­ã€‚ è‡ªå¸¦ä¸¤ä¸ª slot åˆ†åˆ«ä¸º defaultã€fallbackã€‚é¡¾åæ€ä¹‰ï¼Œå½“è¦åŠ è½½çš„ç»„ä»¶ä¸æ»¡è¶³çŠ¶æ€æ—¶,Suspense å°†å›é€€åˆ° fallbackçŠ¶æ€ä¸€ç›´åˆ°åŠ è½½çš„ç»„ä»¶æ»¡è¶³æ¡ä»¶ï¼Œæ‰ä¼šè¿›è¡Œæ¸²æŸ“ã€‚ Suspense.vue 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566&lt;template&gt; &lt;button @click=&quot;loadAsyncComponent&quot;&gt;ç‚¹å‡»åŠ è½½å¼‚æ­¥ç»„ä»¶&lt;/button&gt; &lt;Suspense v-if=&quot;loadAsync&quot;&gt; &lt;template #default&gt; &lt;!-- åŠ è½½å¯¹åº”çš„ç»„ä»¶ --&gt; &lt;MAsynComp&gt;&lt;/MAsynComp&gt; &lt;/template&gt; &lt;template #fallback&gt; &lt;div class=&quot;loading&quot;&gt;&lt;/div&gt; &lt;/template&gt; &lt;/Suspense&gt;&lt;/template&gt;&lt;script&gt;import &#123; ref, defineAsyncComponent &#125; from &#x27;vue&#x27;export default &#123; components: &#123; MAsynComp: defineAsyncComponent(() =&gt; import(&#x27;./AsynComp.vue&#x27;)), &#125;, setup() &#123; const loadAsync = ref(false) const loadAsyncComponent = () =&gt; &#123; loadAsync.value = true &#125; return &#123; loadAsync, loadAsyncComponent, &#125; &#125;,&#125;&lt;/script&gt;&lt;style lang=&quot;less&quot; scoped&gt;button &#123; padding: 12px 12px; background-color: #1890ff; outline: none; border: none; border-radius: 4px; color: #fff; cursor: pointer;&#125;.loading &#123; position: absolute; width: 36px; height: 36px; top: 50%; left: 50%; margin: -18px 0 0 -18px; background-image: url(&#x27;../assets/loading.png&#x27;); background-size: 100%; animation: rotate 1.4s linear infinite;&#125;@keyframes rotate &#123; from &#123; transform: rotate(0); &#125; to &#123; transform: rotate(360deg); &#125;&#125;&lt;/style&gt; AsynComp.vue 12345678910111213141516171819202122&lt;template&gt; &lt;h1&gt;this is async component&lt;/h1&gt;&lt;/template&gt;&lt;script&gt;import &#123; setup &#125; from &#x27;vue&#x27;export default &#123; name: &#x27;AsyncComponent&#x27;, async setup() &#123; const sleep = (time) =&gt; &#123; return new Promise((reslove, reject) =&gt; &#123; setTimeout(() =&gt; &#123; reslove() &#125;, time) &#125;) &#125; await sleep(3000) //æ¨¡æ‹Ÿæ•°æ®è¯·æ±‚ &#125;,&#125;&lt;/script&gt; Fragments ğŸš©â•Vue3.0ç»„ä»¶ä¸­å¯ä»¥å…è®¸æœ‰å¤šä¸ªæ ¹ç»„ä»¶ï¼Œé¿å…äº†å¤šä¸ªæ²¡å¿…è¦çš„divæ¸²æŸ“ 12345&lt;template&gt; &lt;div&gt;å¤´éƒ¨&lt;/div&gt; &lt;div&gt;å†…å®¹&lt;/div&gt;&lt;/template&gt; è¿™æ ·åšçš„å¥½å¤„ï¼š å°‘äº†å¾ˆå¤šæ²¡æœ‰æ„ä¹‰çš„div å¯ä»¥å®ç°å¹³çº§é€’å½’ï¼Œå¯¹å®ç°treeç»„ä»¶æœ‰å¾ˆå¤§å¸®åŠ© ç›¸åº”å¼ç³»ç»Ÿ ğŸš©ğŸš©ğŸš©å“åº”å¼ç³»ç»Ÿ APIreactivedesc: æ¥æ”¶ä¸€ä¸ªæ™®é€šå¯¹è±¡ç„¶åè¿”å›è¯¥æ™®é€šå¯¹è±¡çš„å“åº”å¼ä»£ç†ã€ç­‰åŒäº 2.x çš„ Vue.observable()ã€‘ ssss tips:Proxyå¯¹è±¡æ˜¯ç›®æ ‡å¯¹è±¡çš„ä¸€ä¸ªä»£ç†å™¨ï¼Œä»»ä½•å¯¹ç›®æ ‡å¯¹è±¡çš„æ“ä½œï¼ˆå®ä¾‹åŒ–ï¼Œæ·»åŠ /åˆ é™¤/ä¿®æ”¹å±æ€§ç­‰ç­‰ï¼‰ï¼Œéƒ½å¿…é¡»é€šè¿‡è¯¥ä»£ç†å™¨ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠæ¥è‡ªå¤–ç•Œçš„æ‰€æœ‰æ“ä½œè¿›è¡Œæ‹¦æˆªå’Œè¿‡æ»¤æˆ–è€…ä¿®æ”¹ç­‰æ“ä½œ å“åº”å¼è½¬æ¢æ˜¯â€œæ·±å±‚çš„â€ï¼šä¼šå½±å“å¯¹è±¡å†…éƒ¨æ‰€æœ‰åµŒå¥—çš„å±æ€§ã€‚åŸºäº ES2015 çš„ Proxy å®ç°ï¼Œè¿”å›çš„ä»£ç†å¯¹è±¡ä¸ç­‰äºåŸå§‹å¯¹è±¡ã€‚å»ºè®®ä»…ä½¿ç”¨ä»£ç†å¯¹è±¡è€Œé¿å…ä¾èµ–åŸå§‹å¯¹è±¡ reactive ç±»çš„ api ä¸»è¦æä¾›äº†å°†å¤æ‚ç±»å‹çš„æ•°æ®å¤„ç†æˆå“åº”å¼æ•°æ®çš„èƒ½åŠ›ï¼Œå…¶å®è¿™ä¸ªå¤æ‚ç±»å‹æ˜¯è¦åœ¨object array map set weakmap weakset è¿™äº”ç§ä¹‹ä¸­ å› ä¸ºæ˜¯ç»„åˆå‡½æ•°ã€å¯¹è±¡ã€‘ï¼Œæ‰€ä»¥å¿…é¡»å§‹ç»ˆä¿æŒå¯¹è¿™ä¸ªæ‰€è¿”å›å¯¹è±¡çš„å¼•ç”¨ä»¥ä¿æŒå“åº”æ€§ã€ä¸èƒ½è§£æ„è¯¥å¯¹è±¡æˆ–è€…å±•å¼€ã€‘ä¾‹å¦‚ const &#123; x, y &#125; = useMousePosition()æˆ–è€…return &#123; ...useMousePosition() &#125; 123456789101112function useMousePosition() &#123; const pos = reactive(&#123; x: 0, y: 0, &#125;) return pos&#125; toRefs API ç”¨æ¥æä¾›è§£å†³æ­¤çº¦æŸçš„åŠæ³•â€”â€”å®ƒå°†å“åº”å¼å¯¹è±¡çš„æ¯ä¸ª property éƒ½è½¬æˆäº†ç›¸åº”çš„ refã€æŠŠå¯¹è±¡è½¬æˆäº†refã€‘ã€‚ 1234567891011 function useMousePosition() &#123; const pos = reactive(&#123; x: 0, y: 0, &#125;) return toRefs(pos)&#125;// x &amp; y ç°åœ¨æ˜¯ ref å½¢å¼äº†!const &#123; x, y &#125; = useMousePosition() refæ¥å—ä¸€ä¸ªå‚æ•°å€¼å¹¶è¿”å›ä¸€ä¸ªå“åº”å¼ä¸”å¯æ”¹å˜çš„ ref å¯¹è±¡ã€‚ref å¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªæŒ‡å‘å†…éƒ¨å€¼çš„å•ä¸€å±æ€§ .value 123const count = ref(0)console.log(count.value) // 0 å¦‚æœä¼ å…¥ ref çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°†è°ƒç”¨ reactive æ–¹æ³•è¿›è¡Œæ·±å±‚å“åº”è½¬æ¢ é™·é˜± setup ä¸­returnè¿”å›ä¼šè‡ªåŠ¨è§£å¥—ã€åœ¨æ¨¡æ¿ä¸­ä¸éœ€è¦.valueã€‘ ref ä½œä¸º reactive å¯¹è±¡çš„ property è¢«è®¿é—®æˆ–ä¿®æ”¹æ—¶ï¼Œä¹Ÿå°†è‡ªåŠ¨è§£å¥— .value 12345678910111213const count = ref(0)/*å½“åšreactiveçš„å¯¹è±¡å±æ€§----è§£å¥—*/const state = reactive(&#123; count,&#125;)/* ä¸éœ€è¦.value*/console.log(state.count) // 0/*ä¿®æ”¹reactiveçš„å€¼*/state.count = 1/*ä¿®æ”¹äº†refçš„å€¼*/console.log(count.value) // 1 æ³¨æ„å¦‚æœå°†ä¸€ä¸ªæ–°çš„ ref åˆ†é…ç»™ç°æœ‰çš„ refï¼Œ å°†æ›¿æ¢æ—§çš„ ref 12345678910/*åˆ›å»ºä¸€ä¸ªæ–°çš„ref*/const otherCount = ref(2)/*èµ‹å€¼ç»™reactiveçš„æ—§çš„refï¼Œæ—§çš„ä¼šè¢«æ›¿æ¢æ‰*/state.count = otherCount/*ä¿®æ”¹reactiveä¼šä¿®æ”¹otherCount*/console.log(state.count) // 2/*ä¿®æ”¹reactiveä¼šcountæ²¡æœ‰è¢«ä¿®æ”¹ */console.log(count.value) // 1 åµŒå¥—åœ¨ reactive Object ä¸­æ—¶ï¼Œref æ‰ä¼šè§£å¥—ã€‚ä» Array æˆ–è€… Map ç­‰åŸç”Ÿé›†åˆç±»ä¸­è®¿é—® ref æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨è§£å¥—ã€è‡ªç”±æ•°æ®ç±»å‹æ˜¯Objectæ‰ä¼šè§£å¥—ï¼Œarray map set weakmap weakseté›†åˆç±» è®¿é—® ref æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨è§£å¥—ã€‘ 12345678const arr = reactive([ref(0)])// è¿™é‡Œéœ€è¦ .valueconsole.log(arr[0].value)const map = reactive(new Map([[&#x27;foo&#x27;, ref(0)]]))// è¿™é‡Œéœ€è¦ .valueconsole.log(map.get(&#x27;foo&#x27;).value) å¿ƒæ™ºè´Ÿæ‹…ä¸Š ref vs reactive åœ¨æ™®é€š JavaScript ä¸­åŒºåˆ«å£°æ˜åŸºç¡€ç±»å‹å˜é‡ä¸å¯¹è±¡å˜é‡æ—¶ä¸€æ ·åŒºåˆ«ä½¿ç”¨ ref å’Œ reactive æ‰€æœ‰çš„åœ°æ–¹éƒ½ç”¨ reactiveï¼Œç„¶åè®°å¾—åœ¨ç»„åˆå‡½æ•°è¿”å›å“åº”å¼å¯¹è±¡æ—¶ä½¿ç”¨ toRefsã€‚è¿™é™ä½äº†ä¸€äº›å…³äº ref çš„å¿ƒæ™ºè´Ÿæ‹… readonlyä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼ˆå“åº”å¼æˆ–æ™®é€šï¼‰æˆ– refï¼Œè¿”å›ä¸€ä¸ªåŸå§‹å¯¹è±¡çš„åªè¯»ä»£ç†ã€‚ä¸€ä¸ªåªè¯»çš„ä»£ç†æ˜¯â€œæ·±å±‚çš„â€ï¼Œå¯¹è±¡å†…éƒ¨ä»»ä½•åµŒå¥—çš„å±æ€§ä¹Ÿéƒ½æ˜¯åªè¯»çš„ã€è¿”å›ä¸€ä¸ªæ°¸è¿œä¸ä¼šå˜çš„åªè¯»ä»£ç†ã€‘ã€åœºæ™¯å¯ä»¥å‚æ•°æ¯”å¯¹ç­‰ã€‘ 123456789101112131415const original = reactive(&#123; count: 0 &#125;)const copy = readonly(original)watchEffect(() =&gt; &#123; // ä¾èµ–è¿½è¸ª console.log(copy.count)&#125;)// original ä¸Šçš„ä¿®æ”¹ä¼šè§¦å‘ copy ä¸Šçš„ä¾¦å¬original.count++// æ— æ³•ä¿®æ”¹ copy å¹¶ä¼šè¢«è­¦å‘Šcopy.count++ // warning! reactiveå“åº”å¼ç³»ç»Ÿå·¥å…·é›†isProxy æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç”± reactive æˆ–è€… readonly æ–¹æ³•åˆ›å»ºçš„ä»£ç† isReactive æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç”± reactive åˆ›å»ºçš„å“åº”å¼ä»£ç† 123456import &#123; reactive, isReactive &#125; from &#x27;vue&#x27;const state = reactive(&#123; name: &#x27;John&#x27; &#125;)console.log(isReactive(state)) // -&gt; true å¦‚æœè¿™ä¸ªä»£ç†æ˜¯ç”± readonly åˆ›å»ºçš„ï¼Œä½†æ˜¯åˆè¢« reactive åˆ›å»ºçš„å¦ä¸€ä¸ªä»£ç†åŒ…è£¹äº†ä¸€å±‚ï¼Œé‚£ä¹ˆåŒæ ·ä¹Ÿä¼šè¿”å› true 123456789101112131415import &#123; reactive, isReactive, readonly &#125; from &#x27;vue&#x27;const state = reactive(&#123; name: &#x27;John&#x27; &#125;)// ç”¨readonlyåˆ›å»ºä¸€ä¸ªåªè¯»å“åº”å¼å¯¹è±¡plainconst plain = readonly(&#123; name: &#x27;Mary&#x27;&#125;)//readonlyåˆ›å»ºçš„ï¼Œæ‰€ä»¥isReactiveä¸ºfalseconsole.log(isReactive(plain)) // -&gt; false // reactiveåˆ›å»ºçš„å“åº”å¼ä»£ç†å¯¹è±¡åŒ…è£¹ä¸€å±‚readonly,isReactiveä¹Ÿæ˜¯true,isReadonlyä¹Ÿæ˜¯trueconst stateCopy = readonly(state)console.log(isReactive(stateCopy)) // -&gt; true isReadonly æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç”± readonly åˆ›å»ºçš„åªè¯»ä»£ç† reactiveé«˜çº§å“åº”å¼ç³»ç»ŸAPItoRaw è¿”å›ç”± reactive æˆ– readonly æ–¹æ³•è½¬æ¢æˆå“åº”å¼ä»£ç†çš„æ™®é€šå¯¹è±¡ã€‚è¿™æ˜¯ä¸€ä¸ªè¿˜åŸæ–¹æ³•ï¼Œå¯ç”¨äºä¸´æ—¶è¯»å–ï¼Œè®¿é—®ä¸ä¼šè¢«ä»£ç†/è·Ÿè¸ªï¼Œå†™å…¥æ—¶ä¹Ÿä¸ä¼šè§¦å‘æ›´æ”¹ã€‚ä¸å»ºè®®ä¸€ç›´æŒæœ‰åŸå§‹å¯¹è±¡çš„å¼•ç”¨ã€**ä¸å»ºè®®èµ‹å€¼ç»™ä»»ä½•å˜é‡**ã€‘ã€‚è¯·è°¨æ…ä½¿ç”¨ è¢«toRawä¹‹åçš„å¯¹è±¡æ˜¯æ²¡æœ‰è¢«ä»£ç†/è·Ÿè¸ªçš„çš„æ™®é€šå¯¹è±¡ 123456const foo = &#123;&#125;const reactiveFoo = reactive(foo)console.log(toRaw(reactiveFoo) === foo) // trueconsole.log(toRaw(reactiveFoo) !== reactiveFoo) // true markRawæ˜¾å¼æ ‡è®°ä¸€ä¸ªå¯¹è±¡ä¸ºâ€œæ°¸è¿œä¸ä¼šè½¬ä¸ºå“åº”å¼ä»£ç†â€ï¼Œå‡½æ•°è¿”å›è¿™ä¸ªå¯¹è±¡æœ¬èº«ã€‚ ã€markRawä¼ å…¥å¯¹è±¡ï¼Œè¿”å›çš„å€¼æ˜¯æ°¸è¿œä¸ä¼šè¢«è½¬ä¸ºå“åº”å¼ä»£ç†çš„ã€‘ 12345const foo = markRaw(&#123; name: &#x27;Mary&#x27;&#125;)console.log(isReactive(reactive(foo))) // false è¢« markRaw æ ‡è®°äº†ï¼Œå³ä½¿åœ¨å“åº”å¼å¯¹è±¡ä¸­ä½œå±æ€§ï¼Œä¹Ÿä¾ç„¶ä¸æ˜¯å“åº”å¼çš„ 123const bar = reactive(&#123; foo &#125;)console.log(isReactive(bar.foo)) // false markRawæ³¨æ„ç‚¹ markRawå’Œ shallowXXX ä¸€æ—çš„ APIå…è®¸é€‰æ‹©æ€§çš„è¦†ç›–reactiveæˆ–è€…readonly é»˜è®¤åˆ›å»ºçš„ â€œæ·±å±‚çš„â€ ç‰¹æ€§ã€å“åº”å¼ã€‘/æˆ–è€…ä½¿ç”¨æ— ä»£ç†çš„æ™®é€šå¯¹è±¡ è®¾è®¡è¿™ç§ã€Œæµ…å±‚è¯»å–ã€æœ‰å¾ˆå¤šåŸå›  ä¸€äº›å€¼çš„å®é™…ä¸Šçš„ç”¨æ³•éå¸¸ç®€å•ï¼Œå¹¶æ²¡æœ‰å¿…è¦è½¬ä¸ºå“åº”å¼ã€ä¾‹å¦‚ä¸‰æ–¹åº“çš„å®ä¾‹/çœå¸‚åŒºjson/Vueç»„ä»¶å¯¹è±¡ã€‘ å½“æ¸²æŸ“ä¸€ä¸ªå…ƒç´ æ•°é‡åºå¤§ï¼Œä½†æ˜¯æ•°æ®æ˜¯ä¸å¯å˜çš„ï¼Œè·³è¿‡ Proxy çš„è½¬æ¢å¯ä»¥å¸¦æ¥æ€§èƒ½æå‡ è¿™äº› API è¢«è®¤ä¸ºæ˜¯é«˜çº§çš„ï¼Œæ˜¯å› ä¸ºè¿™ç§ç‰¹æ€§ä»…åœç•™åœ¨æ ¹çº§åˆ«ï¼Œæ‰€ä»¥å¦‚æœä½ å°†ä¸€ä¸ªåµŒå¥—çš„ï¼Œæ²¡æœ‰ markRaw çš„å¯¹è±¡è®¾ç½®ä¸º reactive å¯¹è±¡çš„å±æ€§ï¼Œåœ¨é‡æ–°è®¿é—®æ—¶ï¼Œä½ åˆä¼šå¾—åˆ°ä¸€ä¸ª Proxy çš„ç‰ˆæœ¬ï¼Œåœ¨ä½¿ç”¨ä¸­æœ€ç»ˆä¼šå¯¼è‡´æ ‡è¯†æ··æ·†çš„ä¸¥é‡é—®é¢˜ï¼šæ‰§è¡ŒæŸä¸ªæ“ä½œåŒæ—¶ä¾èµ–äºæŸä¸ªå¯¹è±¡çš„åŸå§‹ç‰ˆæœ¬å’Œä»£ç†ç‰ˆæœ¬ï¼ˆæ ‡è¯†æ··æ·†åœ¨ä¸€èˆ¬ä½¿ç”¨å½“ä¸­åº”è¯¥æ˜¯éå¸¸ç½•è§çš„ï¼Œä½†æ˜¯è¦æƒ³å®Œå…¨é¿å…è¿™æ ·çš„é—®é¢˜ï¼Œå¿…é¡»è¦å¯¹æ•´ä¸ªå“åº”å¼ç³»ç»Ÿçš„å·¥ä½œåŸç†æœ‰ä¸€ä¸ªç›¸å½“æ¸…æ™°çš„è®¤çŸ¥ï¼‰ã€‚ 1234567891011const foo = markRaw(&#123; nested: &#123;&#125;,&#125;)const bar = reactive(&#123; // å°½ç®¡ `foo` å·±ç»è¢«æ ‡è®°ä¸º raw äº†, ä½† foo.nested å¹¶æ²¡æœ‰ nested: foo.nested,&#125;)console.log(foo.nested === bar.nested) // false foo.nestedæ²¡æœ‰è¢«æ ‡è®°ä¸º(æ°¸è¿œä¸ä¼šè½¬ä¸ºå“åº”å¼ä»£ç†)ï¼Œå¯¼è‡´æœ€åçš„å€¼ä¸€ä¸ªreactive shallowReactiveåªä¸ºæŸä¸ªå¯¹è±¡çš„ç§æœ‰ï¼ˆç¬¬ä¸€å±‚ï¼‰å±æ€§åˆ›å»ºæµ…å±‚çš„å“åº”å¼ä»£ç†ï¼Œä¸ä¼šå¯¹â€œå±æ€§çš„å±æ€§â€åšæ·±å±‚æ¬¡ã€é€’å½’åœ°å“åº”å¼ä»£ç†ï¼Œè€Œåªæ˜¯ä¿ç•™åŸæ ·ã€ç¬¬ä¸€å±‚æ˜¯å“åº”å¼ä»£ç†ï¼Œæ·±å±‚æ¬¡åªä¿ç•™åŸæ ·(ä¸å…·å¤‡å“åº”å¼ä»£ç†)ã€‘ 12345678910111213const state = shallowReactive(&#123; foo: 1, nested: &#123; bar: 2, &#125;,&#125;)// å˜æ›´ state çš„è‡ªæœ‰å±æ€§æ˜¯å“åº”å¼çš„ã€ç¬¬ä¸€å±‚æ¬¡å“åº”å¼ã€‘state.foo++// ...ä½†ä¸ä¼šæ·±å±‚ä»£ç†ã€æ·±å±‚æ¬¡ä¸æ˜¯å“åº”å¼ã€‘(æ¸²æŸ“æ€§èƒ½)isReactive(state.nested) // falsestate.nested.bar++ // éå“åº”å¼ shallowReadonlyç±»ä¼¼äºshallowReactiveï¼ŒåŒºåˆ«æ˜¯ï¼š ç¬¬ä¸€å±‚å°†ä¼šæ˜¯å“åº”å¼ä»£ç†ã€ç¬¬ä¸€å±‚ä¿®æ”¹å±æ€§ä¼šå¤±è´¥ã€‘ï¼Œå±æ€§ä¸ºå“åº”å¼ æ·±å±‚æ¬¡çš„å¯¹è±¡å±æ€§å¯ä»¥ä¿®æ”¹ï¼Œå±æ€§ä¸æ˜¯å“åº”å¼ 12345678910111213const state = shallowReadonly(&#123; foo: 1, nested: &#123; bar: 2, &#125;,&#125;)// å˜æ›´ state çš„è‡ªæœ‰å±æ€§ä¼šå¤±è´¥state.foo++// ...ä½†æ˜¯åµŒå¥—çš„å¯¹è±¡æ˜¯å¯ä»¥å˜æ›´çš„isReadonly(state.nested) // falsestate.nested.bar++ // åµŒå¥—å±æ€§ä¾ç„¶å¯ä¿®æ”¹ ref å“åº”å¼ç³»ç»Ÿå·¥å…·é›†unrefunrefæ˜¯val = isRef(val) ? val.value : val çš„è¯­æ³•ç³– 123456unref(ref(0))===unref(0)===0 è¿”å›numberfunction useFoo(x: number | Ref&lt;number&gt;) &#123; const unwrapped = unref(x) // unwrapped ä¸€å®šæ˜¯ number ç±»å‹&#125; toReftoRef å¯ä»¥ç”¨æ¥ä¸ºä¸€ä¸ª reactive å¯¹è±¡çš„å±æ€§ã€æŸä¸ªå±æ€§åŒºåˆ«toRefsæ¯ä¸€ä¸ªå±æ€§ã€‘åˆ›å»ºä¸€ä¸ª refã€‚è¿™ä¸ª ref å¯ä»¥è¢«ä¼ é€’å¹¶ä¸”èƒ½å¤Ÿä¿æŒå“åº”æ€§ 1234567891011121314const state = reactive(&#123; foo: 1, bar: 2,&#125;)//reactiveè·å–å•ä¸ªå±æ€§è½¬ä¸ºrefã€fooRefåªæ˜¯ä¸€ä¸ªä»£ç†ã€‘const fooRef = toRef(state, &#x27;foo&#x27;)fooRef.value++console.log(state.foo) // 2state.foo++console.log(fooRef.value) // 3 toRefsæŠŠä¸€ä¸ªå“åº”å¼å¯¹è±¡è½¬æ¢æˆæ™®é€šå¯¹è±¡ï¼Œè¯¥æ™®é€šå¯¹è±¡çš„æ¯ä¸ª property éƒ½æ˜¯ä¸€ä¸ª ref ï¼Œå’Œå“åº”å¼å¯¹è±¡ property ä¸€ä¸€å¯¹åº” 12345678910111213141516171819202122const state = reactive(&#123; foo: 1, bar: 2,&#125;)const stateAsRefs = toRefs(state)/*stateAsRefs çš„ç±»å‹å¦‚ä¸‹:&#123; foo: Ref&lt;number&gt;, bar: Ref&lt;number&gt;&#125;*/// ref å¯¹è±¡ ä¸ åŸå±æ€§çš„å¼•ç”¨æ˜¯ &quot;é“¾æ¥&quot; ä¸Šçš„state.foo++console.log(stateAsRefs.foo) // 2stateAsRefs.foo.value++console.log(state.foo) // 3 å¯ä»¥é€šè¿‡toRefsè¿”å›å¯è§£æ„çš„reactiveï¼Œå› ä¸ºtoRefsåŒ…è£¹ä¹‹åè¿”å›ä¸€ä¸€å¯¹åº”çš„refå±æ€§ 123456789101112131415161718192021222324function useFeatureX() &#123; const state = reactive(&#123; foo: 1, bar: 2, &#125;) // å¯¹ state çš„é€»è¾‘æ“ä½œ // è¿”å›æ—¶å°†å±æ€§éƒ½è½¬ä¸º ref return toRefs(state)&#125;export default &#123; setup() &#123; // å¯ä»¥è§£æ„ï¼Œä¸ä¼šä¸¢å¤±å“åº”æ€§ const &#123; foo, bar &#125; = useFeatureX() return &#123; foo, bar, &#125; &#125;,&#125; isRefæ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºä¸€ä¸ª ref å¯¹è±¡ ref é«˜çº§å“åº”å¼ç³»ç»ŸAPIcustomRefç”¨äºè‡ªå®šä¹‰ä¸€ä¸ª refï¼Œå¯ä»¥æ˜¾å¼åœ°æ§åˆ¶ä¾èµ–è¿½è¸ªå’Œè§¦å‘å“åº”ï¼Œæ¥å—ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ç”¨äºè¿½è¸ªçš„ track ä¸ç”¨äºè§¦å‘å“åº”çš„ triggerï¼Œå¹¶è¿”å›ä¸€ä¸ªä¸€ä¸ªå¸¦æœ‰ get å’Œ set å±æ€§çš„å¯¹è±¡ã€å®é™…ä¸Šå°±æ˜¯æ‰‹åŠ¨ trackè¿½è¸ª å’Œ triggerè§¦å‘å“åº”ã€‘ ä»¥ä¸‹ä»£ç å¯ä»¥ä½¿å¾—v-modelé˜²æŠ– 123456789101112131415161718192021222324252627282930function useDebouncedRef(value, delay = 200) &#123; let timeout return customRef((track, trigger) =&gt; &#123; return &#123; get() &#123; /*åˆå§‹åŒ–æ‰‹åŠ¨è¿½è¸ªä¾èµ–è®²ç©¶ä»€ä¹ˆæ—¶å€™å»è§¦å‘ä¾èµ–æ”¶é›†*/ track() return value &#125;, set(newValue) &#123; /*ä¿®æ”¹æ•°æ®çš„æ—¶å€™ä¼šæŠŠä¸Šä¸€æ¬¡çš„å®šæ—¶å™¨æ¸…é™¤ã€é˜²æŠ–ã€‘*/ clearTimeout(timeout) timeout = setTimeout(() =&gt; &#123; /*æŠŠæ–°è®¾ç½®çš„æ•°æ®ç»™åˆ°refæ•°æ®æº*/ value = newValue /*å†æœ‰ä¾èµ–è¿½è¸ªçš„å‰æä¸‹è§¦å‘å“åº”å¼*/ trigger() &#125;, delay) &#125;, &#125; &#125;)&#125;setup() &#123; return &#123; /*æš´éœ²è¿”å›çš„æ•°æ®åŠ é˜²æŠ–*/ text: useDebouncedRef(&#x27;hello&#x27;), &#125; &#125; shallowRefåˆ›å»ºä¸€ä¸ª ref ï¼Œå°†ä¼šè¿½è¸ªå®ƒçš„ .value æ›´æ”¹æ“ä½œï¼Œä½†æ˜¯å¹¶ä¸ä¼šå¯¹å˜æ›´åçš„ .value åšå“åº”å¼ä»£ç†è½¬æ¢ï¼ˆå³å˜æ›´ä¸ä¼šè°ƒç”¨ reactiveï¼‰ å‰é¢æˆ‘ä»¬è¯´è¿‡å¦‚æœä¼ å…¥ ref çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°†è°ƒç”¨ reactive æ–¹æ³•è¿›è¡Œæ·±å±‚å“åº”è½¬æ¢,é€šè¿‡shallowRefåˆ›å»ºçš„ref,å°†ä¸ä¼šè°ƒç”¨reactiveã€å¯¹è±¡ä¸ä¼šæ˜¯å“åº”å¼çš„ã€‘ 12345const refOne = shallowRef(&#123;&#125;);refOne.value = &#123; id: 1 &#125;;refOne.id == 20;console.log(isReactive(refOne.value),refOne.value);//false &#123; id: 1 &#125; triggerRef ã€ä¸shallowRefé…åˆã€‘æ‰‹åŠ¨æ‰§è¡Œä¸shallowRefç›¸å…³çš„ä»»ä½•æ•ˆæœ 1234567891011121314const shallow = shallowRef(&#123; greet: &#x27;Hello, world&#x27;&#125;)// ç¬¬ä¸€æ¬¡è¿è¡Œæ‰“å° &quot;Hello, world&quot; watchEffect(() =&gt; &#123; console.log(shallow.value.greet)&#125;)// è¿™ä¸ä¼šè§¦å‘æ•ˆæœï¼Œå› ä¸ºrefæ˜¯shallowshallow.value.greet = &#x27;Hello, universe&#x27;// æ‰“å° &quot;Hello, universe&quot;triggerRef(shallow) Composition APIsetupsetup å‡½æ•°æ˜¯ä¸€ä¸ªæ–°çš„ç»„ä»¶é€‰é¡¹ã€‚ä½œä¸ºåœ¨ç»„ä»¶å†…ä½¿ç”¨ Composition API çš„å…¥å£ç‚¹ æ³¨æ„ setup è¿”å›çš„ ref åœ¨æ¨¡æ¿ä¸­ä¼šè‡ªåŠ¨è§£å¼€ï¼Œä¸éœ€è¦å†™ .valueã€setup å†…éƒ¨éœ€è¦.valueã€‘ è°ƒç”¨æ—¶æœº åˆ›å»ºç»„ä»¶å®ä¾‹ï¼Œç„¶ååˆå§‹åŒ– props ï¼Œç´§æ¥ç€å°±è°ƒç”¨setup å‡½æ•°ã€‚ä»ç”Ÿå‘½å‘¨æœŸé’©å­çš„è§†è§’æ¥çœ‹ï¼Œå®ƒä¼šåœ¨ beforeCreate é’©å­ä¹‹å‰è¢«è°ƒç”¨ å¦‚æœ setup è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™å¯¹è±¡çš„å±æ€§å°†ä¼šè¢«åˆå¹¶åˆ°ç»„ä»¶æ¨¡æ¿çš„æ¸²æŸ“ä¸Šä¸‹æ–‡ å‚æ•° props ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå‚æ•° æ³¨æ„ props å¯¹è±¡æ˜¯å“åº”å¼çš„ï¼ŒwatchEffect æˆ– watch ä¼šè§‚å¯Ÿå’Œå“åº” props çš„æ›´æ–° ä¸è¦è§£æ„ props å¯¹è±¡ï¼Œé‚£æ ·ä¼šä½¿å…¶å¤±å»å“åº”æ€§ 1234567891011export default &#123; props: &#123; name: String, &#125;, setup(props) &#123; console.log(props.name) watchEffect(() =&gt; &#123; console.log(`name is: ` + props.name) &#125;) &#125;,&#125; ç¬¬äºŒä¸ªå‚æ•°æä¾›äº†ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ã€ä»åŸæ¥ 2.x ä¸­ this é€‰æ‹©æ€§åœ°æš´éœ²äº†ä¸€äº› propertyï¼ˆattrs/emit/slotsï¼‰ã€‘ attrs å’Œ slots éƒ½æ˜¯å†…éƒ¨ç»„ä»¶å®ä¾‹ä¸Šå¯¹åº”é¡¹çš„ä»£ç†ï¼Œå¯ä»¥ç¡®ä¿åœ¨æ›´æ–°åä»ç„¶æ˜¯æœ€æ–°å€¼ã€‚æ‰€ä»¥å¯ä»¥è§£æ„ï¼Œæ— éœ€æ‹…å¿ƒåé¢è®¿é—®åˆ°è¿‡æœŸçš„å€¼ ä¸ºä»€ä¹ˆpropsä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Ÿ ç»„ä»¶ä½¿ç”¨ props çš„åœºæ™¯æ›´å¤šï¼Œæœ‰æ—¶å€™ç”šè‡³åªä½¿ç”¨ props å°† props ç‹¬ç«‹å‡ºæ¥ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥è®© TypeScript å¯¹ props å•ç‹¬åšç±»å‹æ¨å¯¼ï¼Œä¸ä¼šå’Œä¸Šä¸‹æ–‡ä¸­çš„å…¶ä»–å±æ€§ç›¸æ··æ·†ã€‚è¿™ä¹Ÿä½¿å¾— setup ã€ render å’Œå…¶ä»–ä½¿ç”¨äº† TSX çš„å‡½æ•°å¼ç»„ä»¶çš„ç­¾åä¿æŒä¸€è‡´ this åœ¨ setup() ä¸­ä¸å¯ç”¨ã€‚ç”±äº setup() åœ¨è§£æ 2.x é€‰é¡¹å‰è¢«è°ƒç”¨ï¼Œsetup() ä¸­çš„ this å°†ä¸ 2.x é€‰é¡¹ä¸­çš„ this å®Œå…¨ä¸åŒã€‚åŒæ—¶åœ¨ setup() å’Œ 2.x é€‰é¡¹ä¸­ä½¿ç”¨ this æ—¶å°†é€ æˆæ··ä¹± 123456setup(props, &#123; attrs &#125;) &#123; // ä¸€ä¸ªå¯èƒ½ä¹‹åå›è°ƒç”¨çš„ç­¾å function onClick() &#123; console.log(attrs.foo) // ä¸€å®šæ˜¯æœ€æ–°çš„å¼•ç”¨ï¼Œæ²¡æœ‰ä¸¢å¤±å“åº”æ€§ &#125; &#125;","tags":["Vue","Vite"]},{"title":"è¿›ç¨‹é€šä¿¡(electron/node)","path":"/2022/03/26/è¿›ç¨‹é€šä¿¡-electron-node/","content":"è¿›ç¨‹é€šä¿¡ä¸åŒè¿›ç¨‹ä¹‹é—´å› ä¸ºå¯ç”¨çš„å†…å­˜ä¸åŒï¼Œæ‰€ä»¥è¦é€šè¿‡ä¸€ä¸ªä¸­é—´ä»‹è´¨é€šä¿¡ã€‚ ä¿¡å·é‡ å¦‚æœæ˜¯ç®€å•çš„æ ‡è®°ï¼Œé€šè¿‡ä¸€ä¸ªæ•°å­—æ¥è¡¨ç¤ºï¼Œæ”¾åœ¨ PCB çš„ä¸€ä¸ªå±æ€§é‡Œï¼Œè¿™å«åšä¿¡å·é‡ï¼Œæ¯”å¦‚é”çš„å®ç°å°±å¯ä»¥é€šè¿‡ä¿¡å·é‡ã€‚ è¿™ç§ä¿¡å·é‡çš„æ€æƒ³æˆ‘ä»¬å†™å‰ç«¯ä»£ç ä¹Ÿç»å¸¸ç”¨ï¼Œæ¯”å¦‚å®ç°èŠ‚æµçš„æ—¶å€™ï¼Œä¹Ÿè¦åŠ ä¸€ä¸ªæ ‡è®°å˜é‡ã€‚ ç®¡é“ ä½†æ˜¯ä¿¡å·é‡ä¸èƒ½ä¼ é€’å…·ä½“çš„æ•°æ®å•Šï¼Œä¼ é€’å…·ä½“æ•°æ®è¿˜å¾—ç”¨åˆ«çš„æ–¹å¼ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¯»å†™æ–‡ä»¶çš„æ–¹å¼æ¥é€šä¿¡ï¼Œè¿™å°±æ˜¯ç®¡é“ï¼Œå¦‚æœæ˜¯åœ¨å†…å­˜ä¸­çš„æ–‡ä»¶ï¼Œå«åšåŒ¿åç®¡é“ï¼Œæ²¡æœ‰æ–‡ä»¶åï¼Œå¦‚æœæ˜¯çœŸå®çš„ç¡¬ç›˜çš„æ–‡ä»¶ï¼Œæ˜¯æœ‰æ–‡ä»¶åçš„ï¼Œå«åšå‘½åç®¡é“ã€‚ æ–‡ä»¶éœ€è¦å…ˆæ‰“å¼€ï¼Œç„¶åå†è¯»å’Œå†™ï¼Œä¹‹åå†å…³é—­ï¼Œè¿™ä¹Ÿæ˜¯ç®¡é“çš„ç‰¹ç‚¹ã€‚ç®¡é“æ˜¯åŸºäºæ–‡ä»¶çš„æ€æƒ³å°è£…çš„ï¼Œä¹‹æ‰€ä»¥å«ç®¡é“ï¼Œæ˜¯å› ä¸ºåªèƒ½ä¸€ä¸ªè¿›ç¨‹è¯»ã€ä¸€ä¸ªè¿›ç¨‹å†™ï¼Œæ˜¯å•å‘çš„ï¼ˆåŠåŒå·¥ï¼‰ã€‚è€Œä¸”è¿˜éœ€è¦ç›®æ ‡è¿›ç¨‹åŒæ­¥çš„æ¶ˆè´¹æ•°æ®ï¼Œä¸ç„¶å°±ä¼šé˜»å¡ä½ã€‚ è¿™ç§ç®¡é“çš„æ–¹å¼å®ç°èµ·æ¥å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶è¯»å†™ï¼Œä½†æ˜¯åªèƒ½ç”¨åœ¨ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´é€šä¿¡ï¼Œåªèƒ½åŒæ­¥çš„é€šä¿¡ã€‚å…¶å®ç®¡é“çš„åŒæ­¥é€šä¿¡ä¹ŸæŒºå¸¸è§çš„ï¼Œå°±æ˜¯ stream çš„ pipe æ–¹æ³•ã€‚ æ¶ˆæ¯é˜Ÿåˆ— ç®¡é“å®ç°ç®€å•ï¼Œä½†æ˜¯åŒæ­¥çš„é€šä¿¡æ¯”è¾ƒå—é™åˆ¶ï¼Œé‚£å¦‚æœæƒ³åšæˆå¼‚æ­¥é€šä¿¡å‘¢ï¼ŸåŠ ä¸ªé˜Ÿåˆ—åšç¼“å†²ï¼ˆbufferï¼‰ä¸å°±è¡Œäº†ï¼Œè¿™å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ã€‚ æ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿæ˜¯ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œä½†æ˜¯ä¸æ˜¯åŸºäºæ–‡ä»¶é‚£ä¸€å¥—æ€è·¯ï¼Œè™½ç„¶ä¹Ÿæ˜¯å•å‘çš„ï¼Œä½†æ˜¯æœ‰äº†ä¸€å®šçš„å¼‚æ­¥æ€§ï¼Œå¯ä»¥æ”¾å¾ˆå¤šæ¶ˆæ¯ï¼Œä¹‹åä¸€æ¬¡æ€§æ¶ˆè´¹ã€‚ å…±äº«å†…å­˜ ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—éƒ½æ˜¯ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„ï¼Œå¦‚æœå¤šä¸ªè¿›ç¨‹ä¹‹é—´å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥é€šè¿‡ç”³è¯·ä¸€æ®µå¤šè¿›ç¨‹éƒ½å¯ä»¥æ“ä½œçš„å†…å­˜ï¼Œå«åšå…±äº«å†…å­˜ï¼Œç”¨è¿™ç§æ–¹å¼æ¥é€šä¿¡ã€‚å„è¿›ç¨‹éƒ½å¯ä»¥å‘è¯¥å†…å­˜è¯»å†™æ•°æ®ï¼Œæ•ˆç‡æ¯”è¾ƒé«˜ã€‚ å…±äº«å†…å­˜è™½ç„¶æ•ˆç‡é«˜ã€ä¹Ÿèƒ½ç”¨äºå¤šä¸ªè¿›ç¨‹çš„é€šä¿¡ï¼Œä½†ä¹Ÿä¸å…¨æ˜¯å¥½å¤„ï¼Œå› ä¸ºå¤šä¸ªè¿›ç¨‹éƒ½å¯ä»¥è¯»å†™ï¼Œé‚£ä¹ˆå°±å¾ˆå®¹æ˜“ä¹±ï¼Œè¦è‡ªå·±æ§åˆ¶é¡ºåºï¼Œæ¯”å¦‚é€šè¿‡è¿›ç¨‹çš„ä¿¡å·é‡ï¼ˆæ ‡è®°å˜é‡ï¼‰æ¥æ§åˆ¶ã€‚ å…±äº«å†…å­˜é€‚ç”¨äºå¤šä¸ªè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œä¸éœ€è¦é€šè¿‡ä¸­é—´ä»‹è´¨ï¼Œæ‰€ä»¥æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥ä¹Ÿæ›´å¤æ‚ã€‚ ä¸Šé¢è¯´çš„è¿™äº›å‡ ä¹å°±æ˜¯æœ¬åœ°è¿›ç¨‹é€šä¿¡çš„å…¨éƒ¨æ–¹å¼äº†ï¼Œä¸ºä»€ä¹ˆè¦åŠ ä¸ªæœ¬åœ°å‘¢ï¼Ÿ ipcã€rpcã€lpcè¿›ç¨‹é€šä¿¡å°±æ˜¯ ipcï¼ˆInter-Process Communicationï¼‰ï¼Œä¸¤ä¸ªè¿›ç¨‹å¯èƒ½æ˜¯ä¸€å°è®¡ç®—æœºçš„ï¼Œä¹Ÿå¯èƒ½ç½‘ç»œä¸Šçš„ä¸åŒè®¡ç®—æœºçš„è¿›ç¨‹ï¼Œæ‰€ä»¥è¿›ç¨‹é€šä¿¡æ–¹å¼åˆ†ä¸ºä¸¤ç§ï¼š æœ¬åœ°è¿‡ç¨‹è°ƒç”¨ LPCï¼ˆlocal procedure callï¼‰ã€è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ RPCï¼ˆremote procedure callï¼‰ã€‚ æœ¬åœ°è¿‡ç¨‹è°ƒç”¨å°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„ä¿¡å·é‡ã€ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜çš„é€šä¿¡æ–¹å¼ï¼Œä½†æ˜¯å¦‚æœæ˜¯ç½‘ç»œä¸Šçš„ï¼Œé‚£å°±è¦é€šè¿‡ç½‘ç»œåè®®æ¥é€šä¿¡äº†ï¼Œè¿™ä¸ªå…¶å®æˆ‘ä»¬ç”¨çš„æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚ httpã€websocketã€‚ æ‰€ä»¥ï¼Œå½“æœ‰äººæåˆ° ipc æ—¶å°±æ˜¯åœ¨è¯´è¿›ç¨‹é€šä¿¡ï¼Œå¯ä»¥åˆ†ä¸ºæœ¬åœ°çš„å’Œè¿œç¨‹çš„ä¸¤ç§æ¥è®¨è®ºã€‚ è¿œç¨‹çš„éƒ½æ˜¯åŸºäºç½‘ç»œåè®®å°è£…çš„ï¼Œè€Œæœ¬åœ°çš„éƒ½æ˜¯åŸºäºä¿¡å·é‡ã€ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜å°è£…å‡ºæ¥çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬æ¥ä¸‹æ¥è¦æ¢è®¨çš„ electron å’Œ nodejsã€‚ electron è¿›ç¨‹é€šä¿¡electron ä¼šå…ˆå¯åŠ¨ä¸»è¿›ç¨‹ï¼Œç„¶åé€šè¿‡ BrowserWindow åˆ›å»ºæ¸²æŸ“è¿›ç¨‹ï¼ŒåŠ è½½ html é¡µé¢å®ç°æ¸²æŸ“ã€‚è¿™ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ˜¯é€šè¿‡ electron æä¾›çš„ ipc çš„ apiã€‚ ipcMainã€ipcRenderer ä¸»è¿›ç¨‹é‡Œé¢é€šè¿‡ ipcMain çš„ on æ–¹æ³•ç›‘å¬äº‹ä»¶ 1import &#123; ipcMain &#125; from ``&#x27;electron&#x27;``;` `ipcMain.on(``&#x27;å¼‚æ­¥äº‹ä»¶&#x27;``, (event, arg) =&gt; &#123;`` ``event.sender.send(``&#x27;å¼‚æ­¥äº‹ä»¶è¿”å›&#x27;``, ``&#x27;yyy&#x27;``);``&#125;) æ¸²æŸ“è¿›ç¨‹é‡Œé¢é€šè¿‡ ipcRenderer çš„ on æ–¹æ³•ç›‘å¬äº‹ä»¶ï¼Œé€šè¿‡ send å‘é€æ¶ˆæ¯ 1import &#123; ipcRenderer &#125; from ``&#x27;electron&#x27;``;` `ipcRender.on(``&#x27;å¼‚æ­¥äº‹ä»¶è¿”å›&#x27;``, ``function` `(event, arg) &#123;`` ``const message = `å¼‚æ­¥æ¶ˆæ¯: $&#123;arg&#125;```&#125;)` `ipcRenderer.send(``&#x27;å¼‚æ­¥äº‹ä»¶&#x27;``, ``&#x27;xxx&#x27;``) api ä½¿ç”¨æ¯”è¾ƒç®€å•ï¼Œè¿™æ˜¯ç»è¿‡ c++ å±‚çš„å°è£…ï¼Œç„¶åæš´éœ²ç»™ js çš„äº‹ä»¶å½¢å¼çš„ apiã€‚ æˆ‘ä»¬å¯ä»¥æƒ³ä¸€ä¸‹å®ƒæ˜¯åŸºäºå“ªç§æœºåˆ¶å®ç°çš„å‘¢ï¼Ÿ å¾ˆæ˜æ˜¾æœ‰ä¸€å®šçš„å¼‚æ­¥æ€§ï¼Œè€Œä¸”æ˜¯çˆ¶å­è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œæ‰€ä»¥æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼å®ç°çš„ã€‚ remote é™¤äº†äº‹ä»¶å½¢å¼çš„ api å¤–ï¼Œelectron è¿˜æä¾›äº†è¿œç¨‹æ–¹æ³•è°ƒç”¨ rmi ï¼ˆremote method invokeï¼‰å½¢å¼çš„ apiã€‚ å…¶å®å°±æ˜¯å¯¹æ¶ˆæ¯çš„è¿›ä¸€æ­¥å°è£…ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®ä¼ é€’çš„æ¶ˆæ¯ï¼Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•ï¼Œå½¢å¼ä¸Šå°±åƒè°ƒç”¨æœ¬è¿›ç¨‹çš„æ–¹æ³•ä¸€æ ·ï¼Œä½†å…¶å®æ˜¯å‘æ¶ˆæ¯åˆ°å¦ä¸€ä¸ªè¿›ç¨‹æ¥åšçš„ï¼Œå’Œ ipcMainã€ipcRenderer çš„å½¢å¼æœ¬è´¨ä¸Šä¸€æ ·ã€‚ æ¯”å¦‚åœ¨æ¸²æŸ“è¿›ç¨‹é‡Œé¢ï¼Œé€šè¿‡ remote æ¥ç›´æ¥è°ƒç”¨ä¸»è¿›ç¨‹æ‰æœ‰çš„ BrowserWindow çš„ apiã€‚ 1const &#123; BrowserWindow &#125; = require(``&#x27;electron&#x27;``).remote;` `let win = ``new` `BrowserWindow(&#123; width: 800, height: 600 &#125;);``win.loadURL(``&#x27;&#x27;``); å°ç»“ä¸€ä¸‹ï¼Œelectron çš„çˆ¶å­è¿›ç¨‹é€šä¿¡æ–¹å¼æ˜¯åŸºäºæ¶ˆæ¯é˜Ÿåˆ—å°è£…çš„ï¼Œå°è£…å½¢å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯äº‹ä»¶çš„æ–¹å¼ï¼Œé€šè¿‡ ipcMainã€ipcRenderer çš„ api ä½¿ç”¨ï¼Œå¦ä¸€ç§åˆ™æ˜¯è¿›ä¸€æ­¥å°è£…æˆäº†ä¸åŒæ–¹æ³•çš„è°ƒç”¨ï¼ˆrmiï¼‰ï¼Œåº•å±‚ä¹Ÿæ˜¯åŸºäºæ¶ˆæ¯ï¼Œæ‰§è¡Œè¿œç¨‹æ–¹æ³•ä½†æ˜¯çœ‹ä¸Šå»åƒæ‰§è¡Œæœ¬åœ°æ–¹æ³•ä¸€æ ·ã€‚ nodejsnodejs æä¾›äº†åˆ›å»ºè¿›ç¨‹çš„ apiï¼Œæœ‰ä¸¤ä¸ªæ¨¡å—ï¼š c å’Œ clusterã€‚å¾ˆæ˜æ˜¾ï¼Œä¸€ä¸ªæ˜¯ç”¨äºçˆ¶å­è¿›ç¨‹çš„åˆ›å»ºå’Œé€šä¿¡ï¼Œä¸€ä¸ªæ˜¯ç”¨äºå¤šä¸ªè¿›ç¨‹ã€‚ child_process child_process æä¾›äº† spawnã€execã€execFileã€fork çš„ apiï¼Œåˆ†åˆ«ç”¨äºä¸åŒçš„è¿›ç¨‹çš„åˆ›å»ºï¼š spawnã€exec å¦‚æœæƒ³é€šè¿‡ shell æ‰§è¡Œå‘½ä»¤ï¼Œé‚£å°±ç”¨ spawn æˆ–è€… execã€‚å› ä¸ºä¸€èˆ¬æ‰§è¡Œå‘½ä»¤æ˜¯éœ€è¦è¿”å›å€¼çš„ï¼Œè¿™ä¿© api åœ¨è¿”å›å€¼çš„æ–¹å¼ä¸Šæœ‰æ‰€ä¸åŒã€‚ spawn è¿”å›çš„æ˜¯ streamï¼Œé€šè¿‡ data äº‹ä»¶æ¥å–ï¼Œexec è¿›ä¸€æ­¥åˆ†è£…æˆäº† bufferï¼Œä½¿ç”¨èµ·æ¥ç®€å•ä¸€äº›ï¼Œä½†æ˜¯å¯èƒ½ä¼šè¶…è¿‡ maxBufferã€‚ 1const &#123; spawn &#125; = require(``&#x27;child_process&#x27;``);` `var` `app = spawn(``&#x27;node&#x27;``,``&#x27;main.js&#x27;` `&#123;env:&#123;&#125;&#125;);` `app.stderr.on(``&#x27;data&#x27;``,``function``(data) &#123;`` ``console.log(``&#x27;Error:&#x27;``,data);``&#125;);` `app.stdout.on(``&#x27;data&#x27;``,``function``(data) &#123;`` ``console.log(data);``&#125;); å…¶å® exec æ˜¯åŸºäº spwan å°è£…å‡ºæ¥çš„ï¼Œç®€å•åœºæ™¯å¯ä»¥ç”¨ï¼Œæœ‰çš„æ—¶å€™è¦è®¾ç½®ä¸‹ maxBufferã€‚ 1const &#123; exec &#125; = require(``&#x27;child_process&#x27;``);` `exec(``&#x27;find . -type f&#x27;``, &#123; maxBuffer: 1024*1024 &#125;(err, stdout, stderr) =&gt; &#123;`` ``if` `(err) &#123;`` ``console.error(`exec error: $&#123;err&#125;`); ``return``;`` ``&#125; `` ``console.log(stdout);``&#125;); execFile é™¤äº†æ‰§è¡Œå‘½ä»¤å¤–ï¼Œå¦‚æœè¦æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶å°±ç”¨ execFile çš„ apiï¼š 1const &#123; execFile &#125; = require(``&#x27;child_process&#x27;``);` `const child = execFile(``&#x27;node&#x27;``, [``&#x27;--version&#x27;``], (error, stdout, stderr) =&gt; &#123;`` ``if` `(error) &#123; ``throw` `error; &#125;`` ``console.log(stdout);``&#125;); fork è¿˜æœ‰å¦‚æœæ˜¯æƒ³æ‰§è¡Œ js ï¼Œé‚£å°±ç”¨ forkï¼š 1const &#123; fork &#125; = require(``&#x27;child_process&#x27;``); ` `const xxxProcess = fork(``&#x27;./xxx.js&#x27;``); ``xxxProcess.send(``&#x27;111111&#x27;``); ``xxxProcess.on(``&#x27;message&#x27;``, sum =&gt; &#123; `` ``res.end(``&#x27;22222&#x27;``); ``&#125;); å°ç»“ ç®€å•å°ç»“ä¸€ä¸‹ child_process çš„ 4 ä¸ª apiï¼š å¦‚æœæƒ³æ‰§è¡Œ shell å‘½ä»¤ï¼Œç”¨ spawn å’Œ execï¼Œspawn è¿”å›ä¸€ä¸ª streamï¼Œè€Œ exec è¿›ä¸€æ­¥å°è£…æˆäº† bufferã€‚é™¤äº† exec æœ‰çš„æ—¶å€™éœ€è¦è®¾ç½®ä¸‹ maxBufferï¼Œå…¶ä»–æ²¡åŒºåˆ«ã€‚ å¦‚æœæƒ³æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç”¨ execFileã€‚ å¦‚æœæƒ³æ‰§è¡Œ js æ–‡ä»¶ï¼Œç”¨ forkã€‚ child_process çš„è¿›ç¨‹é€šä¿¡ è¯´å®Œäº† api æˆ‘ä»¬æ¥è¯´ä¸‹ child_process åˆ›å»ºçš„å­è¿›ç¨‹æ€ä¹ˆå’Œçˆ¶è¿›ç¨‹é€šä¿¡ï¼Œä¹Ÿå°±æ˜¯æ€ä¹ˆåš ipcã€‚ pipe é¦–å…ˆï¼Œæ”¯æŒäº† pipeï¼Œå¾ˆæ˜æ˜¾æ˜¯é€šè¿‡ç®¡é“çš„æœºåˆ¶å°è£…å‡ºæ¥çš„ï¼Œèƒ½åŒæ­¥çš„ä¼ è¾“æµçš„æ•°æ®ã€‚ 1234const &#123; spawn &#125; = require(&#x27;child_process&#x27;);const find = spawn(&#x27;cat&#x27;, [&#x27;./aaa.js&#x27;]);const wc = spawn(&#x27;wc&#x27;, [&#x27;-l&#x27;]); find.stdout.pipe(wc.stdin); æ¯”å¦‚ä¸Šé¢é€šè¿‡ç®¡é“æŠŠä¸€ä¸ªè¿›ç¨‹çš„è¾“å‡ºæµä¼ è¾“åˆ°äº†å¦ä¸€ä¸ªè¿›ç¨‹çš„è¾“å…¥æµï¼Œå’Œä¸‹é¢çš„ shell å‘½ä»¤æ•ˆæœä¸€æ ·ï¼š 1cat ./aaa.js | wc -l message spawn æ”¯æŒ stdio å‚æ•°ï¼Œå¯ä»¥è®¾ç½®å’Œçˆ¶è¿›ç¨‹çš„ stdinã€stdoutã€stderr çš„å…³ç³»ï¼Œæ¯”å¦‚æŒ‡å®š pipe æˆ–è€… nullã€‚è¿˜æœ‰ç¬¬å››ä¸ªå‚æ•°ï¼Œå¯ä»¥è®¾ç½® ipcï¼Œè¿™æ—¶å€™å°±æ˜¯é€šè¿‡äº‹ä»¶çš„æ–¹å¼ä¼ é€’æ¶ˆæ¯äº†ï¼Œå¾ˆæ˜sæ˜¾ï¼Œæ˜¯åŸºäºæ¶ˆæ¯é˜Ÿåˆ—å®ç°çš„ã€‚ 1234const &#123; spawn &#125; = require(&#x27;child_process&#x27;);const child = spawn(&#x27;node&#x27;, [&#x27;./child.js&#x27;], &#123; stdio: [&#x27;pipe&#x27;, &#x27;pipe&#x27;, &#x27;pipe&#x27;, &#x27;ipc&#x27;]&#125;);child.on(&#x27;message&#x27;, (m) =&gt; &#123; console.log(m);&#125;);child.send(&#x27;this is weng&#x27;); è€Œ fork çš„ api åˆ›å»ºçš„å­è¿›ç¨‹è‡ªå¸¦äº† ipc çš„ä¼ é€’æ¶ˆæ¯æœºåˆ¶ï¼Œå¯ä»¥ç›´æ¥ç”¨ã€‚ 1const &#123; fork &#125; = require(``&#x27;child_process&#x27;``); ` `const xxxProcess = fork(``&#x27;./xxx.js&#x27;``); ``xxxProcess.send(``&#x27;111111&#x27;``); ``xxxProcess.on(``&#x27;message&#x27;``, sum =&gt; &#123; `` ``res.end(``&#x27;22222&#x27;``); ``&#125;); cluster cluster ä¸å†æ˜¯çˆ¶å­è¿›ç¨‹äº†ï¼Œè€Œæ˜¯æ›´å¤šè¿›ç¨‹ï¼Œä¹Ÿæä¾›äº† fork çš„ apiã€‚ æ¯”å¦‚ http server ä¼šæ ¹æ® cpu æ•°å¯åŠ¨å¤šä¸ªè¿›ç¨‹æ¥å¤„ç†è¯·æ±‚ã€‚ 1import cluster from ``&#x27;cluster&#x27;``;``import http from ``&#x27;http&#x27;``;``import &#123; cpus &#125; from ``&#x27;os&#x27;``;``import process from ``&#x27;process&#x27;``;` `const numCPUs = cpus().length;` `if` `(cluster.isPrimary) &#123;`` ``for` `(let i = 0; i &lt; numCPUs; i++) &#123;`` ``cluster.fork();`` ``&#125;``&#125; ``else` `&#123;`` ``const server = http.createServer((req, res) =&gt; &#123;`` ``res.writeHead(200);`` ``res.end(``&#x27;hello worldn&#x27;``);`` ``&#125;)`` ` ` ``server.listen(8000);`` ` ` ``process.on(``&#x27;message&#x27;``, (msg) =&gt; &#123;`` ``if` `(msg === ``&#x27;shutdown&#x27;``) &#123;`` ``server.close();`` ``&#125;`` ``&#125;);``&#125; å®ƒåŒæ ·æ”¯æŒäº†äº‹ä»¶å½¢å¼çš„ apiï¼Œç”¨äºå¤šä¸ªè¿›ç¨‹ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’ï¼Œå› ä¸ºå¤šä¸ªè¿›ç¨‹å…¶å®ä¹Ÿåªæ˜¯å¤šä¸ªçˆ¶å­è¿›ç¨‹çš„é€šä¿¡ï¼Œå­è¿›ç¨‹ä¹‹é—´ä¸èƒ½ç›´æ¥é€šä¿¡ï¼Œæ‰€ä»¥è¿˜æ˜¯åŸºäºæ¶ˆæ¯é˜Ÿåˆ—å®ç°çš„ã€‚ å…±äº«å†…å­˜ å­è¿›ç¨‹ä¹‹é—´é€šä¿¡è¿˜å¾—é€šè¿‡çˆ¶è¿›ç¨‹ä¸­è½¬ä¸€æ¬¡ï¼Œè¦å¤šæ¬¡è¯»å†™æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ•ˆç‡å¤ªä½äº†ï¼Œå°±ä¸èƒ½ç›´æ¥å…±äº«å†…å­˜ä¹ˆï¼Ÿ ç°åœ¨ nodejs è¿˜æ˜¯ä¸æ”¯æŒçš„ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹çš„åŒ… shm-typed-array æ¥å®ç°ï¼Œæ„Ÿå…´è¶£å¯ä»¥çœ‹ä¸€ä¸‹ã€‚ æ€»ç»“è¿›ç¨‹åŒ…æ‹¬ä»£ç ã€æ•°æ®å’Œ PCBï¼Œæ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œçš„è¿‡ç¨‹ï¼ŒPCB è®°å½•ç€å„ç§æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¿¡æ¯ï¼Œæ¯”å¦‚åˆ†é…çš„èµ„æºã€æ‰§è¡Œåˆ°çš„åœ°å€ã€ç”¨äºé€šä¿¡çš„æ•°æ®ç»“æ„ç­‰ã€‚ è¿›ç¨‹ä¹‹é—´éœ€è¦é€šä¿¡ï¼Œå¯ä»¥é€šè¿‡ä¿¡å·é‡ã€ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜çš„æ–¹å¼ã€‚ ä¿¡å·é‡å°±æ˜¯ä¸€ä¸ªç®€å•çš„æ•°å­—çš„æ ‡è®°ï¼Œä¸èƒ½ä¼ é€’å…·ä½“æ•°æ®ã€‚ ç®¡é“æ˜¯åŸºäºæ–‡ä»¶çš„æ€æƒ³ï¼Œä¸€ä¸ªè¿›ç¨‹å†™å¦ä¸€ä¸ªè¿›ç¨‹è¯»ï¼Œæ˜¯åŒæ­¥çš„ï¼Œé€‚ç”¨äºä¸¤ä¸ªè¿›ç¨‹ã€‚ æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä¸€å®šçš„ bufferï¼Œå¯ä»¥å¼‚æ­¥å¤„ç†æ¶ˆæ¯ï¼Œé€‚ç”¨äºä¸¤ä¸ªè¿›ç¨‹ã€‚ å…±äº«å†…å­˜æ˜¯å¤šä¸ªè¿›ç¨‹ç›´æ¥æ“ä½œåŒä¸€æ®µå†…å­˜ï¼Œé€‚ç”¨äºå¤šä¸ªè¿›ç¨‹ï¼Œä½†æ˜¯éœ€è¦æ§åˆ¶è®¿é—®é¡ºåºã€‚ è¿™å››ç§æ˜¯æœ¬åœ°è¿›ç¨‹çš„é€šä¿¡æ–¹å¼ï¼Œè€Œç½‘ç»œè¿›ç¨‹åˆ™åŸºäºç½‘ç»œåè®®çš„æ–¹å¼ä¹Ÿå¯ä»¥åšè¿›ç¨‹é€šä¿¡ã€‚ è¿›ç¨‹é€šä¿¡å«åš ipcï¼Œæœ¬åœ°çš„å«åš lpcï¼Œè¿œç¨‹çš„å« rpcã€‚ å…¶ä¸­ï¼Œå¦‚æœæŠŠæ¶ˆæ¯å†å°è£…ä¸€å±‚æˆå…·ä½“çš„æ–¹æ³•è°ƒç”¨ï¼Œå«åš rmiï¼Œæ•ˆæœå°±åƒåœ¨æœ¬è¿›ç¨‹æ‰§è¡Œæ‰§è¡Œå¦ä¸€ä¸ªè¿›ç¨‹çš„æ–¹æ³•ä¸€æ ·ã€‚ electron å’Œ nodejs éƒ½æ˜¯åŸºäºä¸Šé¢çš„æ“ä½œç³»ç»Ÿæœºåˆ¶çš„å°è£…ï¼š elctron æ”¯æŒ ipcMain å’Œ ipcRenderer çš„æ¶ˆæ¯ä¼ é€’çš„æ–¹å¼ï¼Œè¿˜æ”¯æŒäº† remote çš„ rmi çš„æ–¹å¼ã€‚ nodejs æœ‰ child_process å’Œ cluster ä¸¤ä¸ªæ¨¡å—å’Œè¿›ç¨‹æœ‰å…³ï¼Œchild_process æ˜¯çˆ¶å­è¿›ç¨‹ä¹‹é—´ï¼Œcluster æ˜¯å¤šä¸ªè¿›ç¨‹ï¼š child_process æä¾›äº†ç”¨äºæ‰§è¡Œ shell å‘½ä»¤çš„ spawnã€execï¼Œç”¨äºæ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶çš„ execFileï¼Œç”¨äºæ‰§è¡Œ js çš„ forkã€‚æä¾›äº† pipe å’Œ message ä¸¤ç§ ipc æ–¹å¼ã€‚ cluster ä¹Ÿæä¾›äº† forkï¼Œæä¾›äº† message çš„æ–¹å¼çš„é€šä¿¡ã€‚ å½“ç„¶ï¼Œä¸ç®¡å°è£…å½¢å¼æ˜¯ä»€ä¹ˆï¼Œéƒ½ç¦»ä¸å¼€æ“ä½œç³»ç»Ÿæä¾›çš„ä¿¡å·é‡ã€ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜è¿™å››ç§æœºåˆ¶ã€‚","tags":["Electron","Nodejs"]},{"title":"eslint ruleså¸¸ç”¨é…ç½®é¡¹","path":"/2022/02/27/eslint-ruleså¸¸ç”¨é…ç½®é¡¹/","content":"123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176&#123;&quot;no-alert&quot;: 0,//ç¦æ­¢ä½¿ç”¨alert confirm prompt&quot;no-array-constructor&quot;: 2,//ç¦æ­¢ä½¿ç”¨æ•°ç»„æ„é€ å™¨&quot;no-bitwise&quot;: 0,//ç¦æ­¢ä½¿ç”¨æŒ‰ä½è¿ç®—ç¬¦&quot;no-caller&quot;: 1,//ç¦æ­¢ä½¿ç”¨arguments.calleræˆ–arguments.callee&quot;no-catch-shadow&quot;: 2,//ç¦æ­¢catchå­å¥å‚æ•°ä¸å¤–éƒ¨ä½œç”¨åŸŸå˜é‡åŒå&quot;no-class-assign&quot;: 2,//ç¦æ­¢ç»™ç±»èµ‹å€¼&quot;no-cond-assign&quot;: 2,//ç¦æ­¢åœ¨æ¡ä»¶è¡¨è¾¾å¼ä¸­ä½¿ç”¨èµ‹å€¼è¯­å¥&quot;no-console&quot;: 2,//ç¦æ­¢ä½¿ç”¨console&quot;no-const-assign&quot;: 2,//ç¦æ­¢ä¿®æ”¹constå£°æ˜çš„å˜é‡&quot;no-constant-condition&quot;: 2,//ç¦æ­¢åœ¨æ¡ä»¶ä¸­ä½¿ç”¨å¸¸é‡è¡¨è¾¾å¼ if(true) if(1)&quot;no-continue&quot;: 0,//ç¦æ­¢ä½¿ç”¨continue&quot;no-control-regex&quot;: 2,//ç¦æ­¢åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨æ§åˆ¶å­—ç¬¦&quot;no-debugger&quot;: 2,//ç¦æ­¢ä½¿ç”¨debugger&quot;no-delete-var&quot;: 2,//ä¸èƒ½å¯¹varå£°æ˜çš„å˜é‡ä½¿ç”¨deleteæ“ä½œç¬¦&quot;no-div-regex&quot;: 1,//ä¸èƒ½ä½¿ç”¨çœ‹èµ·æ¥åƒé™¤æ³•çš„æ­£åˆ™è¡¨è¾¾å¼/=foo/&quot;no-dupe-keys&quot;: 2,//åœ¨åˆ›å»ºå¯¹è±¡å­—é¢é‡æ—¶ä¸å…è®¸é”®é‡å¤ &#123;a:1,a:1&#125;&quot;no-dupe-args&quot;: 2,//å‡½æ•°å‚æ•°ä¸èƒ½é‡å¤&quot;no-duplicate-case&quot;: 2,//switchä¸­çš„caseæ ‡ç­¾ä¸èƒ½é‡å¤&quot;no-else-return&quot;: 2,//å¦‚æœifè¯­å¥é‡Œé¢æœ‰return,åé¢ä¸èƒ½è·Ÿelseè¯­å¥&quot;no-empty&quot;: 2,//å—è¯­å¥ä¸­çš„å†…å®¹ä¸èƒ½ä¸ºç©º&quot;no-empty-character-class&quot;: 2,//æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„[]å†…å®¹ä¸èƒ½ä¸ºç©º&quot;no-empty-label&quot;: 2,//ç¦æ­¢ä½¿ç”¨ç©ºlabel&quot;no-eq-null&quot;: 2,//ç¦æ­¢å¯¹nullä½¿ç”¨==æˆ–!=è¿ç®—ç¬¦&quot;no-eval&quot;: 1,//ç¦æ­¢ä½¿ç”¨eval&quot;no-ex-assign&quot;: 2,//ç¦æ­¢ç»™catchè¯­å¥ä¸­çš„å¼‚å¸¸å‚æ•°èµ‹å€¼&quot;no-extend-native&quot;: 2,//ç¦æ­¢æ‰©å±•nativeå¯¹è±¡&quot;no-extra-bind&quot;: 2,//ç¦æ­¢ä¸å¿…è¦çš„å‡½æ•°ç»‘å®š&quot;no-extra-boolean-cast&quot;: 2,//ç¦æ­¢ä¸å¿…è¦çš„boolè½¬æ¢&quot;no-extra-parens&quot;: 2,//ç¦æ­¢éå¿…è¦çš„æ‹¬å·&quot;no-extra-semi&quot;: 2,//ç¦æ­¢å¤šä½™çš„å†’å·&quot;no-fallthrough&quot;: 1,//ç¦æ­¢switchç©¿é€&quot;no-floating-decimal&quot;: 2,//ç¦æ­¢çœç•¥æµ®ç‚¹æ•°ä¸­çš„0 .5 3.&quot;no-func-assign&quot;: 2,//ç¦æ­¢é‡å¤çš„å‡½æ•°å£°æ˜&quot;no-implicit-coercion&quot;: 1,//ç¦æ­¢éšå¼è½¬æ¢&quot;no-implied-eval&quot;: 2,//ç¦æ­¢ä½¿ç”¨éšå¼eval&quot;no-inline-comments&quot;: 0,//ç¦æ­¢è¡Œå†…å¤‡æ³¨&quot;no-inner-declarations&quot;: [2, &quot;functions&quot;],//ç¦æ­¢åœ¨å—è¯­å¥ä¸­ä½¿ç”¨å£°æ˜ï¼ˆå˜é‡æˆ–å‡½æ•°ï¼‰&quot;no-invalid-regexp&quot;: 2,//ç¦æ­¢æ— æ•ˆçš„æ­£åˆ™è¡¨è¾¾å¼&quot;no-invalid-this&quot;: 2,//ç¦æ­¢æ— æ•ˆçš„thisï¼Œåªèƒ½ç”¨åœ¨æ„é€ å™¨ï¼Œç±»ï¼Œå¯¹è±¡å­—é¢é‡&quot;no-irregular-whitespace&quot;: 2,//ä¸èƒ½æœ‰ä¸è§„åˆ™çš„ç©ºæ ¼&quot;no-iterator&quot;: 2,//ç¦æ­¢ä½¿ç”¨__iterator__ å±æ€§&quot;no-label-var&quot;: 2,//labelåä¸èƒ½ä¸varå£°æ˜çš„å˜é‡åç›¸åŒ&quot;no-labels&quot;: 2,//ç¦æ­¢æ ‡ç­¾å£°æ˜&quot;no-lone-blocks&quot;: 2,//ç¦æ­¢ä¸å¿…è¦çš„åµŒå¥—å—&quot;no-lonely-if&quot;: 2,//ç¦æ­¢elseè¯­å¥å†…åªæœ‰ifè¯­å¥&quot;no-loop-func&quot;: 1,//ç¦æ­¢åœ¨å¾ªç¯ä¸­ä½¿ç”¨å‡½æ•°ï¼ˆå¦‚æœæ²¡æœ‰å¼•ç”¨å¤–éƒ¨å˜é‡ä¸å½¢æˆé—­åŒ…å°±å¯ä»¥ï¼‰&quot;no-mixed-requires&quot;: [0, false],//å£°æ˜æ—¶ä¸èƒ½æ··ç”¨å£°æ˜ç±»å‹&quot;no-mixed-spaces-and-tabs&quot;: [2, false],//ç¦æ­¢æ··ç”¨tabå’Œç©ºæ ¼&quot;linebreak-style&quot;: [0, &quot;windows&quot;],//æ¢è¡Œé£æ ¼&quot;no-multi-spaces&quot;: 1,//ä¸èƒ½ç”¨å¤šä½™çš„ç©ºæ ¼&quot;no-multi-str&quot;: 2,//å­—ç¬¦ä¸²ä¸èƒ½ç”¨\\æ¢è¡Œ&quot;no-multiple-empty-lines&quot;: [1, &#123;&quot;max&quot;: 2&#125;],//ç©ºè¡Œæœ€å¤šä¸èƒ½è¶…è¿‡2è¡Œ&quot;no-native-reassign&quot;: 2,//ä¸èƒ½é‡å†™nativeå¯¹è±¡&quot;no-negated-in-lhs&quot;: 2,//in æ“ä½œç¬¦çš„å·¦è¾¹ä¸èƒ½æœ‰!&quot;no-nested-ternary&quot;: 0,//ç¦æ­¢ä½¿ç”¨åµŒå¥—çš„ä¸‰ç›®è¿ç®—&quot;no-new&quot;: 1,//ç¦æ­¢åœ¨ä½¿ç”¨newæ„é€ ä¸€ä¸ªå®ä¾‹åä¸èµ‹å€¼&quot;no-new-func&quot;: 1,//ç¦æ­¢ä½¿ç”¨new Function&quot;no-new-object&quot;: 2,//ç¦æ­¢ä½¿ç”¨new Object()&quot;no-new-require&quot;: 2,//ç¦æ­¢ä½¿ç”¨new require&quot;no-new-wrappers&quot;: 2,//ç¦æ­¢ä½¿ç”¨newåˆ›å»ºåŒ…è£…å®ä¾‹ï¼Œnew String new Boolean new Number&quot;no-obj-calls&quot;: 2,//ä¸èƒ½è°ƒç”¨å†…ç½®çš„å…¨å±€å¯¹è±¡ï¼Œæ¯”å¦‚Math() JSON()&quot;no-octal&quot;: 2,//ç¦æ­¢ä½¿ç”¨å…«è¿›åˆ¶æ•°å­—&quot;no-octal-escape&quot;: 2,//ç¦æ­¢ä½¿ç”¨å…«è¿›åˆ¶è½¬ä¹‰åºåˆ—&quot;no-param-reassign&quot;: 2,//ç¦æ­¢ç»™å‚æ•°é‡æ–°èµ‹å€¼&quot;no-path-concat&quot;: 0,//nodeä¸­ä¸èƒ½ä½¿ç”¨__dirnameæˆ–__filenameåšè·¯å¾„æ‹¼æ¥&quot;no-plusplus&quot;: 0,//ç¦æ­¢ä½¿ç”¨++ï¼Œ--&quot;no-process-env&quot;: 0,//ç¦æ­¢ä½¿ç”¨process.env&quot;no-process-exit&quot;: 0,//ç¦æ­¢ä½¿ç”¨process.exit()&quot;no-proto&quot;: 2,//ç¦æ­¢ä½¿ç”¨__proto__å±æ€§&quot;no-redeclare&quot;: 2,//ç¦æ­¢é‡å¤å£°æ˜å˜é‡&quot;no-regex-spaces&quot;: 2,//ç¦æ­¢åœ¨æ­£åˆ™è¡¨è¾¾å¼å­—é¢é‡ä¸­ä½¿ç”¨å¤šä¸ªç©ºæ ¼ /foo bar/&quot;no-restricted-modules&quot;: 0,//å¦‚æœç¦ç”¨äº†æŒ‡å®šæ¨¡å—ï¼Œä½¿ç”¨å°±ä¼šæŠ¥é”™&quot;no-return-assign&quot;: 1,//return è¯­å¥ä¸­ä¸èƒ½æœ‰èµ‹å€¼è¡¨è¾¾å¼&quot;no-script-url&quot;: 0,//ç¦æ­¢ä½¿ç”¨javascript:void(0)&quot;no-self-compare&quot;: 2,//ä¸èƒ½æ¯”è¾ƒè‡ªèº«&quot;no-sequences&quot;: 0,//ç¦æ­¢ä½¿ç”¨é€—å·è¿ç®—ç¬¦&quot;no-shadow&quot;: 2,//å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„å˜é‡ä¸èƒ½ä¸å®ƒæ‰€åŒ…å«çš„ä½œç”¨åŸŸä¸­çš„å˜é‡æˆ–å‚æ•°åŒå&quot;no-shadow-restricted-names&quot;: 2,//ä¸¥æ ¼æ¨¡å¼ä¸­è§„å®šçš„é™åˆ¶æ ‡è¯†ç¬¦ä¸èƒ½ä½œä¸ºå£°æ˜æ—¶çš„å˜é‡åä½¿ç”¨&quot;no-spaced-func&quot;: 2,//å‡½æ•°è°ƒç”¨æ—¶ å‡½æ•°åä¸()ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼&quot;no-sparse-arrays&quot;: 2,//ç¦æ­¢ç¨€ç–æ•°ç»„ï¼Œ [1,,2]&quot;no-sync&quot;: 0,//nodejs ç¦æ­¢åŒæ­¥æ–¹æ³•&quot;no-ternary&quot;: 0,//ç¦æ­¢ä½¿ç”¨ä¸‰ç›®è¿ç®—ç¬¦&quot;no-trailing-spaces&quot;: 1,//ä¸€è¡Œç»“æŸåé¢ä¸è¦æœ‰ç©ºæ ¼&quot;no-this-before-super&quot;: 0,//åœ¨è°ƒç”¨super()ä¹‹å‰ä¸èƒ½ä½¿ç”¨thisæˆ–super&quot;no-throw-literal&quot;: 2,//ç¦æ­¢æŠ›å‡ºå­—é¢é‡é”™è¯¯ throw &quot;error&quot;;&quot;no-undef&quot;: 1,//ä¸èƒ½æœ‰æœªå®šä¹‰çš„å˜é‡&quot;no-undef-init&quot;: 2,//å˜é‡åˆå§‹åŒ–æ—¶ä¸èƒ½ç›´æ¥ç»™å®ƒèµ‹å€¼ä¸ºundefined&quot;no-undefined&quot;: 2,//ä¸èƒ½ä½¿ç”¨undefined&quot;no-unexpected-multiline&quot;: 2,//é¿å…å¤šè¡Œè¡¨è¾¾å¼&quot;no-underscore-dangle&quot;: 1,//æ ‡è¯†ç¬¦ä¸èƒ½ä»¥_å¼€å¤´æˆ–ç»“å°¾&quot;no-unneeded-ternary&quot;: 2,//ç¦æ­¢ä¸å¿…è¦çš„åµŒå¥— var isYes = answer === 1 ? true : false;&quot;no-unreachable&quot;: 2,//ä¸èƒ½æœ‰æ— æ³•æ‰§è¡Œçš„ä»£ç &quot;no-unused-expressions&quot;: 2,//ç¦æ­¢æ— ç”¨çš„è¡¨è¾¾å¼&quot;no-unused-vars&quot;: [2, &#123;&quot;vars&quot;: &quot;all&quot;, &quot;args&quot;: &quot;after-used&quot;&#125;],//ä¸èƒ½æœ‰å£°æ˜åæœªè¢«ä½¿ç”¨çš„å˜é‡æˆ–å‚æ•°&quot;no-use-before-define&quot;: 2,//æœªå®šä¹‰å‰ä¸èƒ½ä½¿ç”¨&quot;no-useless-call&quot;: 2,//ç¦æ­¢ä¸å¿…è¦çš„callå’Œapply&quot;no-void&quot;: 2,//ç¦ç”¨voidæ“ä½œç¬¦&quot;no-var&quot;: 0,//ç¦ç”¨varï¼Œç”¨letå’Œconstä»£æ›¿&quot;no-warning-comments&quot;: [1, &#123; &quot;terms&quot;: [&quot;todo&quot;, &quot;fixme&quot;, &quot;xxx&quot;], &quot;location&quot;: &quot;start&quot; &#125;],//ä¸èƒ½æœ‰è­¦å‘Šå¤‡æ³¨&quot;no-with&quot;: 2,//ç¦ç”¨with&quot;array-bracket-spacing&quot;: [2, &quot;never&quot;],//æ˜¯å¦å…è®¸éç©ºæ•°ç»„é‡Œé¢æœ‰å¤šä½™çš„ç©ºæ ¼&quot;arrow-parens&quot;: 0,//ç®­å¤´å‡½æ•°ç”¨å°æ‹¬å·æ‹¬èµ·æ¥&quot;arrow-spacing&quot;: 0,//=&gt;çš„å‰/åæ‹¬å·&quot;accessor-pairs&quot;: 0,//åœ¨å¯¹è±¡ä¸­ä½¿ç”¨getter/setter&quot;block-scoped-var&quot;: 0,//å—è¯­å¥ä¸­ä½¿ç”¨var&quot;brace-style&quot;: [1, &quot;1tbs&quot;],//å¤§æ‹¬å·é£æ ¼&quot;callback-return&quot;: 1,//é¿å…å¤šæ¬¡è°ƒç”¨å›è°ƒä»€ä¹ˆçš„&quot;camelcase&quot;: 2,//å¼ºåˆ¶é©¼å³°æ³•å‘½å&quot;comma-dangle&quot;: [2, &quot;never&quot;],//å¯¹è±¡å­—é¢é‡é¡¹å°¾ä¸èƒ½æœ‰é€—å·&quot;comma-spacing&quot;: 0,//é€—å·å‰åçš„ç©ºæ ¼&quot;comma-style&quot;: [2, &quot;last&quot;],//é€—å·é£æ ¼ï¼Œæ¢è¡Œæ—¶åœ¨è¡Œé¦–è¿˜æ˜¯è¡Œå°¾&quot;complexity&quot;: [0, 11],//å¾ªç¯å¤æ‚åº¦&quot;computed-property-spacing&quot;: [0, &quot;never&quot;],//æ˜¯å¦å…è®¸è®¡ç®—åçš„é”®åä»€ä¹ˆçš„&quot;consistent-return&quot;: 0,//return åé¢æ˜¯å¦å…è®¸çœç•¥&quot;consistent-this&quot;: [2, &quot;that&quot;],//thisåˆ«å&quot;constructor-super&quot;: 0,//éæ´¾ç”Ÿç±»ä¸èƒ½è°ƒç”¨superï¼Œæ´¾ç”Ÿç±»å¿…é¡»è°ƒç”¨super&quot;curly&quot;: [2, &quot;all&quot;],//å¿…é¡»ä½¿ç”¨ if()&#123;&#125; ä¸­çš„&#123;&#125;&quot;default-case&quot;: 2,//switchè¯­å¥æœ€åå¿…é¡»æœ‰default&quot;dot-location&quot;: 0,//å¯¹è±¡è®¿é—®ç¬¦çš„ä½ç½®ï¼Œæ¢è¡Œçš„æ—¶å€™åœ¨è¡Œé¦–è¿˜æ˜¯è¡Œå°¾&quot;dot-notation&quot;: [0, &#123; &quot;allowKeywords&quot;: true &#125;],//é¿å…ä¸å¿…è¦çš„æ–¹æ‹¬å·&quot;eol-last&quot;: 0,//æ–‡ä»¶ä»¥å•ä¸€çš„æ¢è¡Œç¬¦ç»“æŸ&quot;eqeqeq&quot;: 2,//å¿…é¡»ä½¿ç”¨å…¨ç­‰&quot;func-names&quot;: 0,//å‡½æ•°è¡¨è¾¾å¼å¿…é¡»æœ‰åå­—&quot;func-style&quot;: [0, &quot;declaration&quot;],//å‡½æ•°é£æ ¼ï¼Œè§„å®šåªèƒ½ä½¿ç”¨å‡½æ•°å£°æ˜/å‡½æ•°è¡¨è¾¾å¼&quot;generator-star-spacing&quot;: 0,//ç”Ÿæˆå™¨å‡½æ•°*çš„å‰åç©ºæ ¼&quot;guard-for-in&quot;: 0,//for inå¾ªç¯è¦ç”¨ifè¯­å¥è¿‡æ»¤&quot;handle-callback-err&quot;: 0,//nodejs å¤„ç†é”™è¯¯&quot;id-length&quot;: 0,//å˜é‡åé•¿åº¦&quot;indent&quot;: [2, 4],//ç¼©è¿›é£æ ¼&quot;init-declarations&quot;: 0,//å£°æ˜æ—¶å¿…é¡»èµ‹åˆå€¼&quot;key-spacing&quot;: [0, &#123; &quot;beforeColon&quot;: false, &quot;afterColon&quot;: true &#125;],//å¯¹è±¡å­—é¢é‡ä¸­å†’å·çš„å‰åç©ºæ ¼&quot;lines-around-comment&quot;: 0,//è¡Œå‰/è¡Œåå¤‡æ³¨&quot;max-depth&quot;: [0, 4],//åµŒå¥—å—æ·±åº¦&quot;max-len&quot;: [0, 80, 4],//å­—ç¬¦ä¸²æœ€å¤§é•¿åº¦&quot;max-nested-callbacks&quot;: [0, 2],//å›è°ƒåµŒå¥—æ·±åº¦&quot;max-params&quot;: [0, 3],//å‡½æ•°æœ€å¤šåªèƒ½æœ‰3ä¸ªå‚æ•°&quot;max-statements&quot;: [0, 10],//å‡½æ•°å†…æœ€å¤šæœ‰å‡ ä¸ªå£°æ˜&quot;new-cap&quot;: 2,//å‡½æ•°åé¦–è¡Œå¤§å†™å¿…é¡»ä½¿ç”¨newæ–¹å¼è°ƒç”¨ï¼Œé¦–è¡Œå°å†™å¿…é¡»ç”¨ä¸å¸¦newæ–¹å¼è°ƒç”¨&quot;new-parens&quot;: 2,//newæ—¶å¿…é¡»åŠ å°æ‹¬å·&quot;newline-after-var&quot;: 2,//å˜é‡å£°æ˜åæ˜¯å¦éœ€è¦ç©ºä¸€è¡Œ&quot;object-curly-spacing&quot;: [0, &quot;never&quot;],//å¤§æ‹¬å·å†…æ˜¯å¦å…è®¸ä¸å¿…è¦çš„ç©ºæ ¼&quot;object-shorthand&quot;: 0,//å¼ºåˆ¶å¯¹è±¡å­—é¢é‡ç¼©å†™è¯­æ³•&quot;one-var&quot;: 1,//è¿ç»­å£°æ˜&quot;operator-assignment&quot;: [0, &quot;always&quot;],//èµ‹å€¼è¿ç®—ç¬¦ += -=ä»€ä¹ˆçš„&quot;operator-linebreak&quot;: [2, &quot;after&quot;],//æ¢è¡Œæ—¶è¿ç®—ç¬¦åœ¨è¡Œå°¾è¿˜æ˜¯è¡Œé¦–&quot;padded-blocks&quot;: 0,//å—è¯­å¥å†…è¡Œé¦–è¡Œå°¾æ˜¯å¦è¦ç©ºè¡Œ&quot;prefer-const&quot;: 0,//é¦–é€‰const&quot;prefer-spread&quot;: 0,//é¦–é€‰å±•å¼€è¿ç®—&quot;prefer-reflect&quot;: 0,//é¦–é€‰Reflectçš„æ–¹æ³•&quot;quotes&quot;: [1, &quot;single&quot;],//å¼•å·ç±»å‹ `` &quot;&quot; &#x27;&#x27;&quot;quote-props&quot;:[2, &quot;always&quot;],//å¯¹è±¡å­—é¢é‡ä¸­çš„å±æ€§åæ˜¯å¦å¼ºåˆ¶åŒå¼•å·&quot;radix&quot;: 2,//parseIntå¿…é¡»æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°&quot;id-match&quot;: 0,//å‘½åæ£€æµ‹&quot;require-yield&quot;: 0,//ç”Ÿæˆå™¨å‡½æ•°å¿…é¡»æœ‰yield&quot;semi&quot;: [2, &quot;always&quot;],//è¯­å¥å¼ºåˆ¶åˆ†å·ç»“å°¾&quot;semi-spacing&quot;: [0, &#123;&quot;before&quot;: false, &quot;after&quot;: true&#125;],//åˆ†å·å‰åç©ºæ ¼&quot;sort-vars&quot;: 0,//å˜é‡å£°æ˜æ—¶æ’åº&quot;space-after-keywords&quot;: [0, &quot;always&quot;],//å…³é”®å­—åé¢æ˜¯å¦è¦ç©ºä¸€æ ¼&quot;space-before-blocks&quot;: [0, &quot;always&quot;],//ä¸ä»¥æ–°è¡Œå¼€å§‹çš„å—&#123;å‰é¢è¦ä¸è¦æœ‰ç©ºæ ¼&quot;space-before-function-paren&quot;: [0, &quot;always&quot;],//å‡½æ•°å®šä¹‰æ—¶æ‹¬å·å‰é¢è¦ä¸è¦æœ‰ç©ºæ ¼&quot;space-in-parens&quot;: [0, &quot;never&quot;],//å°æ‹¬å·é‡Œé¢è¦ä¸è¦æœ‰ç©ºæ ¼&quot;space-infix-ops&quot;: 0,//ä¸­ç¼€æ“ä½œç¬¦å‘¨å›´è¦ä¸è¦æœ‰ç©ºæ ¼&quot;space-return-throw-case&quot;: 2,//return throw caseåé¢è¦ä¸è¦åŠ ç©ºæ ¼&quot;space-unary-ops&quot;: [0, &#123; &quot;words&quot;: true, &quot;nonwords&quot;: false &#125;],//ä¸€å…ƒè¿ç®—ç¬¦çš„å‰/åè¦ä¸è¦åŠ ç©ºæ ¼&quot;spaced-comment&quot;: 0,//æ³¨é‡Šé£æ ¼è¦ä¸è¦æœ‰ç©ºæ ¼ä»€ä¹ˆçš„&quot;strict&quot;: 2,//ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼&quot;use-isnan&quot;: 2,//ç¦æ­¢æ¯”è¾ƒæ—¶ä½¿ç”¨NaNï¼Œåªèƒ½ç”¨isNaN()&quot;valid-jsdoc&quot;: 0,//jsdocè§„åˆ™&quot;valid-typeof&quot;: 2,//å¿…é¡»ä½¿ç”¨åˆæ³•çš„typeofçš„å€¼&quot;vars-on-top&quot;: 2,//varå¿…é¡»æ”¾åœ¨ä½œç”¨åŸŸé¡¶éƒ¨&quot;wrap-iife&quot;: [2, &quot;inside&quot;],//ç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼çš„å°æ‹¬å·é£æ ¼&quot;wrap-regex&quot;: 0,//æ­£åˆ™è¡¨è¾¾å¼å­—é¢é‡ç”¨å°æ‹¬å·åŒ…èµ·æ¥&quot;yoda&quot;: [2, &quot;never&quot;]//ç¦æ­¢å°¤è¾¾æ¡ä»¶&#125;","tags":["Eslint"]},{"title":"electronå­¦ä¹ è®°å½•","path":"/2022/01/12/electronå­¦ä¹ è®°å½•/","content":"electronæ ¸å¿ƒæ¨¡å—![WeChat2314efdd8331a8e89163bc315a1a25a4](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•/WeChat2314efdd8331a8e89163bc315a1a25a4.png) å¿«é€Ÿæ­å»ºdemoå®˜æ–¹demoå¿«é€Ÿæ­å»ºï¼ˆelectron-quick-templateï¼‰gitåœ°å€ 12345678# Clone this repositorygit clone https://github.com/electron/electron-quick-start# Go into the repositorycd electron-quick-start# Install dependenciesnpm install# Run the appnpm start æ­å»ºvue + electronä½¿ç”¨electron-vue ä¸­æ–‡æ–‡æ¡£ 12345678# å®‰è£… vue-cli å’Œ è„šæ‰‹æ¶æ ·æ¿ä»£ç npm install -g vue-clivue init simulatedgreg/electron-vue my-project# å®‰è£…ä¾èµ–å¹¶è¿è¡Œä½ çš„ç¨‹åºcd my-projectyarn # æˆ–è€… npm installyarn run dev # æˆ–è€… npm run dev ä½¿ç”¨vue cliè‡ªå¸¦çš„å¯è§†åŒ–åˆ›å»ºé¡¹ç›® vue cliæœ‰å¾ˆå¤šæ’ä»¶åŒ–çš„ä¸œè¥¿å¯ä»¥ç”¨ 12# æ‰“å¼€å¯è§†åŒ–ç•Œé¢vue ui å¦‚å›¾ï¼š ç„¶åç‚¹æ–°å¢ä¸€ä¸ª ![image-20220112153922959](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220112153922959.png) å—¯å¯¹ï¼Œç»§ç»­ï¼Œæƒ³é€‰å•¥é€‰å•¥ ![image-20220112154019140](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220112154019140.png) ç„¶åå°±åœ¨ä¸‹è½½äº† ![image-20220112154214278](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220112154214278.png) ç„¶åæ’ä»¶ä¸­æœç´¢ vue-cli-plugin-electron-builder, å®‰è£…ä»– æˆ–è€…ä½¿ç”¨ vue add electron-builderå®‰è£… ![image-20220112154326504](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220112154326504.png) æ¥ä¸‹æ¥ç›´æ¥å°±ï¼šå°±okäº† 1npm run electron:serve ![image-20220112154639191](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220112154639191.png) å¦‚ä½•è°ƒè¯•ä¸»è¿›ç¨‹ åŸºäºvscodeé€šè¿‡wsåè®®è¿›è¡Œè°ƒè¯•ï¼Œä¹‹åé€šè¿‡ç«¯å£å°±å¯è¿›å…¥è°ƒè¯•çš„é¡µé¢ï¼Œå°±å½¢å®¹è°ƒè¯•node vscodeè°ƒè¯•å®˜æ–¹æ–‡æ¡£ ä½¿ç”¨electronè‡ªå¸¦çš„ æ’ä»¶ electron-debug åœ¨devæ–‡ä»¶ä¸­å¼•å…¥ ![image-20220115143454095](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220115143454095.png) åœ¨ä¸»è¿›ç¨‹ä¸­å¼•å…¥ ![image-20220115143536900](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220115143536900.png) å¯åŠ¨ä¹‹åå‘¢å°±èƒ½çœ‹åˆ°ç»ˆç«¯æ‰“å°äº†è¿™å¥è¯ ![image-20220115143611685](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220115143611685.png) æ‰“å¼€chrome://deviceså°±okäº† ä½¿ç”¨electron-vue + vscodeé…ç½®vscode æ‰¾åˆ°å·¦ä¾§ä¸€ä¸ªè™«å­ä¸€æ ·çš„å›¾æ ‡ ![image-20220115112806086](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220115112806086.png) é€‰æ‹©ä¸Šé¢çš„ä¸‹æ‹‰é¢æ¿ï¼Œæ·»åŠ é…ç½®ï¼ˆè¿™é‡Œæ˜¯nodeï¼Œå°±é€‰æ‹©nodejsï¼‰ ![image-20220115112904875](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220115112904875.png) vscodeä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ .vscode/è·¯å¾„ä¸‹çš„launch.jsonæ–‡ä»¶ã€‚ launch.json åŸºäºelectron-vueçš„é…ç½®ï¼ˆä»¥ä¸‹é…ç½®å†ç”¨electron-vueçš„æ—¶å€™å¤åˆ¶è¿›å»å§ï¼‰ 12345678910111213141516&#123; &quot;version&quot;: &quot;0.2.0&quot;, &quot;configurations&quot;: [ &#123; &quot;name&quot;: &quot;Electron Main&quot;, &quot;program&quot;: &quot;$&#123;workspaceFolder&#125;/.electron-vue/dev-runner.js&quot;, &quot;request&quot;: &quot;launch&quot;, &quot;skipFiles&quot;: [ &quot;&lt;node_internals&gt;/**&quot; ], &quot;type&quot;: &quot;node&quot;, &quot;autoAttachChildProcesses&quot;: true, &quot;protocol&quot;: &quot;inspector&quot; &#125;\t]&#125; è¿™é‡Œçš„programæŒ‡çš„æ˜¯è°ƒè¯•çš„å…¥å£æ–‡ä»¶ï¼Œå¦‚æœæ˜¯ç”¨ å®˜æ–¹çš„å¿«é€Ÿ æ¨¡æ¿æ­å»ºçš„è¯ï¼Œå°±æ˜¯main.jsï¼Œè€Œelectron-vueåˆ™å¾—æ˜¯.electron-vue/dev-runner.jsæ–‡ä»¶ ä¿®æ”¹electron-vueç›¸å…³é…ç½®æ–‡ä»¶webpack.main.config.js å†electron-vueæ­å»ºçš„ç›®å½•.electron-vueä¸‹çš„webpack.main.config.js æ·»åŠ é…ç½® ![image-20220115121624744](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220115121624744.png) dev-runner.js å†electron-vueæ­å»ºçš„ç›®å½•.electron-vueä¸‹çš„dev-runner.js æŠŠ .electron-vue/dev-runner.js é‡Œä»¥ä¸‹æŠ¥é”™ä»£ç æ³¨é‡Šæ‰ã€‚ 1234567// // detect yarn or npm and process commandline args accordingly// if (process.env.npm_execpath.endsWith(&#x27;yarn.js&#x27;)) &#123;// args = args.concat(process.argv.slice(3))// &#125; else if (process.env.npm_execpath.endsWith(&#x27;npm-cli.js&#x27;)) &#123;// args = args.concat(process.argv.slice(2))// &#125; è¿™æ ·æ˜¯ä¸ºäº†é¿å…æ§åˆ¶å°æŠ¥é”™ ![image-20220115121919211](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220115121919211.png) å¼€å§‹è°ƒè¯•æ‰“å¼€vscode é€šè¿‡å¿«æ·æ–¹å¼F5æˆ–è€…æ‰‹åŠ¨ç‚¹å‡»å¤´éƒ¨èœå• çš„ è¿è¡Œä¸­çš„è°ƒè¯•å°±å¯ä»¥å¼€å§‹äº† è¿™æ—¶å€™å°±èƒ½åœ¨è°ƒè¯•æ§åˆ¶å°çœ‹åˆ°è¿™å¥è¯ ![image-20220115122235932](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220115122235932.png) æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨è¾“å…¥chrome://inspect/#devices ![image-20220115122309093](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220115122309093.png) ç‚¹å‡»inspectå°±èƒ½çœ‹åˆ°æ–‡ä»¶äº†ï¼Œè¿™æ—¶å€™ç›´æ¥æ‰“æ–­ç‚¹å°±OK ï¼ˆæ­£åœ¨è°ƒè¯•çš„æ–‡ä»¶æ˜¯æœ‰ç»¿è‰²çš„å°ç‚¹ç‚¹ï¼‰ ![image-20220115122412302](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220115122412302.png) å€˜è‹¥ç¬¬ä¸€æ¬¡è°ƒè¯•ï¼Œåˆ™éœ€è¦ç‚¹å‡»ä¸Šæ–¹çš„æ·»åŠ æ–‡ä»¶æŒ‰é’®å°†ç›®å½•æ·»åŠ åˆ°è°ƒè¯•å·¥å…·å½“ä¸­ ![image-20220115122506756](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220115122506756.png) vue-cli + vue-cli-plugin-electron-builder è°ƒè¯•å®˜æ–¹æ–‡æ¡£ è°ƒè¯•demoåœ°å€ å…¶ä»–è°ƒè¯•çš„launch.jsoné…ç½®1234567891011121314151617181920212223242526272829303132&#123; &quot;version&quot;: &quot;0.2.0&quot;, &quot;configurations&quot;: [ &#123; //æ–¹å¼ä¸€ &quot;name&quot;: &quot;Debug Main Process&quot;, &quot;type&quot;: &quot;node&quot;, &quot;request&quot;: &quot;launch&quot;, &quot;cwd&quot;: &quot;$&#123;workspaceFolder&#125;&quot;, &quot;timeout&quot;: 60000, //é¿å…å‡ºç°can not connect to the targeté”™è¯¯ &quot;runtimeExecutable&quot;: &quot;$&#123;workspaceFolder&#125;/node_modules/.bin/electron&quot;, &quot;windows&quot;: &#123; &quot;runtimeExecutable&quot;: &quot;$&#123;workspaceFolder&#125;/node_modules/.bin/electron.cmd&quot; &#125;, &quot;args&quot; : [&quot;.&quot;], &quot;env&quot;: &#123; &quot;NODE_ENV&quot;: &quot;development&quot; &#125;, &quot;protocol&quot;: &quot;inspector&quot; &#125;, &#123; //æ–¹å¼äºŒ &quot;name&quot;: &quot;Attach&quot;, &quot;type&quot;: &quot;node&quot;, &quot;request&quot;: &quot;attach&quot;, &quot;port&quot;: 5858, &quot;sourceMaps&quot;: true, &quot;address&quot;: &quot;localhost&quot;, &quot;timeout&quot;: 60000 //é¿å…å‡ºç°can not connect to the targeté”™è¯¯ &#125; ]&#125; è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ å®˜æ–¹æ–‡æ¡£ï¼š ipcMain ipcRenderer webContents ä¸»çº¿ç¨‹ åˆ° æ¸²æŸ“çº¿ç¨‹ é€šè¿‡ mainWin.webContents.send æ¥å‘é€ â€”&gt;ipcRenderer.on æ¥ç›‘å¬ æ¸²æŸ“çº¿ç¨‹ åˆ° ä¸»çº¿ç¨‹ éœ€è¦é€šè¿‡ ipcRenderer.sendå‘é€ â€”&gt; ipcMain.onæ¥ç›‘å¬ åŸç†electronä½¿ç”¨mojoçš„æ¡†æ¶å®Œæˆè¿›ç¨‹é—´é€šä¿¡çš„å·¥ä½œ mojoæ¡†æ¶æä¾›äº†ä¸€å¥—åœ°å±‚çš„ipcå®ç°ï¼ŒåŒ…æ‹¬ æ¶ˆæ¯ç®¡é“ï¼Œæ•°æ®ç®¡é“ï¼Œå…±äº«ç¼“å­˜ç¼“å†²åŒºç­‰ç­‰ã€‚ electronåœ¨api.mojomæ–‡ä»¶ä¸­å®šä¹‰äº†ç›¸å…³çš„é€šä¿¡æ¥å£æè¿°æ–‡ä»¶ æºç  å…¶ä¸­æ¯”è¾ƒé‡è¦çš„å°±æ˜¯ ElectronRenderer å’Œ ElectronApiIPC è¿™ä¸¤ä¸ªå®šä¹‰ï¼Œä¸ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹é€šä¿¡æœ‰å…³ åœ¨ç¼–è¯‘Electronæºç çš„è¿‡ç¨‹ï¼Œmojoæ¡†æ¶ä¼šæŠŠè¿™äº›é€šä¿¡æè¿°æ–‡ä»¶è½¬ä¹‰ä¸ºå…·ä½“çš„å®ç°ä»£ç  ä¹‹åshell\\renderer\\api\\electron_api_ipc_renderer.ccå’Œshell\\browser\\api\\electron_api_web_contents.ccè¿™ä¸¤ä¸ªc++æ–‡ä»¶éƒ½ä¼šå»å¼•ç”¨è¿™ä¸ªç¼–è¯‘ä¹‹åçš„æ–‡ä»¶ï¼ˆshell\\common\\api\\api.mojom.hï¼‰å¤´æ–‡ä»¶ã€‚ åœ¨æˆ‘ä»¬jsä»£ç ä¸­ä½¿ç”¨ 1await ipcRenderer.invoke(&#x27;event&#x27;,&#x27;message&#x27;); å…¶å®åœ°å±‚èµ°çš„å°±æ˜¯shell\\renderer\\api\\electron_api_ipc_renderer.cc è¿™æ®µä»£ç é™¤äº†åˆ›å»ºä¸€ä¸ª Promise å¯¹è±¡ä¹‹å¤–ï¼Œè¿˜æ‰§è¡Œäº† electron_brower_remoteå¯¹è±¡ï¼ˆMojoçš„é€šä¿¡å¯¹è±¡ï¼‰çš„invokeçš„æ–¹æ³• ä¹‹åmojoä¼šç»„ç»‡æ¶ˆæ¯ï¼ŒæŠŠè¿™ä¸ªæ¶ˆæ¯å‘ç»™ä¸»è¿›ç¨‹ï¼Œå¹¶æ‰§è¡Œäº† electron_api_web_contents.cc ä¸­WebContents::Invokeçš„æ–¹æ³• è¿™ä¸ªæ–¹æ³•ä¼šå‘å°„ä¸€ä¸ªåå­—ä¸º-ipc-invokeçš„äº‹ä»¶ï¼ŒæŠŠæ¸²æŸ“è¿›ç¨‹ä¼ é€’è¿‡æ¥çš„æ•°æ®éƒ½å‘å°„å‡ºå»ï¼Œä¹‹åå’Œè¿™ä¸ªäº‹ä»¶ä¼šè§¦å‘ä½äº lib/browser/api/web-contents/tsçš„tsä»£ç ä¸­ ![image-20220327113128169](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•/image-20220327113128169.png) è¿™ä¸ªé€»è¾‘å½“ä¸­ï¼Œelectronä¼šå»æŸ¥æ‰¾ä¸€ä¸ªmapå¯¹è±¡ æ˜¯å¦æ³¨å†Œäº†å½“å‰çš„å¤„ç†é€»è¾‘ï¼Œæœ‰çš„è¯æ‰§è¡Œç”¨æˆ·ä»£ç ï¼Œå¦åˆ™å¼‚å¸¸ invokeä¹‹åä¼šæŠŠå¤„ç†çš„ç»“æœè¿”å›æ¸²æŸ“è¿›ç¨‹ï¼ˆåŸºäºmojoçš„è¿›ç¨‹é€šä¿¡ï¼Œå®ç°ä»£ç shell/brower/api/event.ccï¼‰ æˆ‘ä»¬åœ¨è°ƒç”¨ipcMain.handle æ–¹æ³•ä¸ºä¸»è¿›ç¨‹æ³¨å†ŒæŸäº‹ä»¶çš„å¤„ç†é€»è¾‘æ—¶å€™ï¼Œå®é™…ä¸Šæ‰§è¡Œäº† /lib/brower/ipc-main-tmpl.ts å°±æ˜¯å°†ç”¨æˆ·çš„å¤„ç†é€»è¾‘åŒ…è£…èµ·æ¥å­˜æ”¾åˆ°mapå¯¹è±¡å½“ä¸­ï¼Œè¿™å°±å¯¹åº”äº†ä¸Šè¿°çš„invokeè§¦å‘çš„æ—¶å€™ï¼Œåšçš„äº‹æƒ…äº†ã€‚ å¤§è‡´æ˜¯é€šä¿¡çš„åŸºæœ¬é€»è¾‘ æ¸²æŸ“è¿›ç¨‹å’Œä¸»è¿›ç¨‹å¼‚æ­¥é€šä¿¡ipcRenderer.send + ipcMain.on/oncerenderer.js (æ¸²æŸ“è¿›ç¨‹æ–‡ä»¶) 12345import &#123; ipcRenderer &#125; from &#x27;electron&#x27;;function handleMessage()&#123; ipcRenderer.send(&#x27;renderer-to-main&#x27;, &#x27;this is weng&#x27;)&#125; main.js (ä¸»è¿›ç¨‹) 12345import &#123; ipcMain &#125; from &#x27;electron&#x27;;ipcMain.on(&#x27;renderer-to-main&#x27;, (event, message)=&gt;&#123; console.log(&#x27;this is a message from weng&#x27;, message)&#125;) å‡å¦‚ä¸»è¿›ç¨‹éœ€è¦å›å¤æ¸²æŸ“è¿›ç¨‹çš„æ¶ˆæ¯ ä¸»è¿›ç¨‹å¯ä»¥é€šè¿‡ event.reply å›å¤å¼‚æ­¥æ¶ˆæ¯ï¼Œç„¶åå‰ææ˜¯æ¸²æŸ“è¿›ç¨‹ä¹Ÿéœ€è¦ç›‘å¬è¿™ä¸ªäº‹ä»¶ renderer.js 12345678import &#123; ipcRenderer &#125; from &#x27;electron&#x27;;function handleMessage()&#123; ipcRenderer.send(&#x27;renderer-to-main&#x27;, &#x27;this is weng&#x27;)&#125;ipcRenderer.on(&#x27;main-to-renderer&#x27;,(event, message)=&gt;&#123; console.log(&#x27;reply to weng&#x27;, message); // ç»™ç¿æºæ•å‘æ¶ˆæ¯&#125;) Main.js 123456import &#123; ipcMain &#125; from &#x27;electron&#x27;;ipcMain.on(&#x27;renderer-to-main&#x27;, (event, message)=&gt;&#123; console.log(&#x27;this is a message from weng&#x27;, message) event.reply(&#x27;main-to-renderer&#x27;, &quot;ç»™ç¿æºæ•å‘æ¶ˆæ¯&quot;);&#125;) 1ã€ä¸»è¿›ç¨‹é€šè¿‡ ipcMain.on æ¥ç›‘å¬æ¸²æŸ“è¿›ç¨‹çš„æ¶ˆæ¯ï¼› 2ã€ä¸»è¿›ç¨‹æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå¯ä»¥å›å¤æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä¸å›å¤ã€‚å¦‚æœå›å¤çš„è¯ï¼Œé€šè¿‡ event.reply å‘é€å¦ä¸€ä¸ªäº‹ä»¶ï¼Œæ¸²æŸ“è¿›ç¨‹ç›‘å¬è¿™ä¸ªäº‹ä»¶å¾—åˆ°å›å¤ç»“æœã€‚å¦‚æœä¸å›å¤æ¶ˆæ¯çš„è¯ï¼Œæ¸²æŸ“è¿›ç¨‹å°†æ¥ç€æ‰§è¡Œ ipcRenderer.send ä¹‹åçš„ä»£ç ã€‚ ä¸Šé¢æåˆ°è¿‡äº†, send è¿™æ ·çš„æ–¹å¼ï¼Œä¸»è¿›ç¨‹å¯ä»¥ç»™å›å¤ï¼Œä¹Ÿå¯ä»¥ä¸ç»™å›å¤ï¼Œä½†æ˜¯å¾—é€šè¿‡ event.replayã€‚å¦‚æœæ­¤æ—¶ä½ è¯•å›¾ç”¨ return çš„æ–¹å¼ä¼ é€’è¿”å›å€¼çš„è¯ï¼Œç»“æœå¹¶ä¸èƒ½è¾¾åˆ°ä½ çš„é¢„æœŸã€‚ ipcMain.handle/handleOnce + ipcRenderer.invoke è¿™æ˜¯å¦å¤–ä¸€ç§é€šä¿¡æ‰‹æ®µ main.js 1234567891011121314151617// main.jsconst &#123; ipcMain &#125; = require(&#x27;electron&#x27;);// è¿”å›çš„æ•°æ®å°†ä¼šè¢«promiseåŒ…è£¹ipcMain.handle(&#x27;render-invoke-to-main&#x27;, async (event, message) =&gt; &#123; console.log(`receive message from render: $&#123;message&#125;`) const result = await asyncWork(); return result; // å‡å¦‚éœ€è¦å›å¤æ¸²æŸ“è¿›ç¨‹ç›´æ¥returnå°±è¡Œ&#125;)const asyncWork = async () =&gt; &#123; return new Promise(resolve =&gt; &#123; setTimeout(() =&gt; &#123; resolve(&#x27;å»¶è¿Ÿ 2 ç§’è·å–åˆ°ä¸»è¿›ç¨‹çš„è¿”å›ç»“æœ&#x27;) &#125;, 2000) &#125;)&#125; renderer.js 12345678// render.jsconst &#123; ipcRenderer &#125; = require(&#x27;electron&#x27;);async function invokeMessageToMain() &#123; const replyMessage = await ipcRenderer.invoke(&#x27;render-invoke-to-main&#x27;, &#x27;æˆ‘æ˜¯æ¸²æŸ“è¿›ç¨‹é€šè¿‡ invoke å‘é€çš„æ¶ˆæ¯&#x27;); console.log(&#x27;replyMessage&#x27;, replyMessage);&#125; 1ã€ä¸»è¿›ç¨‹é€šè¿‡ ipcMain.handle æ¥å¤„ç†æ¸²æŸ“è¿›ç¨‹å‘é€çš„æ¶ˆæ¯ï¼› 2ã€ä¸»è¿›ç¨‹æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå¯ä»¥å›å¤æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä¸å›å¤ã€‚å¦‚æœå›å¤æ¶ˆæ¯çš„è¯ï¼Œå¯ä»¥é€šè¿‡ return ç»™æ¸²æŸ“è¿›ç¨‹å›å¤æ¶ˆæ¯ï¼›å¦‚æœä¸å›å¤æ¶ˆæ¯çš„è¯ï¼Œæ¸²æŸ“è¿›ç¨‹å°†æ¥ç€æ‰§è¡Œ ipcRenderer.invoke ä¹‹åçš„ä»£ç ã€‚ 3ã€æ¸²æŸ“è¿›ç¨‹å¼‚æ­¥ç­‰å¾…ä¸»è¿›ç¨‹çš„å›åº”ï¼Œ invoke çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª Promise&lt;pending&gt; ã€‚ window.webContents.send è¿™ç§æ–¹å¼ä¾èµ–äº webContents å¯¹è±¡ï¼Œå®ƒæ˜¯æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æ–°å»ºçª—å£æ—¶ï¼Œäº§ç”Ÿçš„çª—å£å¯¹è±¡ä¸Šçš„ä¸€ä¸ªå±æ€§ã€‚ 1234// çª—å£åœ¨å®ŒæˆåŠ è½½æ—¶ï¼Œé€šè¿‡ webContents.send ç»™æ¸²æŸ“è¿›ç¨‹å‘é€æ¶ˆæ¯window.webContents.on(&#x27;did-finish-load&#x27;, () =&gt; &#123; window.webContents.send(&#x27;main-send-to-render&#x27;, &#x27;å¯åŠ¨å®Œæˆäº†&#x27;)&#125;) ä¹‹å‰æˆ‘ä»¬é€šè¿‡æ¸²æŸ“è¿›ç¨‹ç›‘å¬ä¸»è¿›ç¨‹çš„äº‹ä»¶ 1234567// render.jsconst &#123; ipcRenderer &#125; = require(&#x27;electron&#x27;);ipcRenderer.on(&#x27;main-send-to-render&#x27;, (event, message) =&gt; &#123; console.log(`receive message from main: $&#123;message&#125;`)&#125;) æ¸²æŸ“è¿›ç¨‹å’Œä¸»è¿›ç¨‹çš„åŒæ­¥é€šä¿¡ipcRenderer.sendSync + ipcMain.on/oncerenderer.js 12345678// render.jsconst &#123; ipcRenderer &#125; = require(&#x27;electron&#x27;);function sendSyncMessageToMain() &#123; const replyMessage = ipcRenderer.sendSync(&#x27;render-send-sync-to-main&#x27;, &#x27;æˆ‘æ˜¯æ¸²æŸ“è¿›ç¨‹é€šè¿‡ syncSend å‘é€ç»™ä¸»è¿›ç¨‹çš„æ¶ˆæ¯&#x27;); console.log(&#x27;replyMessage&#x27;, replyMessage); // &#x27;ä¸»è¿›ç¨‹å›å¤çš„æ¶ˆæ¯&#x27;&#125; Main.js 12345678// main.jsconst &#123; ipcMain &#125; = require(&#x27;electron&#x27;);ipcMain.on(&#x27;render-send-sync-to-main&#x27;, (event, message) =&gt; &#123; console.log(`receive message from render: $&#123;message&#125;`) event.returnValue = &#x27;ä¸»è¿›ç¨‹å›å¤çš„æ¶ˆæ¯&#x27;; &#125;) 1ã€ä¸»è¿›ç¨‹é€šè¿‡ ipcMain.on æ¥å¤„ç†æ¸²æŸ“è¿›ç¨‹å‘é€çš„æ¶ˆæ¯ï¼› 2ã€ä¸»è¿›ç¨‹é€šè¿‡ event.returnValue å›å¤æ¸²æŸ“è¿›ç¨‹æ¶ˆæ¯ï¼› 3ã€å¦‚æœ event.returnValue ä¸ä¸º undefined çš„è¯ï¼Œæ¸²æŸ“è¿›ç¨‹ä¼šç­‰å¾… sendSync çš„è¿”å›å€¼æ‰æ‰§è¡Œåé¢çš„ä»£ç ï¼› 4ã€è¯·ä¿è¯ event.returnValueæ˜¯æœ‰å€¼çš„ï¼Œå¦åˆ™ä¼šé€ æˆéé¢„æœŸçš„å½±å“ã€‚ ä¸Šé¢çš„æ¡ˆä¾‹ï¼Œä¸»è¿›ç¨‹ç»‘å®šçš„å¤„ç†å‡½æ•°æ˜¯ä¸€ä¸ªåŒæ­¥çš„ï¼Œæˆ‘ä»¬å°†å®ƒæ¢ä¸ºå¼‚æ­¥çš„æ¥çœ‹çœ‹ï¼š 1234567891011121314151617// main.jsconst &#123; ipcMain &#125; = require(&#x27;electron&#x27;);ipcMain.on(&#x27;render-send-sync-to-main&#x27;, async (event, message) =&gt; &#123; console.log(`receive message from render: $&#123;message&#125;`) const result = await asyncWork(); event.returnValue = result;&#125;)const asyncWork = async () =&gt; &#123; return new Promise(resolve =&gt; &#123; setTimeout(() =&gt; &#123; resolve(&#x27;å»¶è¿Ÿ 2 ç§’è·å–åˆ°ä¸»è¿›ç¨‹çš„è¿”å›ç»“æœ&#x27;) &#125;, 2000) &#125;)&#125; è¿™æ¬¡æˆ‘ä»¬åœ¨æ‰§è¡Œå®Œä¸€ä¸ªå¼‚æ­¥å‡½æ•° asyncWork ä¹‹åå†ç»™ event.returnValue èµ‹å€¼ã€‚ ç»“æœå‘ç°æ¸²æŸ“è¿›ç¨‹é‚£è¾¹ä¼šåœ¨ 2 ç§’ä¹‹åæ‰æ‰“å°ï¼š 12&quot;replyMessage å»¶è¿Ÿ 2 ç§’è·å–åˆ°ä¸»è¿›ç¨‹çš„è¿”å›ç»“æœ&quot; è€Œä¸”å¯¹äºæ¸²æŸ“è¿›ç¨‹ï¼Œä»¥ä¸‹ä¸¤ç§å†™æ³•ï¼Œç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼š 1234567891011121314// render.jsconst &#123; ipcRenderer &#125; = require(&#x27;electron&#x27;);function sendSyncMessageToMain() &#123; const replyMessage = ipcRenderer.sendSync(&#x27;render-send-sync-to-main&#x27;, &#x27;æˆ‘æ˜¯æ¸²æŸ“è¿›ç¨‹é€šè¿‡ syncSend å‘é€ç»™ä¸»è¿›ç¨‹çš„æ¶ˆæ¯&#x27;); console.log(&#x27;replyMessage&#x27;, replyMessage); // &#x27;replyMessage å»¶è¿Ÿ 2 ç§’è·å–åˆ°ä¸»è¿›ç¨‹çš„è¿”å›ç»“æœ&#x27;&#x27;&#125;// æˆ–è€…æ”¹ç”¨ async å‡½æ•°async function sendSyncMessageToMain() &#123; const replyMessage = await ipcRenderer.sendSync(&#x27;render-send-sync-to-main&#x27;, &#x27;æˆ‘æ˜¯æ¸²æŸ“è¿›ç¨‹å‘é€ç»™ä¸»è¿›ç¨‹çš„åŒæ­¥æ¶ˆæ¯&#x27;); console.log(&#x27;replyMessage&#x27;, replyMessage); // &#x27;replyMessage å»¶è¿Ÿ 2 ç§’è·å–åˆ°ä¸»è¿›ç¨‹çš„è¿”å›ç»“æœ&#x27;&#125; ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸è®ºæ¸²æŸ“è¿›ç¨‹åœ¨æ¥æ”¶ sendSync ç»“æœçš„æ—¶å€™ï¼Œæ˜¯ä¸æ˜¯ç”¨ await ç­‰å¾…ï¼Œéƒ½ä¼šç­‰å¾…ç»“æœè¿”å›åæ‰å‘ä¸‹æ‰§è¡Œã€‚ä½†å¦‚æœä½ å·²ç»ç¡®å®šä½ çš„è¯·æ±‚æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„è¯ï¼Œå»ºè®®è¿˜æ˜¯ä½¿ç”¨ invoke å»å‘é€æ¶ˆæ¯ï¼Œè¿™é‡Œå‡ºäºä¸¤ç‚¹åŸå› è€ƒè™‘ï¼š 1ã€æ–¹æ³•å sendSync å°±å¾ˆç¬¦åˆè¯­ä¹‰ï¼Œå‘é€åŒæ­¥æ¶ˆæ¯ï¼› 2ã€è¯·æ±‚æ‰§è¡Œçš„æ˜æ˜æ˜¯å¼‚æ­¥ä»£ç ï¼Œä½†æ˜¯å¦‚æœä½ ç”¨ const replyMessage = ipcRenderer.sendSync(&#39;xxx&#39;) æ–¹å¼æ¥è·å–å“åº”ä¿¡æ¯ï¼Œä¼šå¾ˆå¥‡æ€ªã€‚ OKKï¼Œä¸Šé¢çš„ç¬¬å››ç‚¹è°ˆåˆ°äº†ï¼Œè¯·ä¿è¯ event.returnValue æ˜¯æœ‰å€¼çš„ï¼Œå¦åˆ™ä¼šç…§æˆéé¢„æœŸçš„å½±å“ã€‚è®©æˆ‘ä»¬ä¹Ÿæ¥å†™ä¸ªä¾‹å­ï¼š 1234567891011121314// render.jsconst &#123; ipcRenderer &#125; = require(&#x27;electron&#x27;);function sendSyncMessageToMain() &#123; const replyMessage = ipcRenderer.sendSync(&#x27;render-send-sync-to-main&#x27;, &#x27;æˆ‘æ˜¯æ¸²æŸ“è¿›ç¨‹é€šè¿‡ syncSend å‘é€ç»™ä¸»è¿›ç¨‹çš„æ¶ˆæ¯&#x27;); console.log(&#x27;replyMessage&#x27;, replyMessage); // replyMessage &#123;error: &quot;reply was never sent&quot;&#125; console.log(&#x27;next&#x27;); // è¿™é‡Œä¹Ÿä¼šæ‰§è¡Œ&#125;// main.jsipcMain.on(&#x27;render-send-sync-to-main&#x27;, async (event, message) =&gt; &#123; console.log(`receive message from render: $&#123;message&#125;`)&#125;) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¸»è¿›ç¨‹é‚£è¾¹ä¸å¯¹ event.returnValue åšå¤„ç†ï¼Œåœ¨æ¸²æŸ“è¿›ç¨‹è¿™è¾¹å°†ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼š 12&#123;error: &quot;reply was never sent&quot;&#125; è™½ç„¶ next ä¹Ÿä¼šæ‰“å°ï¼Œä½†æ˜¯å¦‚æœä½ å†æƒ³å»å‘é€ä¸€æ¬¡ render-send-sync-to-main ä½ ä¼šå‘ç°é¡µé¢å·²ç»å¡äº†â€¦ æ¸²æŸ“è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹(çª—å£ä¸çª—å£)çš„é€šè®¯ipcRenderer.sendTo + ipcRenderer.on ä¸¾ä¸ªä¾‹å­ï¼šBçª—å£ç»™ä½ Açª—å£å‘é€æ¶ˆæ¯ çª—å£A 123ipcRenderer.on(&#x27;B-to-A&#x27;,(event,message)=&gt;&#123; console.log(message)&#125;) çª—å£B 12const A_ID = ipcRenderer.sendSync(&#x27;getWinId&#x27;, &#x27;A&#x27;)ipcRenderer.sendTo(A_ID,&#x27;B-to-A&#x27;,&#x27;æˆ‘æ˜¯æ¥è‡ªBçª—å£çš„æ¶ˆæ¯&#x27;) æ¸²æŸ“è¿›ç¨‹å’Œwebviewçš„é€šè®¯ipcRenderer.sendToHost + webview.addEventListener(â€œipc-messageâ€)æ¸²æŸ“è¿›ç¨‹ 123456const webview = document.querySelector(&#x27;webview&#x27;);webview.addEventListener(&#x27;ipc-message&#x27;,(event, message)=&gt;&#123; console.log(message)&#125;)webview.send(&#x27;rende-to-webview&#x27;,&#x27;å‘ç»™webviewé‡Œå¤´çš„ç•Œé¢&#x27;); // ç»™webviewå‘æ¶ˆæ¯ webviewå†…åµŒçš„é¡µé¢ 123456import &#123; ipcRenderer &#125; from &#x27;electron&#x27;;ipcRenderer.on(&#x27;send-to&#x27;,(event,args)=&gt;&#123;\tconsole.log(&#x27;æ”¶åˆ°æ¸²æŸ“è¿›ç¨‹å‘æ¥çš„æ¶ˆæ¯&#x27;,args); ipcRenderer.sendToHost(&#x27;message&#x27;, &#x27;æˆ‘æ˜¯webviewå‘è¿‡æ¥çš„æ¶ˆæ¯&#x27;)&#125;) webview + preloadåè®® æä¾›æ¡¥æ¥æ–¹æ³•é€šè¿‡åˆ©ç”¨webviewçš„preloadå±æ€§ preload preloadå…¶å®æ˜¯ç›¸å½“äºä¸€ä¸ªé¡µé¢è¿è¡Œå…¶ä»–è„šæœ¬ä¹‹å‰ï¼Œå…ˆåŠ è½½çš„æŒ‡å®šè„šæœ¬ æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œwebviewçš„preloadå±æ€§æ¥å—çš„æ˜¯asarå’Œfileåè®®ï¼Œæ³¨å…¥jsè„šæœ¬ preload.js 123456789import &#123; ipcRenderer &#125; from &#x27;electron&#x27;;const Bridge = &#123; ...å„ç§æ–¹æ³•æˆ–è€…ä»€ä¹ˆå‚æ•° sayHi(data)&#123; ipcRenderer.send(&#x27;some-event&#x27;, dataÃ) &#125;&#125; global.Bridge = Bridge; // å°†Bridgeçš„å¯¹è±¡æ³¨å…¥åˆ°å…¨å±€å¯¹è±¡ä¸Šï¼Œwebviewæ‰“å¼€çš„æ—¶å€™æŒ‡çš„å°±æ˜¯window webviewå†…åµŒçš„é¡µé¢ 123const myBridge = window.Bridge;myBridge.sayHi(&#x27;æˆ‘æ˜¯webview&#x27;) å¤„ç†åœ°å€ 12const localPreloadFile = `file://$&#123;require(&#x27;path&#x27;).resolve(&#x27;./preload.js&#x27;)&#125;`webview.setAtrribute(&#x27;preload&#x27;,preloadFileÃ) é€šè¿‡æ¡¥æ¥çš„æ–¹æ³•ï¼Œå®ç°electronçš„é€šä¿¡æœºåˆ¶çš„è½¬å‘ï¼Œè¿›è€Œå®ç°webviewå’Œæ¸²æŸ“è¿›ç¨‹ä¹‹é—´çš„æ²Ÿé€š è¿›ç¨‹ç»Ÿä¸€å®ç°æ–¹æ¡ˆï¼ˆæš‚æœªå®Œå–„ï¼‰12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364import events from &quot;events&quot;;import &#123; ipcRenderer, ipcMain, webContents &#125; from &quot;electron&quot;;const PIPE_EVENT = &quot;__eventPipe&quot;;class Eventer &#123; constructor() &#123; this.instance = new events.EventEmitter(); this.instance.setMaxListeners(20); this.initEventPipe(); &#125; /** * @description: åˆå§‹åŒ–ç®¡é“é…ç½® */ initEventPipe() &#123; if (ipcRenderer) &#123; ipcRenderer.on(PIPE_EVENT, (e, &#123; eventName, eventArgs &#125;) =&gt; &#123; this.instance.emit(eventName, eventArgs); &#125;); &#125; if (ipcMain) &#123; ipcMain.handle(PIPE_EVENT, (e, &#123; eventName, eventArgs &#125;) =&gt; &#123; this.instance.emit(eventName, eventArgs); webContents.getAllWebContents().forEach((wc) =&gt; &#123; if (wc.id !== e.sender.id) &#123; wc.send(PIPE_EVENT, &#123; eventName, eventArgs &#125;); &#125; &#125;); &#125;); &#125; &#125; /** * @description: ç›‘å¬äº‹ä»¶ * @param &#123;*&#125; eventName äº‹ä»¶åç§° * @param &#123;*&#125; callBack å›è°ƒ * @return &#123;*&#125; */ on(eventName, callBack) &#123; this.instance.on(eventName, callBack); &#125; /** * @description: äº‹ä»¶è§¦å‘ * @param &#123;*&#125; eventName * @param &#123;*&#125; eventArgs */ emit(eventName, eventArgs) &#123; this.instance.emit(eventName, eventArgs); if (ipcMain) &#123; webContents.getAllWebContents().forEach((wc) =&gt; &#123; wc.send(PIPE_EVENT, &#123; eventName, eventArgs &#125;); &#125;); &#125; if (ipcRenderer) &#123; ipcRenderer.invoke(PIPE_EVENT, &#123; eventName, eventArgs &#125;); &#125; &#125;&#125;const event = new Eventer();export default event; ä¸»è¿›ç¨‹ 12345import eventer from &#x27;@/common/eventer&#x27;;eventer.on(&#x27;my-event&#x27;, (args)=&gt;&#123; console.log(args)&#125;) æ¸²æŸ“è¿›ç¨‹ 1234import eventer from &#x27;@/common/eventer&#x27;;eventer.emit(&#x27;my-event&#x27;,(args)=&gt;&#123; console.log(args);&#125;) ä¸€äº›ä½¿ç”¨è®°å½•æŒ‰é”®é…ç½®https://www.electronjs.org/zh/docs/latest/api/accelerator æ¸²æŸ“è¿›ç¨‹å’Œwebviewçš„é€šä¿¡12345678910111213const webview = document.querySelector(&#x27;webview&#x27;);webview.addEventListener(&#x27;dom-ready&#x27;,()=&gt;&#123;&#125;);webview.addEventListener(&#x27;ipc-message&#x27;, ()=&gt;&#123; webview.send(&#x27;sth&#x27;)&#125;)ipcRenderer.sendToHost(&#x27;sth&#x27;)// preloadconst preloadFile = &#x27;file://&#x27; + require(&#x27;path&#x27;).resolve(&#x27;./preload.js&#x27;);webview.setAttribute(&#x27;preload&#x27;, preloadFile); 12// å®¢æˆ·ç«¯const clientSocket = io(&#x27;http://127.0.0.1:3000/&#x27;) menuï¼ˆåº”ç”¨èœå•ï¼‰1234567891011121314151617181920212223242526272829303132333435363738394041const menuTemplate = [ IS_MAC &amp;&amp; &#123; label: &quot;ismac&quot; &#125;, // macOSä¸‹ç¬¬ä¸€ä¸ªæ ‡ç­¾æ˜¯åº”ç”¨ç¨‹åºåå­—,æ‰€ä»¥è¿™é‡Œæ˜¯ä¸ºäº†å…¼å®¹macçš„ &#123; label: &quot;é€‰é¡¹&quot;, submenu: [ &#123; label: &quot;é€€å‡º&quot;, role: &quot;quit&quot;, &#125;, &#123; label: &quot;æˆ‘çš„åšå®¢&quot;, click: createBlogWin, &#125;, isDevelopment &amp;&amp; &#123; label: &quot;æ‰“å¼€devTool&quot;, click: createDevTool, accelerator: &quot;CommandOrControl + shift + i&quot;, &#125;, ].filter(Boolean), &#125;, &#123; type: &quot;separator&quot; &#125;, // macä¸‹æ— æ•ˆ &#123; label: &quot;æ–‡ä»¶&quot;, submenu: [ &#123; label: &quot;å­èœå•&quot;, click: () =&gt; &#123; // è°ƒç”¨äº†dialogï¼ˆå¼¹çª—æ¨¡å—ï¼‰ï¼Œæ¼”ç¤ºæ•ˆæœ dialog.showMessageBoxSync(&#123; type: &quot;info&quot;, title: &quot;æç¤º&quot;, message: &quot;ç‚¹å‡»äº†å­èœå•&quot;, &#125;); &#125;, &#125;, ], &#125;,].filter(Boolean);const menu = Menu.buildFromTemplate(menuTemplate);Menu.setApplicationMenu(menu); æ¯”è¾ƒè¦æ³¨æ„çš„å°±æ˜¯macçš„ç¬¬ä¸€ä¸ªèœå•è¢«ç³»ç»Ÿè®¾ç½®ä¸ºäº†åº”ç”¨çš„åç§°ç­‰ç­‰ æ‰€ä»¥æœ€ä¸Šé¢çš„æ•°ç»„åŠ äº†ä¸€è¡Œmacç›¸å…³çš„æ˜¯é… cookieåŸºæœ¬ä½¿ç”¨12345678910const &#123; remote &#125; from &#x27;electron&#x27;;const getCookie = async (name)=&gt; &#123; let cookie = await remote.session.defautlSession.cookies.get(&#123;name&#125;); if(cookie.length) return cookies[0].value; else return &#x27;&#x27;&#125;const setCookie = async (cookie) =&gt; &#123; await remote.session.defautlSession.cookies.set(cookie)&#125; defaultSessionæ˜¯å½“å‰æµè§ˆå™¨ä¼šè¯çš„å¯¹è±¡å®ä¾‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡window.webContents.sessionè·å–sessionå¯¹è±¡ åˆ é™¤æµè§ˆå™¨ç¼“å­˜123await remote.session.defaultSession.cookie.clearStorageData(&#123; storages: &#x27;localstorage, cookie&#x27; // åˆ é™¤localStroageä¸­å’Œcookieçš„ç¼“å­˜æ•°æ®&#125;) storagesçš„å‚æ•°å¯ä»¥æŸ¥çœ‹ å®˜æ–¹æ–‡æ¡£ åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹ process.platform æ–‡æ¡£ 123import &#123; platform &#125; from &#x27;process&#x27;;console.log(`This platform is $&#123;platform&#125;`); â€˜aixâ€™ â€˜darwinâ€™ â€˜linuxâ€™ â€˜freebsdâ€™ â€˜openbsdâ€™ â€˜sunosâ€™ â€˜win32â€™ BrowserWindowwebSecurityå®˜æ–¹ ç¦ç”¨åŒæºç­–ç•¥ (é€šå¸¸ç”¨æ¥æµ‹è¯•ç½‘ç«™)ï¼Œè®¾ç½®falseç¦ç”¨ç½‘ç«™çš„åŒæºæ”¿ç­– ç¦ç”¨ webSecurity å°†ä¼šç¦æ­¢åŒæºç­–ç•¥å¹¶ä¸”å°† allowRunningInsecureContent å±æ€§ç½® trueã€‚ æ¢å¥è¯è¯´ï¼Œè¿™å°†ä½¿å¾—æ¥è‡ªå…¶ä»–ç«™ç‚¹çš„éå®‰å…¨ä»£ç è¢«æ‰§è¡Œã€‚ netè¯·æ±‚åº“ï¼ˆåŸç”Ÿï¼‰ ä¸»è¿›ç¨‹ å®˜æ–¹ä½¿ç”¨æ–‡æ¡£ dialogï¼ˆç³»ç»Ÿå¯¹è¯æ¡†ï¼‰ ä¸»è¿›ç¨‹ä½¿ç”¨ å®˜æ–¹ä½¿ç”¨æ–‡æ¡£ *ä½¿ç”¨webviewï¼ˆä¸ç¨³å®šï¼‰ å‡å¦‚è¦åœ¨é¡µé¢ä¸­ä½¿ç”¨webviewçš„è¯ï¼Œéœ€è¦è®¾ç½®BrowserWindow åˆå§‹åŒ–çš„æ—¶å€™çš„é…ç½® webviewTag: true å®˜æ–¹å»ºè®®æ–‡æ¡£ å®˜æ–¹ä½¿ç”¨æ–‡æ¡£ main.js 1234567891011const win = new BrowserWindow(&#123; width: 800, height: 600, webPreferences: &#123; nodeIntegration: true, contextIsolation: false, webviewTag: true &#125;&#125;) electroné¡¹ç›®ä¸­å¸¸ç”¨çš„åº“mousetrapæŒ‰é”®äº‹ä»¶çš„ç›‘å¬åº“ï¼Œç›‘å¬ç½‘é¡µçš„æŒ‰é”®äº‹ä»¶ SQLiteæŒä¹…åŒ–æ•°æ®æ¨èäºŒæ¬¡å°è£…åº“ node-sqlite3 ä¸‰æ¬¡å°è£…åº“ knextjs lowdbå’Œelectron-storeå°å‹çš„æ•°æ®å­˜å‚¨å·¥å…· ç¦»è°±çš„å‘æ§åˆ¶å°æ‰“å°ä¹±ç  è¿™ç§æƒ…å†µæ˜¯ç”±äºæ§åˆ¶å°è¾“å‡ºçš„ä¸æ˜¯UTF-8çš„ç¼–ç æ ¼å¼ ![image-20220112210828647](/Users/leo/Desktop/wengâ€™s code/wengâ€™blog/NollieLeo.github.io/source/_posts/electronå­¦ä¹ è®°å½•\\image-20220112210828647.png) è§£å†³ï¼š æ‰§è¡Œstartçš„è„šæœ¬ä¸­åŠ å…¥ 1&quot;start&quot;: &quot;chcp 65001 &amp;&amp; ....&quot; electronçš„åŒ…è£…ä¸ä¸Šè§£å†³ï¼šå°†electronåŒ…çš„æºæ”¹ä¸ºå›½å†…çš„æºï¼š .npmrcæ–‡ä»¶ä¸­å¼ºåˆ¶æŒ‡å®šæº 1electron_mirror=&quot;https://npm.taobao.org/mirrors/electron/&quot;","tags":["Vue","electron"]},{"title":"æ‰‹å†™promise allSettled","path":"/2021/12/13/æ‰‹å†™promise-allSettled/","content":"Promise allSettled12345678910111213141516171819202122232425262728293031323334353637383940414243444546// Promise allSettledPromise._allSettled = function (taskArr) &#123; return new Promise((resolve, reject) =&gt; &#123; const result = []; // ç»“æœæ•°ç»„ let count = 0; // è®¡æ•°ï¼Œå½“countç­‰äºtaskArrçš„é•¿åº¦çš„æ—¶å€™ï¼Œè¯´æ˜éƒ½å¤„ç†å®Œè¿™äº›promiseäº† taskArr.forEach((task, index) =&gt; &#123; if (!(task instanceof Promise)) task = Promise.resolve(task); task.then((value) =&gt; &#123; result[index] = &#123; status: &#x27;fullfilled&#x27;, value &#125; count++; if (count === taskArr.length) &#123; resolve(result) &#125; &#125;, (reason) =&gt; &#123; result[index] = &#123; status: &#x27;rejected&#x27;, reason &#125; count++; if (count === taskArr.length) &#123; resolve(result) &#125; &#125;) &#125;) &#125;)&#125;Promise._allSettled([ () =&gt; &#x27;æˆ‘ä¸æ˜¯ä¸€ä¸ªpromise&#x27;, Promise.resolve(12121), new Promise((resolve) =&gt; &#123; setTimeout(() =&gt; &#123; resolve(&#x27;motherfucker&#x27;) &#125;, 4000); &#125;), new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; reject(&#x27;hello&#x27;) &#125;, 3000); &#125;)]).then((data) =&gt; &#123; console.log(data);&#125;)","tags":["Javascript","Promise"],"categories":["Javascript"]},{"title":"æ‰‹å†™promise race","path":"/2021/12/13/æ‰‹å†™promise-race/","content":"Promise Race12345678910111213// Promise raceå®ç°Promise._race = function (taskArr) &#123; return new Promise((resolve, reject) =&gt; &#123; for (const iterator of taskArr) &#123; Promise.resolve(iterator).then((data) =&gt; &#123; resolve(data); &#125;, (err) =&gt; &#123; reject(err); return &#125;) &#125; &#125;)&#125;","tags":["Promise"],"categories":["Javascript"]},{"title":"æ‰‹å†™primise all","path":"/2021/12/13/æ‰‹å†™primise-all/","content":"æ‰‹å†™Promise all1234567891011121314151617181920212223242526272829303132333435363738// Promise allçš„å®ç°Promise._all = function (tasks) &#123; return new Promise((resolve, reject) =&gt; &#123; if (!tasks || !tasks.length) &#123; return [] &#125; // ç»“æœæ•°ç»„ let result = []; // åšæ•°é‡è®°å½• let count = 0; for (let i = 0; i &lt; tasks.length; i++) &#123; const element = tasks[i]; // å½“å‰çš„ä»»åŠ¡ Promise.resolve(element).then( // éœ€è¦ç”¨PromiseåŒ…è£¹ä»¥é˜²æ­¢å½“å‰taskå¹¶ä¸æ˜¯ç”¨Promiseå°è£…çš„ (data) =&gt; &#123; result[i] = data; if (++count === tasks.length) &#123; resolve(result) &#125; &#125;, (err) =&gt; &#123; reject(err); return; &#125;) &#125; &#125;)&#125;Promise._all([ Promise.resolve(11211), Promise.resolve(21213212312), new Promise((resolve) =&gt; setTimeout(() =&gt; &#123; resolve(&#x27;å»¶æ—¶&#x27;) &#125;, 1000))]).then((data) =&gt; &#123; console.log(data);&#125;)","tags":["Promise"],"categories":["Javascript"]},{"title":"æ‰‹å†™JSå¹¶å‘æ§åˆ¶ï¼ˆasyncPoolï¼‰","path":"/2021/12/13/æ‰‹å†™JSå¹¶å‘æ§åˆ¶ï¼ˆasyncPoolï¼‰/","content":"å¹¶å‘æ§åˆ¶1234567891011121314151617181920212223242526272829303132333435363738394041424344// limiteNum: å¹¶å‘æ•°ç›®// tasks: éœ€è¦å¤„ç†çš„ä»»åŠ¡åˆ—è¡¨// iteraterFn: å®Œæˆçš„å¤„ç†å‡½æ•°// å¹¶å‘æ§åˆ¶ä»»åŠ¡const ayncPool = async (limiteNum, tasks, iteraterFn) =&gt; &#123; // æ‰€æœ‰çš„ä»»åŠ¡é˜Ÿåˆ— const rect = []; // æ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡é˜Ÿåˆ— const pendingTasks = []; // è¿™é‡Œä½¿ç”¨for ofè€Œä¸æ˜¯ç”¨foreachçš„åŸå› æ˜¯ // forEach await æ—¶å€™å¹¶ä¸ä¼šåœæ­¢éå† for (const task of tasks) &#123; // è¿™é‡Œå¯¹å¤–å±‚çš„ç»“æŸå¤„ç†å‡½æ•°åŒ…è£¹ä¸€å±‚promise let promiseTask = Promise.resolve().then(() =&gt; iteraterFn(task, tasks)); // rectå»å­˜å‚¨äº†promiseTask rect.push(promiseTask); if (limiteNum &lt;= tasks.length) &#123; const excutingTask = promiseTask.then(() =&gt; pendingTasks.splice(pendingTasks.indexOf(excutingTask), 1)) pendingTasks.push(excutingTask) if (pendingTasks.length &gt;= limiteNum) &#123; // è¿™é‡Œå»è·å–è·‘çš„æœ€å¿«çš„ä¸€ä¸ªtask await Promise.race(pendingTasks); &#125; &#125; &#125; return Promise.all(rect)&#125;const iterater = (i) =&gt; &#123; return new Promise((resolve) =&gt; &#123; setTimeout(() =&gt; &#123; resolve(i); console.log(i); &#125;, i); &#125;)&#125;ayncPool(2, [1000, 5000, 3000, 2000], iterater).then((data) =&gt; &#123; console.log(data)&#125;)","tags":["Primise","all","race"],"categories":["Javascript"]},{"title":"æ‰‹å†™å‘å¸ƒè®¢é˜…","path":"/2021/12/13/æ‰‹å†™å‘å¸ƒè®¢é˜…/","content":"123456789101112131415161718192021222324252627282930313233343536373839404142434445464748 // å‘å¸ƒè®¢é˜…class EventEmitter &#123; constructor() &#123; this.cache = &#123;&#125; &#125; // è®¢é˜…äº‹ä»¶ on(name, callback, once = false) &#123; if (!this.cache[name]) &#123; this.cache[name] = [] &#125; this.cache[name].push(&#123; callback, once &#125;) &#125; // åªè®¢é˜…ä¸€æ¬¡ once(name, callback) &#123; this.on(name, callback, true) &#125; // å‘å¸ƒ emit(name, ...rest) &#123; if (!this.cache[name]) &#123; return &#125; this.cache[name].forEach((param, index) =&gt; &#123; const &#123; once, callback &#125; = param; if (once) &#123; this.cache[name].splice(index, 1); if (!this.cache[name]?.length) delete this.cache[name] &#125; callback.call(this, ...rest) &#125;) &#125; // å–æ¶ˆè®¢é˜… off(name, callback) &#123; if (!name) &#123; this.cache = &#123;&#125;; return; &#125; if (!callback) &#123; delete this.cache[name]; return &#125; if (!this.cache[name]) &#123; return &#125; const i = this.cache[name].findIndex((f) =&gt; f.callback === callback) this.cache[name].splice(i, 1); if (!this.cache[name].length) delete this.cache[name] &#125;&#125;","tags":["Javascript","EventEmitter","å‘å¸ƒè®¢é˜…"],"categories":["Javascript"]},{"title":"æ‰‹å†™curry","path":"/2021/12/13/æ‰‹å†™curry/","content":"è¦æ±‚å®ç°å¦‚ä¸‹ 1234const add = (a, b, c) =&gt; a + b + c;const a1 = currying(add, 1);const a2 = a1(2);console.log(a2(3)) // 6 12345678910111213141516// curry profunction curryPro(fn, ...outerProps) &#123; function curried(...middleProps) &#123; const concatArr = [...middleProps]; if (concatArr.length &gt;= fn.length) &#123; return fn.call(this, ...concatArr) &#125; return function (...innerProps) &#123; return curried.call(this, ...concatArr.concat(innerProps)) &#125; &#125; if(outerProps.length)&#123; return curried(...outerProps); &#125; return curried&#125;","tags":["curry"],"categories":["Javascript"]},{"title":"æ‰‹å†™compose","path":"/2021/12/13/æ‰‹å†™compose/","content":"composeç®€ä»‹composeå°±æ˜¯æ‰§è¡Œä¸€ç³»åˆ—çš„ä»»åŠ¡ï¼ˆå‡½æ•°ï¼‰ï¼Œæ¯”å¦‚æœ‰ä»¥ä¸‹ä»»åŠ¡é˜Ÿåˆ— 12let tasks = [step1, step2, step3, step4] æ¯ä¸€ä¸ªstepéƒ½æ˜¯ä¸€ä¸ªæ­¥éª¤ï¼ŒæŒ‰ç…§æ­¥éª¤ä¸€æ­¥ä¸€æ­¥çš„æ‰§è¡Œåˆ°ç»“å°¾ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªcompose composeåœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„å·¥å…·å‡½æ•°ï¼Œåœ¨è¿™é‡Œå®ç°çš„composeæœ‰ä¸‰ç‚¹è¯´æ˜ ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯å¤šå…ƒçš„ï¼ˆæ¥å—å¤šä¸ªå‚æ•°ï¼‰ï¼Œåé¢çš„å‡½æ•°éƒ½æ˜¯å•å…ƒçš„ï¼ˆæ¥å—ä¸€ä¸ªå‚æ•°ï¼‰ æ‰§è¡Œé¡ºåºçš„è‡ªå³å‘å·¦çš„ æ‰€æœ‰å‡½æ•°çš„æ‰§è¡Œéƒ½æ˜¯åŒæ­¥çš„ è¿˜æ˜¯ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´ï¼Œæ¯”å¦‚æœ‰ä»¥ä¸‹å‡ ä¸ªå‡½æ•° 1234let init = (...args) =&gt; args.reduce((ele1, ele2) =&gt; ele1 + ele2, 0)let step2 = (val) =&gt; val + 2let step3 = (val) =&gt; val + 3let step4 = (val) =&gt; val + 4 è¿™å‡ ä¸ªå‡½æ•°ç»„æˆä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ— 1steps = [step4, step3, step2, init] ä½¿ç”¨composeç»„åˆè¿™ä¸ªé˜Ÿåˆ—å¹¶æ‰§è¡Œ 123let composeFunc = compose(...steps)console.log(composeFunc(1, 2, 3)) æ‰§è¡Œè¿‡ç¨‹ 16 -&gt; 6 + 2 = 8 -&gt; 8 + 3 = 11 -&gt; 11 + 4 = 15 æ‰€ä»¥æµç¨‹å°±æ˜¯ä»initè‡ªå³åˆ°å·¦ä¾æ¬¡æ‰§è¡Œï¼Œä¸‹ä¸€ä¸ªä»»åŠ¡çš„å‚æ•°æ˜¯ä¸Šä¸€ä¸ªä»»åŠ¡çš„è¿”å›ç»“æœï¼Œå¹¶ä¸”ä»»åŠ¡éƒ½æ˜¯åŒæ­¥çš„ï¼Œè¿™æ ·å°±èƒ½ä¿è¯ä»»åŠ¡å¯ä»¥æŒ‰ç…§æœ‰åºçš„æ–¹å‘å’Œæœ‰åºçš„æ—¶é—´æ‰§è¡Œã€‚ æ‰‹å†™12345678910111213// composefunction compose(...args) &#123; const fnArr = Array.from(args); let result; return function composer(...rest) &#123; const current = fnArr.shift(); result = current.call(this, ...rest); if (!fnArr.length) &#123; return result &#125; return composer(result) &#125;&#125;","tags":["compose"],"categories":["Javascript"]},{"title":"æ·±æ‹·è´æœ€æ–°ä¼˜åŒ–ä»£ç ","path":"/2021/12/12/æ·±æ‹·è´æœ€æ–°ä¼˜åŒ–ä»£ç /","content":"123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109const map = new WeakMap() const handleArrAndObject = (varias) =&gt; &#123; const constructor = Object.getPrototypeOf(varias).constructor; const object = new constructor(); for (const key in varias) &#123; if (Object.hasOwnProperty.call(varias, key)) &#123; const element = varias[key]; object[key] = deepClone(element) &#125; &#125; return object; &#125; const handleMap = (varias) =&gt; &#123; const constructor = Object.getPrototypeOf(varias).constructor; const currentMap = new constructor(); varias.forEach((value, key) =&gt; &#123; currentMap.set(deepClone(key), deepClone(value)) &#125;) return currentMap &#125; const handleSet = (varias) =&gt; &#123; const constructor = Object.getPrototypeOf(varias).constructor; const currentSet = new constructor(); varias.forEach((value) =&gt; &#123; currentSet.set(deepClone(value)) &#125;) return currentSet &#125; const handleRegx = (varias) =&gt; &#123; const constructor = Object.getPrototypeOf(varias).constructor; const &#123; flags, source &#125; = varias; const currentRegx = new constructor(source, flags); return currentRegx; &#125; const handleOthers = (varias) =&gt; &#123; const constructor = Object.getPrototypeOf(varias).constructor; return new constructor(Object.prototype.valueOf.call(varias)); &#125; const handleFn = (vaira) =&gt; &#123; return vaira; &#125; const cloneMap = &#123; &#x27;[object Array]&#x27;: handleArrAndObject, &#x27;[object Object]&#x27;: handleArrAndObject, &#x27;[object Map]&#x27;: handleMap, &#x27;[object WeakMap]&#x27;: handleMap, &#x27;[object Set]&#x27;: handleSet, &#x27;[object WeakSet]&#x27;: handleSet, &#x27;[object RegExp]&#x27;: handleRegx, &#x27;[object Function]&#x27;: handleFn, &#125; const getStringType = (varias) =&gt; &#123; return Object.prototype.toString.call(varias); &#125; const getCloneVarias = (varias) =&gt; &#123; let fn = handleOthers; const stringType = getStringType(varias); if (cloneMap.hasOwnProperty(stringType)) &#123; fn = cloneMap[stringType] &#125; return fn?.(varias); &#125; const isObject = (target) =&gt; &#123; return typeof target === &quot;object&quot; &amp;&amp; target !== null; &#125; function deepClone(obj) &#123; if (!isObject(obj)) &#123; return obj; &#125; if (map.get(obj)) &#123; return obj &#125; map.set(obj, true) return getCloneVarias(obj) &#125; const obj = &#123; arr: [1212, 121], name: &#x27;weng&#x27;, name2: new String(&#x27;weng&#x27;), map: new Map(), set: new Set(), date: Date.now(), regexp: new RegExp(), string: new String(), sayHi: () =&gt; &#123; &#125;, sayMyName: function () &#123; &#125; &#125; obj.target = obj; const obj3 = deepClone(obj); obj3.arr[1] = &#x27;wahahahah&#x27;; console.log(obj, obj3)","tags":["Javascript","æ·±æ‹·è´"],"categories":["Javascript"]},{"title":"è‡ªå®šä¹‰loaderè®°å½•","path":"/2021/10/10/è‡ªå®šä¹‰loaderè®°å½•/","content":"è°ƒè¯•loader1. å‡†å¤‡å¥½è‡ªå·±çš„webpackå’Œloaderè¿™é‡Œæˆ‘ç”¨çš„é¡¹ç›®æ˜¯æˆ‘è‡ªå·±çš„ webpack template 2. vscodeé…ç½®debugé…ç½®æ–‡ä»¶æŒ‰ç…§è¿™ä¸ªæ­¥éª¤é…ç½®å®Œä¼šç”Ÿæˆä¸€ä¸ª.vscodeæ–‡ä»¶å¤¹ä¸‹é¢æœ‰ä¸ªlaunch.jsonæ–‡ä»¶ ç„¶åæ›¿æ¢å®ƒ 1234567891011121314151617&#123; &quot;version&quot;: &quot;0.2.0&quot;, &quot;configurations&quot;: [ &#123; &quot;type&quot;: &quot;node&quot;, &quot;request&quot;: &quot;launch&quot;, &quot;name&quot;: &quot;Webpack Debug&quot;, &quot;cwd&quot;: &quot;$&#123;workspaceFolder&#125;&quot;, &quot;runtimeExecutable&quot;: &quot;npm&quot;, &quot;runtimeArgs&quot;: [ &quot;run&quot;, &quot;debug&quot; ], &quot;port&quot;: 5858 &#125; ]&#125; åˆ©ç”¨ä»¥ä¸Šé…ç½®ä¿¡æ¯ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª Webpack Debug çš„è°ƒè¯•ä»»åŠ¡ã€‚å½“è¿è¡Œè¯¥ä»»åŠ¡çš„æ—¶å€™ï¼Œä¼šåœ¨å½“å‰å·¥ä½œç›®å½•ä¸‹æ‰§è¡Œ npm run debug å‘½ä»¤ã€‚å› æ­¤ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åœ¨ package.json æ–‡ä»¶ä¸­å¢åŠ  debug å‘½ä»¤ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š 12345&#123; &quot;scripts&quot;: &#123; &quot;debug&quot;: &quot;webpack --config build/webpack.dev.js&quot; &#125;&#125; 3. æŠŠè‡ªå®šä¹‰loaderå†™é“è‡ªå·±çš„ruleé‡Œå¤´ ç„¶åæ‰“æ–­ç‚¹ 4.å¯åŠ¨è°ƒè¯•","tags":["webpack","webpack-loader"],"categories":["webpack-loader"]},{"title":"è‡ªå®šä¹‰è„šæ‰‹æ¶æ­å»ºè®°å½•","path":"/2021/09/05/è‡ªå®šä¹‰è„šæ‰‹æ¶æ­å»ºè®°å½•/","content":"é¦–å…ˆå…ˆçŸ¥é“æœ‰å“ªäº›å·¥å…·å¯ä»¥ç”¨ åç§° ç®€ä»‹ commander å‘½ä»¤è¡Œè‡ªå®šä¹‰æŒ‡ä»¤ inquirer å‘½ä»¤è¡Œè¯¢é—®ç”¨æˆ·é—®é¢˜ï¼Œè®°å½•å›ç­”ç»“æœ chalk æ§åˆ¶å°è¾“å‡ºå†…å®¹æ ·å¼ç¾åŒ– ora æ§åˆ¶å° loading æ ·å¼ figlet æ§åˆ¶å°æ‰“å° logo easy-table æ§åˆ¶å°è¾“å‡ºè¡¨æ ¼ download-git-repo ä¸‹è½½è¿œç¨‹æ¨¡ç‰ˆ fs-extra ç³»ç»Ÿfsæ¨¡å—çš„æ‰©å±•ï¼Œæä¾›äº†æ›´å¤šä¾¿åˆ©çš„ APIï¼Œå¹¶ç»§æ‰¿äº†fsæ¨¡å—çš„ API cross-spawn æ”¯æŒè·¨å¹³å°è°ƒç”¨ç³»ç»Ÿä¸Šçš„å‘½ä»¤ plop è½»é‡çº§å¿«é€Ÿæ„å»ºæ¨¡æ¿ å‚è€ƒæ–‡ç« å‰ç«¯é»‘ç§‘æŠ€ç¯‡ç« ä¹‹plopï¼Œè®©ä½ ä¹Ÿæ‹¥æœ‰è‡ªå·±çš„è„šæ‰‹æ¶ ä» 0 æ„å»ºè‡ªå·±çš„è„šæ‰‹æ¶/CLIçŸ¥è¯†ä½“ç³»","tags":["commander","nodejs","plop","inquirer","ora","figlet","easy-table"]},{"title":"å‰ç«¯é¢è¯•çŸ¥è¯†æ•´ç†","path":"/2021/08/30/å‰ç«¯é¢è¯•çŸ¥è¯†æ•´ç†/","content":"æ•´åˆç‰ˆæ‰‹æ’•é’‰é’‰å‰ç«¯è€ƒè¯•å·ï¼Œofferï¼Œæ‹¿æ¥å§ä½ ~ Reactã€Œ2021ã€é«˜é¢‘å‰ç«¯é¢è¯•é¢˜æ±‡æ€»ä¹‹Reactç¯‡ï¼ˆä¸Šï¼‰ ã€Œ2021ã€é«˜é¢‘å‰ç«¯é¢è¯•é¢˜æ±‡æ€»ä¹‹Reactç¯‡ï¼ˆä¸‹ï¼‰ htmlã€Œ2021ã€é«˜é¢‘å‰ç«¯é¢è¯•é¢˜æ±‡æ€»ä¹‹HTMLç¯‡ htmlç¯‡â€“è¿™å¯èƒ½æ˜¯ç›®å‰è¾ƒä¸ºå…¨é¢çš„htmlé¢è¯•çŸ¥è¯†ç‚¹äº†å§ JSç¯‡javascriptç¯‡â€“1.6ä¸‡å­—å¸¦ä½ å›å¿†é‚£äº›é—å¿˜çš„JSçŸ¥è¯†ç‚¹ ã€Œ2021ã€é«˜é¢‘å‰ç«¯é¢è¯•é¢˜æ±‡æ€»ä¹‹JavaScriptç¯‡ï¼ˆä¸Šï¼‰ ã€Œ2021ã€é«˜é¢‘å‰ç«¯é¢è¯•é¢˜æ±‡æ€»ä¹‹JavaScriptç¯‡ï¼ˆä¸‹ï¼‰ JSæ‰‹å†™ç¯‡ CSSã€Œ2021ã€é«˜é¢‘å‰ç«¯é¢è¯•é¢˜æ±‡æ€»ä¹‹CSSç¯‡ cssç¯‡â€“100é“è¿‘ä¸¤ä¸‡å­—å¸®ä½ å·©å›ºcssçŸ¥è¯†ç‚¹ å‰ç«¯å“åº”å¼å¸ƒå±€åŸç†ä¸æ–¹æ¡ˆï¼ˆè¯¦ç»†ç‰ˆï¼‰ æ¨¡å—åŒ–è¯¦è§£æ¨¡å—åŒ– TypeScriptä¸€ä»½ä¸å¯å¤šå¾—çš„ TS å­¦ä¹ æŒ‡å—ï¼ˆ1.8Wå­—ï¼‰ TypeScript é«˜çº§ç”¨æ³• æ‰‹æ’•tsé¢è¯•é¢˜â€”â€”ä¸èƒ½ä¸æŒæ¡çš„tsé«˜çº§ç‰¹æ€§ï¼ˆä¸‰ï¼‰ typescriptä¸èƒ½ä¸æŒæ¡çš„é«˜çº§ç‰¹æ€§ï¼ˆäºŒï¼‰ webpackã€Œåè¡€æ•´ç†ã€å†æ¥ä¸€æ‰“Webpacké¢è¯•é¢˜ package.jsonä½ çœŸçš„äº†è§£package.jsonå—ï¼Ÿæ¥çœ‹çœ‹å§ï¼Œè¿™å¯èƒ½æ˜¯æœ€å…¨çš„packageè§£æ ç½‘ç»œå­—èŠ‚è·³åŠ¨æœ€çˆ±è€ƒçš„å‰ç«¯é¢è¯•é¢˜ï¼šè®¡ç®—æœºç½‘ç»œåŸºç¡€ HTTP/HTTPSã€ŒæŸ¥ç¼ºè¡¥æ¼ã€å·©å›ºä½ çš„HTTPçŸ¥è¯†ä½“ç³» TCP(å»ºè®®æ”¶è—)TCPåè®®çµé­‚ä¹‹é—®ï¼Œå·©å›ºä½ çš„ç½‘è·¯åº•å±‚åŸºç¡€ å‰ç«¯è·¨åŸŸä¹ç§è·¨åŸŸæ–¹å¼å®ç°åŸç†ï¼ˆå®Œæ•´ç‰ˆï¼‰ å‰ç«¯å®‰å…¨å‰ç«¯å®‰å…¨ç³»åˆ—ï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•é˜²æ­¢XSSæ”»å‡»ï¼Ÿ å‰ç«¯å®‰å…¨ç³»åˆ—ä¹‹äºŒï¼šå¦‚ä½•é˜²æ­¢CSRFæ”»å‡»ï¼Ÿ å‰ç«¯é¢è¯•æŸ¥æ¼è¡¥ç¼ºâ€“(ä¸ƒ) XSSæ”»å‡»ä¸CSRFæ”»å‡» æµè§ˆå™¨åƒåœ¾å›æ”¶æœºåˆ¶ã€Œç¡¬æ ¸JSã€ä½ çœŸçš„äº†è§£åƒåœ¾å›æ”¶æœºåˆ¶å— å‰ç«¯æ€§èƒ½ä¼˜åŒ–SEOSEO","tags":["é¢è¯•"],"categories":["é¢è¯•"]},{"title":"Reactæºç å­¦ä¹ -renderé˜¶æ®µ-mounté€’å½’-part6","path":"/2021/08/23/Reactæºç å­¦ä¹ -renderé˜¶æ®µ-mounté€’å½’-part6/","content":"è¿™é‡Œè¯´ä¸€ä¸‹ mountæ—¶å€™çš„beginWorkå’ŒcompleteWorkçš„æµç¨‹å§ mounté€’å½’æ–­ç‚¹è°ƒè¯•renderé˜¶æ®µçš„é€’é˜¶æ®µèµ·ç‚¹æ˜¯beginWorkï¼Œå½’é˜¶æ®µçš„èµ·ç‚¹æ˜¯completeWorkï¼Œé‚£æˆ‘ä»¬å°±åœ¨æºç ä¸Šæ‰“æ–­ç‚¹ã€‚ åº”ç”¨demoå¦‚ä¸‹ åˆ·æ–°é¡µé¢æ­£å¼è¿›å…¥è°ƒè¯•ã€‚ 1.å‘ç°ç¬¬ä¸€æ¬¡è¿›å…¥é¡µé¢beginWorkä¸­ï¼Œcurrentæœ‰å€¼ï¼Œå¹¶ä¸”æ­¤æ—¶çš„tagæ˜¯ç­‰äº3çš„ï¼Œä¹‹å‰è¯´çš„æˆ‘ä»¬åœ¨createFiberRootçš„é‚£ä¸ªé˜¶æ®µè¿™ä¸ªtagä¹Ÿç­‰äºä¸‰ï¼Œæˆ‘ä»¬ä¸å¦¨çŒœæµ‹è¿™ä¸ªtagä¸º3æŒ‡çš„æ˜¯ fiberRootNode æ‰¾åˆ°react-reconcileråŒ…ä¸‹çš„ReactWorkTagï¼Œå¯ä»¥çœ‹åˆ°tag = 3å¯¹åº”çš„æ˜¯å« HostRootçš„tag 2.ç‚¹å‡»ä¸‹ä¸€ä¸ªæ–­ç‚¹ æˆ‘ä»¬å‘ç°currentçš„å€¼ä¸ºnullï¼ˆä¹‹å‰è¯´è¿‡ï¼Œåªæœ‰æ ¹èŠ‚ç‚¹æ‰å­˜åœ¨currentå€¼ï¼Œè€Œå…¶ä»–èŠ‚ç‚¹åªå­˜åœ¨workInProgressï¼‰ ä¸”å½“å‰èŠ‚ç‚¹çš„elementTypeä¸ºfunction App()ï¼Œä¹Ÿå°±æ˜¯å†™çš„ä¸€ä¸ªappå‡½æ•° ä¹‹åå°±æ˜¯diväº†ï¼Œç„¶åæ˜¯divçš„å­èŠ‚ç‚¹header ä¹‹ååˆæƒ³èµ°headerçš„å­èŠ‚ç‚¹titleï¼ˆå…¶å®è¿™é‡Œç®—ä¸ä¸Šæ˜¯å­èŠ‚ç‚¹ï¼Œåªæ˜¯ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼Œreactå¯¹æ–‡æœ¬èŠ‚ç‚¹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ— è‡ªå·±çš„beginWorkï¼Œreactä¼šå¯¹åªæœ‰å”¯ä¸€ä¸€ä¸ªæ–‡æœ¬å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œåšäº†ä¼˜åŒ–ï¼Œè¿™æ ·è¿™ä¸ªæ–‡æœ¬èŠ‚ç‚¹æ— è‡ªå·±çš„fiberèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä¸èµ°beginWorkï¼‰ å› ä¸ºheaderçš„æ–‡æœ¬èŠ‚ç‚¹ä¸ç®—ï¼Œæ‰€ä»¥ç›´æ¥è¿›å…¥äº†headerèŠ‚ç‚¹çš„completeWorkçš„é˜¶æ®µ ä¹‹åheader å½’é˜¶æ®µç»“æŸï¼Œä¼šå»æ‰¾headerçš„siblingï¼Œä¹Ÿå°±æ˜¯å…„å¼ŸèŠ‚ç‚¹ï¼Œå…„å¼ŸèŠ‚ç‚¹è¿›å…¥beginWorkï¼ˆé€’é˜¶æ®µï¼‰ å°±è¿™æ ·ä»¥æ­¤å¾€å¤æ·±åº¦ä¼˜å…ˆéå† ä¹‹åèµ°å®Œmainï¼Œå‘ç°mainæ— å…„å¼Ÿäº†ï¼Œå°±å¼€å§‹èµ°mainçˆ¶èŠ‚ç‚¹çš„completeWorké˜¶æ®µä¹Ÿå°±æ˜¯divï¼Œç„¶åå°±è¿™æ ·ä¸€ç›´èµ°ï¼Œèµ°åˆ°äº†Appçš„completeWorkç„¶åèµ°åˆ°äº† rootFiberç»“æŸ è¿™æ—¶å€™ä¸€ä¸ªrenderé˜¶æ®µå°±ç»“æŸäº† beginWorkåšäº†å•¥ï¼Ÿè¿™é‡Œæˆ‘ä»¬ä»¥ èµ°åˆ°ç¬¬äºŒæ­¥çš„divèŠ‚ç‚¹ä¸¾ä¾‹å­ 1. ä¾ç…§tagåˆ¤æ–­componentç±»å‹é¦–å…ˆæ ¹æ®å½“å‰çš„workInProgressçš„tagè¿›å…¥ä¸åŒçš„Componentå¤„ç†é€»è¾‘ è¿™é‡Œçš„divèŠ‚ç‚¹ï¼Œtagä¸º5ï¼Œè¿›å…¥çš„æ˜¯ HostComponentçš„å¤„ç†é€»è¾‘ 2. updateHostComponents$1é¦–å…ˆä¼šå¯¹ä¸€äº›å‚æ•°åšèµ‹å€¼æ“ä½œï¼Œä¹‹åç”¨isDirectTextChildå­—æ®µåˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦åªæœ‰ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼ˆä¸Šé¢æåˆ°äº†ï¼‰ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸ä¼šå»åˆ›å»ºè¿™ä¸ªæ–‡æœ¬èŠ‚ç‚¹çš„fiberï¼Œç®—æ˜¯reactçš„ä¸€ä¸ªä¼˜åŒ–æ‰‹æ®µ 3. reconcileChildrenä»åå­—å¯ä»¥çœ‹å‡ºè¿™ä¸ªç©æ„åº”è¯¥æ˜¯reconcilerè°ƒè¯•å™¨çš„æ¯”è¾ƒé‡è¦çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å°±æ˜¯ç”¨æ¥åˆ›å»ºå½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„ å¯¹äºmountçš„ç»„ä»¶ï¼Œä»–ä¼šåˆ›å»ºæ–°çš„å­FiberèŠ‚ç‚¹ å¯¹äºupdateçš„ç»„ä»¶ï¼Œä»–ä¼šå°†å½“å‰ç»„ä»¶ä¸è¯¥ç»„ä»¶åœ¨ä¸Šæ¬¡æ›´æ–°æ—¶å¯¹åº”çš„FiberèŠ‚ç‚¹æ¯”è¾ƒï¼ˆä¹Ÿå°±æ˜¯ä¿—ç§°çš„Diffç®—æ³•ï¼‰ï¼Œå°†æ¯”è¾ƒçš„ç»“æœç”Ÿæˆæ–°FiberèŠ‚ç‚¹ å¦‚æœå½“å‰ä¸å­˜åœ¨currentå°±èµ°mountChildFibersï¼Œå¦è€…å°±èµ°reconcileChildFibers ä¹Ÿå°±æ˜¯è¯´å­˜åœ¨currentçš„æ—¶å€™æ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¹èŠ‚ç‚¹äº† æˆ‘ä»¬æ‰¾åˆ°ReactChildFiberè¿™ä¸ªæ–‡ä»¶ æ‰¾åˆ°reconcileChildFiberså’Œ mountChildFibers ä»ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå’ŒbeginWorkä¸€æ ·ï¼Œä»–ä¹Ÿæ˜¯é€šè¿‡current === null ?åŒºåˆ†mountä¸updateã€‚ å‘ç°è¿™ä¸¤ä¸ªèµ°çš„éƒ½æ˜¯åŒä¸€ä¸ªå‡½æ•°ï¼Œåªæ˜¯å‚æ•°ä¸ä¸€æ · 4. æ‰“ä¸Šä¸ä¸€æ ·çš„effectTagæˆ–è€…ç›´æ¥returnä¸Šé¢çš„ childReconcilerçš„å‚æ•° ä»£è¡¨çš„æ˜¯å¦è¿½è¸ªå‰¯ä½œç”¨ ä¾‹å¦‚ä¸‹é¢çš„è¿™ä¸ªdeleteChildå‡½æ•°æ˜¯è¡¨ç¤ºåˆ é™¤å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„æ“ä½œ 12345678910111213function deleteChild(returnFiber: Fiber, childToDelete: Fiber): void &#123; if (!shouldTrackSideEffects) &#123; // Noop. return; &#125; const deletions = returnFiber.deletions; if (deletions === null) &#123; returnFiber.deletions = [childToDelete]; returnFiber.flags |= ChildDeletion; &#125; else &#123; deletions.push(childToDelete); &#125; &#125; å¦‚æœè¯´éœ€è¦è¿½è¸ªå‰¯ä½œç”¨çš„è¯ï¼Œä¼šç»™åˆ é™¤èŠ‚ç‚¹çš„fiberæ‰“ä¸Šä¸€ä¸ªflags æœç´¢reactFiberFlagsæ–‡ä»¶çœ‹è¿™äº›Flagséƒ½æœ‰äº›å•¥ ä¼—æ‰€å‘¨çŸ¥ï¼Œrenderé˜¶æ®µä¸ä¼šæ“ä½œdomçš„ï¼Œcommité˜¶æ®µæ‰ä¼šï¼Œæ‰€ä»¥renderé˜¶æ®µè¿™ä¸ªflagsçš„æ“ä½œåªæ˜¯ä¸ºäº†ä¸ºfiberæ‰“ä¸Štagå‘Šè¯‰åç»­è¿™ä¸ªèŠ‚ç‚¹è¦è¿›è¡Œä»€ä¹ˆæ“ä½œ ä¸ºä»€ä¹ˆæ˜¯äºŒè¿›åˆ¶æ©ç æ ¼å¼çš„flagså‘¢ï¼Ÿè¿™é‡Œæœ‰ä¸€ç§æƒ…å†µ ä¸¾ä¸ªä¾‹å­ï¼š å½“ä¸€ä¸ªfiberèŠ‚ç‚¹éœ€è¦æ’å…¥å¹¶ä¸”éœ€è¦æ›´æ–°å±æ€§çš„è¯ é‚£å°±å¾—ç»‘å®š2ä¸ªflagsï¼Œä¸€ä¸ªæ˜¯ Updateä¸€ä¸ªæ˜¯ Placement è¿™é‡Œç”¨äºŒè¿›åˆ¶çš„è¯å°±å¯ä»¥ç›´æ¥è¿›è¡ŒæŒ‰ä½ æˆ–çš„æ“ä½œ 12345const effectTag = NoEffect;effectTag |= Update;effectTag |= Placement;(effectTag &amp; PlacementAndUpdate) !== NoEffect; // true æ— è®ºå¦‚ä½•æœ€ç»ˆï¼Œéƒ½ä¼šèµ°åˆ°reconcileChildFibersè¿™ä¸ªæ–¹æ³•é‡Œå¤´ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ˜¯å†™åœ¨ ChildReconcilerå‡½æ•°çš„ï¼Œæ€»è€Œè¨€ä¹‹å°±æ˜¯åŠ äº†ä¸€å±‚å»åˆ¤æ–­æ˜¯å¦è¦è¿½è¸ªå‰¯ä½œç”¨ã€‚ 5. reconcileChildFibersåœ°å€ è¿™ä¸ªæ–¹æ³•ä¸­ä¼šåˆ¤æ–­å½“å‰childçš„ç±»å‹ï¼Œè¿›è€Œå¯¹ä¸åŒçš„ç±»å‹åšä¸ä¸€æ ·çš„æ“ä½œ ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªå¤§ç±» type === â€˜objectâ€™ type === â€˜stringâ€™ å½“ç„¶æœ€éœ€è¦ç»†åˆ†çš„å°±æ˜¯ä¸ºobjectçš„æƒ…å†µï¼Œé‡Œå¤´è¿˜åŒ…æ‹¬äº†childæ˜¯childrenç­‰æƒ…å½¢ æˆ‘ä»¬èµ°åˆ°objecté‡Œå¤´ç»†çœ‹ä¸€ä¸‹ï¼Œå‡è®¾æˆ‘ä»¬ç°åœ¨èµ°åˆ°äº†ä¸€ä¸ªèŠ‚ç‚¹æ˜¯è¿™æ ·çš„ 1234&lt;header&gt; &lt;span&gt;title&lt;/span&gt;&lt;/header&gt; é‚£ä»–å°±ä¼šå»è°ƒç”¨ reconcileSingleElementçš„æ–¹æ³• æœ€ç»ˆè¿™ä¸ªæ–¹æ³•ä¼šèµ°åˆ°createFiberFromElement ä¹Ÿå°±æ˜¯é€šè¿‡reactElementçš„æ•°æ®åˆ›å»ºä¸€ä¸ªfiberèŠ‚ç‚¹ å¹¶ä¸”è¿™ä¸ªæ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•å«åš``createFiberFromTypeAndProps` åœ¨è¿™ä¸ªæ–¹æ³•çš„å†…éƒ¨ä¼šæ ¹æ®å½“å‰çš„component typeå»èµ°ä¸åŒçš„é€»è¾‘ è¿™é‡Œå‘¢ç›´æ¥å°†fibertag èµ‹å€¼ä¸ºäº†HostComponent æ¥ä¸‹æ¥å»åˆ›å»ºå¯¹åº”çš„fiberèŠ‚ç‚¹ï¼Œè°ƒç”¨createFiberï¼Œä¹Ÿå°±æ˜¯ newäº†ä¸€ä¸ª FiberNodeï¼Œè¿™é‡Œå¤´çš„å±æ€§åœ¨Fiberé‚£ç¯‡è®²äº†ä¸€ä¸‹ã€‚ æ€»ç»“æœ€ç»ˆä»–ä¼šç”Ÿæˆæ–°çš„å­FiberèŠ‚ç‚¹å¹¶èµ‹å€¼ç»™workInProgress.childï¼Œä½œä¸ºæœ¬æ¬¡beginWorkè¿”å›å€¼ ï¼Œå¹¶ä½œä¸ºä¸‹æ¬¡performUnitOfWorkæ‰§è¡Œæ—¶workInProgressçš„ä¼ å‚ã€‚ è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼Œå½“ä½ è°ƒç”¨reconcileChildFibersæ—¶å€™å­èŠ‚ç‚¹å¯èƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ç§æƒ…å†µreactä»ç„¶æ˜¯åªé’ˆå¯¹æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ åˆ›å»ºfiber â€‹ completeWorkåšäº†å•¥ï¼Ÿ1. æ ¹æ®fiberèŠ‚ç‚¹çš„tagè¿›å…¥ä¸åŒçš„caseè¿™é‡Œé¦–å…ˆè¿›å…¥completeWorké˜¶æ®µçš„æ—¶å€™spanæ ‡ç­¾ 12345678910111213function App() &#123; return ( &lt;div className=&quot;node1&quot;&gt; &lt;header&gt; &lt;span&gt;title&lt;/span&gt; &lt;/header&gt; &lt;main&gt; main &lt;p&gt;test&lt;/p&gt; &lt;/main&gt; &lt;/div&gt; );&#125; è¿™é‡Œæ˜¯span æ ‡ç­¾æ‰€ä»¥å…ˆè¿›å…¥ HostComponentçš„caseé€»è¾‘ äº‹å…ˆåˆ¤æ–­currentæ˜¯å¦æ˜¯ç©ºï¼Œé¦–æ¬¡æ¸²æŸ“éfiberRootä¸å­˜current æ¥ä¸‹æ¥æ¯”è¾ƒé‡è¦çš„æ˜¯åˆ›å»ºä¸€ä¸ªdomå«åšcreateInstance 2. createInstance createInstanceä¼šå» é€šè¿‡ createElementåˆ›å»ºä¸€ä¸ªdomå…ƒç´  è¿™é‡ŒdomElementå°±æ˜¯ä¸€ä¸ªspan ä¹‹åè¿”å›ä¸€ä¸ªinstanceå»æ‰§è¡ŒappendAllChidrenå‡½æ•°ï¼Œç”±äºspanæ˜¯æˆ‘ä»¬ç¬¬ä¸€ä¸ªåˆ›å»ºçš„å…ƒç´ ï¼Œæ‰€ä»¥appendä¼šè¢«è·³è¿‡ 3. ä¿å­˜åˆ›å»ºå‡ºæ¥çš„domåˆ°fiberèŠ‚ç‚¹çš„stateNodeä¸­1workInProgress.stateNode = instance; 4. å°†å±æ€§ç»‘å®šåˆ°åˆ›å»ºå‡ºæ¥çš„domå…ƒç´ ä¸Šæ‰§è¡ŒfinalizerInitialChildren, å°†æ‰€æœ‰çš„å±æ€§ç»‘åˆ°æˆ‘ä»¬æ–°åˆ›å»ºçš„domå…ƒç´ ä¸Šé¢ï¼Œåˆ°è¿™é‡Œä¸€ä¸ªèŠ‚ç‚¹spançš„completeworkå°±å¤§è‡´å®Œæˆäº† â­appendAllChildrené€»è¾‘appendAllChildrençš„åŸç†æ˜¯ï¼Œä¸»è¦æ˜¯å°†å·²ç»åˆ›å»ºå¥½çš„fiberèŠ‚ç‚¹æŒ‚è½½åˆ°å½“å‰çš„èŠ‚ç‚¹ä¸‹ã€‚ è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä¹‹å‰ä¸Šé¢çš„spançš„æ ‡ç­¾ç¬¬ä¸€æ¬¡åˆ›å»ºçš„æ—¶å€™ä¸èµ°è¿™ä¸ªçš„é€»è¾‘çš„åŸå›  èµ°åˆ°äº†APPæ—¶å€™ï¼Œå°±æ„å»ºäº†ä¸€é¢—å®Œæ•´çš„fiberæ ‘äº†","tags":["React","React render"],"categories":["React"]},{"title":"Reactæºç å­¦ä¹ -renderé˜¶æ®µ-part5","path":"/2021/08/22/Reactæºç å­¦ä¹ -renderé˜¶æ®µç®€ä»‹-part5/","content":"ä¹‹å‰fiberé‚£è¾¹è¯´è¿‡ï¼Œå½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡åˆ›å»ºå®Œäº†æ•´ä¸ªåº”ç”¨çš„æ ¹èŠ‚ç‚¹ï¼ˆfiberRootNodeçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¿›å…¥é¦–å±æ¸²æŸ“çš„é˜¶æ®µï¼‰ é€šè¿‡sheduleUpdateOnFiberå»è°ƒåº¦æ›´æ–°ï¼Œè°ƒåº¦æˆåŠŸä¹‹åä¼šèµ°performSyncWorkOnRootï¼Œä¹Ÿå°±æ˜¯è¯´ä»æ ¹èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œè¿™æ¬¡çš„æ›´æ–°ã€‚ è¿™æ—¶å€™ä¹Ÿè‚¯å®šæ˜¯æ²¡æœ‰ä¸€ä¸ªworkInProgressçš„fiber treeçš„ï¼Œæ‰€ä»¥ä»æ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œå»è§¦å‘æ›´æ–°ï¼ˆç¬¬ä¸€æ¬¡æ„å»ºtreeï¼‰æ“ä½œ åè°ƒå™¨å·¥ä½œä¸»è¦æ˜¯å…¥å£æ˜¯ workSyncLoopï¼Œé€’é˜¶æ®µå¼€å§‹äºæŸä¸ªfiberå…¶beginWorkï¼Œå½’é˜¶æ®µåˆ™æ˜¯è°ƒç”¨completeWork è¿™é‡Œæˆ‘ä»¬è¯´ä¸€ä¸‹åè°ƒå™¨çš„å·¥ä½œï¼Œæ¸²æŸ“å™¨åé¢è®²ï¼ˆæ¸²æŸ“å™¨è¿™é‡Œæˆ‘ä»¬åªè¦çŸ¥é“å®ƒæ˜¯å°†å˜åŒ–çš„èŠ‚ç‚¹æ¸²æŸ“åˆ°è§†å›¾ä¸Šï¼Œæ‰€ä»¥åˆ†ä¸ºæ¸²æŸ“åˆ°è§†å›¾-ä¹‹å‰-ä¸­-ä¹‹åï¼‰ å› æ­¤åè°ƒå™¨å·¥ä½œå¼€å§‹åˆ°ç»“æŸï¼Œæˆ‘ä»¬ç§°å‘¼ä¸º renderé˜¶æ®µï¼Œ æ¸²æŸ“å™¨å¼€å§‹åˆ°ç»“æŸï¼Œç§°å‘¼ä¸ºcommité˜¶æ®µ æ•´ä¸ªæµç¨‹å°±æ˜¯é¦–å±æ¸²æŸ“äº† renderé˜¶æ®µæµç¨‹æ¦‚è§ˆé¦–å…ˆæˆ‘ä»¬å…ˆçœ‹è°ƒç”¨æ ˆé‡Œå¤´renderé˜¶æ®µæ˜¯ä»å“ªé‡Œå¼€å§‹çš„å‘¢ï¼Ÿ renderé˜¶æ®µå¼€å§‹äºperformSyncWorkOnRootæˆ–performConcurrentWorkOnRootæ–¹æ³•çš„è°ƒç”¨ã€‚è¿™å–å†³äºæœ¬æ¬¡æ›´æ–°æ˜¯åŒæ­¥æ›´æ–°è¿˜æ˜¯å¼‚æ­¥æ›´æ–°ã€‚ ä¹‹åè°ƒç”¨workSyncLoopæˆ–è€…workLoopConcurrent 12345678910111213// performSyncWorkOnRootä¼šè°ƒç”¨è¯¥æ–¹æ³•function workLoopSync() &#123; while (workInProgress !== null) &#123; performUnitOfWork(workInProgress); &#125;&#125;// performConcurrentWorkOnRootä¼šè°ƒç”¨è¯¥æ–¹æ³•function workLoopConcurrent() &#123; while (workInProgress !== null &amp;&amp; !shouldYield()) &#123; performUnitOfWork(workInProgress); &#125;&#125; ä¸Šé¢æ‰€è¯´çš„workInProgress treeæ„å»ºçš„è¿‡ç¨‹ä»è¿™é‡Œæ­£å¼å¼€å§‹ ä»£ç ä¸­çš„workInProgress ä»£è¡¨çš„æ˜¯å½“å‰å·²ç»åˆ›å»ºçš„workInProgress Fiber performUnitOfWorkæ–¹æ³•ä¼šåˆ›å»ºä¸‹ä¸€ä¸ªFiberèŠ‚ç‚¹å¹¶èµ‹å€¼ç»™workInProgressï¼Œå¹¶å°†workInProgressä¸å·²åˆ›å»ºçš„FiberèŠ‚ç‚¹è¿æ¥èµ·æ¥æ„æˆFiberæ ‘ã€‚ æˆ‘ä»¬çŸ¥é“Fiber Reconcileræ˜¯ä»Stack Reconcileré‡æ„è€Œæ¥ï¼Œé€šè¿‡éå†çš„æ–¹å¼å®ç°å¯ä¸­æ–­çš„é€’å½’ æ‰€ä»¥å…·ä½“æˆ‘ä»¬çœ‹çœ‹performUnitOfWorkçš„å·¥ä½œå¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šâ€œé€’â€å’Œâ€œå½’â€ã€‚ â€é€’â€œé˜¶æ®µ é¦–å…ˆä»rootFiberå¼€å§‹å‘ä¸‹æ·±åº¦ä¼˜å…ˆéå†ã€‚ä¸ºéå†åˆ°çš„æ¯ä¸ªFiberèŠ‚ç‚¹è°ƒç”¨beginWorkæ–¹æ³• è¯¥æ–¹æ³•ä¼šæ ¹æ®ä¼ å…¥çš„FiberèŠ‚ç‚¹åˆ›å»ºå­FiberèŠ‚ç‚¹ï¼Œå¹¶å°†è¿™ä¸¤ä¸ªFiberèŠ‚ç‚¹è¿æ¥èµ·æ¥ã€‚ å½“éå†åˆ°å¶å­èŠ‚ç‚¹ï¼ˆå³æ²¡æœ‰å­ç»„ä»¶çš„ç»„ä»¶ï¼‰æ—¶å°±ä¼šè¿›å…¥â€œå½’â€é˜¶æ®µã€‚ â€œå½’â€é˜¶æ®µåœ¨â€œå½’â€é˜¶æ®µä¼šè°ƒç”¨completeWorkå¤„ç†FiberèŠ‚ç‚¹ã€‚ å½“æŸä¸ªFiberèŠ‚ç‚¹æ‰§è¡Œå®ŒcompleteWorkï¼Œå¦‚æœå…¶å­˜åœ¨å…„å¼ŸFiberèŠ‚ç‚¹ï¼ˆå³fiber.sibling !== nullï¼‰ï¼Œä¼šè¿›å…¥å…¶å…„å¼ŸFiberçš„â€œé€’â€é˜¶æ®µã€‚ å¦‚æœä¸å­˜åœ¨å…„å¼ŸFiberï¼Œä¼šè¿›å…¥çˆ¶çº§Fiberçš„â€œå½’â€é˜¶æ®µã€‚ â€œé€’â€å’Œâ€œå½’â€é˜¶æ®µä¼šäº¤é”™æ‰§è¡Œç›´åˆ°â€œå½’â€åˆ°rootFiberã€‚è‡³æ­¤ï¼Œrenderé˜¶æ®µçš„å·¥ä½œå°±ç»“æŸäº†ã€‚ æ€»ç»“æ€»ä½“æ¥è¯´é€’å½’é˜¶æ®µæ˜¯ä¸‹é¢è¿™æ®µä¼ªä»£ç æè¿°çš„ä¸€æ · 12345678910111213function performUnitOfWork(fiber) &#123; // æ‰§è¡ŒbeginWork if (fiber.child) &#123; performUnitOfWork(fiber.child); &#125; // æ‰§è¡ŒcompleteWork if (fiber.sibling) &#123; performUnitOfWork(fiber.sibling); &#125;&#125; æ ¹æ®Fiberçš„é‚£ä¸€è®²è§£å’±ä»¬å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬çš„reactä¸­å¯ä»¥æœ€å¤šå­˜åœ¨ä¸¤æ£µfiberæ ‘ï¼Œä¸€ä¸ªæ˜¯workInProgressä¸€ä¸ªæ˜¯currentï¼Œå’±ä»¬åœ¨é¦–æ¬¡mountçš„æ—¶å€™æ˜¯ï¼Œæ˜¯æ²¡æœ‰currentçš„ï¼Œåªæ˜¯åœ¨å†…å­˜ä¸­é€šè¿‡æ•´ä¸ªåº”ç”¨çš„æ ¹fiberRootNodeå»æ„å»ºworkinprogess tree ä¹‹åupdateçš„æ—¶å€™æ˜¯å­˜åœ¨currentçš„treeçš„ æ‰€ä»¥è¿™ä¸¤ä¸ªé˜¶æ®µçš„â€œé€’â€å’Œâ€œå½’â€æµç¨‹æ˜¯å„ä¸ä¸€æ ·çš„ å› æ­¤æˆ‘ä»¬æ¥ä¸‹æ¥æŒ‰ç…§ mount å’Œupdateè§¦å‘å»è§£é‡Šâ€œé€’å½’â€","tags":["React","React render"],"categories":["React"]},{"title":"Reactæºç å­¦ä¹ -jsxçš„ç†è§£-part4","path":"/2021/08/21/Reactæºç å­¦ä¹ -jsxçš„ç†è§£-part4/","content":"jsxç†è§£ JSXå’ŒFiberèŠ‚ç‚¹ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿ ã€‚ React Component å’Œ React Element ä¹Ÿä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚ ä»ç¼–è¯‘æ¥çœ‹JSXåœ¨babelä¸­ä¼šè¢«ç¼–è¯‘æˆReact.createElementï¼ˆè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦æ‰‹åŠ¨import React from &#39;react&#39;çš„åŸå› äº†ï¼‰ ä½†æ˜¯åœ¨17ä¹‹åä¸éœ€è¦æ‰‹åŠ¨å¼•å…¥äº† çœ‹è¿™ç¯‡ å¦‚ä¸‹å›¾ï¼š JSXå¹¶ä¸æ˜¯åªèƒ½è¢«ç¼–è¯‘ä¸ºReact.createElementæ–¹æ³•ï¼Œä½ å¯ä»¥é€šè¿‡@babel/plugin-transform-react-jsx (opens new window)æ’ä»¶æ˜¾å¼å‘Šè¯‰Babelç¼–è¯‘æ—¶éœ€è¦å°†JSXç¼–è¯‘ä¸ºä»€ä¹ˆå‡½æ•°çš„è°ƒç”¨ï¼ˆé»˜è®¤ä¸ºReact.createElementï¼‰ã€‚ æ¯”å¦‚åœ¨preact (opens new window)è¿™ä¸ªç±»Reactåº“ä¸­ï¼ŒJSXä¼šè¢«ç¼–è¯‘ä¸ºä¸€ä¸ªåä¸ºhçš„å‡½æ•°è°ƒç”¨ã€‚ React.createElementReact.createElementåœ°å€ 1createElement(type, config, children) type: react componentç±»å‹ configï¼šreact component çš„ä¸€äº›å±æ€§ childrenï¼šå®ƒçš„å­å­™react component æ‰§è¡Œæ­¥éª¤ è¿›æ¥createElementæˆ‘ä»¬ä¼šå‘ç°å®ƒå®šä¹‰äº†ä¸€äº›å­—æ®µï¼Œè¿™äº›å­—æ®µéƒ½æ˜¯æˆ‘ä»¬æ¯”è¾ƒå¸¸ç”¨çš„ ä¹‹åæˆ‘ä»¬å¯¹ä¼ è¿›æ¥çš„configè¿›è¡Œæ ¡éªŒï¼Œæˆ‘ä»¬ä¼šå‘ç°ä»–åšäº†å‡ ä¸ªåˆæ³•æ€§çš„æ ¡éªŒï¼Œå¹¶ä¸”å¯¹ç›¸å¯¹åº”çš„å˜é‡è¿›è¡Œèµ‹å€¼ hasValidRefï¼šå¯¹configä¸­çš„refåšåˆæ³•æ€§æ ¡éªŒ hasValidKeyï¼šå¯¹configä¸­çš„keyåšåˆæ³•æ€§æ ¡éªŒ éå†configä¸­çš„å±æ€§ï¼Œå°†é™¤äº†ä¿ç•™å±æ€§ä¹‹å¤–çš„å…¶ä»–å±æ€§èµ‹å€¼ç»™Propsï¼ˆå°±æ˜¯å†…éƒ¨çš„ä¸€ä¸ªä¸­é—´å¯¹è±¡ï¼‰ ä¿ç•™å±æ€§æœ‰å“ªäº›å‘¢ï¼Ÿ å¯ä»¥çœ‹åˆ°reactæŠŠï¼Œrefï¼Œkeyéƒ½æå‡ºæ¥äº†ï¼Œå•ç‹¬çš„ä½œä¸º ReactElementå‡½æ•°çš„å‚æ•°ä¼ é€’ï¼ˆè¿™ä¸ªä¸‹é¢è¯´ï¼‰ æ¥ä¸‹æ¥å¤„ç†typeä¸­çš„defaultPropsï¼Œè¿™é‡Œä¹Ÿèƒ½æ˜ç™½ï¼Œå› ä¸ºæˆ‘ä»¬ç»å¸¸éœ€è¦ç»™classçš„ç»„ä»¶çš„ä¸€äº›å‚æ•°è®¾ç½®é»˜è®¤çš„å±æ€§å€¼ æ¥ä¸‹æ¥æˆ‘ä»¬èµ°å…¥ReactElementå‡½æ•° å¯ä»¥å‘ç°ï¼Œå®ƒæœ€ç»ˆè¿”å›äº†ä¸€ä¸ªElementå¯¹è±¡ 12345678910111213141516const ReactElement = function(type, key, ref, self, source, owner, props) &#123; ...... const element = &#123; // æ ‡è®°è¿™æ˜¯ä¸ª React Element $$typeof: REACT_ELEMENT_TYPE, // è¿™ä¸ªæ˜¯react componentçš„ç±»å‹ type: type, key: key, ref: ref, props: props, _owner: owner, &#125;; return element;&#125;; 1234567891011121314 è¿™é‡Œè¦æ³¨æ„ï¼Œå…¶ä¸­` $$typeof`è¿™ä¸ªå‚æ•°å¾ˆé‡è¦ï¼Œä¸»è¦æ˜¯ç”¨æ¥[isValidElement](https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react/src/ReactElement.js#L547)å‡½æ•°æ¥åˆ¤æ–­è¿™ä¸ªelementæ˜¯ä¸æ˜¯åˆæ³•çš„react element ```js export function isValidElement(object) &#123; return ( typeof object === &#x27;object&#x27; &amp;&amp; object !== null &amp;&amp; object.$$typeof === REACT_ELEMENT_TYPE ); &#125; å¯ä»¥çœ‹åˆ°ï¼Œ$$typeof === REACT_ELEMENT_TYPEçš„énullå¯¹è±¡å°±æ˜¯ä¸€ä¸ªåˆæ³•çš„React Elementã€‚æ¢è¨€ä¹‹ï¼Œåœ¨Reactä¸­ï¼Œæ‰€æœ‰JSXåœ¨è¿è¡Œæ—¶çš„è¿”å›ç»“æœï¼ˆå³React.createElement()çš„è¿”å›å€¼ï¼‰éƒ½æ˜¯React Elementã€‚ React Componentåœ¨Reactä¸­ï¼Œæˆ‘ä»¬å¸¸ä½¿ç”¨ClassComponentä¸FunctionComponentæ„å»ºç»„ä»¶ã€‚ 1234567891011121314class AppClass extends React.Component &#123; render() &#123; return &lt;p&gt;111&lt;/p&gt; &#125;&#125;console.log(&#x27;è¿™æ˜¯ClassComponentï¼š&#x27;, AppClass);console.log(&#x27;è¿™æ˜¯Elementï¼š&#x27;, &lt;AppClass/&gt;);function AppFunc() &#123; return &lt;p&gt;222&lt;/p&gt;;&#125;console.log(&#x27;è¿™æ˜¯FunctionComponentï¼š&#x27;, AppFunc);console.log(&#x27;è¿™æ˜¯Elementï¼š&#x27;, &lt;AppFunc/&gt;); æˆ‘ä»¬å¯ä»¥ä»Demoæ§åˆ¶å°æ‰“å°çš„å¯¹è±¡çœ‹å‡ºï¼ŒClassComponentå¯¹åº”çš„Elementçš„typeå­—æ®µä¸ºAppClassè‡ªèº«ã€‚ FunctionComponentå¯¹åº”çš„Elementçš„typeå­—æ®µä¸ºAppFuncè‡ªèº«ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011&#123; $$typeof: Symbol(react.element), key: null, props: &#123;&#125;, ref: null, type: Æ’ AppFunc(), _owner: null, _store: &#123;validated: false&#125;, _self: null, _source: null &#125; JSXä¸FiberèŠ‚ç‚¹ä»ä¸Šé¢çš„å†…å®¹æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒJSXæ˜¯ä¸€ç§æè¿°å½“å‰ç»„ä»¶å†…å®¹çš„æ•°æ®ç»“æ„ï¼Œä»–ä¸åŒ…å«ç»„ä»¶scheduleã€reconcileã€renderæ‰€éœ€çš„ç›¸å…³ä¿¡æ¯ã€‚ æ¯”å¦‚å¦‚ä¸‹ä¿¡æ¯å°±ä¸åŒ…æ‹¬åœ¨JSXä¸­ï¼š ç»„ä»¶åœ¨æ›´æ–°ä¸­çš„ä¼˜å…ˆçº§ ç»„ä»¶çš„state ç»„ä»¶è¢«æ‰“ä¸Šçš„ç”¨äºRendererçš„æ ‡è®° è¿™äº›å†…å®¹éƒ½åŒ…å«åœ¨FiberèŠ‚ç‚¹ä¸­ã€‚ æ‰€ä»¥ï¼Œåœ¨ç»„ä»¶mountæ—¶ï¼ŒReconcileræ ¹æ®JSXæè¿°çš„ç»„ä»¶å†…å®¹ç”Ÿæˆç»„ä»¶å¯¹åº”çš„FiberèŠ‚ç‚¹ã€‚ åœ¨updateæ—¶ï¼ŒReconcilerå°†JSXä¸FiberèŠ‚ç‚¹ä¿å­˜çš„æ•°æ®å¯¹æ¯”ï¼Œç”Ÿæˆç»„ä»¶å¯¹åº”çš„FiberèŠ‚ç‚¹ï¼Œå¹¶æ ¹æ®å¯¹æ¯”ç»“æœä¸ºFiberèŠ‚ç‚¹æ‰“ä¸Šæ ‡è®°ã€‚","tags":["React","jsx"],"categories":["React"]},{"title":"Reactæºç å­¦ä¹ -fiberåŸç†-part3","path":"/2021/08/21/Reactæºç å­¦ä¹ -fiberåŸç†-part3/","content":"Fiberæ¶æ„å®˜æ–¹å›ç­”ä»€ä¹ˆæ˜¯fiber Fiberå¹¶ä¸æ˜¯è®¡ç®—æœºæœ¯è¯­ä¸­çš„æ–°åè¯ï¼Œä»–çš„ä¸­æ–‡ç¿»è¯‘å«åšçº¤ç¨‹ï¼Œä¸è¿›ç¨‹ï¼ˆProcessï¼‰ã€çº¿ç¨‹ï¼ˆThreadï¼‰ã€åç¨‹ï¼ˆCoroutineï¼‰åŒä¸ºç¨‹åºæ‰§è¡Œè¿‡ç¨‹ã€‚ åœ¨å¾ˆå¤šæ–‡ç« ä¸­å°†çº¤ç¨‹ç†è§£ä¸ºåç¨‹çš„ä¸€ç§å®ç°ã€‚åœ¨JSä¸­ï¼Œåç¨‹çš„å®ç°ä¾¿æ˜¯Generatorã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†çº¤ç¨‹(Fiber)ã€åç¨‹(Generator)ç†è§£ä¸ºä»£æ•°æ•ˆåº”æ€æƒ³åœ¨JSä¸­çš„ä½“ç°ã€‚ React Fiberå¯ä»¥ç†è§£ä¸ºï¼š Reactå†…éƒ¨å®ç°çš„ä¸€å¥—çŠ¶æ€æ›´æ–°æœºåˆ¶ã€‚æ”¯æŒä»»åŠ¡ä¸åŒä¼˜å…ˆçº§ï¼Œå¯ä¸­æ–­ä¸æ¢å¤ï¼Œå¹¶ä¸”æ¢å¤åå¯ä»¥å¤ç”¨ä¹‹å‰çš„ä¸­é—´çŠ¶æ€ã€‚ å…¶ä¸­æ¯ä¸ªä»»åŠ¡æ›´æ–°å•å…ƒä¸ºReact Elementå¯¹åº”çš„FiberèŠ‚ç‚¹ã€‚ Fiberæ¶æ„å¿ƒæ™ºæ¨¡å‹ Reactæ ¸å¿ƒå›¢é˜Ÿæˆå‘˜Sebastian MarkbÃ¥ge (opens new window)ï¼ˆReact Hooksçš„å‘æ˜è€…ï¼‰æ›¾è¯´ï¼šæˆ‘ä»¬åœ¨Reactä¸­åšçš„å°±æ˜¯è·µè¡Œä»£æ•°æ•ˆåº”ï¼ˆAlgebraic Effectsï¼‰ã€‚ ä»£æ•°æ•ˆåº”è¿™ç¯‡æ–‡ç« å¯ä»¥å¥½å¥½çœ‹çœ‹ ä»£æ•°æ•ˆåº”èƒ½å¤Ÿå°†å‰¯ä½œç”¨ä»å‡½æ•°é€»è¾‘ä¸­åˆ†ç¦»ï¼Œä½¿å‡½æ•°å…³æ³¨ç‚¹ä¿æŒçº¯ç²¹ã€‚ å°±æ¯”å¦‚æˆ‘ä»¬å¹³æ—¶ç”¨awaitæ¥ç­‰å¾…ä¸€ä¸ªå€¼çš„è¿”å› 1234async function getData()&#123; const res = await loadData(); return res;&#125; ä»£æ•°æ•ˆåº”ç›¸å½“äºï¼Œæˆ‘å…³æ³¨çš„æ˜¯ await loadData()èƒ½ç»™æˆ‘ä»€ä¹ˆä¸œè¥¿ï¼Œè€Œä¸æ˜¯å…³æ³¨ä»–é‡Œå¤´æ˜¯å¼‚æ­¥è¿˜æ˜¯åŒæ­¥ï¼Œæ€ä¹ˆå¤„ç†è¿™ä¸ªæ•°æ®çš„ï¼› ä»£æ•°æ•ˆåº” in Reactåœ¨reactä¸­æœ‰ä¸ªç»“åˆSuspenseçš„ä¾‹å­ Suspense Demo è€Œæˆ‘ä»¬æ—¥å¸¸ç”¨hooksï¼Œä¾‹å¦‚useStateä»€ä¹ˆçš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³æ³¨å‡½æ•°ç»„ä»¶çš„è¿™ä¸ªstateçŠ¶æ€æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Œæˆ‘ä»¬åªè¦çŸ¥é“è¿™ä¸ªä¸œè¥¿èƒ½å¹²å˜›å°±è¡Œã€‚ ä¸ºä»€ä¹ˆä¸ç”¨Generatoræ–°è€æ¶æ„é‚£ç‰‡è¯´è¿‡ï¼ŒReact16ä¹‹åå¼•å…¥äº†ä¸€ä¸ª schedulerï¼ˆè°ƒåº¦å™¨ï¼‰ï¼Œå¹¶ä¸”é‡æ„äº†Reconcilerï¼ˆåè°ƒå™¨ï¼‰ï¼Œå°±æ˜¯ä¸ºäº†å°†reactçš„è€ä¸€å¥—åŒæ­¥æ›´æ–° çš„æ¶æ„å˜æˆ *å¼‚æ­¥å¯ä¸­æ–­ *çš„ å¼‚æ­¥å¯ä¸­æ–­æ›´æ–°å¯ä»¥ç†è§£ä¸ºï¼šæ›´æ–°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½ä¼šè¢«æ‰“æ–­ï¼ˆæµè§ˆå™¨æ—¶é—´åˆ†ç‰‡ç”¨å°½æˆ–æœ‰æ›´é«˜ä¼˜ä»»åŠ¡æ’é˜Ÿï¼‰ï¼Œå½“å¯ä»¥ç»§ç»­æ‰§è¡Œæ—¶æ¢å¤ä¹‹å‰æ‰§è¡Œçš„ä¸­é—´çŠ¶æ€ã€‚ ç¼ºç‚¹ï¼š generatorå®ƒå…·æœ‰ä¼ æŸ“æ€§å’Œasync awaitä¸€æ ·ï¼Œå°±åƒä½ ç”¨asyncçš„å‡½æ•°é‚£ä¸œè¥¿ï¼Œä½ éœ€è¦å†™awaitä¸€æ · ä¸­é—´çŠ¶æ€ä¸Šä¸‹æ–‡ç›¸å…³ï¼Œå¯ä»¥çœ‹çœ‹è¿™ä¸ª è§£é‡Š Fiberå®ç°åŸç†Fiberå«ä¹‰é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½ï¼š react15çš„æ—¶å€™é‡‡ç”¨é€’å½’æ–¹å¼å»æ‰§è¡Œï¼Œæ•°æ®ä¿å­˜åœ¨é€’å½’è°ƒç”¨æ ˆä¸­ï¼Œæ•…è¢«ç§°ä¸ºstack reconciler react16 çš„reconciler åŸºäº fiberèŠ‚ç‚¹å®ç°çš„ï¼Œæ•…ç§°ä¸º fiber reconciler ä¸€ä¸ª React Element å¯¹åº”ä¸€ä¸ªFiberèŠ‚ç‚¹ ä½œä¸ºé™æ€ç»“æ„ç†è§£ â€” ä¿å­˜äº†è¯¥ç»„ä»¶ç±»å‹ï¼ˆåŸç”Ÿ/ç±»ç»„ä»¶/å‡½æ•°ç»„ä»¶/â€¦ï¼‰ï¼Œä»¥åŠå¯¹åº”domèŠ‚ç‚¹ä¿¡æ¯ ä½œä¸ºåŠ¨æ€ç»“æ„ç†è§£ â€” æ¯ä¸ªFiberä¿å­˜äº†æœ¬æ¬¡æ›´æ–°ä¸­è¯¥ç»„ä»¶æ”¹å˜çš„çŠ¶æ€ï¼Œè¦æ‰§è¡Œçš„å·¥ä½œï¼ˆæ’å…¥/åˆ é™¤/æ›´æ–°â€¦ï¼‰ Fiberæ•°æ®ç»“æ„Fiberæ•°æ®ç»“æ„ 123456789101112131415161718192021222324252627282930313233343536373839404142434445function FiberNode( tag: WorkTag, pendingProps: mixed, key: null | string, mode: TypeOfMode,) &#123; // ä½œä¸ºé™æ€æ•°æ®ç»“æ„çš„å±æ€§ this.tag = tag; this.key = key; this.elementType = null; this.type = null; this.stateNode = null; // ç”¨äºè¿æ¥å…¶ä»–FiberèŠ‚ç‚¹å½¢æˆFiberæ ‘ this.return = null; this.child = null; this.sibling = null; this.index = 0; this.ref = null; this.pendingProps = pendingProps; this.memoizedProps = null; this.updateQueue = null; this.memoizedState = null; this.dependencies = null; this.mode = mode; // ä½œä¸ºåŠ¨æ€çš„å·¥ä½œå•å…ƒçš„å±æ€§ this.effectTag = NoEffect; this.subtreeTag = NoSubtreeEffect; this.deletions = null; this.nextEffect = null; this.firstEffect = null; this.lastEffect = null; // è°ƒåº¦ä¼˜å…ˆçº§ç›¸å…³ this.lanes = NoLanes; this.childLanes = NoLanes; // æŒ‡å‘è¯¥fiberåœ¨å¦ä¸€æ¬¡æ›´æ–°æ—¶å¯¹åº”çš„fiberï¼Œ current treeä¸­çš„fiberèŠ‚ç‚¹å’Œworkinprogress treeçš„fiberèŠ‚ç‚¹è¿æ¥ this.alternate = null; &#125; FiberèŠ‚ç‚¹ä¹‹é—´å…³ç³»FiberèŠ‚ç‚¹ä¹‹é—´æ˜¯é€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªå±æ€§å»ºç«‹èµ·è¿æ¥çš„ 123456// æŒ‡å‘çˆ¶çº§FiberèŠ‚ç‚¹this.return = null;// æŒ‡å‘å­FiberèŠ‚ç‚¹this.child = null;// æŒ‡å‘å³è¾¹ç¬¬ä¸€ä¸ªå…„å¼ŸFiberèŠ‚ç‚¹this.sibling = null; æ¯”å¦‚ä¸‹é¢çš„ä»£ç å’Œå¯¹åº”çš„Fiberæ ‘å¦‚ä¸‹ï¼š 123456789101112function App()&#123; return ( &lt;div&gt; &lt;span&gt;hello world&lt;/span&gt; &lt;a&gt; weng &lt;span/&gt; &lt;/a&gt; &lt;/div&gt; )&#125; è¿™é‡Œéœ€è¦æä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆçˆ¶çº§æŒ‡é’ˆå«åšreturnè€Œä¸æ˜¯parentæˆ–è€…fatherå‘¢ï¼Ÿå› ä¸ºä½œä¸ºä¸€ä¸ªå·¥ä½œå•å…ƒï¼ŒreturnæŒ‡èŠ‚ç‚¹æ‰§è¡Œå®ŒcompleteWorkï¼ˆåé¢ä¼šè¯´ï¼‰åä¼šè¿”å›çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚å­FiberèŠ‚ç‚¹åŠå…¶å…„å¼ŸèŠ‚ç‚¹å®Œæˆå·¥ä½œåä¼šè¿”å›å…¶çˆ¶çº§èŠ‚ç‚¹ï¼Œæ‰€ä»¥ç”¨returnæŒ‡ä»£çˆ¶çº§èŠ‚ç‚¹ã€‚ ä½œä¸ºé™æ€çš„æ•°æ®ç»“æ„ä½œä¸ºä¸€ç§é™æ€çš„æ•°æ®ç»“æ„ï¼Œä¿å­˜äº†ç»„ä»¶ç›¸å…³çš„ä¿¡æ¯ï¼š 12345678910// Fiberå¯¹åº”ç»„ä»¶çš„ç±»å‹ Function/Class/Host...this.tag = tag;// keyå±æ€§this.key = key;// å¤§éƒ¨åˆ†æƒ…å†µåŒtypeï¼ŒæŸäº›æƒ…å†µä¸åŒï¼Œæ¯”å¦‚FunctionComponentä½¿ç”¨React.memoåŒ…è£¹this.elementType = null;// å¯¹äº FunctionComponentï¼ŒæŒ‡å‡½æ•°æœ¬èº«ï¼Œå¯¹äºClassComponentï¼ŒæŒ‡classï¼Œå¯¹äºHostComponentï¼ŒæŒ‡DOMèŠ‚ç‚¹tagNamethis.type = null;// Fiberå¯¹åº”çš„çœŸå®DOMèŠ‚ç‚¹this.stateNode = null; ä½œä¸ºåŠ¨æ€çš„å·¥ä½œå•å…ƒä½œä¸ºåŠ¨æ€çš„å·¥ä½œå•å…ƒï¼ŒFiberä¸­å¦‚ä¸‹å‚æ•°ä¿å­˜äº†æœ¬æ¬¡æ›´æ–°ç›¸å…³çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¼šåœ¨åç»­çš„æ›´æ–°æµç¨‹ä¸­ä½¿ç”¨åˆ°å…·ä½“å±æ€§æ—¶å†è¯¦ç»†ä»‹ç» 123456789101112131415// ä¿å­˜æœ¬æ¬¡æ›´æ–°é€ æˆçš„çŠ¶æ€æ”¹å˜ç›¸å…³ä¿¡æ¯this.pendingProps = pendingProps;this.memoizedProps = null;this.updateQueue = null;this.memoizedState = null;this.dependencies = null;this.mode = mode;// ä¿å­˜æœ¬æ¬¡æ›´æ–°ä¼šé€ æˆçš„DOMæ“ä½œthis.effectTag = NoEffect;this.nextEffect = null;this.firstEffect = null;this.lastEffect = null; å¦‚ä¸‹ä¸¤ä¸ªå­—æ®µä¿å­˜è°ƒåº¦ä¼˜å…ˆçº§ç›¸å…³çš„ä¿¡æ¯ï¼Œä¼šåœ¨å­¦ä¹ Scheduleræ—¶è¯´ 123// è°ƒåº¦ä¼˜å…ˆçº§ç›¸å…³this.lanes = NoLanes;this.childLanes = NoLanes; Fiberå·¥ä½œåŸç†é¦–å…ˆï¼Œä¸Šé¢è¯´äº†ï¼ŒFiberèŠ‚ç‚¹ç›´æ¥ä¼šæ„æˆä¸€æ£µFiberæ ‘ï¼Œå¹¶ä¸”å­˜æœ‰èŠ‚ç‚¹ä»¥åŠå„ç§ä¿¡æ¯æ¯ä¸ªFiberã€‚ æ‰€ä»¥ä¸€ä¸ªFiberæ˜¯æ ¹æ®ä¸€ä¸ªdomæˆ–è€…è¯´React Elementçš„å‡ºæ¥çš„ï¼Œé‚£ä¹ˆæ ‘çš„ç»“æ„ä¹Ÿå’Œdomæˆ–è€…ç»„ä»¶æ ‘ç›¸åŒã€‚ ä¸»è¦ æ›´æ–° å·¥ä½œåŸç†ï¼Œè¿™é‡Œç”¨åˆ°äº†ä¸€ä¸ªå«åš åŒç¼“å­˜çš„æŠ€æœ¯ what is åŒç¼“å­˜ï¼Ÿå½“æˆ‘ä»¬ç”¨canvasç»˜åˆ¶åŠ¨ç”»ï¼Œæ¯ä¸€å¸§ç»˜åˆ¶å‰éƒ½ä¼šè°ƒç”¨ctx.clearRectæ¸…é™¤ä¸Šä¸€å¸§çš„ç”»é¢ã€‚ å¦‚æœå½“å‰å¸§ç”»é¢è®¡ç®—é‡æ¯”è¾ƒå¤§ï¼Œå¯¼è‡´æ¸…é™¤ä¸Šä¸€å¸§ç”»é¢åˆ°ç»˜åˆ¶å½“å‰å¸§ç”»é¢ä¹‹é—´æœ‰è¾ƒé•¿é—´éš™ï¼Œå°±ä¼šå‡ºç°ç™½å±ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å†…å­˜ä¸­ç»˜åˆ¶å½“å‰å¸§åŠ¨ç”»ï¼Œç»˜åˆ¶å®Œæ¯•åç›´æ¥ç”¨å½“å‰å¸§æ›¿æ¢ä¸Šä¸€å¸§ç”»é¢ï¼Œç”±äºçœå»äº†ä¸¤å¸§æ›¿æ¢é—´çš„è®¡ç®—æ—¶é—´ï¼Œä¸ä¼šå‡ºç°ä»ç™½å±åˆ°å‡ºç°ç”»é¢çš„é—ªçƒæƒ…å†µã€‚ è¿™ç§åœ¨å†…å­˜ä¸­æ„å»ºå¹¶ç›´æ¥æ›¿æ¢çš„æŠ€æœ¯å«åšåŒç¼“å­˜ ã€‚ Reactä½¿ç”¨â€œåŒç¼“å­˜â€æ¥å®ŒæˆFiberæ ‘çš„æ„å»ºä¸æ›¿æ¢â€”â€”å¯¹åº”ç€DOMæ ‘çš„åˆ›å»ºä¸æ›´æ–°ã€‚ Fiberæ ‘å’ŒåŒç¼“å­˜ Reactä¸­æœ€å¤šä¼šåŒæ—¶å­˜åœ¨ä¸¤æ£µFiberæ ‘ Current Fiber æ ‘ï¼šå½“å‰æ˜¾ç¤ºåœ¨å±å¹•é¢å‰çš„æ ‘ workInProgress Fiber æ ‘ï¼šæ­£åœ¨å†…å­˜ä¸­æ„å»ºçš„æ ‘ current Fiberæ ‘ä¸­çš„FiberèŠ‚ç‚¹è¢«ç§°ä¸ºcurrent fiberï¼ŒworkInProgress Fiberæ ‘ä¸­çš„FiberèŠ‚ç‚¹è¢«ç§°ä¸ºworkInProgress fiberï¼Œä»–ä»¬é€šè¿‡alternateå±æ€§è¿æ¥ã€‚ 12currentFiber.alternate === workInProgressFiber;workInProgressFiber.alternate === currentFiber; Reactåº”ç”¨çš„æ ¹èŠ‚ç‚¹é€šè¿‡ä½¿currentæŒ‡é’ˆåœ¨ä¸åŒFiberæ ‘çš„rootFiberé—´åˆ‡æ¢æ¥å®Œæˆcurrent Fiberæ ‘æŒ‡å‘çš„åˆ‡æ¢ã€‚ å³å½“workInProgress Fiberæ ‘æ„å»ºå®Œæˆäº¤ç»™Rendereræ¸²æŸ“åœ¨é¡µé¢ä¸Šåï¼Œåº”ç”¨æ ¹èŠ‚ç‚¹çš„currentæŒ‡é’ˆæŒ‡å‘workInProgress Fiberæ ‘ï¼Œæ­¤æ—¶workInProgress Fiberæ ‘å°±å˜ä¸ºcurrent Fiberæ ‘ã€‚ æ¯æ¬¡çŠ¶æ€æ›´æ–°éƒ½ä¼šäº§ç”Ÿæ–°çš„workInProgress Fiberæ ‘ï¼Œé€šè¿‡currentä¸workInProgressçš„æ›¿æ¢ï¼Œå®ŒæˆDOMæ›´æ–°ã€‚ mountæ—¶å€™è€ƒè™‘å¦‚ä¸‹ä¾‹å­ï¼š 12345678function App() &#123; const [num, add] = useState(0); return ( &lt;p onClick=&#123;() =&gt; add(num + 1)&#125;&gt;&#123;num&#125;&lt;/p&gt; )&#125;ReactDOM.render(&lt;App/&gt;, document.getElementById(&#x27;root&#x27;)); é¦–æ¬¡æ‰§è¡ŒReactDOM.renderä¼šåˆ›å»ºfiberRootNodeï¼ˆæºç ä¸­å«fiberRootï¼‰å’ŒrootFiberã€‚å…¶ä¸­fiberRootNodeæ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¹èŠ‚ç‚¹ï¼ŒrootFiberæ˜¯``æ‰€åœ¨ç»„ä»¶æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚ ä¹‹æ‰€ä»¥è¦åŒºåˆ†fiberRootNodeä¸rootFiberï¼Œæ˜¯å› ä¸ºåœ¨åº”ç”¨ä¸­æˆ‘ä»¬å¯ä»¥å¤šæ¬¡è°ƒç”¨ReactDOM.renderæ¸²æŸ“ä¸åŒçš„ç»„ä»¶æ ‘ï¼Œä»–ä»¬ä¼šæ‹¥æœ‰ä¸åŒçš„rootFiberã€‚ä½†æ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¹èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯fiberRootNodeã€‚ fiberRootNodeçš„currentä¼šæŒ‡å‘å½“å‰é¡µé¢ä¸Šå·²æ¸²æŸ“å†…å®¹å¯¹åº”Fiberæ ‘ï¼Œå³current Fiberæ ‘ã€‚ ç”±äºæ˜¯é¦–å±æ¸²æŸ“ï¼Œé¡µé¢ä¸­è¿˜æ²¡æœ‰æŒ‚è½½ä»»ä½•DOMï¼Œæ‰€ä»¥fiberRootNode.currentæŒ‡å‘çš„rootFiberæ²¡æœ‰ä»»ä½•å­FiberèŠ‚ç‚¹ï¼ˆå³current Fiberæ ‘ä¸ºç©ºï¼‰ã€‚ æ¥ä¸‹æ¥è¿›å…¥renderé˜¶æ®µï¼Œæ ¹æ®ç»„ä»¶è¿”å›çš„JSXåœ¨å†…å­˜ä¸­ä¾æ¬¡åˆ›å»ºFiberèŠ‚ç‚¹å¹¶è¿æ¥åœ¨ä¸€èµ·æ„å»ºFiberæ ‘ï¼Œè¢«ç§°ä¸ºworkInProgress Fiberæ ‘ã€‚ï¼ˆä¸‹å›¾ä¸­å³ä¾§ä¸ºå†…å­˜ä¸­æ„å»ºçš„æ ‘ï¼Œå·¦ä¾§ä¸ºé¡µé¢æ˜¾ç¤ºçš„æ ‘ï¼‰ åœ¨æ„å»ºworkInProgress Fiberæ ‘æ—¶ä¼šå°è¯•å¤ç”¨current Fiberæ ‘ä¸­å·²æœ‰çš„FiberèŠ‚ç‚¹å†…çš„å±æ€§ï¼Œåœ¨é¦–å±æ¸²æŸ“æ—¶åªæœ‰rootFiberå­˜åœ¨å¯¹åº”çš„current fiberï¼ˆå³rootFiber.alternateï¼‰ã€‚ updateæ—¶ æ¥ä¸‹æ¥æˆ‘ä»¬ç‚¹å‡»pèŠ‚ç‚¹è§¦å‘çŠ¶æ€æ”¹å˜ï¼Œè¿™ä¼šå¼€å¯ä¸€æ¬¡æ–°çš„renderé˜¶æ®µå¹¶æ„å»ºä¸€æ£µæ–°çš„workInProgress Fiber æ ‘ã€‚ è¿™ä¸ªå†³å®šæ˜¯å¦å¤ç”¨çš„è¿‡ç¨‹å°±æ˜¯Diffç®—æ³•ï¼Œåé¢ä¼šè¯´ workInProgress Fiber æ ‘åœ¨renderé˜¶æ®µå®Œæˆæ„å»ºåè¿›å…¥commité˜¶æ®µæ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚æ¸²æŸ“å®Œæ¯•åï¼ŒworkInProgress Fiber æ ‘å˜ä¸ºcurrent Fiber æ ‘ã€‚ æŸ¥çœ‹æºç ä¸­çš„FiberRootNodeä¸Šé¢æ›¾è¯´åˆ°ï¼Œæˆ‘ä»¬é¦–æ¬¡åˆ›å»ºreactçš„åº”ç”¨çš„æ—¶å€™ä¼šåˆ›å»ºæ•´ä¸ªåº”ç”¨çš„ä¸€ä¸ªæ ¹èŠ‚ç‚¹ å«åš FiberRootNode ç„¶åæ¯æ¬¡è°ƒç”¨renderæ–¹æ³•éƒ½ä¼šåˆ›å»ºå½“å‰ç»„ä»¶çš„ä¸€ä¸ªæ ¹èŠ‚ç‚¹å«åš rootFiber è¿™é‡Œæˆ‘ä»¬éªŒè¯ä»¥ä¸‹è¿™ä¸ª FiberRootNode å›¾ä¸­åœˆå‡ºçš„éƒ¨åˆ†å°±æ˜¯reactåº”ç”¨é¦–æ¬¡è¿è¡Œæ—¶å€™ï¼Œåˆ›å»ºä¸€ä¸ªåº”ç”¨æ ¹èŠ‚ç‚¹FiberRootNodeçš„è¿‡ç¨‹ æˆ‘ä»¬é¡ºç€è°ƒç”¨æ ˆæ‰¾åˆ°è¿™ä¸ªåˆ›å»ºçš„è°ƒç”¨æ–¹æ³• creatFiberRoot â€” createFiberï¼ˆåˆ›å»ºåº”ç”¨æ ¹çš„æ–¹æ³•ï¼‰ æ‰¾åˆ°æºç ï¼Œæ‰“ä¸ªæ–­ç‚¹ åˆ·æ–°é¡µé¢ä¹‹å å‘ç°é¦–æ¬¡æ¸²æŸ“ï¼Œåˆ›å»ºfiberRootèŠ‚ç‚¹ï¼Œè¿™ä¸ªtagä¸º3ï¼Œé‚£ä¹ˆä»£è¡¨ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥åœ¨å®ƒå³è¾¹çš„è°ƒç”¨æ ˆä¸­æ‰¾åˆ°ä¸Šå±‚å‡½æ•°createHostRootFiber å…¶å®å‘ç°è¿™ä¸ªtagï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„HostRootå€¼ä¸º3","tags":["React","React fiber"],"categories":["React"]},{"title":"Reactæºç å­¦ä¹ ","path":"/2021/08/16/Reactæºç å­¦ä¹ -å…¥å£-part1/","content":"å®˜æ–¹ï¼š React æ˜¯ç”¨ JavaScript æ„å»ºå¿«é€Ÿå“åº”çš„å¤§å‹ Web åº”ç”¨ç¨‹åºçš„é¦–é€‰æ–¹å¼ å¡é¢‚reactæ·±åº¦è§£æ é¦–å…ˆå­¦ä¹ ä¸€ä¸ªæ¡†æ¶çš„æºç æˆ–è€…åº“çš„æºç ï¼Œæˆ‘ä»¬éƒ½è¦ä»ä»–ä»¬çš„å…¥å£å‡½æ•°å‡ºæ‰‹ã€‚è€Œreactè¿™ä¸ªjsåº“å°±æ˜¯ä»ReactDOM.renderå…¥æ‰‹çš„ å‰è¨€ï¼šReactçš„å¿«é€Ÿå“åº”æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ é‡åˆ°å¤§é‡è®¡ç®—ä¸ä¼šè®©é¡µé¢æ‰å¸§æˆ–è€…å¯¼è‡´å¡é¡¿ï¼ˆè¿™é‡Œè¦æƒ³åˆ°æ¯ç§’60å¸§ï¼ˆHZï¼‰ï¼Œæ¯å¸§16.6msï¼‰ ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸€å¸§é‡Œå¤´åšäº†å¤ªå¤šçš„è®¡ç®—å·¥ä½œäº†ï¼Œè¿™é‡Œå…·ä½“è¦å»çœ‹çœ‹æµè§ˆå™¨æ¸²æŸ“è¿›ç¨‹é‡Œå¤´çš„jsçº¿ç¨‹å’ŒGUIçº¿ç¨‹æ€ä¹ˆåšæ“ä½œçš„ï¼Œç›®å‰æœ‰ä¸€ä¸ªå…¼å®¹æ€§ä¸æ˜¯å¾ˆå¥½çš„è°ƒåº¦apiå«åšrequestIdelCallbackæ˜¯ç”¨æ¥ç”³è¯·æµè§ˆå™¨è°ƒåº¦çš„ï¼Œä½†æ˜¯reacté™¤äº†è¿™ä¸ªå› ä¸ºå…¶ä»–ç§ç§åŸå› è‚¯å®šä¸èƒ½ç”¨è¿™ä¸ªï¼Œæ‰€ä»¥åœ¨16ä¹‹åè‡ªå·±å®ç°äº†è°ƒåº¦æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¦è¯´çš„scheduler ç½‘ç»œè¯·æ±‚æ•°æ®è¿”å›åæ‰èƒ½è¿›è¡Œæ“ä½œï¼Œå› æ­¤ä¸èƒ½å¿«é€Ÿå“åº”ï¼ˆè¿™é‡Œæ¶‰åŠåˆ°ç”¨æˆ·ä½“éªŒä¸Šé¢ï¼Œæ„æ€å°±æ˜¯æƒ³è¦è®©ç”¨æˆ·æŠŠè¿™ç§å¼‚æ­¥çš„è¯·æ±‚ï¼Œè‡ªæˆ‘æ„ŸçŸ¥æˆåŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘æ ¹æœ¬æ²¡ååº”è¿‡æ¥ï¼Œä½ è¿™ä¸ªå±…ç„¶å°±å¯ä»¥ç”¨äº†çš„æ„æ€ï¼‰ ä¸¤ç±»å¯¹åº”ç€ CPUçš„ç“¶é¢ˆ IOçš„ç“¶é¢ˆ æ‰€ä»¥æˆ‘ä»¬å¼•å‡ºï¼š reactæ˜¯å¦‚ä½•ä»è¿™ä¸¤ä¸ªæ–¹é¢è¿›è¡Œä¼˜åŒ–çš„å‘¢ï¼Ÿ CPUç“¶é¢ˆåŠ å…¥æˆ‘ä»¬ä¸€ä¸ªé¡µé¢ä¸­éœ€è¦ä¸€æ¬¡æ€§æ¸²æŸ“30kä¸ªdomå…ƒç´  1234567891011function App() &#123; const len = 3000; return ( &lt;ul&gt; &#123;Array(len).fill(0).map((_, i) =&gt; &lt;li&gt;&#123;i&#125;&lt;/li&gt;)&#125; &lt;/ul&gt; );&#125;const rootEl = document.querySelector(&quot;#root&quot;);ReactDOM.render(&lt;App/&gt;, rootEl); è€Œå¤§éƒ¨åˆ†ç›®å‰è®¾å¤‡æµè§ˆå™¨åˆ·æ–°æ¯”ç‡éƒ½æ˜¯60HZï¼ˆæ¯ç§’60å¸§ï¼‰ï¼Œ16.6msåˆ·æ–°ä¸€å¸§ è€Œï¼Œ JSå¯ä»¥æ“ä½œDOMï¼ŒGUIæ¸²æŸ“çº¿ç¨‹ä¸JSçº¿ç¨‹æ˜¯äº’æ–¥çš„ï¼Œ JSè„šæœ¬æ‰§è¡Œå’Œæµè§ˆå™¨å¸ƒå±€ã€ç»˜åˆ¶ä¸èƒ½åŒæ—¶æ‰§è¡Œã€‚ åœ¨æ¯16.6msæ—¶é—´å†…ï¼Œéœ€è¦å®Œæˆå¦‚ä¸‹å·¥ä½œï¼š 1JSè„šæœ¬æ‰§è¡Œ ----- æ ·å¼å¸ƒå±€ ----- æ ·å¼ç»˜åˆ¶ å½“JSæ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œè¶…å‡ºäº†16.6msï¼Œè¿™æ¬¡åˆ·æ–°å°±æ²¡æœ‰æ—¶é—´æ‰§è¡Œæ ·å¼å¸ƒå±€å’Œæ ·å¼ç»˜åˆ¶äº†ã€‚ åœ¨Demoä¸­ï¼Œç”±äºç»„ä»¶æ•°é‡ç¹å¤šï¼ˆ3000ä¸ªï¼‰ï¼ŒJSè„šæœ¬æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œé¡µé¢æ‰å¸§ï¼Œé€ æˆå¡é¡¿ã€‚ å¯ä»¥ä»æ‰“å°çš„æ‰§è¡Œå †æ ˆå›¾çœ‹åˆ°ï¼ŒJSæ‰§è¡Œæ—¶é—´ä¸º73.65msï¼Œè¿œè¿œå¤šäºä¸€å¸§çš„æ—¶é—´ å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ï¼šåœ¨æµè§ˆå™¨æ¯ä¸€å¸§çš„æ—¶é—´ä¸­ï¼Œé¢„ç•™ä¸€äº›æ—¶é—´ç»™JSçº¿ç¨‹ï¼ŒReactåˆ©ç”¨è¿™éƒ¨åˆ†æ—¶é—´æ›´æ–°ç»„ä»¶ï¼ˆå¯ä»¥çœ‹åˆ°ï¼Œåœ¨æºç  (opens new window)ä¸­ï¼Œé¢„ç•™çš„åˆå§‹æ—¶é—´æ˜¯5msï¼‰ã€‚ å½“é¢„ç•™çš„æ—¶é—´ä¸å¤Ÿç”¨æ—¶ï¼ŒReactå°†çº¿ç¨‹æ§åˆ¶æƒäº¤è¿˜ç»™æµè§ˆå™¨ä½¿å…¶æœ‰æ—¶é—´æ¸²æŸ“UIï¼ŒReactåˆ™ç­‰å¾…ä¸‹ä¸€å¸§æ—¶é—´åˆ°æ¥ç»§ç»­è¢«ä¸­æ–­çš„å·¥ä½œã€‚ è¿™ç§å°†é•¿ä»»åŠ¡åˆ†æ‹†åˆ°æ¯ä¸€å¸§ä¸­ï¼Œåƒèš‚èšæ¬å®¶ä¸€æ ·ä¸€æ¬¡æ‰§è¡Œä¸€å°æ®µä»»åŠ¡çš„æ“ä½œï¼Œè¢«ç§°ä¸ºæ—¶é—´åˆ‡ç‰‡ï¼ˆtime sliceï¼‰ æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å¯Concurrent Mode 123// é€šè¿‡ä½¿ç”¨ReactDOM.unstable_createRootå¼€å¯Concurrent Mode// ReactDOM.render(&lt;App/&gt;, rootEl); ReactDOM.unstable_createRoot(rootEl).render(&lt;App/&gt;); æ­¤æ—¶æˆ‘ä»¬çš„é•¿ä»»åŠ¡è¢«æ‹†åˆ†åˆ°æ¯ä¸€å¸§ä¸åŒçš„taskä¸­ï¼ŒJSè„šæœ¬æ‰§è¡Œæ—¶é—´å¤§ä½“åœ¨5mså·¦å³ï¼Œè¿™æ ·æµè§ˆå™¨å°±æœ‰å‰©ä½™æ—¶é—´æ‰§è¡Œæ ·å¼å¸ƒå±€å’Œæ ·å¼ç»˜åˆ¶ï¼Œå‡å°‘æ‰å¸§çš„å¯èƒ½æ€§ã€‚ æ‰€ä»¥ï¼Œè§£å†³CPUç“¶é¢ˆçš„å…³é”®æ˜¯å®ç°æ—¶é—´åˆ‡ç‰‡ï¼Œè€Œæ—¶é—´åˆ‡ç‰‡çš„å…³é”®æ˜¯ï¼šå°†åŒæ­¥çš„æ›´æ–°å˜ä¸ºå¯ä¸­æ–­çš„å¼‚æ­¥æ›´æ–°ã€‚ IOç“¶é¢ˆç½‘ç»œå»¶è¿Ÿæ˜¯å‰ç«¯å¼€å‘è€…æ— æ³•è§£å†³çš„ã€‚å¦‚ä½•åœ¨ç½‘ç»œå»¶è¿Ÿå®¢è§‚å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œå‡å°‘ç”¨æˆ·å¯¹ç½‘ç»œå»¶è¿Ÿçš„æ„ŸçŸ¥ï¼Ÿ Reactç»™å‡ºçš„ç­”æ¡ˆæ˜¯å°†äººæœºäº¤äº’ç ”ç©¶çš„ç»“æœæ•´åˆåˆ°çœŸå®çš„ UI ä¸­ (opens new window)ã€‚ è¿™é‡Œæˆ‘ä»¬ä»¥ä¸šç•Œäººæœºäº¤äº’æœ€é¡¶å°–çš„è‹¹æœä¸¾ä¾‹ï¼Œåœ¨IOSç³»ç»Ÿä¸­ï¼š ç‚¹å‡»â€œè®¾ç½®â€é¢æ¿ä¸­çš„â€œé€šç”¨â€ï¼Œè¿›å…¥â€œé€šç”¨â€ç•Œé¢ï¼š ä½œä¸ºå¯¹æ¯”ï¼Œå†ç‚¹å‡»â€œè®¾ç½®â€é¢æ¿ä¸­çš„â€œSiriä¸æœç´¢â€ï¼Œè¿›å…¥â€œSiriä¸æœç´¢â€ç•Œé¢ï¼š äº‹å®ä¸Šï¼Œç‚¹å‡»â€œé€šç”¨â€åçš„äº¤äº’æ˜¯åŒæ­¥çš„ï¼Œç›´æ¥æ˜¾ç¤ºåç»­ç•Œé¢ã€‚è€Œç‚¹å‡»â€œSiriä¸æœç´¢â€åçš„äº¤äº’æ˜¯å¼‚æ­¥çš„ï¼Œéœ€è¦ç­‰å¾…è¯·æ±‚è¿”å›åå†æ˜¾ç¤ºåç»­ç•Œé¢ã€‚ä½†ä»ç”¨æˆ·æ„ŸçŸ¥æ¥çœ‹ï¼Œè¿™ä¸¤è€…çš„åŒºåˆ«å¾®ä¹å…¶å¾®ã€‚ è¿™é‡Œçš„çªé—¨åœ¨äºï¼šç‚¹å‡»â€œSiriä¸æœç´¢â€åï¼Œå…ˆåœ¨å½“å‰é¡µé¢åœç•™äº†ä¸€å°æ®µæ—¶é—´ï¼Œè¿™ä¸€å°æ®µæ—¶é—´è¢«ç”¨æ¥è¯·æ±‚æ•°æ®ã€‚ å½“â€œè¿™ä¸€å°æ®µæ—¶é—´â€è¶³å¤ŸçŸ­æ—¶ï¼Œç”¨æˆ·æ˜¯æ— æ„ŸçŸ¥çš„ã€‚å¦‚æœè¯·æ±‚æ—¶é—´è¶…è¿‡ä¸€ä¸ªèŒƒå›´ï¼Œå†æ˜¾ç¤ºloadingçš„æ•ˆæœã€‚ è¯•æƒ³å¦‚æœæˆ‘ä»¬ä¸€ç‚¹å‡»â€œSiriä¸æœç´¢â€å°±æ˜¾ç¤ºloadingæ•ˆæœï¼Œå³ä½¿æ•°æ®è¯·æ±‚æ—¶é—´å¾ˆçŸ­ï¼Œloadingæ•ˆæœä¸€é—ªè€Œè¿‡ã€‚ç”¨æˆ·ä¹Ÿæ˜¯å¯ä»¥æ„ŸçŸ¥åˆ°çš„ã€‚ ä¸ºæ­¤ï¼ŒReactå®ç°äº†Suspense (opens new window)åŠŸèƒ½åŠé…å¥—çš„hookâ€”â€”useDeferredValue (opens new window)ã€‚ è€Œåœ¨æºç å†…éƒ¨ï¼Œä¸ºäº†æ”¯æŒè¿™äº›ç‰¹æ€§ï¼ŒåŒæ ·éœ€è¦å°†åŒæ­¥çš„æ›´æ–°å˜ä¸ºå¯ä¸­æ–­çš„å¼‚æ­¥æ›´æ–°ã€‚ æ€»ç»“é€šè¿‡ä»¥ä¸Šå†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒReactä¸ºäº†è·µè¡Œâ€œæ„å»ºå¿«é€Ÿå“åº”çš„å¤§å‹ Web åº”ç”¨ç¨‹åºâ€ç†å¿µåšå‡ºçš„åŠªåŠ›ã€‚ å…¶ä¸­çš„å…³é”®æ˜¯è§£å†³CPUçš„ç“¶é¢ˆä¸IOçš„ç“¶é¢ˆã€‚è€Œè½å®åˆ°å®ç°ä¸Šï¼Œåˆ™éœ€è¦å°†åŒæ­¥çš„æ›´æ–°å˜ä¸ºå¯ä¸­æ–­çš„å¼‚æ­¥æ›´æ–°ã€‚ æ–°è€Reactæ¶æ„å¯¹æ¯”ï¼ˆ15 vs 16++ï¼‰ ä¸ºä»€ä¹ˆreact16è¦å¯¹15è¿›è¡Œå†…éƒ¨é‡æ„å‘¢ï¼Ÿ Fiberæ¶æ„å®˜æ–¹å›ç­”ä»€ä¹ˆæ˜¯fiber","tags":["React"],"categories":["Reactæºç å­¦ä¹ "]},{"title":"å›¢é˜Ÿè§„èŒƒä»¥åŠè§£å†³æ–¹æ³•","path":"/2021/08/12/å›¢é˜Ÿè§„èŒƒå¸¸ç”¨åŒ…/","content":"æˆ‘ä»¬åœ¨å¹³æ—¶æ—¥å¸¸å¼€å‘çš„æ—¶å€™, è‚¯å®šæ˜¯è¦åˆ¶å®šä¸€å¥—é¡¹ç›®è§„èŒƒï¼Œå»è¿›è¡Œå›¢é˜Ÿçš„å¼€å‘ä»£ç ç®¡ç†çš„ï¼Œå› æ­¤éœ€è¦æ¶‰åŠåˆ°å¾ˆå¤šæ–¹é¢ï¼›æ¯”å¦‚eslintä»£ç è§„åˆ™æ£€æŸ¥ï¼Œhuskyè¿™ç§ä¸ºnpm scriptæä¾›gitçš„é’©å­çš„ï¼Œlint-stagedç»“åˆhuskyï¼Œç„¶åä½¿ç”¨commitlintå»è§„èŒƒæäº¤ä»£ç æ¶ˆæ¯ç­‰ç­‰ ä»£ç æ£€æŸ¥huskyts-linteslintlint-stagedcommitlinthttps://github.com/conventional-changelog/commitlint https://commitlint.js.org/#/reference-rules?id=references-empty","tags":["webpack"]},{"title":"bugè®°å½•ä»¥åŠè§£å†³æ–¹æ¡ˆ","path":"/2021/08/12/bugè®°å½•ä»¥åŠè§£å†³æ–¹æ¡ˆ/","content":"Electron chrome devtools Error message â€œDevTools failed to load SourceMap: Could not load content for chrome-extension://â€¦â€ PostCss Error: PostCSS plugin autoprefixer requires PostCSS 8. Update PostCSS or downgrade this pluginã€‚ https://blog.csdn.net/qq_38385108/article/details/108693404 VScode è§£å†³VSCODEâ€å› ä¸ºåœ¨æ­¤ç³»ç»Ÿä¸Šç¦æ­¢è¿è¡Œè„šæœ¬â€æŠ¥é”™ https://blog.csdn.net/larpland/article/details/101349586 UMI è§£å†³umié¡¹ç›®å¼•å…¥Reactæ— æ™ºèƒ½æç¤ºï¼ŒæŠ¥é”™â€œReactâ€æŒ‡ UMD å…¨å±€ï¼Œä½†å½“å‰æ–‡ä»¶æ˜¯æ¨¡å—ã€‚è¯·è€ƒè™‘æ”¹ä¸ºæ·»åŠ å¯¼å…¥ã€‚ts(2686)çš„é—®é¢˜ã€‚ eslint Oops! Something went wrong! No files matching the pattern &quot;./src/assets/scripts/**/*.js&quot; were found.è§£å†³æ–¹æ³• â€˜lodashâ€™ should be listed in the projectâ€™s dependencies, not devDependencies.eslintimport/no-extraneous-dependencies è§£å†³æ–¹æ³• webpack5 Webpack 5 - Uncaught ReferenceError: process is not defined huskyhusky &gt; commit-msg hook failed (add â€“no-verify to bypass) è§£å†³æ–¹æ³• commitlint.config.jsçš„ç¼–ç ä¿®æ”¹ä¸ºUTF-8","tags":["bugs"]},{"title":"eslintåœ¨vscodeä¸­ä¸ç”Ÿæ•ˆçš„åŸå› ","path":"/2021/08/12/eslintåœ¨vscodeä¸­ä¸ç”Ÿæ•ˆçš„åŸå› /","content":"æ£€æŸ¥æ˜¯å¦é…ç½®ä»¥ä¸‹å†…å®¹ package.jsonä¸­æ˜¯å¦é…ç½®äº†eslintä¾èµ– å·¥ç¨‹ç›®å½•ä¸‹æ˜¯å¦æœ‰.eslintrc.jså’Œ.eslintignoreæ–‡ä»¶ 2.æŸ¥çœ‹vscodeæ˜¯å¦å®‰è£…äº†eslintæ’ä»¶å¹¶å¯ç”¨ setting.jsoné‡Œæ˜¯å¦æœ‰eslintçš„é…ç½®é¡¹ vscodeçŠ¶æ€æ  eslitnæ˜¯å¦å¼€å¯ï¼Œæ˜¾ç¤ºæ‰“å‹¾çŠ¶æ€ 5.å¤‡æ³¨ï¼švscodeçŠ¶æ€æ æ˜¾ç¤ºç¦ç”¨æˆ–è€…æŠ¥é”™éƒ½ä¼šå¯¼è‡´eslintä¸ç”Ÿæ•ˆ è§£å†³æ–¹æ³•ï¼šä»¥ä¸Šä¸¤ç§æƒ…å†µç‚¹å‡»çŠ¶æ€æ ä¸Šeslintåˆ†åˆ«å¼¹å‡ºä»¥ä¸‹å¼¹çª—ï¼Œç‚¹å‡»allowæŒ‰é’®å³å¯","tags":["Eslint"],"categories":["Eslint"]},{"title":"babel","path":"/2021/08/07/babel/","content":"@babel/plugin-transform-runtimebabelå®˜æ–¹æä¾›çš„ä¸€ä¸ªæ’ä»¶ï¼Œä½œç”¨æ˜¯å‡å°‘å†—ä½™çš„ä»£ç ã€‚ ä¾‹å¦‚ï¼š class extend çš„è¯­æ³•åœ¨è½¬æ¢åä¼šåœ¨ES5çš„ä»£ç é‡Œå¤´æ³¨å…¥_extendè¾…åŠ©å‡½æ•°ç”¨äºå®ç°ç»§æ‰¿ è¿™å¯¼è‡´æ¯ä¸ªä½¿ç”¨class extendè¯­æ³•çš„æ–‡ä»¶éƒ½ä¼šè¢«æ³¨å…¥é‡å¤çš„_extendsè¾…åŠ©å‡½æ•°ä»£ç  å› æ­¤è¿™ä¸ªæ’ä»¶å¯ä»¥å°†è¿™ä¸ªæ³¨å…¥å‡½æ•°æ”¹æˆrequireçš„å½¢å¼å¯¼å…¥è¯­å¥æ¥å‡å°‘ä»£ç æ–‡ä»¶å¤§å° éœ€è¦å’Œbabel-runtimeç»“åˆä½¿ç”¨ babel-loaderhttps://www.npmjs.com/package/babel-loader è¿™ä¸ªåŒ…å…è®¸ä½¿ç”¨ Babel å’Œ webpack è½¬è¯‘ JavaScript æ–‡ä»¶ã€‚ @babel/coreBabel ç¼–è¯‘å™¨æ ¸å¿ƒã€‚ @babel/preset-envhttps://babel.dev/docs/en/babel-preset-env @babel/preset-env æ˜¯ä¸€ä¸ªæ™ºèƒ½é¢„è®¾ï¼Œå®ƒå…è®¸æ‚¨ä½¿ç”¨æœ€æ–°çš„ JavaScriptï¼Œè€Œæ— éœ€å¯¹ç›®æ ‡ç¯å¢ƒéœ€è¦å“ªäº›è¯­æ³•è½¬æ¢ï¼ˆä»¥åŠå¯é€‰çš„æµè§ˆå™¨ polyfillï¼‰è¿›è¡Œå¾®è§‚ç®¡ç†ã€‚ @babel/runtime@babel/runtime æ˜¯ä¸€ä¸ªåŒ…å« Babel æ¨¡å—åŒ–è¿è¡Œæ—¶åŠ©æ‰‹å’Œ regenerator-runtime ç‰ˆæœ¬çš„åº“ã€‚ @babel/eslint-parserESLint çš„é»˜è®¤è§£æå™¨å’Œæ ¸å¿ƒè§„åˆ™ä»…æ”¯æŒæœ€æ–°çš„æœ€ç»ˆ ECMAScript æ ‡å‡†ï¼Œä¸æ”¯æŒ Babel æä¾›çš„å®éªŒæ€§ï¼ˆå¦‚æ–°ç‰¹æ€§ï¼‰å’Œéæ ‡å‡†ï¼ˆå¦‚ Flow æˆ– TypeScript ç±»å‹ï¼‰è¯­æ³• @babel/eslint-parser æ˜¯ä¸€ä¸ªè§£æå™¨ï¼Œå®ƒå…è®¸ ESLint åœ¨ Babel è½¬æ¢çš„æºä»£ç ä¸Šè¿è¡Œã€‚ åœ¨.eslintrc.jsé…ç½® 123module.exports = &#123; parser: &quot;@babel/eslint-parser&quot;,&#125;; æœ‰äº›æ–°ä¸œè¥¿å¯èƒ½è¿˜å¾—ç”¨ä¸Š@babel/eslint-plugin","tags":["webpack"],"categories":["Babel"]},{"title":"å¸¸ç”¨plugins","path":"/2021/08/05/å¸¸ç”¨plugins/","content":"CSScss-minimizer-webpack-pluginå‹ç¼©cssæ–‡ä»¶ï¼Œwebpack5ä»¥ä¸Š mini-css-extract-pluginmini-csss-extract-plugin è¿™ä¸ªæ’ä»¶å°† CSS æå–åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚å®ƒä¸ºæ¯ä¸ªåŒ…å« CSS çš„ JS æ–‡ä»¶åˆ›å»ºä¸€ä¸ª CSS æ–‡ä»¶ã€‚å®ƒæ”¯æŒæŒ‰éœ€åŠ è½½ CSS å’Œ SourceMapsã€‚ å®ƒå»ºç«‹åœ¨æ–°çš„ webpack v5 åŠŸèƒ½ä¹‹ä¸Šï¼Œå¹¶ä¸”éœ€è¦ webpack 5 æ‰èƒ½å·¥ä½œã€‚ æä¾›äº†ä¸€ä¸ªloaderï¼Œé€šè¿‡MiniCsseExtractPlugin.loaderé…ç½®loaderä½¿ç”¨ æœ‰æ—¶å€™æˆ‘ä»¬ä¼šæ‘’å¼ƒstyle-loaderçš„ä»£ç å»å‘å¸ƒçº¿ä¸Šä»£ç ï¼Œç›´æ¥ç”¨è¿™ä¸ªæ’ä»¶çš„åŸå› æ˜¯å› ä¸º css-separating cssæŠ½ç¦»æˆæ–‡ä»¶å¯ä»¥ï¼Œè®©jså’Œcsså¹¶è¡ŒåŠ è½½ï¼Œæå‰è§£æcss postcss-preset-envpostcss-preset-env PostCSS Preset Env å…è®¸æ‚¨å°†ç°ä»£ CSS è½¬æ¢ä¸ºå¤§å¤šæ•°æµè§ˆå™¨å¯ä»¥ç†è§£çš„å†…å®¹ï¼Œæ ¹æ®æ‚¨çš„ç›®æ ‡æµè§ˆå™¨æˆ–è¿è¡Œæ—¶ç¯å¢ƒç¡®å®šæ‚¨éœ€è¦çš„ polyfillã€‚ autoprefixerPostCSS æ’ä»¶ï¼Œç”¨äºè§£æ CSS å¹¶ä½¿ç”¨ Can I Use ä¸­çš„å€¼å‘ CSS è§„åˆ™æ·»åŠ ä¾›åº”å•†å‰ç¼€ã€‚å®ƒç”± Google æ¨èå¹¶ç”¨äº Twitter å’Œé˜¿é‡Œå·´å·´ã€‚ Autoprefixer å°†ä½¿ç”¨åŸºäºå½“å‰æµè§ˆå™¨æµè¡Œåº¦å’Œå±æ€§æ”¯æŒçš„æ•°æ®ä¸ºæ‚¨åº”ç”¨å‰ç¼€ åˆ—å¦‚ï¼šåœ¨postcss.config.jsä¸­ 1234567891011121314151617module.exports = &#123; plugins: [ [ require(&quot;autoprefixer&quot;)(&#123; overrideBrowserslist: [ &quot;last 2 versions&quot;, &quot;Firefox ESR&quot;, &quot;&gt; 1%&quot;, &quot;ie &gt;= 8&quot;, &quot;iOS &gt;= 8&quot;, &quot;Android &gt;= 4&quot;, ], &#125;) ], ],&#125;; å½“ç„¶åœ¨webpackä¸­ä¹Ÿéœ€è¦é…ç½®postcss-loaderè¿™ä¸ªloaderæ˜¯æ‰§è¡Œæ‰€æœ‰postcssçš„æ’ä»¶çš„å…³é”®loader htmlHtmlWebpackPluginhttps://www.npmjs.com/package/html-webpack-plugin è¿™æ˜¯ä¸€ä¸ª webpack æ’ä»¶ï¼Œå®ƒç®€åŒ–äº† HTML æ–‡ä»¶çš„åˆ›å»ºä»¥æœåŠ¡äºä½ çš„ webpack åŒ…ã€‚è¿™å¯¹äºåœ¨æ–‡ä»¶åä¸­åŒ…å«å“ˆå¸Œå€¼çš„ webpack åŒ…ç‰¹åˆ«æœ‰ç”¨ï¼Œè¯¥å“ˆå¸Œå€¼ä¼šæ›´æ”¹æ¯æ¬¡ç¼–è¯‘ã€‚ æ‚¨å¯ä»¥è®©æ’ä»¶ä¸ºæ‚¨ç”Ÿæˆ HTML æ–‡ä»¶ï¼Œä½¿ç”¨ lodash æ¨¡æ¿æä¾›æ‚¨è‡ªå·±çš„æ¨¡æ¿æˆ–ä½¿ç”¨æ‚¨è‡ªå·±çš„åŠ è½½å™¨ã€‚ jsterser-webpack-pluginä½¿ç”¨è¯¥æ’ä»¶æ¥å‹ç¼©jsçš„ä»£ç  å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ webpack v5 æˆ–ä»¥ä¸Šç‰ˆæœ¬ï¼Œä½ ä¸éœ€è¦å®‰è£…è¿™ä¸ªæ’ä»¶ã€‚webpack v5 è‡ªå¸¦æœ€æ–°çš„ terser-webpack-pluginã€‚å¦‚æœä½¿ç”¨ webpack v4ï¼Œåˆ™å¿…é¡»å®‰è£… terser-webpack-plugin v4 çš„ç‰ˆæœ¬ã€‚ é™æ€èµ„æºå¤åˆ¶é™æ€èµ„æºæœ‰äº›æ—¶å€™æœ‰äº›ç¬¬ä¸‰æ–¹çš„ js æ’ä»¶æ²¡æœ‰æä¾› npm åŒ…ï¼Œåªæä¾›äº†ä¸€ä¸ª cdn åœ°å€æˆ–è€…ä¸€ä»½æ–‡ä»¶éœ€è¦è‡ªå·±ä¸‹è½½ä¸‹æ¥ã€‚é€šå¸¸æˆ‘ä»¬ä¸‹è½½ä¸‹æ¥ä¹‹åæ”¾åœ¨æˆ‘ä»¬çš„ public/js ç›®å½•ä¸‹é¢ï¼Œç„¶å public/index.html æ–‡ä»¶é‡Œç›´æ¥ç”¨ script æ ‡ç­¾å¼•å…¥ã€‚è¿™ä¸ªæ—¶å€™ä¸ç®¡æ˜¯ npm run dev å¼€å‘æ—¶ï¼Œè¿˜æ˜¯ npm run build:pro æ„å»ºåï¼Œè¿™ä¸ª js æ–‡ä»¶éƒ½æ˜¯æ‰¾ä¸åˆ°çš„ copy-webpack-plugin æ‰“åŒ…åˆ†æç›¸å…³webpack-bundle-analyzerhttps://www.npmjs.com/package/webpack-bundle-analyzer webpack-bundle-analyzer æ˜¯æ‰“åŒ…åˆ†æç¥å™¨ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªåŒ…çš„å¤§å°ï¼Œä»¥åŠæ˜¯å¦æœ‰åŒ…è¢«é‡å¤æ‰“åŒ…ã€‚ speed-measure-webpack-pluginhttps://www.npmjs.com/package/speed-measure-webpack-plugin è¿™ä¸ªæ’ä»¶å¸®åŠ©æˆ‘ä»¬åˆ†ææ•´ä¸ªæ‰“åŒ…çš„æ€»è€—æ—¶ï¼Œä»¥åŠæ¯ä¸€ä¸ªloader å’Œæ¯ä¸€ä¸ª plugins æ„å»ºæ‰€è€—è´¹çš„æ—¶é—´ï¼Œä»è€Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½åˆ°å¯ä»¥ä¼˜åŒ– Webpack çš„é…ç½®ã€‚ ä»£ç æ£€æŸ¥ä»£ç æ£€æµ‹è‚¯å®šä¸å½“å½“é’ˆå¯¹äºä»£ç çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è£…äº†å¦‚ä¸‹çš„å‡ ä¸ªpluginä¹‹åå¯ä»¥åŸºäºgitä¸ºé¡¹ç›®æ¥å…¥git hookï¼Œè¿™é‡Œæ¨èä½¿ç”¨huskyæ¥è¿›è¡Œæäº¤å‰çš„ä»£ç æ£€æµ‹ husky eslint-webpack-pluginhttps://www.npmjs.com/package/eslint-webpack-plugin é’ˆå¯¹äºjsçš„ä»£ç è¿›è¡Œä»£ç æ£€æµ‹ï¼Œä½¿ç”¨ eslint æ¥æŸ¥æ‰¾å’Œä¿®å¤ JavaScript ä»£ç ä¸­çš„é—®é¢˜ å½“ç„¶ç”¨è¿™ä¸ªä¹‹å‰è‚¯å®šæ˜¯è¦è£…eslintçš„ é€šå¸¸reactçš„é¡¹ç›®éœ€è¦ç»“åˆeslint-config-airbnbï¼Œ eslint-plugin-import, eslint-plugin-react, eslint-plugin-react-hooks, eslint-plugin-jsx-a11y, å½“ç„¶ä½ å¯ä»¥ç»“åˆhuskyä¸ºcommitä¹‹å‰æä¾›lintæŒ‡ä»¤hooksï¼Œç„¶åä½¿ç”¨lint-stagedæä¾›è¿è¡Œæ—¶å€™çš„lint stylelinthttps://github.com/stylelint/stylelint/blob/HEAD/docs/user-guide/get-started.md è¿™ç©æ„åŸºäºpostCss, èƒ½æ£€æŸ¥ä»»ä½•PostCssèƒ½è§£æçš„ä»£ç ","tags":["webpack"],"categories":["webpack-plugins"]},{"title":"å¸¸ç”¨loader","path":"/2021/08/05/å¸¸ç”¨loader/","content":"ä»¥ä¸‹è®²çš„éƒ½æ˜¯é’ˆå¯¹webpack5ç‰ˆæœ¬çš„ CSScss-loaderscss-loader webpackè¯†åˆ«ä¸äº†cssçš„ä»£ç ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªcss-loaderå»åŠ è½½cssçš„æ–‡ä»¶ style-loaderstyle-loader å°†cssï¼ˆä»¥å­—ç¬¦ä¸²å½¢å¼ï¼‰æ³¨å…¥åˆ°jsçš„ä»£ç å½“ä¸­ï¼ˆç›¸å½“äºåšäº†å­˜å‚¨ï¼‰ï¼Œä¸ä¼šé¢å¤–ç”Ÿæˆä¸€ä¸ªCSSæ–‡ä»¶ï¼Œä¹‹åé€šè¿‡ç½‘é¡µçš„jsçš„æ“ä½œçš„æ—¶å€™ç”Ÿæˆdomï¼ˆstyleæ ‡ç­¾ï¼‰æ’å…¥åˆ°htmlä¸­ï¼Œæ˜¯ä¸€ä¸ªåŠ¨æ€çš„è¿‡ç¨‹ ä¼˜ç‚¹å°†cssçš„ä»£ç ç›´æ¥æ”¾åˆ°jså½“ä¸­ï¼Œä¸ä¼šç”Ÿæˆç‹¬ç«‹cssæ–‡ä»¶ï¼Œæœ‰ç¼“å­˜ä½œç”¨ ç¼ºç‚¹jsæ–‡ä»¶å˜å¤§ï¼Œç½‘é¡µåŠ è½½æ—¶é—´å˜é•¿ï¼ˆå¯ä»¥è€ƒè™‘å•ç‹¬æŠ½ç¦»cssæ–‡ä»¶ï¼Œå¼‚æ­¥åŠ è½½ï¼‰ postcss-loaderpostcss-loader ä½¿ç”¨ PostCSS å¤„ç† CSS çš„åŠ è½½å™¨ã€‚ä¸€èˆ¬éœ€è¦é…åˆpostCSSçš„ä¸€å †pluginå»ä½¿ç”¨ï¼Œå¯ä»¥è‡ªåŠ¨ä¸ºcssåŠ ä¸Šå‰ç¼€å»é€‚é…ä¸åŒæµè§ˆå™¨è§„åˆ™ï¼Œä½¿ç”¨css-nextçš„è¯­æ³•ç­‰ç­‰ tsawesome-typescript-loaderts-loaderä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¸ç”¨tsçš„loaderå»ç¼–è¯‘tsè€Œæ˜¯ç›´æ¥ç”¨babelå‘¢ é™æ€æ–‡ä»¶file-loaderå¯ä»¥å°†jså’Œcssä¸­å¯¼å…¥å›¾ç‰‡çš„è¯­å¥æ›¿æ¢æˆæ­£ç¡®çš„åœ°å€ï¼ŒåŒæ—¶å°†æ–‡ä»¶è¾“å‡ºåˆ°å¯¹åº”çš„ä½ç½® url-loaderå¯ä»¥å°†æ–‡ä»¶å†…å®¹ç»è¿‡ç¼–ç ä¹‹åæ³¨å…¥jsæˆ–è€…csså½“ä¸­ åŸå› ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå†http1.xä¸­ï¼Œæµè§ˆå™¨ä¼šå¯¹æ¯ä¸ªåŸŸåä¸‹çš„TCPé“¾æ¥åšé™åˆ¶ï¼Œå¦‚æœå›¾ç‰‡å¾ˆå¤šå†æœåŠ¡ç«¯çš„è¯ï¼Œå¯èƒ½ä¼šé€ æˆä¸€ç§æƒ…å†µï¼Œè¯·æ±‚å¾ˆå¤šï¼ŒTCPè¿æ¥å¾ˆå¤šï¼Œå›¾ç‰‡è¯·æ±‚å°±å¾ˆæ…¢ï¼Œæ‰€ä»¥ç›´æ¥è½¬æˆbase64å°±èƒ½å¤§å¤§å‡å°‘è¯·æ±‚æ¬¡æ•° å½“ç„¶è¿™å—å¤§æ–‡ä»¶è¿˜æ˜¯ä¸å»ºè®®è½¬base64çš„ webpack 5å†…ç½®äº†è¿™äº›ç©æ„ï¼Œæ‰€ä»¥å’±ä»¬å¯ä»¥ç›´æ¥ç”¨webpack5é‡Œå¤´çš„ä¸œè¥¿äº† assests mini-svg-data-urihttps://www.npmjs.com/package/mini-svg-data-uri è¯¥å·¥å…·å°† SVG è½¬æ¢ä¸ºæœ€ç´§å‡‘ã€å¯å‹ç¼©çš„æ•°æ®ï¼šæ”¯æŒ SVG çš„æµè§ˆå™¨å¯ä»¥å®¹å¿çš„ URIã€‚ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼ˆ169 å­—èŠ‚ï¼‰ï¼š æ¯”èµ·è½¬æˆbase64çš„ä¼šå°ä¸€äº›ï¼Œè¿˜æœ‰é‚£äº›ç›´æ¥è½¬æˆurlçš„ svg-sprite-loaderhttps://www.npmjs.com/package/svg-sprite-loader#why-its-cool svg-sprite-loader å°†åŠ è½½çš„ svg å›¾ç‰‡æ‹¼æ¥æˆ é›ªç¢§å›¾ï¼Œæ”¾åˆ°é¡µé¢ä¸­ï¼Œå…¶å®ƒåœ°æ–¹é€šè¿‡ å¤ç”¨ ä¸€èˆ¬ç”¨åœ¨èœå•çš„Iconæ˜¾ç¤ºä»¥åŠæ­å»ºä¸€äº›UIçš„å­—ä½“åº“çš„æ—¶å€™éœ€è¦ç”¨çš„åˆ° raw-loaderhttps://www.npmjs.com/package/raw-loader å¯ä»¥å°†æ–‡æœ¬æ–‡ä»¶çš„å†…å®¹è¯»å–å‡ºæ¥æ³¨å…¥jsæˆ–è€…cssä¸­ Source Mapsource-map-loaderhttps://www.npmjs.com/package/source-map-loader ä½¿ç”¨è¿™ä¸ªloaderå»åŠ è½½åˆ«çš„åŒ…çš„sourcemapæ–¹ä¾¿è‡ªå·±çš„è°ƒè¯• ä»£ç æ£€æŸ¥","tags":["webpack","webpack-loader"],"categories":["webpack-loader"]},{"title":"webpackè®°å½•","path":"/2021/08/05/webpackè®°å½•/","content":"å‰ç½®åŒ…webpack-clihttps://github.com/webpack/webpack-cli/issues webpack-dev-serverå°† webpack ä¸æä¾›å®æ—¶é‡æ–°åŠ è½½çš„å¼€å‘æœåŠ¡å™¨ä¸€èµ·ä½¿ç”¨ã€‚è¿™åº”è¯¥ä»…ç”¨äºå¼€å‘ã€‚å®ƒåœ¨åº•å±‚ä½¿ç”¨ webpack-dev-middlewareï¼Œå®ƒæä¾›å¯¹ webpack èµ„äº§çš„å¿«é€Ÿå†…å­˜è®¿é—®ã€‚ source map é…ç½®è¯¦æƒ… ä¼˜åŒ–æ‰‹æ®µoutputæµè§ˆå™¨ç¼“å­˜ï¼Œå°±æ˜¯è¿›å…¥æŸä¸ªç½‘ç«™åï¼ŒåŠ è½½çš„é™æ€èµ„æºè¢«æµè§ˆå™¨ç¼“å­˜ï¼Œå†æ¬¡è¿›å…¥è¯¥ç½‘ç«™åï¼Œå°†ç›´æ¥æ‹‰å–ç¼“å­˜èµ„æºï¼ŒåŠ å¿«åŠ è½½é€Ÿåº¦ã€‚ webpack æ”¯æŒæ ¹æ®èµ„æºå†…å®¹ï¼Œåˆ›å»º hash idï¼Œå½“èµ„æºå†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°†ä¼šåˆ›å»ºæ–°çš„ hash idã€‚ é…ç½® JS bundle hashï¼Œwebpack.js é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š 12345678module.exports = &#123; // è¾“å‡º output: &#123; // ä»…åœ¨ç”Ÿäº§ç¯å¢ƒæ·»åŠ  hash filename: ctx.isEnvProduction ? &#x27;[name].[contenthash].bundle.js&#x27; : &#x27;[name].bundle.js&#x27;, &#125;,&#125; tree shaking jsçš„shakingçœ‹è¿™ä¸ª åŸç† loaderä¼˜åŒ– ä½¿ç”¨babel-loaderå¯ä»¥å¼€å¯ç¼“å­˜ï¼Œåœ¨ç¬¬2æ¬¡ç¼–è¯‘æ—¶ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œä¸ç”¨é‡æ–°ç¼–è¯‘ï¼Œç¼“å­˜ä¸€èˆ¬åªé€‚ç”¨äºå¼€å‘ç¯å¢ƒ ä½¿ç”¨includeæˆ–excludeé€‚å½“ç¼©å°loaderçš„é€‚ç”¨èŒƒå›´ï¼Œè®©å…¶æ›´å¿«æ‰¾åˆ°è¦è§£æçš„æ–‡ä»¶ï¼Œå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš†é€‚ç”¨ 12345678910module: &#123; rules: [ &#123; test: /\\.(js|jsx|ts|tsx)$/i, use: [&#x27;babel-loader?cacheDirectory&#x27;], exclude: /node_modules/, include: /src/, &#125;, ]&#125; å‹ç¼© css æ–‡ä»¶ä½¿ç”¨css-minimizer-webpack-plugin 123456789101112const CssMinimizerPlugin = require(&quot;css-minimizer-webpack-plugin&quot;);module.exports = &#123; optimization: &#123; minimizer: [ new CssMinimizerPlugin(&#123; parallel: 4, &#125;), ], &#125;&#125; è¾“å‡ºç»“æœä¸æºå¸¦è·¯å¾„ä¿¡æ¯é»˜è®¤ webpack ä¼šåœ¨è¾“å‡ºçš„ bundle ä¸­ç”Ÿæˆè·¯å¾„ä¿¡æ¯ï¼Œå°†è·¯å¾„ä¿¡æ¯åˆ é™¤å¯å°å¹…æå‡æ„å»ºé€Ÿåº¦ã€‚ 123456module.exports = &#123; output: &#123; pathinfo: false, &#125;, &#125;;&#125; Reactçš„ä¼˜åŒ– å¯ä»¥ä½¿ç”¨ react-refresh-webpack-plugin è¿™ä¸ªpluginæ¥å®ç°reactç»„ä»¶çš„çƒ­æ›´æ–° ä¼˜åŒ– resolve é…ç½®1. aliasalias å¯ä»¥åˆ›å»º import æˆ– require çš„åˆ«åï¼Œç”¨æ¥ç®€åŒ–æ¨¡å—å¼•å…¥ã€‚ 2. extensionsæ ¹æ®é¡¹ç›®ä¸­çš„æ–‡ä»¶ç±»å‹ï¼Œå®šä¹‰ extensionsï¼Œä»¥è¦†ç›– webpack é»˜è®¤çš„ extensionsï¼ŒåŠ å¿«è§£æé€Ÿåº¦ã€‚ ç”±äº webpack çš„è§£æé¡ºåºæ˜¯ä»å·¦åˆ°å³ï¼Œå› æ­¤è¦å°†ä½¿ç”¨é¢‘ç‡é«˜çš„æ–‡ä»¶ç±»å‹æ”¾åœ¨å·¦ä¾§ï¼Œå¦‚ä¸‹æˆ‘å°† tsx æ”¾åœ¨æœ€å·¦ä¾§ã€‚ webpack.common.js é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š 12345module.exports = &#123; resolve: &#123; extensions: [&#x27;.tsx&#x27;, &#x27;.js&#x27;], // å› ä¸ºæˆ‘çš„é¡¹ç›®åªæœ‰è¿™ä¸¤ç§ç±»å‹çš„æ–‡ä»¶ï¼Œå¦‚æœæœ‰å…¶ä»–ç±»å‹ï¼Œéœ€è¦æ·»åŠ è¿›å»ã€‚ &#125;&#125; 3. modulesmodules è¡¨ç¤º webpack è§£ææ¨¡å—æ—¶éœ€è¦è§£æçš„ç›®å½•ã€‚ æŒ‡å®šç›®å½•å¯ç¼©å° webpack è§£æèŒƒå›´ï¼ŒåŠ å¿«æ„å»ºé€Ÿåº¦ã€‚ webpack.common.js é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š 123456module.exports = &#123; modules: [ &#x27;node_modules&#x27;, paths.appSrc, ]&#125; 4. symlinkså¦‚æœé¡¹ç›®ä¸ä½¿ç”¨ symlinksï¼ˆä¾‹å¦‚ npm link æˆ–è€… yarn linkï¼‰ï¼Œå¯ä»¥è®¾ç½® resolve.symlinks: falseï¼Œå‡å°‘è§£æå·¥ä½œé‡ã€‚ webpack.common.js é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š 12345module.exports = &#123; resolve: &#123; symlinks: false, &#125;,&#125; ç¼“å­˜ webpack5ä¹‹å‰ åˆ©ç”¨ cache-loader å°†ç»“æœç¼“å­˜ä¸­ç£ç›˜ä¸­ï¼›åˆ©ç”¨ hard-source-webpack-plugin å°†ç»“æœç¼“å­˜åœ¨ node_modules/.cache ä¸‹æå‡äºŒæ¬¡æ‰“åŒ…é€Ÿåº¦ï¼›åˆ©ç”¨ DllReferencePlugin å°†å˜åŒ–ä¸é¢‘ç¹çš„ç¬¬ä¸‰æ–¹åº“æå‰å•ç‹¬æ‰“åŒ…æˆåŠ¨æ€é“¾æ¥åº“ï¼Œæå‡çœŸæ­£ä¸šåŠ¡ä»£ç çš„æ‰“åŒ…é€Ÿåº¦ ç„¶è€Œã€‚ã€‚webpack5è‡ªå¸¦äº†é…ç½®é¡¹ å¼€å‘ç¯å¢ƒ webpack.dev.js 1234cache: &#123; type: &#x27;memory&#x27;&#125;,å¤åˆ¶ä»£ç  ç”Ÿäº§ç¯å¢ƒ webpack.pro.js 123456cache: &#123; type: &#x27;filesystem&#x27;, buildDependencies: &#123; config: [__filename] &#125;&#125;, æ‰“åŒ…æ—¶æ¸…é™¤ä¸Šæ¬¡æ„å»ºäº§ç‰©æ‰“åŒ…ç›®å½•ä¸‹é¢å¯èƒ½ä¼šå­˜åœ¨å¤§é‡ä¸Šæ¬¡æ‰“åŒ…ç•™ä¸‹æ¥çš„äº§ç‰©ï¼Œæ—¶é—´é•¿äº†å°±ä¼šæœ‰å¾ˆå¤šæ— ç”¨çš„ä»£ç  webpack5.20ä¹‹å‰è¿™é‡Œæ¨èä½¿ç”¨CleanWebpackPlugin ä¹‹åå°±å¯ä»¥ç”¨output.cleanä¸ºtrueæ¸…é™¤ jsä»£ç å‹ç¼©webpack5ä¹‹å‰æˆ‘ä»¬æ˜¯éœ€è¦terser-webpack-pluginè¿™ä¸ªåŒ…çš„å¹¶ä¸”éœ€è¦ä»¥ä¸‹é…ç½® 12345678910111213141516const TerserPlugin = require(&#x27;terser-webpack-plugin&#x27;)module.exports = &#123; // ...other configoptimization: &#123; minimize: !isDev, minimizer: [ new TerserPlugin(&#123; extractComments: false, terserOptions: &#123; compress: &#123; pure_funcs: [&#x27;console.log&#x27;] &#125; &#125; &#125;) ] &#125; ä½†æ˜¯webpack5è‡ªå¸¦äº†ä»£ç å‹ç¼© 12345678// webpack.config.jsä¸­module.exports = &#123; optimization: &#123; usedExports: true, //åªå¯¼å‡ºè¢«ä½¿ç”¨çš„æ¨¡å— minimize : true // å¯åŠ¨å‹ç¼© &#125;&#125; å½“ç„¶ä½ å¦‚æœéœ€è¦è‡ªå®šä¹‰çš„è¯ä¹Ÿå¯ä»¥å®‰è£…è¿™ä¸ªæ’ä»¶ï¼Œç„¶åè‡ªå®šä¹‰é…ç½® 123456789101112131415161718192021222324252627282930const TerserPlugin = require(&#x27;terser-webpack-plugin&#x27;);module.exports = &#123; optimization: &#123; minimizer: [ new TerserPlugin(&#123; parallel: 4, terserOptions: &#123; parse: &#123; ecma: 8, &#125;, compress: &#123; ecma: 5, warnings: false, comparisons: false, inline: 2, &#125;, mangle: &#123; safari10: true, &#125;, output: &#123; ecma: 5, comments: false, ascii_only: true, &#125;, &#125;, &#125;), ] &#125;&#125; åˆå¹¶æ¨¡å— æ™®é€šæ‰“åŒ…åªæ˜¯å°†ä¸€ä¸ªæ¨¡å—æœ€ç»ˆæ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„ç«‹å³æ‰§è¡Œå‡½æ•°ä¸­ï¼Œå¦‚æœä½ æœ‰å¾ˆå¤šæ¨¡å—ï¼Œé‚£ä¹ˆå°±æœ‰å¾ˆå¤šç«‹å³æ‰§è¡Œå‡½æ•°ã€‚concatenateModules å¯ä»¥è¦æ‰€æœ‰çš„æ¨¡å—éƒ½åˆå¹¶åˆ°ä¸€ä¸ªå‡½æ•°é‡Œé¢å»ã€‚ çƒ­æ›´æ–° è‡ªåŠ¨åˆ·æ–° æ˜¯æŒ‡åœ¨ä¿®æ”¹æ¨¡å—å†…å­˜æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åˆ·æ–°é¡µé¢æ¥æ›´æ–°è§†å›¾å†…å®¹ï¼Œæ˜¯æ•´ä¸ªé¡µé¢åˆ·æ–°ï¼Œé€Ÿåº¦è¾ƒæ…¢ï¼›åˆ·æ–°é¡µé¢è¿˜ä¼šå¯¼è‡´ä¸´æ—¶çŠ¶æ€ä¸¢å¤±ï¼ˆæ¯”å¦‚è¡¨å•å†…å®¹ï¼‰ çƒ­æ›´æ–° æ˜¯åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹ï¼Œä½¿æ–°ä»£ç ç”Ÿæ•ˆï¼Œæ•´ä¸ªç½‘é¢ä¸ä¼šåˆ·æ–°ï¼ŒçŠ¶æ€ä¹Ÿä¸ä¼šä¸¢å¤± 1234target: &#x27;web&#x27;,plugins: [\tnew webpack.HotModuleReplacementPlugin(&#123;&#125;)] noParse noParseæ˜¯ç”¨æ¥è¿‡æ»¤ä¸éœ€è¦è§£æçš„æ¨¡å—ï¼Œæ¯”å¦‚jquery,lodashä¹‹ç±»çš„ï¼Œè¿™äº›åº“ä¸€èˆ¬ä¸ä¼šå†å¼•å…¥å…¶å®ƒåº“ï¼Œæ‰€ä»¥ä¸éœ€è¦webpackå»è§£æå…¶ä¾èµ–ï¼Œä¹Ÿä¸ç”¨æ‰“åŒ…ï¼Œåªæ˜¯ç›´æ¥å¼•ç”¨å³å¯ 123module: &#123; noParse: /jquery|lodash/,&#125; å¤šçº¿ç¨‹æ‰“åŒ…thread-loader å°†è€—æ—¶çš„ loader æ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ worker æ± ä¸­è¿è¡Œï¼ŒåŠ å¿« loader æ„å»ºé€Ÿåº¦ã€‚ webpack å®˜ç½‘ æåˆ° node-sass ä¸­æœ‰ä¸ªæ¥è‡ª Node.js çº¿ç¨‹æ± çš„é˜»å¡çº¿ç¨‹çš„ bugã€‚ å½“ä½¿ç”¨ thread-loader æ—¶ï¼Œéœ€è¦è®¾ç½® workerParallelJobs: 2ã€‚ ç”±äº thread-loader å¼•å…¥åï¼Œéœ€è¦ 0.6s å·¦å³çš„æ—¶é—´å¼€å¯æ–°çš„ node è¿›ç¨‹ï¼Œå¦‚æœé¡¹ç›®ä»£ç é‡å°ï¼Œå¼•å…¥ thread-loaderå°±æ²¡ä»€ä¹ˆå¿…è¦äº† æˆ‘ä»¬åº”è¯¥ä»…åœ¨éå¸¸è€—æ—¶çš„ loader å‰å¼•å…¥ thread-loaderã€‚ ä¼˜åŒ–å›¾ç‰‡ä½¿ç”¨æ‰“åŒ…å¤§å°åˆ†æå·¥å…·how to use webpack-bundle-analyzer webpack-bundle-analyzer å‡çº§webpack5é‡åˆ°çš„é—®é¢˜nodeçš„ä¸€äº›æ¨¡å—webpackä¸è‡ªå¸¦äº†","tags":["webpack"],"categories":["webpack"]},{"title":"å­¦ä¹ èµ„æ–™æ•´ç†","path":"/2021/08/04/å­¦ä¹ èµ„æ–™æ•´ç†/","content":"TypeScriptæ¥ç©TypeScriptå•Šï¼Œæœºéƒ½ç»™ä½ å¼€å¥½äº†ï¼ å®˜æ–¹æ–‡æ¡£ï¼ˆè‹±æ–‡ï¼‰ NPMè¿™ä¸ªè®²äº†å¥½å¤š Reactæ ¸å¿ƒæ–‡ç« ï¼ˆä¸€å®šè¦çœ‹å®Œï¼Œå¡é¢‚å¤§ä½¬çš„ï¼‰ æºç è®²è§£ gitä¸Šçš„ä¸€ä¸ªreactè®²è§£æŒºä¸é”™çš„ reactæºç  æ‰€æœ‰apiè§£è¯» react hooksç”¨æ³• Youtubeä¸Šçš„è§†é¢‘è®²è§£ ä¸€ä¸ªå›½å¤–å¤§ä½¬çš„reactçŸ¥è¯†åº“ å‰ç«¯æ ¸å¿ƒçŸ¥è¯†å‰ç«¯è¿›é˜¶ç§¯ç´¯ å‰ç«¯åˆ°æœåŠ¡å·¥ç¨‹è¯¦ç»† å±±æœˆè¡Œ è§„èŒƒhuskyhuskyä½¿ç”¨æ€»ç»“ conversion-log æ•´åˆcommitlint + conversion-log ç¬¬äºŒç¯‡ angularé…åˆ äº‘åŸç”Ÿhttps://fuckcloudnative.io/","tags":["å­¦ä¹ èµ„æ–™"],"categories":["Typescript"]},{"title":"useRefèƒ½åšå•¥ï¼Ÿ","path":"/2021/08/03/useRefèƒ½åšå•¥ï¼Ÿ/","content":"useRefuseRefä¸»è¦çš„åŠŸèƒ½å°±æ˜¯ã€‚ å¸®åŠ©æˆ‘ä»¬è·å–åˆ°DOMå…ƒç´ æˆ–è€…ç»„ä»¶å®ä¾‹ ä¿å­˜åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šå˜åŒ–çš„å€¼ å¦‚ä¸‹ï¼š 1234567891011121314function TextInputWithFocusButton() &#123; const inputEl = useRef(null); const onButtonClick = () =&gt; &#123; // `current` æŒ‡å‘å·²æŒ‚è½½åˆ° DOM ä¸Šçš„æ–‡æœ¬è¾“å…¥å…ƒç´  inputEl.current.focus(); &#125;; return ( &lt;&gt; &lt;input ref=&#123;inputEl&#125; type=&quot;text&quot; /&gt; &lt;button onClick=&#123;onButtonClick&#125;&gt;Focus the input&lt;/button&gt; &lt;/&gt; );&#125; è¿™ä¸ªåˆ›å»ºrefçš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ ç»„ä»¶åˆå§‹åŒ–ï¼Œæ‰§è¡Œåˆ°useRefï¼Œåˆå§‹åŒ–äº†ä¸€ä¸ªå‚æ•°null è¿™æ—¶å€™è§¦å‘renderäº†ï¼Œè¿™ä¸ªè¿‡ç¨‹å®ç°äº†ä¸€ä¸ªrefçš„æŒ‚è½½ï¼Œä»nullåˆ°ç›¸å¯¹åº”çš„ç»„ä»¶å®ä¾‹æˆ–è€…DOMæŒ‚è½½ï¼Œç›¸å½“äºå¯¹ref.currentçš„èµ‹å€¼äº†ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šæœ‰ä¸€ä¸ªrefçš„æ•°æ®å˜åŒ– ä¸¤ä¸ªç‰¹ç‚¹ æ¯æ¬¡ç»„ä»¶é‡æ–°æ¸²æŸ“useRefçš„è¿”å›å€¼éƒ½æ˜¯åŒä¸€ä¸ªï¼ˆå¼•ç”¨ä¸å˜ï¼‰ ref.currentå‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œä¸ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼ŒåŒºåˆ«äºå…¶ä»–çš„hooks å› æ­¤å¼•å‡ºä¸¤ä¸ªåœºæ™¯ 1.ä¸è¦å•ç‹¬æ‹¿refä½œä¸ºä¾èµ–é¡¹1234567useEffect(()=&gt;&#123; ....&#125;,[ref]);useEffect(()=&gt;&#123; ... &#125;, []); ä¸Šé¢ä¸¤è€…ç›¸å½“äºæ˜¯ä¸€æ ·çš„äº†ï¼Œå› ä¸ºrefå§‹ç»ˆæ˜¯åŒä¸€ä¸ªå¼•ç”¨ã€‚ 2.æ‰‹åŠ¨è°ƒç”¨è‡ªå·±çš„refæŒ‚è½½å‡½æ•°è¿™é‡Œæˆ‘ä»¬éœ€è¦é€šè¿‡callback refçš„å½¢å¼å»æŒ‚è½½ 1234567891011121314151617function MeasureExample() &#123; const [height, setHeight] = useState(0); const measuredRef = useCallback(node =&gt; &#123; if (node !== null) &#123; setHeight(node.getBoundingClientRect().height); &#125; &#125;, []); return ( &lt;&gt; &lt;h1 ref=&#123;measuredRef&#125;&gt;Hello, world&lt;/h1&gt; &lt;h2&gt;The above header is &#123;Math.round(height)&#125;px tall&lt;/h2&gt; &lt;/&gt; );&#125; æ³¨æ„ï¼šè¿™é‡Œçš„refæŒ‚è½½é’ˆå¯¹çš„æ˜¯DOMå…ƒç´ ï¼Œå¦‚æœæ˜¯è¦æ‹¿ç»„ä»¶çš„refï¼Œåˆ™å¾€ä¸‹çœ‹ forwardRefæˆ‘ä»¬ç”¨forwardRefåŒ…è£¹å‡½æ•°å¼ç»„ä»¶ï¼Œè§ä¸‹ä¾‹ 1234567891011121314151617const Parent = () =&gt; &#123; const childRef = useRef(null); useEffect(() =&gt; &#123; ref.current.focus(); &#125;, []); return ( &lt;&gt; &lt;Child ref=&#123;ref&#125; /&gt; &lt;/&gt; );&#125;;const Child = forwardRef((props, ref) =&gt; &#123; return &lt;input type=&quot;text&quot; name=&quot;child&quot; ref=&#123;ref&#125; /&gt;;&#125;); ä½¿ç”¨forwardRefåŒ…è£¹ä¹‹åï¼Œå‡½æ•°å¼ç»„ä»¶ä¼šè·å¾—è¢«åˆ†é…ç»™è‡ªå·±çš„refï¼ˆä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼‰ã€‚å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨forwardRefè€Œç›´æ¥å»refçš„è¯ï¼ŒReactä¼šæŠ¥é”™ã€‚ useImperativeHandleä¸Šé¢forwardRefçš„ä¾‹å­ä¸­ï¼ŒParentä¸­çš„refæ‹¿åˆ°äº†Childç»„ä»¶çš„å®Œæ•´å®ä¾‹ï¼Œå®ƒä¸ä½†å¯ä»¥ä½¿ç”¨focusæ–¹æ³•ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å…¶å®ƒæ‰€æœ‰çš„DOMæ–¹æ³•ï¼Œæ¯”å¦‚blur,styleã€‚è¿™ç§æ–¹å¼æ˜¯ä¸æ¨èçš„ï¼Œæˆ‘ä»¬éœ€è¦ä¸¥æ ¼çš„æ§åˆ¶refçš„æƒåŠ›ï¼Œæ§åˆ¶å®ƒæ‰€èƒ½è°ƒç”¨åˆ°çš„æ–¹æ³•ã€‚ æ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨useImperativeHandleæ¥é™åˆ¶æš´éœ²ç»™çˆ¶ç»„ä»¶çš„æ–¹æ³•ã€‚ 123456789101112131415161718192021222324const Parent = () =&gt; &#123; const childRef = useRef(null); useEffect(() =&gt; &#123; // è¿™é‡Œåªèƒ½è°ƒç”¨åˆ°focusæ–¹æ³• ref.current.focus(); &#125;, []); return ( &lt;&gt; &lt;Child ref=&#123;ref&#125; /&gt; &lt;/&gt; );&#125;;const Child = forwardRef((props, ref) =&gt; &#123; const inputRef = useRef(null); useImperativeHandle(ref, () =&gt; (&#123; focus: () =&gt; &#123; inputRef.current.focus(); &#125; &#125;)); return &lt;input type=&quot;text&quot; name=&quot;child&quot; ref=&#123;inputRef&#125; /&gt;;&#125;); è¿™æ ·å­ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰‹åŠ¨æ§åˆ¶éœ€è¦æš´éœ²ç»™çˆ¶ç»„ä»¶çš„æ–¹æ³•ã€‚ åº”ç”¨è·å–ä¸Šä¸€æ¬¡çš„å€¼12345678function usePrevious(value) &#123; const ref = useRef(); useEffect(() =&gt; &#123; ref.current = value; &#125;); return ref.current;&#125; è¿™ä¸ªhooksè¿”å›å‡ºæ¥çš„å€¼ï¼Œåœ¨æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œæ€»æ˜¯ä¼šæ˜¾ç¤ºä¸Šä¸€æ¬¡çš„å€¼ã€‚æˆ‘ä»¬æ¥è§£æä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„è¿è¡Œæ­¥éª¤ã€‚ å‡è®¾ä¸Šä¾‹ä¸­refçš„åˆå§‹å€¼ä¼ å…¥çš„valueæ˜¯0,æ¯æ¬¡æ•°æ®æ›´æ–°ä¼ å…¥çš„éƒ½æ˜¯é€’å¢çš„æ•°æ®ï¼Œæ¯”å¦‚1ï¼Œ2ï¼Œ3ã€‚ åˆå§‹åŒ–ï¼Œref.current = 0ï¼Œæ¸²æŸ“å‡ºæ¥ æ•°æ®å˜åŒ–ï¼Œvalueä¼ å…¥1, å› ä¸ºuseEffectä¼šåœ¨æ¸²æŸ“å®Œæ¯•ä¹‹åæ‰æ‰§è¡Œï¼Œæ‰€ä»¥è¿™æ¬¡çš„æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªä¸º1çš„valueå€¼ä¸ä¼šèµ‹å€¼ç»™ref.currentã€‚æ¸²æŸ“å‡ºæ¥çš„è¿˜æ˜¯ä¸Šä¸€ä¸ªå€¼0ï¼Œæ¸²æŸ“å®Œæ¯•äº†ï¼Œref.currentå˜ä¸º1ã€‚ä½†æ˜¯ref.currentå˜åŒ–ä¸ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œæ‰€ä»¥éœ€è¦ç­‰åˆ°ä¸‹æ¬¡çš„æ¸²æŸ“æ‰èƒ½æ˜¾ç¤ºåˆ°é¡µé¢ä¸Šã€‚ å¦‚æ­¤å¾€å¤ï¼Œæ¸²æŸ“çš„å°±æ€»æ˜¯ä¸Šä¸€æ¬¡çš„å€¼ã€‚ ä½¿ç”¨useRefæ¥ä¿å­˜ä¸éœ€è¦å˜åŒ–çš„å€¼ å› ä¸ºuseRefçš„è¿”å›å€¼åœ¨ç»„ä»¶çš„æ¯æ¬¡rednerä¹‹åéƒ½æ˜¯åŒä¸€ä¸ªï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç”¨æ¥ä¿å­˜ä¸€äº›åœ¨ç»„ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸéƒ½ä¸éœ€è¦å˜åŒ–çš„å€¼ã€‚æœ€å¸¸è§çš„å°±æ˜¯å®šæ—¶å™¨çš„æ¸…é™¤åœºæ™¯ã€‚ åˆšå¼€å§‹åœ¨Reacté‡Œå†™å®šæ—¶å™¨ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·å†™ 12345678910111213141516171819const App = () =&gt; &#123; let timer; useEffect(() =&gt; &#123; timer = setInterval(() =&gt; &#123; console.log(&#x27;è§¦å‘äº†&#x27;); &#125;, 1000); &#125;,[]); const clearTimer = () =&gt; &#123; clearInterval(timer); &#125; return ( &lt;&gt; &lt;Button onClick=&#123;clearTimer&#125;&gt;åœæ­¢&lt;/Button&gt; &lt;/&gt;)&#125; ä½†æ˜¯ä¸Šé¢è¿™ä¸ªå†™æ³•æœ‰ä¸ªå·¨å¤§çš„é—®é¢˜ï¼Œå¦‚æœè¿™ä¸ªAppç»„ä»¶é‡Œæœ‰stateå˜åŒ–æˆ–è€…ä»–çš„çˆ¶ç»„ä»¶é‡æ–°renderç­‰åŸå› å¯¼è‡´è¿™ä¸ªAppç»„ä»¶é‡æ–°renderçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œç‚¹å‡»æŒ‰é’®åœæ­¢ï¼Œå®šæ—¶å™¨ä¾ç„¶ä¼šä¸æ–­çš„åœ¨æ§åˆ¶å°æ‰“å°ï¼Œå®šæ—¶å™¨æ¸…é™¤äº‹ä»¶æ— æ•ˆäº†ã€‚ ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºç»„ä»¶é‡æ–°æ¸²æŸ“ä¹‹åï¼Œè¿™é‡Œçš„timerä»¥åŠclearTimeræ–¹æ³•éƒ½ä¼šé‡æ–°åˆ›å»ºï¼Œtimerå·²ç»ä¸æ˜¯å®šæ—¶å™¨çš„å˜é‡äº†ã€‚ æ‰€ä»¥å¯¹äºå®šæ—¶å™¨ï¼Œæˆ‘ä»¬éƒ½ä¼šä½¿ç”¨useRefæ¥å®šä¹‰å˜é‡ã€‚ 12345678910111213141516171819const App = () =&gt; &#123; const timer = useRef(); useEffect(() =&gt; &#123; timer.current = setInterval(() =&gt; &#123; console.log(&#x27;è§¦å‘äº†&#x27;); &#125;, 1000); &#125;,[]); const clearTimer = () =&gt; &#123; clearInterval(timer.current); &#125; return ( &lt;&gt; &lt;Button onClick=&#123;clearTimer&#125;&gt;åœæ­¢&lt;/Button&gt; &lt;/&gt;)&#125; å®ç°æ·±åº¦æ¯”è¾ƒuseEffectæ™®é€šçš„useEffectåªæ˜¯ä¸€ä¸ªæµ…æ¯”è¾ƒçš„æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬ä¾èµ–çš„stateæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œè¿™ä¸ªstateå¯¹è±¡çš„å€¼æ²¡å˜ï¼Œä½†æ˜¯å†…å­˜å¼•ç”¨åœ°å€å˜åŒ–äº†ï¼Œä¸€æ ·ä¼šè§¦å‘useEffectçš„é‡æ–°æ¸²æŸ“ã€‚ 1234567const createObj = () =&gt; (&#123; name: &#x27;zouwowo&#x27;&#125;);useEffect(() =&gt; &#123; // è¿™ä¸ªæ–¹æ³•ä¼šæ— é™å¾ªç¯&#125;, [createObj()]); æˆ‘ä»¬æ¥ä½¿ç”¨useRefå®ç°ä¸€ä¸ªæ·±åº¦ä¾èµ–å¯¹æ¯”çš„useDeepEffect 123456789101112import equal from &#x27;fast-deep-equal&#x27;;export useDeepEffect = (callback, deps) =&gt; &#123; const emitEffect = useRef(0); const prevDeps = useRef(deps); if (!equal(prevDeps.current, deps)) &#123; // å½“æ·±æ¯”è¾ƒä¸ç›¸ç­‰çš„æ—¶å€™ï¼Œä¿®æ”¹emitEffect.currentçš„å€¼ï¼Œè§¦å‘ä¸‹é¢çš„useEffectæ›´æ–° emitEffect.current++; &#125; prevDeps.current = deps; return useEffect(callback, [emitEffect.current]);&#125;","tags":["React"],"categories":["useRef","forwardRef","useImperativeHandle","hooks"]},{"title":"åœ¨çº¿ç¼–è¾‘ç½‘ç«™","path":"/2021/08/01/åœ¨çº¿ç¼–è¾‘ç½‘ç«™/","content":"babelè½¬æ¢jsï¼Œreact tsè½¬js","tags":["ç½‘ç«™æ”¶è—"],"categories":["Javascript","Typescript","Babel"]},{"title":"21å¹´7æœˆ17é¢è¯•","path":"/2021/07/17/21å¹´7æœˆ17é¢è¯•/","content":"å¾®åŒ»é›†å›¢é¢è¯•ï¼ˆ1é¢ï¼‰ï¼ˆå°†è¿‘ä¸€å°æ—¶ï¼‰ä»‹ç»ä¸‹è‡ªå·±ä»‹ç»ä¸€ä¸‹ä½ çš„é¡¹ç›®è¿™é‡Œæˆ‘ä»¬ç›®å‰çš„é¡¹ç›®æ˜¯çŒªé½¿é±¼devopsé›†æˆå¹³å°ï¼Œæ‰€ä»¥ä»–é—®çš„å¾ˆæ·±ï¼ŒåŒ…æ‹¬æµæ°´çº¿ï¼Œéƒ¨ç½²ç­‰ç­‰çš„ä¸œè¥¿ï¼Œè¿™å—é›†æˆçš„æµç¨‹æ˜¯ä»€ä¹ˆ jsåŸºç¡€1. var,let,const ä»€ä¹ˆåŒºåˆ«è€ç”Ÿå¸¸è°ˆï¼Œå°±æ²¡å•¥å¥½è¯´çš„äº† 2. jsä¸­å­˜åœ¨åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹ï¼Œä½ èƒ½è¯´è¯´ä»–ä»¬çš„åŒºåˆ«å—ï¼Ÿè¿™é‡Œæˆ‘æåˆ°äº†å­˜å‚¨æ–¹å¼çš„ä¸åŒï¼Œä¸€ä¸ªæ˜¯åœ¨æ ˆä¸­å­˜å‚¨ï¼Œä¸€ä¸ªæ˜¯åœ¨å †ä¸­å­˜å‚¨ ç®—æ³•ä¼˜åŒ–1. ä½ åœ¨é¡¹ç›®ä¸­æœ‰ç”¨åˆ°å¹³æ—¶åˆ·çš„ç®—æ³•å»ä¼˜åŒ–ä»£ç å—ï¼Ÿç»™ä»–åˆ—äº†ä¸ªä¾‹å­ï¼Œä»æ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆæ¥è¯´ï¼ˆç©ºé—´å¤æ‚åº¦å’Œæ—¶é—´å¤æ‚åº¦ï¼‰ æ•°æ®ç»“æ„ä¸Šé¢ç¬¬äºŒç‚¹è¢«ä»–å¥—è¯äº†ï¼Œâ€œæ‚¨åˆšåˆšæåˆ°äº†å †å’Œæ ˆï¼Œé‚£ä½ æå †å’Œæ ˆè¿˜èƒ½æƒ³èµ·ä»€ä¹ˆå—ï¼Ÿâ€ è®¡ç®—æœºæ•°æ®ç»“æ„æœ‰å“ªäº›â€¦ é™¤äº†è®¡ç®—æœºæ•°æ®ç»“æ„æèµ·å †å’Œæ ˆä½ è¿˜èƒ½æƒ³åˆ°ä»€ä¹ˆå—ï¼Ÿ ä¸æ™“å¾—åº”è¯¥è¯´ä»€ä¹ˆäº†ï¼Œæˆ‘ç»™ä»–æäº†ä¸€ä¸‹æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ æµè§ˆå™¨ç½‘ç»œç›¸å…³httpçš„ç¼“å­˜ç­–ç•¥å¼ºç¼“å­˜ + åå•†ç¼“å­˜ ï¼Œä»€ä¹ˆæ—¶å€™è¿›è¡Œå¼ºç¼“å­˜ä»€ä¹ˆæ—¶å€™è¿›è¡Œåå•† å¼ºç¼“å­˜æ˜¯é€šè¿‡ä»€ä¹ˆæ ‡è¯†æ¥è¿›è¡Œçš„ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä¸å¼€å¯ç¼“å­˜ï¼ˆä»€ä¹ˆå­—æ®µæ ‡è¯†ï¼‰åå•†ç¼“å­˜é€šè¿‡ä»€ä¹ˆæ ‡è¯†æ¥è¿›è¡Œï¼ˆ304ï¼‰æµè§ˆå™¨å­˜å‚¨ï¼ˆlocalstorage, session, cookieï¼‰åŒºåˆ«jså¼•æ“è¯´ä¸€è¯´åƒåœ¾å›æ”¶æœºåˆ¶ï¼ŒIEå’Œè°·æ­Œçš„åƒåœ¾å›æ”¶æœºåˆ¶æœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿè¯´ä¸€è¯´äº‹ä»¶å¾ªç¯æœºåˆ¶ä½ èƒ½è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆjsçš„å•çº¿ç¨‹çš„å—æ¶‚é¸¦æ™ºèƒ½é¢è¯•ï¼ˆ1é¢ï¼‰ï¼ˆé¢äº†30åˆ†é’Ÿï¼‰ç®€å•ä»‹ç»ä¸€äº›ä½ å’Œä½ çš„é¡¹ç›®è¿™é‡Œä½ æåˆ°äº†react hooksï¼Œä½ å¹³æ—¶è‡ªå·±æœ‰å°è£…è¿‡å—ä½ è¿™é‡Œé¡¹ç›®æ‰€è¯´åˆ°äº†ä¸€ä¸ªå«axiosçš„èŠ‚æµç¼“å­˜æ–¹æ¡ˆï¼Œä½ èƒ½è¯¦ç»†æè¿°ä¸€ä¸‹å—ä½ é¡¹ç›®ä¸Šå¸¸ç”¨çš„react hooksæœ‰å“ªäº›å‘¢ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹ä½ èƒ½è¯´è¯´å—æ§ç»„ä»¶å’Œéå—æ§ç»„ä»¶çš„åŒºåˆ«å—ES6ä¸­æœ‰é‚£äº›ç‰¹æ€§ä½ ç»å¸¸ç”¨åˆ°å‘¢ä½ èƒ½è®²ä¸€ä¸‹Promiseå—ï¼ŸPromiseä¸­çš„æ„é€ å‡½æ•°æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„ï¼Ÿä»€ä¹ˆæ˜¯å›è°ƒåœ°ç‹±ä½ èƒ½è¯´è¯´å—ï¼Ÿ","tags":["Javascript","http","å †å’Œæ ˆ","ES6","Promise","é¢è¯•é¢˜"],"categories":["é¢è¯•ç»å†"]},{"title":"jså¸¸è§é¢è¯•é¢˜","path":"/2021/07/01/jså¸¸è§é¢è¯•é¢˜/","content":"æ‰‹å†™ç¯‡1. æ‰‹å†™new 2. æ‰‹å†™call, apply 3. æ‰‹å†™instanceof 4. æ‰‹å†™bind 5. æ‰‹å†™promise 6. æ·±æ‹·è´æµ…æ‹·è´ 7.é˜²æŠ–èŠ‚æµ æ•°æ®ç±»å‹ jsæœ‰å“ªäº›æ•°æ®ç±»å‹ jsæœ‰å“ªäº›å†…ç½®å¯¹è±¡ æ•°æ®ç±»å‹çš„æ£€æµ‹æ–¹å¼ï¼ˆtypeof, intanceof, Object.prototype.toStringä¸‰è€…åŒºåˆ†ï¼‰ nullï¼Œ undefinedåŒºåˆ« 0.1+0.2 !== 0.3 ä¸ºä»€ä¹ˆï¼Œå¦‚æœä½¿å…¶ç›¸ç­‰ == æ“ä½œç¬¦å¼ºåˆ¶ç±»å‹è½¬æ¢è§„åˆ™ ä»€ä¹ˆæ˜¯jsçš„åŒ…è£…ç±»å‹ biginit ç±»å‹è½¬æ¢ç±»å‹è½¬æ¢ ES6 ç®­å¤´å‡½æ•°å’Œæ™®é€šå‡½æ•°åŒºåˆ« Proxyä½¿ç”¨åœºæ™¯ å¼‚æ­¥å®ä»»åŠ¡å¾®ä»»åŠ¡ EvenLoop åŸå‹ï¼ŒåŸå‹é“¾ï¼Œç»§æ‰¿ å¯¹åŸå‹ï¼ŒåŸå‹é“¾çš„ç†è§£ ES5å®ç°ç»§æ‰¿çš„å‡ ç§æ–¹æ³•ï¼ˆåŸå‹é“¾ï¼Œç›—ç”¨æ„é€ å‡½æ•°ï¼Œç»„åˆç»§æ‰¿ï¼ŒåŸå‹å¼ç»§æ‰¿ï¼Œå¯„ç”Ÿå¼ç»§æ‰¿ï¼Œç»„åˆå¯„ç”Ÿå¼ç»§æ‰¿ï¼‰ ç»§æ‰¿ æ¨¡å— ä½œç”¨åŸŸï¼Œä½œç”¨åŸŸé“¾ï¼ŒthisæŒ‡å‘ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œé—­åŒ…æ‰§è¡Œä¸Šä¸‹æ–‡å’Œæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ ä½œç”¨åŸŸé“¾ é™æ€ä½œç”¨åŸŸ é—­åŒ…","tags":["Javascript","é¢è¯•é¢˜"],"categories":["Javascript"]},{"title":"åŸºäºçŒªé½¿é±¼å¹³å°çš„axiosç¼“å­˜å°è£…","path":"/2021/06/24/åŸºäºçŒªé½¿é±¼å¹³å°çš„axiosç¼“å­˜å°è£…/","content":"éœ€æ±‚è¯´æ˜æƒ…å†µ1ï¼šçŒªé½¿é±¼å¹³å°æ˜¯ä¸ªç›¸å¯¹å¤æ‚çš„å¤šè¡¨æ ¼å¤šè¡¨å•æ•°æ®å¤„ç†å¹³å°ï¼Œæœ‰äº›æ¨¡å—çš„æ•°æ®é‡åºå¤§ï¼Œå¹¶ä¸”æœ‰äº›å–œæ¬¢åµŒå…¥åœ¨tabé¡µé¢å½“ä¸­ï¼Œå¦‚æœé¢‘ç¹çš„å»è®¿é—®è¿™äº›é¡µé¢å°±ä¼šé¢‘ç¹çš„è¯·æ±‚ï¼Œå¦‚æœæ•°æ®é‡åºå¤§ï¼Œæ¯æ¬¡è®¿é—®éƒ½ä¼šå»è¯·æ±‚æ•°æ®ï¼Œç­‰å¾…æ—¶é—´å°±å˜é•¿äº†ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªç•Œé¢ï¼š è¿™ä¸ªé¡µé¢ç›¸å½“äºæ˜¯å†å²çš„æ‰§è¡Œè®°å½•ï¼Œå› ä¸ºæ•°æ®é‡åºå¤§ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¡µé¢è¯·æ±‚è¿‡åå“åº”é€Ÿåº¦è¾ƒæ…¢ï¼Œå‡è®¾æˆ‘åœ¨çŸ­æ—¶é—´å†…åˆ‡åˆ°åˆ«çš„è®°å½•åˆåˆ‡å›æ¥è¦çœ‹ï¼Œé‚£è¿˜å¾—é‡æ–°å†å»è¯·æ±‚è¿™1000å¤šæ¡çš„æ•°æ®ï¼Œè¿™ä¸ªæ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œç”¨æˆ·ç­‰å¾…æ—¶é—´å°±å˜é•¿äº† æƒ…å†µ2ï¼šåœ¨ä¸€ä¸ªé¡µé¢æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œæˆ–è€…åœ¨æŸäº›ä¸æ­£å½“çš„äº¤äº’æ“ä½œä¸­ï¼Œç”¨æˆ·å¯èƒ½é¢‘ç¹çš„å‘åå°å»å‘é€åŒä¸€ä¸ªè¯·æ±‚ï¼ˆå‚æ•°urlç­‰å¾…éƒ½ä¸€æ ·ï¼‰ï¼Œæˆ–åˆæ˜¯å†æ¸²æŸ“é¡µé¢çš„ä¸€ç¬é—´è§¦å‘äº†å¤šæ¬¡åŒä¸€è¯·æ±‚ï¼Œè¿™æ ·å°±å¾ˆæµªè´¹å¸¦å®½ï¼Œå¤šæ¬¡è¯·æ±‚å‰ç«¯è¿˜éœ€è¦è¿›è¡Œå¤šæ¬¡çš„å“åº”å¤„ç†ï¼Œä¾‹å¦‚ä»¥ä¸‹æƒ…å†µ åœ¨æ¸²æŸ“é¡µé¢æ—¶ï¼ŒåŒæ—¶å‘é€äº†å¤šä¸ªç›¸åŒè¯·æ±‚ï¼Œå¤§å¤šæ—¶å€™æ˜¯é¡µé¢é€»è¾‘å¤„ç†çš„æœ‰é—®é¢˜ï¼Œå¤šæ¬¡å‘åå°è·å–æ•°æ®äº†ï¼Œæˆ–è€…æ˜¯æˆ‘é¢‘ç¹çš„å»ç‚¹å‡»ä¸€ä¸ªæ²¡æœ‰åšé˜²æŠ–çš„æŒ‰é’®æˆ–è€…æ²¡æœ‰èŠ‚æµçš„ä¸€äº›é¢‘ç¹è¯·æ±‚ æƒ…å†µ3ï¼šå‡è®¾æˆ‘é”™è¯¯çš„ç‚¹å‡»äº†ä¸€ä¸ªèœå•çš„åŒæ—¶åˆå»åˆ‡åˆ°äº†å¦å¤–ä¸€ä¸ªèœå•ï¼Œè¿™æ—¶å€™è™½ç„¶è¯´å·²ç»åˆ‡æ¢åˆ°äº†æƒ³è¦çš„èœå•è·¯ç”±ä¸‹å¯¹åº”çš„ç•Œé¢ï¼Œä½†æ˜¯ç”±äºä½ é”™è¯¯çš„æ“ä½œï¼Œè™½ç„¶ä¸Šä¸ªé¡µé¢åœ¨åˆ‡è·¯ç”±ç¬é—´è¢«é”€æ¯ï¼Œä½†æ˜¯åˆå§‹åŒ–é¡µé¢çš„ä¸€äº›è·å–åå°æ•°æ®çš„è¯·æ±‚å·²ç»å‘å‡ºå»äº†ï¼Œä½ è®¿é—®çš„å½“å‰é¡µé¢æ˜¯ä¸éœ€è¦è¿™äº›è¯·æ±‚çš„ã€‚ä¾‹å¦‚ï¼š è¿™ä¸ªä¾‹å­å°±æ˜¯ï¼Œæˆ‘å…ˆç‚¹å‡»äº†ä»£ç ç®¡ç†çš„èœå•ï¼Œä»£ç ç®¡ç†æ¨¡å—ç»„ä»¶ç¬é—´è¢«åŠ è½½å‡ºæ¥ï¼Œå¹¶ä¸”å‘é€é¡µé¢è¯·æ±‚ï¼Œè¿™æ—¶å€™ä¸€ç¬é—´åˆ‡æ¢åˆ°åº”ç”¨æµæ°´çº¿çš„èœå•ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¼šçœ‹è§ï¼Œä»£ç ç®¡ç†æ¨¡å—çš„è¯·æ±‚å¾ˆå¤šæ²¡å¿…è¦çš„éƒ½å‘é€å‡ºå»äº†ï¼Œè¿™äº›è¯·æ±‚å¹¶ä¸æ˜¯æˆ‘ä»¬åº”ç”¨æµæ°´çº¿æ¨¡å—éœ€è¦ç”¨çš„åˆ°çš„ã€‚ å¦‚æœä¸Šä¸ªé¡µé¢çš„è¯·æ±‚å¾ˆæ…¢æˆ–è€…å¾ˆå¤šæƒ…å†µä¸‹ï¼Œéƒ½ä¼šå ç”¨ä¸å¿…è¦çš„èµ„æºä»¥åŠå‰ç«¯å¤„ç†æ—¶é—´ï¼Œå ç”¨èµ„æºã€‚ éœ€æ±‚åˆ†æ é’ˆå¯¹æƒ…å†µ1, æˆ‘ä»¬å¯ä»¥åšç¼“å­˜, ç±»ä¼¼äºDataSetçš„lookupï¼Œä½†åˆä¸å®Œå…¨ç±»ä¼¼ã€‚ä¹Ÿå¯ä»¥åšç±»ä¼¼tabçš„æ•°æ®ç¼“å­˜å¤„ç†ï¼Œ ä½†æ˜¯å¦‚æœé¡µé¢å¤šèµ·æ¥ï¼Œæˆ‘ä»¬å°±éœ€è¦å¤šæ¬¡åˆ†åˆ«å¯¹æ•°æ®è¿›è¡Œç¼“å­˜å¤„ç†ã€‚ é’ˆå¯¹ç¬¬äºŒç§çš„æƒ…å†µï¼Œå¯ä»¥å°†é‡å¤çš„è¯·æ±‚ç»™å–æ¶ˆæ‰ï¼Œæˆ–è€…è¯´åœ¨è¿™ä¸€ç¬é—´å‘é€çš„å¤šæ¬¡ç›¸åŒè¯·æ±‚éƒ½å…±ç”¨ç¬¬ä¸€æ¬¡å‘é€çš„é‚£ä¸ªè¯·æ±‚çš„å“åº”çŠ¶æ€ã€‚ä¸€äº›æŒ‰é’®æˆ–è€…é¢‘ç¹è¯·æ±‚çš„æ“ä½œåšèŠ‚æµå’Œé˜²æŠ–å¤„ç†ï¼Œè¿™ä¸ªå°±ä¸å†è¿™æ¬¡çš„è®¨è®ºèŒƒå›´å†…äº† ç¬¬ä¸‰ç§æƒ…å†µåœ¨åˆ‡æ¢è·¯ç”±çš„æ—¶å€™å¯ä»¥æƒ³åŠæ³•æŠŠä¸Šä¸ªé¡µé¢è¿˜åœ¨pendingä¸­çš„è¯·æ±‚ç»™å–æ¶ˆæ‰ çŒªé½¿é±¼å¹³å°ç”¨çš„æ˜¯axios + DataSetæ¥è¿›è¡Œå‰åç«¯æ•°æ®äº¤äº’ä»¥åŠè¯·æ±‚å¤„ç†çš„ï¼Œæ‰€ä»¥åŸºäºä»–ä»¬è¦å¦‚ä½•å®Œç¾å®ç°å‘¢ï¼Ÿ ç»¼ä¸Šæ‰€è¿°ï¼šæˆ‘ä»¬è¦å®ç°ä¸€ä¸ªï¼Œèƒ½å¤Ÿå®ç°å–æ¶ˆï¼Œåˆèƒ½å®ç°ç¼“å­˜çš„ï¼Œé‡ç‚¹æ˜¯å®ç°ç›¸åŒè¯·æ±‚çš„çŠ¶æ€æ•°æ®çš„å…¬ç”¨ä»¥åŠä¸å½±å“datasetçš„ä½¿ç”¨çš„ä¸œè¥¿ å¯ä»¥æƒ³åˆ°çš„æ˜¯ï¼Œæˆ‘ä»¬è‚¯å®šæ˜¯è¦å¯¹axiosçš„æ‹¦æˆªå™¨æˆ–è€…ä¸€äº›ç‰¹æ®Šå±æ€§ä¾‹å¦‚axiosçš„é€‚é…å™¨ï¼Œåšå¤„ç†ã€‚ ç¼“å­˜åˆ†æå‚è€ƒçŒªé½¿é±¼lookupçš„ç¼“å­˜åŸç†ï¼Œä»¥ä¸‹æ”¾å‡ºlookupç¼“å­˜çš„éƒ¨åˆ†æºç ï¼› lookupé€šè¿‡æ ‡è¯†ç¡®å®šæ˜¯å¦ç¼“å­˜ï¼Œä¹‹åå°†é€‚é…å™¨è¿”å›çš„æœŸçº¦ç›´æ¥ç»™ä¸€ä¸ªæ–°å¾—æœŸçº¦ï¼Œä¹‹åå­˜å‚¨è¿™ä¸ªæ–°å¾—æœŸçº¦ï¼Œåœ¨ä¸‹æ¬¡å‘é€ç›¸åŒè¯·æ±‚æ—¶å€™ç›´æ¥å°†è¿™ä¸ªæœŸçº¦æŠ›ç»™å®ƒï¼Œä»è€Œå®ç°è¯·æ±‚çš„å¤ç”¨ é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½axios çš„ adpaterçš„åŸç†ï¼š æºç æ˜¯è¿™æ ·çš„ å¯ä»¥çŸ¥é“çš„æ˜¯ï¼Œaxios çš„ transformRequestä»¥åŠä»–çš„å„ä¸ªè¯·æ±‚æ‹¦æˆªå™¨æ˜¯åœ¨returnè¿™ä¸ªæœŸçº¦ä¹‹å‰å‘ç”Ÿçš„ï¼Œä¹‹åè¯·æ±‚å®Œæˆï¼Œadapterå°†è¯·æ±‚åçš„ç»“æœä¼ é€’ç»™æœŸçº¦ï¼Œä¹‹åæœŸçº¦è½å®šï¼Œåé¢æ‰è§¦å‘å“åº”æ•°æ®è½¬æ¢ï¼ˆtransformReponseï¼‰ä»¥åŠå“åº”æ‹¦æˆªå™¨ï¼ˆè¿™ä¸ªé¡ºåºéå¸¸çš„é‡è¦ï¼‰ã€‚ æ—¢ç„¶è¦ç¼“å­˜ï¼Œä¸€å®šè¦æŠŠç¬¬ä¸€æ¬¡è½å®šçš„è¯·æ±‚æœŸçº¦ï¼Œæƒ³åŠæ³•ï¼ˆåŒ…å«äº†å“åº”ç æ•°æ®ç­‰ç­‰ç­‰ï¼‰å­˜å‚¨èµ·æ¥ï¼Œéœ€è¦ç”¨åˆ°çš„æ—¶å€™æ‰å»ä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥ç¡®å®šçš„æ˜¯æˆ‘ä»¬ç¼“å­˜éœ€è¦å¯¹adapterè¿›è¡Œæ“ä½œï¼Œå¹¶ä¸”åœ¨å“åº”å’Œè¯·æ±‚çš„æ‹¦æˆªå™¨ä¸­åšæ ‡è¯†ç­‰ç­‰æ“ä½œ å¤šæ¬¡ç›¸åŒè¯·æ±‚å¤„ç†ä¸€å¼€å§‹æˆ‘æƒ³ç”¨XMLHttpRequestçš„abortä¹Ÿå°±æ˜¯axiosçš„CancelTokenï¼ˆaxioså¯¹abortè¿›è¡Œäº†å°è£…ï¼‰å»å°†é¡µé¢æ­£åœ¨æ¸²æŸ“çš„æ—¶å€™ä¸€ä¸ªä¸ªé‡å¤çš„è¯·æ±‚cancelæ‰ï¼Œä½†æ˜¯è¿™æ ·æœ‰å¤šç§å¼Šç«¯ï¼Œç•™åˆ°æœ€åä¸€ç‚¹è®²ã€‚ å¤šæ¬¡ç›¸åŒè¯·æ±‚æ˜¯ä¸€ç¬é—´çš„äº‹æƒ…ï¼Œè¦åœ¨è¿™ä¸€ç¬é—´å¤ç”¨è¯·æ±‚å¿…é¡»ç”¨åˆ°ä¸Šé¢ç¼“å­˜æ‰€è¯´çš„å­˜å‚¨æœŸçº¦ã€‚ ä¸€ç¬é—´å’±ä»¬å°±å¯ä»¥å®šä¸€ä¸ªé»˜è®¤æ—¶é—´æˆ³ï¼Œä¾‹å¦‚1000msï¼Œè¿™ä¸ªæ—¶é—´æˆ³è¡¨ç¤ºçš„æ˜¯ï¼Œåœ¨è¿™1000msä¸­è¿›æ¥çš„è¯·æ±‚éƒ½å…±ç”¨ä¸€ä¸ªadapterçš„æœŸçº¦ï¼Œè¿™æ ·å®šä¹‰ä¸€ä¸ªé»˜è®¤æ—¶é—´æˆ³ï¼Œå°±å¯ä»¥åšåˆ°ç±»ä¼¼å–æ¶ˆé‡å¤è¯·æ±‚çš„ä½œç”¨ï¼ˆå®é™…ä¸Šæ˜¯ç”¨äº†ç¼“å­˜ï¼‰ã€‚ å½“ç„¶æ—¢ç„¶åŠ äº†ç¼“å­˜ï¼ŒåˆåŠ äº†æ—¶é—´æˆ³ï¼Œçµæ´»åº”ç”¨ä¸€ä¸‹å°±å¯ä»¥å®ç°ä¸€ä¸ªï¼Œåœ¨å¯¹åº”æ—¶é—´å†…ä¸å•å•æ˜¯1000msï¼Œæˆ‘å‘çš„ç›¸åŒè¯·æ±‚éƒ½å…±ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ—¶é—´æˆ³ç›´æ¥å®šä¹‰åœ¨axiosé»˜è®¤å±æ€§ä¸Šæˆ–è€…axiosåˆ›å»ºå‡ºæ¥çš„å®ä¾‹ä¸Šé¢ï¼Œå®šä¹‰é»˜è®¤å€¼1000msï¼Œä¹‹åå¦‚æœæƒ³è¦ç¼“å­˜æ—¶é—´é•¿ä¸€ç‚¹çš„è¯ç›´æ¥åœ¨datasetçš„transportå¯¹åº”çš„æ–¹æ³•é…ç½®é¡¹ä¸‹é¢æˆ–è€…æ˜¯axioså®ä¾‹ä¸Šæ·»åŠ æ—¶é—´æˆ³ï¼Œç”¨æ¥è¦†ç›–é»˜è®¤çš„æ—¶é—´æˆ³ï¼Œå› æ­¤å¯ä»¥å®ç°é•¿æ•ˆç¼“å­˜ã€‚ ä¾‹å¦‚ï¼š åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚è¿™é‡Œå¿…é¡»ç”¨åˆ°axiosçš„CancelTokenã€‚ä¸Šé¢è¯´åˆ°CancelTokençš„å…¶å®å°±æ˜¯å¯¹XMLhttpRequestçš„abortæ–¹æ³•è¿›è¡Œå°è£…ï¼Œ XMLHttpRequest å¯¹è±¡æ˜¯æˆ‘ä»¬å‘èµ·ä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„æ ¹æœ¬ï¼Œåœ¨å®ƒåº•ä¸‹æœ‰æ€ä¹ˆä¸€ä¸ªæ–¹æ³• .abort()ï¼Œå°±æ˜¯ä¸­æ–­ä¸€ä¸ªå·²è¢«å‘å‡ºçš„è¯·æ±‚ã€‚ ç®€å•ç†è§£å°±æ˜¯é€šè¿‡ new axios.CancelToken()ç»™æ¯ä¸ªè¯·æ±‚å¸¦ä¸Šä¸€ä¸ªä¸“å±çš„CancelTokenï¼Œä¹‹åä¼šæ¥æ”¶åˆ°ä¸€ä¸ªcancel() å–æ¶ˆæ–¹æ³•ï¼Œç”¨äºåç»­çš„å–æ¶ˆåŠ¨ä½œã€‚ æ‰€ä»¥ï¼Œæ¯æ¬¡è¯·æ±‚è¿›æ¥çš„æ—¶å€™å»è·å–æœ¬æ¬¡è¯·æ±‚çš„CancelTokenï¼Œä¹‹åå°†å…¶å­˜èµ·æ¥ï¼ˆè¿™é‡Œå‡è®¾ç”¨CancelQueueçš„ä¸€ä¸ªMapæ•°æ®ç±»å‹ï¼ˆObject.prototype.toString.call(CancelQueue) = &#39;[object Map]&#39;ï¼‰ï¼‰ï¼Œä¹‹åå‡å¦‚è¿™ä¸ªè¯·æ±‚è½å®šäº†ï¼Œå°±å°†è¿™ä¸ªå­˜å‚¨CancelTokençš„è¯·æ±‚æ ‡è¯†åˆ é™¤ã€‚ å¦‚æœè¿™æ—¶å€™åˆ‡æ¢è·¯ç”±äº†ï¼Œæˆ‘ä»¬å°±å»CancelQueueä¸­ï¼Œéå†ä¸€éæ‰€æœ‰çš„è¯·æ±‚æ ‡è¯†ï¼ˆå› ä¸ºè¿™æ—¶å€™å†é˜Ÿåˆ—é‡Œå¤´çš„è‚¯å®šæ˜¯è¿˜åœ¨pendingçš„è¯·æ±‚ï¼‰ï¼Œè°ƒç”¨å…¶å­˜å‚¨çš„CancelTokenè°ƒç”¨cancelæ–¹æ³•è¿›è¡Œè¯·æ±‚å–æ¶ˆï¼Œå¹¶åˆ é™¤æ ‡è¯†ã€‚ 123456789// 1. è·å– axios CancelTokenconst &#123; CancelToken &#125; = axios;// 2. è·å–å½“å‰è¯·æ±‚çš„sourceï¼Œå¹¶ä¸”å°†å…¶cancelæ–¹æ³•å­˜å‚¨èµ·æ¥const source = CancelToken.source();// 3. ä¹‹åè°ƒç”¨è¿™ä¸ªcancelæ–¹æ³•source.cancel(); å®ç°axiosçš„å®ä¾‹åŒ–é¦–å…ˆå®ä¾‹åŒ–axios(è¿™æ˜¯æˆ‘ä»¬å…¨å±€å°è£…çš„axios)ï¼Œåœ¨å…¶ä¸­åŠ å…¥ç¼“å­˜æ ‡è¯†ï¼Œæ ‡è¯†å¼€å¯ç¼“å­˜ï¼ˆé‡å¤è¯·æ±‚å…±ç”¨ï¼‰ 1234567const instance:AxiosStatic = axios.create(&#123; timeout: 30000, baseURL: API_HOST,&#125;);// è¿™é‡Œé…ç½®ä¸€ä¸ªç¼“å­˜è¯·æ±‚å¾—æ ‡è¯†instance.defaults.enabledCancelCache = true; æ ‡è¯†çš„å®ç°å¯¹äºæ¯ä¸€ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ ‡è¯†ï¼Œæ ‡è¯†å”¯ä¸€ï¼Œæ ‡è¯†æ˜¯é€šè¿‡æ¯ä¸€ä¸ªè¯·æ±‚çš„url, params, method, ä»¥åŠ dataå»ºç«‹æ ‡è¯†ï¼Œåªè¦é€šè¿‡è¿™4è€…å»ºç«‹çš„æ ‡è¯†ç›¸åŒï¼Œé‚£æˆ‘ä»¬å°±èƒ½ç¡®å®šæŸäº›è¯·æ±‚æ˜¯ç›¸åŒçš„ï¼Œ å¦‚ä¸‹getMarkæ˜¯å»ºç«‹ä¸»æ ‡è¯†ï¼ŒgetDataMarkæ˜¯å¯¹å“åº”ä½“å†…çš„dataçš„æ ‡è¯† paramsè¦è¿›è¡Œå‚æ•°æ‹¼æ¥ï¼Œç°åœ¨ä¸»æµåŸºæœ¬åœ¨ç”¨application/jsonå½¢å¼ï¼ŒAxiosé»˜è®¤ä»¥è¿™ç§å½¢å¼å·¥ä½œï¼Œæˆ‘ä»¬ç»™åç«¯æ¥å£ä¼ é€’å‚æ•°ä¹Ÿç®€å• ï¼Œä½†æ˜¯æœ‰æ—¶å€™éœ€è¦ Content-Typeå¿…é¡»ä»¥application/x-www-form-urlencodedå½¢å¼ ï¼Œä»¥JSONæ ¼å¼åå°æ˜¯æ”¶ä¸åˆ°çš„ï¼Œè€Œè¿™æ—¶å€™å°±è¦è¿›è¡Œåºåˆ—åŒ–å¤„ç†ï¼ˆå…ˆå‰æ˜¯æœ‰å‰è¾ˆåœ¨è¿™é‡Œåšäº†å¤„ç†çš„ï¼‰ï¼Œä½†æ˜¯è¿™é‡Œä¸å¤šè¯´å‚æ•°åºåˆ—åŒ– 1234567891011121314151617181920212223242526272829303132333435import &#123; get &#125; from &#x27;lodash&#x27;;import &#123; AxiosRequestConfig &#125; from &#x27;axios&#x27;;import JSONbig from &#x27;json-bigint&#x27;;import paramsSerializer from &#x27;./paramsSerializer&#x27;;// å•ç‹¬å¤„ç†dataï¼Œresponseé‡Œé¢è¿”å›çš„config.dataæ˜¯ä¸ªå­—ç¬¦ä¸²å¯¹è±¡function getDataMark(data:any) &#123; let stringifyData = data; if (typeof stringifyData === &#x27;string&#x27;) &#123; stringifyData = JSONbig.parse(stringifyData); &#125; return stringifyData;&#125;// åŒºåˆ«è¯·æ±‚çš„å”¯ä¸€æ ‡è¯†ï¼Œè¿™é‡Œç”¨æ–¹æ³•å+è¯·æ±‚è·¯å¾„// å¦‚æœä¸€ä¸ªé¡¹ç›®é‡Œæœ‰å¤šä¸ªä¸åŒbaseURLçš„è¯·æ±‚ + å‚æ•°export default function getMark(config:AxiosRequestConfig) &#123; const getKey = (key:string) =&gt; get(config, key); // paramsæ ‡è¯†å¤„ç†ï¼Œå°†å…¶å¤„ç†æˆ?key=value&amp;key2=valueçš„å½¢å¼ const tempQueryString = (getKey(&#x27;paramsSerializer&#x27;) ?? paramsSerializer)(getKey(&#x27;params&#x27;)); // dataæ ‡è¯†å¤„ç† const dataMark = JSONbig.stringify(getDataMark(getKey(&#x27;data&#x27;))); // baseæ ‡è¯† const requestMark = [ config?.method?.toLowerCase() || &#x27;unknownMethod&#x27;, config?.url, ]; getKey(&#x27;params&#x27;) &amp;&amp; requestMark.push(tempQueryString); getKey(&#x27;data&#x27;) &amp;&amp; requestMark.push(dataMark); return requestMark.join(&#x27;&amp;&#x27;);&#125; æœ€ç»ˆçš„æ‹¼æ¥å½¢å¼æ˜¯ method &amp; url &amp; params &amp; dataçš„å½¢å¼ï¼Œ ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªè¯·æ±‚ æœ€ç»ˆæ‹¼æ¥å‡ºæ¥çš„æ˜¯ post&amp;http://172.23.16.92:30094/iam/choerodon/v1/permissions/menus/check-permissions&amp;tenantId=2&amp;[&quot;choerodon.code.organization.project.ps.create&quot;] ç¼“å­˜å®ç°è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨æ‹¦æˆªå™¨çš„å½¢å¼å»æ·»åŠ ç¼“å­˜é€»è¾‘ï¼Œä»¥ä¸‹æ˜¯æ·»åŠ äº†è¯·æ±‚æ‹¦æˆªå™¨ ä¸‹é¢æ ‡çº¢çš„æ˜¯æ·»åŠ å“åº”æ‹¦æˆªå™¨ è‡³äºè¿™é‡Œæ‹¦æˆªå™¨çš„é¡ºåºä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„ï¼Œåç»­å†è¯´ å…¶æ¬¡ï¼Œæˆ‘ä»¬è¦æ˜ç™½è¯·æ±‚çš„å‡ ç§æƒ…å†µ å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªAè¯·æ±‚è¿›æ¥äº† è¿˜åœ¨pendingçš„æ—¶å€™ï¼Œåœ¨é»˜è®¤æ—¶é—´æˆ³å†…ï¼ˆ1000msï¼‰åˆè¿›æ¥äº†ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„Aè¯·æ±‚ï¼ˆé‡å¤äº†,å…±ç”¨çŠ¶æ€ï¼‰ Aè¯·æ±‚å·²ç»è½å®šäº†æˆåŠŸäº†ï¼Œåœ¨å®šä¹‰çš„æ—¶é—´æˆ³èŒƒå›´å†…åˆè¿›æ¥äº†å¤šä¸ªä¸€æ¨¡ä¸€æ ·çš„è¯·æ±‚ï¼ˆç¼“å­˜ï¼‰ Aè¯·æ±‚è½å®šå¤±è´¥äº†ï¼Œåœ¨å®šä¹‰çš„æ—¶é—´æˆ³èŒƒå›´å†…åˆè¿›æ¥äº†å¤šä¸ªä¸€æ¨¡ä¸€æ ·çš„è¯·æ±‚ï¼ˆä¸ç¼“å­˜ï¼‰ æœ€åæ˜ç¡®éœ€è¦å­˜å‚¨åœ¨ç¼“å­˜å®ä¾‹ä¸­çš„æ•°æ®æ ¼å¼ å­˜å‚¨æ•°æ®æˆ‘ä»¬éœ€è¦ä»¥ä¸€ç§é”®å€¼å¯¹çš„å½¢å¼å»å­˜å‚¨ï¼Œå¯é€‰é¡¹å°±å±Objectæˆ–è€…Mapã€‚ ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬éœ€è¦é¢‘ç¹çš„å¯¹ç¼“å­˜çš„æ•°æ®è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ’å…¥ï¼Œèµ‹å€¼ï¼Œåˆ é™¤æ“ä½œç­‰ç­‰ã€‚ åœ¨å°æ•°é‡æ•°æ®æƒ…å†µä¸‹Objectçš„æŸ¥æ‰¾æ•°æ®ç›¸å¯¹Mapæ¥çš„å¿«ï¼Œä½†æ˜¯æ¶‰åŠæ›´å¤šæ’å…¥çš„å’Œåˆ é™¤çš„æƒ…å†µä¸‹éƒ½æ˜¯Mapæ€§èƒ½æ¥çš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”ç›¸åŒå†…å­˜ä¸‹Mapèƒ½å¤Ÿå­˜å‚¨æ›´å¤šçš„é”®å€¼å¯¹ï¼Œè¿™é‡Œæ˜¾ç„¶å­˜åœ¨åºå¤§æ•°æ®çš„æƒ…å†µ äºæ˜¯è¿™é‡Œå°è£…ä¸€ä¸ªAxiosCacheç¼“å­˜ç±»ï¼Œç„¶åå†™ä¸€äº›ç§æœ‰æ–¹æ³•åœ¨é‡Œå¤´ 1234567891011121314151617181920212223242526272829303132333435class AxiosCache &#123; constructor() &#123; super(); this.cacheData = new Map(); &#125; get size() &#123; return this.cacheData.size; &#125; get(key) &#123; return this.cacheData.get(key); &#125; delete(key) &#123; this.cacheData.delete(key); &#125; has(key) &#123; return this.cacheData.has(key); &#125; set(key, value) &#123; this.cacheData.set(key, value); &#125; isEmpty() &#123; return !!this.cacheData.size; &#125; clear() &#123; this.cacheData = new Map(); &#125;&#125;const axiosCache = new AxiosCache(); è¯·æ±‚æ‹¦æˆªå™¨å®ç° å½“Aè¯·æ±‚è¿›æ¥æ—¶å€™å‘ç°å…ˆå‰å¹¶æ²¡æœ‰åœ¨ç¼“å­˜é˜Ÿåˆ—ä¸­åšè¿‡æ ‡è¯†ï¼Œä¹Ÿå°±æ˜¯è¯´æ ‡è¯†é‡Œå¤´ä¸å­˜åœ¨ä»¥ä¸Šçš„é‚£äº›å­—æ®µï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å°†Aè¯·æ±‚åšä¸ªæ ‡è¯†ï¼Œå¹¶ä¸”è®¾ç½®å®ƒçš„isPendingï¼ˆæ­£åœ¨è¯·æ±‚ï¼‰ä¸ºtrue 123axiosCache.set(cancelCacheKey, &#123; isPending: true,&#125;); å½“Aè¯·æ±‚å·²ç»åšè¿‡æ ‡è¯†çš„æ—¶å€™ï¼Œè¿™æ—¶å€™åˆè¿›æ¥ä¸€ä¸ªA1è¯·æ±‚ å€˜è‹¥ç¬¬ä¸€æ¬¡åšè¿‡æ ‡è¯†çš„Aè¯·æ±‚å·²ç»ä¸æ˜¯åœ¨pendingçŠ¶æ€å¹¶ä¸”åœ¨è¿™æ¬¡è¯·æ±‚çš„æ—¶é—´æˆ³çš„èŒƒå›´å†…ï¼ˆåœ¨åé¢è®²å“åº”æ‹¦æˆªå™¨çš„æ—¶å€™ä¼šæŠŠAçš„isPendingå­—æ®µåœ¨æŸç§æ¡ä»¶ä¸‹è®¾ç½®ä¸ºfalse, å¹¶ä¸”å­˜å‚¨Aè¯·æ±‚å“åº”åçš„æ•°æ®ï¼‰ï¼ŒA1è¯·æ±‚å°±ç›´æ¥å»å–Aç¼“å­˜çš„æ•°æ® è¿™é‡Œå°±æ¶‰åŠåˆ°ä¸Šé¢æ‰€è¯´çš„é€‚é…å™¨çš„ç”¨å¤„ï¼Œç›´æ¥åœ¨A1è¯·æ±‚configçš„é€‚é…å™¨è¿”å›ä¸€ä¸ªæˆåŠŸè½å®šçš„æœŸçº¦ï¼Œé€šè¿‡æ ‡è¯†æ‹¿åˆ°cacheå®ä¾‹ä¸­ç¼“å­˜çš„æ•°æ®æ•°æ®ã€‚ 12345678910111213141516// isPendingä¸ºfalseçš„æƒ…å†µä¸‹ï¼Œå¹¶ä¸”åœ¨æ—¶é—´æˆ³çš„èŒƒå›´å†…if (expire &amp;&amp; expire &gt; Date.now()) &#123; tempConfig.adapter = () =&gt; &#123; const resolveData: AxiosResponse = &#123; data, headers: tempConfig.headers, config: &#123; ...tempConfig, useCache: true, &#125;, // @ts-expect-error request: tempConfig, &#125;; return Promise.resolve(resolveData); &#125;;&#125; è¿™é‡Œå®šä¹‰ä¸€ä¸ªuseCacheçš„å­—æ®µè¡¨æ˜è¿™ä¸ªæ˜¯å†ç”¨ç¼“å­˜æ•°æ®ï¼Œåç»­çš„å“åº”æ‹¦æˆªå™¨ä¸­ä¼šè®²åˆ° å½“Aè¯·æ±‚å·²ç»åšè¿‡æ ‡è¯†çš„æ—¶å€™ï¼Œè¿™æ—¶å€™åˆè¿›æ¥ä¸€ä¸ªA1è¯·æ±‚ å€˜è‹¥ç¬¬ä¸€æ¬¡åšè¿‡æ ‡è¯†çš„Aè¯·æ±‚è¿˜åœ¨pendingçš„çŠ¶æ€ï¼Œæˆ‘åˆæƒ³å…±ç”¨ç¼“å­˜æ•°æ®ï¼Œä½†æ˜¯å¹¶ä¸æ¸…æ¥šä»€ä¹ˆæ—¶å€™Aè¯·æ±‚æ‰ä¼šç»“æŸã€‚ è¿™æ—¶å€™æˆ‘ä»¬å°±æƒ³ï¼Œç”¨ä¸€ä¸ªå‘å¸ƒè®¢é˜…çš„æ¨¡å¼ï¼Œå°†A1è¯·æ±‚çš„æœŸçº¦è½å®šæ—¶æœºè®¢é˜…èµ·æ¥ï¼Œåœ¨Aè¯·æ±‚è½å®šçš„æ—¶å€™å‘Šè¯‰A1ä½ æ˜¯æ—¶å€™ä¹Ÿè¯¥è½å®šäº†å°±å»å‘å¸ƒä¿¡æ¯ï¼Œè¿™æ—¶å€™ç¼“å­˜çš„æ•°æ®å°±æ˜¯åœ¨Aè¯·æ±‚è½å®šæ—¶å€™ï¼Œå»å‘å¸ƒé¡ºä¾¿ç»™A1ä¼ é€’çš„. å…¶å®è¿™ä¸ªè¿‡ç¨‹å¯ä»¥æœ‰å¤šä¸ªA1è¿›æ¥ å¦‚æœä¸å¥½ç†è§£çš„è¿™é‡Œæœ‰æµç¨‹å›¾ â€‹ 12345678910111213141516// è¯´æ˜æ‰¾åˆ°äº†è¯·æ±‚ä½†æ˜¯æ‰¾åˆ°çš„è¿™ä¸ªç¼“å­˜çš„è¯·æ±‚è¿˜åœ¨pendingï¼Œè¿™æ—¶å€™è®¢é˜…ä¸€ä¸ªæœŸçº¦å¾…ä¼šè¦ç”¨tempConfig.adapter = () =&gt; new Promise((resolve) =&gt; &#123; axiosEvent.once(cancelCacheKey, (res:unknown) =&gt; &#123; const resolveData: AxiosResponse = &#123; data: res, headers: tempConfig.headers, config: &#123; ...tempConfig, useCache: true, &#125;, // @ts-expect-error request: tempConfig, &#125;; resolve(resolveData); &#125;);&#125;); è¿™é‡ŒA1è¯·æ±‚è®¢é˜…äº†ä»¥ä¸€ä¸ªä»¥cancelCacheKeyä¸ºæ ‡è¯†çš„ä¿¡å·ã€‚ è‡³äºAè¯·æ±‚è½å®šçš„æ—¶æœºï¼Œåˆ°å“åº”æ‹¦æˆªå™¨ä¸­åšå¤„ç† å¦‚æœAè¯·æ±‚è¯·æ±‚å¤±è´¥æ€ä¹ˆåŠï¼Ÿé‚£è¿™æ—¶å€™æˆ‘ä»¬ä¸åšå¤„ç†ï¼Œä¹Ÿä¸åšæ ‡è¯†ï¼Œè¯·æ±‚å¤±è´¥èµ°çš„æ˜¯è¯·æ±‚å¤±è´¥çš„æ‹¦æˆªå™¨ã€‚ ä»¥ä¸‹æ˜¯æ•´ä¸ªè¯·æ±‚æ‹¦æˆªå™¨ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263import &#123; AxiosRequestConfig, AxiosResponse &#125; from &#x27;axios&#x27;;import &#123; get &#125; from &#x27;lodash&#x27;;import getMark, &#123; transformDataToString &#125; from &#x27;../utils/getMark&#x27;;import &#123; axiosCache, axiosEvent &#125; from &#x27;../instances&#x27;;export function handleCancelCacheRequest(config:AxiosRequestConfig) &#123; const tempConfig = config; // æ˜¯å¦å¼€å¯äº†ç¼“å­˜ï¼ˆå¤ç”¨é‡å¤è¯·æ±‚çŠ¶æ€ï¼‰ const enabledCancelCache = get(tempConfig, &#x27;enabledCancelCache&#x27;); if (enabledCancelCache) &#123; // è·å–æ ‡è¯† const cancelCacheKey = getMark(tempConfig); if (!axiosCache.has(cancelCacheKey)) &#123; axiosCache.set(cancelCacheKey, &#123;&#125;); &#125; const &#123; data, // ç¼“å­˜çš„æ•°æ® isPending, // è¯·æ±‚æ˜¯å¦æ˜¯pendingçŠ¶æ€ expire, // æ—¶é—´æˆ³ &#125; = axiosCache.get(cancelCacheKey); if (isPending) &#123; // è¯´æ˜æ‰¾åˆ°äº†è¯·æ±‚ä½†æ˜¯æ‰¾åˆ°çš„è¿™ä¸ªç¼“å­˜çš„è¯·æ±‚è¿˜åœ¨pendingï¼Œè¿™æ—¶å€™è®¢é˜…ä¸€ä¸ªæœŸçº¦å¾…ä¼šè¦ç”¨ tempConfig.adapter = () =&gt; new Promise((resolve) =&gt; &#123; axiosEvent.once(cancelCacheKey, (res:unknown) =&gt; &#123; const resolveData: AxiosResponse = &#123; data: res, headers: tempConfig.headers, config: &#123; ...tempConfig, useCache: true, &#125;, // @ts-expect-error request: tempConfig, &#125;; resolve(resolveData); &#125;); &#125;); &#125; else if (expire &amp;&amp; expire &gt; Date.now()) &#123; tempConfig.adapter = () =&gt; &#123; const resolveData: AxiosResponse = &#123; data: transformDataToString(data), headers: tempConfig.headers, config: &#123; ...tempConfig, useCache: true, &#125;, // @ts-expect-error request: tempConfig, &#125;; return Promise.resolve(resolveData); &#125;; &#125; else &#123; axiosCache.set(cancelCacheKey, &#123; isPending: true, &#125;); &#125; &#125; return tempConfig;&#125; å“åº”æ‹¦æˆªå™¨çš„å®ç°å®ç°äº†è¯·æ±‚æ‹¦æˆªå™¨ä¹‹åï¼Œæˆ‘ä»¬æ¥å¤„ç†åœ¨å…ˆå‰æ‹¦æˆªå™¨ä¸­çš„ä¸€äº›å­—æ®µï¼Œä»¥åŠè¯·æ±‚å¤±è´¥çš„æ•°æ®å¤„ç† æˆ‘ä»¬å…ˆå¯¹å“åº”æˆåŠŸçš„çš„æ‹¦æˆªå™¨åšå¤„ç† é¦–å…ˆæ˜¯å“åº”æˆåŠŸçš„æƒ…å†µä¸‹è€Œä¸”ä¹ŸæˆåŠŸæ‹¿åˆ°æƒ³è¦çš„æ•°æ®ï¼Œå‡è®¾è¿™ä¸ªå“åº”æˆåŠŸçš„è¯·æ±‚æ˜¯ä¸Šè¿°çš„Aè¯·æ±‚ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±åº”è¯¥è®°å½•ä¸‹Aè¯·æ±‚æœ€ç»ˆçš„æ‰€æœ‰æ•°æ®ä»¥åŠå®ƒéœ€è¦çš„ç¼“å­˜æ—¶é—´ï¼Œå¹¶ä¸”è®¾ç½®å®ƒisPendingå­—æ®µä¸ºfalseï¼Œæœ€é‡è¦çš„æ˜¯ç»™è®¢é˜…äº†cancelCacheKeyçš„ä¿¡æ¯çš„è¯·æ±‚ä»¬å‘å¸ƒä¸€ä¸ªä¿¡å·ï¼Œå‘Šè¯‰ä½ ä»¬å¯ä»¥æ¥æ‹¿æˆ‘çš„ï¼ˆAè¯·æ±‚ï¼‰æ•°æ®äº†ï¼ 12345678910if (enabledCancelCache &amp;&amp; !useCache) &#123; const finalData = resData; axiosCache.set(config?.cancelCacheKey || cancelCacheKey, &#123; data: finalData, isPending: false, expire: Date.now() + Number(enabledCancelCache) * 500, &#125;); // å‘å¸ƒè¿™ä¸ªä¿¡å·è®©æ‰€æœ‰è®¢é˜…äº†Açš„éƒ½èƒ½æ¥å—åˆ°ä¿¡æ¯ axiosEvent.emit(cancelCacheKey, finalData);&#125; è¿™é‡Œä¸ºä»€ä¹ˆè¦å¤šä¸€æ¬¡useCacheçš„åˆ¤æ–­å‘¢? å› ä¸ºæˆ‘å…ˆå‰åœ¨è¯·æ±‚æ‹¦æˆªå™¨ä¸­å¤„ç†äº†adapterç”¨æ¥å¤„ç†ç¼“å­˜, èµ°å®Œäº†adapteræ‰ä¼šèµ°å“åº”æ‹¦æˆªå™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘åœ¨å“åº”æ‹¦æˆªå™¨é‡Œå¤´è¿˜å¾—åˆ¤æ–­ï¼Œè¿™æ¬¡åˆ°åº•æ˜¯èµ°çš„ç¼“å­˜ï¼Œè¿˜æ˜¯ç¬¬ä¸€æ¬¡éœ€è¦åšç¼“å­˜å‘¢ï¼Ÿæ‰€ä»¥æ‰çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘åœ¨ä¸Šé¢çš„adapteré‡Œå¤´åŠ å…¥äº†useCacheçš„å­—æ®µã€‚ ç®€å•æ¥è¯´ï¼Œå°±æ˜¯Aè¯·æ±‚ç¬¬ä¸€æ¬¡è¿›æ¥ï¼ŒuseCacheå°±æ˜¯falseï¼Œå°±å¾—å»å­˜å€¼ï¼Œæ¥ä¸‹æ¥è¿›æ¥A1ï¼Œé‚£æˆ‘å°±å¾—èµ°ç¼“å­˜ï¼Œæˆ‘ä¸å†å»é‡æ–°è®¾ç½®æ–°å€¼äº†ã€‚ æ²¡æœ‰æˆåŠŸæ‹¿åˆ°æƒ³è¦çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åç«¯è¿”å›é”™è¯¯ä¿¡æ¯çš„æƒ…å†µ è¿™é‡Œæˆ‘ä»¬çš„åå°è¿”å›çš„é”™è¯¯æ ‡è¯†æ˜¯failedå­—æ®µï¼Œå°±ç›´æ¥å°†isPendingè®¾ç½®ä¸ºfalseä¸åšåç»­å¤„ç†ï¼Œå¹¶ä¸”å°†åœ¨è®¢é˜…äº†çš„è¯·æ±‚ä¿¡å·éƒ½åˆ é™¤(åˆ é™¤æ˜¯å› ä¸ºAè¯·æ±‚å¤±è´¥å°±å·²ç»æŠ¥é”™ï¼Œå…¶ä»–è¯·æ±‚å°±ä¸å¿…å†é‡å¤æŠ¥é”™) 1234axiosCache.set(cancelCacheKey, &#123; isPending: false,&#125;);axiosEvent.delete(cancelCacheKey); å½“ç„¶å“åº”å¤±è´¥æ‹¦æˆªå™¨ä¸­ä¹Ÿéœ€è¦åšä¸Šè¿°è¿™æ ·çš„å¤„ç† è¿™æ˜¯æœ€ç»ˆçš„å“åº”æˆåŠŸçš„æ‹¦æˆªå™¨ä»£ç ğŸ‘‡ 123456789101112131415161718192021222324252627282930313233343536373839404142import &#123; AxiosResponse &#125; from &#x27;axios&#x27;;import get from &#x27;lodash/get&#x27;;import &#123; prompt,&#125; from &#x27;@/utils&#x27;;import &#123; axiosCache, axiosEvent &#125; from &#x27;../instances&#x27;;import getMark from &#x27;../utils/getMark&#x27;;export default function handleResponseInterceptor(response:AxiosResponse) &#123; const resData = get(response, &#x27;data&#x27;); const config = get(response, &#x27;config&#x27;) || &#123;&#125;; const &#123; enabledCancelCache, useCache &#125; = config; const cancelCacheKey = getMark(config); if (get(response, &#x27;status&#x27;) === 204) &#123; return response; &#125; if (resData?.failed === true) &#123; axiosCache.set(cancelCacheKey, &#123; ...(axiosCache.get(cancelCacheKey) || &#123;&#125;), isPending: false, &#125;); if (!response?.config?.noPrompt) &#123; prompt(resData.message, &#x27;error&#x27;); &#125; throw resData; &#125; if (enabledCancelCache &amp;&amp; !useCache) &#123; const finalData = resData; axiosCache.set(config?.cancelCacheKey || cancelCacheKey, &#123; data: finalData, isPending: false, expire: Date.now() + Number(enabledCancelCache) * 500, &#125;); axiosEvent.emit(cancelCacheKey, finalData); &#125; return resData;&#125; åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚è¿™é‡Œçš„æ€è·¯å°±ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼ŒæŒ‰ç…§ä¸Šé¢éœ€æ±‚åˆ†ææ‰€è¯´çš„å­˜å‚¨cancelTokenç»™æ¯ä¸€ä¸ªè¯·æ±‚ï¼Œä¹‹ååˆ‡æ¢è·¯ç”±å°†pendingçš„è¯·æ±‚å–æ¶ˆæ‰ å› æ­¤æˆ‘ä»¬ä¸å•å•éœ€è¦å®ç°å­˜å‚¨cancelTokençš„ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿˜æœ‰å¤„ç†ä»–çš„æ‹¦æˆªå™¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç›‘å¬è·¯ç”±çš„å˜åŒ–ï¼Œæ‰¾åˆ°è¿™ä¸ªæ—¶æœºå°†æ‰€æœ‰pendingè¯·æ±‚cancelæ‰ æ‹¦æˆªå™¨çš„å®ç°è¿™é‡Œæˆ‘ä»¬å°è£…ä¸€ä¸ªæ‹¦æˆªå™¨routeCancelInterceptor 12// æ·»åŠ åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚æ‹¦æˆªå™¨instance.interceptors.request.use(routeCancelInterceptor); // 4 éœ€è¦ä¸€ä¸ªå–æ¶ˆè¯·æ±‚çš„é˜Ÿï¼Œåˆ—äºæ˜¯å°è£…ä¸€ä¸ªå®ä¾‹ç”¨æ¥å­˜å‚¨å¯¹åº”çš„è¯·æ±‚ï¼ŒåŒ…å«ç›¸å¯¹åº”çš„getï¼Œsetï¼Œç­‰æ–¹æ³•ï¼Œæœ€é‡è¦çš„æ˜¯ cancelAllRequestæ–¹æ³•ï¼Œç”¨äºéå†æ‰€æœ‰å­˜å‚¨çš„pendingè¯·æ±‚ï¼Œä¹‹ååœ¨åˆ‡è·¯ç”±çš„æ—¶å€™ï¼Œéå†æ•°æ®å–æ¶ˆå®ƒã€‚è¿™é‡Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å¼•å…¥å‰é¢åšäº†ç¼“å­˜çš„axiosCacheï¼Œåå¤´ä¼šç»†è®² 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748import &#123; axiosCache &#125; from &#x27;./index&#x27;;class RouteAxios &#123; constructor() &#123; this.pendingRequest = new Map(); &#125; get size() &#123; return this.pendingRequest.size; &#125; get(key) &#123; return this.pendingRequest.get(key); &#125; delete(key) &#123; this.pendingRequest.delete(key); &#125; has(key) &#123; return this.pendingRequest.has(key); &#125; set(key, value) &#123; this.pendingRequest.set(key, value); &#125; isEmpty() &#123; return !!this.pendingRequest.size; &#125; clear() &#123; this.pendingRequest = new Map(); &#125; cancelAllRequest() &#123; for (const [key, value] of this.pendingRequest) &#123; if (value?.cancel &amp;&amp; typeof value.cancel === &#x27;function&#x27;) &#123; value.cancel(); axiosCache.delete(key); // è¿™é‡Œä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Ÿåç»­åœ¨è¯´ &#125; &#125; this.clear(); &#125;&#125;export const axiosRoutesCancel = new RouteAxios(); ä¹‹åè¦æˆ‘ä»¬å°±åœ¨è¯·æ±‚æ‹¦æˆªå™¨é‡Œå¤´å¤„ç†cancelToken å½“ç„¶é¦–å…ˆä¹Ÿæ˜¯å…ˆæ£€æµ‹æ˜¯å¦æœ‰è¿™ä¸ªenabledCancelRouteå­—æ®µè¡¨æ˜æ˜¯å¦è¦å°†è¿™ä¸ªè¯·æ±‚åŠ å…¥åˆ‡æ¢è·¯ç”±å–æ¶ˆè¯·æ±‚çš„æ–¹æ¡ˆï¼Œä¹‹åè°ƒç”¨source()ï¼Œè·å–å­˜å‚¨å…¶source.cancelæ–¹æ³•ï¼Œé‡ç‚¹æ˜¯è¦åœ¨configä¸ŠåŠ å…¥cancelTokenï¼Œè¡¨æ˜è¿™ä¸ªè¯·æ±‚å¾…ä¼šå¯èƒ½ä¼šè¢«å–æ¶ˆï¼ˆç®€å•æ¥è®²è¿™ä¸ªæ ‡è¯†å¯¹åº”è¿™ä¸ªsource.cancelçš„æ‰§è¡Œç›®æ ‡ï¼‰ 12345678910111213141516171819202122import axios, &#123; AxiosRequestConfig &#125; from &#x27;axios&#x27;;import get from &#x27;lodash/get&#x27;;import &#123; axiosRoutesCancel &#125; from &#x27;../instances&#x27;;import getMark from &#x27;../utils/getMark&#x27;;export function routeCancelInterceptor(config:AxiosRequestConfig) &#123; const tempConfig = config; const enabledCancelRoute = get(tempConfig, &#x27;enabledCancelRoute&#x27;); if (enabledCancelRoute) &#123; const cancelRouteKey = tempConfig?.cancelCacheKey || getMark(config); const &#123; CancelToken &#125; = axios; const source = CancelToken.source(); tempConfig.cancelToken = source.token; axiosRoutesCancel.set(cancelRouteKey, &#123; cancel: source.cancel, name: cancelRouteKey, &#125;); &#125; return tempConfig;&#125; å¦‚æœè¯·æ±‚åœ¨è¿˜æ²¡åˆ‡æ¢è·¯ç”±çš„æ—¶å€™å°±å·²ç»å“åº”æˆåŠŸï¼ˆè¿™é‡Œä¸ç®¡æ˜¯å¦æ‹¿åˆ°æ­£ç¡®æ•°æ®ï¼‰ï¼Œå°±åº”è¯¥ç›´æ¥åˆ é™¤è¿™ä¸ªå­˜å‚¨çš„keyå€¼ è¿™é‡Œå°±åœ¨å“åº”æˆåŠŸçš„æ‹¦æˆªå™¨ä¸­å¤„ç†ï¼Œåœ¨å¤±è´¥æ‹¦æˆªå™¨ä¸­ä¹Ÿæ˜¯ä¸€æ ·çš„å¤„ç†æ–¹æ¡ˆ 123if (enabledCancelRoute) &#123; axiosRoutesCancel.delete(cancelCacheKey);&#125; è·¯ç”±å®ˆå«çš„å®ç°å®ç°äº†æ‹¦æˆªå™¨æˆ‘ä»¬è¿˜éœ€è¦ç®€å•çš„å®ç°ä¸€ä¸ªè·¯ç”±å®ˆå«ï¼Œç”¨æ¥ç›‘å¬è·¯ç”±å˜åŒ– åœ¨å…¨å±€ï¼Œæˆ‘ä»¬å°è£…äº†ä¸€ä¸ªå«åšPermissionRouteçš„å®ˆå«ï¼Œè¿™å®ˆå«æ˜¯å¯¹react-router-domçš„routeåšäº†å˜å‘å°è£… 1const PermissionRoute: React.FC&lt;PermissionRouteProps&gt; =()=&gt; React.ReactDOM ç»™è¿™ä¸ªç»„ä»¶é…ç½®å‚æ•°ï¼Œå«åšenabledRouteChangedAjaxBlockï¼Œé»˜è®¤ä¸ºtrue, æ ‡è¯†è¿™ä¸ªè·¯ç”±ä¸‹çš„è¯·æ±‚ï¼Œåœ¨åˆ‡æ¢çš„æ—¶å€™éƒ½ä¼šè¢«å–æ¶ˆï¼Œå½“ç„¶æ¯ä¸ªè¯·æ±‚è‡ªå·±ä¹Ÿä¼šæ ‡è¯†è‡ªå·±æ˜¯å¦åœ¨åˆ‡æ¢è·¯ç”±çš„æ—¶å€™è¦è¢«å–æ¶ˆï¼Œåè€…çš„ä¼˜å…ˆçº§å¤§äºå‰è€… ä¹‹åæˆ‘ä»¬å†™ä¸€ä¸ªç»„ä»¶é”€æ¯çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆè·¯ç”±åˆ‡æ¢çš„æ—¶å€™ï¼Œè¿™ä¸ªè·¯ç”±å¯¹åº”çš„è·¯ç”±å®ˆå«ç»„ä»¶å°±ä¼šè¢«é”€æ¯ï¼Œéšä¹‹é”€æ¯ï¼ˆå–æ¶ˆï¼‰çš„ä¹Ÿå°±æ˜¯å½“å‰é¡µé¢æ­£åœ¨pendingçš„è¯·æ±‚ï¼‰ 123456useEffect(() =&gt; function () &#123; if (enabledRouteChangedAjaxBlock &amp;&amp; axiosRoutesCancel.size) &#123; axiosRoutesCancel.cancelAllRequest(); &#125;&#125;,[location]); useEffectè¿”å›ä¸€ä¸ªé”€æ¯çš„å‡½æ•°ï¼Œå¹¶ä¸”cancelæ‰æ‰€æœ‰pendingè¯·æ±‚ã€‚ è¿™é‡Œå…·ä½“å¯ä»¥çœ‹çœ‹PermissionRouteçš„å°è£…ä»£ç ï¼Œæ–¹ä¾¿ç†è§£ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556import React, &#123; useEffect, useMemo &#125; from &#x27;react&#x27;;import &#123; Route, RouteProps, useLocation &#125; from &#x27;react-router-dom&#x27;;import &#123; noaccess as NoAccess, Permission &#125; from &#x27;@/index&#x27;;import useQueryString from &#x27;@/hooks/useQueryString&#x27;;import Skeleton from &#x27;@/containers/components/c7n/master/skeleton&#x27;;import &#123; axiosRoutesCancel &#125; from &#x27;@/containers/components/c7n/tools/axios/instances&#x27;;interface PermissionRouteProps extends RouteProps &#123; service: string[] | ((type: &#x27;project&#x27; | &#x27;organization&#x27; | &#x27;site&#x27;) =&gt; string[]), enabledRouteChangedAjaxBlock: boolean,&#125;const isFunction = (something: unknown): something is Function =&gt; typeof something === &#x27;function&#x27;;const PermissionRoute: React.FC&lt;PermissionRouteProps&gt; = (&#123; enabledRouteChangedAjaxBlock = true, service, ...rest &#125;) =&gt; &#123; const &#123; type &#125; = useQueryString(); const location = useLocation(); const codes = useMemo(() =&gt; (isFunction(service) ? service(type) : (service || [])), [service, type]); const route = ( &lt;Route &#123;...rest&#125; /&gt; ); useEffect(() =&gt; function () &#123; if (enabledRouteChangedAjaxBlock &amp;&amp; axiosRoutesCancel.size) &#123; axiosRoutesCancel.cancelAllRequest(); &#125; &#125;, [location]); return (codes.length &gt; 0) ? ( &lt;Permission service=&#123;codes&#125; noAccessChildren=&#123;&lt;NoAccess /&gt;&#125; defaultChildren=&#123;&lt;Skeleton /&gt;&#125; &gt; &#123;route&#125; &lt;/Permission&gt; ) : ( &lt;Route &#123;...rest&#125; /&gt; );&#125;;export default PermissionRoute;// ç”¨æ³•&lt;PermissionRoute service=&#123;[&#x27;choerodon.code.project.project.overview.ps.default&#x27;]&#125; exact path=&#123;`$&#123;match.url&#125;agile/project-overview`&#125; component=&#123;ProjectOverview&#125;/&gt; é—ç•™é—®é¢˜ä¸ºä»€ä¹ˆä¸ç”¨CancelTokenå»å–æ¶ˆé‡å¤è¯·æ±‚è€Œç”¨ç¼“å­˜åŸç†ï¼Ÿæˆ‘ä»¬çŸ¥é“å–æ¶ˆé‡å¤è¯·æ±‚åŸç†æ˜¯abortï¼Œå®šä¹‰æ˜¯ï¼šè¯·æ±‚å¦‚æœå‘å‡ºï¼Œåˆ™ç«‹åˆ»ç»ˆæ­¢è¯·æ±‚ï¼› åŸå› ä¸€ï¼šè¿™ä¸ªç»ˆæ­¢å°±å¾ˆå¾®å¦™ï¼Œç»ˆæ­¢ä¹‹åçš„è¯·æ±‚æˆ‘ä»¬å¯ä»¥çŸ¥é“å®ƒèµ°äº†å“åº”å¤±è´¥çš„æ‹¦æˆªå™¨ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å‰ç«¯è¿˜æ˜¯æŠŠæ•°æ®å‘ç»™äº†åç«¯ï¼Œåç«¯è¿˜ä¼šåšæ•°æ®å¤„ç†æ¯”å¦‚ï¼ˆpostï¼Œputç­‰ï¼‰ï¼Œåªæ˜¯ç»ˆæ­¢äº†ï¼Œä½†æ˜¯åç«¯å¹¶ä¸çŸ¥é“æˆ‘ä»¬ç»ˆæ­¢äº†è¯·æ±‚ï¼Œåªæ˜¯å‰ç«¯ç»ˆæ­¢æ²¡æœ‰åœ¨åƒå“åº”æˆåŠŸæ‹¦æˆªå™¨ä¸€æ ·å¯¹æ•°æ®åšå¤„ç† ä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬è¦çš„æ•ˆæœä¸æ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬è¦çš„æ˜¯åœ¨é‚£ä¸€ç¬é—´çš„æ‰€æœ‰ç›¸åŒè¯·æ±‚çŠ¶æ€å¤ç”¨ï¼Œé‡å¤çš„è¯·æ±‚ä»¬æ˜¯ä¸å¯ä»¥åœ¨é‚£ä¸€ç¬é—´å†å‘é€ç»™åç«¯çš„ï¼Œè€Œæ˜¯åªæœ‰é‚£ä¸ªç¬¬ä¸€æ¬¡çš„è¯·æ±‚æ‰å‘å‡ºå»ï¼Œå¦‚æœä½¿ç”¨CancelTokenè¿™æ ·å°±æ²¡æœ‰æ„ä¹‰äº† åŸå› äºŒabortä¼šå¯¼è‡´æµè§ˆå™¨ä¸­çš„networkä¸­ä¸€å †æŠ¥çº¢ï¼Œçœ‹ä¸Šå»æ¯”è¾ƒä¸ç¾è§‚ã€‚ åŸå› ä¸‰å¦‚æœç”¨äº†cancelTokenæˆ‘åˆæƒ³åšç¼“å­˜ï¼Œè¿˜ä¸å¦‚ç›´æ¥ç”¨ç¼“å­˜æ¥ï¼Œä¹Ÿå¯ä»¥è¾¾åˆ°æ•ˆæœ ä¸ºä»€ä¹ˆæ‹¦æˆªå™¨çš„æ·»åŠ é¡ºåºä¼šå½±å“åˆ°ç¼“å­˜ï¼Ÿè¿™ä¹Ÿæ˜¯åœ¨ä¸Šé¢è®²axiosçš„adapterçš„æ—¶å€™æåŠè¿‡ è¯·æ±‚æ‹¦æˆªå™¨æ˜¯çš„æ‰§è¡Œé¡ºåºæ˜¯åæ·»åŠ çš„å…ˆæ‰§è¡Œ å“åº”æ‹¦æˆªå™¨æ˜¯å…ˆæ·»åŠ çš„å…ˆæ‰§è¡Œ ä¾‹å¦‚ï¼šæˆ‘ä»¬é¡¹ç›®çš„è¯·æ±‚æ‹¦æˆªå™¨æ˜¯è¿™æ ·æ·»åŠ çš„ 1234567891011// æ·»åŠ åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚æ‹¦æˆªå™¨instance.interceptors.request.use(routeCancelInterceptor); // 4// æ·»åŠ ç¼“å­˜(å¤ç”¨é‡å¤è¯·æ±‚)è¯·æ±‚æ‹¦æˆªå™¨instance.interceptors.request.use(handleCancelCacheRequest, handleRequestError); // 3// åˆ†é¡µæ•°æ®è½¬æ¢æ‹¦æˆªå™¨instance.interceptors.request.use(transformRequestPage); // 2// æ·»åŠ å¤´éƒ¨æ‹¦æˆªå™¨ï¼Œ ä»¥åŠè¯·æ±‚å¤±è´¥æ‹¦æˆªå™¨instance.interceptors.request.use(addCustomHeader); // 1 æŒ‰é¡ºåºæ˜¯ä»ä¸‹åˆ°ä¸Šæ‰§è¡Œï¼ŒæŒ‰ç…§æ ‡æ³¨çš„1ï¼Œ2ï¼Œ3ï¼Œ4æ‰§è¡Œ å“åº”æ‹¦æˆªå™¨æ˜¯è¿™æ ·çš„ 123// æ·»åŠ å“åº”æ‹¦æˆªå™¨instance.interceptors.response.use(transformResponsePage); // 1instance.interceptors.response.use(handleResponseInterceptor, handelResponseError); // 2 è·¯ç”±å–æ¶ˆcancelAllRequestæ–¹æ³•ä¸­ä¸ºä»€ä¹ˆè¦åˆ é™¤cacheä¸­çš„æ•°æ®ï¼Ÿéš¾ç‚¹è§£å†³","tags":["Javascript","Axios"],"categories":["Javascript"]},{"title":"ç®—æ³•ä¹‹äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„","path":"/2021/06/20/ç®—æ³•ä¹‹äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„/","content":"257. äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œè¿”å›æ‰€æœ‰ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ã€‚ è¯´æ˜: å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚ æ€è·¯ï¼š å‰åºéå†ï¼Œæ¯ä¸€æ¬¡è®¿é—®ä¸‹ä¸€ä¸ªèŠ‚ç‚¹éƒ½æŠŠæœ¬æ¬¡çš„è·¯å¾„å­—ç¬¦ä¸²ä¼ é€’ä¸‹å»ï¼Œæ¯æ¬¡èµ°åˆ°èŠ‚ç‚¹æ²¡æœ‰å·¦å³å­æ ‘äº†å°±æŠŠæœ€ç»ˆçš„è¿™ä¸ªå­—ç¬¦ä¸²ç»™å­˜åˆ°æœ€ç»ˆæ•°ç»„é‡Œå¤´ 1234567891011121314151617181920212223242526272829303132333435363738394041/** * Definition for a binary tree node. * function TreeNode(val, left, right) &#123; * this.val = (val===undefined ? 0 : val) * this.left = (left===undefined ? null : left) * this.right = (right===undefined ? null : right) * &#125; *//** * @param &#123;TreeNode&#125; root * @return &#123;string[]&#125; */var binaryTreePaths = function (root) &#123; if (!root) &#123; return root; &#125; let res = []; const getPath = (root, str) =&gt; &#123; if (root) &#123; if (str) &#123; str += `-&gt;$&#123;root.val&#125;`; &#125; else &#123; str = String(root.val); &#125; if (root.left) &#123; getPath(root.left, str) &#125; if (root.right) &#123; getPath(root.right, str) &#125; if (!root.right &amp;&amp; !root.left) &#123; res.push(str); &#125; &#125; &#125; getPath(root, &#x27;&#x27;); return res;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","äºŒå‰æ ‘"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹æ— é‡å¤å­—ç¬¦æœ€é•¿å­ä¸²","path":"/2021/06/20/ç®—æ³•ä¹‹æ— é‡å¤å­—ç¬¦æœ€é•¿å­ä¸²/","content":"3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸² çš„é•¿åº¦ã€‚ è§£æ³•ï¼š 1.æ»‘åŠ¨çª—å£ 123456789101112131415161718192021var lengthOfLongestSubstring = function(s) &#123; // å“ˆå¸Œé›†åˆï¼Œè®°å½•æ¯ä¸ªå­—ç¬¦æ˜¯å¦å‡ºç°è¿‡ const occ = new Set(); const n = s.length; // å³æŒ‡é’ˆï¼Œåˆå§‹å€¼ä¸º -1ï¼Œç›¸å½“äºæˆ‘ä»¬åœ¨å­—ç¬¦ä¸²çš„å·¦è¾¹ç•Œçš„å·¦ä¾§ï¼Œè¿˜æ²¡æœ‰å¼€å§‹ç§»åŠ¨ let rk = -1, ans = 0; for (let i = 0; i &lt; n; ++i) &#123; if (i != 0) &#123; // å·¦æŒ‡é’ˆå‘å³ç§»åŠ¨ä¸€æ ¼ï¼Œç§»é™¤ä¸€ä¸ªå­—ç¬¦ occ.delete(s.charAt(i - 1)); &#125; while (rk + 1 &lt; n &amp;&amp; !occ.has(s.charAt(rk + 1))) &#123; // ä¸æ–­åœ°ç§»åŠ¨å³æŒ‡é’ˆ occ.add(s.charAt(rk + 1)); ++rk; &#125; // ç¬¬ i åˆ° rk ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªæé•¿çš„æ— é‡å¤å­—ç¬¦å­ä¸² ans = Math.max(ans, rk - i + 1); &#125; return ans;&#125;;","tags":["Javascript","ç®—æ³•","å“ˆå¸Œè¡¨","æ»‘åŠ¨çª—å£"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹äºŒå‰æœç´¢æ ‘çš„ä¼—æ•°","path":"/2021/06/20/ç®—æ³•ä¹‹äºŒå‰æœç´¢æ ‘çš„ä¼—æ•°/","content":"501. äºŒå‰æœç´¢æ ‘ä¸­çš„ä¼—æ•°ç»™å®šä¸€ä¸ªæœ‰ç›¸åŒå€¼çš„äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰ï¼Œæ‰¾å‡º BST ä¸­çš„æ‰€æœ‰ä¼—æ•°ï¼ˆå‡ºç°é¢‘ç‡æœ€é«˜çš„å…ƒç´ ï¼‰ã€‚ å‡å®š BST æœ‰å¦‚ä¸‹å®šä¹‰ï¼š ç»“ç‚¹å·¦å­æ ‘ä¸­æ‰€å«ç»“ç‚¹çš„å€¼å°äºç­‰äºå½“å‰ç»“ç‚¹çš„å€¼ã€ ç»“ç‚¹å³å­æ ‘ä¸­æ‰€å«ç»“ç‚¹çš„å€¼å¤§äºç­‰äºå½“å‰ç»“ç‚¹çš„å€¼ å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ˜¯äºŒå‰æœç´¢æ ‘ è§£æ³•ï¼š 1.é€’å½’ä¸­åºéå†ï¼ˆå¼€è¾Ÿæ–°ç©ºé—´ï¼‰ æ€è·¯ï¼š 1234567891011121314151617181920212223242526272829303132var findMode = function(root) &#123; let base = 0, count = 0, maxCount = 0; let answer = []; const update = (x) =&gt; &#123; if (x === base) &#123; ++count; &#125; else &#123; count = 1; base = x; &#125; if (count === maxCount) &#123; answer.push(base); &#125; if (count &gt; maxCount) &#123; maxCount = count; answer = [base]; &#125; &#125; const dfs = (o) =&gt; &#123; if (!o) &#123; return; &#125; dfs(o.left); update(o.val); dfs(o.right); &#125; dfs(root); return answer;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","äºŒå‰æ ‘","äºŒå‰æœç´¢æ ‘"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹æœ‰æ•ˆæ‹¬å·","path":"/2021/06/20/ç®—æ³•ä¹‹æœ‰æ•ˆæ‹¬å·/","content":"20. æœ‰æ•ˆçš„æ‹¬å·ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ â€˜(â€˜ï¼Œâ€™)â€™ï¼Œâ€™{â€˜ï¼Œâ€™}â€™ï¼Œâ€™[â€˜ï¼Œâ€™]â€™ çš„å­—ç¬¦ä¸² s ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚ æœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š å·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚ã€ å·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚ è§£æ³•ï¼š 1.åˆ©ç”¨æ ˆ æ€è·¯ï¼š æ ¹æ®é¢˜æ„ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºä»¥ä¸‹è¦ç‚¹ï¼š æœ‰æ•ˆæ‹¬å·å­—ç¬¦ä¸² é•¿åº¦ï¼Œä¸€å®šæ˜¯å¶æ•°ï¼ å³æ‹¬å·å‰é¢ï¼Œå¿…é¡»æ˜¯ç›¸å¯¹åº”çš„å·¦æ‹¬å·ï¼Œæ‰èƒ½æŠµæ¶ˆï¼ å³æ‹¬å·å‰é¢ï¼Œä¸æ˜¯å¯¹åº”çš„å·¦æ‹¬å·ï¼Œé‚£ä¹ˆè¯¥å­—ç¬¦ä¸²ï¼Œä¸€å®šä¸æ˜¯æœ‰æ•ˆçš„æ‹¬å·ï¼ 123456789101112131415161718192021222324252627282930313233/** * @param &#123;string&#125; s * @return &#123;boolean&#125; */let isValid = function (s) &#123; if (s.length % 2) &#123; return false; &#125; let stack = []; for (let item of s) &#123; switch (item) &#123; case &quot;&#123;&quot;: stack.push(item); break; case &quot;[&quot;: stack.push(item); break; case &quot;(&quot;: stack.push(item); break; case &quot;&#125;&quot;: if (stack.pop() !== &quot;&#123;&quot;) return false; break; case &quot;]&quot;: if (stack.pop() !== &quot;[&quot;) return false; break; case &quot;)&quot;: if (stack.pop() !== &quot;(&quot;) return false; break; &#125; &#125; return !stack.length;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","æ ˆ"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹äºŒå‰æ ‘çš„å‰ªæ","path":"/2021/06/20/ç®—æ³•ä¹‹äºŒå‰æ ‘çš„å‰ªæ/","content":"814. äºŒå‰æ ‘å‰ªæç»™å®šäºŒå‰æ ‘æ ¹ç»“ç‚¹ root ï¼Œæ­¤å¤–æ ‘çš„æ¯ä¸ªç»“ç‚¹çš„å€¼è¦ä¹ˆæ˜¯ 0ï¼Œè¦ä¹ˆæ˜¯ 1ã€‚ è¿”å›ç§»é™¤äº†æ‰€æœ‰ä¸åŒ…å« 1 çš„å­æ ‘çš„åŸäºŒå‰æ ‘ã€‚ ( èŠ‚ç‚¹ X çš„å­æ ‘ä¸º X æœ¬èº«ï¼Œä»¥åŠæ‰€æœ‰ X çš„åä»£ã€‚) è§£æ³•ï¼š 1.é€’å½’ æ€è·¯ï¼š é¦–å…ˆçœ‹ä»¥ä¸‹ä»€ä¹ˆæƒ…å†µä¼šç§»é™¤è¿™ä¸ªèŠ‚ç‚¹ï¼Œä¸¤ä¸ªæ¡ä»¶éƒ½å¿…é¡»æ»¡è¶³ è¿™ä¸ªèŠ‚ç‚¹ä¸º0 å¹¶ä¸”è¿™ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘èŠ‚ç‚¹ï¼Œè¦ä¹ˆå­æ ‘ä¸å­˜åœ¨ï¼Œè¦ä¹ˆå­æ ‘æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸º0ã€ æŒ‰ç…§ä¸Šé¢çš„ç‚¹å°±å¯ä»¥ä½¿ç”¨é€’å½’ï¼Œè¿™ä¸ªèŠ‚ç‚¹ç­‰äº0ï¼Œå¹¶ä¸”æ²¡æœ‰å·¦å³å­æ ‘çš„æƒ…å†µï¼Œåˆ é™¤è¿™ä¸ªèŠ‚ç‚¹ï¼Œ å°±è¿”å›nullè®©ä»–ç­‰äºçˆ¶èŠ‚ç‚¹å·¦æˆ–è€…å³å­æ ‘ æ‰€ä»¥æˆ‘ä»¬è¦å»èµ°äºŒå‰æ ‘çš„ååºéå†ï¼Œå·¦å³ä¸­ï¼Œ è¿™é¢˜çš„é‡ç‚¹å°±æ˜¯ä¸€å®šè¦èµ°ååºéå†ï¼Œå…ˆå»åˆ¤æ–­å·¦å³èŠ‚ç‚¹ 1234567891011121314151617181920212223242526272829303132/** * Definition for a binary tree node. * function TreeNode(val, left, right) &#123; * this.val = (val===undefined ? 0 : val) * this.left = (left===undefined ? null : left) * this.right = (right===undefined ? null : right) * &#125; *//** * @param &#123;TreeNode&#125; root * @return &#123;TreeNode&#125; */var pruneTree = function (root) &#123; if (!root) &#123; return root &#125; return getNode(root)&#125;;function getNode(node) &#123; if (node.left) &#123; node.left = getNode(node.left) &#125; if (node.right) &#123; node.right = getNode(node.right) &#125; if (!node.left &amp;&amp; !node.right &amp;&amp; node.val === 0) &#123; return null &#125; return node&#125;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","äºŒå‰æ ‘"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹é‡å»ºäºŒå‰æ ‘","path":"/2021/06/20/ç®—æ³•ä¹‹é‡å»ºäºŒå‰æ ‘/","content":"å‰‘æŒ‡ Offer 07. é‡å»ºäºŒå‰æ ‘è¾“å…¥æŸäºŒå‰æ ‘çš„å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœï¼Œè¯·é‡å»ºè¯¥äºŒå‰æ ‘ã€‚å‡è®¾è¾“å…¥çš„å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœä¸­éƒ½ä¸å«é‡å¤çš„æ•°å­—ã€‚ è§£æ³•ï¼š 1.é€’å½’ æ€è·¯ï¼š é€’å½’ï¼Œå…­å¥ä»£ç åŒ…å«ç€å¤§æ™ºæ…§ã€‚é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½å‰åºéå†å’Œä¸­åºéå†çš„èŠ‚ç‚¹éå†é¡ºåºã€‚å‰åºéå†ï¼šæ ¹-&gt;å·¦-&gt;å³ä¸­åºéå†ï¼šå·¦-&gt;æ ¹-&gt;å³ç»“åˆé¢˜ç›®çš„æ•°ç»„æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªä¿¡æ¯ï¼špreorderå¾—åˆ°çš„æ ¹èŠ‚ç‚¹ï¼Œåœ¨inorderä¸­çš„å®ƒçš„ä½ç½®ï¼Œå·¦ä¾§æ˜¯å·¦å­æ ‘ï¼Œå³ä¾§æ˜¯å³å­æ ‘è€Œåœ¨inorderè·å–çš„ç´¢å¼•å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ’åˆ†preorderæ•°ç»„äºæ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ’åˆ†æ•°ç»„çš„æ–¹å¼é€’å½’å¾—åˆ°å¶å­èŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡ä¸€æ­¥æ­¥çš„å›æº¯æŠŠå®ƒä»¬ç»„è£…èµ·æ¥ï¼Œå°±æ˜¯ä¸€æ£µå®Œæ•´çš„æ ‘ 1234567891011121314151617181920/** * Definition for a binary tree node. * function TreeNode(val) &#123; * this.val = val; * this.left = this.right = null; * &#125; *//** * @param &#123;number[]&#125; preorder * @param &#123;number[]&#125; inorder * @return &#123;TreeNode&#125; */var buildTree = function (preorder, inorder) &#123; if (preorder.length === 0) return null const cur = new TreeNode(preorder[0]) const index = inorder.indexOf(preorder[0]) cur.left = buildTree(preorder.slice(1, index + 1), inorder.slice(0, index)) cur.right = buildTree(preorder.slice(index + 1), inorder.slice(index + 1)) return cur&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","äºŒå‰æ ‘"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹éªŒè¯äºŒå‰æœç´¢æ ‘","path":"/2021/06/20/ç®—æ³•ä¹‹éªŒè¯äºŒå‰æœç´¢æ ‘/","content":"98. éªŒè¯äºŒå‰æœç´¢æ ‘ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„äºŒå‰æœç´¢æ ‘ã€‚ å‡è®¾ä¸€ä¸ªäºŒå‰æœç´¢æ ‘å…·æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š èŠ‚ç‚¹çš„å·¦å­æ ‘åªåŒ…å«å°äºå½“å‰èŠ‚ç‚¹çš„æ•°ã€‚ èŠ‚ç‚¹çš„å³å­æ ‘åªåŒ…å«å¤§äºå½“å‰èŠ‚ç‚¹çš„æ•°ã€‚ æ‰€æœ‰å·¦å­æ ‘å’Œå³å­æ ‘è‡ªèº«å¿…é¡»ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘ã€‚ è§£æ³•ï¼š 1.é€’å½’ æ€è·¯ï¼š æ ¹æ®äºŒå‰æœç´¢æ ‘çš„ç‰¹æ€§ï¼š ä¸­åºéå†çš„æ—¶å€™éå†çš„é¡ºåºæ˜¯ç”±å°åˆ°å¤§é€æ¸éå†çš„ï¼Œä¹Ÿå°±æ˜¯å‡åºæ’åˆ—ï¼Œ æ‰€ä»¥æˆ‘ä»¬ä¿å­˜ä¸Šä¸€ä¸ªå€¼prevï¼Œä¸å½“å‰å€¼currentä½œæ¯”è¾ƒã€‚ å¦‚æœå½“å‰å€¼å°äºç­‰äºä¸Šä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæ ‘ä¸æ˜¯äºŒå‰æœç´¢æ ‘ã€‚ 123456789101112131415161718192021222324252627282930/** * Definition for a binary tree node. * function TreeNode(val, left, right) &#123; * this.val = (val===undefined ? 0 : val) * this.left = (left===undefined ? null : left) * this.right = (right===undefined ? null : right) * &#125; *//** * @param &#123;TreeNode&#125; root * @return &#123;boolean&#125; */var isValidBST = function (node) &#123; var prev = -Infinity function inorder(node) &#123; if (!node) &#123; return true &#125; var preResult = inorder(node.left) var inResult = node.val &gt; prev prev = node.val var postResult = inorder(node.right) return preResult &amp;&amp; inResult &amp;&amp; postResult &#125; return inorder(node)&#125; 2.éé€’å½’ï¼ˆè¿­ä»£ï¼‰ 12345678910111213141516171819202122var isValidBST = function (node) &#123; var stack = [] var prev = -Infinity while(stack.length || node) &#123; while(node) &#123; stack.push(node) node = node.left &#125; node = stack.pop() if (node.val &lt;= prev) &#123; return false &#125; prev = node.val node = node.right &#125; return true&#125;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","äºŒå‰æ ‘","äºŒå‰æœç´¢æ ‘"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹äºŒå‰æ ‘çš„ç›´å¾„","path":"/2021/06/20/ç®—æ³•ä¹‹äºŒå‰æ ‘çš„ç›´å¾„/","content":"543. äºŒå‰æ ‘çš„ç›´å¾„ç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œä½ éœ€è¦è®¡ç®—å®ƒçš„ç›´å¾„é•¿åº¦ã€‚ä¸€æ£µäºŒå‰æ ‘çš„ç›´å¾„é•¿åº¦æ˜¯ä»»æ„ä¸¤ä¸ªç»“ç‚¹è·¯å¾„é•¿åº¦ä¸­çš„æœ€å¤§å€¼ã€‚è¿™æ¡è·¯å¾„å¯èƒ½ç©¿è¿‡ä¹Ÿå¯èƒ½ä¸ç©¿è¿‡æ ¹ç»“ç‚¹ã€‚ è§£æ³•ï¼š 1.DFSé€’å½’ æ€è·¯ï¼š æ—¢ç„¶æ˜¯æ±‚äºŒå‰æ ‘ä¸­ç›´å¾„é•¿åº¦æ˜¯ä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹ä¸­çš„æœ€å¤§è·¯å¾„å€¼ é‚£æˆ‘ä»¬ç›´æ¥æ±‚æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘æ·±åº¦ï¼Œç„¶åä¸€ä¸ªä¸ªèŠ‚ç‚¹è¿›è¡Œå·¦å³æ·±åº¦å’Œæ¯”è¾ƒå°±èƒ½æ‰¾å‡ºã€ 12345678910111213141516171819202122232425262728293031/** * Definition for a binary tree node. * function TreeNode(val, left, right) &#123; * this.val = (val===undefined ? 0 : val) * this.left = (left===undefined ? null : left) * this.right = (right===undefined ? null : right) * &#125; *//** * @param &#123;TreeNode&#125; root * @return &#123;number&#125; */var diameterOfBinaryTree = function (root) &#123; if (!root) &#123; return 0; &#125; function maxDepth(node) &#123; if (!node) &#123; return 0 &#125; let dep = 1; dep += Math.max(maxDepth(node.left), maxDepth(node.right)); return dep; &#125; return Math.max( maxDepth(root.left) + maxDepth(root.right), diameterOfBinaryTree(root.left), diameterOfBinaryTree(root.right) );&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","äºŒå‰æ ‘"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹åˆ é™¤äºŒå‰æ ‘ä¸­çš„èŠ‚ç‚¹","path":"/2021/06/19/ç®—æ³•ä¹‹åˆ é™¤äºŒå‰æ ‘ä¸­çš„èŠ‚ç‚¹/","content":"450. åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ root å’Œä¸€ä¸ªå€¼ keyï¼Œåˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„ key å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¹¶ä¿è¯äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ä¸å˜ã€‚è¿”å›äºŒå‰æœç´¢æ ‘ï¼ˆæœ‰å¯èƒ½è¢«æ›´æ–°ï¼‰çš„æ ¹èŠ‚ç‚¹çš„å¼•ç”¨ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œåˆ é™¤èŠ‚ç‚¹å¯åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š é¦–å…ˆæ‰¾åˆ°éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼› å¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ é™¤å®ƒ. è¯´æ˜ï¼š è¦æ±‚ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸º O(h)ï¼Œh ä¸ºæ ‘çš„é«˜åº¦ æ€è·¯ å› ä¸ºBSTçš„å·¦å­æ ‘æ€»æ˜¯æ¯”æ ¹èŠ‚ç‚¹å°ï¼Œå³å­æ ‘æ€»æ˜¯æ¯”æ ¹èŠ‚ç‚¹å¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æ ¹èŠ‚ç‚¹çš„å€¼ä¸è¦åˆ é™¤çš„ key å€¼å¯¹æ¯”ï¼Œå°±çŸ¥é“è¦åˆ é™¤çš„å€¼å¤§æ¦‚åœ¨å“ªä¸ªä½ç½®ï¼šâ€¢ ç›¸ç­‰ï¼šè¦åˆ é™¤çš„èŠ‚ç‚¹å°±æ˜¯å½“å‰æ ¹èŠ‚ç‚¹ï¼Œå³é€’å½’é€€å‡ºæ¡ä»¶â€¢ keyæ›´å¤§ï¼šåˆ™è¦é€’å½’æœå³å­æ ‘å»åˆ é™¤â€¢ keyæ›´å°ï¼šåˆ™è¦é€’å½’æœå·¦å­æ ‘å»åˆ é™¤æ‰¾åˆ°è¦åˆ é™¤åçš„èŠ‚ç‚¹ä¼šå‡ºç°å››ç§æƒ…å†µï¼šâ€¢ å¾…åˆ é™¤çš„èŠ‚ç‚¹å·¦å³å­æ ‘å‡ä¸ºç©ºã€‚è¯æ˜æ˜¯å¶å­èŠ‚ç‚¹ï¼Œç›´æ¥åˆ é™¤å³å¯ï¼Œå³å°†è¯¥èŠ‚ç‚¹ç½®ä¸ºnullâ€¢ å¾…åˆ é™¤çš„èŠ‚ç‚¹å·¦å­æ ‘ä¸ºç©ºï¼Œè®©å¾…åˆ é™¤èŠ‚ç‚¹çš„å³å­æ ‘æ›¿ä»£è‡ªå·±ã€‚ â€¢ å¾…åˆ é™¤çš„èŠ‚ç‚¹å³å­æ ‘ä¸ºç©ºï¼Œè®©å¾…åˆ é™¤èŠ‚ç‚¹çš„å·¦å­æ ‘æ›¿ä»£è‡ªå·±ã€‚ â€¢ å¦‚æœå¾…åˆ é™¤çš„èŠ‚ç‚¹çš„å·¦å³å­æ ‘éƒ½ä¸ä¸ºç©ºã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ¯”å½“å‰èŠ‚ç‚¹å°çš„æœ€å¤§èŠ‚ç‚¹ï¼ˆå‰é©±ï¼‰[æˆ–æ¯”å½“å‰èŠ‚ç‚¹å¤§çš„æœ€å°èŠ‚ç‚¹ï¼ˆåç»§ï¼‰]ï¼Œæ¥æ›¿æ¢è‡ªå·±. 12345678910111213141516171819202122232425262728293031323334const deleteNode = function (root, key) &#123; if (root == null) return root if (root.val &gt; key) &#123; // å¾€å·¦å­æ ‘æ‰¾ root.left = deleteNode(root.left, key) &#125; else if (root.val &lt; key) &#123; // å¾€å³å­æ ‘æ‰¾ root.right = deleteNode(root.right, key) &#125; else &#123; // æ‰¾åˆ°äº† if (!root.left &amp;&amp; !root.right) &#123; // å¾…åˆ é™¤çš„èŠ‚ç‚¹å·¦å³å­æ ‘å‡ä¸ºç©ºã€‚è¯æ˜æ˜¯å¶å­èŠ‚ç‚¹ï¼Œç›´æ¥åˆ é™¤å³å¯ root = null &#125; else if (root.left &amp;&amp; !root.right) &#123; // å¾…åˆ é™¤çš„èŠ‚ç‚¹å³å­æ ‘ä¸ºç©ºï¼Œè®©å¾…åˆ é™¤èŠ‚ç‚¹çš„å·¦å­æ ‘æ›¿ä»£è‡ªå·±ã€‚ root = root.left &#125; else if (!root.left &amp;&amp; root.right) &#123; // å¾…åˆ é™¤çš„èŠ‚ç‚¹å·¦å­æ ‘ä¸ºç©ºï¼Œè®©å¾…åˆ é™¤èŠ‚ç‚¹çš„å³å­æ ‘æ›¿ä»£è‡ªå·±ã€‚ root = root.right &#125; else if (root.left &amp;&amp; root.right) &#123; // å¦‚æœå¾…åˆ é™¤çš„èŠ‚ç‚¹çš„å·¦å³å­æ ‘éƒ½ä¸ä¸ºç©ºã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ¯”å½“å‰èŠ‚ç‚¹å°çš„æœ€å¤§èŠ‚ç‚¹ï¼ˆå‰é©±ï¼‰æ¥æ›¿æ¢è‡ªå·± let last = root.left while (last.right) &#123; last = last.left &#125; // æœ€ç»ˆçš„lastå°±æ˜¯æ¯”å½“å‰èŠ‚ç‚¹å°çš„æœ€å¤§èŠ‚ç‚¹ï¼Œå°†å€¼è¿›è¡Œæ›¿æ¢ root.val = last.val // åˆ é™¤è¯¥æœ€å¤§èŠ‚ç‚¹ root.left = deleteNode(root.left, last.val) &#125; &#125; return root&#125;","tags":["Javascript","é¢è¯•","ç®—æ³•","äºŒå‰æ ‘","äºŒå‰æœç´¢æ ‘"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹ä¿®å‰ªäºŒå‰æœç´¢æ ‘","path":"/2021/06/19/ç®—æ³•ä¹‹ä¿®å‰ªäºŒå‰æœç´¢æ ‘/","content":"669. ä¿®å‰ªäºŒå‰æœç´¢æ ‘ç»™ä½ äºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼ŒåŒæ—¶ç»™å®šæœ€å°è¾¹ç•Œlow å’Œæœ€å¤§è¾¹ç•Œ highã€‚é€šè¿‡ä¿®å‰ªäºŒå‰æœç´¢æ ‘ï¼Œä½¿å¾—æ‰€æœ‰èŠ‚ç‚¹çš„å€¼åœ¨[low, high]ä¸­ã€‚ä¿®å‰ªæ ‘ä¸åº”è¯¥æ”¹å˜ä¿ç•™åœ¨æ ‘ä¸­çš„å…ƒç´ çš„ç›¸å¯¹ç»“æ„ï¼ˆå³ï¼Œå¦‚æœæ²¡æœ‰è¢«ç§»é™¤ï¼ŒåŸæœ‰çš„çˆ¶ä»£å­ä»£å…³ç³»éƒ½åº”å½“ä¿ç•™ï¼‰ã€‚ å¯ä»¥è¯æ˜ï¼Œå­˜åœ¨å”¯ä¸€çš„ç­”æ¡ˆã€‚ æ‰€ä»¥ç»“æœåº”å½“è¿”å›ä¿®å‰ªå¥½çš„äºŒå‰æœç´¢æ ‘çš„æ–°çš„æ ¹èŠ‚ç‚¹ã€‚æ³¨æ„ï¼Œæ ¹èŠ‚ç‚¹å¯èƒ½ä¼šæ ¹æ®ç»™å®šçš„è¾¹ç•Œå‘ç”Ÿæ”¹å˜ã€‚ è§£æ³• 1.é€’å½’ æ€è·¯ ç»“åˆäºŒå‰æœç´¢æ ‘çš„ç‰¹ç‚¹ï¼ŒèŠ‚ç‚¹å€¼å¤§äºå®ƒçš„å·¦èŠ‚ç‚¹å¹¶ä¸”å°äºå®ƒçš„å³èŠ‚ç‚¹é‚£ä¹ˆï¼š å½“èŠ‚ç‚¹å€¼ &lt; L ï¼ŒæŠŠå®ƒçš„å·¦å­æ ‘æŠ›å¼ƒæ‰ï¼Œç»§ç»­ä¿®å‰ªå®ƒçš„å³å­æ ‘ å½“èŠ‚ç‚¹å€¼ &gt; R ï¼ŒæŠŠå®ƒçš„å³å­æ ‘æŠ›å¼ƒæ‰ï¼Œç»§ç»­ä¿®å‰ªå®ƒçš„å·¦å­æ ‘ å¦åˆ™å½“å‰èŠ‚ç‚¹å€¼æ»¡è¶³ L &lt; node.val &lt; R ï¼Œé‚£ä¹ˆå®ƒçš„å·¦å³å­æ ‘éƒ½æœ‰å¯èƒ½ä»ç„¶æœ‰ç¬¦åˆæ¡ä»¶ çš„èŠ‚ç‚¹å€¼ï¼Œæ‰€ä»¥è¦ç»§ç»­ä¿®å‰ªå·¦ã€å³å­æ ‘ 12345678910111213141516171819202122232425/** * Definition for a binary tree node. * function TreeNode(val) &#123; * this.val = val; * this.left = this.right = null; * &#125; *//** * @param &#123;TreeNode&#125; root * @param &#123;number&#125; L * @param &#123;number&#125; R * @return &#123;TreeNode&#125; */var trimBST = function(root, L, R) &#123; if (root === null) return root; if (root.val &lt; L) return trimBST(root.right, L, R); if (root.val &gt; R) return trimBST(root.left, L, R); root.left = trimBST(root.left, L, R); root.right = trimBST(root.right, L, R); return root;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","äºŒå‰æ ‘","äºŒå‰æœç´¢æ ‘"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ","path":"/2021/06/19/ç®—æ³•ä¹‹äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆI/","content":"å‰‘æŒ‡ Offer 68 - I. äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚ ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€ ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æœç´¢æ ‘: root = [6,2,8,0,4,7,9,null,null,3,5] å®ç° 1.é€’å½’ æ ¸å¿ƒæ€è·¯ï¼š 1. å½“ ä¼ å…¥çš„ç¥–å…ˆèŠ‚ç‚¹ åŒæ—¶å¤§äº/å°äº pã€qèŠ‚ç‚¹ æ›´æ–°ç¥–å…ˆèŠ‚ç‚¹ä½ç½® a. root åŒæ—¶å°äº pã€q åŸºäºBSTçš„ç‰¹æ€§å¯çŸ¥ æœŸæœ›çš„ç¥–å…ˆèŠ‚ç‚¹ åº”è¯¥åœ¨å³å­æ ‘ root = root.right b. root åŒæ—¶å¤§äº pã€q åŸºäºBSTçš„ç‰¹æ€§å¯çŸ¥ æœŸæœ›çš„ç¥–å…ˆèŠ‚ç‚¹ åº”è¯¥åœ¨å·¦å­æ ‘ root = root.left 2. å½“é‡åˆ°/ç¬¬ä¸€æ¬¡ ç¥–å…ˆèŠ‚ç‚¹root ä¸åŒæ—¶å¤§äºæˆ–å°äº pã€qçš„èŠ‚ç‚¹ å³ä¸ºæˆ‘æˆ‘ä»¬æœŸæœ›çš„æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹ 123456789101112131415161718192021222324/** * Definition for a binary tree node. * function TreeNode(val) &#123; * this.val = val; * this.left = this.right = null; * &#125; *//** * @param &#123;TreeNode&#125; root * @param &#123;TreeNode&#125; p * @param &#123;TreeNode&#125; q * @return &#123;TreeNode&#125; */var lowestCommonAncestor = function(root, p, q) &#123; if (!root) return root if (root.val &lt; p.val &amp;&amp; root.val &lt; q.val) &#123; return lowestCommonAncestor(root.right, p, q) &#125; else if (root.val &gt; p.val &amp;&amp; root.val &gt; q.val) &#123; return lowestCommonAncestor(root.left, p, q) &#125; else &#123; return root &#125;&#125;; 2.è¿­ä»£ åˆ©ç”¨äºŒå‰æœç´¢æ ‘çš„ç‰¹ç‚¹é¦–å…ˆåˆ¤æ–­ p å’Œ q æ˜¯å¦ç›¸ç­‰ï¼Œè‹¥ç›¸ç­‰ï¼Œåˆ™ç›´æ¥è¿”å› p æˆ– q ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œç¨‹åºç»“æŸ è‹¥ä¸ç›¸ç­‰ï¼Œåˆ™åˆ¤æ–­ p å’Œ q åœ¨å‘å·¦è¿˜æ˜¯å‘å³çš„é—®é¢˜ä¸Šï¼Œæ˜¯å¦è¾¾æˆäº†ä¸€è‡´å¦‚æœ p å’Œ q éƒ½å°äºroot, å“¥ä¿©ä¸€è‡´è®¤ä¸ºå‘å·¦ğŸ‘ˆï¼Œåˆ™ root = root.leftå¦‚æœ p å’Œ q éƒ½å¤§äºroot, å“¥ä¿©ä¸€è‡´è®¤ä¸ºå‘å³ğŸ‘‰ï¼Œåˆ™ root = root.rightå¦‚æœ p å’Œ q å“¥ä¿©å¯¹ä¸‹ä¸€æ­¥çš„è·¯çº¿å‡ºç°äº†åˆ†æ­§ï¼Œè¯´æ˜ p å’Œ q åœ¨å½“å‰çš„èŠ‚ç‚¹ä¸Šå°±è¦åˆ†é“æ‰¬é•³äº†ï¼Œå½“å‰çš„ root æ˜¯å“¥ä¿©ä¸´åˆ«å‰ä¸€èµ·èµ°çš„æœ€åä¸€ç«™è¿”å›å½“å‰ rootç¨‹åºç»“æŸ 123456789101112131415161718192021222324252627/** * Definition for a binary tree node. * function TreeNode(val) &#123; * this.val = val; * this.left = this.right = null; * &#125; *//** * @param &#123;TreeNode&#125; root * @param &#123;TreeNode&#125; p * @param &#123;TreeNode&#125; q * @return &#123;TreeNode&#125; */var lowestCommonAncestor = function (root, p, q) &#123; if (!root) &#123; return null &#125; while (root) &#123; if (root.val &lt; q.val &amp;&amp; root.val &lt; p.val) &#123; root = root.right &#125; else if (root.val &gt; q.val &amp;&amp; root.val &gt; p.val) &#123; root = root.left &#125; else &#123; return root &#125; &#125;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","äºŒå‰æ ‘","äºŒå‰æœç´¢æ ‘","äºŒå‰æ ‘å…¬å…±ç¥–å…ˆ"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹äºŒå‰æœç´ æ ‘èŒƒå›´å’Œ","path":"/2021/06/19/ç®—æ³•ä¹‹äºŒå‰æœç´ æ ‘èŒƒå›´å’Œ/","content":"938. äºŒå‰æœç´¢æ ‘çš„èŒƒå›´å’Œç»™å®šäºŒå‰æœç´¢æ ‘çš„æ ¹ç»“ç‚¹ rootï¼Œè¿”å›å€¼ä½äºèŒƒå›´ [low, high] ä¹‹é—´çš„æ‰€æœ‰ç»“ç‚¹çš„å€¼çš„å’Œã€‚ è§£æ³• 1.é€’å½’æ·±åº¦ä¼˜å…ˆæœç´¢ æŒ‰æ·±åº¦ä¼˜å…ˆæœç´¢çš„é¡ºåºè®¡ç®—èŒƒå›´å’Œã€‚è®°å½“å‰å­æ ‘æ ¹èŠ‚ç‚¹ä¸º rootï¼Œ åˆ†4ç§æƒ…å†µè®¨è®º rootèŠ‚ç‚¹ä¸ºç©ºï¼Œè¿”å›0 root.valå€¼å¤§äºhighçš„å€¼ï¼Œæ ¹æ®äºŒå‰æœç´¢æ ‘çš„æ€§è´¨çŸ¥é“ï¼Œåº”è¯¥æ­¤æ—¶å»æ‰¾rootçš„å·¦å­æ ‘ï¼Œæ— éœ€è€ƒè™‘å³å­æ ‘ root.valå€¼å°äºlowçš„å€¼ï¼Œæ ¹æ®äºŒå‰æœç´¢æ ‘çš„æ€§è´¨çŸ¥é“ï¼Œåº”è¯¥æ­¤æ—¶å»æ‰¾rootçš„å³å­æ ‘ï¼Œæ— éœ€è€ƒè™‘å·¦å­æ ‘ root.valå€¼å¿…é¡»åœ¨[low, high]èŒƒå›´å†… æœ€ç»ˆåº”è¯¥è¿”å›è¿™ä¸ªèŠ‚ç‚¹å€¼å’Œå·¦å³å­æ ‘å€¼çš„å’Œ 123456789101112var rangeSumBST = function(root, low, high) &#123; if (!root) &#123; return 0; &#125; if (root.val &gt; high) &#123; return rangeSumBST(root.left, low, high); &#125; if (root.val &lt; low) &#123; return rangeSumBST(root.right, low, high); &#125; return root.val + rangeSumBST(root.left, low, high) + rangeSumBST(root.right, low, high);&#125;; 2.è¿­ä»£ï¼ˆå¹¿åº¦ä¼˜å…ˆï¼‰ ä½¿ç”¨å¹¿åº¦ä¼˜å…ˆæœç´¢çš„æ–¹æ³•ï¼Œç”¨ä¸€ä¸ªé˜Ÿåˆ— q å­˜å‚¨éœ€è¦è®¡ç®—çš„èŠ‚ç‚¹ã€‚æ¯æ¬¡å–å‡ºé˜Ÿé¦–èŠ‚ç‚¹æ—¶ï¼Œè‹¥èŠ‚ç‚¹ä¸ºç©ºåˆ™è·³è¿‡è¯¥èŠ‚ç‚¹ï¼Œå¦åˆ™æŒ‰æ–¹æ³•ä¸€ä¸­ç»™å‡ºçš„å¤§å°å…³ç³»æ¥å†³å®šåŠ å…¥é˜Ÿåˆ—çš„å­èŠ‚ç‚¹ã€‚ 1234567891011121314151617181920var rangeSumBST = function(root, low, high) &#123; let sum = 0; const q = [root]; while (q.length) &#123; const node = q.shift(); if (!node) &#123; continue; &#125; if (node.val &gt; high) &#123; q.push(node.left); &#125; else if (node.val &lt; low) &#123; q.push(node.right); &#125; else &#123; sum += node.val; q.push(node.left); q.push(node.right); &#125; &#125; return sum;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","äºŒå‰æœç´ å“¦æ ‘","äºŒå‰æœç´¢æ ‘èŒƒå›´å’Œ"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹æœ€åä¸€å—çŸ³å¤´é‡é‡","path":"/2021/06/19/ç®—æ³•ä¹‹æœ€åä¸€å—çŸ³å¤´é‡é‡/","content":"1046. æœ€åä¸€å—çŸ³å¤´çš„é‡é‡æœ‰ä¸€å †çŸ³å¤´ï¼Œæ¯å—çŸ³å¤´çš„é‡é‡éƒ½æ˜¯æ­£æ•´æ•°ã€‚ æ¯ä¸€å›åˆï¼Œä»ä¸­é€‰å‡ºä¸¤å— æœ€é‡çš„ çŸ³å¤´ï¼Œç„¶åå°†å®ƒä»¬ä¸€èµ·ç²‰ç¢ã€‚å‡è®¾çŸ³å¤´çš„é‡é‡åˆ†åˆ«ä¸º x å’Œ yï¼Œä¸” x &lt;= yã€‚é‚£ä¹ˆç²‰ç¢çš„å¯èƒ½ç»“æœå¦‚ä¸‹ï¼š å¦‚æœ x == yï¼Œé‚£ä¹ˆä¸¤å—çŸ³å¤´éƒ½ä¼šè¢«å®Œå…¨ç²‰ç¢ï¼› å¦‚æœ x != yï¼Œé‚£ä¹ˆé‡é‡ä¸º x çš„çŸ³å¤´å°†ä¼šå®Œå…¨ç²‰ç¢ï¼Œè€Œé‡é‡ä¸º y çš„çŸ³å¤´æ–°é‡é‡ä¸º y-xã€‚ æœ€åï¼Œæœ€å¤šåªä¼šå‰©ä¸‹ä¸€å—çŸ³å¤´ã€‚è¿”å›æ­¤çŸ³å¤´çš„é‡é‡ã€‚å¦‚æœæ²¡æœ‰çŸ³å¤´å‰©ä¸‹ï¼Œå°±è¿”å› 0ã€‚ å®ç°ï¼š 1.éé€’å½’ æ’åºåæ¯”è¾ƒæœ€åé¢ä¸¤ä¸ª ä¸åŒå·®æ”¾æ•°ç»„ï¼Œé€’å½’ç›´è‡³è¾¹ç•Œæ•°ç»„é•¿åº¦ &lt;= 1 1234567891011121314151617181920212223/** * @param &#123;number[]&#125; stones * @return &#123;number&#125; */var lastStoneWeight = function (stones) &#123; if (stones.length &lt;= 1) &#123; return stones; &#125; stones.sort((a, b) =&gt; a - b); while (stones.length &gt; 1) &#123; const pre = stones.pop(); const next = stones.pop(); if (pre !== next) &#123; const temp = pre - next; let i = 0; while (stones[i] &lt; temp) &#123; i++; &#125; stones.splice(i, 0, temp); &#125; &#125; return stones.length ? stones[0] : 0;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","æ ˆ"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹åˆå¹¶äºŒå‰æ ‘","path":"/2021/06/19/ç®—æ³•ä¹‹åˆå¹¶äºŒå‰æ ‘/","content":"617. åˆå¹¶äºŒå‰æ ‘ç»™å®šä¸¤ä¸ªäºŒå‰æ ‘ï¼Œæƒ³è±¡å½“ä½ å°†å®ƒä»¬ä¸­çš„ä¸€ä¸ªè¦†ç›–åˆ°å¦ä¸€ä¸ªä¸Šæ—¶ï¼Œä¸¤ä¸ªäºŒå‰æ ‘çš„ä¸€äº›èŠ‚ç‚¹ä¾¿ä¼šé‡å ã€‚ ä½ éœ€è¦å°†ä»–ä»¬åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„äºŒå‰æ ‘ã€‚åˆå¹¶çš„è§„åˆ™æ˜¯å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹é‡å ï¼Œé‚£ä¹ˆå°†ä»–ä»¬çš„å€¼ç›¸åŠ ä½œä¸ºèŠ‚ç‚¹åˆå¹¶åçš„æ–°å€¼ï¼Œå¦åˆ™ä¸ä¸º NULL çš„èŠ‚ç‚¹å°†ç›´æ¥ä½œä¸ºæ–°äºŒå‰æ ‘çš„èŠ‚ç‚¹ã€‚ æ€è·¯ åŒæ­¥åœ°éå†ä¸¤æ£µæ ‘ä¸Šçš„èŠ‚ç‚¹ï¼Œç›´æ¥åœ¨ t1 ä¸Šä¿®æ”¹ã€‚ å¦‚æœæŠŠ mergeTrees å‡½æ•°ä½œä¸ºé€’å½’å‡½æ•°ï¼Œå‚æ•° t1 å’Œ t2 æ˜¯æŒ‡ï¼šå½“å‰éå†çš„èŠ‚ç‚¹ï¼ˆå­æ ‘ï¼‰ é€’å½’ã€‚æ€»æ˜¯å…³æ³¨å½“å‰èŠ‚ç‚¹t1 ä¸º null ã€t2 ä¸æ˜¯ nullï¼Œt1t1 æ¢æˆ t2 ã€‚ï¼ˆreturn t2ï¼‰t2 ä¸º nullã€t1t1 ä¸æ˜¯ nullï¼Œt1t1 ä¾ç„¶ t1 ã€‚ï¼ˆreturn t1ï¼‰ t1 å’Œ t2 éƒ½ä¸º nullï¼Œt1t1 ä¾ç„¶ t1ã€‚ï¼ˆreturn t1ï¼‰ t1ã€t2 éƒ½å­˜åœ¨ï¼Œå°† t2 çš„å€¼åŠ ç»™ t1 ã€‚ï¼ˆt1.val += t2.valï¼‰ ã€å­æ ‘çš„åˆå¹¶ã€äº¤ç»™é€’å½’å»åšï¼Œå®ƒä¼šå¯¹æ¯ä¸€ä¸ªèŠ‚ç‚¹åšåŒæ ·çš„äº‹æƒ…ã€‚ 12t1.left = mergeTrees(t1.left, t2.left);t1.right = mergeTrees(t1.right, t2.right); ä»£ç  1234567891011121314const mergeTrees = (t1, t2) =&gt; &#123; if (t1 == null &amp;&amp; t2) &#123; return t2; &#125; if ((t1 &amp;&amp; t2 == null) || (t1 == null &amp;&amp; t2 == null)) &#123; return t1; &#125; t1.val += t2.val; t1.left = mergeTrees(t1.left, t2.left); t1.right = mergeTrees(t1.right, t2.right); return t1;&#125;; å¦‚æœä¸åœ¨åŸæ ‘ä¿®æ”¹ï¼Œæ–°å»ºä¸€ä¸ªæ ‘å‘¢ï¼Ÿ1234567891011121314const mergeTrees = (t1, t2) =&gt; &#123; if (t1 == null &amp;&amp; t2) &#123; return t2; &#125; if ((t1 &amp;&amp; t2 == null) || (t1 == null &amp;&amp; t2 == null)) &#123; return t1; &#125; const root=new TreeNode(t1.val + t2.val) root.left = mergeTrees(t1.left, t2.left); root.right = mergeTrees(t1.right, t2.right); return root;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","äºŒå‰æ ‘","åˆå¹¶äºŒå‰æ ‘"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹å¹³è¡¡äºŒå‰æ ‘","path":"/2021/06/19/ç®—æ³•ä¹‹å¹³è¡¡äºŒå‰æ ‘/","content":"110. å¹³è¡¡äºŒå‰æ ‘ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦æ˜¯é«˜åº¦å¹³è¡¡çš„äºŒå‰æ ‘ã€‚ æœ¬é¢˜ä¸­ï¼Œä¸€æ£µé«˜åº¦å¹³è¡¡äºŒå‰æ ‘å®šä¹‰ä¸ºï¼š ä¸€ä¸ªäºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹ çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 1 ã€‚ åˆ†è§£å­é—®é¢˜ï¼šå½“å‰èŠ‚ç‚¹æ˜¯å¦æ˜¯å¹³è¡¡èŠ‚ç‚¹ï¼Œåˆ¤æ–­ä¾æ®ä¸ºï¼š å·¦å­æ ‘é«˜åº¦ä¸å³å­æ ‘é«˜åº¦ä¹‹å·®ä¸è¶…è¿‡1 å·¦èŠ‚ç‚¹æ˜¯å¹³è¡¡èŠ‚ç‚¹ å³èŠ‚ç‚¹æ˜¯å¹³è¡¡èŠ‚ç‚¹æœ‰äº†æ€è·¯ï¼Œä»£ç å°±å¾ˆç®€å•äº†ï¼Œå››è¡Œæå®š è¿™é‡Œå…¶ä¸­ä¹Ÿè¿ç”¨äº† åˆ¤æ–­äºŒå‰æ ‘çš„æ·±åº¦ çš„é€’å½’æ€æƒ³ 12345678910111213141516171819202122232425262728/** * Definition for a binary tree node. * function TreeNode(val, left, right) &#123; * this.val = (val===undefined ? 0 : val) * this.left = (left===undefined ? null : left) * this.right = (right===undefined ? null : right) * &#125; *//** * @param &#123;TreeNode&#125; root * @return &#123;boolean&#125; */var isBalanced = function (root) &#123; if (!root) &#123; return true; &#125; return isBalanced(root.left) &amp;&amp; isBalanced(root.right) &amp;&amp; Math.abs(getSum(root.left) - getSum(root.right)) &lt;= 1&#125;;function getSum(node) &#123; if (!node) &#123; return 0; &#125; let dep = 1; dep += Math.max(getSum(node.left), getSum(node.right)); return dep;&#125;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","äºŒå‰æ ‘","å¹³è¡¡äºŒå‰æ ‘"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹äºŒå‰æ ‘çš„æ·±åº¦","path":"/2021/06/19/ç®—æ³•ä¹‹äºŒå‰æ ‘çš„æ·±åº¦/","content":"å‰‘æŒ‡ Offer 55 - I. äºŒå‰æ ‘çš„æ·±åº¦ï¼ˆleecode 104ï¼‰è¾“å…¥ä¸€æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œæ±‚è¯¥æ ‘çš„æ·±åº¦ã€‚ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹ä¾æ¬¡ç»è¿‡çš„èŠ‚ç‚¹ï¼ˆå«æ ¹ã€å¶èŠ‚ç‚¹ï¼‰å½¢æˆæ ‘çš„ä¸€æ¡è·¯å¾„ï¼Œæœ€é•¿è·¯å¾„çš„é•¿åº¦ä¸ºæ ‘çš„æ·±åº¦ã€‚ ä¾‹å¦‚ï¼š ç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7]ï¼Œ 1.é€’å½’å®ç° æ€è·¯ï¼šåœ¨å­˜åœ¨èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡è®¾ç½®ä¸€ä¸ªèµ·å§‹æ·±åº¦1ï¼Œä¹‹åå»éå†ä»–çš„å·¦å­æ ‘å’Œå³å­æ ‘æ‰¾å‡ºæœ€å¤§å±‚çº§ï¼Œå°±åƒè¿™æ ·ä¸€ä¸ªä¸ªèŠ‚ç‚¹å»æ‰¾ 12345678910111213141516171819/** * Definition for a binary tree node. * function TreeNode(val) &#123; * this.val = val; * this.left = this.right = null; * &#125; *//** * @param &#123;TreeNode&#125; root * @return &#123;number&#125; */var maxDepth = function (root) &#123; if(!root)&#123; return 0 &#125;; let dep = 1; dep += Math.max(maxDepth(root.left), maxDepth(root.right)); return dep&#125;; 2.æ ˆè¿­ä»£å®ç° æ€è·¯ï¼š é€šè¿‡å‰åºéå†æˆ–è€…å…¶ä»–ä»€ä¹ˆéå†ï¼Œæ¯æ¬¡å‘æ ˆä¸­å­˜å‚¨ä¸€ä¸ªå¯¹è±¡ä¿å­˜èŠ‚ç‚¹ä»¥åŠä¸Šé¢éå†è¿‡çš„èŠ‚ç‚¹æ·±åº¦ï¼Œä¹‹åæ‹¿maxå€¼å’ŒèŠ‚ç‚¹æ·±åº¦å€¼åšMath.maxæ¯”è¾ƒï¼Œæ‰¾å‡ºæœ€å¤§çš„æ·±åº¦å°±è¡Œï¼Œé‡ç‚¹æ˜¯æ¯ä¸€æ¬¡éƒ½éœ€è¦å­˜æ·±åº¦ 12345678910111213141516171819202122232425262728/** * Definition for a binary tree node. * function TreeNode(val) &#123; * this.val = val; * this.left = this.right = null; * &#125; *//** * @param &#123;TreeNode&#125; root * @return &#123;number&#125; */var maxDepth = function(root) &#123; if (!root) return 0 let max = 0 const stack = [[root, 0]] while (stack.length) &#123; const [node, p] = stack.pop() max = Math.max(max, p + 1) node.left &amp;&amp; stack.push([node.left, p + 1]) node.right &amp;&amp; stack.push([node.right, p + 1]) &#125; return max&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","äºŒå‰æ ‘","äºŒå‰æ ‘æ·±åº¦"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹å¯¹ç§°äºŒå‰æ ‘","path":"/2021/06/19/ç®—æ³•ä¹‹å¯¹ç§°äºŒå‰æ ‘/","content":"å‰‘æŒ‡ Offer 28. å¯¹ç§°çš„äºŒå‰æ ‘è¯·å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥åˆ¤æ–­ä¸€æ£µäºŒå‰æ ‘æ˜¯ä¸æ˜¯å¯¹ç§°çš„ã€‚å¦‚æœä¸€æ£µäºŒå‰æ ‘å’Œå®ƒçš„é•œåƒä¸€æ ·ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¯¹ç§°çš„ã€‚ ä¾‹å¦‚ï¼ŒäºŒå‰æ ‘ [1,2,2,3,4,4,3] æ˜¯å¯¹ç§°çš„ã€‚ æ€è·¯ï¼š è¦æƒ³å®ç°å¯¹ç§°çš„äºŒå‰æ ‘éœ€è¦æ»¡è¶³ï¼š å®ç°ï¼š 123456789101112131415161718192021222324252627282930/** * Definition for a binary tree node. * function TreeNode(val) &#123; * this.val = val; * this.left = this.right = null; * &#125; *//** * @param &#123;TreeNode&#125; root * @return &#123;boolean&#125; */var isSymmetric = function (root) &#123; if (!root) &#123; return true &#125; return isEqual(root.left, root.right)&#125;;const isEqual = (left, right) =&gt; &#123; if (!left &amp;&amp; !right) &#123; return true &#125; if (!left || !right) &#123; return false &#125; if (left.val !== right.val) &#123; return false; &#125; return isEqual(left.left, right.right) &amp;&amp; isEqual(left.right, right.left);&#125;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","äºŒå‰æ ‘","å¯¹ç§°äºŒå‰æ ‘"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹äºŒå‰æ ‘å±‚åºéå†","path":"/2021/06/19/ç®—æ³•ä¹‹äºŒå‰æ ‘å±‚åºéå†/","content":"å‰‘æŒ‡ Offer 32 - II. ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘ IIä»ä¸Šåˆ°ä¸‹æŒ‰å±‚æ‰“å°äºŒå‰æ ‘ï¼ŒåŒä¸€å±‚çš„èŠ‚ç‚¹æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºæ‰“å°ï¼Œæ¯ä¸€å±‚æ‰“å°åˆ°ä¸€è¡Œã€‚ æ€è·¯ï¼š ç¨å¾®æ”¹å˜ä¸€ä¸‹å¯¹é˜Ÿåˆ—çš„ä½¿ç”¨ï¼Œå°±å¯ä»¥åœ¨éå†è¿‡ç¨‹ä¸­ä½“ç°å‡ºå±‚æ¬¡ï¼Œå¤§è‡´è¿‡ç¨‹å¦‚ä¸‹ï¼š åˆå§‹åŒ– queueï¼Œç”¨äºå­˜å‚¨å½“å‰å±‚çš„èŠ‚ç‚¹ æ£€æŸ¥ queue æ˜¯å¦ä¸ºç©º å¦‚æœä¸ä¸ºç©ºï¼šä¾æ¬¡éå†å½“å‰ queue å†…çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ£€æŸ¥æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­èŠ‚ç‚¹ï¼Œå°†ä¸ä¸ºç©ºçš„å­èŠ‚ç‚¹æ”¾å…¥ queueï¼Œç»§ç»­å¾ªç¯ å¦‚æœä¸ºç©ºï¼šè·³å‡ºå¾ªç¯ 123456789101112131415161718192021222324/** * @param &#123;TreeNode&#125; root * @return &#123;number[][]&#125; */var levelOrder = function(root) &#123; if (!root) return []; const queue = [root]; const res = []; // å­˜æ”¾éå†ç»“æœ let level = 0; // ä»£è¡¨å½“å‰å±‚æ•° while (queue.length) &#123; res[level] = []; // ç¬¬levelå±‚çš„éå†ç»“æœ // è¿™é‡Œä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ¯å±‚èŠ‚ç‚¹æ•°é‡éƒ½æ˜¯æ»¡çš„ã€‚ã€‚ã€‚ç„¶åå°±æ¯å±‚ä¹˜ä»¥2äº†ã€‚ã€‚ã€‚ let levelNum = queue.length; // ç¬¬levelå±‚çš„èŠ‚ç‚¹æ•°é‡ while (levelNum--) &#123; const front = queue.shift(); res[level].push(front.val); if (front.left) queue.push(front.left); if (front.right) queue.push(front.right); &#125; level++; &#125; return res;&#125;; æ€è·¯2ï¼šé€’å½’ 12345678910111213var levelOrder = function (root) &#123; let res = []; const traversal = (root, level = 0) =&gt; &#123; if (root) &#123; if (!res[level]) res[level] = []; res[level].push(root.val); traversal(root.left, level + 1) traversal(root.right, level + 1) &#125; &#125; traversal(root); return res;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","äºŒå‰æ ‘","äºŒå‰æ ‘å±‚åºéå†"],"categories":["ç®—æ³•"]},{"title":"æµ…æ‹·è´å’Œæ·±æ‹·è´","path":"/2021/06/17/æµ…æ‹·è´å’Œæ·±æ‹·è´/","content":"ä»€ä¹ˆæ˜¯æ‹·è´ï¼Ÿ123456let arr = [1, 2, 3];let newArr = arr;newArr[0] = 100;console.log(arr);//[100, 2, 3] è¿™æ˜¯ç›´æ¥èµ‹å€¼çš„æƒ…å†µï¼Œä¸æ¶‰åŠä»»ä½•æ‹·è´ã€‚å½“æ”¹å˜newArrçš„æ—¶å€™ï¼Œç”±äºæ˜¯åŒä¸€ä¸ªå¼•ç”¨ï¼ŒarræŒ‡å‘çš„å€¼ä¹Ÿè·Ÿç€æ”¹å˜ã€‚ æµ…æ‹·è´ä¸Šé¢çš„é‚£ä¸ªä¾‹å­è¿›è¡Œæµ…æ‹·è´ 123456let arr = [1, 2, 3];let newArr = arr.slice();newArr[0] = 100;console.log(arr);//[1, 2, 3] å½“ä¿®æ”¹newArrçš„æ—¶å€™ï¼Œarrçš„å€¼å¹¶ä¸æ”¹å˜ã€‚ä»€ä¹ˆåŸå› ?å› ä¸ºè¿™é‡ŒnewArræ˜¯arræµ…æ‹·è´åçš„ç»“æœï¼ŒnewArrå’Œarrç°åœ¨å¼•ç”¨çš„å·²ç»ä¸æ˜¯åŒä¸€å—ç©ºé—´ï¼ï¼ï¼ è¿™å°±æ˜¯æµ…æ‹·è´ï¼ ä½†æ˜¯è¿™åˆä¼šå¸¦æ¥ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜: 12345let arr = [1, 2, &#123;val: 4&#125;];let newArr = arr.slice();newArr[2].val = 1000;console.log(arr);//[ 1, 2, &#123; val: 1000 &#125; ] å’¦!ä¸æ˜¯å·²ç»ä¸æ˜¯åŒä¸€å—ç©ºé—´çš„å¼•ç”¨äº†å—ï¼Ÿä¸ºä»€ä¹ˆæ”¹å˜äº†newArræ”¹å˜äº†ç¬¬äºŒä¸ªå…ƒç´ çš„valå€¼ï¼Œarrä¹Ÿè·Ÿç€å˜äº†ã€‚ è¿™å°±æ˜¯æµ…æ‹·è´çš„é™åˆ¶æ‰€åœ¨äº†ã€‚å®ƒåªèƒ½æ‹·è´ä¸€å±‚å¯¹è±¡ã€‚å¦‚æœæœ‰å¯¹è±¡çš„åµŒå¥—ï¼Œé‚£ä¹ˆæµ…æ‹·è´å°†æ— èƒ½ä¸ºåŠ›ã€‚ä½†å¹¸è¿çš„æ˜¯ï¼Œæ·±æ‹·è´å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œç”Ÿçš„ï¼Œå®ƒèƒ½ è§£å†³æ— é™æçš„å¯¹è±¡åµŒå¥—é—®é¢˜ï¼Œå®ç°å½»åº•çš„æ‹·è´ã€‚å½“ç„¶ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸‹ä¸€ç¯‡çš„é‡ç‚¹ã€‚ ç°åœ¨å…ˆè®©å¤§å®¶æœ‰ä¸€ä¸ªåŸºæœ¬çš„æ¦‚å¿µã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹JSä¸­å®ç°æµ…æ‹·è´åˆ°åº•æœ‰å¤šå°‘ç§æ–¹å¼ï¼Ÿ æµ…æ‹·è´API1. Object.assignä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒObject.assgin() æ‹·è´çš„æ˜¯å¯¹è±¡çš„å±æ€§çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«ã€‚ 123let obj = &#123; name: &#x27;sy&#x27;, age: 18 &#125;;const obj2 = Object.assign(&#123;&#125;, obj, &#123;name: &#x27;sss&#x27;&#125;);console.log(obj2);//&#123; name: &#x27;sss&#x27;, age: 18 &#125; 2. concatæµ…æ‹·è´æ•°ç»„1234let arr = [1, 2, 3];let newArr = arr.concat();newArr[1] = 100;console.log(arr);//[ 1, 2, 3 ] 3. slice1234let arr = [1, 2, 3];let newArr = arr.slice();newArr[1] = 100;console.log(arr);//[ 1, 2, 3 ] 4. â€¦å±•å¼€è¿ç®—ç¬¦12let arr = [1, 2, 3];let newArr = [...arr];//è·Ÿarr.slice()æ˜¯ä¸€æ ·çš„æ•ˆæœ æ‰‹åŠ¨å®ç°æµ…æ‹·è´1234567891011121314const shallowClone = (target) =&gt; &#123; if (typeof target === &#x27;object&#x27; &amp;&amp; target !== null) &#123; const cloneTarget = Array.isArray(target) ? []: &#123;&#125;; for (let prop in target) &#123; if (target.hasOwnProperty(prop)) &#123; cloneTarget[prop] = target[prop]; &#125; &#125; return cloneTarget; &#125; else &#123; return target; &#125;&#125; æ·±æ‹·è´1. JSONä¸€å¥—ç»„åˆæ‹³1JSON.parse(JSON.stringify()); ä¼°è®¡è¿™ä¸ªapièƒ½è¦†ç›–å¤§å¤šæ•°çš„åº”ç”¨åœºæ™¯ï¼Œæ²¡é”™ï¼Œè°ˆåˆ°æ·±æ‹·è´ï¼Œæˆ‘ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„ä¹Ÿæ˜¯å®ƒã€‚ä½†æ˜¯å®é™…ä¸Šï¼Œå¯¹äºæŸäº›ä¸¥æ ¼çš„åœºæ™¯æ¥è¯´ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯æœ‰å·¨å¤§çš„å‘çš„ã€‚é—®é¢˜å¦‚ä¸‹ï¼š æ— æ³•è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚ä¸¾ä¸ªä¾‹å­ï¼š 12const a = &#123;val:2&#125;;a.target = a; æ‹·è´aä¼šå‡ºç°ç³»ç»Ÿæ ˆæº¢å‡ºï¼Œå› ä¸ºå‡ºç°äº†æ— é™é€’å½’çš„æƒ…å†µã€‚ æ— æ³•æ‹·è´ä¸€å†™ç‰¹æ®Šçš„å¯¹è±¡ï¼Œè¯¸å¦‚ RegExp, Date, Set, Mapç­‰ æ— æ³•æ‹·è´å‡½æ•°ï¼ˆåˆ’é‡ç‚¹ï¼‰ 2. ç®€å•å®ç°åªéœ€å°†ä¸Šé¢æ‰‹å†™çš„æµ…æ‹·è´éªšåšä¿®æ”¹ 12345678910111213function deepClone(target) &#123; if (typeof target === &quot;object&quot; &amp;&amp; target !== null) &#123; let temp = Array.isArray(target) ? [] : &#123;&#125;; for (const key in target) &#123; if (Object.hasOwnProperty.call(target, key)) &#123; const element = target[key]; temp[key] = deepClone(element); &#125; &#125; return temp; &#125; return target;&#125; 3. ç»†èŠ‚ä»¥åŠé—®é¢˜å¤„ç†æœ€ç»ˆå®ç°å¦‚ä¸Šæ‰€è¿°ï¼ŒJSON.parse(JSON.stringfy(obj))æœ‰ä¸‰ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ ¹æ®è¿™ä¸‰ä¸ªé—®é¢˜ä¸€ä¸ªä¸ªè§£å†³ 1.å¾ªç¯å¼•ç”¨é—®é¢˜è§£å†³å‡å¦‚æ˜¯è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œaå¯¹è±¡ä¸­çš„ä¸€ä¸ªå±æ€§æœ‰å¼•ç”¨äº†è‡ªå·± 123456const a = &#123; name: &quot;weng&quot;, age: 12,&#125;;a.target = a; è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªMapï¼Œè®°å½•ä¸‹å·²ç»æ‹·è´è¿‡äº†çš„å¯¹è±¡ï¼Œå¦‚æœå·²ç»æ‹·è´è¿‡äº†ï¼Œå°±ç›´æ¥è¿”å›è¿™ä¸ªå¯¹è±¡ 1234567891011121314151617181920function deepClone(target, map = new Map()) &#123; if (map.get(target)) &#123; return target; &#125; if ( (typeof target === &quot;object&quot; || typeof target === &quot;function&quot;) &amp;&amp; target !== null ) &#123; map.set(target, true); let temp = Array.isArray(target) ? [] : &#123;&#125;; for (const key in target) &#123; if (Object.hasOwnProperty.call(target, key)) &#123; const element = target[key]; temp[key] = deepClone(element, map); &#125; &#125; return temp; &#125; return target;&#125; å¥½äº†å’±ä»¬è¯•ä¸€ä¸‹ 12345678const a = &#123; name: &quot;weng&quot;, age: 12,&#125;;a.target = a;console.log(deepClone(a)); å¥½åƒæ˜¯æ²¡æœ‰é—®é¢˜äº†, æ‹·è´ä¹Ÿå®Œæˆäº†ã€‚ä½†è¿˜æ˜¯æœ‰ä¸€ä¸ªæ½œåœ¨çš„å‘, å°±æ˜¯map ä¸Šçš„ key å’Œ map æ„æˆäº†å¼ºå¼•ç”¨å…³ç³»ï¼Œè¿™æ˜¯ç›¸å½“å±é™©çš„ã€‚æˆ‘ç»™ä½ è§£é‡Šä¸€ä¸‹ä¸ä¹‹ç›¸å¯¹çš„å¼±å¼•ç”¨çš„æ¦‚å¿µä½ å°±æ˜ç™½äº†ï¼š åœ¨è®¡ç®—æœºç¨‹åºè®¾è®¡ä¸­ï¼Œå¼±å¼•ç”¨ä¸å¼ºå¼•ç”¨ç›¸å¯¹ï¼Œ æ˜¯æŒ‡ä¸èƒ½ç¡®ä¿å…¶å¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¼•ç”¨ã€‚ ä¸€ä¸ªå¯¹è±¡è‹¥åªè¢«å¼±å¼•ç”¨æ‰€å¼•ç”¨ï¼Œåˆ™è¢«è®¤ä¸ºæ˜¯ä¸å¯è®¿é—®ï¼ˆæˆ–å¼±å¯è®¿é—®ï¼‰çš„ï¼Œå¹¶å› æ­¤å¯èƒ½åœ¨ä»»ä½•æ—¶åˆ»è¢«å›æ”¶ã€‚ â€“ç™¾åº¦ç™¾ç§‘ è¯´çš„æœ‰ä¸€ç‚¹ç»•ï¼Œæˆ‘ç”¨å¤§ç™½è¯è§£é‡Šä¸€ä¸‹ï¼Œè¢«å¼±å¼•ç”¨çš„å¯¹è±¡å¯ä»¥åœ¨ä»»ä½•æ—¶å€™è¢«å›æ”¶ï¼Œè€Œå¯¹äºå¼ºå¼•ç”¨æ¥è¯´ï¼Œåªè¦è¿™ä¸ªå¼ºå¼•ç”¨è¿˜åœ¨ï¼Œé‚£ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶ã€‚æ‹¿ä¸Šé¢çš„ä¾‹å­è¯´ï¼Œmap å’Œ aä¸€ç›´æ˜¯å¼ºå¼•ç”¨çš„å…³ç³»ï¼Œ åœ¨ç¨‹åºç»“æŸä¹‹å‰ï¼Œa æ‰€å çš„å†…å­˜ç©ºé—´ä¸€ç›´ä¸ä¼šè¢«é‡Šæ”¾ã€‚ æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ å¾ˆç®€å•ï¼Œè®© map çš„ key å’Œ map æ„æˆå¼±å¼•ç”¨å³å¯ã€‚ES6ç»™æˆ‘ä»¬æä¾›äº†è¿™æ ·çš„æ•°æ®ç»“æ„ï¼Œå®ƒçš„åå­—å«WeakMapï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„Map, å…¶ä¸­çš„é”®æ˜¯å¼±å¼•ç”¨çš„ã€‚å…¶é”®å¿…é¡»æ˜¯å¯¹è±¡ï¼Œè€Œå€¼å¯ä»¥æ˜¯ä»»æ„çš„ã€‚ ç¨å¾®æ”¹é€ ä¸€ä¸‹å³å¯: 123function deepClone(target, map = new Map()) &#123; .....&#125; 2. ç‰¹æ®Šå¯¹è±¡çš„æ‹·è´å¯¹äºç‰¹æ®Šçš„å¯¹è±¡ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ¥é‰´åˆ«: 1Object.prototype.toString.call(obj); æ¢³ç†ä¸€ä¸‹å¯¹äºå¯éå†å¯¹è±¡ä¼šæœ‰ä»€ä¹ˆç»“æœï¼š 1234567&quot;object Map&quot;&quot;object WeakMap&quot;&quot;object Set&quot;&quot;object WeakSet&quot;&quot;object Array&quot;&quot;object Object&quot;&quot;object Arguments&quot; ä»¥åŠä¸å¯ä¾¿åˆ©çš„å¯¹è±¡ 12345678&quot;object Boolean&quot;&quot;object Symbol&quot;&quot;object Number&quot;&quot;object String&quot;&quot;object Date&quot;&quot;object Error&quot;&quot;object RegExp&quot;&quot;object Function&quot; å¯¹äºä¸åŒçš„å¯¹è±¡æœ‰ä¸åŒçš„å¤„ç†æ–¹æ¡ˆï¼Œä½†æ˜¯å¾ˆå¤šæ˜¯ç›¸äº’ç±»ä¼¼çš„ ä¹‹åæ”¹è¿›ä¹‹åçš„ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970function getType(target) &#123; return Object.prototype.toString.call(target);&#125;function isObject(target) &#123; return typeof target === &quot;object&quot; &amp;&amp; target !== null;&#125;function deepClone(target, map = new WeakMap()) &#123; if (!isObject(target)) &#123; return target; &#125; if (map.get(target)) &#123; return target; &#125; // è·å–targetæ˜¯Objectçš„å“ªç§è¡ç”Ÿç±»å‹ const targetType = getType(target); let cloneTarget; map.set(target, true); const structFn = Object.getPrototypeOf(target).constructor; switch (targetType) &#123; case &quot;[object RegExp]&quot;: const &#123; source, flags &#125; = target; cloneTarget = new structFn(source, flags); break; case &quot;[object Function]&quot;: // å‡½æ•°è¿™å—ç‹¬ç«‹å‡ºæ¥å¤„ç† break; case &quot;[object Map]&quot;: case &quot;[object WeakMap]&quot;: cloneTarget = new structFn(); target.forEach((value, key) =&gt; &#123; cloneTarget.set(deepClone(key), deepClone(value)); &#125;); break; case &quot;[object Set]&quot;: case &quot;[object WeakSet]&quot;: cloneTarget = new structFn(); target.forEach((value) =&gt; &#123; cloneTarget.add(deepClone(value)); &#125;); break; case &quot;[object Array]&quot;: case &quot;[object Object]&quot;: cloneTarget = new structFn(); for (const key in target) &#123; if (Object.hasOwnProperty.call(target, key)) &#123; const element = target[key]; cloneTarget[key] = deepClone(element, map); &#125; &#125; break; default: // case &quot;[object String]&quot;: // case &quot;[object Number]&quot;: // case &quot;[object Boolean]&quot;: // case &quot;[object Error]&quot;: // case &quot;[object Date]&quot;: cloneTarget = new structFn(Object.prototype.valueOf.call(target)); break; &#125; return cloneTarget;&#125; å…¶ä¸­è¿™è¡Œä»£ç const structFn = Object.getPrototypeOf(target).constructor;æ˜¯ä¸ºäº†è·å–è¡ç”Ÿå¯¹è±¡æˆ–è€…å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢ä¸¢å¤±åŸå‹çš„æƒ…å†µï¼Œä¹‹ååˆ©ç”¨æ„é€ å‡½æ•°å»æ•´æ´»ã€‚ 3. å¤„ç†å‡½æ•°ç±»å‹è™½ç„¶å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œä½†æ˜¯å®ƒè¿‡äºç‰¹æ®Šï¼Œæˆ‘ä»¬å•ç‹¬æŠŠå®ƒæ‹¿å‡ºæ¥æ‹†è§£ã€‚ æåˆ°å‡½æ•°ï¼Œåœ¨JSç§æœ‰ä¸¤ç§å‡½æ•°ï¼Œä¸€ç§æ˜¯æ™®é€šå‡½æ•°ï¼Œå¦ä¸€ç§æ˜¯ç®­å¤´å‡½æ•°ã€‚æ¯ä¸ªæ™®é€šå‡½æ•°éƒ½æ˜¯ Functionçš„å®ä¾‹ï¼Œè€Œç®­å¤´å‡½æ•°ä¸æ˜¯ä»»ä½•ç±»çš„å®ä¾‹ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½æ˜¯ä¸ä¸€æ ·çš„å¼•ç”¨ã€‚é‚£æˆ‘ä»¬åªéœ€è¦ å¤„ç†æ™®é€šå‡½æ•°çš„æƒ…å†µï¼Œç®­å¤´å‡½æ•°ç›´æ¥è¿”å›å®ƒæœ¬èº«å°±å¥½äº†ã€‚ é‚£ä¹ˆå¦‚ä½•æ¥åŒºåˆ†ä¸¤è€…å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯: åˆ©ç”¨åŸå‹ã€‚ç®­å¤´å‡½æ•°æ˜¯ä¸å­˜åœ¨åŸå‹çš„ã€‚ å¤„ç†ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718const handleFunc = (func) =&gt; &#123; // ç®­å¤´å‡½æ•°ç›´æ¥è¿”å›è‡ªèº« if(!func.prototype) return func; const bodyReg = /(?&lt;=&#123;)(.| )+(?=&#125;)/m; const paramReg = /(?&lt;=\\().+(?=\\)\\s+&#123;)/; const funcString = func.toString(); // åˆ†åˆ«åŒ¹é… å‡½æ•°å‚æ•° å’Œ å‡½æ•°ä½“ const param = paramReg.exec(funcString); const body = bodyReg.exec(funcString); if(!body) return null; if (param) &#123; const paramArr = param[0].split(&#x27;,&#x27;); return new Function(...paramArr, body[0]); &#125; else &#123; return new Function(body[0]); &#125;&#125; 4. ä¼˜åŒ–ä»£ç åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨å¤„ç†ä¸€äº›â€åŸºæœ¬ç±»å‹â€œå¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å»æ‹¿ä»–ä»¬çš„æ„é€ å‡½æ•°ï¼Œç„¶åç»™ä»–newå‡ºæ¥ï¼Œä½†æ˜¯ES6ä¸­ä¸æ¨èè¿™æ ·ç›´æ¥new String, æˆ–è€… new Numberçš„å†™æ³•ï¼Œå¹¶ä¸”Symbolç±»å‹æ˜¯æ— æ³•è¢«newæ“ä½œç¬¦è°ƒç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ”¹æˆ new Objectçš„å½¢å¼å¹¶ä¸”ä¼ ä»–ä»¬çš„valueå€¼ 1cloneTarget = new Object(Object.prototype.valueOf.call(target)); æœ€ç»ˆä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384 function getType(target) &#123; return Object.prototype.toString.call(target); &#125; function isObject(target) &#123; return typeof target === &quot;object&quot; &amp;&amp; target !== null; &#125; function deepClone(target, map = new WeakMap()) &#123; if (!isObject(target)) &#123; return target; &#125; if (map.get(target)) &#123; return target; &#125; // è·å–targetæ˜¯Objectçš„å“ªç§è¡ç”Ÿç±»å‹ const targetType = getType(target); let cloneTarget; map.set(target, true); const structFn = Object.getPrototypeOf(target).constructor; switch (targetType) &#123; case &quot;[object RegExp]&quot;: const &#123; source, flags &#125; = target; cloneTarget = new structFn(source, flags); break; case &quot;[object Function]&quot;: // å‡½æ•°è¿™å—ç‹¬ç«‹å‡ºæ¥å¤„ç† cloneTarget = handleFunc(target); break; case &quot;[object Map]&quot;: case &quot;[object WeakMap]&quot;: cloneTarget = new structFn(); target.forEach((value, key) =&gt; &#123; cloneTarget.set(deepClone(key), deepClone(value)); &#125;); break; case &quot;[object Set]&quot;: case &quot;[object WeakSet]&quot;: cloneTarget = new structFn(); target.forEach((value) =&gt; &#123; cloneTarget.add(deepClone(value)); &#125;); break; case &quot;[object Array]&quot;: case &quot;[object Object]&quot;: cloneTarget = new structFn(); for (const key in target) &#123; if (Object.hasOwnProperty.call(target, key)) &#123; const element = target[key]; cloneTarget[key] = deepClone(element, map); &#125; &#125; break; default: cloneTarget = new Object(Object.prototype.valueOf.call(target)); break; &#125; return cloneTarget; &#125;const handleFunc = (func) =&gt; &#123; // ç®­å¤´å‡½æ•°ç›´æ¥è¿”å›è‡ªèº« if(!func.prototype) return func; const bodyReg = /(?&lt;=&#123;)(.| )+(?=&#125;)/m; const paramReg = /(?&lt;=\\().+(?=\\)\\s+&#123;)/; const funcString = func.toString(); // åˆ†åˆ«åŒ¹é… å‡½æ•°å‚æ•° å’Œ å‡½æ•°ä½“ const param = paramReg.exec(funcString); const body = bodyReg.exec(funcString); if(!body) return null; if (param) &#123; const paramArr = param[0].split(&#x27;,&#x27;); return new Function(...paramArr, body[0]); &#125; else &#123; return new Function(body[0]); &#125;&#125;","tags":["Javascript","é¢è¯•é¢˜","æ·±æ‹·è´ä¸æµ…æ‹·è´"],"categories":["Javascript"]},{"title":"æ•°ç»„æ‰å¹³åŒ–","path":"/2021/06/16/æ•°ç»„æ‰å¹³åŒ–/","content":"å¯¹äºå‰ç«¯é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¶å°”ä¼šå‡ºç°å±‚å æ•°æ®ç»“æ„çš„æ•°ç»„ï¼Œæˆ‘ä»¬éœ€è¦å°†å¤šå±‚çº§æ•°ç»„è½¬åŒ–ä¸ºä¸€çº§æ•°ç»„ï¼ˆå³æå–åµŒå¥—æ•°ç»„å…ƒç´ æœ€ç»ˆåˆå¹¶ä¸ºä¸€ä¸ªæ•°ç»„ï¼‰ï¼Œä½¿å…¶å†…å®¹åˆå¹¶ä¸”å±•å¼€ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•å»å®ç°å‘¢ï¼Ÿ éœ€æ±‚:å¤šç»´æ•°ç»„=&gt;ä¸€ç»´æ•°ç»„ 123let ary = [1, [2, [3, [4, 5]]], 6];// -&gt; [1, 2, 3, 4, 5, 6]let str = JSON.stringify(ary); 1. è°ƒç”¨ES6ä¸­çš„flatæ–¹æ³•12ary = ary.flat(Infinity); 2. replace + split12ary = str.replace(/(\\[|\\])/g, &#x27;&#x27;).split(&#x27;,&#x27;) 3. replace + JSON.parse1234str = str.replace(/(\\[|\\])/g, &#x27;&#x27;);str = &#x27;[&#x27; + str + &#x27;]&#x27;;ary = JSON.parse(str); 4. æ™®é€šé€’å½’123456789101112let result = [];let fn = function(ary) &#123; for(let i = 0; i &lt; ary.length; i++) &#123; let item = ary[i]; if (Array.isArray(ary[i]))&#123; fn(item); &#125; else &#123; result.push(item); &#125; &#125;&#125; 5. åˆ©ç”¨reduceå‡½æ•°è¿­ä»£1234567function flatten(ary) &#123; return ary.reduce((pre, cur) =&gt; &#123; return pre.concat(Array.isArray(cur) ? flatten(cur) : cur); &#125;, []);&#125;let ary = [1, 2, [3, 4], [5, [6, 7]]]console.log(flatten(ary)) 6ï¼šæ‰©å±•è¿ç®—ç¬¦1234//åªè¦æœ‰ä¸€ä¸ªå…ƒç´ æœ‰æ•°ç»„ï¼Œé‚£ä¹ˆå¾ªç¯ç»§ç»­while (ary.some(Array.isArray)) &#123; ary = [].concat(...ary);&#125;","tags":["Javascript","é¢è¯•é¢˜","æ•°ç»„æ‰å¹³åŒ–"],"categories":["Javascript"]},{"title":"forEachä¸­æ€ä¹ˆè·³å‡ºå¾ªç¯","path":"/2021/06/16/foreachä¸­æ€ä¹ˆè·³å‡ºå¾ªç¯/","content":"æ€»æ‰€å‘¨çŸ¥ï¼šforEachæ˜¯ä¸å¯ä»¥è·³å‡ºå¾ªç¯çš„ï¼Œæ‰€ä»¥åº”è¯¥æƒ³åŠæ³•ç»™ä»–è·³å‡ºå» 1. forEachä¸­å†™try catch ä½¿ç”¨tryç›‘è§†ä»£ç å—ï¼Œåœ¨éœ€è¦ä¸­æ–­çš„åœ°æ–¹æŠ›å‡ºå¼‚å¸¸ã€‚ 123456789101112let arr = [1, 2, 3, 4, 5, 6, 7, 8, 9]; arr.forEach((value) =&gt; &#123; try &#123; if (!(value % 2)) &#123; throw &#x27;&#x27;; &#125; else &#123; console.log(value); &#125; &#125; catch (error) &#123; throw error &#125;&#125;); 2. æ›¿æ¢æ–¹æ³•ï¼ˆä½¿ç”¨everyæˆ–è€…someæ›¿æ¢ï¼‰å®˜æ–¹æ¨èæ–¹æ³•ï¼ˆæ›¿æ¢æ–¹æ³•ï¼‰ï¼šç”¨everyå’Œsomeæ›¿ä»£forEachå‡½æ•°ã€‚everyåœ¨ç¢°åˆ°return falseçš„æ—¶å€™ï¼Œä¸­æ­¢å¾ªç¯ã€‚someåœ¨ç¢°åˆ°return trueçš„æ—¶å€™ï¼Œä¸­æ­¢å¾ªç¯ 12345678let arr = [1, 2, 3, 4, 5, 6, 7, 8, 9]; arr.some((item) =&gt; &#123; if (item % 2) &#123; console.log(item); return false; &#125; return true;&#125;); 12345678let arr = [1, 2, 3, 4, 5, 6, 7, 8, 9]; arr.every((item) =&gt; &#123; if (item % 2) &#123; console.log(item); return true; &#125; return false;&#125;);","tags":["Javascript","forEach","trycatch"],"categories":["Javascript"]},{"title":"åƒåœ¾å›æ”¶ä¸å†…å­˜æ³„æ¼","path":"/2021/06/15/åƒåœ¾å›æ”¶ä¸å†…å­˜æ³„æ¼/","content":"1. æµè§ˆå™¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆ1ï¼‰åƒåœ¾å›æ”¶çš„æ¦‚å¿µåƒåœ¾å›æ”¶ï¼šJavaScriptä»£ç è¿è¡Œæ—¶ï¼Œéœ€è¦åˆ†é…å†…å­˜ç©ºé—´æ¥å‚¨å­˜å˜é‡å’Œå€¼ã€‚å½“å˜é‡ä¸åœ¨å‚ä¸è¿è¡Œæ—¶ï¼Œå°±éœ€è¦ç³»ç»Ÿæ”¶å›è¢«å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œè¿™å°±æ˜¯åƒåœ¾å›æ”¶ã€‚ å›æ”¶æœºåˆ¶ï¼š Javascript å…·æœ‰è‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä¼šå®šæœŸå¯¹é‚£äº›ä¸å†ä½¿ç”¨çš„å˜é‡ã€å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜è¿›è¡Œé‡Šæ”¾ï¼ŒåŸç†å°±æ˜¯æ‰¾åˆ°ä¸å†ä½¿ç”¨çš„å˜é‡ï¼Œç„¶åé‡Šæ”¾æ‰å…¶å ç”¨çš„å†…å­˜ã€‚ JavaScriptä¸­å­˜åœ¨ä¸¤ç§å˜é‡ï¼šå±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡ã€‚å…¨å±€å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¼šæŒç»­è¦é¡µé¢å¸è½½ï¼›è€Œå±€éƒ¨å˜é‡å£°æ˜åœ¨å‡½æ•°ä¸­ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä»å‡½æ•°æ‰§è¡Œå¼€å§‹ï¼Œç›´åˆ°å‡½æ•°æ‰§è¡Œç»“æŸï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå±€éƒ¨å˜é‡ä¼šåœ¨å †æˆ–æ ˆä¸­å­˜å‚¨å®ƒä»¬çš„å€¼ï¼Œå½“å‡½æ•°æ‰§è¡Œç»“æŸåï¼Œè¿™äº›å±€éƒ¨å˜é‡ä¸å†è¢«ä½¿ç”¨ï¼Œå®ƒä»¬æ‰€å æœ‰çš„ç©ºé—´å°±ä¼šè¢«é‡Šæ”¾ã€‚ ä¸è¿‡ï¼Œå½“å±€éƒ¨å˜é‡è¢«å¤–éƒ¨å‡½æ•°ä½¿ç”¨æ—¶ï¼Œå…¶ä¸­ä¸€ç§æƒ…å†µå°±æ˜¯é—­åŒ…ï¼Œåœ¨å‡½æ•°æ‰§è¡Œç»“æŸåï¼Œå‡½æ•°å¤–éƒ¨çš„å˜é‡ä¾ç„¶æŒ‡å‘å‡½æ•°å†…éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œæ­¤æ—¶å±€éƒ¨å˜é‡ä¾ç„¶åœ¨è¢«ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸ä¼šå›æ”¶ã€‚ ï¼ˆ2ï¼‰åƒåœ¾å›æ”¶çš„æ–¹å¼æµè§ˆå™¨é€šå¸¸ä½¿ç”¨çš„åƒåœ¾å›æ”¶æ–¹æ³•æœ‰ä¸¤ç§ï¼šæ ‡è®°æ¸…é™¤ï¼Œå¼•ç”¨è®¡æ•°ã€‚ 1ï¼‰æ ‡è®°æ¸…é™¤ æ ‡è®°æ¸…é™¤æ˜¯æµè§ˆå™¨å¸¸è§çš„åƒåœ¾å›æ”¶æ–¹å¼ï¼Œå½“å˜é‡è¿›å…¥æ‰§è¡Œç¯å¢ƒæ—¶ï¼Œå°±æ ‡è®°è¿™ä¸ªå˜é‡â€œè¿›å…¥ç¯å¢ƒâ€ï¼Œè¢«æ ‡è®°ä¸ºâ€œè¿›å…¥ç¯å¢ƒâ€çš„å˜é‡æ˜¯ä¸èƒ½è¢«å›æ”¶çš„ï¼Œå› ä¸ºä»–ä»¬æ­£åœ¨è¢«ä½¿ç”¨ã€‚å½“å˜é‡ç¦»å¼€ç¯å¢ƒæ—¶ï¼Œå°±ä¼šè¢«æ ‡è®°ä¸ºâ€œç¦»å¼€ç¯å¢ƒâ€ï¼Œè¢«æ ‡è®°ä¸ºâ€œç¦»å¼€ç¯å¢ƒâ€çš„å˜é‡ä¼šè¢«å†…å­˜é‡Šæ”¾ã€‚ åƒåœ¾æ”¶é›†å™¨åœ¨è¿è¡Œçš„æ—¶å€™ä¼šç»™å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ‰€æœ‰å˜é‡éƒ½åŠ ä¸Šæ ‡è®°ã€‚ç„¶åï¼Œå®ƒä¼šå»æ‰ç¯å¢ƒä¸­çš„å˜é‡ä»¥åŠè¢«ç¯å¢ƒä¸­çš„å˜é‡å¼•ç”¨çš„æ ‡è®°ã€‚è€Œåœ¨æ­¤ä¹‹åå†è¢«åŠ ä¸Šæ ‡è®°çš„å˜é‡å°†è¢«è§†ä¸ºå‡†å¤‡åˆ é™¤çš„å˜é‡ï¼ŒåŸå› æ˜¯ç¯å¢ƒä¸­çš„å˜é‡å·²ç»æ— æ³•è®¿é—®åˆ°è¿™äº›å˜é‡äº†ã€‚æœ€åã€‚åƒåœ¾æ”¶é›†å™¨å®Œæˆå†…å­˜æ¸…é™¤å·¥ä½œï¼Œé”€æ¯é‚£äº›å¸¦æ ‡è®°çš„å€¼ï¼Œå¹¶å›æ”¶ä»–ä»¬æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ã€‚ 2ï¼‰å¼•ç”¨è®¡æ•° å¦å¤–ä¸€ç§åƒåœ¾å›æ”¶æœºåˆ¶å°±æ˜¯å¼•ç”¨è®¡æ•°ï¼Œè¿™ä¸ªç”¨çš„ç›¸å¯¹è¾ƒå°‘ã€‚å¼•ç”¨è®¡æ•°å°±æ˜¯è·Ÿè¸ªè®°å½•æ¯ä¸ªå€¼è¢«å¼•ç”¨çš„æ¬¡æ•°ã€‚å½“å£°æ˜äº†ä¸€ä¸ªå˜é‡å¹¶å°†ä¸€ä¸ªå¼•ç”¨ç±»å‹èµ‹å€¼ç»™è¯¥å˜é‡æ—¶ï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å°±æ˜¯1ã€‚ç›¸åï¼Œå¦‚æœåŒ…å«å¯¹è¿™ä¸ªå€¼å¼•ç”¨çš„å˜é‡åˆå–å¾—äº†å¦å¤–ä¸€ä¸ªå€¼ï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å°±å‡1ã€‚å½“è¿™ä¸ªå¼•ç”¨æ¬¡æ•°å˜ä¸º0æ—¶ï¼Œè¯´æ˜è¿™ä¸ªå˜é‡å·²ç»æ²¡æœ‰ä»·å€¼ï¼Œå› æ­¤ï¼Œåœ¨åœ¨æœºå›æ”¶æœŸä¸‹æ¬¡å†è¿è¡Œæ—¶ï¼Œè¿™ä¸ªå˜é‡æ‰€å æœ‰çš„å†…å­˜ç©ºé—´å°±ä¼šè¢«é‡Šæ”¾å‡ºæ¥ã€‚ è¿™ç§æ–¹æ³•ä¼šå¼•èµ·å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼šä¾‹å¦‚ï¼šobj1å’Œobj2é€šè¿‡å±æ€§è¿›è¡Œç›¸äº’å¼•ç”¨ï¼Œä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°éƒ½æ˜¯2ã€‚å½“ä½¿ç”¨å¾ªç¯è®¡æ•°æ—¶ï¼Œç”±äºå‡½æ•°æ‰§è¡Œå®Œåï¼Œä¸¤ä¸ªå¯¹è±¡éƒ½ç¦»å¼€ä½œç”¨åŸŸï¼Œå‡½æ•°æ‰§è¡Œç»“æŸï¼Œobj1å’Œobj2è¿˜å°†ä¼šç»§ç»­å­˜åœ¨ï¼Œå› æ­¤å®ƒä»¬çš„å¼•ç”¨æ¬¡æ•°æ°¸è¿œä¸ä¼šæ˜¯0ï¼Œå°±ä¼šå¼•èµ·å¾ªç¯å¼•ç”¨ã€‚ 1234567function fun() &#123; let obj1 = &#123;&#125;; let obj2 = &#123;&#125;; obj1.a = obj2; // obj1 å¼•ç”¨ obj2 obj2.a = obj1; // obj2 å¼•ç”¨ obj1&#125;å¤åˆ¶ä»£ç  è¿™ç§æƒ…å†µä¸‹ï¼Œå°±è¦æ‰‹åŠ¨é‡Šæ”¾å˜é‡å ç”¨çš„å†…å­˜ï¼š 123obj1.a = null obj2.a = nullå¤åˆ¶ä»£ç  ï¼ˆ3ï¼‰å‡å°‘åƒåœ¾å›æ”¶è™½ç„¶æµè§ˆå™¨å¯ä»¥è¿›è¡Œåƒåœ¾è‡ªåŠ¨å›æ”¶ï¼Œä½†æ˜¯å½“ä»£ç æ¯”è¾ƒå¤æ‚æ—¶ï¼Œåƒåœ¾å›æ”¶æ‰€å¸¦æ¥çš„ä»£ä»·æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥åº”è¯¥å°½é‡å‡å°‘åƒåœ¾å›æ”¶ã€‚ å¯¹æ•°ç»„è¿›è¡Œä¼˜åŒ–ï¼š åœ¨æ¸…ç©ºä¸€ä¸ªæ•°ç»„æ—¶ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ç»™å…¶èµ‹å€¼ä¸º[ ]ï¼Œä½†æ˜¯ä¸æ­¤åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºå¯¹è±¡ï¼Œå¯ä»¥å°†æ•°ç»„çš„é•¿åº¦è®¾ç½®ä¸º0ï¼Œä»¥æ­¤æ¥è¾¾åˆ°æ¸…ç©ºæ•°ç»„çš„ç›®çš„ã€‚ å¯¹objectè¿›è¡Œä¼˜åŒ–ï¼š å¯¹è±¡å°½é‡å¤ç”¨ï¼Œå¯¹äºä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œå°±å°†å…¶è®¾ç½®ä¸ºnullï¼Œå°½å¿«è¢«å›æ”¶ã€‚ å¯¹å‡½æ•°è¿›è¡Œä¼˜åŒ–ï¼š åœ¨å¾ªç¯ä¸­çš„å‡½æ•°è¡¨è¾¾å¼ï¼Œå¦‚æœå¯ä»¥å¤ç”¨ï¼Œå°½é‡æ”¾åœ¨å‡½æ•°çš„å¤–é¢ã€‚ 2. å“ªäº›æƒ…å†µä¼šå¯¼è‡´å†…å­˜æ³„æ¼ä»¥ä¸‹å››ç§æƒ…å†µä¼šé€ æˆå†…å­˜çš„æ³„æ¼ï¼š æ„å¤–çš„å…¨å±€å˜é‡ï¼š ç”±äºä½¿ç”¨æœªå£°æ˜çš„å˜é‡ï¼Œè€Œæ„å¤–çš„åˆ›å»ºäº†ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè€Œä½¿è¿™ä¸ªå˜é‡ä¸€ç›´ç•™åœ¨å†…å­˜ä¸­æ— æ³•è¢«å›æ”¶ã€‚ è¢«é—å¿˜çš„è®¡æ—¶å™¨æˆ–å›è°ƒå‡½æ•°ï¼š è®¾ç½®äº† setInterval å®šæ—¶å™¨ï¼Œè€Œå¿˜è®°å–æ¶ˆå®ƒï¼Œå¦‚æœå¾ªç¯å‡½æ•°æœ‰å¯¹å¤–éƒ¨å˜é‡çš„å¼•ç”¨çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡ä¼šè¢«ä¸€ç›´ç•™åœ¨å†…å­˜ä¸­ï¼Œè€Œæ— æ³•è¢«å›æ”¶ã€‚ è„±ç¦» DOM çš„å¼•ç”¨ï¼š è·å–ä¸€ä¸ª DOM å…ƒç´ çš„å¼•ç”¨ï¼Œè€Œåé¢è¿™ä¸ªå…ƒç´ è¢«åˆ é™¤ï¼Œç”±äºä¸€ç›´ä¿ç•™äº†å¯¹è¿™ä¸ªå…ƒç´ çš„å¼•ç”¨ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ— æ³•è¢«å›æ”¶ã€‚ é—­åŒ…ï¼š ä¸åˆç†çš„ä½¿ç”¨é—­åŒ…ï¼Œä»è€Œå¯¼è‡´æŸäº›å˜é‡ä¸€ç›´è¢«ç•™åœ¨å†…å­˜å½“ä¸­ä½œè€…ï¼šCUGGZé“¾æ¥ï¼šhttps://juejin.cn/post/6941194115392634888æ¥æºï¼šæ˜é‡‘è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚","tags":["Javascript","åƒåœ¾å›æ”¶æœºåˆ¶"],"categories":["Javascript"]},{"title":"Proxyä»£ç†åº”ç”¨åœºæ™¯","path":"/2021/06/15/Proxyä»£ç†åº”ç”¨åœºæ™¯/","content":"Proxy ä½¿ç”¨åœºæ™¯1 å¢å¼ºå‹æ•°ç»„å®šä¹‰ enhancedArray å‡½æ•°1234567891011121314151617181920212223242526272829function enhancedArray(arr) &#123; return new Proxy(arr, &#123; get(target, property, receiver) &#123; const range = getRange(property); const indices = range ? range : getIndices(property); const values = indices.map(function (index) &#123; const key = index &lt; 0 ? String(target.length + index) : index; return Reflect.get(target, key, receiver); &#125;); return values.length === 1 ? values[0] : values; &#125;, &#125;); function getRange(str) &#123; var [start, end] = str.split(&quot;:&quot;).map(Number); if (typeof end === &quot;undefined&quot;) return false; let range = []; for (let i = start; i &lt; end; i++) &#123; range = range.concat(i); &#125; return range; &#125; function getIndices(str) &#123; return str.split(&quot;,&quot;).map(Number); &#125;&#125;å¤åˆ¶ä»£ç  ä½¿ç”¨ enhancedArray å‡½æ•°12345678const arr = enhancedArray([1, 2, 3, 4, 5]);console.log(arr[-1]); //=&gt; 5console.log(arr[[2, 4]]); //=&gt; [ 3, 5 ]console.log(arr[[2, -2, 1]]); //=&gt; [ 3, 4, 2 ]console.log(arr[&quot;2:4&quot;]); //=&gt; [ 3, 4]console.log(arr[&quot;-2:3&quot;]); //=&gt; [ 4, 5, 1, 2, 3 ]å¤åˆ¶ä»£ç  ç”±ä»¥ä¸Šçš„è¾“å‡ºç»“æœå¯çŸ¥ï¼Œå¢å¼ºåçš„æ•°ç»„å¯¹è±¡ï¼Œå°±å¯ä»¥æ”¯æŒè´Ÿæ•°ç´¢å¼•ã€åˆ†ç‰‡ç´¢å¼•ç­‰åŠŸèƒ½ã€‚é™¤äº†å¯ä»¥å¢å¼ºæ•°ç»„ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ Proxy API æ¥å¢å¼ºæ™®é€šå¯¹è±¡ã€‚ 2 å¢å¼ºå‹å¯¹è±¡åˆ›å»º enhancedObject å‡½æ•°123456789101112131415161718192021222324const enhancedObject = (target) =&gt; new Proxy(target, &#123; get(target, property) &#123; if (property in target) &#123; return target[property]; &#125; else &#123; return searchFor(property, target); &#125; &#125;, &#125;);let value = null;function searchFor(property, target) &#123; for (const key of Object.keys(target)) &#123; if (typeof target[key] === &quot;object&quot;) &#123; searchFor(property, target[key]); &#125; else if (typeof target[property] !== &quot;undefined&quot;) &#123; value = target[property]; break; &#125; &#125; return value;&#125;å¤åˆ¶ä»£ç  ä½¿ç”¨ enhancedObject å‡½æ•°123456789101112const data = enhancedObject(&#123; user: &#123; name: &quot;é˜¿å®å“¥&quot;, settings: &#123; theme: &quot;dark&quot;, &#125;, &#125;,&#125;);console.log(data.user.settings.theme); // darkconsole.log(data.theme); // darkå¤åˆ¶ä»£ç  ä»¥ä¸Šä»£ç è¿è¡Œåï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºä»¥ä¸‹ä»£ç ï¼š 123darkdarkå¤åˆ¶ä»£ç  é€šè¿‡è§‚å¯Ÿä»¥ä¸Šçš„è¾“å‡ºç»“æœå¯çŸ¥ï¼Œä½¿ç”¨ enhancedObject å‡½æ•°å¤„ç†è¿‡çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ–¹ä¾¿åœ°è®¿é—®æ™®é€šå¯¹è±¡å†…éƒ¨çš„æ·±å±‚å±æ€§ã€‚ 3 åˆ›å»ºåªè¯»çš„å¯¹è±¡åˆ›å»º Proxy å¯¹è±¡1234567891011121314const man = &#123; name: &quot;semlinker&quot;,&#125;;const handler = &#123; set: &quot;Read-Only&quot;, defineProperty: &quot;Read-Only&quot;, deleteProperty: &quot;Read-Only&quot;, preventExtensions: &quot;Read-Only&quot;, setPrototypeOf: &quot;Read-Only&quot;,&#125;;const proxy = new Proxy(man, handler);å¤åˆ¶ä»£ç  ä½¿ç”¨ proxy å¯¹è±¡123console.log(proxy.name);proxy.name = &quot;kakuqo&quot;;å¤åˆ¶ä»£ç  ä»¥ä¸Šä»£ç è¿è¡Œåï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºä»¥ä¸‹ä»£ç ï¼š 12345semlinkerproxy.name = &quot;kakuqo&quot;; ^TypeError: &#x27;Read-Only&#x27; returned for property &#x27;set&#x27; of object &#x27;#&lt;Object&gt;&#x27; is not a functionå¤åˆ¶ä»£ç  è§‚å¯Ÿä»¥ä¸Šçš„å¼‚å¸¸ä¿¡æ¯å¯çŸ¥ï¼Œå¯¼è‡´å¼‚å¸¸çš„åŸå› æ˜¯å› ä¸º handler å¯¹è±¡çš„ set å±æ€§å€¼ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚å¦‚æœä¸å¸Œæœ›æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª freeze å‡½æ•°ï¼š 123456789function freeze (obj) &#123; return new Proxy(obj, &#123; set () &#123; return true; &#125;, deleteProperty () &#123; return false; &#125;, defineProperty () &#123; return true; &#125;, setPrototypeOf () &#123; return true; &#125; &#125;);&#125;å¤åˆ¶ä»£ç  å®šä¹‰å¥½ freeze å‡½æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•°ç»„å¯¹è±¡æ¥æµ‹è¯•ä¸€ä¸‹å®ƒçš„åŠŸèƒ½ï¼š 123456let frozen = freeze([1, 2, 3]);frozen[0] = 6;delete frozen[0];frozen = Object.defineProperty(frozen, 0, &#123; value: 66 &#125;);console.log(frozen); // [ 1, 2, 3 ]å¤åˆ¶ä»£ç  ä¸Šè¿°ä»£ç æˆåŠŸæ‰§è¡Œåï¼Œæ§åˆ¶å°ä¼šè¾“å‡º [ 1, 2, 3 ]ï¼Œå¾ˆæ˜æ˜¾ç»è¿‡ freeze å‡½æ•°å¤„ç†è¿‡çš„æ•°ç»„å¯¹è±¡ï¼Œå·²ç»è¢« â€œå†»ç»“â€ äº†ã€‚ 4 æ‹¦æˆªæ–¹æ³•è°ƒç”¨å®šä¹‰ traceMethodCalls å‡½æ•°12345678910111213141516function traceMethodCalls(obj) &#123; const handler = &#123; get(target, propKey, receiver) &#123; const origMethod = target[propKey]; // è·å–åŸå§‹æ–¹æ³• return function (...args) &#123; const result = origMethod.apply(this, args); console.log( propKey + JSON.stringify(args) + &quot; -&gt; &quot; + JSON.stringify(result) ); return result; &#125;; &#125;, &#125;; return new Proxy(obj, handler);&#125;å¤åˆ¶ä»£ç  ä½¿ç”¨ traceMethodCalls å‡½æ•°123456789const obj = &#123; multiply(x, y) &#123; return x * y; &#125;,&#125;;const tracedObj = traceMethodCalls(obj);tracedObj.multiply(2, 5); // multiply[2,5] -&gt; 10å¤åˆ¶ä»£ç  ä¸Šè¿°ä»£ç æˆåŠŸæ‰§è¡Œåï¼Œæ§åˆ¶å°ä¼šè¾“å‡º multiply[2,5] -&gt; 10ï¼Œå³æˆ‘ä»¬èƒ½å¤ŸæˆåŠŸè·Ÿè¸ª obj å¯¹è±¡ä¸­æ–¹æ³•çš„è°ƒç”¨è¿‡ç¨‹ã€‚å…¶å®ï¼Œé™¤äº†èƒ½å¤Ÿè·Ÿè¸ªæ–¹æ³•çš„è°ƒç”¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è·Ÿè¸ªå¯¹è±¡ä¸­å±æ€§çš„è®¿é—®ï¼Œå…·ä½“ç¤ºä¾‹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627function tracePropAccess(obj, propKeys) &#123; const propKeySet = new Set(propKeys); return new Proxy(obj, &#123; get(target, propKey, receiver) &#123; if (propKeySet.has(propKey)) &#123; console.log(&quot;GET &quot; + propKey); &#125; return Reflect.get(target, propKey, receiver); &#125;, set(target, propKey, value, receiver) &#123; if (propKeySet.has(propKey)) &#123; console.log(&quot;SET &quot; + propKey + &quot;=&quot; + value); &#125; return Reflect.set(target, propKey, value, receiver); &#125;, &#125;);&#125;const man = &#123; name: &quot;semlinker&quot;,&#125;;const tracedMan = tracePropAccess(man, [&quot;name&quot;]);console.log(tracedMan.name); // GET name; semlinkerconsole.log(tracedMan.age); // undefinedtracedMan.name = &quot;kakuqo&quot;; // SET name=kakuqoå¤åˆ¶ä»£ç  åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª tracePropAccess å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šobj å’Œ propKeysï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºéœ€è·Ÿè¸ªçš„ç›®æ ‡å’Œéœ€è·Ÿè¸ªçš„å±æ€§åˆ—è¡¨ã€‚è°ƒç”¨ tracePropAccess å‡½æ•°åï¼Œä¼šè¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå½“æˆ‘ä»¬è®¿é—®è¢«è·Ÿè¸ªçš„å±æ€§æ—¶ï¼Œæ§åˆ¶å°å°±ä¼šè¾“å‡ºç›¸åº”çš„è®¿é—®æ—¥å¿—ã€‚ 5 éšè—å±æ€§åˆ›å»º hideProperty å‡½æ•°12345678910const hideProperty = (target, prefix = &quot;_&quot;) =&gt; new Proxy(target, &#123; has: (obj, prop) =&gt; !prop.startsWith(prefix) &amp;&amp; prop in obj, ownKeys: (obj) =&gt; Reflect.ownKeys(obj).filter( (prop) =&gt; typeof prop !== &quot;string&quot; || !prop.startsWith(prefix) ), get: (obj, prop, rec) =&gt; (prop in rec ? obj[prop] : undefined), &#125;);å¤åˆ¶ä»£ç  ä½¿ç”¨ hideProperty å‡½æ•°123456789const man = hideProperty(&#123; name: &quot;é˜¿å®å“¥&quot;, _pwd: &quot;www.semlinker.com&quot;,&#125;);console.log(man._pwd); // undefinedconsole.log(&#x27;_pwd&#x27; in man); // falseconsole.log(Object.keys(man)); // [ &#x27;name&#x27; ]å¤åˆ¶ä»£ç  é€šè¿‡è§‚å¯Ÿä»¥ä¸Šçš„è¾“å‡ºç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œåˆ©ç”¨ Proxy APIï¼Œæˆ‘ä»¬å®ç°äº†æŒ‡å®šå‰ç¼€å±æ€§çš„éšè—ã€‚é™¤äº†èƒ½å®ç°éšè—å±æ€§ä¹‹å¤–ï¼Œåˆ©ç”¨ Proxy APIï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®ç°éªŒè¯å±æ€§å€¼çš„åŠŸèƒ½ã€‚ 6 éªŒè¯å±æ€§å€¼åˆ›å»º validatedUser å‡½æ•°1234567891011121314151617181920212223const validatedUser = (target) =&gt; new Proxy(target, &#123; set(target, property, value) &#123; switch (property) &#123; case &quot;email&quot;: const regex = /^(([^&lt;&gt;()\\[\\]\\\\.,;:\\s@&quot;]+(\\.[^&lt;&gt;()\\[\\]\\\\.,;:\\s@&quot;]+)*)|(&quot;.+&quot;))@((\\[[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]&#123;2,&#125;))$/; if (!regex.test(value)) &#123; console.error(&quot;The user must have a valid email&quot;); return false; &#125; break; case &quot;age&quot;: if (value &lt; 20 || value &gt; 80) &#123; console.error(&quot;A user&#x27;s age must be between 20 and 80&quot;); return false; &#125; break; &#125; return Reflect.set(...arguments); &#125;, &#125;);å¤åˆ¶ä»£ç  ä½¿ç”¨ validatedUser å‡½æ•°123456789let user = &#123; email: &quot;&quot;, age: 0,&#125;;user = validatedUser(user);user.email = &quot;semlinker.com&quot;; // The user must have a valid emailuser.age = 100; // A user&#x27;s age must be between 20 and 80å¤åˆ¶ä»£ç  ä¸Šè¿°ä»£ç æˆåŠŸæ‰§è¡Œåï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºä»¥ä¸‹ç»“æœï¼š 12The user must have a valid emailA user&#x27;s age must be between 20 and 80","tags":["Javascript","proxy"],"categories":["Javascript"]},{"title":"setIntervalå’ŒsetTimeoutä¼˜åŒ–ç­–ç•¥","path":"/2021/06/15/setIntervalå’ŒsetTimeoutä¼˜åŒ–ç­–ç•¥/","content":"å¼‚æ­¥ç¼–ç¨‹å½“ç„¶å°‘ä¸äº†å®šæ—¶å™¨äº†ï¼Œå¸¸è§çš„å®šæ—¶å™¨å‡½æ•°æœ‰ setTimeoutã€setIntervalã€requestAnimationFrameã€‚æœ€å¸¸ç”¨çš„æ˜¯setTimeoutï¼Œå¾ˆå¤šäººè®¤ä¸º setTimeout æ˜¯å»¶æ—¶å¤šä¹…ï¼Œé‚£å°±åº”è¯¥æ˜¯å¤šä¹…åæ‰§è¡Œã€‚ å…¶å®è¿™ä¸ªè§‚ç‚¹æ˜¯é”™è¯¯çš„ï¼Œå› ä¸º JS æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¦‚æœå‰é¢çš„ä»£ç å½±å“äº†æ€§èƒ½ï¼Œå°±ä¼šå¯¼è‡´ setTimeout ä¸ä¼šæŒ‰æœŸæ‰§è¡Œã€‚å½“ç„¶äº†ï¼Œå¯ä»¥é€šè¿‡ä»£ç å»ä¿®æ­£ setTimeoutï¼Œä»è€Œä½¿å®šæ—¶å™¨ç›¸å¯¹å‡†ç¡®ï¼š 12345678910111213141516171819202122232425let period = 60 * 1000 * 60 * 2let startTime = new Date().getTime()let count = 0let end = new Date().getTime() + periodlet interval = 1000let currentInterval = intervalfunction loop() &#123; count++ // ä»£ç æ‰§è¡Œæ‰€æ¶ˆè€—çš„æ—¶é—´ let offset = new Date().getTime() - (startTime + count * interval); let diff = end - new Date().getTime() let h = Math.floor(diff / (60 * 1000 * 60)) let hdiff = diff % (60 * 1000 * 60) let m = Math.floor(hdiff / (60 * 1000)) let mdiff = hdiff % (60 * 1000) let s = mdiff / (1000) let sCeil = Math.ceil(s) let sFloor = Math.floor(s) // å¾—åˆ°ä¸‹ä¸€æ¬¡å¾ªç¯æ‰€æ¶ˆè€—çš„æ—¶é—´ currentInterval = interval - offset console.log(&#x27;æ—¶ï¼š&#x27;+h, &#x27;åˆ†ï¼š&#x27;+m, &#x27;æ¯«ç§’ï¼š&#x27;+s, &#x27;ç§’å‘ä¸Šå–æ•´ï¼š&#x27;+sCeil, &#x27;ä»£ç æ‰§è¡Œæ—¶é—´ï¼š&#x27;+offset, &#x27;ä¸‹æ¬¡å¾ªç¯é—´éš”&#x27;+currentInterval) setTimeout(loop, currentInterval)&#125;setTimeout(loop, currentInterval) æ¥ä¸‹æ¥çœ‹ setIntervalï¼Œå…¶å®è¿™ä¸ªå‡½æ•°ä½œç”¨å’Œ setTimeout åŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯è¯¥å‡½æ•°æ˜¯æ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œä¸€æ¬¡å›è°ƒå‡½æ•°ã€‚ é€šå¸¸æ¥è¯´ä¸å»ºè®®ä½¿ç”¨ setIntervalã€‚ç¬¬ä¸€ï¼Œå®ƒå’Œ setTimeout ä¸€æ ·ï¼Œä¸èƒ½ä¿è¯åœ¨é¢„æœŸçš„æ—¶é—´æ‰§è¡Œä»»åŠ¡ã€‚ç¬¬äºŒï¼Œå®ƒå­˜åœ¨æ‰§è¡Œç´¯ç§¯çš„é—®é¢˜ï¼Œè¯·çœ‹ä»¥ä¸‹ä¼ªä»£ç  12345678function demo() &#123; setInterval(function()&#123; console.log(2) &#125;,1000) sleep(2000)&#125;demo() ä»¥ä¸Šä»£ç åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œå¦‚æœå®šæ—¶å™¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†è€—æ—¶æ“ä½œï¼Œå¤šä¸ªå›è°ƒå‡½æ•°ä¼šåœ¨è€—æ—¶æ“ä½œç»“æŸä»¥ååŒæ—¶æ‰§è¡Œï¼Œè¿™æ ·å¯èƒ½å°±ä¼šå¸¦æ¥æ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚ å¦‚æœæœ‰å¾ªç¯å®šæ—¶å™¨çš„éœ€æ±‚ï¼Œå…¶å®å®Œå…¨å¯ä»¥é€šè¿‡ requestAnimationFrame æ¥å®ç°ï¼š 1234567891011121314151617181920212223function setInterval(callback, interval) &#123; let timer const now = Date.now let startTime = now() let endTime = startTime const loop = () =&gt; &#123; timer = window.requestAnimationFrame(loop) endTime = now() if (endTime - startTime &gt;= interval) &#123; startTime = endTime = now() callback(timer) &#125; &#125; timer = window.requestAnimationFrame(loop) return timer&#125;let a = 0setInterval(timer =&gt; &#123; console.log(1) a++ if (a === 3) cancelAnimationFrame(timer)&#125;, 1000) é¦–å…ˆ requestAnimationFrame è‡ªå¸¦å‡½æ•°èŠ‚æµåŠŸèƒ½ï¼ŒåŸºæœ¬å¯ä»¥ä¿è¯åœ¨ 16.6 æ¯«ç§’å†…åªæ‰§è¡Œä¸€æ¬¡ï¼ˆä¸æ‰å¸§çš„æƒ…å†µä¸‹ï¼‰ï¼Œå¹¶ä¸”è¯¥å‡½æ•°çš„å»¶æ—¶æ•ˆæœæ˜¯ç²¾ç¡®çš„ï¼Œæ²¡æœ‰å…¶ä»–å®šæ—¶å™¨æ—¶é—´ä¸å‡†çš„é—®é¢˜ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡è¯¥å‡½æ•°æ¥å®ç° setTimeoutã€‚","tags":["Javascript","requestAnimationFrame","setInterval","setTimeout","å¼‚æ­¥"],"categories":["Javascript"]},{"title":"ç®—æ³•ä¹‹äºŒå‰æ ‘çš„3ç§éå†","path":"/2021/06/14/ç®—æ³•ä¹‹äºŒå‰æ ‘çš„3ç§éå†/","content":"ä¸€. å‰åºéå†ï¼ˆä¸­å·¦å³ï¼‰144.äºŒå‰æ ‘å‰åºéå† 1. é€’å½’å®ç°æŒ‰ç…§ä¸­é—´èŠ‚ç‚¹å…ˆéå†ï¼Œåœ¨éå†å·¦å³èŠ‚ç‚¹ 12345678910111213141516171819202122232425262728293031/** * Definition for a binary tree node. * function TreeNode(val, left, right) &#123; * this.val = (val===undefined ? 0 : val) * this.left = (left===undefined ? null : left) * this.right = (right===undefined ? null : right) * &#125; *//** * @param &#123;TreeNode&#125; root * @return &#123;number[]&#125; */var preorderTraversal = function (root) &#123; let number = []; getNode(root, number); return number;&#125;;const getNode = (node, number) =&gt; &#123; if (node) &#123; number.push(node.val); if (node.left) &#123; getNode(node.left, number) &#125; if (node.right) &#123; getNode(node.right, number); &#125; &#125;&#125; 2. è¿­ä»£å®ç°ä»¥æ˜¾ç¤ºæ ˆçš„æ–¹å¼æ¨¡ä»¿é€’å½’ã€‚ åˆå§‹åŒ–æ ˆï¼Œå¹¶å°†æ ¹èŠ‚ç‚¹å…¥æ ˆï¼› å½“æ ˆä¸ä¸ºç©ºæ—¶ï¼š å¼¹å‡ºæ ˆé¡¶å…ƒç´  nï¼Œå¹¶å°†å€¼æ·»åŠ åˆ°ç»“æœä¸­ å¦‚æœ n çš„å³èŠ‚ç‚¹å­˜åœ¨ï¼Œå…¥æ ˆ å¦‚æœ n çš„å·¦èŠ‚ç‚¹å­˜åœ¨ï¼Œå…¥æ ˆ 1234567891011121314151617181920212223242526272829303132/** * Definition for a binary tree node. * function TreeNode(val, left, right) &#123; * this.val = (val===undefined ? 0 : val) * this.left = (left===undefined ? null : left) * this.right = (right===undefined ? null : right) * &#125; *//** * @param &#123;TreeNode&#125; root * @return &#123;number[]&#125; */var preorderTraversal = function (root) &#123; let number = []; let stack = [root]; while (stack.length) &#123; const current = stack.shift(); if(current)&#123; number.push(current.val); if(current.right)&#123; stack.unshift(current.right) &#125; if(current.left)&#123; stack.unshift(current.left); &#125; &#125; &#125; return number;&#125;; äºŒ. ä¸­åºéå†ï¼ˆå·¦ä¸­å³ï¼‰1. é€’å½’å®ç°å…ˆå·¦èŠ‚ç‚¹ï¼Œç„¶åä¸­é—´èŠ‚ç‚¹ï¼Œä¹‹åå³èŠ‚ç‚¹ 123456789101112131415161718192021222324252627/** * Definition for a binary tree node. * function TreeNode(val, left, right) &#123; * this.val = (val===undefined ? 0 : val) * this.left = (left===undefined ? null : left) * this.right = (right===undefined ? null : right) * &#125; *//** * @param &#123;TreeNode&#125; root * @return &#123;number[]&#125; */var inorderTraversal = function (root) &#123; const number = []; getNode(root, number); return number&#125;;const getNode = (node, number) =&gt; &#123; if (node &amp;&amp; node.left) &#123; getNode(node.left, number) &#125; node &amp;&amp; number.push(node.val); if (node &amp;&amp; node.right) &#123; getNode(node.right, number) &#125;&#125; 2. è¿­ä»£å®ç°åŸç†ï¼š ä»£ç ä¸€ï¼š 1234567891011121314151617181920const inorderTraversal = (root) =&gt; &#123; const res = []; const stack = []; while (root) &#123; // èƒ½å‹å…¥æ ˆçš„å·¦å­èŠ‚ç‚¹éƒ½å‹è¿›æ¥ stack.push(root); root = root.left; &#125; while (stack.length) &#123; let node = stack.pop(); // æ ˆé¡¶çš„èŠ‚ç‚¹å‡ºæ ˆ res.push(node.val); // åœ¨å‹å…¥å³å­æ ‘ä¹‹å‰ï¼Œå¤„ç†å®ƒçš„æ•°å€¼éƒ¨åˆ†ï¼ˆå› ä¸ºä¸­åºéå†ï¼‰ node = node.right; // è·å–å®ƒçš„å³å­æ ‘ while (node) &#123; // å³å­æ ‘å­˜åœ¨ï¼Œæ‰§è¡Œwhileå¾ªç¯ stack.push(node); // å‹å…¥å½“å‰root node = node.left; // ä¸æ–­å‹å…¥å·¦å­èŠ‚ç‚¹ &#125; &#125; return res;&#125;; ä»£ç äºŒï¼š 12345678910111213141516171819202122232425262728/** * Definition for a binary tree node. * function TreeNode(val, left, right) &#123; * this.val = (val===undefined ? 0 : val) * this.left = (left===undefined ? null : left) * this.right = (right===undefined ? null : right) * &#125; *//** * @param &#123;TreeNode&#125; root * @return &#123;number[]&#125; */var inorderTraversal = function (root) &#123; const number = []; let stack = []; let tempNode = root; while(tempNode || stack.length)&#123; if(tempNode)&#123; stack.unshift(tempNode); tempNode = tempNode.left; &#125;else&#123; tempNode = stack.shift(); number.push(tempNode.val); tempNode = tempNode.right &#125; &#125; return number;&#125;; ä¸‰. ååºéå†1. é€’å½’æ–¹å¼å·¦å³ä¸­ 123456789101112131415161718192021222324252627/** * Definition for a binary tree node. * function TreeNode(val, left, right) &#123; * this.val = (val===undefined ? 0 : val) * this.left = (left===undefined ? null : left) * this.right = (right===undefined ? null : right) * &#125; *//** * @param &#123;TreeNode&#125; root * @return &#123;number[]&#125; */var postorderTraversal = function(root) &#123; let number = []; getNode(root,number); return number;&#125;;const getNode = (node, number)=&gt;&#123; if(node &amp;&amp; node.left)&#123; getNode(node.left, number); &#125; if(node &amp;&amp; node.right)&#123; getNode(node.right, number) &#125; node &amp;&amp; number.push(node.val);&#125; 2. è¿­ä»£æ–¹å¼å…ˆåºéå†æ˜¯ä¸­å·¦å³ï¼Œåç»­éå†æ˜¯å·¦å³ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦è°ƒæ•´ä¸€ä¸‹å…ˆåºéå†çš„ä»£ç é¡ºåºï¼Œå°±å˜æˆä¸­å³å·¦çš„éå†é¡ºåºï¼Œç„¶ååœ¨åè½¬resultæ•°ç»„ï¼Œè¾“å‡ºçš„ç»“æœé¡ºåºå°±æ˜¯å·¦å³ä¸­äº†ï¼Œå¦‚ä¸‹å›¾ï¼š 12345678910111213141516171819202122232425262728/** * Definition for a binary tree node. * function TreeNode(val, left, right) &#123; * this.val = (val===undefined ? 0 : val) * this.left = (left===undefined ? null : left) * this.right = (right===undefined ? null : right) * &#125; *//** * @param &#123;TreeNode&#125; root * @return &#123;number[]&#125; */const postorderTraversal = (root) =&gt; &#123; const res = []; const stack = [root]; while(stack.length &gt; 0) &#123; const node = stack.pop() node &amp;&amp; res.unshift(node.val) if(node?.left) &#123; stack.push(node.left) &#125; if(node?.right) &#123; stack.push(node.right) &#125; &#125; return res&#125;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","äºŒå‰æ ‘","å‰åºéå†","ä¸­åºéå†","ååºéå†","è¿­ä»£"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹ä¸‰æ•°ä¹‹å’Œ","path":"/2021/06/14/ç®—æ³•ä¹‹ä¸‰æ•°ä¹‹å’Œ/","content":"15.ä¸‰æ•°ä¹‹å’Œ æ€è·¯ï¼š 1234567891011121314151617181920212223242526272829/** * @param &#123;number[]&#125; nums * @return &#123;number[][]&#125; */var threeSum = function(nums) &#123; let ans = []; const len = nums.length; if(nums == null || len &lt; 3) return ans; nums.sort((a, b) =&gt; a - b); // æ’åº for (let i = 0; i &lt; len ; i++) &#123; if(nums[i] &gt; 0) break; // å¦‚æœå½“å‰æ•°å­—å¤§äº0ï¼Œåˆ™ä¸‰æ•°ä¹‹å’Œä¸€å®šå¤§äº0ï¼Œæ‰€ä»¥ç»“æŸå¾ªç¯ if(i &gt; 0 &amp;&amp; nums[i] == nums[i-1]) continue; // å»é‡ let L = i+1; let R = len-1; while(L &lt; R)&#123; const sum = nums[i] + nums[L] + nums[R]; if(sum == 0)&#123; ans.push([nums[i],nums[L],nums[R]]); while (L&lt;R &amp;&amp; nums[L] == nums[L+1]) L++; // å»é‡ while (L&lt;R &amp;&amp; nums[R] == nums[R-1]) R--; // å»é‡ L++; R--; &#125; else if (sum &lt; 0) L++; else if (sum &gt; 0) R--; &#125; &#125; return ans;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","åŒæŒ‡é’ˆ"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹èµé‡‘ä¿¡","path":"/2021/06/14/ç®—æ³•ä¹‹èµé‡‘ä¿¡/","content":"383.èµé‡‘ä¿¡ ç»™å®šä¸€ä¸ªèµé‡‘ä¿¡ (ransom) å­—ç¬¦ä¸²å’Œä¸€ä¸ªæ‚å¿—(magazine)å­—ç¬¦ä¸²ï¼Œåˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸² ransom èƒ½ä¸èƒ½ç”±ç¬¬äºŒä¸ªå­—ç¬¦ä¸² magazines é‡Œé¢çš„å­—ç¬¦æ„æˆã€‚å¦‚æœå¯ä»¥æ„æˆï¼Œè¿”å› true ï¼›å¦åˆ™è¿”å› falseã€‚ (é¢˜ç›®è¯´æ˜ï¼šä¸ºäº†ä¸æš´éœ²èµé‡‘ä¿¡å­—è¿¹ï¼Œè¦ä»æ‚å¿—ä¸Šæœç´¢å„ä¸ªéœ€è¦çš„å­—æ¯ï¼Œç»„æˆå•è¯æ¥è¡¨è¾¾æ„æ€ã€‚æ‚å¿—å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦åªèƒ½åœ¨èµé‡‘ä¿¡å­—ç¬¦ä¸²ä¸­ä½¿ç”¨ä¸€æ¬¡ã€‚) 1.å“ˆå¸Œè¡¨ æ€è·¯ï¼š é¦–å…ˆæˆ‘ä»¬éå†ä¸€émagazineçš„å€¼ï¼Œå°†å…¶ä¸­çš„å­—ç¬¦å½“æˆkeyå­˜å…¥å¯¹è±¡ä¸­ï¼Œæ¯å‡ºç°ä¸€æ¬¡å°±å°†å…¶åŠ 1ï¼Œä¹‹åéå†ransomNodeï¼Œå¦‚æœå…¶ä¸­çš„å€¼ä¸å­˜åœ¨å°±è¿”å›falseï¼Œå­˜åœ¨å°±å°†å¯¹è±¡ä¸­keyå¯¹åº”çš„å€¼-1ï¼Œå¦‚æœå‡å®Œä¹‹åä¸º0ï¼Œåˆ™åˆ é™¤è¿™ä¸ªkeyï¼Œç›´åˆ°éå†ç»“æŸ 1234567891011121314151617181920212223242526/** * @param &#123;string&#125; ransomNote * @param &#123;string&#125; magazine * @return &#123;boolean&#125; */var canConstruct = function(ransomNote, magazine) &#123; const obj = &#123;&#125;; for(let i = 0; i&lt;magazine.length;i++)&#123; if(magazine[i] in obj)&#123; obj[magazine[i]]++; &#125;else&#123; obj[magazine[i]]=1; &#125; &#125; for(let j= 0; j&lt;ransomNote.length; j++)&#123; if(ransomNote[j] in obj)&#123; obj[ransomNote[j]]--; if(obj[ransomNote[j]] === 0)&#123; delete obj[ransomNote[j]]; &#125; &#125;else&#123; return false; &#125; &#125; return true;&#125;; 2.ä¸€å±‚forå¾ªç¯ éå†ransomNodeï¼Œåªè¦magazineä¸­æœ‰è¿™ä¸ªå€¼ï¼Œå°±æŠŠmagazineä¸­çš„è¿™ä¸ªå€¼ç»™åˆ æ‰ï¼Œæ¯æ¬¡éå†éƒ½å»æ›´æ–°magazineçš„å€¼ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±è¯´æ˜ä¸èƒ½æ„æˆï¼Œéå†ç»“æŸã€‚ 1234567891011121314/** * @param &#123;string&#125; ransomNote * @param &#123;string&#125; magazine * @return &#123;boolean&#125; */var canConstruct = function (ransomNote, magazine) &#123; for (let i = 0; i &lt; ransomNote.length; i++) &#123; if (magazine.indexOf(ransomNote[i]) === -1) &#123; return false; &#125; magazine = magazine.replace(ransomNote[i], &quot;&quot;); &#125; return true;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","å“ˆå¸Œè¡¨"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹å››æ•°ä¹‹å’Œâ…¡","path":"/2021/06/14/ç®—æ³•ä¹‹å››æ•°ä¹‹å’Œâ…¡/","content":"454.å››æ•°å­—ç›¸åŠ â…¡ ç»™å®šå››ä¸ªåŒ…å«æ•´æ•°çš„æ•°ç»„åˆ—è¡¨ A , B , C , D ,è®¡ç®—æœ‰å¤šå°‘ä¸ªå…ƒç»„ (i, j, k, l) ï¼Œä½¿å¾— A[i] + B[j] + C[k] + D[l] = 0ã€‚ ä¸ºäº†ä½¿é—®é¢˜ç®€å•åŒ–ï¼Œæ‰€æœ‰çš„ A, B, C, D å…·æœ‰ç›¸åŒçš„é•¿åº¦ Nï¼Œä¸” 0 â‰¤ N â‰¤ 500 ã€‚æ‰€æœ‰æ•´æ•°çš„èŒƒå›´åœ¨ -228 åˆ° 228 - 1 ä¹‹é—´ï¼Œæœ€ç»ˆç»“æœä¸ä¼šè¶…è¿‡ 231 - 1 ã€‚ æ€è·¯ï¼š å››ä¸ªæ•°ä¹‹å’Œå’±ä»¬å¯ä»¥ç»™ä»–è½¬æ¢æˆ2æ•°ä¹‹å’Œï¼Œè¿™é‡Œå› ä¸ºæ˜¯4ä¸ªæ•°ç»„ï¼Œä¸¤ä¸¤ç»„åˆï¼Œä¹‹åç”¨Mapå­˜å‚¨å’Œå€¼ï¼Œå› ä¸ºæ—¢ç„¶è¦ ä½¿å¾— A[i] + B[j] + C[k] + D[l] = 0,æ¢ä¸ªæ€è·¯å°±æ˜¯ä½¿å¾— A[i] + B[j] = -C[k] - D[l]ï¼ŒABä¸€ç»„éå†å­˜é”®å€¼ï¼ŒCDå†å»éå†æ‰¾åˆ°é”®å€¼ç›¸ç­‰çš„ï¼Œé‚£å°±æ˜¯ä¸€ç»„ï¼Œæˆ–è€…å¤šç»„ï¼Œå› ä¸ºABå¯èƒ½æœ‰å¤šç§æƒ…å†µï¼ŒCDä¹Ÿæ˜¯ 1234567891011121314151617181920212223242526272829303132/** * @param &#123;number[]&#125; A * @param &#123;number[]&#125; B * @param &#123;number[]&#125; C * @param &#123;number[]&#125; D * @return &#123;number&#125; */var fourSumCount = function (A, B, C, D) &#123; let h = new Map() let r = 0 //éå†å‰ä¸¤ä¸ªå‚æ•°ï¼Œåœ¨mapä¸­ä»¥é”®å€¼å¯¹æ–¹å¼æ·»åŠ æ‰€æœ‰å¯èƒ½çš„å€¼ //keyå€¼ä¸º-ï¼ˆa+bï¼‰ï¼Œå½“C Dæ•°ç»„ä¸­çš„c+d=-ï¼ˆa+bï¼‰æ—¶å€™ï¼Œè¯´æ˜ç»„åˆèµ·æ¥ä¼šæ˜¯0 //keyå€¼å­˜åœ¨çš„æ—¶å€™å°±+1ï¼Œä¸å­˜åœ¨å°±setä¸º1 for (var a of A) &#123; for (var b of B) &#123; if (h.get(0 - a - b)) &#123; h.set(0 - a - b, h.get(0 - a - b) + 1) &#125; else &#123; h.set(0 - a - b, 1) &#125; &#125; &#125; //C Dä¸­çš„å€¼æœ‰åŒ¹é…çš„è¯å°±åœ¨è¿”å›ç»“æœä¸­åŠ ä¸Škeyå¯¹åº”çš„value for (var c of C) &#123; for (var d of D) &#123; if (h.has(c + d)) &#123; r += h.get(c + d) &#125; &#125; &#125; return r&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","å“ˆå¸Œè¡¨"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹ä¸¤æ•°ä¹‹å’Œ","path":"/2021/06/13/ç®—æ³•ä¹‹ä¸¤æ•°ä¹‹å’Œ/","content":"1.ä¸¤æ•°ä¹‹å’Œ ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º å’Œä¸ºç›®æ ‡å€¼ target çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚ ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œæ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ åœ¨ç­”æ¡ˆé‡Œä¸èƒ½é‡å¤å‡ºç°ã€‚ ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚ æ€è·¯ï¼š æ ¹æ®é¢˜æ„ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨æš´ç ´ï¼Œä¼šå¯¼è‡´æ—¶é—´å¤æ‚åº¦ä¸º n^2 ï¼Œè¿™æ ·çš„ä»£ä»·æ— ç–‘æ˜¯å¾ˆå¤§çš„ã€‚ æ‰€ä»¥æˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ç”¨å“ˆå¸Œè¡¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ æˆ‘ä»¬éå†åˆ°æ•°å­— a æ—¶ï¼Œç”¨ target å‡å» aï¼Œå°±ä¼šå¾—åˆ° bï¼Œè‹¥ b å­˜åœ¨äºå“ˆå¸Œè¡¨ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è¿”å›ç»“æœäº†ã€‚è‹¥b ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å°† a å­˜å…¥å“ˆå¸Œè¡¨ï¼Œå¥½è®©åç»­éå†çš„æ•°å­—ä½¿ç”¨ã€‚ 1234567891011121314151617/** * @param &#123;number[]&#125; nums * @param &#123;number&#125; target * @return &#123;number[]&#125; */var twoSum = function(nums, target) &#123; let obj = &#123;&#125;; let i = 0; while(i &lt; nums.length)&#123; let sum = target - nums[i]; if(sum in obj)&#123; return [i, obj[sum]] &#125; obj[nums[i]] = i; i++; &#125;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","å“ˆå¸Œè¡¨"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹å¿«ä¹æ•°","path":"/2021/06/13/ç®—æ³•ä¹‹å¿«ä¹æ•°/","content":"202.å¿«ä¹æ•° ç¼–å†™ä¸€ä¸ªç®—æ³•æ¥åˆ¤æ–­ä¸€ä¸ªæ•° n æ˜¯ä¸æ˜¯å¿«ä¹æ•°ã€‚ ã€Œå¿«ä¹æ•°ã€å®šä¹‰ä¸ºï¼š å¯¹äºä¸€ä¸ªæ­£æ•´æ•°ï¼Œæ¯ä¸€æ¬¡å°†è¯¥æ•°æ›¿æ¢ä¸ºå®ƒæ¯ä¸ªä½ç½®ä¸Šçš„æ•°å­—çš„å¹³æ–¹å’Œã€‚ç„¶åé‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°è¿™ä¸ªæ•°å˜ä¸º 1ï¼Œä¹Ÿå¯èƒ½æ˜¯ æ— é™å¾ªç¯ ä½†å§‹ç»ˆå˜ä¸åˆ° 1ã€‚å¦‚æœ å¯ä»¥å˜ä¸º 1ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±æ˜¯å¿«ä¹æ•°ã€‚å¦‚æœ n æ˜¯å¿«ä¹æ•°å°±è¿”å› true ï¼›ä¸æ˜¯ï¼Œåˆ™è¿”å› false ã€‚ æ€è·¯: 1.å“ˆå¸Œè¡¨ æ¯æ¬¡éƒ½å»æ‹†åˆ†æ•°å­—è®¡ç®—å¹³æ–¹å’Œï¼Œå¦‚æœå’Œä¸º1ï¼Œå°±æ˜¯å¿«ä¹æ•°ï¼Œå¦‚æœä¸å”¯ä¸€å°±å­˜åœ¨Mapé‡Œå¤´ã€‚ åé¢è®¡ç®—å‘ç°ï¼Œå¦‚æœè¯´ä¸æ˜¯å¿«ä¹æ•°å¾—è¯ï¼Œè®¡ç®—çš„å€¼å¯èƒ½ä¼šå›åˆ°ä¹‹å‰è®¡ç®—çš„æŸä¸ªå€¼ï¼Œä¹Ÿå°±æ˜¯Mapé‡Œå¤´ï¼Œæ‰€ä»¥å¦‚æœè¯´è®¡ç®—çš„ç»“æœï¼Œmapé‡Œå¤´å­˜åœ¨ï¼Œé‚£ä¹ˆè¯´æ˜ä¸æ˜¯å¿«ä¹æ ‘ 1234567891011121314151617181920212223/** * @param &#123;number&#125; n * @return &#123;boolean&#125; */function sum(n) &#123; n = n + &#x27;&#x27; let sum = 0 for (let num of n) &#123; sum += num * num &#125; return sum&#125;var isHappy = function (n) &#123; let res = sum(n) let obj = &#123;&#125; while (res != 1) &#123; if (res in obj) return false obj[res] = 1 res = sum(res) &#125; return true&#125; 2.å¿«æ…¢æŒ‡é’ˆ æ ¹æ®é¢˜æ„ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå¦‚ä¸‹ï¼š æ‰¾åˆ°å¿«ä¹æ•°æ²¡æœ‰å¿«ä¹æ•°ï¼Œå½¢æˆç¯è·¯ï¼Œé€ æˆæ­»å¾ªç¯ã€‚å…¶å®åˆ†ææ˜¯å¾ˆå®¹æ˜“çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ï¼Œå¦‚ä½•è§£é¢˜ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬è‚¯å®šå¯ä»¥ä½¿ç”¨å“ˆå¸Œè¡¨è®°å½•è¿‡ç¨‹å€¼ï¼Œè‹¥æ‰¾åˆ° 11ï¼Œçš†å¤§æ¬¢å–œã€‚ å¦‚æœåœ¨æ‰¾çš„è¿‡ç¨‹ä¸­ï¼Œå“ˆå¸Œè¡¨ä¸­å·²å­˜åœ¨å½“å‰æ•°ï¼Œåˆ™è¯æ˜è¿›å…¥äº†ç¯è·¯ï¼Œä¹Ÿå°±æ˜¯æ­»å¾ªç¯äº†ï¼ æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ¤æ–­å½“å‰æ•°ä¸æ˜¯ä¸€ä¸ªå¿«ä¹æ•°äº†~ ä½†æ˜¯ï¼Œä¸ºäº†é™ä½ç©ºé—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæ¥è§£å†³ï¼Œæµç¨‹å¦‚ä¸‹ï¼š åˆ›å»ºä¸€ä¸ªæ…¢æŒ‡é’ˆï¼Œä¸€æ¬¡èµ°ä¸€æ­¥ï¼Œå†åˆ›å»ºä¸€ä¸ªå¿«æŒ‡é’ˆï¼Œä¸€æ¬¡èµ°ä¸¤æ­¥ã€‚å½“å¿«æ…¢æŒ‡é’ˆç›¸é‡ï¼Œä»£è¡¨å½¢å‚ç¯è·¯ï¼Œè¯¥æ•°ä¸æ˜¯å¿«ä¹æ•°ã€‚è‹¥æŒ‡é’ˆç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œæ‰¾åˆ°äº† 11ï¼Œåˆ™å½“å‰æ•°æ˜¯ä¸€ä¸ªå¿«ä¹æ•°ã€‚ 123456789101112let getNext = function (n) &#123; return n.toString().split(&#x27;&#x27;).map(i =&gt; i ** 2).reduce((a, b) =&gt; a + b);&#125;let isHappy = function (n) &#123; let slow = n; let fast = getNext(n); while(fast !== 1 &amp;&amp; fast !== slow)&#123; slow = getNext(slow); fast = getNext(getNext(fast)); &#125; return fast === 1;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","å“ˆå¸Œè¡¨","å¿«æ…¢æŒ‡é’ˆ","ç¯å½¢é“¾è¡¨"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹é“¾è¡¨ç›¸äº¤","path":"/2021/06/13/ç®—æ³•ä¹‹é“¾è¡¨ç›¸äº¤/","content":"é¢è¯•é¢˜ 02.07.é“¾è¡¨ç›¸äº¤ è§£é¢˜æ€è·¯ï¼š 1.å‡è®¾ä¸¤ä¸ªé“¾è¡¨ç›¸äº¤äºAï¼Œç”±äºä¸¤ä¸ªé“¾è¡¨éƒ½æ˜¯å•å‘é“¾è¡¨ï¼Œæ‰€ä»¥Aåé¢çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯ä¸¤ä¸ªé“¾è¡¨çš„å…¬å…±éƒ¨åˆ†ã€‚ç°åœ¨è¦æ‰¾å®ƒä»¬ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹ï¼Œå¦‚æœå¯ä»¥ä»åå¾€å‰æ‰¾ï¼Œåˆ™æ‰¾åˆ°ä¸¤ä¸ªé“¾è¡¨ç¬¬ä¸€ä¸ªä¸ç›¸åŒçš„èŠ‚ç‚¹ï¼Œå…¶åçš„èŠ‚ç‚¹å³ä¸ºæ‰€æ±‚ã€‚ä½†é“¾è¡¨çš„ç‰¹ç‚¹å¯¼è‡´å…¶æ›´é€‚åˆä»å‰å‘åéå†ï¼Œå¦‚æœè¦ä»åå¾€å‰ä¸€ä¸ªä¸ªæ¯”è¾ƒï¼Œåˆ™æ¯æ¬¡éƒ½è¦ä»å¤´æ‰«ææ‰¾åˆ°åˆé€‚ä½ç½®çš„èŠ‚ç‚¹å†è¿›è¡Œæ¯”è¾ƒï¼ˆæœ€å¤šæ‰«æNè¶Ÿï¼Œå¹³å‡æ‰«æN/2è¶Ÿï¼Œå…¶ä¸­Nä¸ºé“¾è¡¨é•¿åº¦ï¼‰ï¼Œè¿™æ ·æ—¶é—´å¤æ‚åº¦ä¼šå¾ˆé«˜ï¼Œæ˜¯å¹³æ–¹çº§çš„æ—¶é—´å¤æ‚åº¦ã€‚è¦æƒ³ä»åå¾€å‰ä¸€ä¸ªä¸ªæ¯”è¾ƒï¼Œåˆä¸éœ€è¦æ¯æ¬¡ä»å¤´æ‰«æï¼Œå¯ä»¥è€ƒè™‘æŠŠä¸¤ä¸ªé“¾è¡¨çš„èŠ‚ç‚¹åˆ†åˆ«ä¾æ¬¡æ”¾å…¥ä¸¤ä¸ªæ ˆä¸­ï¼Œè¿™æ ·æ ˆé¡¶çš„å…ƒç´ ä¾¿æ˜¯å…¶æœ€åçš„èŠ‚ç‚¹ï¼Œé€ä¸ªå‡ºæ ˆå¹¶è¿›è¡Œæ¯”è¾ƒï¼Œå³å¯å¾—åˆ°ç»“æœã€‚ä¸è¿‡è¿™æ ·åšéœ€è¦å¼•å…¥ä¸¤ä¸ªæ ˆï¼Œè€Œæ ˆçš„ç©ºé—´å¤æ‚åº¦ä¸ºçº¿æ€§çº§ã€‚è¿™ç›¸å½“äºç”¨ç©ºé—´æ¢æ—¶é—´ã€‚æœ€åï¼Œå†ä»”ç»†åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆä¸èƒ½ä»å¤´å¼€å§‹æ‰«æä¸¤ä¸ªé“¾è¡¨å¹¶ç”¨äºæ¯”è¾ƒï¼Œè¿™æ˜¯å› ä¸ºä¸¤ä¸ªé“¾è¡¨çš„é•¿åº¦ä¸ä¸€æ ·ï¼Œå¦‚æœä¸¤ä¸ªé“¾è¡¨çš„é•¿åº¦ä¸€æ ·ï¼Œåˆ™ç”±äºå…¶å…¬å…±èŠ‚ç‚¹ä¸ªæ•°ä¸€æ ·ï¼Œæ‰€ä»¥ä¸ç›¸åŒèŠ‚ç‚¹æ•°ç›®ä¹Ÿä¸€æ ·ï¼Œè¿™æ ·å®Œå…¨å¯ä»¥ä»å¤´æ‰«æå¹¶è¿›è¡Œæ¯”è¾ƒã€‚ä½†å®é™…ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨å¹¶ä¸ä¸€å®šé•¿åº¦ç›¸åŒï¼Œè¿™æ—¶å¯ä»¥å…ˆè®©è¾ƒé•¿çš„é“¾è¡¨èµ°ä¸Šk(kä¸ºé•¿é“¾è¡¨ä¸çŸ­é“¾è¡¨çš„å·®å€¼)æ­¥ï¼Œåœ¨ä¾æ¬¡æ¯”è¾ƒä¸¤ä¸ªé“¾è¡¨çš„èŠ‚ç‚¹ï¼Œè¿™æ ·ä¾¿å¯ä»¥ä¸ä½¿ç”¨å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œä»è€Œä¿è¯å¸¸é‡çº§çš„ç©ºé—´å¤æ‚åº¦ã€‚åŒæ—¶ï¼Œç”±äºç”¨è¿™ç§æ–¹æ³•åªéœ€æ‰«æä¸¤ä¸ªé“¾è¡¨æœ€å¤šä¸¤è¶Ÿï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸ºçº¿æ€§çº§ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445/** * Definition for singly-linked list. * function ListNode(val) &#123; * this.val = val; * this.next = null; * &#125; *//** * @param &#123;ListNode&#125; headA * @param &#123;ListNode&#125; headB * @return &#123;ListNode&#125; */var getIntersectionNode = function (headA, headB) &#123; let headALen = 0; let p = headA; while (p) &#123; headALen++; p = p.next; &#125; let headBLen = 0; let q = headB; while (q) &#123; headBLen++; q = q.next; &#125; if (headALen &lt; headBLen) &#123; p = headA; headA = headB; headB = p; [headALen, headBLen] = [headBLen, headALen]; &#125; while (headALen - headBLen) &#123; headA = headA.next; headALen--; &#125; while (headA &amp;&amp; headB) &#123; if (headA === headB) &#123; return headA; &#125; headA = headA.next; headB = headB.next; &#125; return null;&#125;; 2.ä¸¤ä¸ªæŒ‡é’ˆæœ€å¤šèµ°è¿‡headAé“¾è¡¨é•¿åº¦ + headBé“¾è¡¨é•¿åº¦çš„è·ç¦» å¦‚æœç›¸äº¤ï¼Œä¼šæå‰ç›¸é‡åœ¨ç›¸äº¤èŠ‚ç‚¹ã€‚æ­¤æ—¶è¿”å›ç›¸äº¤èŠ‚ç‚¹ã€‚å¦‚æœä¸ç›¸äº¤ï¼Œåˆ™å„è‡ªèµ°è¿‡headAé“¾è¡¨é•¿åº¦ + headBé“¾è¡¨é•¿åº¦çš„è·ç¦»ï¼ŒæŒ‡å‘nullã€‚æ­¤æ—¶è¿”å›null. 123456789101112131415161718192021/** * Definition for singly-linked list. * function ListNode(val) &#123; * this.val = val; * this.next = null; * &#125; *//** * @param &#123;ListNode&#125; headA * @param &#123;ListNode&#125; headB * @return &#123;ListNode&#125; */var getIntersectionNode = function(headA, headB) &#123; var p1 = headA, p2 = headB; while (p1 != p2) &#123; p1 = p1 ? p1.next : headB; p2 = p2 ? p2.next : headA; &#125; return p1;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","é“¾è¡¨","å¿«æ…¢æŒ‡é’ˆ"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—","path":"/2021/06/13/ç®—æ³•ä¹‹åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—/","content":"136.ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚ ä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´æ¥å®ç°å—ï¼Ÿ è§£æ³•ï¼š 1.å“ˆå¸Œè¡¨ ç®€å•ä¸æ¥å—ï¼Œéœ€è¦å¼€è¾Ÿæ–°ç©ºé—´ 2.é€»è¾‘è¿ç®—ç¬¦ 12345678910/** * @param &#123;number[]&#125; nums * @return &#123;number&#125; */var singleNumber = function (nums) &#123; for (let i = 0, l = nums.length; i &lt; l; i++) &#123; nums[i + 1] = nums[i] ^ nums[i + 1]; &#125; return nums[nums.length - 1];&#125;; æ€è·¯ï¼š é€»è¾‘ æˆ–é è¿ç®—ç¬¦çš„ç‰¹ç‚¹å°±æ˜¯ï¼ŒæŸä¸ªæ•°æˆ–éæœ¬äº‹å°±æ˜¯ 0ï¼Œ0æˆ–éä»»æ„æ•°éƒ½æ˜¯ä»»æ„æ•° å†ä¸å¼€è¾Ÿæ–°ç©ºé—´çš„æƒ…å†µä¸‹ï¼Œæ ¹æ®æ•°ç»„ç‰¹ç‚¹æˆ‘ä»¬çŸ¥é“ï¼Œé™¤äº†é‚£ä¸ªä¸€æ¬¡å‡ºç°çš„æ•°æ®ï¼Œå…¶ä»–éƒ½æ˜¯æˆåŒçš„ é‚£æˆ‘ä»¬æŠŠç›¸é‚»ä¸¤æ•° æˆ–é è¿ç®—çš„ç»“æœèµ‹å€¼ç»™ä¸‹ä¸€ä¸ªï¼Œä¸æ–­çš„æˆ–éä¸‹å»ï¼Œæœ€ç»ˆå¾—åˆ°çš„æœ€åä¸€ä½æ•°ï¼Œå°±æ˜¯å‡ºç°ä¸€æ¬¡çš„æ•°","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","å“ˆå¸Œè¡¨","é€»è¾‘è¿ç®—ç¬¦"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹ç¯å½¢é“¾è¡¨2","path":"/2021/06/13/ç®—æ³•ä¹‹ç¯å½¢é“¾è¡¨2/","content":"142.ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œè¿”å›é“¾è¡¨å¼€å§‹å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ å¦‚æœé“¾è¡¨æ— ç¯ï¼Œåˆ™è¿”å› nullã€‚ è¯´æ˜ï¼šä¸å…è®¸ä¿®æ”¹ç»™å®šçš„é“¾è¡¨ã€‚ è¿›é˜¶ï¼š ä½ æ˜¯å¦å¯ä»¥ä½¿ç”¨ O(1) ç©ºé—´è§£å†³æ­¤é¢˜ï¼Ÿ è§£æ³•ï¼š 1.å“ˆå¸Œè¡¨ 123456789101112131415var detectCycle = function(head) &#123; //å»ºç«‹ä¸€ä¸ªSetï¼Œå¦‚æœæœ‰é‡å¤çš„ï¼Œå°±è¯´æ˜æ˜¯ç¯ã€‚ const memo = new Set() while(head)&#123; if(memo.has(head))&#123; return head &#125;else&#123; memo.add(head) &#125; head = head.next &#125; return null;&#125;; 2.å¿«æ…¢æŒ‡é’ˆ 12345678910111213141516171819202122var detectCycle = function(head) &#123; let fast = head, slow = head; do&#123; //æ£€æŸ¥æ˜¯å¦æœ‰ç¯ + å¯»æ‰¾ç›¸é‡ç‚¹ encounter point if(!fast || !fast.next) return null; fast = fast.next.next slow = slow.next &#125;while(fast != slow) fast = head; //å¯»æ‰¾å…¥å£ entrance //ä¸ºä»€ä¹ˆè¿™èƒ½å¯»æ‰¾å…¥å£ï¼Œè¯·çœ‹ä¸‹å›¾ while(fast != slow)&#123; fast = fast.next slow = slow.next &#125; return fast;&#125;; å¤æ‚åº¦åˆ†ææ—¶é—´å¤æ‚åº¦ï¼šO(N)ç©ºé—´å¤æ‚åº¦ï¼šO(1)æœ‰ä¸€ä¸ªå¿«æŒ‡é’ˆfastï¼Œæ…¢æŒ‡é’ˆslowï¼›å¿«æŒ‡é’ˆä¸€æ¬¡èµ°ä¸¤æ­¥ï¼Œæ…¢æŒ‡é’ˆä¸€æ¬¡èµ°ä¸€æ­¥ï¼›åœ¨æœ‰ç¯çš„æƒ…å†µä¸‹ï¼Œä»–ä»¬ä¿©ä¼šåœ¨encounterç›¸é‡ã€‚ç›¸é‡çš„æ—¶å€™æœ‰(Nfast - 2Nslow) * L = Path + Eé€šè¿‡Luciferçš„ä¾‹å­ï¼Œæˆ‘ä»¬å¾—çŸ¥(Nfast - 2Nslow) åªè¦æ˜¯ä¸ªæ•´æ•°ï¼Œå°±ä¸ä¼šå½±å“encounteråœ¨ç¯ä¸Šçš„ä½ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½æ¨å¯¼å‡º:Path = L - E (å°±æ˜¯é‚£ä¿©è“è‰²çš„åœ°æ–¹)è¿™æ—¶å€™fastå†ä»headå¼€å§‹èµ°ï¼Œslowä»encounterèµ°ï¼Œä»–ä»¬ä¿©æ¯ä¸ªéƒ½èµ°ä¸€æ­¥ï¼Œé‡è§çš„æ—¶å€™å°±åˆšå¥½åœ¨ç¯çš„å…¥å£ã€‚","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","å“ˆå¸Œè¡¨","é“¾è¡¨","ç¯å½¢é“¾è¡¨"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹ç¯å½¢é“¾è¡¨1","path":"/2021/06/13/ç®—æ³•ä¹‹ç¯å½¢é“¾è¡¨1/","content":"141.ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚ å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª next æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœ pos æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚æ³¨æ„ï¼špos ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚ å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯ï¼Œåˆ™è¿”å› true ã€‚ å¦åˆ™ï¼Œè¿”å› false ã€‚ ä½ èƒ½ç”¨ O(1)ï¼ˆå³ï¼Œå¸¸é‡ï¼‰å†…å­˜è§£å†³æ­¤é—®é¢˜å—ï¼Ÿ è§£é¢˜æ€è·¯ï¼š 1.å¿«æ…¢æŒ‡é’ˆ ä¸¤ä¸ªäººåœ¨åœ†å½¢æ“åœºä¸Šçš„èµ·ç‚¹åŒæ—¶èµ·è·‘ï¼Œé€Ÿåº¦å¿«çš„äººä¸€å®šä¼šè¶…è¿‡é€Ÿåº¦æ…¢çš„äººä¸€åœˆã€‚ ç”¨ä¸€å—ä¸€æ…¢ä¸¤ä¸ªæŒ‡é’ˆéå†é“¾è¡¨ï¼Œå¦‚æœæŒ‡é’ˆèƒ½å¤Ÿç›¸é€¢ï¼Œé‚£ä¹ˆé“¾è¡¨å°±æœ‰åœˆã€‚ ç”¨ä¸€å—ä¸€æ…¢ä¸¤ä¸ªæŒ‡é’ˆéå†é“¾è¡¨ï¼Œå¦‚æœæŒ‡é’ˆèƒ½å¤Ÿç›¸é€¢ï¼Œå°±è¿”å›true éå†ç»“æŸåï¼Œè¿˜æ²¡æœ‰ç›¸é€¢å°±è¿”å›false 12345678910111213var hasCycle = function(head) &#123; let p1 = head; let p2 = head; while(p1 &amp;&amp; p2 &amp;&amp; p2.next) &#123; p1 = p1.next p2 = p2.next.next if(p1 === p2) &#123; return true; &#125; &#125; return false;&#125;; 2.æ ‡è®°æ³• æ ‡è®°æ³•ç»™éå†è¿‡çš„èŠ‚ç‚¹æ‰“è®°å·ï¼Œå¦‚æœéå†è¿‡ç¨‹ä¸­é‡åˆ°æœ‰è®°å·çš„è¯´æ˜å·²ç¯ğŸ¤“ 12345678910const hasCycle = function(head) &#123; while (head) &#123; if (head.tag) &#123; return true; &#125; head.tag = true; head = head.next; &#125; return false;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","é“¾è¡¨","ç¯å½¢é“¾è¡¨"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹","path":"/2021/06/13/ç®—æ³•ä¹‹åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹/","content":"19.ç»™ä½ ä¸€ä¸ªé“¾è¡¨ï¼Œåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ n ä¸ªç»“ç‚¹ï¼Œå¹¶ä¸”è¿”å›é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚ è¿›é˜¶ï¼šä½ èƒ½å°è¯•ä½¿ç”¨ä¸€è¶Ÿæ‰«æå®ç°å—ï¼Ÿ æ€è·¯ï¼š åŒæŒ‡é’ˆçš„ç»å…¸åº”ç”¨ï¼Œå¦‚æœè¦åˆ é™¤å€’æ•°ç¬¬nä¸ªèŠ‚ç‚¹ï¼Œè®©fastç§»åŠ¨næ­¥ï¼Œç„¶åè®©fastå’ŒslowåŒæ—¶ç§»åŠ¨ï¼Œç›´åˆ°fastæŒ‡å‘é“¾è¡¨æœ«å°¾ã€‚åˆ æ‰slowæ‰€æŒ‡å‘çš„èŠ‚ç‚¹å°±å¯ä»¥äº†ã€‚ å®šä¹‰fastæŒ‡é’ˆå’ŒslowæŒ‡é’ˆï¼Œåˆå§‹å€¼ä¸ºè™šæ‹Ÿå¤´ç»“ç‚¹ï¼Œå¦‚å›¾ï¼š fasté¦–å…ˆèµ°n + 1æ­¥ ï¼Œä¸ºä»€ä¹ˆæ˜¯n+1å‘¢ï¼Œå› ä¸ºåªæœ‰è¿™æ ·åŒæ—¶ç§»åŠ¨çš„æ—¶å€™slowæ‰èƒ½æŒ‡å‘åˆ é™¤èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæ–¹ä¾¿åšåˆ é™¤æ“ä½œï¼‰ï¼Œå¦‚å›¾ï¼š fastå’ŒslowåŒæ—¶ç§»åŠ¨ï¼Œä¹‹é“fastæŒ‡å‘æœ«å°¾ï¼Œå¦‚é¢˜ï¼š åˆ é™¤slowæŒ‡å‘çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚å›¾ï¼š è§£é¢˜ï¼š 123456789101112131415161718192021222324252627/** * Definition for singly-linked list. * function ListNode(val, next) &#123; * this.val = (val===undefined ? 0 : val) * this.next = (next===undefined ? null : next) * &#125; *//** * @param &#123;ListNode&#125; head * @param &#123;number&#125; n * @return &#123;ListNode&#125; */var removeNthFromEnd = function (head, n) &#123; let preNode = new ListNode(); preNode.next = head; let fast = preNode; let slow = preNode; while (n--) &#123; fast = fast.next; &#125; while (fast.next) &#123; fast = fast.next; slow = slow.next; &#125; slow.next = slow.next.next; return preNode.next;&#125;;","tags":["Javascript","ç®—æ³•","é“¾è¡¨","å¿«æ…¢æŒ‡é’ˆ"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹æœ€å°æ ˆ","path":"/2021/06/13/ç®—æ³•ä¹‹æœ€å°æ ˆ/","content":"è®¾è®¡ä¸€ä¸ªæ”¯æŒ push ï¼Œpop ï¼Œtop æ“ä½œï¼Œå¹¶èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…æ£€ç´¢åˆ°æœ€å°å…ƒç´ çš„æ ˆã€‚ push(x) â€”â€” å°†å…ƒç´  x æ¨å…¥æ ˆä¸­ã€‚pop() â€”â€” åˆ é™¤æ ˆé¡¶çš„å…ƒç´ ã€‚top() â€”â€” è·å–æ ˆé¡¶å…ƒç´ ã€‚getMin() â€”â€” æ£€ç´¢æ ˆä¸­çš„æœ€å°å…ƒç´ ã€‚ 12345678910111213141516171819ç¤ºä¾‹:è¾“å…¥ï¼š[&quot;MinStack&quot;,&quot;push&quot;,&quot;push&quot;,&quot;push&quot;,&quot;getMin&quot;,&quot;pop&quot;,&quot;top&quot;,&quot;getMin&quot;][[],[-2],[0],[-3],[],[],[],[]]è¾“å‡ºï¼š[null,null,null,null,-3,null,0,-2]è§£é‡Šï¼šMinStack minStack = new MinStack();minStack.push(-2);minStack.push(0);minStack.push(-3);minStack.getMin(); --&gt; è¿”å› -3.minStack.pop();minStack.top(); --&gt; è¿”å› 0.minStack.getMin(); --&gt; è¿”å› -2.ã€‚ å›¾è§£ï¼š é¢˜è§£ï¼š 12345678910111213141516171819202122232425262728293031323334/** * initialize your data structure here. */var MinStack = function() &#123; this.x_stack = []; this.min_stack = [Infinity];&#125;;MinStack.prototype.push = function(x) &#123; this.x_stack.push(x); this.min_stack.push(Math.min(this.min_stack[this.min_stack.length - 1], x));&#125;;MinStack.prototype.pop = function() &#123; this.x_stack.pop(); this.min_stack.pop();&#125;;MinStack.prototype.top = function() &#123; return this.x_stack[this.x_stack.length - 1];&#125;;MinStack.prototype.getMin = function() &#123; return this.min_stack[this.min_stack.length - 1];&#125;;/** * Your MinStack object will be instantiated and called as such: * var obj = new MinStack() * obj.push(val) * obj.pop() * var param_3 = obj.top() * var param_4 = obj.getMin() */","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","æ ˆ"],"categories":["Javascript"]},{"title":"ç®—æ³•ä¹‹ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­èŠ‚ç‚¹","path":"/2021/06/13/ç®—æ³•ä¹‹ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­èŠ‚ç‚¹/","content":"ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œä¸¤ä¸¤äº¤æ¢å…¶ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å›äº¤æ¢åçš„é“¾è¡¨ã€‚ ä½ ä¸èƒ½åªæ˜¯å•çº¯çš„æ”¹å˜èŠ‚ç‚¹å†…éƒ¨çš„å€¼ï¼Œè€Œæ˜¯éœ€è¦å®é™…çš„è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ã€‚ é¢˜è§£ï¼š 12345678910111213141516171819202122232425262728/** * Definition for singly-linked list. * function ListNode(val, next) &#123; * this.val = (val===undefined ? 0 : val) * this.next = (next===undefined ? null : next) * &#125; *//** * @param &#123;ListNode&#125; head * @return &#123;ListNode&#125; */var swapPairs = function(head) &#123; if(!head || !head.next)&#123; return head &#125;; let header = new ListNode(); header.next = head let vnode = header; while(head &amp;&amp; head.next)&#123; const temp = head.next; head.next = head.next.next; temp.next = head; vnode.next = temp; vnode = head; head = head.next; &#125; return header.next;&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","é“¾è¡¨"],"categories":["ç®—æ³•"]},{"title":"ç®—æ³•ä¹‹åè½¬é“¾è¡¨","path":"/2021/06/13/ç®—æ³•ä¹‹åè½¬é“¾è¡¨/","content":"206.ç»™ä½ å•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ head,è¯·ä½ åè½¬é“¾è¡¨ï¼Œå¹¶è¿”å›åè½¬åçš„é“¾è¡¨ è¿­ä»£è§£æ³•ï¼š 123456789101112if(!head)&#123; return head; &#125; const virsualNode = new ListNode(); virsualNode.next = head; while(head.next)&#123; let temp = head.next; head.next = head.next.next; temp.next = virsualNode.next; virsualNode.next = temp; &#125; return virsualNode.next","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","é“¾è¡¨"],"categories":["ç®—æ³•"]},{"title":"æ‰‹å†™Promise","path":"/2021/06/13/æ‰‹å†™Promise/","content":"æš‚æœªæ•´ç†ï¼Œå…ˆé™„ä¸Šä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146class _Promise &#123;constructor(excutor) &#123; this.state = &quot;pending&quot;; this.resolveInfo = undefined; this.rejectInfo = undefined; this.resolveCb = []; this.rejectCb = []; const resolve = (value) =&gt; &#123; if (this.state === &quot;pending&quot;) &#123; this.state = &quot;fullfilled&quot;; this.resolveInfo = value; this.resolveCb.forEach((fn) =&gt; &#123; fn(this.resolveInfo); &#125;); &#125; &#125;; const reject = (value) =&gt; &#123; if (this.state === &quot;pending&quot;) &#123; this.state = &quot;rejected&quot;; this.rejectInfo = value; this.rejectCb.forEach((fn) =&gt; &#123; fn(this.rejectInfo); &#125;); &#125; &#125;; try &#123; excutor(resolve, reject); &#125; catch (error) &#123; reject(error); &#125;&#125;then(onFullfilled, onRejected) &#123; const innerPromise = new _Promise((resolve, reject) =&gt; &#123; if (this.state === &quot;fullfilled&quot;) &#123; setTimeout(() =&gt; &#123; try &#123; const returnValue = typeof onFullfilled === &quot;function&quot; ? onFullfilled(this.resolveInfo) : (value) =&gt; value; _Promise.resolvePromise.apply( innerPromise, returnValue, resolve, reject ); &#125; catch (error) &#123; reject(error); &#125; &#125;, 0); &#125; if (this.state === &quot;rejected&quot;) &#123; setTimeout(() =&gt; &#123; try &#123; const returnValue = typeof onRejected === &quot;function&quot; ? onRejected(this.rejectInfo) : (value) =&gt; value; _Promise.resolvePromise.apply( innerPromise, returnValue, resolve, reject ); &#125; catch (error) &#123; reject(error); &#125; &#125;, 0); &#125; if (this.state === &quot;pending&quot;) &#123; this.resolveCb.push(() =&gt; &#123; setTimeout(() =&gt; &#123; try &#123; const returnValue = typeof onFullfilled === &quot;function&quot; ? onFullfilled(this.resolveInfo) : (value) =&gt; value; _Promise.resolvePromise.apply( innerPromise, returnValue, resolve, reject ); &#125; catch (error) &#123; reject(error); &#125; &#125;, 0); &#125;); this.rejectCb.push(() =&gt; &#123; setTimeout(() =&gt; &#123; try &#123; const returnValue = typeof onRejected === &quot;function&quot; ? onRejected(this.rejectInfo) : (value) =&gt; value; _Promise.resolvePromise.apply( innerPromise, returnValue, resolve, reject ); &#125; catch (error) &#123; reject(error); &#125; &#125;, 0); &#125;); &#125; &#125;); return innerPromise;&#125;static resolvePromise(newPromise, returnValue, resolve, reject) &#123; if (newPromise === returnValue) &#123; return reject(new Error(&quot;ä¸èƒ½é‡å¤å¼•ç”¨&quot;)); &#125; // é˜²æ­¢å¤šæ¬¡è°ƒç”¨ let called; if ( returnValue instanceof _Promise &amp;&amp; typeof returnValue.then === &quot;function&quot; ) &#123; returnValue.then( (innerResolveMsg) =&gt; &#123; if (called) return; called = true; resolvePromise(newPromise, innerResolveMsg, resolve, reject); &#125;, (innerRejectedMsg) =&gt; &#123; if (called) return; called = true; resolvePromise(newPromise, innerRejectedMsg, resolve, reject); &#125; ); &#125; else &#123; resolve(returnValue); &#125;&#125;&#125; ç›®å‰åªå®ç°äº†thenæ–¹æ³•ï¼Œåç»­è¿˜æœ‰resolve,reject,catch, all, race, finally","tags":["Javascript","é¢è¯•é¢˜","promise"],"categories":["Javascript"]},{"title":"å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡","path":"/2021/06/10/å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡/","content":"å®ä»»åŠ¡(macrotask)åœ¨ECMAScriptä¸­ï¼Œmacrotaskä¹Ÿè¢«ç§°ä¸ºtask æˆ‘ä»¬å¯ä»¥å°†æ¯æ¬¡æ‰§è¡Œæ ˆæ‰§è¡Œçš„ä»£ç å½“åšæ˜¯ä¸€ä¸ªå®ä»»åŠ¡(åŒ…æ‹¬æ¯æ¬¡ä»äº‹ä»¶é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªäº‹ä»¶å›è°ƒå¹¶æ”¾åˆ°æ‰§è¡Œæ ˆä¸­æ‰§è¡Œ)ï¼Œ æ¯ä¸€ä¸ªå®ä»»åŠ¡ä¼šä»å¤´åˆ°å°¾æ‰§è¡Œå®Œæ¯•ï¼Œä¸ä¼šæ‰§è¡Œå…¶ä»– ç”±äºJSå¼•æ“çº¿ç¨‹å’ŒGUIæ¸²æŸ“çº¿ç¨‹æ˜¯äº’æ–¥çš„å…³ç³»ï¼Œæµè§ˆå™¨ä¸ºäº†èƒ½å¤Ÿä½¿å®ä»»åŠ¡å’ŒDOMä»»åŠ¡æœ‰åºçš„è¿›è¡Œï¼Œä¼šåœ¨ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œç»“æœåï¼Œåœ¨ä¸‹ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œå‰ï¼ŒGUIæ¸²æŸ“çº¿ç¨‹å¼€å§‹å·¥ä½œï¼Œå¯¹é¡µé¢è¿›è¡Œæ¸²æŸ“ 12å®ä»»åŠ¡ -&gt; GUIæ¸²æŸ“ -&gt; å®ä»»åŠ¡ -&gt; ...å¤åˆ¶ä»£ç  å¸¸è§çš„å®ä»»åŠ¡ ä¸»ä»£ç å— setTimeout setInterval setImmediate ()-Node requestAnimationFrame ()-æµè§ˆå™¨ å¾®ä»»åŠ¡(microtask)ES6æ–°å¼•å…¥äº†Promiseæ ‡å‡†ï¼ŒåŒæ—¶æµè§ˆå™¨å®ç°ä¸Šå¤šäº†ä¸€ä¸ªmicrotaskå¾®ä»»åŠ¡æ¦‚å¿µï¼Œåœ¨ECMAScriptä¸­ï¼Œmicrotaskä¹Ÿè¢«ç§°ä¸ºjobs æˆ‘ä»¬å·²ç»çŸ¥é“å®ä»»åŠ¡ç»“æŸåï¼Œä¼šæ‰§è¡Œæ¸²æŸ“ï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼Œ è€Œå¾®ä»»åŠ¡å¯ä»¥ç†è§£æˆåœ¨å½“å‰å®ä»»åŠ¡æ‰§è¡Œåç«‹å³æ‰§è¡Œçš„ä»»åŠ¡ å½“ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œï¼Œä¼šåœ¨æ¸²æŸ“å‰ï¼Œå°†æ‰§è¡ŒæœŸé—´æ‰€äº§ç”Ÿçš„æ‰€æœ‰å¾®ä»»åŠ¡éƒ½æ‰§è¡Œå®Œ 12å®ä»»åŠ¡ -&gt; å¾®ä»»åŠ¡ -&gt; GUIæ¸²æŸ“ -&gt; å®ä»»åŠ¡ -&gt; ... å¸¸è§å¾®ä»»åŠ¡ process.nextTick ()-Node Promise.then() catch finally Object.observe MutationObserver ç®€å•åŒºåˆ†å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡çœ‹äº†ä¸Šè¿°å®ä»»åŠ¡å¾®ä»»åŠ¡çš„è§£é‡Šä½ å¯èƒ½è¿˜ä¸å¤ªæ¸…æ¥šï¼Œæ²¡å…³ç³»ï¼Œå¾€ä¸‹çœ‹ï¼Œå…ˆè®°ä½é‚£äº›å¸¸è§çš„å®å¾®ä»»åŠ¡å³å¯ æˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­æ¥çœ‹ï¼Œè¿™å‡ ä¸ªä¾‹å­æ€è·¯æ¥è‡ªæ˜é‡‘äº‘ä¸­å›çš„æ–‡ç« å‚è€ƒé“¾æ¥ã€14ã€‘ï¼Œé€šè¿‡æ¸²æŸ“èƒŒæ™¯é¢œè‰²æ¥åŒºåˆ†å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ï¼Œå¾ˆç›´è§‚ï¼Œæˆ‘è§‰å¾—å¾ˆæœ‰æ„æ€ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿç”¨è¿™ç§ä¾‹å­ æ‰¾ä¸€ä¸ªç©ºç™½çš„é¡µé¢ï¼Œåœ¨consoleä¸­è¾“å…¥ä»¥ä¸‹ä»£ç  12345document.body.style = &#x27;background:black&#x27;;document.body.style = &#x27;background:red&#x27;;document.body.style = &#x27;background:blue&#x27;;document.body.style = &#x27;background:pink&#x27;; æˆ‘ä»¬çœ‹åˆ°ä¸Šé¢åŠ¨å›¾èƒŒæ™¯ç›´æ¥æ¸²æŸ“äº†ç²‰çº¢è‰²ï¼Œæ ¹æ®ä¸Šæ–‡é‡Œè®²æµè§ˆå™¨ä¼šå…ˆæ‰§è¡Œå®Œä¸€ä¸ªå®ä»»åŠ¡ï¼Œå†æ‰§è¡Œå½“å‰æ‰§è¡Œæ ˆçš„æ‰€æœ‰å¾®ä»»åŠ¡ï¼Œç„¶åç§»äº¤GUIæ¸²æŸ“ï¼Œä¸Šé¢å››è¡Œä»£ç å‡å±äºåŒä¸€æ¬¡å®ä»»åŠ¡ï¼Œå…¨éƒ¨æ‰§è¡Œå®Œæ‰ä¼šæ‰§è¡Œæ¸²æŸ“ï¼Œæ¸²æŸ“æ—¶GUIçº¿ç¨‹ä¼šå°†æ‰€æœ‰UIæ”¹åŠ¨ä¼˜åŒ–åˆå¹¶ï¼Œæ‰€ä»¥è§†è§‰ä¸Šï¼Œåªä¼šçœ‹åˆ°é¡µé¢å˜æˆç²‰çº¢è‰² å†æ¥ç€çœ‹ 12345document.body.style = &#x27;background:blue&#x27;;setTimeout(()=&gt;&#123; document.body.style = &#x27;background:black&#x27;&#125;,200) ä¸Šè¿°ä»£ç ä¸­ï¼Œé¡µé¢ä¼šå…ˆå¡ä¸€ä¸‹è“è‰²ï¼Œå†å˜æˆé»‘è‰²èƒŒæ™¯ï¼Œé¡µé¢ä¸Šå†™çš„æ˜¯200æ¯«ç§’ï¼Œå¤§å®¶å¯ä»¥æŠŠå®ƒå½“æˆ0æ¯«ç§’ï¼Œå› ä¸º0æ¯«ç§’çš„è¯ç”±äºæµè§ˆå™¨æ¸²æŸ“å¤ªå¿«ï¼Œå½•å±ä¸å¥½æ•æ‰ï¼Œæˆ‘åˆæ²¡å•¥å½•å±æ…¢æ”¾çš„å·¥å…·ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œæµ‹è¯•çš„ï¼Œç»“æœä¹Ÿæ˜¯ä¸€æ ·ï¼Œæœ€å®‰å…¨çš„æ–¹æ³•æ˜¯å†™ä¸€ä¸ªindex.htmlæ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ’å…¥ä¸Šé¢çš„jsè„šæœ¬ï¼Œç„¶åæµè§ˆå™¨æ‰“å¼€ï¼Œè°·æ­Œä¸‹ä½¿ç”¨æ§åˆ¶å°ä¸­performanceåŠŸèƒ½æŸ¥çœ‹ä¸€å¸§ä¸€å¸§çš„åŠ è½½æœ€ä¸ºæ°å½“ï¼Œä¸è¿‡è¿™æ ·å½•å±ä¸å¥½å½•æ‰€ä»¥ã€‚ã€‚ã€‚ å›å½’æ­£é¢˜ï¼Œä¹‹æ‰€ä»¥ä¼šå¡ä¸€ä¸‹è“è‰²ï¼Œæ˜¯å› ä¸ºä»¥ä¸Šä»£ç å±äºä¸¤æ¬¡å®ä»»åŠ¡ï¼Œç¬¬ä¸€æ¬¡å®ä»»åŠ¡æ‰§è¡Œçš„ä»£ç æ˜¯å°†èƒŒæ™¯å˜æˆè“è‰²ï¼Œç„¶åè§¦å‘æ¸²æŸ“ï¼Œå°†é¡µé¢å˜æˆè“è‰²ï¼Œå†è§¦å‘ç¬¬äºŒæ¬¡å®ä»»åŠ¡å°†èƒŒæ™¯å˜æˆé»‘è‰² å†æ¥çœ‹ 12345678document.body.style = &#x27;background:blue&#x27;console.log(1);Promise.resolve().then(()=&gt;&#123; console.log(2); document.body.style = &#x27;background:pink&#x27;&#125;);console.log(3); æ§åˆ¶å°è¾“å‡º 1 3 2 , æ˜¯å› ä¸º promise å¯¹è±¡çš„ then æ–¹æ³•çš„å›è°ƒå‡½æ•°æ˜¯å¼‚æ­¥æ‰§è¡Œï¼Œæ‰€ä»¥ 2 æœ€åè¾“å‡º é¡µé¢çš„èƒŒæ™¯è‰²ç›´æ¥å˜æˆç²‰è‰²ï¼Œæ²¡æœ‰ç»è¿‡è“è‰²çš„é˜¶æ®µï¼Œæ˜¯å› ä¸ºï¼Œæˆ‘ä»¬åœ¨å®ä»»åŠ¡ä¸­å°†èƒŒæ™¯è®¾ç½®ä¸ºè“è‰²ï¼Œä½†åœ¨è¿›è¡Œæ¸²æŸ“å‰æ‰§è¡Œäº†å¾®ä»»åŠ¡ï¼Œ åœ¨å¾®ä»»åŠ¡ä¸­å°†èƒŒæ™¯å˜æˆäº†ç²‰è‰²ï¼Œç„¶åæ‰æ‰§è¡Œçš„æ¸²æŸ“ å¾®ä»»åŠ¡å®ä»»åŠ¡æ³¨æ„ç‚¹ æµè§ˆå™¨ä¼šå…ˆæ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼Œç´§æ¥ç€æ‰§è¡Œå½“å‰æ‰§è¡Œæ ˆäº§ç”Ÿçš„å¾®ä»»åŠ¡ï¼Œå†è¿›è¡Œæ¸²æŸ“ï¼Œç„¶åå†æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡ä¸åœ¨ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸åœ¨ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ— ä¾‹å¦‚setTimeoutæ˜¯ä¸€ä¸ªå®ä»»åŠ¡ï¼Œå®ƒçš„äº‹ä»¶å›è°ƒåœ¨å®ä»»åŠ¡é˜Ÿåˆ—ï¼ŒPromise.then()æ˜¯ä¸€ä¸ªå¾®ä»»åŠ¡ï¼Œå®ƒçš„äº‹ä»¶å›è°ƒåœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ŒäºŒè€…å¹¶ä¸æ˜¯ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ— ä»¥Chrome ä¸ºä¾‹ï¼Œæœ‰å…³æ¸²æŸ“çš„éƒ½æ˜¯åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­æ‰§è¡Œï¼Œæ¸²æŸ“è¿›ç¨‹ä¸­çš„ä»»åŠ¡ï¼ˆDOMæ ‘æ„å»ºï¼Œjsè§£æâ€¦ç­‰ç­‰ï¼‰éœ€è¦ä¸»çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡éƒ½ä¼šåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè€Œæµè§ˆå™¨ç»´æŠ¤äº†ä¸€å¥—äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œä¸»çº¿ç¨‹ä¸Šçš„ä»»åŠ¡éƒ½ä¼šæ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ‰§è¡Œï¼Œä¸»çº¿ç¨‹ä¼šå¾ªç¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶ä»å¤´éƒ¨å–å‡ºä»»åŠ¡è¿›è¡Œæ‰§è¡Œï¼Œå¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿå…¶ä»–ä»»åŠ¡éœ€è¦ä¸»çº¿ç¨‹æ‰§è¡Œçš„ï¼Œæ¸²æŸ“è¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹ä¼šæŠŠè¯¥ä»»åŠ¡å¡å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡éƒ½æ˜¯å®ä»»åŠ¡ å¾®ä»»åŠ¡æ˜¯å¦‚ä½•äº§ç”Ÿçš„å‘¢ï¼Ÿå½“æ‰§è¡Œåˆ°scriptè„šæœ¬çš„æ—¶å€™ï¼Œjså¼•æ“ä¼šä¸ºå…¨å±€åˆ›å»ºä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œåœ¨è¯¥æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ç»´æŠ¤äº†ä¸€ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå½“é‡åˆ°å¾®ä»»åŠ¡ï¼Œå°±ä¼šæŠŠå¾®ä»»åŠ¡å›è°ƒæ”¾åœ¨å¾®é˜Ÿåˆ—ä¸­ï¼Œå½“æ‰€æœ‰çš„jsä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œåœ¨é€€å‡ºå…¨å±€ä¸Šä¸‹æ–‡ä¹‹å‰å¼•æ“ä¼šå»æ£€æŸ¥è¯¥é˜Ÿåˆ—ï¼Œæœ‰å›è°ƒå°±æ‰§è¡Œï¼Œæ²¡æœ‰å°±é€€å‡ºæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå¾®ä»»åŠ¡è¦æ—©äºå®ä»»åŠ¡ï¼Œä¹Ÿæ˜¯å¤§å®¶å¸¸è¯´çš„ï¼Œæ¯ä¸ªå®ä»»åŠ¡éƒ½æœ‰ä¸€ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆç”±äºå®šæ—¶å™¨æ˜¯æµè§ˆå™¨çš„APIï¼Œæ‰€ä»¥å®šæ—¶å™¨æ˜¯å®ä»»åŠ¡ï¼Œåœ¨jsä¸­é‡åˆ°å®šæ—¶å™¨ä¼šä¹Ÿæ˜¯æ”¾å…¥åˆ°æµè§ˆå™¨çš„é˜Ÿåˆ—ä¸­ï¼‰ å›¾è§£å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ é¦–å…ˆæ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼Œæ‰§è¡Œç»“æŸååˆ¤æ–­æ˜¯å¦å­˜åœ¨å¾®ä»»åŠ¡ æœ‰å¾®ä»»åŠ¡å…ˆæ‰§è¡Œæ‰€æœ‰çš„å¾®ä»»åŠ¡ï¼Œå†æ¸²æŸ“ï¼Œæ²¡æœ‰å¾®ä»»åŠ¡åˆ™ç›´æ¥æ¸²æŸ“ ç„¶åå†æ¥ç€æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ å®Œæ•´çš„Event loop é¦–å…ˆï¼Œæ•´ä½“çš„script(ä½œä¸ºç¬¬ä¸€ä¸ªå®ä»»åŠ¡)å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šæŠŠæ‰€æœ‰ä»£ç åˆ†ä¸ºåŒæ­¥ä»»åŠ¡ã€å¼‚æ­¥ä»»åŠ¡ä¸¤éƒ¨åˆ† åŒæ­¥ä»»åŠ¡ä¼šç›´æ¥è¿›å…¥ä¸»çº¿ç¨‹ä¾æ¬¡æ‰§è¡Œ å¼‚æ­¥ä»»åŠ¡ä¼šå†åˆ†ä¸ºå®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ å®ä»»åŠ¡è¿›å…¥åˆ°Event Tableä¸­ï¼Œå¹¶åœ¨é‡Œé¢æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œæ¯å½“æŒ‡å®šçš„äº‹ä»¶å®Œæˆæ—¶ï¼ŒEvent Tableä¼šå°†è¿™ä¸ªå‡½æ•°ç§»åˆ°Event Queueä¸­ å¾®ä»»åŠ¡ä¹Ÿä¼šè¿›å…¥åˆ°å¦ä¸€ä¸ªEvent Tableä¸­ï¼Œå¹¶åœ¨é‡Œé¢æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œæ¯å½“æŒ‡å®šçš„äº‹ä»¶å®Œæˆæ—¶ï¼ŒEvent Tableä¼šå°†è¿™ä¸ªå‡½æ•°ç§»åˆ°Event Queueä¸­ å½“ä¸»çº¿ç¨‹å†…çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œä¸»çº¿ç¨‹ä¸ºç©ºæ—¶ï¼Œä¼šæ£€æŸ¥å¾®ä»»åŠ¡çš„Event Queueï¼Œå¦‚æœæœ‰ä»»åŠ¡ï¼Œå°±å…¨éƒ¨æ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰å°±æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ ä¸Šè¿°è¿‡ç¨‹ä¼šä¸æ–­é‡å¤ï¼Œè¿™å°±æ˜¯Event Loopï¼Œæ¯”è¾ƒå®Œæ•´çš„äº‹ä»¶å¾ªç¯","tags":["Event Loop","æµè§ˆå™¨","å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡","äº‹ä»¶å¾ªç¯"],"categories":["Javascript"]},{"title":"Event Loopè½®è¯¢å¤„ç†çº¿ç¨‹","path":"/2021/06/10/Event-Loopè½®è¯¢å¤„ç†çº¿ç¨‹/","content":"é¦–å…ˆè¦æ˜ç™½ï¼Œ jsä»£ç é‡Œå¤´ æœ‰åŒæ­¥çš„ä»»åŠ¡ï¼Œæ˜¯ç”±JSå¼•æ“çº¿ç¨‹å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ä¸»çº¿ç¨‹ï¼ŒåŒæ­¥ä»»åŠ¡éƒ½åœ¨ä¸»çº¿ç¨‹(è¿™é‡Œçš„ä¸»çº¿ç¨‹å°±æ˜¯JSå¼•æ“çº¿ç¨‹)ä¸Šæ‰§è¡Œ ï¼Œå½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆ jsä»£ç é‡Œå¤´ æœ‰å¼‚æ­¥çš„ä»»åŠ¡ï¼Œå„ç§å„æ ·çš„å¼‚æ­¥ä»»åŠ¡ï¼Œå„ç§å„æ ·çš„å¼‚æ­¥ä»»åŠ¡åœ¨å„ä¸ªå¯¹åº”çš„çº¿ç¨‹ä¸­è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚settimeoutå¼‚æ­¥ä»»åŠ¡å°±åœ¨å®šæ—¶è§¦å‘å™¨çº¿ç¨‹ä¸­å¤„ç†ï¼Œajaxï¼Œfetchè¿™äº›çš„jsåº“çš„æœ¬è´¨çš„è¯·æ±‚ä»£ç æ˜¯ç”±å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹å¤„ç†çš„ã€‚ ä¸»çº¿ç¨‹ï¼Œä¹‹å¤–è¿˜æœ‰ä¸€ä¸ª ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¿™ä¸ªä»»åŠ¡é˜Ÿåˆ—å½’ äº‹ä»¶è§¦å‘çº¿ç¨‹ ç®¡ï¼Œ åªè¦å¼‚æ­¥ä»»åŠ¡æœ‰äº†è¿è¡Œç»“æœ ï¼Œå°±åœ¨è¿™ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¸­åŠ ä¸€ä¸ªå®ƒçš„äº‹ä»¶å›è°ƒã€‚ ä¸€æ—¦æ‰§è¡Œæ ˆä¸­çš„æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•(ä¹Ÿå°±æ˜¯JSå¼•æ“çº¿ç¨‹ç©ºé—²äº†)ï¼Œç³»ç»Ÿå°±ä¼šè¯»å–ä»»åŠ¡é˜Ÿåˆ—ï¼Œå°†å¯è¿è¡Œçš„å¼‚æ­¥ä»»åŠ¡(ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„äº‹ä»¶å›è°ƒï¼Œåªè¦ä»»åŠ¡é˜Ÿåˆ—ä¸­æœ‰äº‹ä»¶å›è°ƒï¼Œå°±è¯´æ˜å¯ä»¥æ‰§è¡Œ)æ·»åŠ åˆ°æ‰§è¡Œæ ˆä¸­ï¼Œå¼€å§‹æ‰§è¡Œ è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç®€å•æ¦‚æ‹¬ä¸ºï¼Œä¸Šé¢è¿™3ä¸ªä¸œè¥¿ä¹‹é—´çš„äº¤æµï¼Œä»–ä»¬äº¤æµçš„ä¸­ä»‹ï¼Œå°±æ˜¯ EventLoopè½®è¯¢å¤„ç†çº¿ç¨‹ ï¼Œ æ—¢ç„¶å«è½®è¯¢äº†ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯ä¸æ–­çš„å¾ªç¯çš„å»äº¤æµå’Œæ²Ÿé€š çœ‹ä¸€æ®µä»£ç  12345678910111213141516171819let setTimeoutCallBack = function() &#123; console.log(&#x27;æˆ‘æ˜¯å®šæ—¶å™¨å›è°ƒ&#x27;);&#125;;let httpCallback = function() &#123; console.log(&#x27;æˆ‘æ˜¯httpè¯·æ±‚å›è°ƒ&#x27;);&#125;// åŒæ­¥ä»»åŠ¡console.log(&#x27;æˆ‘æ˜¯åŒæ­¥ä»»åŠ¡1&#x27;);// å¼‚æ­¥å®šæ—¶ä»»åŠ¡setTimeout(setTimeoutCallBack,1000);// å¼‚æ­¥httpè¯·æ±‚ä»»åŠ¡ajax.get(&#x27;/info&#x27;,httpCallback);// åŒæ­¥ä»»åŠ¡console.log(&#x27;æˆ‘æ˜¯åŒæ­¥ä»»åŠ¡2&#x27;); JSæ˜¯æŒ‰ç…§é¡ºåºä»ä¸Šå¾€ä¸‹ä¾æ¬¡æ‰§è¡Œçš„ï¼Œå¯ä»¥å…ˆç†è§£ä¸ºè¿™æ®µä»£ç æ—¶çš„æ‰§è¡Œç¯å¢ƒå°±æ˜¯ä¸»çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¹Ÿå°±æ˜¯å½“å‰æ‰§è¡Œæ ˆ ä»¥ä¸‹æ˜¯é¡ºåº æ‰§è¡Œconsole.log(&#39;æˆ‘æ˜¯åŒæ­¥ä»»åŠ¡1&#39;) ï¼Œä¸»çº¿ç¨‹ä¸­è¿è¡Œ æ¥ç€ï¼Œæ‰§è¡Œåˆ°setTimeoutæ—¶ä¼š ç§»äº¤ç»™å®šæ—¶è§¦å‘å™¨çº¿ç¨‹ ï¼Œé€šçŸ¥å®šæ—¶è§¦å‘å™¨çº¿ç¨‹ 1s åå°† setTimeoutCallBack è¿™ä¸ªå›è°ƒäº¤ç»™äº‹ä»¶è§¦å‘çº¿ç¨‹å¤„ç† åœ¨ 1s åäº‹ä»¶è§¦å‘çº¿ç¨‹ä¼šæ”¶åˆ° setTimeoutCallBack è¿™ä¸ªå›è°ƒå¹¶æŠŠå®ƒåŠ å…¥åˆ°äº‹ä»¶è§¦å‘çº¿ç¨‹æ‰€ç®¡ç†çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œ æ‰§è¡Œhttpè¯·æ±‚ ç§»äº¤ç»™å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹å‘é€ç½‘ç»œè¯·æ±‚ è¯·æ±‚æˆåŠŸåå°† httpCallback è¿™ä¸ªå›è°ƒäº¤ç”±äº‹ä»¶è§¦å‘çº¿ç¨‹å¤„ç†ï¼Œäº‹ä»¶è§¦å‘çº¿ç¨‹æ”¶åˆ° httpCallback è¿™ä¸ªå›è°ƒåæŠŠå®ƒåŠ å…¥åˆ°äº‹ä»¶è§¦å‘çº¿ç¨‹æ‰€ç®¡ç†çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œ æ‰§è¡Œconsole.log(&#39;æˆ‘æ˜¯åŒæ­¥ä»»åŠ¡2&#39;) ä¸»çº¿ç¨‹æ‰§è¡Œæ ˆä¸­æ‰§è¡Œå®Œæ¯• ï¼ŒJSå¼•æ“å·²ç»ç©ºé—²äº†ï¼Œ å‘äº‹ä»¶è§¦å‘çº¿ç¨‹å‘èµ·è¯¢é—®ï¼Œè¯¢é—®äº‹ä»¶è§¦å‘çº¿ç¨‹çš„äº‹ä»¶é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰éœ€è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•° å¦‚æœæœ‰å°†äº‹ä»¶é˜Ÿåˆ—ä¸­çš„å›è°ƒäº‹ä»¶åŠ å…¥æ‰§è¡Œæ ˆä¸­ï¼Œå¼€å§‹æ‰§è¡Œå›è°ƒ å¦‚æœäº‹ä»¶é˜Ÿåˆ—ä¸­æ²¡æœ‰å›è°ƒï¼ŒJSå¼•æ“çº¿ç¨‹ä¼šä¸€ç›´å‘èµ·è¯¢é—®ï¼Œç›´åˆ°æœ‰ä¸ºæ­¢ å›¾è§£Event Loop é¦–å…ˆï¼Œæ‰§è¡Œæ ˆå¼€å§‹é¡ºåºæ‰§è¡Œ åˆ¤æ–­æ˜¯å¦ä¸ºåŒæ­¥ï¼Œå¼‚æ­¥åˆ™è¿›å…¥å¼‚æ­¥çº¿ç¨‹ï¼Œæœ€ç»ˆäº‹ä»¶å›è°ƒç»™äº‹ä»¶è§¦å‘çº¿ç¨‹çš„ä»»åŠ¡é˜Ÿåˆ—ç­‰å¾…æ‰§è¡Œï¼ŒåŒæ­¥ç»§ç»­æ‰§è¡Œ æ‰§è¡Œæ ˆç©ºï¼Œè¯¢é—®ä»»åŠ¡é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰äº‹ä»¶å›è°ƒ ä»»åŠ¡é˜Ÿåˆ—ä¸­æœ‰äº‹ä»¶å›è°ƒåˆ™æŠŠå›è°ƒåŠ å…¥æ‰§è¡Œæ ˆæœ«å°¾ç»§ç»­ä»ç¬¬ä¸€æ­¥å¼€å§‹æ‰§è¡Œ ä»»åŠ¡é˜Ÿåˆ—ä¸­æ²¡æœ‰äº‹ä»¶å›è°ƒåˆ™ä¸åœå‘èµ·è¯¢é—® å®Œæ•´çš„å›¾è§£Event loopå¯ä»¥å†ç»“åˆå®ä»»åŠ¡å’Œå¾®ä»»åŠ¡å¾—å‡º","tags":["Event Loop","è¿›ç¨‹å’Œçº¿ç¨‹","æµè§ˆå™¨","jså¼•æ“"],"categories":["æµè§ˆå™¨"]},{"title":"æµè§ˆå™¨çš„æ¸²æŸ“è¿›ç¨‹ï¼ˆrendererï¼‰","path":"/2021/06/10/æµè§ˆå™¨çš„æ¸²æŸ“è¿›ç¨‹ï¼ˆrendererï¼‰/","content":"ç®€è¿°æ¸²æŸ“è¿›ç¨‹Renderer é¡µé¢çš„æ¸²æŸ“ï¼ŒJSçš„æ‰§è¡Œï¼Œäº‹ä»¶çš„å¾ªç¯ï¼Œéƒ½åœ¨æ¸²æŸ“è¿›ç¨‹å†…æ‰§è¡Œã€‚ æ¸²æŸ“è¿›ç¨‹Rendererçš„ä¸»è¦çº¿ç¨‹GUIæ¸²æŸ“çº¿ç¨‹ è´Ÿè´£æ¸²æŸ“æµè§ˆå™¨ç•Œé¢ï¼Œè§£æHTMLï¼ŒCSSï¼Œæ„å»ºDOMæ ‘å’ŒRenderObjectæ ‘ï¼Œå¸ƒå±€å’Œç»˜åˆ¶ç­‰ è§£æhtmlä»£ç (HTMLä»£ç æœ¬è´¨æ˜¯å­—ç¬¦ä¸²)è½¬åŒ–ä¸ºæµè§ˆå™¨è®¤è¯†çš„èŠ‚ç‚¹ï¼Œç”ŸæˆDOMæ ‘ï¼Œä¹Ÿå°±æ˜¯DOM Tree è§£æcssï¼Œç”ŸæˆCSSOM(CSSè§„åˆ™æ ‘) æŠŠDOM Tree å’ŒCSSOMç»“åˆï¼Œç”ŸæˆRendering Tree(æ¸²æŸ“æ ‘) å½“æˆ‘ä»¬ä¿®æ”¹äº†ä¸€äº›å…ƒç´ çš„é¢œè‰²æˆ–è€…èƒŒæ™¯è‰²ï¼Œé¡µé¢å°±ä¼šé‡ç»˜(Repaint) å½“æˆ‘ä»¬ä¿®æ”¹å…ƒç´ çš„å°ºå¯¸ï¼Œé¡µé¢å°±ä¼šå›æµ(Reflow) å½“é¡µé¢éœ€è¦Repaingå’ŒReflowæ—¶GUIçº¿ç¨‹æ‰§è¡Œï¼Œç»˜åˆ¶é¡µé¢ å›æµ(Reflow)æ¯”é‡ç»˜(Repaint)çš„æˆæœ¬è¦é«˜ï¼Œæˆ‘ä»¬è¦å°½é‡é¿å…Reflowå’ŒRepaint GUIæ¸²æŸ“çº¿ç¨‹ä¸JSå¼•æ“çº¿ç¨‹æ˜¯äº’æ–¥çš„ å½“JSå¼•æ“æ‰§è¡Œæ—¶GUIçº¿ç¨‹ä¼šè¢«æŒ‚èµ·(ç›¸å½“äºè¢«å†»ç»“äº†) GUIæ›´æ–°ä¼šè¢«ä¿å­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ç­‰åˆ°JSå¼•æ“ç©ºé—²æ—¶ç«‹å³è¢«æ‰§è¡Œ JSå¼•æ“çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ JSå¼•æ“çº¿ç¨‹å°±æ˜¯JSå†…æ ¸ï¼Œè´Ÿè´£å¤„ç†Javascriptè„šæœ¬ç¨‹åº(ä¾‹å¦‚V8å¼•æ“) JSå¼•æ“çº¿ç¨‹è´Ÿè´£è§£æJavascriptè„šæœ¬ï¼Œè¿è¡Œä»£ç  JSå¼•æ“ä¸€ç›´ç­‰å¾…ç€ä»»åŠ¡é˜Ÿåˆ—ä¸­ä»»åŠ¡çš„åˆ°æ¥ï¼Œç„¶ååŠ ä»¥å¤„ç† æµè§ˆå™¨åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªJSå¼•æ“çº¿ç¨‹åœ¨è¿è¡ŒJSç¨‹åºï¼Œæ‰€ä»¥jsæ˜¯å•çº¿ç¨‹è¿è¡Œçš„ ä¸€ä¸ªTabé¡µ(rendererè¿›ç¨‹)ä¸­æ— è®ºä»€ä¹ˆæ—¶å€™éƒ½åªæœ‰ä¸€ä¸ªJSçº¿ç¨‹åœ¨è¿è¡ŒJSç¨‹åº GUIæ¸²æŸ“çº¿ç¨‹ä¸JSå¼•æ“çº¿ç¨‹æ˜¯äº’æ–¥çš„ï¼Œjså¼•æ“çº¿ç¨‹ä¼šé˜»å¡GUIæ¸²æŸ“çº¿ç¨‹ å°±æ˜¯æˆ‘ä»¬å¸¸é‡åˆ°çš„JSæ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œé€ æˆé¡µé¢çš„æ¸²æŸ“ä¸è¿è´¯ï¼Œå¯¼è‡´é¡µé¢æ¸²æŸ“åŠ è½½é˜»å¡(å°±æ˜¯åŠ è½½æ…¢) ä¾‹å¦‚æµè§ˆå™¨æ¸²æŸ“çš„æ—¶å€™é‡åˆ°scriptæ ‡ç­¾ï¼Œå°±ä¼šåœæ­¢GUIçš„æ¸²æŸ“ï¼Œç„¶åjså¼•æ“çº¿ç¨‹å¼€å§‹å·¥ä½œï¼Œæ‰§è¡Œé‡Œé¢çš„jsä»£ç ï¼Œç­‰jsæ‰§è¡Œå®Œæ¯•ï¼Œjså¼•æ“çº¿ç¨‹åœæ­¢å·¥ä½œï¼ŒGUIç»§ç»­æ¸²æŸ“ä¸‹é¢çš„å†…å®¹ã€‚æ‰€ä»¥å¦‚æœjsæ‰§è¡Œæ—¶é—´å¤ªé•¿å°±ä¼šé€ æˆé¡µé¢å¡é¡¿çš„æƒ…å†µ äº‹ä»¶è§¦å‘çº¿ç¨‹ å±äºæµè§ˆå™¨è€Œä¸æ˜¯JSå¼•æ“ï¼Œç”¨æ¥æ§åˆ¶äº‹ä»¶å¾ªç¯ï¼Œå¹¶ä¸”ç®¡ç†ç€ä¸€ä¸ªäº‹ä»¶é˜Ÿåˆ—(task queue) å½“jsæ‰§è¡Œç¢°åˆ°äº‹ä»¶ç»‘å®šå’Œä¸€äº›å¼‚æ­¥æ“ä½œ(å¦‚setTimeOutï¼Œä¹Ÿå¯æ¥è‡ªæµè§ˆå™¨å†…æ ¸çš„å…¶ä»–çº¿ç¨‹ï¼Œå¦‚é¼ æ ‡ç‚¹å‡»ã€AJAXå¼‚æ­¥è¯·æ±‚ç­‰)ï¼Œä¼šèµ°äº‹ä»¶è§¦å‘çº¿ç¨‹å°†å¯¹åº”çš„äº‹ä»¶æ·»åŠ åˆ°å¯¹åº”çš„çº¿ç¨‹ä¸­(æ¯”å¦‚å®šæ—¶å™¨æ“ä½œï¼Œä¾¿æŠŠå®šæ—¶å™¨äº‹ä»¶æ·»åŠ åˆ°å®šæ—¶å™¨çº¿ç¨‹)ï¼Œç­‰å¼‚æ­¥äº‹ä»¶æœ‰äº†ç»“æœï¼Œä¾¿æŠŠä»–ä»¬çš„å›è°ƒæ“ä½œæ·»åŠ åˆ°äº‹ä»¶é˜Ÿåˆ—ï¼Œç­‰å¾…jså¼•æ“çº¿ç¨‹ç©ºé—²æ—¶æ¥å¤„ç†ã€‚ å½“å¯¹åº”çš„äº‹ä»¶ç¬¦åˆè§¦å‘æ¡ä»¶è¢«è§¦å‘æ—¶ï¼Œè¯¥çº¿ç¨‹ä¼šæŠŠäº‹ä»¶æ·»åŠ åˆ°å¾…å¤„ç†é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç­‰å¾…JSå¼•æ“çš„å¤„ç† å› ä¸ºJSæ˜¯å•çº¿ç¨‹ï¼Œæ‰€ä»¥è¿™äº›å¾…å¤„ç†é˜Ÿåˆ—ä¸­çš„äº‹ä»¶éƒ½å¾—æ’é˜Ÿç­‰å¾…JSå¼•æ“å¤„ç† å®šæ—¶è§¦å‘å™¨çº¿ç¨‹ setIntervalä¸setTimeoutæ‰€åœ¨çº¿ç¨‹ æµè§ˆå™¨å®šæ—¶è®¡æ•°å™¨å¹¶ä¸æ˜¯ç”±JavaScriptå¼•æ“è®¡æ•°çš„(å› ä¸ºJavaScriptå¼•æ“æ˜¯å•çº¿ç¨‹çš„ï¼Œå¦‚æœå¤„äºé˜»å¡çº¿ç¨‹çŠ¶æ€å°±ä¼šå½±å“è®°è®¡æ—¶çš„å‡†ç¡®) é€šè¿‡å•ç‹¬çº¿ç¨‹æ¥è®¡æ—¶å¹¶è§¦å‘å®šæ—¶(è®¡æ—¶å®Œæ¯•åï¼Œæ·»åŠ åˆ°äº‹ä»¶è§¦å‘çº¿ç¨‹çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…JSå¼•æ“ç©ºé—²åæ‰§è¡Œ)ï¼Œè¿™ä¸ªçº¿ç¨‹å°±æ˜¯å®šæ—¶è§¦å‘å™¨çº¿ç¨‹ï¼Œä¹Ÿå«å®šæ—¶å™¨çº¿ç¨‹ W3Cåœ¨HTMLæ ‡å‡†ä¸­è§„å®šï¼Œè§„å®šè¦æ±‚setTimeoutä¸­ä½äº4msçš„æ—¶é—´é—´éš”ç®—ä¸º4ms å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹ åœ¨XMLHttpRequeståœ¨è¿æ¥åæ˜¯é€šè¿‡æµè§ˆå™¨æ–°å¼€ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚ å°†æ£€æµ‹åˆ°çŠ¶æ€å˜æ›´æ—¶ï¼Œå¦‚æœè®¾ç½®æœ‰å›è°ƒå‡½æ•°ï¼Œå¼‚æ­¥çº¿ç¨‹å°±äº§ç”ŸçŠ¶æ€å˜æ›´äº‹ä»¶ï¼Œå°†è¿™ä¸ªå›è°ƒå†æ”¾å…¥äº‹ä»¶é˜Ÿåˆ—ä¸­å†ç”±JavaScriptå¼•æ“æ‰§è¡Œ ç®€å•è¯´å°±æ˜¯å½“æ‰§è¡Œåˆ°ä¸€ä¸ªhttpå¼‚æ­¥è¯·æ±‚æ—¶ï¼Œå°±æŠŠå¼‚æ­¥è¯·æ±‚äº‹ä»¶æ·»åŠ åˆ°å¼‚æ­¥è¯·æ±‚çº¿ç¨‹ï¼Œç­‰æ”¶åˆ°å“åº”(å‡†ç¡®æ¥è¯´åº”è¯¥æ˜¯httpçŠ¶æ€å˜åŒ–)ï¼Œå†æŠŠå›è°ƒå‡½æ•°æ·»åŠ åˆ°äº‹ä»¶é˜Ÿåˆ—ï¼Œç­‰å¾…jså¼•æ“çº¿ç¨‹æ¥æ‰§è¡Œ EventLoopè½®è¯¢å¤„ç†çº¿ç¨‹ ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰è¿™é‡Œå•ç‹¬æ‹¿å‡ºä¸€ç¯‡æ–‡ç« å°†è¿™ä¸ª","tags":["è¿›ç¨‹å’Œçº¿ç¨‹","æµè§ˆå™¨","jså¼•æ“","æ¸²æŸ“è¿›ç¨‹"],"categories":["æµè§ˆå™¨"]},{"title":"è¿›ç¨‹å’Œçº¿ç¨‹","path":"/2021/06/10/è¿›ç¨‹å’Œçº¿ç¨‹/","content":"çº¿ç¨‹ä¸è¿›ç¨‹ä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿé¦–å…ˆï¼Œ CPUæ‡‚å§ï¼Ÿæ˜¯è®¡ç®—æœºçš„æ ¸å¿ƒï¼Œæ‰¿å½“æ‰€æœ‰çš„è®¡ç®—ä»»åŠ¡ å®˜æ–¹ï¼šè¿›ç¨‹æ˜¯CPUèµ„æºåˆ†é…çš„æœ€å°å•ä½ æŒ‰æˆ‘çš„ç†è§£ï¼š è¿›ç¨‹å°±æ˜¯è¿›è¡Œä¸­çš„ç¨‹åºï¼Œå¯ä»¥ç‹¬ç«‹è¿è¡Œå¹¶ä¸”æ‹¥æœ‰è‡ªå·±çš„èµ„æºç©ºé—´çš„ä»»åŠ¡ç¨‹åº æ„æ€å°±æ˜¯ï¼š è¿è¡Œä¸­çš„ç¨‹åº ç¨‹åºæ‰€ç”¨åˆ°çš„å†…å­˜å’Œç³»ç»Ÿèµ„æº æµè§ˆå™¨ä¸­çš„æ¯ä¸ªtabé¡µéƒ½æ˜¯ä¸€ä¸ªè¿›ç¨‹ ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ å®˜æ–¹ï¼šçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„æœ€å°å•ä½ çº¿ç¨‹æ˜¯å»ºç«‹ è¿›ç¨‹çš„åŸºç¡€ä¸Šçš„ä¸€æ¬¡ç¨‹åºè¿è¡Œå•ä½ é€šä¿—ç‚¹å°±æ˜¯ï¼šçº¿ç¨‹æ˜¯ç¨‹åºä¸­çš„ä¸€ä¸ªæ‰§è¡Œæµï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥æ‹¥æœ‰å¤šä¸ªæ‰§è¡Œæµï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªçº¿ç¨‹ çº¿ç¨‹åˆ†ä¸ºä¸¤ç§ï¼š å•çº¿ç¨‹ï¼šä¸€ä¸ªè¿›ç¨‹ä¸­åªæœ‰ä¸€ä¸ªæ‰§è¡Œæµï¼Œå°±åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå«åšå•çº¿ç¨‹ å¤šçº¿ç¨‹ï¼šé¡¾åæ€ä¹‰ä¸€ä¸ªè¿›ç¨‹å¤šä¸ªæ‰§è¡Œæµï¼Œ è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºçš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œçš„æœ€å°å•ä½ ä¸€ä¸ªè¿›ç¨‹ç”±ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç»„æˆï¼Œçº¿ç¨‹å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸­ä»£ç çš„ä¸åŒæ‰§è¡Œè·¯çº¿ è¿›ç¨‹ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œä½†åŒä¸€è¿›ç¨‹ä¸‹çš„å„ä¸ªçº¿ç¨‹é—´å…±äº«ç¨‹åºçš„å†…å­˜ç©ºé—´(åŒ…æ‹¬ä»£ç æ®µã€æ•°æ®é›†ã€å †ç­‰)åŠä¸€äº›è¿›ç¨‹çº§çš„èµ„æº(å¦‚æ‰“å¼€æ–‡ä»¶å’Œä¿¡å·) å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹å¤šè¿›ç¨‹ï¼šå¤šè¿›ç¨‹æŒ‡çš„æ˜¯åœ¨åŒä¸€ä¸ªæ—¶é—´é‡Œï¼ŒåŒä¸€ä¸ªè®¡ç®—æœºç³»ç»Ÿä¸­å¦‚æœå…è®¸ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ã€‚å¤šè¿›ç¨‹å¸¦æ¥çš„å¥½å¤„æ˜¯æ˜æ˜¾çš„ï¼Œæ¯”å¦‚å¤§å®¶å¯ä»¥åœ¨ç½‘æ˜“äº‘å¬æ­Œçš„åŒæ—¶æ‰“å¼€ç¼–è¾‘å™¨æ•²ä»£ç ï¼Œç¼–è¾‘å™¨å’Œç½‘æ˜“äº‘çš„è¿›ç¨‹ä¹‹é—´ä¸ä¼šç›¸äº’å¹²æ‰° å¤šçº¿ç¨‹ï¼šå¤šçº¿ç¨‹æ˜¯æŒ‡ç¨‹åºä¸­åŒ…å«å¤šä¸ªæ‰§è¡Œæµï¼Œå³åœ¨ä¸€ä¸ªç¨‹åºä¸­å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªä¸åŒçš„çº¿ç¨‹æ¥æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´å…è®¸å•ä¸ªç¨‹åºåˆ›å»ºå¤šä¸ªå¹¶è¡Œæ‰§è¡Œçš„çº¿ç¨‹æ¥å®Œæˆå„è‡ªçš„ä»»åŠ¡ JSä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹JSçš„å•çº¿ç¨‹ï¼Œä¸å®ƒçš„ç”¨é€”æœ‰å…³ã€‚ä½œä¸ºæµè§ˆå™¨è„šæœ¬è¯­è¨€ï¼ŒJavaScriptçš„ä¸»è¦ç”¨é€”æ˜¯ä¸ç”¨æˆ·äº’åŠ¨ï¼Œä»¥åŠæ“ä½œDOMã€‚è¿™å†³å®šäº†å®ƒåªèƒ½æ˜¯å•çº¿ç¨‹ï¼Œå¦åˆ™ä¼šå¸¦æ¥å¾ˆå¤æ‚çš„åŒæ­¥é—®é¢˜ã€‚æ¯”å¦‚ï¼Œå‡å®šJavaScriptåŒæ—¶æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨æŸä¸ªDOMèŠ‚ç‚¹ä¸Šæ·»åŠ å†…å®¹ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åˆ é™¤äº†è¿™ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ—¶æµè§ˆå™¨åº”è¯¥ä»¥å“ªä¸ªçº¿ç¨‹ä¸ºå‡†ï¼Ÿ è¿˜æœ‰äººè¯´jsè¿˜æœ‰Workerçº¿ç¨‹ï¼Œå¯¹çš„ï¼Œä¸ºäº†åˆ©ç”¨å¤šæ ¸CPUçš„è®¡ç®—èƒ½åŠ›ï¼ŒHTML5æå‡ºWeb Workeræ ‡å‡†ï¼Œå…è®¸JavaScriptè„šæœ¬åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯å­çº¿ç¨‹æ˜¯å®Œ å…¨å—ä¸»çº¿ç¨‹æ§åˆ¶çš„ï¼Œè€Œä¸”ä¸å¾—æ“ä½œDOM æ‰€ä»¥ï¼Œè¿™ä¸ªæ ‡å‡†å¹¶æ²¡æœ‰æ”¹å˜JavaScriptæ˜¯å•çº¿ç¨‹çš„æœ¬è´¨","tags":["jså¼•æ“","è¿›ç¨‹ä¸çº¿ç¨‹"],"categories":["æµè§ˆå™¨"]},{"title":"æµè§ˆå™¨çš„è¿›ç¨‹ç§ç±»","path":"/2021/06/10/æµè§ˆå™¨çš„è¿›ç¨‹ç§ç±»/","content":"æµè§ˆå™¨æ˜¯å¤šè¿›ç¨‹çš„ï¼Œä¸€ä¸ªç½‘é¡µå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥ä½ çœ‹è°·æ­Œå¼€äº†é‚£ä¹ˆå¤štabé¡µï¼Œç„¶åæ”¾ç€ï¼Œå°±æ˜¯ç©ï¼Œç„¶åæˆ‘ç”µè„‘å°±ç‚¸äº†ï¼Œå› ä¸ºè€å­CPUä¸è¡Œå•Šï¼Œå°±åˆ†é…ä¸äº†é‚£ä¹ˆå¤šå†…å­˜ç©ºé—´ç»™ä»–ç”¨ï¼Œå°±ä¸è¡Œäº†å‘— æµè§ˆå™¨çš„è¿›ç¨‹ç§ç±»Browserè¿›ç¨‹ æµè§ˆå™¨çš„ä¸»è¿›ç¨‹(è´Ÿè´£åè°ƒã€ä¸»æ§)ï¼Œè¯¥è¿›ç¨‹åªæœ‰ä¸€ä¸ª è´Ÿè´£æµè§ˆå™¨ç•Œé¢æ˜¾ç¤ºï¼Œä¸ç”¨æˆ·äº¤äº’ã€‚å¦‚å‰è¿›ï¼Œåé€€ç­‰ è´Ÿè´£å„ä¸ªé¡µé¢çš„ç®¡ç†ï¼Œåˆ›å»ºå’Œé”€æ¯å…¶ä»–è¿›ç¨‹ å°†æ¸²æŸ“(Renderer)è¿›ç¨‹å¾—åˆ°çš„å†…å­˜ä¸­çš„Bitmap(ä½å›¾)ï¼Œç»˜åˆ¶åˆ°ç”¨æˆ·ç•Œé¢ä¸Š ç½‘ç»œèµ„æºçš„ç®¡ç†ï¼Œä¸‹è½½ç­‰ ç¬¬ä¸‰æ–¹æ’ä»¶è¿›ç¨‹ æ¯ç§ç±»å‹çš„æ’ä»¶å¯¹åº”ä¸€ä¸ªè¿›ç¨‹ï¼Œå½“ä½¿ç”¨è¯¥æ’ä»¶æ—¶æ‰åˆ›å»º GPUè¿›ç¨‹ è¯¥è¿›ç¨‹ä¹Ÿåªæœ‰ä¸€ä¸ªï¼Œç”¨äº3Dç»˜åˆ¶ç­‰ç­‰ *æ¸²æŸ“è¿›ç¨‹(å¦‚æ­¤çš„é‡è¦) å³é€šå¸¸æ‰€è¯´çš„æµè§ˆå™¨å†…æ ¸(Rendererè¿›ç¨‹ï¼Œå†…éƒ¨æ˜¯å¤šçº¿ç¨‹) æ¯ä¸ªTabé¡µé¢éƒ½æœ‰ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ï¼Œäº’ä¸å½±å“ ä¸»è¦ä½œç”¨ä¸ºé¡µé¢æ¸²æŸ“ï¼Œè„šæœ¬æ‰§è¡Œï¼Œäº‹ä»¶å¤„ç†ç­‰ ä¸ºä»€ä¹ˆæµè§ˆå™¨éœ€è¦å¤šè¿›ç¨‹ï¼Ÿæˆ‘ä»¬å‡è®¾æµè§ˆå™¨æ˜¯å•è¿›ç¨‹ï¼Œé‚£ä¹ˆæŸä¸ªTabé¡µå´©æºƒäº†ï¼Œå°±å½±å“äº†æ•´ä¸ªæµè§ˆå™¨ï¼Œä½“éªŒæœ‰å¤šå·® åŒç†å¦‚æœæ’ä»¶å´©æºƒäº†ä¹Ÿä¼šå½±å“æ•´ä¸ªæµè§ˆå™¨ å½“ç„¶å¤šè¿›ç¨‹è¿˜æœ‰å…¶å®ƒçš„è¯¸å¤šä¼˜åŠ¿ï¼Œä¸è¿‡å¤šé˜è¿° æµè§ˆå™¨è¿›ç¨‹æœ‰å¾ˆå¤šï¼Œæ¯ä¸ªè¿›ç¨‹åˆæœ‰å¾ˆå¤šçº¿ç¨‹ï¼Œéƒ½ä¼šå ç”¨å†…å­˜ è¿™ä¹Ÿæ„å‘³ç€å†…å­˜ç­‰èµ„æºæ¶ˆè€—ä¼šå¾ˆå¤§ï¼Œæœ‰ç‚¹æ‹¿ç©ºé—´æ¢æ—¶é—´çš„æ„æ€","tags":["Event Loop","è¿›ç¨‹å’Œçº¿ç¨‹","æµè§ˆå™¨","jså¼•æ“"],"categories":["æµè§ˆå™¨"]},{"title":"ä½¿ç”¨ç”Ÿæˆå™¨å†™å‡ºæ–æ³¢é‚£å¥‘æ•°åˆ—","path":"/2021/06/07/ä½¿ç”¨ç”Ÿæˆå™¨å†™å‡ºæ–æ³¢é‚£å¥‘æ•°åˆ—/","content":"ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ©ç”¨ Generator å‡½æ•°å’Œfor...ofå¾ªç¯ï¼Œå®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ä¾‹å­ã€‚ 123456789101112function* fibonacci() &#123; let [prev, curr] = [0, 1]; for (;;) &#123; yield curr; [prev, curr] = [curr, prev + curr]; &#125; &#125; for (let n of fibonacci()) &#123; if (n &gt; 10000) break; console.log(n); &#125;","tags":["Javascript","ES6","æ–æ³¢é‚£å¥‘æ•°åˆ—"],"categories":["Javascript"]},{"title":"å‰ç«¯æ€§èƒ½ä¼˜åŒ–","path":"/2021/06/06/å‰ç«¯æ€§èƒ½ä¼˜åŒ–/","content":"å‰ç«¯æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µæœ¬æ–‡ä¸»è¦è€ƒé‡å®¢æˆ·ç«¯æ€§èƒ½ã€æœåŠ¡å™¨ç«¯å’Œç½‘ç»œæ€§èƒ½ï¼Œå†…å®¹æ¡†æ¶æ¥è‡ª Yahoo Developer Networkï¼ŒåŒ…å« 7 ä¸ªç±»åˆ«å…± 35 æ¡å‰ç«¯æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¡¥å……äº†ä¸€äº›ç›¸å…³æˆ–è€…æ›´ç¬¦åˆä¸»æµæŠ€æœ¯çš„å†…å®¹ã€‚ åŒæ—¶ï¼Œå»ºè®®å…³æ³¨åŠæ—¶æ›´æ–°çš„ Google æ€§èƒ½ä¼˜åŒ–æŒ‡å—ã€‚ ç›®å½•ï¼š é¡µé¢å†…å®¹ å‡å°‘ HTTP è¯·æ±‚æ•° å‡å°‘ DNS æŸ¥è¯¢ é¿å…é‡å®šå‘ ç¼“å­˜ Ajax è¯·æ±‚ å»¶è¿ŸåŠ è½½ é¢„å…ˆåŠ è½½ å‡å°‘ DOM å…ƒç´ æ•°é‡ åˆ’åˆ†å†…å®¹åˆ°ä¸åŒåŸŸå å°½é‡å‡å°‘ iframe ä½¿ç”¨ é¿å… 404 é”™è¯¯ æœåŠ¡å™¨ ä½¿ç”¨ CDN æ·»åŠ  Expires æˆ– Cache-Control å“åº”å¤´ å¯ç”¨ Gzip é…ç½® Etag å°½æ—©è¾“å‡ºç¼“å†² Ajax è¯·æ±‚ä½¿ç”¨ GET æ–¹æ³• é¿å…å›¾ç‰‡ src ä¸ºç©º Cookie å‡å°‘ Cookie å¤§å° é™æ€èµ„æºä½¿ç”¨æ—  Cookie åŸŸå CSS æŠŠæ ·å¼è¡¨æ”¾åœ¨ `` ä¸­ ä¸è¦ä½¿ç”¨ CSS è¡¨è¾¾å¼ ä½¿ç”¨ `` æ›¿ä»£ @import ä¸è¦ä½¿ç”¨ filter JavaScript æŠŠè„šæœ¬æ”¾åœ¨é¡µé¢åº•éƒ¨ ä½¿ç”¨å¤–éƒ¨ JavaScript å’Œ CSS å‹ç¼© JavaScript å’Œ CSS ç§»é™¤é‡å¤è„šæœ¬ å‡å°‘ DOM æ“ä½œ ä½¿ç”¨é«˜æ•ˆçš„äº‹ä»¶å¤„ç† å›¾ç‰‡ ä¼˜åŒ–å›¾ç‰‡ ä¼˜åŒ– CSS Sprite ä¸è¦åœ¨ HTML ä¸­ç¼©æ”¾å›¾ç‰‡ ä½¿ç”¨ä½“ç§¯å°ã€å¯ç¼“å­˜çš„ favicon.ico ç§»åŠ¨ç«¯ ä¿æŒå•ä¸ªæ–‡ä»¶å°äº 25 KB æ‰“åŒ…å†…å®¹ä¸ºåˆ†æ®µï¼ˆmultipartï¼‰æ–‡æ¡£ å‰ç«¯æ€§èƒ½çš„ä¸€ä¸ªé‡è¦æŒ‡æ ‡æ˜¯é¡µé¢åŠ è½½æ—¶é—´ï¼Œä¸ä»…äº‹å…³ç”¨æˆ·ä½“éªŒï¼Œä¹Ÿæ˜¯æœç´¢å¼•æ“æ’åè€ƒè™‘çš„ä¸€ä¸ªå› ç´ ã€‚ æ¥è‡ª Google çš„æ•°æ®è¡¨æ˜ï¼Œä¸€ä¸ªæœ‰ 10 æ¡æ•°æ® 0.4 ç§’èƒ½åŠ è½½å®Œçš„é¡µé¢ï¼Œå˜æˆ 30 æ¡æ•°æ® 0.9 ç§’åŠ è½½å®Œä¹‹åï¼Œæµé‡å’Œå¹¿å‘Šæ”¶å…¥ä¸‹é™ 90%ã€‚ Google Map é¦–é¡µæ–‡ä»¶å¤§å°ä» 100KB å‡å°åˆ° 70-80KB åï¼Œæµé‡åœ¨ç¬¬ä¸€å‘¨æ¶¨äº† 10%ï¼Œæ¥ä¸‹æ¥çš„ä¸‰å‘¨æ¶¨äº† 25%ã€‚ äºšé©¬é€Šçš„æ•°æ®è¡¨æ˜ï¼šåŠ è½½æ—¶é—´å¢åŠ  100 æ¯«ç§’ï¼Œé”€é‡å°±ä¸‹é™ 1%ã€‚ ä»¥ä¸Šæ•°æ®æ›´è¯´æ˜ã€ŒåŠ è½½æ—¶é—´å°±æ˜¯é‡‘é’±ã€ï¼Œå‰ç«¯ä¼˜åŒ–ä¸»è¦å›´ç»•æé«˜åŠ è½½é€Ÿåº¦è¿›è¡Œã€‚ é¡µé¢å†…å®¹å‡å°‘ HTTP è¯·æ±‚æ•°Web å‰ç«¯ 80% çš„å“åº”æ—¶é—´èŠ±åœ¨å›¾ç‰‡ã€æ ·å¼ã€è„šæœ¬ç­‰èµ„æºä¸‹è½½ä¸Šã€‚æµè§ˆå™¨å¯¹æ¯ä¸ªåŸŸåçš„è¿æ¥æ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œå‡å°‘è¯·æ±‚æ¬¡æ•°æ˜¯ç¼©çŸ­å“åº”æ—¶é—´çš„å…³é”®ã€‚ é€šè¿‡ç®€æ´çš„è®¾è®¡å‡å°‘é¡µé¢æ‰€éœ€èµ„æºï¼Œè¿›è€Œå‡å°‘ HTTP è¯·æ±‚ï¼Œè¿™æ˜¯æœ€ç›´æ¥çš„æ–¹å¼ï¼Œå‰ææ˜¯ä½ çš„ Bossã€è®¾è®¡å¸ˆåŒäº‹ä¸æ‰“æ­»ä½ ã€‚æ‰€ä»¥ï¼Œè¿˜æ˜¯å¦è¾Ÿè¹Šå¾„å§ï¼š åˆå¹¶ JavaScriptã€CSS ç­‰æ–‡ä»¶ï¼› æœåŠ¡å™¨ç«¯ï¼ˆCDNï¼‰è‡ªåŠ¨åˆå¹¶ åŸºäº Node.js çš„æ–‡ä»¶åˆå¹¶å·¥å…·ä¸€æŠ“ä¸€å¤§æŠŠ ä½¿ç”¨CSS Spriteï¼šå°†èƒŒæ™¯å›¾ç‰‡åˆå¹¶æˆä¸€ä¸ªæ–‡ä»¶ï¼Œé€šè¿‡background-image å’Œ background-position æ§åˆ¶æ˜¾ç¤ºï¼› Sprite Cow Spritebox é€æ­¥è¢« Icon Font å’Œ SVG Sprite å–ä»£ã€‚ Image Mapï¼šåˆå¹¶å›¾ç‰‡ï¼Œç„¶åä½¿ç”¨åæ ‡æ˜ å°„ä¸åŒçš„åŒºåŸŸï¼ˆæ¼”ç¤ºï¼‰ã€‚ ç¼ºç‚¹ï¼šä»…é€‚ç”¨äºç›¸è¿çš„å›¾ç‰‡ï¼›è®¾ç½®åæ ‡è¿‡ç¨‹ä¹å‘³ä¸”æ˜“å‡ºé”™ï¼›å¯è®¿æ€§é—®é¢˜ã€‚ä¸æ¨èä½¿ç”¨è¿™ç§è¿‡æ—¶çš„æŠ€æœ¯ã€‚ Inline Assetsï¼šä½¿ç”¨ Data URI scheme å°†å›¾ç‰‡åµŒå…¥ HTML æˆ–è€… CSS ä¸­ï¼›æˆ–è€…å°† CSSã€JSã€å›¾ç‰‡ç›´æ¥åµŒå…¥ HTML ä¸­ã€‚ ä¼šå¢åŠ æ–‡ä»¶å¤§å°ï¼Œä¹Ÿå¯èƒ½äº§ç”Ÿæµè§ˆå™¨å…¼å®¹åŠå…¶ä»–æ€§èƒ½é—®é¢˜ï¼ˆæœ‰å¾…æ•´ç†è¡¥å……ï¼‰ã€‚ æœªæ¥çš„è¶‹åŠ¿æ˜¯ä½¿ç”¨å†…åµŒ SVGã€‚ å†…å®¹åˆ†ç‰‡ï¼Œå°†è¯·æ±‚åˆ’åˆ†åˆ°ä¸åŒçš„åŸŸåä¸Šã€‚ HTTP/2 é€šè¿‡å¤šè·¯å¤ç”¨å¤§å¹…é™ä½äº†å¤šä¸ªè¯·æ±‚çš„å¼€é”€ã€‚é€šè¿‡æ•°æ®åˆ†å¸§å±‚ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´åªéœ€è¦å»ºç«‹ä¸€ä¸ª TCP è¿æ¥ï¼Œå³å¯åŒæ—¶æ”¶å‘å¤šä¸ªæ–‡ä»¶ï¼Œè€Œä¸”ï¼Œè¯¥è¿æ¥åœ¨ç›¸å½“é•¿çš„æ—¶é—´å‘¨æœŸå†…ä¿æŒæ‰“å¼€ï¼ˆæŒä¹…åŒ–ï¼‰ï¼Œä»¥ä¾¿å¤ç”¨ã€‚ HTTP/2 çš„æ–°ç‰¹æ€§æ„å‘³ç€ä¸Šè¿°ä¼˜åŒ–å®è·µä¸å†é€‚ç”¨ï¼Œä½†è€ƒè™‘åˆ°å®¢æˆ·ç«¯å¯¹ HTTP/2 çš„æ”¯æŒè¦†ç›–ç¨‹åº¦ï¼Œè¿˜éœ€æ ¹æ®å®é™…æ•°æ®æƒè¡¡ã€‚ å‡å°‘ DNS æŸ¥è¯¢ç”¨æˆ·è¾“å…¥ URL ä»¥åï¼Œæµè§ˆå™¨é¦–å…ˆè¦æŸ¥è¯¢åŸŸåï¼ˆhostnameï¼‰å¯¹åº”æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œä¸€èˆ¬éœ€è¦è€—è´¹ 20-120 æ¯«ç§’ æ—¶é—´ã€‚DNS æŸ¥è¯¢å®Œæˆä¹‹å‰ï¼Œæµè§ˆå™¨æ— æ³•ä»æœåŠ¡å™¨ä¸‹è½½ä»»ä½•æ•°æ®ã€‚ åŸºäºæ€§èƒ½è€ƒè™‘ï¼ŒISPã€å±€åŸŸç½‘ã€æ“ä½œç³»ç»Ÿã€æµè§ˆå™¨éƒ½ä¼šæœ‰ç›¸åº”çš„ DNS ç¼“å­˜æœºåˆ¶ã€‚ IE ç¼“å­˜ 30 åˆ†é’Ÿï¼Œå¯ä»¥é€šè¿‡æ³¨å†Œè¡¨ä¸­ DnsCacheTimeout é¡¹è®¾ç½®ï¼› Firefox æ··å­˜ 1 åˆ†é’Ÿï¼Œé€šè¿‡ network.dnsCacheExpiration é…ç½®ï¼› ï¼ˆTODOï¼šè¡¥å……å…¶ä»–æµè§ˆå™¨ç¼“å­˜ä¿¡æ¯ï¼‰ é¦–æ¬¡è®¿é—®ã€æ²¡æœ‰ç›¸åº”çš„ DNS ç¼“å­˜æ—¶ï¼ŒåŸŸåè¶Šå¤šï¼ŒæŸ¥è¯¢æ—¶é—´è¶Šé•¿ã€‚æ‰€ä»¥åº”å°½é‡å‡å°‘åŸŸåæ•°é‡ã€‚ä½†åŸºäºå¹¶è¡Œä¸‹è½½è€ƒè™‘ï¼ŒæŠŠèµ„æºåˆ†å¸ƒåˆ° 2 ä¸ªåŸŸåä¸Šï¼ˆæœ€å¤šä¸è¶…è¿‡ 4 ä¸ªï¼‰ã€‚è¿™æ˜¯å‡å°‘ DNS æŸ¥è¯¢åŒæ—¶ä¿è¯å¹¶è¡Œä¸‹è½½çš„æŠ˜è¡·æ–¹æ¡ˆã€‚ é¿å…é‡å®šå‘HTTP é‡å®šå‘é€šè¿‡ 301/302 çŠ¶æ€ç å®ç°ã€‚ 123HTTP/1.1 301 Moved PermanentlyLocation: http://example.com/newuriContent-Type: text/html å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„é‡å®šå‘å“åº”åï¼Œä¼šæ ¹æ®å“åº”å¤´ä¸­ Location çš„åœ°å€å†æ¬¡å‘é€è¯·æ±‚ã€‚é‡å®šå‘ä¼šå½±å“ç”¨æˆ·ä½“éªŒï¼Œå°¤å…¶æ˜¯å¤šæ¬¡é‡å®šå‘æ—¶ï¼Œç”¨æˆ·åœ¨ä¸€æ®µæ—¶é—´å†…çœ‹ä¸åˆ°ä»»ä½•å†…å®¹ï¼Œåªçœ‹åˆ°æµè§ˆå™¨è¿›åº¦æ¡ä¸€ç›´åœ¨åˆ·æ–°ã€‚ æœ‰æ—¶é‡å®šå‘æ— æ³•é¿å…ï¼Œåœ¨ç³Ÿç³•ä¹Ÿæ¯”æŠ›å‡º 404 å¥½ã€‚è™½ç„¶é€šè¿‡ HTML meta refresh å’Œ JavaScript ä¹Ÿèƒ½å®ç°ï¼Œä½†é¦–é€‰ HTTP 3xx è·³è½¬ï¼Œä»¥ä¿è¯æµè§ˆå™¨ã€Œåé€€ã€åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼ˆä¹Ÿåˆ©äº SEOï¼‰ã€‚ æœ€æµªè´¹çš„é‡å®šå‘ç»å¸¸å‘ç”Ÿã€è€Œä¸”å¾ˆå®¹æ˜“è¢«å¿½ç•¥ï¼šURL æœ«å°¾åº”è¯¥æ·»åŠ  / ä½†æœªæ·»åŠ ã€‚æ¯”å¦‚ï¼Œè®¿é—® http://astrology.yahoo.com/astrology å°†è¢« 301 é‡å®šå‘åˆ° http://astrology.yahoo.com/astrology/ï¼ˆæ³¨æ„æœ«å°¾çš„ /ï¼‰ã€‚å¦‚æœä½¿ç”¨ Apacheï¼Œå¯ä»¥é€šè¿‡ Alias æˆ– mod_rewrite æˆ– DirectorySlash è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ç½‘ç«™åŸŸåå˜æ›´ï¼šCNAME ç»“åˆ Alias æˆ– mod_rewrite æˆ–è€…å…¶ä»–æœåŠ¡å™¨ç±»ä¼¼åŠŸèƒ½å®ç°è·³è½¬ã€‚ ç¼“å­˜ Ajax è¯·æ±‚Ajax å¯ä»¥æé«˜ç”¨æˆ·ä½“éªŒã€‚ä½†ã€Œå¼‚æ­¥ã€ä¸æ„å‘³ç€ã€ŒåŠæ—¶ã€ï¼Œä¼˜åŒ– Ajax å“åº”é€Ÿåº¦æé«˜æ€§èƒ½ä»æ˜¯éœ€è¦å…³æ³¨çš„ä¸»é¢˜ã€‚ æœ€é‡è¦çš„çš„ä¼˜åŒ–æ–¹å¼æ˜¯ç¼“å­˜å“åº”ç»“æœï¼Œè¯¦è§ æ·»åŠ  Expires æˆ– Cache-Control å“åº”å¤´ã€‚ ä»¥ä¸‹è§„åˆ™ä¹Ÿå…³ä¹ Ajax å“åº”é€Ÿåº¦ï¼š å¯ç”¨ Gzip å‡å°‘ DNS æŸ¥è¯¢ å‹ç¼© JavaScript å’Œ CSS é¿å…é‡å®šå‘ é…ç½® Etag å»¶è¿ŸåŠ è½½é¡µé¢åˆå§‹åŠ è½½æ—¶å“ªäº›å†…å®¹æ˜¯ç»å¯¹å¿…éœ€çš„ï¼Ÿä¸åœ¨ç­”æ¡ˆä¹‹åˆ—çš„èµ„æºéƒ½å¯ä»¥å»¶è¿ŸåŠ è½½ã€‚æ¯”å¦‚ï¼š éé¦–å±ä½¿ç”¨çš„æ•°æ®ã€æ ·å¼ã€è„šæœ¬ã€å›¾ç‰‡ç­‰ï¼› ç”¨æˆ·äº¤äº’æ—¶æ‰ä¼šæ˜¾ç¤ºçš„å†…å®¹ã€‚ éµå¾ªã€Œæ¸è¿›å¢å¼ºã€ç†å¿µå¼€å‘çš„ç½‘ç«™ï¼šJavaScript ç”¨äºå¢å¼ºç”¨ç”¨æˆ·ä½“éªŒï¼Œä½†æ²¡æœ‰ï¼ˆä¸æ”¯æŒï¼‰ JavaScript ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œï¼Œå®Œå…¨å¯ä»¥å»¶è¿ŸåŠ è½½ JavaScriptã€‚ å»¶è¿Ÿæ¸²æŸ“ å°†é¦–å±ä»¥å¤–çš„ HTML æ”¾åœ¨ä¸æ¸²æŸ“çš„å…ƒç´ ä¸­ï¼Œå¦‚éšè—çš„ ï¼Œæˆ–è€… `type` å±æ€§ä¸ºéæ‰§è¡Œè„šæœ¬çš„ æ ‡ç­¾ä¸­ï¼Œå‡å°‘åˆå§‹æ¸²æŸ“çš„ DOM å…ƒç´ æ•°é‡ï¼Œæé«˜é€Ÿåº¦ã€‚ç­‰é¦–å±åŠ è½½å®Œæˆæˆ–è€…ç”¨æˆ·æ“ä½œæ—¶ï¼Œå†å»æ¸²æŸ“å‰©ä½™çš„é¡µé¢å†…å®¹ã€‚ é¢„å…ˆåŠ è½½é¢„å…ˆåŠ è½½åˆ©ç”¨æµè§ˆå™¨ç©ºé—²æ—¶é—´è¯·æ±‚å°†æ¥è¦ä½¿ç”¨çš„èµ„æºï¼Œä»¥ä¾¿ç”¨æˆ·è®¿é—®ä¸‹ä¸€é¡µé¢æ—¶æ›´å¿«åœ°å“åº”ã€‚ æ— æ¡ä»¶é¢„å…ˆåŠ è½½ï¼šé¡µé¢åŠ è½½å®Œæˆï¼ˆloadï¼‰åï¼Œé©¬ä¸Šè·å–å…¶ä»–èµ„æºã€‚ä»¥ google.com ä¸ºä¾‹ï¼Œé¦–é¡µåŠ è½½å®Œæˆåä¼šç«‹å³ä¸‹è½½ä¸€ä¸ª Sprite å›¾ç‰‡ï¼Œæ­¤å›¾é¦–é¡µä¸éœ€è¦ï¼Œä½†æ˜¯æœç´¢ç»“æœé¡µè¦ç”¨åˆ°ã€‚ æœ‰æ¡ä»¶é¢„å…ˆåŠ è½½ï¼šæ ¹æ®ç”¨æˆ·è¡Œä¸ºé¢„åˆ¤ç”¨æˆ·å»å‘ï¼Œé¢„è½½ç›¸å…³èµ„æºã€‚æ¯”å¦‚ search.yahoo.com å¼€å§‹è¾“å…¥æ—¶ä¼šæœ‰é¢å¤–çš„èµ„æºåŠ è½½ã€‚ Chrome ç­‰æµè§ˆå™¨çš„åœ°å€æ ä¹Ÿæœ‰ç±»ä¼¼çš„æœºåˆ¶ã€‚ æœ‰ã€Œé˜´è°‹ã€çš„é¢„å…ˆåŠ è½½ï¼šé¡µé¢å³å°†ä¸Šçº¿æ–°ç‰ˆå‰é¢„å…ˆåŠ è½½æ–°ç‰ˆå†…å®¹ã€‚ç½‘ç«™æ”¹ç‰ˆåç”±äºç¼“å­˜ã€ä½¿ç”¨ä¹ æƒ¯ç­‰åŸå› ï¼Œä¼šæœ‰æ—§ç‰ˆçš„ç½‘ç«™æ›´å¿«æ›´æµç•…çš„åé¦ˆã€‚ä¸ºç¼“è§£è¿™ä¸€é—®é¢˜ï¼Œåœ¨æ–°ç‰ˆä¸Šçº¿ä¹‹å‰ï¼Œæ—§ç‰ˆå¯ä»¥åˆ©ç”¨ç©ºé—²æå‰åŠ è½½ä¸€äº›æ–°ç‰ˆçš„èµ„æºç¼“å­˜åˆ°å®¢æˆ·ç«¯ï¼Œä»¥ä¾¿æ–°ç‰ˆæ­£å¼ä¸Šçº¿åæ›´å¿«çš„è½½å…¥ï¼ˆå¥½ä¸€ä¸ªã€Œå¿ƒæœºçŒ¿ã€:scream:ï¼‰ã€‚ ã€ŒåŒåä¸€ã€ã€ã€Œé»‘äº”ã€è¿™ç±»ä¿ƒé”€æ—¥æ¥ä¸´ä¹‹å‰ï¼Œä¹Ÿå¯ä»¥é¢„å…ˆä¸‹è½½ä¸€äº›ç›¸å…³èµ„æºåˆ°å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ã€App ç­‰ï¼‰ï¼Œæœ‰æ•ˆåˆ©ç”¨æµè§ˆå™¨ç¼“å­˜å’Œæœ¬åœ°å­˜å‚¨ï¼Œé™ä½æ´»åŠ¨å½“æ—¥è¯·æ±‚å‹åŠ›ï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€‚ TODO: Prefetch ç›¸å…³ç»†èŠ‚ Resource Hints Spec å‡å°‘ DOM å…ƒç´ æ•°é‡å¤æ‚çš„é¡µé¢ä¸ä»…ä¸‹è½½çš„å­—èŠ‚æ›´å¤šï¼ŒJavaScript DOM æ“ä½œä¹Ÿæ›´æ…¢ã€‚ä¾‹å¦‚ï¼ŒåŒæ˜¯æ·»åŠ ä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨ï¼Œ500 ä¸ªå…ƒç´ å’Œ 5000 ä¸ªå…ƒç´ çš„é¡µé¢é€Ÿåº¦ä¸Šä¼šæœ‰å¾ˆå¤§åŒºåˆ«ã€‚ ä»ä»¥ä¸‹å‡ ä¸ªè§’åº¦è€ƒè™‘ç§»é™¤ä¸å¿…è¦çš„æ ‡è®°ï¼š æ˜¯å¦è¿˜åœ¨ä½¿ç”¨è¡¨æ ¼å¸ƒå±€ï¼Ÿ å¡è¿›å»æ›´å¤šçš„ `` ä»…ä¸ºäº†å¤„ç†å¸ƒå±€é—®é¢˜ï¼Ÿä¹Ÿè®¸æœ‰æ›´å¥½ã€æ›´è¯­ä¹‰åŒ–çš„æ ‡è®°ã€‚ èƒ½é€šè¿‡ä¼ªå…ƒç´ å®ç°çš„åŠŸèƒ½ï¼Œå°±æ²¡å¿…è¦æ·»åŠ é¢å¤–å…ƒç´ ï¼Œå¦‚æ¸…é™¤æµ®åŠ¨ã€‚ æµè§ˆå™¨æ§åˆ¶å°ä¸­è¾“å…¥ä»¥ä¸‹ä»£ç å¯ä»¥è®¡ç®—å‡ºé¡µé¢ä¸­æœ‰å¤šå°‘ DOM å…ƒç´ ï¼š 1document.getElementsByTagName(&#x27;*&#x27;).length; å¯¹æ¯”æ ‡è®°è‰¯å¥½çš„çš„ç½‘ç«™ï¼Œçœ‹çœ‹å·®è·æ˜¯å¤šå°‘ã€‚ ä¸ºä»€ä¹ˆä¸ä½¿ç”¨è¡¨æ ¼å¸ƒå±€ï¼Ÿ æ›´å¤šçš„æ ‡ç­¾ï¼Œå¢åŠ æ–‡ä»¶å¤§å°ï¼› ä¸æ˜“ç»´æŠ¤ï¼Œæ— æ³•é€‚åº”å“åº”å¼è®¾è®¡ï¼› æ€§èƒ½è€ƒé‡ï¼Œé»˜è®¤çš„è¡¨æ ¼å¸ƒå±€ç®—æ³•ä¼šäº§ç”Ÿå¤§é‡é‡ç»˜ï¼ˆå‚è§è¡¨æ ¼å¸ƒå±€ç®—æ³•ï¼‰ã€‚ åˆ’åˆ†å†…å®¹åˆ°ä¸åŒåŸŸåæµè§ˆå™¨ä¸€èˆ¬ä¼šé™åˆ¶æ¯ä¸ªåŸŸçš„å¹¶è¡Œçº¿ç¨‹ï¼ˆä¸€èˆ¬ä¸º 6 ä¸ªï¼Œç”šè‡³æ›´å°‘ï¼‰ï¼Œä½¿ç”¨ä¸åŒçš„åŸŸåå¯ä»¥æœ€å¤§åŒ–ä¸‹è½½çº¿ç¨‹ï¼Œä½†æ³¨æ„ä¿æŒåœ¨ 2-4 ä¸ªåŸŸåå†…ï¼Œä»¥é¿å… DNS æŸ¥è¯¢æŸè€—ã€‚ ä¾‹å¦‚ï¼ŒåŠ¨æ€å†…å®¹æ”¾åœ¨ csspod.com ä¸Šï¼Œé™æ€èµ„æºæ”¾åœ¨ static.csspod.com ä¸Šã€‚è¿™æ ·è¿˜å¯ä»¥ç¦ç”¨é™æ€èµ„æºåŸŸä¸‹çš„ Cookieï¼Œå‡å°‘æ•°æ®ä¼ è¾“ï¼Œè¯¦è§ Cookie ä¼˜åŒ–ã€‚ æ›´å¤šä¿¡æ¯å‚è€ƒ Maximizing Parallel Downloads in the Carpool Lane å°½é‡å‡å°‘ iframe ä½¿ç”¨ä½¿ç”¨ iframe å¯ä»¥åœ¨é¡µé¢ä¸­åµŒå…¥ HTML æ–‡æ¡£ï¼Œä½†æœ‰åˆ©æœ‰å¼Šã€‚ ä¼˜ç‚¹ï¼š å¯ä»¥ç”¨æ¥åŠ è½½é€Ÿåº¦è¾ƒæ…¢çš„ç¬¬ä¸‰æ–¹èµ„æºï¼Œå¦‚å¹¿å‘Šã€å¾½ç« ï¼› å¯ç”¨ä½œå®‰å…¨æ²™ç®±ï¼› å¯ä»¥å¹¶è¡Œä¸‹è½½è„šæœ¬ã€‚ ç¼ºç‚¹ï¼š åŠ è½½ä»£ä»·æ˜‚è´µï¼Œå³ä½¿æ˜¯ç©ºçš„é¡µé¢ï¼› é˜»å¡é¡µé¢ load äº‹ä»¶è§¦å‘ï¼› Iframe å®Œå…¨åŠ è½½ä»¥åï¼Œçˆ¶é¡µé¢æ‰ä¼šè§¦å‘ load äº‹ä»¶ã€‚ Safariã€Chrome ä¸­é€šè¿‡ JavaScript åŠ¨æ€è®¾ç½® iframe src å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚ ç¼ºä¹è¯­ä¹‰ã€‚ é¿å… 404 é”™è¯¯HTTP è¯·æ±‚å¾ˆæ˜‚è´µï¼Œè¿”å›æ— æ•ˆçš„å“åº”ï¼ˆå¦‚ 404 æœªæ‰¾åˆ°ï¼‰å®Œå…¨æ²¡å¿…è¦ï¼Œé™ä½ç”¨æˆ·ä½“éªŒè€Œä¸”æ¯«æ— ç›Šå¤„ã€‚ ä¸€äº›ç½‘ç«™è®¾è®¡å¾ˆé…·ç‚«ã€æœ‰æç¤ºä¿¡æ¯çš„ 404 é¡µé¢ï¼Œæœ‰åŠ©äºæé«˜ç”¨æˆ·ä½“éªŒï¼Œä½†è¿˜æ˜¯æµªè´¹æœåŠ¡å™¨èµ„æºã€‚å°¤å…¶ç³Ÿç³•çš„æ˜¯å¤–éƒ¨è„šæœ¬è¿”å› 404ï¼Œä¸ä»…é˜»å¡å…¶ä»–èµ„æºä¸‹è½½ï¼Œæµè§ˆå™¨è¿˜ä¼šå°è¯•æŠŠ 404 é¡µé¢å†…å®¹å½“ä½œ JavaScript è§£æï¼Œæ¶ˆè€—æ›´å¤šèµ„æºã€‚ è¡¥å……è§„åˆ™ï¼š å®šä¹‰å­—ç¬¦é›†ï¼Œå¹¶æ”¾åœ¨ `` é¡¶éƒ¨ã€‚å¤§å¤šæ•°æµè§ˆå™¨ä¼šæš‚åœé¡µé¢æ¸²æŸ“ï¼Œç›´åˆ°æ‰¾åˆ°å­—ç¬¦é›†å®šä¹‰ã€‚ æœåŠ¡å™¨æœåŠ¡å™¨ç›¸å…³ä¼˜åŒ–è®¾ç½®å¯å‚è€ƒ H5BP ç›¸å…³é¡¹ç›®ï¼š Nginx HTTP server boilerplate configs Apache HTTP server boilerplate configs IIS Web.Config Boilerplates ä½¿ç”¨ CDNç½‘ç«™ 80-90% å“åº”æ—¶é—´æ¶ˆè€—åœ¨èµ„æºä¸‹è½½ä¸Šï¼Œå‡å°‘èµ„æºä¸‹è½½æ—¶é—´æ˜¯æ€§èƒ½ä¼˜åŒ–çš„é»„é‡‘å‘åˆ™ã€‚ ç›¸æ¯”åˆ†å¸ƒå¼æ¶æ„çš„å¤æ‚å’Œå·¨å¤§æŠ•å…¥ï¼Œé™æ€å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆCDNï¼‰å¯ä»¥ä»¥è¾ƒä½çš„æŠ•å…¥ï¼Œè·å¾—åŠ è½½é€Ÿåº¦æœ‰æ•ˆæå‡ã€‚ æ·»åŠ  Expires æˆ– Cache-Control å“åº”å¤´ é™æ€å†…å®¹ï¼šå°† Expires å“åº”å¤´è®¾ç½®ä¸ºå°†æ¥å¾ˆè¿œçš„æ—¶é—´ï¼Œå®ç°ã€Œæ°¸ä¸è¿‡æœŸã€ç­–ç•¥ï¼› åŠ¨æ€å†…å®¹ï¼šè®¾ç½®åˆé€‚çš„ Cache-Control å“åº”å¤´ï¼Œè®©æµè§ˆå™¨æœ‰æ¡ä»¶åœ°å‘èµ·è¯·æ±‚ã€‚ Cache-Control å¤´åœ¨ HTTP/1.1 è§„èŒƒä¸­å®šä¹‰ï¼Œå–ä»£äº†ä¹‹å‰ç”¨æ¥å®šä¹‰å“åº”ç¼“å­˜ç­–ç•¥çš„å¤´ï¼ˆä¾‹å¦‚ Expiresã€Pragmaï¼‰ã€‚å½“å‰çš„æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒ Cache-Controlï¼Œå› æ­¤ï¼Œä½¿ç”¨å®ƒå°±å¤Ÿäº†ã€‚ é‰´äºé™æ€å†…å®¹å’ŒåŠ¨æ€å†…å®¹ä¸åŒçš„ç¼“å­˜ç­–ç•¥ï¼Œå®è·µä¸­ä¸€èˆ¬ä¼šæŠŠäºŒè€…éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ï¼ˆåŸŸåï¼‰ä»¥æ–¹ä¾¿ç®¡ç†ã€‚ å‚è€ƒé“¾æ¥ï¼š HTTP ç¼“å­˜ | Web Fundamentals - Google Developers H5BP - Server Configs å¯ç”¨ GzipGzip å‹ç¼©é€šå¸¸å¯ä»¥å‡å°‘ 70% çš„å“åº”å¤§å°ï¼Œå¯¹æŸäº›æ–‡ä»¶æ›´å¯èƒ½é«˜è¾¾ 90%ï¼Œæ¯” Deflate æ›´é«˜æ•ˆã€‚ä¸»æµ Web æœåŠ¡å™¨éƒ½æœ‰ç›¸åº”æ¨¡å—ï¼Œè€Œä¸”ç»å¤§å¤šæ•°æµè§ˆå™¨æ”¯æŒ gzip è§£ç ã€‚æ‰€ä»¥ï¼Œåº”è¯¥å¯¹ HTMLã€CSSã€JSã€XMLã€JSON ç­‰æ–‡æœ¬ç±»å‹çš„å†…å®¹å¯ç”¨å‹ç¼©ã€‚ æ³¨æ„ï¼Œå›¾ç‰‡å’Œ PDF æ–‡ä»¶ä¸è¦ä½¿ç”¨ gzipã€‚å®ƒä»¬æœ¬èº«å·²ç»å‹ç¼©è¿‡ï¼Œå†ä½¿ç”¨ gzip å‹ç¼©ä¸ä»…æµªè´¹ CPU èµ„æºï¼Œè€Œä¸”è¿˜å¯èƒ½å¢åŠ æ–‡ä»¶ä½“ç§¯ã€‚ å¯¹äºä¸æ”¯æŒçš„ Gzip çš„ç”¨æˆ·ä»£ç†ï¼Œé€šè¿‡è®¾ç½® Vary å“åº”å¤´ï¼Œè¿”å›ä¸ºæœªå‹ç¼©çš„æ•°æ®ï¼š 1Vary: * é…ç½® EtagEtag é€šè¿‡æ–‡ä»¶ç‰ˆæœ¬æ ‡è¯†ï¼Œæ–¹ä¾¿æœåŠ¡å™¨åˆ¤æ–­è¯·æ±‚çš„å†…å®¹æ˜¯å¦æœ‰æ›´æ–°ï¼Œå¦‚æœæ²¡æœ‰å°±å“åº” 304ï¼Œé¿å…é‡æ–°ä¸‹è½½ã€‚ å½“ç„¶ï¼Œå¯ç”¨ Etag å¯èƒ½ä¼šå¯¼è‡´å…¶ä»–é—®é¢˜ï¼Œè¿˜éœ€è¦æ ¹æ®å…·ä½“æƒ…å†µåšåˆ¤æ–­ã€‚ï¼ˆTODOï¼šè¡¥å……ç›¸å…³å†…å®¹ï¼‰ å°½æ—©è¾“å‡ºï¼ˆflushï¼‰ç¼“å†²ç”¨æˆ·è¯·æ±‚é¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨é€šå¸¸éœ€è¦èŠ±è´¹ 200 ~ 500 æ¯«ç§’æ¥ç»„åˆ HTML é¡µé¢ã€‚åœ¨æ­¤æœŸé—´ï¼Œæµè§ˆå™¨å¤„äºç©ºé—²ã€ç­‰å¾…æ•°æ®çŠ¶æ€ã€‚ä½¿ç”¨PHP ä¸­çš„ flush() å‡½æ•°ï¼Œå¯ä»¥å‘é€éƒ¨åˆ†å·²ç»å‡†å¤‡å¥½çš„ HTML åˆ°æµè§ˆå™¨ï¼Œä»¥ä¾¿æœåŠ¡å™¨è¿˜åœ¨å¿™äºå¤„ç†å‰©ä½™é¡µé¢æ—¶ï¼Œæµè§ˆå™¨å¯ä»¥æå‰å¼€å§‹è·å–èµ„æºã€‚ å¯ä»¥è€ƒè™‘åœ¨ ä¹‹åè¾“å‡ºä¸€æ¬¡ç¼“å†²ï¼ŒHTML head ä¸€èˆ¬æ¯”è¾ƒå®¹æ˜“ç”Ÿæˆï¼Œå…ˆå‘é€ä»¥ä¾¿æµè§ˆå™¨å¼€å§‹è·å– é‡Œå¼•ç”¨çš„ CSS ç­‰èµ„æºã€‚ Example: 12345&lt;!-- Css, js --&gt;&lt;/head&gt;&lt;?php flush(); ?&gt;&lt;body&gt;&lt;!-- content --&gt; Ajax è¯·æ±‚ä½¿ç”¨ GET æ–¹æ³•æµè§ˆå™¨æ‰§è¡Œ XMLHttpRequest POST è¯·æ±‚æ—¶åˆ†æˆä¸¤æ­¥ï¼Œå…ˆå‘é€ Headerï¼Œå†å‘é€æ•°æ®ã€‚è€Œ GET åªä½¿ç”¨ä¸€ä¸ª TCP æ•°æ®åŒ…å‘é€æ•°æ®ï¼Œæ‰€ä»¥é¦–é€‰ GET æ–¹æ³•ã€‚ æ ¹æ® HTTP è§„èŒƒï¼ŒGET ç”¨äºè·å–æ•°æ®ï¼ŒPOST åˆ™ç”¨äºå‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œæ‰€ä»¥ Ajax è¯·æ±‚æ•°æ®æ—¶ä½¿ç”¨ GET æ›´ç¬¦åˆè§„èŒƒï¼ˆGET å’Œ POST å¯¹æ¯”ï¼‰ã€‚ IE ä¸­æœ€å¤§ URL é•¿åº¦ä¸º 2Kï¼Œå¦‚æœè¶…å‡º 2Kï¼Œåˆ™éœ€è¦è€ƒè™‘ä½¿ç”¨ POST æ–¹æ³•ã€‚ é¿å…å›¾ç‰‡ src ä¸ºç©ºå›¾ç‰‡ src å±æ€§å€¼ä¸ºç©ºå­—ç¬¦ä¸²å¯èƒ½ä»¥ä¸‹é¢ä¸¤ç§å½¢å¼å‡ºç°ï¼š HTML: 1&lt;img src=&quot;&quot; /&gt; JavaScriptï¼š 12var img = new Image(); img.src = &quot;&quot;; è™½ç„¶ src å±æ€§ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œä½†æµè§ˆå™¨ä»ç„¶ä¼šå‘æœåŠ¡å™¨å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚ï¼š IE å‘é¡µé¢æ‰€åœ¨çš„ç›®å½•å‘é€è¯·æ±‚ï¼› Safariã€Chromeã€Firefox å‘é¡µé¢æœ¬èº«å‘é€è¯·æ±‚ï¼› Opera ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ ä»¥ä¸Šæ•°æ®è¾ƒè€ï¼Œå½“ä¸‹ä¸»æµç‰ˆæœ¬å¯èƒ½ä¼šæœ‰æ”¹å˜ã€‚ ç©º src äº§ç”Ÿè¯·æ±‚çš„åæœä¸å®¹å°è§‘ï¼š ç»™æœåŠ¡å™¨é€ æˆæ„å¤–çš„æµé‡è´Ÿæ‹…ï¼Œå°¤å…¶æ—¶æ—¥ PV è¾ƒå¤§æ—¶ï¼› æµªè´¹æœåŠ¡å™¨è®¡ç®—èµ„æºï¼› å¯èƒ½äº§ç”ŸæŠ¥é”™ã€‚ å½“ç„¶ï¼Œæµè§ˆå™¨å¦‚æ­¤å®ç°ä¹Ÿæ˜¯æ ¹æ® RFC 3986 - Uniform Resource Identifiersï¼Œå½“ç©ºå­—ç¬¦ä¸²ä½œä¸º URI å‡ºç°æ—¶ï¼Œè¢«å½“æˆç›¸å¯¹ URIï¼Œå…·ä½“ç®—æ³•å‚è§è§„èŒƒ 5.2 èŠ‚ã€‚ å‚è€ƒé“¾æ¥ï¼š Empty image src can destroy your site ç©ºçš„ href å±æ€§ä¹Ÿå­˜åœ¨ç±»ä¼¼é—®é¢˜ã€‚ç”¨æˆ·ç‚¹å‡»ç©ºé“¾æ¥æ—¶ï¼Œæµè§ˆå™¨ä¹Ÿä¼šå‘æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚ï¼Œå¯ä»¥é€šè¿‡ JavaScript é˜»æ­¢ç©ºé“¾æ¥çš„é»˜è®¤çš„è¡Œä¸ºã€‚ Cookieå‡å°‘ Cookie å¤§å°Cookie è¢«ç”¨äºèº«ä»½è®¤è¯ã€ä¸ªæ€§åŒ–è®¾ç½®ç­‰è¯¸å¤šç”¨é€”ã€‚Cookie é€šè¿‡ HTTP å¤´åœ¨æœåŠ¡å™¨å’Œæµè§ˆå™¨é—´æ¥å›ä¼ é€ï¼Œå‡å°‘ Cookie å¤§å°å¯ä»¥é™ä½å…¶å¯¹å“åº”é€Ÿåº¦çš„å½±å“ã€‚ å»é™¤ä¸å¿…è¦çš„ Cookieï¼› å°½é‡å‹ç¼© Cookie å¤§å°ï¼› æ³¨æ„è®¾ç½® Cookie çš„ domain çº§åˆ«ï¼Œå¦‚æ— å¿…è¦ï¼Œä¸è¦å½±å“åˆ° sub-domainï¼› è®¾ç½®åˆé€‚çš„è¿‡æœŸæ—¶é—´ã€‚ æ›´å¤šç»†èŠ‚å‚è€ƒ When the Cookie Crumblesã€‚ HTTP/2 é¦–éƒ¨å‹ç¼©åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨ã€Œé¦–éƒ¨è¡¨ã€æ¥è·Ÿè¸ªå’Œå­˜å‚¨ä¹‹å‰å‘é€çš„é”®å€¼å¯¹ï¼Œå¯¹äºç›¸åŒçš„æ•°æ®ï¼Œä¸å†éšæ¯æ¬¡è¯·æ±‚å’Œå“åº”å‘é€ã€‚ é™æ€èµ„æºä½¿ç”¨æ—  Cookie åŸŸåé™æ€èµ„æºä¸€èˆ¬æ— éœ€ä½¿ç”¨ Cookieï¼Œå¯ä»¥æŠŠå®ƒä»¬æ”¾åœ¨ä½¿ç”¨äºŒçº§åŸŸåæˆ–è€…ä¸“é—¨åŸŸåçš„æ—  Cookie æœåŠ¡å™¨ä¸Šï¼Œé™ä½ Cookie ä¼ é€çš„é€ æˆçš„æµé‡æµªè´¹ï¼Œæé«˜å“åº”é€Ÿåº¦ã€‚ CSSæŠŠæ ·å¼è¡¨æ”¾åœ¨ `` ä¸­æŠŠæ ·å¼è¡¨æ”¾åœ¨ `` ä¸­å¯ä»¥è®©é¡µé¢æ¸è¿›æ¸²æŸ“ï¼Œå°½æ—©å‘ˆç°è§†è§‰åé¦ˆï¼Œç»™ç”¨æˆ·åŠ è½½é€Ÿåº¦å¾ˆå¿«çš„æ„Ÿè§‰ã€‚ è¿™å¯¹å†…å®¹æ¯”è¾ƒå¤šçš„é¡µé¢å°¤ä¸ºé‡è¦ï¼Œç”¨æˆ·å¯ä»¥å…ˆæŸ¥çœ‹å·²ç»ä¸‹è½½æ¸²æŸ“çš„å†…å®¹ï¼Œè€Œä¸æ˜¯ç›¯ç€ç™½å±ç­‰å¾…ã€‚ å¦‚æœæŠŠæ ·å¼è¡¨æ”¾åœ¨é¡µé¢åº•éƒ¨ï¼Œä¸€äº›æµè§ˆå™¨ä¸ºå‡å°‘é‡ç»˜ï¼Œä¼šåœ¨ CSS åŠ è½½å®Œæˆä»¥åæ‰æ¸²æŸ“é¡µé¢ï¼Œç”¨æˆ·åªèƒ½å¯¹ç€ç™½å±å¹²çªçœ¼ï¼Œç”¨æˆ·ä½“éªŒæå·®ã€‚ ä¸è¦ä½¿ç”¨ CSS è¡¨è¾¾å¼CSS è¡¨è¾¾å¼å¯ä»¥åœ¨ CSS é‡Œæ‰§è¡Œ JavaScriptï¼Œä»… IE5-IE7 æ”¯æŒï¼ŒIE8 æ ‡å‡†æ¨¡å¼å·²ç»åºŸå¼ƒã€‚ CSS è¡¨è¾¾å¼è¶…å‡ºé¢„æœŸçš„é¢‘ç¹æ‰§è¡Œï¼Œé¡µé¢æ»šåŠ¨ã€é¼ æ ‡ç§»åŠ¨æ—¶éƒ½ä¼šä¸æ–­æ‰§è¡Œï¼Œå¸¦æ¥å¾ˆå¤§çš„æ€§èƒ½æŸè€—ã€‚ IE7 åŠæ›´ä½ç‰ˆæœ¬çš„æµè§ˆå™¨å·²ç»é€æ¸æˆä¸ºå†å²ï¼Œå¿˜è®°å®ƒå§ã€‚ ä½¿ç”¨ `` æ›¿ä»£ @importå¯¹äº IE æŸäº›ç‰ˆæœ¬ï¼Œ@import çš„è¡Œä¸ºå’Œ `` æ”¾åœ¨é¡µé¢åº•éƒ¨ä¸€æ ·ã€‚æ‰€ä»¥ï¼Œä¸è¦ç”¨å®ƒã€‚ ä¸è¦ä½¿ç”¨ filterAlphaImageLoader ä¸º IE5.5-IE8 ä¸“æœ‰çš„æŠ€æœ¯ï¼Œå’Œ CSS è¡¨è¾¾å¼ä¸€æ ·ï¼Œæ”¾è¿›åšç‰©é¦†å§ã€‚ æ³¨æ„ï¼š è¿™é‡Œæ‰€è¯´çš„ä¸æ˜¯ CSS3 Filterï¼Œå‚è€ƒæ–‡ç«  Understanding CSS Filter Effects JavaScriptä½¿ç”¨requestIdleCallback å…¼å®¹æ€§ä¸å¥½ï¼Œç›®å‰åªæœ‰chromeæ”¯æŒ å¸Œæœ›å¿«é€Ÿå“åº”ç”¨æˆ·ï¼Œè®©ç”¨æˆ·è§‰å¾—å¿« ä½¿å¼€å‘è€…èƒ½å¤Ÿå†ä¸»äº‹ä»¶å¾ªç¯ä¸Šæ‰§è¡Œåå°å’Œä½ä¼˜å…ˆçº§å·¥ä½œï¼Œè€Œä¸ä¼šå½±å“å»¶è¿Ÿå…³é”®äº‹ä»¶ã€‚ æ­£å¸¸å¸§ä»»åŠ¡å®Œæˆåæ²¡è¶…è¿‡16msï¼Œè¯´æ˜äº‹ä»¶æœ‰å¯Œä½™ï¼Œåˆ™æ‰§è¡Œå®ƒçš„å›è°ƒå‡½æ•° æŠŠè„šæœ¬æ”¾åœ¨é¡µé¢åº•éƒ¨æµè§ˆå™¨ä¸‹è½½è„šæœ¬æ—¶ï¼Œä¼šé˜»å¡å…¶ä»–èµ„æºå¹¶è¡Œä¸‹è½½ï¼Œå³ä½¿æ˜¯æ¥è‡ªä¸åŒåŸŸåçš„èµ„æºã€‚å› æ­¤ï¼Œæœ€å¥½å°†è„šæœ¬æ”¾åœ¨åº•éƒ¨ï¼Œä»¥æé«˜é¡µé¢åŠ è½½é€Ÿåº¦ã€‚ ä¸€äº›ç‰¹æ®Šåœºæ™¯æ— æ³•å°†è„šæœ¬æ”¾åˆ°é¡µé¢åº•éƒ¨çš„ï¼Œå¯ä»¥è€ƒè™‘ `` çš„ä»¥ä¸‹å±æ€§ï¼š defer å±æ€§ï¼› HTML5 æ–°å¢çš„ async å±æ€§ã€‚ ä½¿ç”¨å¤–éƒ¨ JavaScript å’Œ CSSå¤–éƒ¨ JavaScript å’Œ CSS æ–‡ä»¶å¯ä»¥è¢«æµè§ˆå™¨ç¼“å­˜ï¼Œåœ¨ä¸åŒé¡µé¢é—´é‡ç”¨ï¼Œä¹Ÿèƒ½é™ä½é¡µé¢å¤§å°ã€‚ å½“ç„¶ï¼Œå®é™…ä¸­ä¹Ÿéœ€è¦è€ƒè™‘ä»£ç çš„é‡ç”¨ç¨‹åº¦ã€‚å¦‚æœä»…ä»…æ˜¯æŸä¸ªé¡µé¢ä½¿ç”¨åˆ°çš„ä»£ç ï¼Œå¯ä»¥è€ƒè™‘å†…åµŒåœ¨é¡µé¢ä¸­ï¼Œå‡å°‘ HTTP è¯·æ±‚æ•°ã€‚å¦å¤–ï¼Œå¯ä»¥åœ¨é¦–é¡µåŠ è½½å®Œæˆä»¥åï¼Œé¢„å…ˆåŠ è½½å­é¡µé¢çš„èµ„æºã€‚ å‹ç¼© JavaScript å’Œ CSSå‹ç¼©ä»£ç å¯ä»¥ç§»é™¤éåŠŸèƒ½æ€§çš„å­—ç¬¦ï¼ˆæ³¨é‡Šã€ç©ºæ ¼ã€ç©ºè¡Œç­‰ï¼‰ï¼Œå‡å°‘æ–‡ä»¶å¤§å°ï¼Œæé«˜è½½å…¥é€Ÿåº¦ã€‚ å¾—ç›Šäº Node.js çš„æµè¡Œï¼Œå¼€æºç¤¾åŒºæ¶Œç°å‡ºè®¸å¤šé«˜æ•ˆã€æ˜“ç”¨çš„å‰ç«¯ä¼˜åŒ–å·¥å…·ï¼ŒJavaScript å’Œ CSS å‹ç¼©ç±»çš„ï¼Œä¸æ•¢è¯´å¤šå¦‚ç‰›æ¯›ï¼Œå¤šå…¥é¸¡æ¯›å€’æ˜¯ä¸€ç‚¹ä¸å¤¸å¼ ï¼Œå¦‚ [UglifyJS 2] (https://github.com/mishoo/UglifyJS2)ã€[csso](https://www.npmjs.com/package/csso)ã€[cssnano](https://www.npmjs.com/package/cssnano) ç­‰ã€‚ å¯¹äºå†…åµŒçš„ CSS å’Œ JavaScriptï¼Œä¹Ÿå¯ä»¥é€šè¿‡ htmlmin ç­‰å·¥å…·å‹ç¼©ã€‚ è¿™äº›é¡¹ç›®éƒ½æœ‰ Gulpã€Webpack ç­‰æµè¡Œæ„å»ºå·¥å…·çš„é…å¥—ç‰ˆæœ¬ã€‚ ç§»é™¤é‡å¤è„šæœ¬é‡å¤çš„è„šæœ¬ä¸ä»…äº§ç”Ÿä¸å¿…è¦çš„ HTTP è¯·æ±‚ï¼Œè€Œä¸”é‡å¤è§£ææ‰§è¡Œæµªè´¹æ—¶é—´å’Œè®¡ç®—èµ„æºã€‚ å‡å°‘ DOM æ“ä½œJavaScript æ“ä½œ DOM å¾ˆæ…¢ï¼Œå°¤å…¶æ˜¯ DOM èŠ‚ç‚¹å¾ˆå¤šæ—¶ã€‚ ä½¿ç”¨æ—¶åº”è¯¥æ³¨æ„ï¼š ç¼“å­˜å·²ç»è®¿é—®è¿‡çš„å…ƒç´ ï¼› ä½¿ç”¨ DocumentFragment æš‚å­˜ DOMï¼Œæ•´ç†å¥½ä»¥åå†æ’å…¥ DOM æ ‘ï¼› æ“ä½œ classNameï¼Œè€Œä¸æ˜¯å¤šæ¬¡è¯»å†™ styleï¼› é¿å…ä½¿ç”¨ JavaScript ä¿®å¤å¸ƒå±€ã€‚ ä½¿ç”¨é«˜æ•ˆçš„äº‹ä»¶å¤„ç† å‡å°‘ç»‘å®šäº‹ä»¶ç›‘å¬çš„èŠ‚ç‚¹ï¼Œå¦‚é€šè¿‡äº‹ä»¶å§”æ‰˜ï¼› å°½æ—©å¤„ç†äº‹ä»¶ï¼Œåœ¨ DOMContentLoaded å³å¯è¿›è¡Œï¼Œä¸ç”¨ç­‰åˆ° load ä»¥åã€‚ å¯¹äº resizeã€scroll ç­‰è§¦å‘é¢‘ç‡æé«˜çš„äº‹ä»¶ï¼Œåº”è¯¥é€šè¿‡ debounce ç­‰æœºåˆ¶é™ä½å¤„ç†ç¨‹åºæ‰§è¡Œé¢‘ç‡ã€‚ TODO: è¡¥å……ç›¸å…³å†…å®¹ http://demo.nimius.net/debounce_throttle/ å›¾ç‰‡ä¼˜åŒ–å›¾ç‰‡ YDN åˆ—å‡ºçš„ç›¸å…³å·¥å…· ç¼ºä¹æ˜“ç”¨æ€§ï¼Œå»ºè®®å‚è€ƒä»¥ä¸‹å·¥å…·ã€‚ imagemin ImageOptim TODO: PNG ç»ˆæä¼˜åŒ–ï¼› Webp ç›¸å…³å†…å®¹ï¼› SVG ç›¸å…³å†…å®¹ã€‚ PNG ç»ˆæä¼˜åŒ–ï¼š Most Effective Method to Reduce and Optimize PNG Images Clever PNG Optimization Techniques ä¼˜åŒ– CSS Sprite æ°´å¹³æ’åˆ— Sprite ä¸­çš„å›¾ç‰‡ï¼Œå‚ç›´æ’åˆ—ä¼šå¢åŠ å›¾ç‰‡å¤§å°ï¼› Spirite ä¸­æŠŠé¢œè‰²è¾ƒè¿‘çš„ç»„åˆåœ¨ä¸€èµ·å¯ä»¥é™ä½é¢œè‰²æ•°ï¼Œç†æƒ³çŠ¶å†µæ˜¯ä½äº 256 è‰²ä»¥é€‚ç”¨ PNG8 æ ¼å¼ï¼› ä¸è¦åœ¨ Spirite çš„å›¾åƒä¸­é—´ç•™æœ‰è¾ƒå¤§ç©ºéš™ã€‚å‡å°‘ç©ºéš™è™½ç„¶ä¸å¤ªå½±å“æ–‡ä»¶å¤§å°ï¼Œä½†å¯ä»¥é™ä½ç”¨æˆ·ä»£ç†æŠŠå›¾ç‰‡è§£å‹ä¸ºåƒç´ å›¾çš„å†…å­˜æ¶ˆè€—ï¼Œå¯¹ç§»åŠ¨è®¾å¤‡æ›´å‹å¥½ã€‚ ä¸è¦åœ¨ HTML ä¸­ç¼©æ”¾å›¾ç‰‡ä¸è¦ä½¿ç”¨ `` çš„ widthã€height ç¼©æ”¾å›¾ç‰‡ï¼Œå¦‚æœç”¨åˆ°å°å›¾ç‰‡ï¼Œå°±ä½¿ç”¨ç›¸åº”å¤§å°çš„å›¾ç‰‡ã€‚ å¾ˆå¤š CMS å’Œ CDN éƒ½æä¾›å›¾ç‰‡è£åˆ‡åŠŸèƒ½ã€‚ ä½¿ç”¨ä½“ç§¯å°ã€å¯ç¼“å­˜çš„ favicon.icoFavicon.ico ä¸€èˆ¬å­˜æ”¾åœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹ï¼Œæ— è®ºæ˜¯å¦åœ¨é¡µé¢ä¸­è®¾ç½®ï¼Œæµè§ˆå™¨éƒ½ä¼šå°è¯•è¯·æ±‚è¿™ä¸ªæ–‡ä»¶ã€‚ æ‰€ä»¥ç¡®ä¿è¿™ä¸ªå›¾æ ‡ï¼š å­˜åœ¨ï¼ˆé¿å… 404ï¼‰ï¼› å°½é‡å°ï¼Œæœ€å¥½å°äº 1Kï¼› è®¾ç½®è¾ƒé•¿çš„è¿‡æœŸæ—¶é—´ã€‚ å¯¹äºè¾ƒæ–°çš„æµè§ˆå™¨ï¼Œå¯ä»¥ä½¿ç”¨ PNG æ ¼å¼çš„ faviconã€‚ å‚è€ƒé“¾æ¥ï¼š Favicons, Touch Icons, Tile Icons, etc. Which Do You Need? å›¾ç‰‡ç›¸å…³è¡¥å…… è®¾ç½®å›¾ç‰‡çš„å®½å’Œé«˜ï¼Œä»¥å…æµè§ˆå™¨æŒ‰ç…§ã€ŒçŒœã€çš„å®½é«˜ç»™å›¾ç‰‡ä¿ç•™çš„åŒºåŸŸå’Œå®é™…å®½é«˜å·®å¼‚ï¼Œäº§ç”Ÿé‡ç»˜ã€‚ ç§»åŠ¨ç«¯ ç§»åŠ¨ç«¯ä¼˜åŒ–ç›¸å…³å†…å®¹æœ‰å¾…è¿›ä¸€æ­¥æ•´ç†è¡¥å……ã€‚ ä¿æŒå•ä¸ªæ–‡ä»¶å°äº 25 KBæ‰“åŒ…å†…å®¹ä¸ºåˆ†æ®µï¼ˆmultipartï¼‰æ–‡æ¡£å‚è€ƒé“¾æ¥ The Psychology of Web Performance","tags":["Javascript","æ€§èƒ½ä¼˜åŒ–"],"categories":["Javascript"]},{"title":"reactç›¸å…³é¢è¯•çŸ¥è¯†ç‚¹","path":"/2021/06/06/reactç›¸å…³é¢è¯•çŸ¥è¯†ç‚¹/","content":"react çš„ç”Ÿå‘½å‘¨æœŸï¼Œåˆ†åˆ«åœ¨å“ªä¸ªæ—¶å€™è¢«æ‰§è¡ŒsetStateï¼Œå“ªäº›ç”Ÿå‘½å‘¨æœŸå¯ä»¥setStateå‡½æ•°ç»„ä»¶å’Œæ™®é€šç»„ä»¶åŒºåˆ«ä»€ä¹ˆæ˜¯render propsç»„ä»¶fiberæ˜¯ä»€ä¹ˆdiffç®—æ³•VDomè™šæ‹Ÿdomè¿™é‡Œï¼Œå°ç¼–çš„ç†è§£æ˜¯ï¼šè™šæ‹ŸDOMæ˜¯çœŸå®DOMçš„å†…å­˜è¡¨ç¤ºï¼Œæ˜¯ä¸€ç§ç¼–ç¨‹æ¦‚å¿µï¼Œä¸€ç§æ¨¡å¼ã€‚å®ƒçš„ä½œç”¨æ˜¯åˆ¤æ–­DOMæ˜¯å¦æ”¹å˜ã€å“ªäº›éƒ¨åˆ†éœ€è¦è¢«é‡æ–°æ¸²æŸ“ã€‚è¿™æ ·ï¼Œä¸éœ€è¦æ“çºµçœŸå®çš„DOM,åŒæ—¶æå¤§çš„æé«˜äº†Reactçš„æ€§èƒ½ã€‚ è™šæ‹ŸDOMä½¿ç”¨diffç®—æ³•ï¼Œå½“æˆ‘ä»¬å¤šæ¬¡ä¿®æ”¹æŸä¸€éƒ¨åˆ†çš„å†…å®¹æ—¶ï¼Œé¦–å…ˆåœ¨è™šæ‹ŸDOMæ ‘ä»ä¸Šè‡³ä¸‹è¿›è¡ŒåŒå±‚æ¯”å¯¹ï¼ˆä¸å½±å“çœŸå®DOMï¼‰ï¼Œä¸Šå±‚å‘ç”Ÿå˜åŒ–ï¼Œä¸‹å±‚é‡æ–°æ¸²æŸ“ï¼Œç›´åˆ°æœ€åä¿®æ”¹å®Œæˆï¼Œå†åœ¨çœŸå®DOMä¸­æ¸²æŸ“ã€‚ ä½¿ç”¨è™šæ‹ŸDOMçš„åŸå› æ˜¯ï¼Œå¯ä»¥æå¤§ç¨‹åº¦ä¸Šå‡å°‘DOMèŠ‚ç‚¹çš„å›æµå’Œé‡ç»˜é—®é¢˜ï¼ŒèŠ‚çº¦èµ„æºï¼Œæå‡è¿è¡Œæ•ˆç‡ã€‚ åŒºåˆ« è™šæ‹ŸDOMä¸ä¼šè¿›è¡Œé‡æ’å’Œé‡ç»˜ï¼› è™šæ‹ŸDOMè¿›è¡Œé¢‘ç¹çš„ä¿®æ”¹ï¼Œç„¶åä¸€æ¬¡æ€§æ¯”è¾ƒå¹¶ä¿®æ”¹çœŸå®DOMä¸­éœ€è¦ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œæœ€åè¿›è¡Œå›æµå’Œé‡ç»˜ï¼Œæœ‰æ•ˆçš„å‡å°‘äº†è¿‡å¤šDOMèŠ‚ç‚¹å›æµå’Œé‡ç»˜èµ„æºæ¶ˆè€—çš„é—®é¢˜ï¼› è™šæ‹ŸDOMæœ‰æ•ˆé™ä½å¤§é¢ç§¯ï¼ˆçœŸå®DOMèŠ‚ç‚¹ï¼‰çš„å›æµå’Œé‡ç»˜ï¼Œå› ä¸ºæœ€ç»ˆä¸çœŸå®DOMæ¯”è¾ƒå·®å¼‚ï¼Œå¯ä»¥å±€éƒ¨æ¸²æŸ“ã€‚ Reactä¸­çš„controlled component å’Œ uncontrolled componentåŒºåˆ« ï¼ˆå—æ§ç»„ä»¶å’Œä¸å—æ§ç»„ä»¶ï¼‰react-routerå†…éƒ¨å®ç°æœºåˆ¶","tags":["é¢è¯•é¢˜","React"],"categories":["React"]},{"title":"jsçš„ç²¾åº¦è¿ç®—","path":"/2021/06/06/jsçš„ç²¾åº¦è¿ç®—/","content":"å‰è¨€0.1 + 0.2 æ˜¯å¦ç­‰äº 0.3 ä½œä¸ºä¸€é“ç»å…¸çš„é¢è¯•é¢˜ï¼Œå·²ç»å¹¿å¤–ç†ŸçŸ¥ï¼Œè¯´èµ·åŸå› ï¼Œå¤§å®¶èƒ½å›ç­”å‡ºè¿™æ˜¯æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜å¯¼è‡´ï¼Œä¹Ÿèƒ½è¾©è¯çš„çœ‹å¾…è¿™å¹¶éæ˜¯ ECMAScript è¿™é—¨è¯­è¨€çš„é—®é¢˜ï¼Œä»Šå¤©å°±æ˜¯å…·ä½“çœ‹ä¸€ä¸‹èƒŒåçš„åŸå› ã€‚ æ•°å­—ç±»å‹ECMAScript ä¸­çš„ Number ç±»å‹ä½¿ç”¨ IEEE754 æ ‡å‡†æ¥è¡¨ç¤ºæ•´æ•°å’Œæµ®ç‚¹æ•°å€¼ã€‚æ‰€è°“ IEEE754 æ ‡å‡†ï¼Œå…¨ç§° IEEE äºŒè¿›åˆ¶æµ®ç‚¹æ•°ç®—æœ¯æ ‡å‡†ï¼Œè¿™ä¸ªæ ‡å‡†å®šä¹‰äº†è¡¨ç¤ºæµ®ç‚¹æ•°çš„æ ¼å¼ç­‰å†…å®¹ã€‚ åœ¨ IEEE754 ä¸­ï¼Œè§„å®šäº†å››ç§è¡¨ç¤ºæµ®ç‚¹æ•°å€¼çš„æ–¹å¼ï¼šå•ç²¾ç¡®åº¦ï¼ˆ32ä½ï¼‰ã€åŒç²¾ç¡®åº¦ï¼ˆ64ä½ï¼‰ã€å»¶ä¼¸å•ç²¾ç¡®åº¦ã€ä¸å»¶ä¼¸åŒç²¾ç¡®åº¦ã€‚åƒ ECMAScript é‡‡ç”¨çš„å°±æ˜¯åŒç²¾ç¡®åº¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šç”¨ 64 ä½å­—èŠ‚æ¥å‚¨å­˜ä¸€ä¸ªæµ®ç‚¹æ•°ã€‚ æµ®ç‚¹æ•°è½¬äºŒè¿›åˆ¶æˆ‘ä»¬æ¥çœ‹ä¸‹ 1020 ç”¨åè¿›åˆ¶çš„è¡¨ç¤ºï¼š 1020 = 1 * 10^3 + 0 * 10^2 + 2 * 10^1 + 0 * 10^0 æ‰€ä»¥ 1020 ç”¨åè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯ 1020â€¦â€¦(å“ˆå“ˆ) å¦‚æœ 1020 ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºå‘¢ï¼Ÿ 1020 = 1 * 2^9 + 1 * 2^8 + 1 * 2^7 + 1 * 2^6 + 1 * 2^5 + 1 * 2^4 + 1 * 2^3 + 1 * 2^2 + 0 * 2^1 + 0 * 2^0 æ‰€ä»¥ 1020 çš„äºŒè¿›åˆ¶ä¸º 1111111100 é‚£å¦‚æœæ˜¯ 0.75 ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå‘¢ï¼ŸåŒç†åº”è¯¥æ˜¯ï¼š 0.75 = a * 2^-1 + b * 2^-2 + c * 2^-3 + d * 2^-4 + â€¦ å› ä¸ºä½¿ç”¨çš„æ˜¯äºŒè¿›åˆ¶ï¼Œè¿™é‡Œçš„ abcdâ€¦â€¦çš„å€¼çš„è¦ä¹ˆæ˜¯ 0 è¦ä¹ˆæ˜¯ 1ã€‚ é‚£æ€ä¹ˆç®—å‡º abcdâ€¦â€¦ çš„å€¼å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥ä¸¤è¾¹ä¸åœçš„ä¹˜ä»¥ 2 ç®—å‡ºæ¥ï¼Œè§£æ³•å¦‚ä¸‹ï¼š 0.75 = a * 2^-1 + b * 2^-2 + c * 2^-3 + d * 2^-4â€¦ ä¸¤è¾¹åŒæ—¶ä¹˜ä»¥ 2 1 + 0.5 = a * 2^0 + b * 2^-1 + c * 2^-2 + d * 2^-3â€¦ (æ‰€ä»¥ a = 1) å‰©ä¸‹çš„ï¼š 0.5 = b * 2^-1 + c * 2^-2 + d * 2^-3â€¦ å†åŒæ—¶ä¹˜ä»¥ 2 1 + 0 = b * 2^0 + c * 2^-2 + d * 2^-3â€¦ (æ‰€ä»¥ b = 1) æ‰€ä»¥ 0.75 ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯ 0.abï¼Œä¹Ÿå°±æ˜¯ 0.11 ç„¶è€Œä¸æ˜¯æ‰€æœ‰çš„æ•°éƒ½åƒ 0.75 è¿™ä¹ˆå¥½ç®—ï¼Œæˆ‘ä»¬æ¥ç®—ä¸‹ 0.1ï¼š 12345678910110.1 = a * 2^-1 + b * 2^-2 + c * 2^-3 + d * 2^-4 + ...0 + 0.2 = a * 2^0 + b * 2^-1 + c * 2^-2 + ... (a = 0)0 + 0.4 = b * 2^0 + c * 2^-1 + d * 2^-2 + ... (b = 0)0 + 0.8 = c * 2^0 + d * 2^-1 + e * 2^-2 + ... (c = 0)1 + 0.6 = d * 2^0 + e * 2^-1 + f * 2^-2 + ... (d = 1)1 + 0.2 = e * 2^0 + f * 2^-1 + g * 2^-2 + ... (e = 1)0 + 0.4 = f * 2^0 + g * 2^-1 + h * 2^-2 + ... (f = 0)0 + 0.8 = g * 2^0 + h * 2^-1 + i * 2^-2 + ... (g = 0)1 + 0.6 = h * 2^0 + i * 2^-1 + j * 2^-2 + ... (h = 1).... ç„¶åä½ å°±ä¼šå‘ç°ï¼Œè¿™ä¸ªè®¡ç®—åœ¨ä¸åœçš„å¾ªç¯ï¼Œæ‰€ä»¥ 0.1 ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯ 0.00011001100110011â€¦â€¦ æµ®ç‚¹æ•°çš„å­˜å‚¨è™½ç„¶ 0.1 è½¬æˆäºŒè¿›åˆ¶æ—¶æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯çš„æ•°ï¼Œä½†è®¡ç®—æœºæ€»è¦å‚¨å­˜å§ï¼Œæˆ‘ä»¬çŸ¥é“ ECMAScript ä½¿ç”¨ 64 ä½å­—èŠ‚æ¥å‚¨å­˜ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œé‚£å…·ä½“æ˜¯æ€ä¹ˆå‚¨å­˜çš„å‘¢ï¼Ÿè¿™å°±è¦è¯´å› IEEE754 è¿™ä¸ªæ ‡å‡†äº†ï¼Œæ¯•ç«Ÿæ˜¯è¿™ä¸ªæ ‡å‡†è§„å®šäº†å­˜å‚¨çš„æ–¹å¼ã€‚ è¿™ä¸ªæ ‡å‡†è®¤ä¸ºï¼Œä¸€ä¸ªæµ®ç‚¹æ•° (Value) å¯ä»¥è¿™æ ·è¡¨ç¤ºï¼š Value = sign * exponent * fraction çœ‹èµ·æ¥å¾ˆæŠ½è±¡çš„æ ·å­ï¼Œç®€å•ç†è§£å°±æ˜¯ç§‘å­¦è®¡æ•°æ³•â€¦â€¦ æ¯”å¦‚ -1020ï¼Œç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºå°±æ˜¯: -1 * 10^3 * 1.02 sign å°±æ˜¯ -1ï¼Œexponent å°±æ˜¯ 10^3ï¼Œfraction å°±æ˜¯ 1.02 å¯¹äºäºŒè¿›åˆ¶ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä»¥ 0.1 çš„äºŒè¿›åˆ¶ 0.00011001100110011â€¦â€¦ è¿™ä¸ªæ•°æ¥è¯´ï¼š å¯ä»¥è¡¨ç¤ºä¸ºï¼š 1 * 2^-4 * 1.1001100110011â€¦â€¦ å…¶ä¸­ sign å°±æ˜¯ 1ï¼Œexponent å°±æ˜¯ 2^-4ï¼Œfraction å°±æ˜¯ 1.1001100110011â€¦â€¦ è€Œå½“åªåšäºŒè¿›åˆ¶ç§‘å­¦è®¡æ•°æ³•çš„è¡¨ç¤ºæ—¶ï¼Œè¿™ä¸ª Value çš„è¡¨ç¤ºå¯ä»¥å†å…·ä½“ä¸€ç‚¹å˜æˆï¼š V = (-1)^S * (1 + Fraction) * 2^E (å¦‚æœæ‰€æœ‰çš„æµ®ç‚¹æ•°éƒ½å¯ä»¥è¿™æ ·è¡¨ç¤ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å­˜å‚¨çš„æ—¶å€™å°±æŠŠè¿™å…¶ä¸­ä¼šå˜åŒ–çš„ä¸€äº›å€¼å­˜å‚¨èµ·æ¥å°±å¥½äº†) æˆ‘ä»¬æ¥ä¸€ç‚¹ç‚¹çœ‹ï¼š (-1)^S è¡¨ç¤ºç¬¦å·ä½ï¼Œå½“ S = 0ï¼ŒV ä¸ºæ­£æ•°ï¼›å½“ S = 1ï¼ŒV ä¸ºè´Ÿæ•°ã€‚ å†çœ‹ (1 + Fraction)ï¼Œè¿™æ˜¯å› ä¸ºæ‰€æœ‰çš„æµ®ç‚¹æ•°éƒ½å¯ä»¥è¡¨ç¤ºä¸º 1.xxxx * 2^xxx çš„å½¢å¼ï¼Œå‰é¢çš„ä¸€å®šæ˜¯ 1.xxxï¼Œé‚£å¹²è„†æˆ‘ä»¬å°±ä¸å­˜å‚¨è¿™ä¸ª 1 äº†ï¼Œç›´æ¥å­˜åé¢çš„ xxxxx å¥½äº†ï¼Œè¿™ä¹Ÿå°±æ˜¯ Fraction çš„éƒ¨åˆ†ã€‚ æœ€åå†çœ‹ 2^E å¦‚æœæ˜¯ 1020.75ï¼Œå¯¹åº”äºŒè¿›åˆ¶æ•°å°±æ˜¯ 1111111100.11ï¼Œå¯¹åº”äºŒè¿›åˆ¶ç§‘å­¦è®¡æ•°æ³•å°±æ˜¯ 1 * 1.11111110011 * 2^9ï¼ŒE çš„å€¼å°±æ˜¯ 9ï¼Œè€Œå¦‚æœæ˜¯ 0.1 ï¼Œå¯¹åº”äºŒè¿›åˆ¶æ˜¯ 1 * 1.1001100110011â€¦â€¦ * 2^-4ï¼Œ E çš„å€¼å°±æ˜¯ -4ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒE æ—¢å¯èƒ½æ˜¯è´Ÿæ•°ï¼Œåˆå¯èƒ½æ˜¯æ­£æ•°ï¼Œé‚£é—®é¢˜å°±æ¥äº†ï¼Œé‚£æˆ‘ä»¬è¯¥æ€ä¹ˆå‚¨å­˜è¿™ä¸ª E å‘¢ï¼Ÿ æˆ‘ä»¬è¿™æ ·è§£å†³ï¼Œå‡å¦‚æˆ‘ä»¬ç”¨ 8 ä½å­—èŠ‚æ¥å­˜å‚¨ E è¿™ä¸ªæ•°ï¼Œå¦‚æœåªæœ‰æ­£æ•°çš„è¯ï¼Œå‚¨å­˜çš„å€¼çš„èŒƒå›´æ˜¯ 0 ~ 254ï¼Œè€Œå¦‚æœè¦å‚¨å­˜æ­£è´Ÿæ•°çš„è¯ï¼Œå€¼çš„èŒƒå›´å°±æ˜¯ -127~127ï¼Œæˆ‘ä»¬åœ¨å­˜å‚¨çš„æ—¶å€™ï¼ŒæŠŠè¦å­˜å‚¨çš„æ•°å­—åŠ ä¸Š 127ï¼Œè¿™æ ·å½“æˆ‘ä»¬å­˜ -127 çš„æ—¶å€™ï¼Œæˆ‘ä»¬å­˜ 0ï¼Œå½“å­˜ 127 çš„æ—¶å€™ï¼Œå­˜ 254ï¼Œè¿™æ ·å°±è§£å†³äº†å­˜è´Ÿæ•°çš„é—®é¢˜ã€‚å¯¹åº”çš„ï¼Œå½“å–å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬å†å‡å» 127ã€‚ æ‰€ä»¥å‘¢ï¼ŒçœŸåˆ°å®é™…å­˜å‚¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šç›´æ¥å­˜å‚¨ Eï¼Œè€Œæ˜¯ä¼šå­˜å‚¨ E + biasï¼Œå½“ç”¨ 8 ä¸ªå­—èŠ‚çš„æ—¶å€™ï¼Œè¿™ä¸ª bias å°±æ˜¯ 127ã€‚ æ‰€ä»¥ï¼Œå¦‚æœè¦å­˜å‚¨ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œæˆ‘ä»¬å­˜ S å’Œ Fraction å’Œ E + bias è¿™ä¸‰ä¸ªå€¼å°±å¥½äº†ï¼Œé‚£å…·ä½“è¦åˆ†é…å¤šå°‘ä¸ªå­—èŠ‚ä½æ¥å­˜å‚¨è¿™äº›æ•°å‘¢ï¼ŸIEEE754 ç»™å‡ºäº†æ ‡å‡†ï¼š [] åœ¨è¿™ä¸ªæ ‡å‡†ä¸‹ï¼š æˆ‘ä»¬ä¼šç”¨ 1 ä½å­˜å‚¨ Sï¼Œ0 è¡¨ç¤ºæ­£æ•°ï¼Œ1 è¡¨ç¤ºè´Ÿæ•°ã€‚ ç”¨ 11 ä½å­˜å‚¨ E + biasï¼Œå¯¹äº 11 ä½æ¥è¯´ï¼Œbias çš„å€¼æ˜¯ 2^(11-1) - 1ï¼Œä¹Ÿå°±æ˜¯ 1023ã€‚ ç”¨ 52 ä½å­˜å‚¨ Fractionã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå°±æ‹¿ 0.1 æ¥çœ‹ï¼Œå¯¹åº”äºŒè¿›åˆ¶æ˜¯ 1 * 1.1001100110011â€¦â€¦ * 2^-4ï¼Œ Sign æ˜¯ 0ï¼ŒE + bias æ˜¯ -4 + 1023 = 1019ï¼Œ1019 ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ 1111111011ï¼ŒFraction æ˜¯ 1001100110011â€¦â€¦ å¯¹åº” 64 ä¸ªå­—èŠ‚ä½çš„å®Œæ•´è¡¨ç¤ºå°±æ˜¯ï¼š 0 01111111011 1001100110011001100110011001100110011001100110011010 åŒç†, 0.2 è¡¨ç¤ºçš„å®Œæ•´è¡¨ç¤ºæ˜¯ï¼š 0 01111111100 1001100110011001100110011001100110011001100110011010 æ‰€ä»¥å½“ 0.1 å­˜ä¸‹æ¥çš„æ—¶å€™ï¼Œå°±å·²ç»å‘ç”Ÿäº†ç²¾åº¦ä¸¢å¤±ï¼Œå½“æˆ‘ä»¬ç”¨æµ®ç‚¹æ•°è¿›è¡Œè¿ç®—çš„æ—¶å€™ï¼Œä½¿ç”¨çš„å…¶å®æ˜¯ç²¾åº¦ä¸¢å¤±åçš„æ•°ã€‚ æµ®ç‚¹æ•°çš„è¿ç®—å…³äºæµ®ç‚¹æ•°çš„è¿ç®—ï¼Œä¸€èˆ¬ç”±ä»¥ä¸‹äº”ä¸ªæ­¥éª¤å®Œæˆï¼šå¯¹é˜¶ã€å°¾æ•°è¿ç®—ã€è§„æ ¼åŒ–ã€èˆå…¥å¤„ç†ã€æº¢å‡ºåˆ¤æ–­ã€‚æˆ‘ä»¬æ¥ç®€å•çœ‹ä¸€ä¸‹ 0.1 å’Œ 0.2 çš„è®¡ç®—ã€‚ é¦–å…ˆæ˜¯å¯¹é˜¶ï¼Œæ‰€è°“å¯¹é˜¶ï¼Œå°±æ˜¯æŠŠé˜¶ç è°ƒæ•´ä¸ºç›¸åŒï¼Œæ¯”å¦‚ 0.1 æ˜¯ 1.1001100110011â€¦â€¦ * 2^-4ï¼Œé˜¶ç æ˜¯ -4ï¼Œè€Œ 0.2 å°±æ˜¯ 1.10011001100110...* 2^-3ï¼Œé˜¶ç æ˜¯ -3ï¼Œä¸¤ä¸ªé˜¶ç ä¸åŒï¼Œæ‰€ä»¥å…ˆè°ƒæ•´ä¸ºç›¸åŒçš„é˜¶ç å†è¿›è¡Œè®¡ç®—ï¼Œè°ƒæ•´åŸåˆ™æ˜¯å°é˜¶å¯¹å¤§é˜¶ï¼Œä¹Ÿå°±æ˜¯ 0.1 çš„ -4 è°ƒæ•´ä¸º -3ï¼Œå¯¹åº”å˜æˆ 0.11001100110011â€¦â€¦ * 2^-3 æ¥ä¸‹æ¥æ˜¯å°¾æ•°è®¡ç®—: 1234 0.1100110011001100110011001100110011001100110011001101+ 1.1001100110011001100110011001100110011001100110011010â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 10.0110011001100110011001100110011001100110011001100111 æˆ‘ä»¬å¾—åˆ°ç»“æœä¸º 10.0110011001100110011001100110011001100110011001100111 * 2^-3 å°†è¿™ä¸ªç»“æœå¤„ç†ä¸€ä¸‹ï¼Œå³ç»“æœè§„æ ¼åŒ–ï¼Œå˜æˆ 1.0011001100110011001100110011001100110011001100110011(1) * 2^-2 æ‹¬å·é‡Œçš„ 1 æ„æ€æ˜¯è¯´è®¡ç®—åè¿™ä¸ª 1 è¶…å‡ºäº†èŒƒå›´ï¼Œæ‰€ä»¥è¦è¢«èˆå¼ƒäº†ã€‚ å†ç„¶åæ˜¯èˆå…¥ï¼Œå››èˆäº”å…¥å¯¹åº”åˆ°äºŒè¿›åˆ¶ä¸­ï¼Œå°±æ˜¯ 0 èˆ 1 å…¥ï¼Œå› ä¸ºæˆ‘ä»¬è¦æŠŠæ‹¬å·é‡Œçš„ 1 ä¸¢äº†ï¼Œæ‰€ä»¥è¿™é‡Œä¼šè¿›ä¸€ï¼Œç»“æœå˜æˆ 11.0011001100110011001100110011001100110011001100110100 * 2^-2 æœ¬æ¥è¿˜æœ‰ä¸€ä¸ªæº¢å‡ºåˆ¤æ–­ï¼Œå› ä¸ºè¿™é‡Œä¸æ¶‰åŠï¼Œå°±ä¸è®²äº†ã€‚ æ‰€ä»¥æœ€ç»ˆçš„ç»“æœå­˜æˆ 64 ä½å°±æ˜¯ 0 01111111101 0011001100110011001100110011001100110011001100110100 å°†å®ƒè½¬æ¢ä¸º10è¿›åˆ¶æ•°å°±å¾—åˆ° 0.30000000000000004440892098500626 å› ä¸ºä¸¤æ¬¡å­˜å‚¨æ—¶çš„ç²¾åº¦ä¸¢å¤±åŠ ä¸Šä¸€æ¬¡è¿ç®—æ—¶çš„ç²¾åº¦ä¸¢å¤±ï¼Œæœ€ç»ˆå¯¼è‡´äº† 0.1 + 0.2 !== 0.3 å…¶ä»–12345678910111213// åè¿›åˆ¶è½¬äºŒè¿›åˆ¶parseFloat(0.1).toString(2);=&gt; &quot;0.0001100110011001100110011001100110011001100110011001101&quot;// äºŒè¿›åˆ¶è½¬åè¿›åˆ¶parseInt(1100100,2)=&gt; 100// ä»¥æŒ‡å®šçš„ç²¾åº¦è¿”å›è¯¥æ•°å€¼å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤º(0.1 + 0.2).toPrecision(21)=&gt; &quot;0.300000000000000044409&quot;(0.3).toPrecision(21)=&gt; &quot;0.299999999999999988898&quot;","tags":["Javascript","é¢è¯•é¢˜","æµ®ç‚¹æ•°","ç²¾åº¦è¿ç®—"],"categories":["Javascript"]},{"title":"jsçš„é—­åŒ…","path":"/2021/06/06/jsçš„é—­åŒ…/","content":"å®šä¹‰MDN å¯¹é—­åŒ…çš„å®šä¹‰ä¸ºï¼š é—­åŒ…æ˜¯æŒ‡é‚£äº›èƒ½å¤Ÿè®¿é—®è‡ªç”±å˜é‡çš„å‡½æ•°ã€‚ é‚£ä»€ä¹ˆæ˜¯è‡ªç”±å˜é‡å‘¢ï¼Ÿ è‡ªç”±å˜é‡æ˜¯æŒ‡åœ¨å‡½æ•°ä¸­ä½¿ç”¨çš„ï¼Œä½†æ—¢ä¸æ˜¯å‡½æ•°å‚æ•°ä¹Ÿä¸æ˜¯å‡½æ•°çš„å±€éƒ¨å˜é‡çš„å˜é‡ã€‚ ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºé—­åŒ…å…±æœ‰ä¸¤éƒ¨åˆ†ç»„æˆï¼š é—­åŒ… = å‡½æ•° + å‡½æ•°èƒ½å¤Ÿè®¿é—®çš„è‡ªç”±å˜é‡ ä¸¾ä¸ªä¾‹å­ï¼š 1234567var a = 1;function foo() &#123; console.log(a);&#125;foo(); foo å‡½æ•°å¯ä»¥è®¿é—®å˜é‡ aï¼Œä½†æ˜¯ a æ—¢ä¸æ˜¯ foo å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œä¹Ÿä¸æ˜¯ foo å‡½æ•°çš„å‚æ•°ï¼Œæ‰€ä»¥ a å°±æ˜¯è‡ªç”±å˜é‡ã€‚ é‚£ä¹ˆï¼Œå‡½æ•° foo + foo å‡½æ•°è®¿é—®çš„è‡ªç”±å˜é‡ a ä¸å°±æ˜¯æ„æˆäº†ä¸€ä¸ªé—­åŒ…å˜›â€¦â€¦ è¿˜çœŸæ˜¯è¿™æ ·çš„ï¼ æ‰€ä»¥åœ¨ã€ŠJavaScriptæƒå¨æŒ‡å—ã€‹ä¸­å°±è®²åˆ°ï¼šä»æŠ€æœ¯çš„è§’åº¦è®²ï¼Œæ‰€æœ‰çš„JavaScriptå‡½æ•°éƒ½æ˜¯é—­åŒ…ã€‚ å’¦ï¼Œè¿™æ€ä¹ˆè·Ÿæˆ‘ä»¬å¹³æ—¶çœ‹åˆ°çš„è®²åˆ°çš„é—­åŒ…ä¸ä¸€æ ·å‘¢ï¼ï¼Ÿ åˆ«ç€æ€¥ï¼Œè¿™æ˜¯ç†è®ºä¸Šçš„é—­åŒ…ï¼Œå…¶å®è¿˜æœ‰ä¸€ä¸ªå®è·µè§’åº¦ä¸Šçš„é—­åŒ…ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ±¤å§†å¤§å”ç¿»è¯‘çš„å…³äºé—­åŒ…çš„æ–‡ç« ä¸­çš„å®šä¹‰ï¼š ECMAScriptä¸­ï¼Œé—­åŒ…æŒ‡çš„æ˜¯ï¼š ä»ç†è®ºè§’åº¦ï¼šæ‰€æœ‰çš„å‡½æ•°ã€‚å› ä¸ºå®ƒä»¬éƒ½åœ¨åˆ›å»ºçš„æ—¶å€™å°±å°†ä¸Šå±‚ä¸Šä¸‹æ–‡çš„æ•°æ®ä¿å­˜èµ·æ¥äº†ã€‚å“ªæ€•æ˜¯ç®€å•çš„å…¨å±€å˜é‡ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› ä¸ºå‡½æ•°ä¸­è®¿é—®å…¨å±€å˜é‡å°±ç›¸å½“äºæ˜¯åœ¨è®¿é—®è‡ªç”±å˜é‡ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨æœ€å¤–å±‚çš„ä½œç”¨åŸŸã€‚ ä»å®è·µè§’åº¦ï¼šä»¥ä¸‹å‡½æ•°æ‰ç®—æ˜¯é—­åŒ…ï¼š å³ä½¿åˆ›å»ºå®ƒçš„ä¸Šä¸‹æ–‡å·²ç»é”€æ¯ï¼Œå®ƒä»ç„¶å­˜åœ¨ï¼ˆæ¯”å¦‚ï¼Œå†…éƒ¨å‡½æ•°ä»çˆ¶å‡½æ•°ä¸­è¿”å›ï¼‰ åœ¨ä»£ç ä¸­å¼•ç”¨äº†è‡ªç”±å˜é‡ æ¥ä¸‹æ¥å°±æ¥è®²è®²å®è·µä¸Šçš„é—­åŒ…ã€‚ åˆ†æè®©æˆ‘ä»¬å…ˆå†™ä¸ªä¾‹å­ï¼Œä¾‹å­ä¾ç„¶æ˜¯æ¥è‡ªã€ŠJavaScriptæƒå¨æŒ‡å—ã€‹ï¼Œç¨å¾®åšç‚¹æ”¹åŠ¨ï¼š 1234567891011var scope = &quot;global scope&quot;;function checkscope()&#123; var scope = &quot;local scope&quot;; function f()&#123; return scope; &#125; return f;&#125;var foo = checkscope();foo(); é¦–å…ˆæˆ‘ä»¬è¦åˆ†æä¸€ä¸‹è¿™æ®µä»£ç ä¸­æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆå’Œæ‰§è¡Œä¸Šä¸‹æ–‡çš„å˜åŒ–æƒ…å†µã€‚ è¿™é‡Œç›´æ¥ç»™å‡ºç®€è¦çš„æ‰§è¡Œè¿‡ç¨‹ï¼š è¿›å…¥å…¨å±€ä»£ç ï¼Œåˆ›å»ºå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å‹å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡åˆå§‹åŒ– æ‰§è¡Œ checkscope å‡½æ•°ï¼Œåˆ›å»º checkscope å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œcheckscope æ‰§è¡Œä¸Šä¸‹æ–‡è¢«å‹å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ checkscope æ‰§è¡Œä¸Šä¸‹æ–‡åˆå§‹åŒ–ï¼Œåˆ›å»ºå˜é‡å¯¹è±¡ã€ä½œç”¨åŸŸé“¾ã€thisç­‰ checkscope å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œcheckscope æ‰§è¡Œä¸Šä¸‹æ–‡ä»æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¸­å¼¹å‡º æ‰§è¡Œ f å‡½æ•°ï¼Œåˆ›å»º f å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œf æ‰§è¡Œä¸Šä¸‹æ–‡è¢«å‹å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ f æ‰§è¡Œä¸Šä¸‹æ–‡åˆå§‹åŒ–ï¼Œåˆ›å»ºå˜é‡å¯¹è±¡ã€ä½œç”¨åŸŸé“¾ã€thisç­‰ f å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œf å‡½æ•°ä¸Šä¸‹æ–‡ä»æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¸­å¼¹å‡º äº†è§£åˆ°è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬åº”è¯¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ï¼š å½“ f å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œcheckscope å‡½æ•°ä¸Šä¸‹æ–‡å·²ç»è¢«é”€æ¯äº†å•Š(å³ä»æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¸­è¢«å¼¹å‡º)ï¼Œæ€ä¹ˆè¿˜ä¼šè¯»å–åˆ° checkscope ä½œç”¨åŸŸä¸‹çš„ scope å€¼å‘¢ï¼Ÿ ä»¥ä¸Šçš„ä»£ç ï¼Œè¦æ˜¯è½¬æ¢æˆ PHPï¼Œå°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºåœ¨ PHP ä¸­ï¼Œf å‡½æ•°åªèƒ½è¯»å–åˆ°è‡ªå·±ä½œç”¨åŸŸå’Œå…¨å±€ä½œç”¨åŸŸé‡Œçš„å€¼ï¼Œæ‰€ä»¥è¯»ä¸åˆ° checkscope ä¸‹çš„ scope å€¼ã€‚(è¿™æ®µæˆ‘é—®çš„PHPåŒäº‹â€¦â€¦) ç„¶è€Œ JavaScript å´æ˜¯å¯ä»¥çš„ï¼ å½“æˆ‘ä»¬äº†è§£äº†å…·ä½“çš„æ‰§è¡Œè¿‡ç¨‹åï¼Œæˆ‘ä»¬çŸ¥é“ f æ‰§è¡Œä¸Šä¸‹æ–‡ç»´æŠ¤äº†ä¸€ä¸ªä½œç”¨åŸŸé“¾ï¼š 123fContext = &#123; Scope: [AO, checkscopeContext.AO, globalContext.VO],&#125; å¯¹çš„ï¼Œå°±æ˜¯å› ä¸ºè¿™ä¸ªä½œç”¨åŸŸé“¾ï¼Œf å‡½æ•°ä¾ç„¶å¯ä»¥è¯»å–åˆ° checkscopeContext.AO çš„å€¼ï¼Œè¯´æ˜å½“ f å‡½æ•°å¼•ç”¨äº† checkscopeContext.AO ä¸­çš„å€¼çš„æ—¶å€™ï¼Œå³ä½¿ checkscopeContext è¢«é”€æ¯äº†ï¼Œä½†æ˜¯ JavaScript ä¾ç„¶ä¼šè®© checkscopeContext.AO æ´»åœ¨å†…å­˜ä¸­ï¼Œf å‡½æ•°ä¾ç„¶å¯ä»¥é€šè¿‡ f å‡½æ•°çš„ä½œç”¨åŸŸé“¾æ‰¾åˆ°å®ƒï¼Œæ­£æ˜¯å› ä¸º JavaScript åšåˆ°äº†è¿™ä¸€ç‚¹ï¼Œä»è€Œå®ç°äº†é—­åŒ…è¿™ä¸ªæ¦‚å¿µã€‚ æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬å†çœ‹ä¸€éå®è·µè§’åº¦ä¸Šé—­åŒ…çš„å®šä¹‰ï¼š å³ä½¿åˆ›å»ºå®ƒçš„ä¸Šä¸‹æ–‡å·²ç»é”€æ¯ï¼Œå®ƒä»ç„¶å­˜åœ¨ï¼ˆæ¯”å¦‚ï¼Œå†…éƒ¨å‡½æ•°ä»çˆ¶å‡½æ•°ä¸­è¿”å›ï¼‰ åœ¨ä»£ç ä¸­å¼•ç”¨äº†è‡ªç”±å˜é‡ åœ¨è¿™é‡Œå†è¡¥å……ä¸€ä¸ªã€ŠJavaScriptæƒå¨æŒ‡å—ã€‹è‹±æ–‡åŸç‰ˆå¯¹é—­åŒ…çš„å®šä¹‰: This combination of a function object and a scope (a set of variable bindings) in which the functionâ€™s variables are resolved is called a closure in the computer science literature. é—­åŒ…åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ä¹Ÿåªæ˜¯ä¸€ä¸ªæ™®é€šçš„æ¦‚å¿µï¼Œå¤§å®¶ä¸è¦å»æƒ³å¾—å¤ªå¤æ‚ã€‚ å¿…åˆ·é¢˜æ¥ä¸‹æ¥ï¼Œçœ‹è¿™é“åˆ·é¢˜å¿…åˆ·ï¼Œé¢è¯•å¿…è€ƒçš„é—­åŒ…é¢˜ï¼š 1234567891011var data = [];for (var i = 0; i &lt; 3; i++) &#123; data[i] = function () &#123; console.log(i); &#125;;&#125;data[0]();data[1]();data[2](); ç­”æ¡ˆæ˜¯éƒ½æ˜¯ 3ï¼Œè®©æˆ‘ä»¬åˆ†æä¸€ä¸‹åŸå› ï¼š å½“æ‰§è¡Œåˆ° data[0] å‡½æ•°ä¹‹å‰ï¼Œæ­¤æ—¶å…¨å±€ä¸Šä¸‹æ–‡çš„ VO ä¸ºï¼š 123456globalContext = &#123; VO: &#123; data: [...], i: 3 &#125;&#125; å½“æ‰§è¡Œ data[0] å‡½æ•°çš„æ—¶å€™ï¼Œdata[0] å‡½æ•°çš„ä½œç”¨åŸŸé“¾ä¸ºï¼š 123data[0]Context = &#123; Scope: [AO, globalContext.VO]&#125; data[0]Context çš„ AO å¹¶æ²¡æœ‰ i å€¼ï¼Œæ‰€ä»¥ä¼šä» globalContext.VO ä¸­æŸ¥æ‰¾ï¼Œi ä¸º 3ï¼Œæ‰€ä»¥æ‰“å°çš„ç»“æœå°±æ˜¯ 3ã€‚ data[1] å’Œ data[2] æ˜¯ä¸€æ ·çš„é“ç†ã€‚ æ‰€ä»¥è®©æˆ‘ä»¬æ”¹æˆé—­åŒ…çœ‹çœ‹ï¼š 12345678910111213var data = [];for (var i = 0; i &lt; 3; i++) &#123; data[i] = (function (i) &#123; return function()&#123; console.log(i); &#125; &#125;)(i);&#125;data[0]();data[1]();data[2](); å½“æ‰§è¡Œåˆ° data[0] å‡½æ•°ä¹‹å‰ï¼Œæ­¤æ—¶å…¨å±€ä¸Šä¸‹æ–‡çš„ VO ä¸ºï¼š 123456globalContext = &#123; VO: &#123; data: [...], i: 3 &#125;&#125; è·Ÿæ²¡æ”¹ä¹‹å‰ä¸€æ¨¡ä¸€æ ·ã€‚ å½“æ‰§è¡Œ data[0] å‡½æ•°çš„æ—¶å€™ï¼Œdata[0] å‡½æ•°çš„ä½œç”¨åŸŸé“¾å‘ç”Ÿäº†æ”¹å˜ï¼š 123data[0]Context = &#123; Scope: [AO, åŒ¿åå‡½æ•°Context.AO globalContext.VO]&#125; åŒ¿åå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡çš„AOä¸ºï¼š 123456789åŒ¿åå‡½æ•°Context = &#123; AO: &#123; arguments: &#123; 0: 0, length: 1 &#125;, i: 0 &#125;&#125; data[0]Context çš„ AO å¹¶æ²¡æœ‰ i å€¼ï¼Œæ‰€ä»¥ä¼šæ²¿ç€ä½œç”¨åŸŸé“¾ä»åŒ¿åå‡½æ•° Context.AO ä¸­æŸ¥æ‰¾ï¼Œè¿™æ—¶å€™å°±ä¼šæ‰¾ i ä¸º 0ï¼Œæ‰¾åˆ°äº†å°±ä¸ä¼šå¾€ globalContext.VO ä¸­æŸ¥æ‰¾äº†ï¼Œå³ä½¿ globalContext.VO ä¹Ÿæœ‰ i çš„å€¼(å€¼ä¸º3)ï¼Œæ‰€ä»¥æ‰“å°çš„ç»“æœå°±æ˜¯0ã€‚ data[1] å’Œ data[2] æ˜¯ä¸€æ ·çš„é“ç†ã€‚","tags":["Javascript","é¢è¯•é¢˜","ä½œç”¨åŸŸé“¾","ä½œç”¨åŸŸ","é—­åŒ…"],"categories":["Javascript"]},{"title":"jsçš„æ‰§è¡Œä¸Šä¸‹æ–‡ä»¥åŠæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ","path":"/2021/06/05/jsçš„æ‰§è¡Œä¸Šä¸‹æ–‡ä»¥åŠæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ/","content":"jsçš„æ‰§è¡Œä¸Šä¸‹æ–‡ä»¥åŠæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆå¯æ‰§è¡Œä»£ç jsçš„å¯æ‰§è¡Œä»£ç ï¼ˆexecutable codeï¼‰æœ‰å“ªäº›ï¼Ÿåªæœ‰å¯æ‰§è¡Œä»£ç ä¼šåˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡ å…¨å±€ä»£ç  å‡½æ•°ä»£ç  evalä»£ç  æ‰§è¡Œä¸Šä¸‹æ–‡åªæœ‰å¯æ‰§è¡Œä»£ç ä¼šåˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡ å½“æ‰§è¡Œåˆ°ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™è¿™é‡Œä¼šè¿›è¡Œå‡†å¤‡å·¥ä½œï¼Œ è¿™ä¸ªå‡†å¤‡å·¥ä½œç”¨ä¸“ä¸šç‚¹çš„è¯è®²å°±æ˜¯ æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆexecution contextï¼‰ è¿™é‡Œä¸€å®šæ˜¯ï¼å‡½æ•°æ‰§è¡Œçš„æ—¶å€™æ‰ä¼šå»åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡ï¼ å¯¹äºæ¯ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œéƒ½æœ‰ä¸‰ä¸ªé‡è¦å±æ€§ å˜é‡å¯¹è±¡ï¼ˆVariable objectï¼‰ ä¿—ç§°VO ä½œç”¨åŸŸé“¾ï¼ˆScope chainï¼‰ this è¿™äº›å±æ€§å¯ä»¥å»å¯¹åº”çš„æ–‡ç« ä¸­çœ‹ æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆjsä»¥æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆçš„æ–¹å¼å»åˆ›å»ºä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆï¼Œæ¥è¿›è¡Œå„ä¸ªä¸Šä¸‹æ–‡ä¹‹é—´çš„ç®¡ç† åœ¨æ‰€æœ‰çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œjsçš„ä»£ç ï¼Œé¦–å…ˆé‡åˆ°çš„æ˜¯å…¨å±€ä»£ç è¿™æ˜¯æ¯‹åº¸ç½®ç–‘çš„ è¿™ä¸ªæ—¶å€™ç›¸å½“äºè¿™ä¸ªå…¨å±€çš„æ‰§è¡Œä¸Šä¸‹æ–‡å°±æ˜¯åœ¨æ ˆåº•äº† é¦–å…ˆæˆ‘ä»¬å…ˆæ¨¡æ‹Ÿä¸€ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªæ ˆè¡¨ç¤ºæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ 1ECStack = []; æŒ‰ç…§ä¸Šé¢æ‰€è¯´çš„ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆåº•æ°¸è¿œéƒ½æœ‰ä¸€ä¸ªå…¨å±€çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œè¿™é‡Œç”¨globalContextè¡¨ç¤º 123ECStack=[ globalContext] æŒ‰é¢˜åˆ†æè§£é‡Šæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ123456789101112131415function fn3()&#123; console.log(&#x27;fn3&#x27;)&#125;function fn2()&#123; console.log(&#x27;fn2&#x27;); fn3();&#125;function fn1()&#123; console.log(&#x27;fn1&#x27;); fn2();&#125;fun1(); å½“æ‰§è¡Œä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”å‹å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆï¼Œå½“å‡½æ•°æ‰§è¡Œå®Œæ¯•çš„æ—¶å€™ï¼Œå°±ä¼šå°†å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä»æ ˆä¸­å¼¹å‡ºã€‚ å› æ­¤ä»¥ä¸Šçš„ä»£ç æ‰§è¡ŒåŸç†æ˜¯è¿™æ ·çš„ 1234567891011121314151617181920212223//fn1()ECStack.push(&lt;fn1&gt; function1Context);// è¿™æ—¶å€™å‘ç°fun1ä¸­è°ƒç”¨äº†fn2ECStack.push(&lt;fn2&gt; function2Context);// fn2ä¸­åˆè°ƒç”¨äº†fn3ECStack.puhs(&lt;fn3&gt; function3Context);// æ­¤æ—¶çš„ECStackä¸º// ECStack = [// globalContext// function1Context//\tfunction2Context// function3Context// ]//fn3æ‰§è¡Œå®Œäº†ECStack.pop(); // function3Context// fn2æ‰§è¡Œå®Œäº†ECStack.pop(); // function3Context// fn1æ‰§è¡Œå®Œäº†ECStack.pop(); // function1Context// javascriptæ¥ç€æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œä½†æ˜¯ECStackåº•å±‚æ°¸è¿œæœ‰ä¸ªglobalContext æ ¹æ®ä¸Šä¸‹æ–‡æ ˆä»¥åŠä½œç”¨åŸŸé“¾ä»¥åŠVOæˆ–è€…AOåˆ†æä¾‹å¦‚ 123456789var scope = &quot;global scope&quot;;function checkscope()&#123; var scope = &quot;local scope&quot;; function f()&#123; return scope; &#125; return f();&#125;checkscope(); 123456789var scope = &quot;global scope&quot;;function checkscope()&#123; var scope = &quot;local scope&quot;; function f()&#123; return scope; &#125; return f;&#125;checkscope()(); åˆ†åˆ«è¾“å‡ºä»€ä¹ˆï¼Ÿ å¯¹ï¼Œéƒ½æ˜¯local scope å…·ä½“åˆ†æä¸€ä¸‹ å…ˆåˆ†æç¬¬ä¸€é“ åˆ†æç¬¬ä¸€é“æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ 1.æ— è®ºå¦‚ä½•å…ˆæ‰§è¡Œå…¨å±€ä»£ç ï¼Œåˆ›å»ºå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå…¨å±€ä¸Šä¸‹æ–‡å‹å…¥æ ˆåº• 123ECStack = [ globalContext] 2.åˆå§‹åŒ–å…¨å±€ä¸Šä¸‹æ–‡ 12345globalContext = &#123; VO: [global], Scope: [globalContext.VO], this: globalContext.VO&#125; 3.åœ¨ç¬¬2æ­¥åˆå§‹åŒ–çš„è¿‡ç¨‹å‘ç°å…¨å±€çš„ä½œç”¨åŸŸä¸­å®šä¹‰äº†ä¸€ä¸ª checkscropeå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨åŸŸé“¾ä¸Šå°±ä¼šå…ˆæ¨å…¥ä¸€ä¸ªå…¨å±€ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­çš„Scope 123checkscope.[[scope]]=[ globalContext.VO] 4.æ‰§è¡Œ checkscope å‡½æ•°ï¼Œåˆ›å»º checkscope å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œcheckscope å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡è¢«å‹å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ 1234ECStack = [ globalContext, checkscopeContext,] 5.checkscopeå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡çš„åˆå§‹åŒ– å¤åˆ¶å‡½æ•°çš„[[scope]]å±æ€§åˆ›å»ºä½œç”¨åŸŸé“¾ï¼Œæ”¾åˆ°checkscopeContextçš„[[scope]]ä¸­ ç”¨argumentsåˆ›å»ºæ´»åŠ¨å¯¹è±¡ åˆå§‹åŒ–æ´»åŠ¨å¯¹è±¡ï¼ŒåŠ å…¥å½¢å‚ï¼Œå†…éƒ¨å‡½æ•°å£°æ˜ï¼Œå˜é‡å£°æ˜ å°†æ´»åŠ¨å¯¹è±¡å‹å…¥ checkscope ä½œç”¨åŸŸé“¾é¡¶ç«¯ï¼Œä¹Ÿå°±æ˜¯checkscope.VO å‡½æ•°fè¢«å£°æ˜ï¼Œä¿å­˜checkscopeçš„ä½œç”¨åŸŸé“¾åˆ°fnå‡½æ•°çš„[[scope]]å½“ä¸­ 1234567891011checkscopeContext = &#123; AO:&#123; arguments: &#123; length: 0, &#125;, scope: undefined, f: refrence to function f()&#123;&#125; &#125;, Scope: [checkscopeContext.AO, globalContext.VO], this: undefined&#125; â€‹ 6. æ‰§è¡Œå‡½æ•°fï¼Œåˆ›å»ºfçš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œfå‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡è¢«å‹å…¥æ ˆä¸­ 12345ECStack= [ globalContext,\tcheckscopeContext,\tfnContext] få‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡åˆå§‹åŒ–ï¼Œå’Œç¬¬5æ­¥ä¸€æ · 123456789fnContext = &#123; AO = &#123; arguments:&#123; length: 0 &#125;\t&#125;, Scope: [fnContext.AO, checkscopeContext.AO, globalContext.VO], this: undefined&#125; få‡½æ•°æ‰§è¡Œä¹‹åï¼Œæ²¿ç€ä½œç”¨åŸŸé“¾æŸ¥æ‰¾åˆ°scopeçš„å€¼ï¼Œè¿”å›scopeå€¼ få‡½æ•°æ‰§è¡Œå®Œï¼Œæ ˆä¸­popå‡ºä¸Šä¸‹æ–‡ 1ECStack.pop() 1234ECStack = [ globalContext,\tcheckscopeContext, ] checkscopeå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œcheckscopeæ‰§è¡Œä¸Šä¸‹æ–‡popå‡ºæ ˆ 1234ECStack.pop()ECStack = [ globalContext,]","tags":["Javascript","é¢è¯•é¢˜","ä½œç”¨åŸŸ","æ‰§è¡Œä¸Šä¸‹æ–‡","æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ"],"categories":["Javascript"]},{"title":"jsçš„ä½œç”¨åŸŸé“¾","path":"/2021/06/05/jsçš„ä½œç”¨åŸŸé“¾/","content":"ä½œç”¨åŸŸé“¾å½“æŸ¥æ‰¾å˜é‡çš„æ—¶å€™ï¼Œä¼šå…ˆä»å½“å‰ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ä¼šä»çˆ¶çº§(è¯æ³•å±‚é¢ä¸Šçš„çˆ¶çº§)æ‰§è¡Œä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ä¸­æŸ¥æ‰¾ï¼Œä¸€ç›´æ‰¾åˆ°å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å…¨å±€å¯¹è±¡ã€‚è¿™æ ·ç”±å¤šä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡æ„æˆçš„é“¾è¡¨å°±å«åšä½œç”¨åŸŸé“¾ã€‚ ä¸‹é¢ï¼Œä»¥ä¸€ä¸ªå‡½æ•°çš„åˆ›å»ºå’Œæ¿€æ´»ä¸¤ä¸ªæ—¶æœŸæ¥è®²è§£ä½œç”¨åŸŸé“¾æ˜¯å¦‚ä½•åˆ›å»ºå’Œå˜åŒ–çš„ã€‚ å‡½æ•°åˆ›å»ºå‡½æ•°çš„ä½œç”¨åŸŸåœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™å°±å†³å®šäº†ã€‚ è¿™æ˜¯å› ä¸ºå‡½æ•°æœ‰ä¸€ä¸ªå†…éƒ¨å±æ€§ [[scope]]ï¼Œå½“å‡½æ•°åˆ›å»ºçš„æ—¶å€™ï¼Œå°±ä¼šä¿å­˜æ‰€æœ‰çˆ¶å˜é‡å¯¹è±¡åˆ°å…¶ä¸­ï¼Œä½ å¯ä»¥ç†è§£ [[scope]] å°±æ˜¯æ‰€æœ‰çˆ¶å˜é‡å¯¹è±¡çš„å±‚çº§é“¾ï¼Œä½†æ˜¯æ³¨æ„ï¼š[[scope]] å¹¶ä¸ä»£è¡¨å®Œæ•´çš„ä½œç”¨åŸŸé“¾ï¼ ä¸¾ä¸ªä¾‹å­ï¼š 12345function foo() &#123; function bar() &#123; ... &#125;&#125; å‡½æ•°åˆ›å»ºæ—¶ï¼Œå„è‡ªçš„[[scope]]ä¸ºï¼š 12345678foo.[[scope]] = [ globalContext.VO];bar.[[scope]] = [ fooContext.AO, globalContext.VO]; å‡½æ•°æ¿€æ´»å½“å‡½æ•°æ¿€æ´»æ—¶ï¼Œè¿›å…¥å‡½æ•°ä¸Šä¸‹æ–‡ï¼Œåˆ›å»º VO/AO åï¼Œå°±ä¼šå°†æ´»åŠ¨å¯¹è±¡æ·»åŠ åˆ°ä½œç”¨é“¾çš„å‰ç«¯ã€‚ è¿™æ—¶å€™æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä½œç”¨åŸŸé“¾ï¼Œæˆ‘ä»¬å‘½åä¸º Scopeï¼š 1Scope = [AO].concat([[Scope]]); è‡³æ­¤ï¼Œä½œç”¨åŸŸé“¾åˆ›å»ºå®Œæ¯•ã€‚ æ‹ä¸€æ‹ä»¥ä¸‹é¢çš„ä¾‹å­ä¸ºä¾‹ï¼Œç»“åˆç€ä¹‹å‰è®²çš„å˜é‡å¯¹è±¡å’Œæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ä½œç”¨åŸŸé“¾å’Œå˜é‡å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼š 123456var scope = &quot;global scope&quot;;function checkscope()&#123; var scope2 = &#x27;local scope&#x27;; return scope2;&#125;checkscope(); æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š 1.checkscope å‡½æ•°è¢«åˆ›å»ºï¼Œä¿å­˜ä½œç”¨åŸŸé“¾åˆ° å†…éƒ¨å±æ€§[[scope]] 123checkscope.[[scope]] = [ globalContext.VO]; 2.æ‰§è¡Œ checkscope å‡½æ•°ï¼Œåˆ›å»º checkscope å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œcheckscope å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡è¢«å‹å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ 1234ECStack = [ checkscopeContext, globalContext]; 3.checkscope å‡½æ•°å¹¶ä¸ç«‹åˆ»æ‰§è¡Œï¼Œå¼€å§‹åšå‡†å¤‡å·¥ä½œï¼Œç¬¬ä¸€æ­¥ï¼šå¤åˆ¶å‡½æ•°[[scope]]å±æ€§åˆ›å»ºä½œç”¨åŸŸé“¾ 123checkscopeContext = &#123; Scope: checkscope.[[scope]],&#125; 4.ç¬¬äºŒæ­¥ï¼šç”¨ arguments åˆ›å»ºæ´»åŠ¨å¯¹è±¡ï¼Œéšååˆå§‹åŒ–æ´»åŠ¨å¯¹è±¡ï¼ŒåŠ å…¥å½¢å‚ã€å‡½æ•°å£°æ˜ã€å˜é‡å£°æ˜ 123456789checkscopeContext = &#123; AO: &#123; arguments: &#123; length: 0 &#125;, scope2: undefined &#125;ï¼Œ Scope: checkscope.[[scope]],&#125; 5.ç¬¬ä¸‰æ­¥ï¼šå°†æ´»åŠ¨å¯¹è±¡å‹å…¥ checkscope ä½œç”¨åŸŸé“¾é¡¶ç«¯ 123456789checkscopeContext = &#123; AO: &#123; arguments: &#123; length: 0 &#125;, scope2: undefined &#125;, Scope: [AO, [[Scope]]]&#125; 6.å‡†å¤‡å·¥ä½œåšå®Œï¼Œå¼€å§‹æ‰§è¡Œå‡½æ•°ï¼Œéšç€å‡½æ•°çš„æ‰§è¡Œï¼Œä¿®æ”¹ AO çš„å±æ€§å€¼ 123456789checkscopeContext = &#123; AO: &#123; arguments: &#123; length: 0 &#125;, scope2: &#x27;local scope&#x27; &#125;, Scope: [AO, [[Scope]]]&#125; 7.æŸ¥æ‰¾åˆ° scope2 çš„å€¼ï¼Œè¿”å›åå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå‡½æ•°ä¸Šä¸‹æ–‡ä»æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¸­å¼¹å‡º 123ECStack = [ globalContext];","tags":["Javascript","é¢è¯•é¢˜","ä½œç”¨åŸŸé“¾","ä½œç”¨åŸŸ","æ‰§è¡Œä¸Šä¸‹æ–‡"],"categories":["Javascript"]},{"title":"jsçš„é™æ€ä½œç”¨åŸŸç†è§£","path":"/2021/06/05/jsçš„é™æ€ä½œç”¨åŸŸ/","content":"jsçš„é™æ€ä½œç”¨åŸŸç†è§£æ€»æ‰€å‘¨çŸ¥ï¼Œjsæ˜¯è¯æ³•ä½œç”¨åŸŸï¼ˆé™æ€ä½œç”¨åŸŸï¼‰ï¼Œå‡½æ•°çš„ä½œç”¨åŸŸåœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™å°±å·²ç»å†³å®šäº†ã€‚ï¼ˆè¿™å¥è¯æ˜¯é‡ç‚¹ï¼Œè¦è€ƒï¼‰ ä½œç”¨åŸŸ ä½œç”¨åŸŸæ˜¯æŒ‡ç¨‹åºæºä»£ç ä¸­å®šä¹‰å˜é‡çš„åŒºåŸŸ ä½œç”¨åŸŸè§„å®šäº†å¦‚ä½•æŸ¥æ‰¾å˜é‡ï¼Œä¹Ÿå°±æ˜¯ç¡®å®šå½“å‰æ‰§è¡Œä»£ç å¯¹å˜é‡çš„è®¿é—®æƒé™ã€‚ JavaScript é‡‡ç”¨è¯æ³•ä½œç”¨åŸŸ(lexical scoping)ï¼Œä¹Ÿå°±æ˜¯é™æ€ä½œç”¨åŸŸã€‚ æŒ‰é¢˜åˆ†æå¦‚ä¸‹ 12345678910var value = 0;function sayHi()&#123; console.log(value);&#125;function hi()&#123; const value = 2; sayHi();&#125;hi(); æœ€ç»ˆæ‰“å°å•¥ï¼Ÿ å¯¹ å°±æ˜¯ 2 é”™ï¼ æ˜¯1å“ˆå“ˆå“ˆå“ˆå“ˆ ä¸ºå•¥å§æ§½ æ‰§è¡Œè¿‡ç¨‹ é¦–å…ˆå¯ä»¥çœ‹åˆ°å…¨å±€å®šä¹‰äº†valueï¼Œ å£°æ˜äº†å‡½æ•°hiå’ŒsayHi è¿™æ—¶å€™æ˜¯æœ€å¤–å±‚å£°æ˜çš„å‡½æ•°ï¼Œé‚£ä¹ˆsayHiå’Œhiçš„å‡½æ•°ä½œç”¨åŸŸåœ¨æ­¤æ—¶å·²ç»å†³å®šäº†ï¼ï¼ˆä½œç”¨åŸŸæ˜¯ä¸€å±‚å±‚çš„åµŒå¥—çš„ï¼Œå…·ä½“è¿™é‡Œå†…éƒ¨å¤„ç†æ–¹å¼çœ‹ jsçš„ä½œç”¨åŸŸé“¾é‚£ç‰‡æ–‡ç«  è¿™æ—¶å€™æ‰§è¡Œhiå‡½æ•° å®šä¹‰äº†ä¸€ä¸ªvalueï¼Œç„¶åä»€ä¹ˆéƒ½ä¸åšå»æ‰§è¡ŒsayHi è¿™æ—¶å€™æ‰§è¡ŒsayHiå‡½æ•°ï¼Œè¦è¾“å‡ºvalueï¼Œè¿™æ—¶å€™ä¼šå»æŸ¥æ‰¾ä»–çš„å±€éƒ¨æ˜¯å¦æœ‰è¿™ä¸ªå˜é‡ï¼Œå‘ç°æ²¡æœ‰ è¿™ä¸ªæ—¶å€™å¾€ä¸Šæ‰¾ï¼Œè¿™ä¸ªä¸Šï¼Œå¾ˆé‡è¦ï¼Œå°±æ˜¯sayHiå‡½æ•°åœ¨å®šä¹‰çš„æ—¶å€™çš„é‚£ä¸ªåŒºåŸŸï¼Œè¿™é‡ŒæŒ‡çš„å°±æ˜¯å…¨å±€ å…¨å±€æ‰¾åˆ°äº†valueï¼Œè¾“å‡ºvalue å¦‚æœè¯´æ˜¯åŠ¨æ€ä½œç”¨åŸŸçš„è¯ï¼Œé‚£è¿™é‡Œæ‰§è¡ŒsayHiå°±å¾—çœ‹è°ƒç”¨å®ƒæ˜¯åœ¨å“ªä¸ªåŸŸä¸­è°ƒç”¨äº†","tags":["Javascript","é¢è¯•é¢˜","ä½œç”¨åŸŸé“¾","ä½œç”¨åŸŸ","æ‰§è¡Œä¸Šä¸‹æ–‡"],"categories":["Javascript"]},{"title":"æ‰‹å†™bind","path":"/2021/06/03/æ‰‹å†™bind/","content":"æ‰‹å†™bindåŸç† bind() æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ã€‚å½“è¿™ä¸ªæ–°å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œbind() çš„ç¬¬ä¸€ä¸ªå‚æ•°å°†ä½œä¸ºå®ƒè¿è¡Œæ—¶çš„ thisï¼Œä¹‹åçš„ä¸€åºåˆ—å‚æ•°å°†ä¼šåœ¨ä¼ é€’çš„å®å‚å‰ä¼ å…¥ä½œä¸ºå®ƒçš„å‚æ•°ã€‚(æ¥è‡ªäº MDN ) ç”±æ­¤æˆ‘ä»¬å¯ä»¥é¦–å…ˆå¾—å‡º bind å‡½æ•°çš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š è¿”å›ä¸€ä¸ªå‡½æ•° å¯ä»¥ä¼ å…¥å‚æ•° å®ç°é¦–å…ˆå…ˆåœ¨Functionçš„åŸå‹ä¸ŠæŒ‚è½½ä¸€ä¸ªè‡ªå®šä¹‰bindå‡½æ•° 1Function.prototype._bind = function()&#123;&#125; 1. æ¨¡æ‹Ÿå®ç°è¿”å›ä¸€ä¸ªå‡½æ•°æ­£å¸¸çš„ä½¿ç”¨bindçš„æ—¶å€™æ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿™é‡Œè¿”å›çš„å‡½æ•°çš„å¼•ç”¨(this)ä¾æ—§æŒ‡å‘çš„æ˜¯è°ƒç”¨bindçš„å‡½æ•°ï¼Œè€Œä¸æ˜¯æ–°å¾—è¿”å›å‡½æ•°, è€Œä¸” è€ƒè™‘åˆ°ç»‘å®šå‡½æ•°å¯èƒ½æ˜¯æœ‰è¿”å›å€¼ ï¼Œæ‰€ä»¥è¿™å—è¿˜æ˜¯è¦å¤„ç†ä¸‹ 12345678910const obj =&#123; name: &#x27;weng&#x27;,&#125;;function sayName()&#123; return this.name;&#125;const a = sayName._bind(obj);console.log(a()); //weng æ‰€ä»¥è¿™å—çš„thisæŒ‡å‘éœ€è¦åšå¤„ç†ã€‚ 123456Function.prototype._bind = function(context)&#123; const that = this; return function()&#123; return that.call(context); &#125;&#125; è¿™é‡Œç”¨thatå­˜å‚¨thisï¼Œä¹‹åè¿”å›ä¸€ä¸ªé—­åŒ…å‡½æ•° 2. ä¼ å‚æ•°åœ¨æ‰§è¡Œbindçš„æ—¶å€™ï¼Œbindå¯ä»¥ä¼ å‚æ•°ï¼Œè€Œä¸”bindè¿”å›ä¹‹åçš„å‡½æ•°ä¹Ÿå¯ä»¥ä¼ å‚æ•° 1234567891011const obj =&#123; name: &#x27;weng&#x27;,&#125;;function sayName(age, address)&#123; return `$&#123;this.name&#125;: $&#123;age&#125; : $&#123;address&#125;`;&#125;const a = sayName.bind(obj, 23);console.log(a(&#x27;fujian&#x27;)); // weng : 23 : fujian è¿™é‡Œå°±ç›¸å½“äºå†…éƒ¨å®ç°ä¸€ä¸ªå‡½æ•°æŸ¯é‡ŒåŒ–ç”¨æ¥å­˜å‚¨æ¯æ¬¡ä¼ è¿›æ¥çš„æ•°æ®ï¼Œä½†æ˜¯æ²¡æœ‰æŸ¯é‡ŒåŒ–é‚£ä¹ˆç‰›é€¼ï¼Œå…·ä½“å¯ä»¥çœ‹å®ç°å‡½æ•°æŸ¯é‡ŒåŒ–é‚£é‚£ç¯‡æ–‡ç«  å…·ä½“å®ç°å¦‚ä¸‹ 12345678Function.prototype._bind = function(context)&#123; const that = this; const outerArgs = Array.prototype.slice.call(arguments, 1); // å­˜ä¸‹ç¬¬ä¸€æ¬¡ä¼ çš„å‚æ•°ï¼Œ æˆªæ‰ç¬¬ä¸€ä¸ª return function()&#123; const innerArgs = Array.prototype.slice.call(arguments); return that.call(context, ...outerArgs.concat(innerArgs)); // æŠŠå¤–å±‚å‚æ•°æ‹¼æ¥åˆ°å†…å±‚çš„å‚æ•°ç±»æ•°ç»„é‡Œå¤´ &#125;&#125; 3. æ„é€ å‡½æ•°çš„æ¨¡æ‹Ÿå®ç° ä¸€ä¸ªç»‘å®šå‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡ï¼šè¿™ç§è¡Œä¸ºå°±åƒæŠŠåŸå‡½æ•°å½“æˆæ„é€ å™¨ã€‚æä¾›çš„ this å€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•°ã€‚ ä¹Ÿå°±æ˜¯è¯´å½“ bind è¿”å›çš„å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œbind æ—¶æŒ‡å®šçš„ this å€¼ä¼šå¤±æ•ˆï¼Œä½†ä¼ å…¥çš„å‚æ•°ä¾ç„¶ç”Ÿæ•ˆã€‚ä¸¾ä¸ªä¾‹å­ï¼š 123456789101112131415161718const obj = &#123; preName: &quot;weng&quot;,&#125;;function Bar(name, age) &#123; this.name = name; this.age = age;&#125;Bar.prototype.sayName = function()&#123; console.log(this.name)&#125;const MyBar = Bar.bind(obj, &quot;kaimin&quot;);const o = new MyBar(12);console.log(o); ç»“æœå¦‚ä¸‹ å¯ä»¥å¾—çŸ¥æ­¤æ—¶Barå‡½æ•°çš„thisæŒ‡å‘çš„æ˜¯oå¯¹è±¡ï¼Œå°±æ˜¯ç›¸å½“äºä»¥newçš„å½¢å¼è°ƒç”¨äº†æ„é€ å‡½æ•°ï¼Œè¿™å—çš„åŸç†å¯ä»¥å» æ‰‹å†™newé‚£ç¯‡æ–‡ç« çœ‹çœ‹ 1234567891011121314Function.prototype._bind = function (context) &#123; const that = this; const outerArgs = Array.prototype.slice.call(arguments, 1); const returnFn = function () &#123; const innerArgs = Array.prototype.slice.call(arguments); return that.call( this instanceof returnFn ? this : context, ...outerArgs.concat(innerArgs) ); &#125;; returnFn.prototype = this.prototype; return returnFn;&#125;; ä»¥é€™è¡Œä»£ç¢¼æ¥è¯´ 1234return that.call( this instanceof returnFn ? this : context, ...outerArgs.concat(innerArgs)); å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œæ­¤æ—¶this instanceof returnFnç»“æœä¸º trueï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘è¯¥å®ä¾‹ï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼ä»¥ä¸Šé¢çš„æ˜¯ demo ä¸ºä¾‹ï¼Œå¦‚æœæ”¹æˆ this instanceof returnFn? null : contextï¼Œå®ä¾‹åªæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå°† null æ”¹æˆ thiså½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ context 4. æ„é€ å‡½æ•°æ•ˆæœçš„ä¼˜åŒ–å®ç° ä½†æ˜¯åœ¨è¿™ä¸ªå†™æ³•ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥å°† fBound.prototype = this.prototypeï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹ fBound.prototype çš„æ—¶å€™ï¼Œä¹Ÿä¼šç›´æ¥ä¿®æ”¹ç»‘å®šå‡½æ•°çš„ prototypeã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç©ºå‡½æ•°æ¥è¿›è¡Œä¸­è½¬ï¼š 1234567891011121314151617Function.prototype._bind = function (context) &#123; const that = this; const outerArgs = Array.prototype.slice.call(arguments, 1); const _Transit = function()&#123;&#125;; const returnFn = function () &#123; const innerArgs = Array.prototype.slice.call(arguments); return that.call( this instanceof returnFn ? this : context, ...outerArgs.concat(innerArgs) ); &#125;; _Transit.prototype = this.prototype; returnFn.prototype = new _Transit(); return returnFn;&#125;; è¿™é‡Œç›¸å½“åšäº†ä¸ªç§æœ‰å˜é‡ï¼ˆåŒ¿åæ„é€ å‡½æ•°ç±»ä¼¼çš„ï¼‰ï¼Œå¤–éƒ¨æ˜¯ä¸èƒ½è®¿é—®åˆ°çš„ï¼Œæ‰€ä»¥å¦‚æœåç»­åšreturnFnçš„åŸå‹ä¿®æ”¹ï¼Œä¹Ÿåªæ˜¯æ”¹åœ¨äº†è¿™ä¸ªç§æœ‰æ„é€ å‡½æ•°newå‡ºæ¥çš„å®ä¾‹ä¸Šçš„ï¼Œè¿™ä¸ªå®ä¾‹çš„[[Prototype]]æŒ‡å‘çš„æ˜¯çœŸæ­£çš„thisåŸå‹ã€‚ 5. æœ€ååšä¸€ä¸ªæ—¥å¸¸åˆ¤å®šthisæ˜¯å¦ä¸ºå‡½æ•°123if (typeof this !== &quot;function&quot;) &#123; throw new Error(&quot;Function.prototype.bind - what is trying to be bound is not callable&quot;);&#125; 6.æœ€ç»ˆä»£ç 123456789101112131415161718192021Function.prototype._bind = function (context) &#123; if(typeof this !== &#x27;function&#x27;)&#123; // MDNä¸Šçš„ throw new Error(&#x27;Function.prototype.bind - what is trying to be bound is not callable&quot;&#x27;) &#125; const that = this; const outerArgs = Array.prototype.slice.call(arguments, 1); const _Transit = function()&#123;&#125;; const returnFn = function () &#123; const innerArgs = Array.prototype.slice.call(arguments); return that.call( this instanceof returnFn ? this : context, ...outerArgs.concat(innerArgs) ); &#125;; _Transit.prototype = this.prototype; returnFn.prototype = new _Transit(); return returnFn;&#125;; æµ‹è¯•1234567891011121314let o = &#123; address: &#x27;fujian&#x27;&#125;function Person(name, age)&#123; this.name = name; this.age = age;&#125;const NewPerson = Person._bind(o, &#x27;weng&#x27;);const per1 = new NewPerson(23);console.log(per1); æœ€ç»ˆæ‰“å°çš„æ˜¯è¿™æ ·çš„ æ­£å¸¸æ‰“å°å‡ºæ¥æ˜¯è¿™æ ·çš„ï¼Œå·®äº†ä¸€ä¸ªæ ‡è¯†çš„é—®é¢˜ï¼Œ è¿™ä¸ªæ— æ‰€è°“äº† 1234567891011let o = &#123; address: &#x27;fujian&#x27;&#125;function sayHi(name, age)&#123; console.log(this.name = name, this.age = age, this.address);&#125;const hi = sayHi.bind(o, &#x27;weng&#x27;);hi(23); // weng 23 fujian","tags":["Javascript","é¢è¯•é¢˜","åŸå‹é“¾","bind","åŸå‹"],"categories":["Javascript"]},{"title":"æ‰‹å†™instanceof","path":"/2021/06/02/æ‰‹å†™instanceof/","content":"æ‰‹å†™instanceof instanceof è¿ç®—ç¬¦ç”¨äºæ£€æµ‹æ„é€ å‡½æ•°çš„ prototype å±æ€§æ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚ åŸç†instanceof è¿ç®—ç¬¦ç”¨æ¥æ£€æµ‹ constructor.prototypeæ˜¯å¦å­˜åœ¨äºå‚æ•° object çš„åŸå‹é“¾ä¸Šã€‚ å°±æ˜¯æ‰¾å¯¹è±¡åŸå‹é“¾ä¸Šæ˜¯å¦æœ‰æŸä¸ªæ„é€ å‡½æ•°çš„åŸå‹ å®ç°12345678910111213function _instanceof(obj, fn)&#123; let proto = obj.__proto__; let prototype = fn.prototype; while(true)&#123; if(prototype === null)&#123; return false; &#125; if(proto === prototype)&#123; return true; &#125; proto = prototype.__proto__; &#125;&#125; é¦–å…ˆå°†å®ä¾‹çš„[[Prototype]]æŒ‡é’ˆèµ‹å€¼ç»™protoå¯¹è±¡ï¼Œè¿™é‡ŒæŒ‡å‘çš„æ˜¯æ­¤å¯¹è±¡æ„é€ å‡½æ•°çš„åŸå‹ ä¹‹åå°†æ„é€ å‡½æ•°çš„åŸå‹èµ‹å€¼ç»™prototypeï¼Œè¿™é‡Œè¦æ’é™¤åŸå‹æŒ‡å‘nullçš„æƒ…å†µï¼› ä¹‹åä¸æ–­çš„å¾ªç¯ï¼Œå°†åŸå‹çš„åŸå‹ä»˜ç»™prototypeï¼Œä¸€å±‚å±‚å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°ç­‰äºprotoæˆ–è€…ä¸ºnullçš„æƒ…å†µä¸‹é€€å‡ºå¾ªç¯ å› ä¸ºObject.prototype.__proto__æ˜¯æŒ‡å‘nullçš„ï¼Œæ‰€ä»¥åˆ°è¿™é‡Œè¿˜æ‰¾ä¸åˆ°ï¼Œé‚£å°±è¯´æ˜ç›®æ ‡æ„é€ å‡½æ•°ä¸åœ¨åŸå‹é“¾ä¸Šé¢ æµ‹è¯•12345678910function BasePerson()&#123;&#125;function Person()&#123;&#125;Person.prototype = new BasePerson(); // è¿™é‡Œä½¿ç”¨ç»§æ‰¿const a = new Person();console.log(_instanceof(a, Person)) // trueconsole.log(_instanceof(a, BasePerson)) // true","tags":["Javascript","é¢è¯•é¢˜","åŸå‹é“¾","åŸå‹","instanceof"],"categories":["Javascript"]},{"title":"æ‰‹å†™call, apply","path":"/2021/06/02/æ‰‹å†™call-apply/","content":"æ‰‹å†™callï¼Œapplyè¿™åº”è¯¥æ˜¯é¢è¯•æœ€å‚»é€¼çš„é¢˜ç›®äº†ï¼Œ è¿™ç±» native code ï¼Œç”¨jsæ€ä¹ˆèƒ½å®ç°çš„å®Œç¾å‘¢ï¼Ÿï¼Ÿï¼Ÿ é¦–å…ˆå…ˆç†è§£ä¸€ä¸‹call, applyå…·ä½“åšäº†äº›å•¥äº‹æƒ… åŸç†1. è°ƒç”¨å½¢å¼é¦–å…ˆè°ƒç”¨callæˆ–è€…applyçš„éƒ½æ˜¯å‡½æ•° 123456789101112function Person(address)&#123; this.name = &#x27;weng&#x27;; this.address = address;&#125;const obj = &#123; age: 23,&#125;Person.call(obj, &#x27;fujian&#x27;); // è¿™é‡Œnewconsole.log(obj); 2. ä¼ å…¥çš„å‚æ•° callå’Œapply çš„åŒºåˆ«åœ¨äºä¼ å‚çš„å†™æ³•ä¸åŒï¼š call æ˜¯ä¸€ä¸ªä¸€ä¸ªå‚æ•°ä¼ ï¼Œè€Œapplyæ˜¯ä»¥æ•°ç»„çš„å½¢å¼ä¼ å…¥ 123const args = [1,2,3,4];Fn.call(obj, ...args);Fn.apply(obj, args); å®ç°é¦–å…ˆå…ˆå†™ä¸€ä¸ª_callçš„æ–¹æ³• é‚£è¿™ä¸ª_callè¦æŒ‚åœ¨å“ªé‡Œå‘¢ï¼Ÿå¯¹ï¼Œå°±æ˜¯Fnå‡½æ•°çš„åŸå‹ä¸Šï¼Œé‚£è¦æ€ä¹ˆæŒ‚å‘¢ï¼Ÿç›´æ¥åŸå‹æŒ‚ 12Function.prototype._call = function(target, ...args)&#123;&#125; targetæŒ‡å‘å¯¹è±¡ï¼Œargså°±æ˜¯å…¶ä»–å‚æ•° 1. åˆ¤æ–­æ˜¯å¦æ˜¯å‡½æ•°(this)æ¥è°ƒç”¨_call12345Function.prototype._call = function(target, ...args)&#123; if(typeof this !== &#x27;function&#x27;)&#123; throw new Error(&#x27;must be a function&#x27;) &#125;&#125; 2. åˆ¤æ–­ä¼ è¿›æ¥çš„targetæ˜¯å¦ä¸ºåŸºæœ¬æ•°æ®ç±»å‹å¦‚æœtargetæ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ˜¯æ— æ³•å°†å‡½æ•°é™„åŠ åˆ°targetä¸Šé¢çš„ï¼Œé€šè¿‡instanceofå¯ä»¥é¡ºç€åŸå‹é“¾æ‰¾åˆ°Objectçš„æ„é€ å‡½æ•°çš„æ•°æ®ç±»å‹æ‰å¯ä»¥è¢«é™„åŠ å‡½æ•°ã€‚å¦è€…å°±ç›´æ¥æŠŠè¿™ä¸ªæ•°æ®è¿”å›ï¼Œå› ä¸ºæˆ‘çœ‹callå°±æ˜¯è¿™æ ·åšçš„ 12345678Function.prototype._call = function(target, ...args)&#123; if(typeof this !== &#x27;function&#x27;)&#123; throw new Error(&#x27;must be a function&#x27;) &#125; if(!target instanceof Object)&#123; return target &#125;&#125; 3. å¯¹è±¡æ˜¯å¦æ˜¯è¢«å†»ç»“æˆ–è€…å°é—­çš„çŠ¶æ€è¿™é‡Œçš„å¯¹è±¡å¦‚æœè¢«å†»ç»“æˆ–è€…å¤„äºå°é—­çš„çŠ¶æ€é‚£ä¹ˆï¼Œåç»­è°ƒç”¨å‡½æ•°ç»™å¯¹è±¡åšèµ‹å€¼æ“ä½œä¹Ÿä¼šå¤±æ•ˆï¼Œæ‰€ä»¥è¿™é‡Œè¿˜éœ€è¦åˆ¤æ–­ä¸€å±‚ï¼Œå…·ä½“çš„å¯¹è±¡å†»ç»“å’Œå¯¹è±¡å°é—­å¯ä»¥çœ‹çœ‹è¿™Object.freeze() å’Œ Object.seal() 1234567891011Function.prototype._call = function(target, ...args)&#123; if(typeof this !== &#x27;function&#x27;)&#123; throw new Error(&#x27;must be a function&#x27;) &#125; if(!target instanceof Object)&#123; return target &#125; if(Object.isFrozen(target) || Object.isSeal(target))&#123; return target &#125;&#125; 3. targetå¿…é¡»æ˜¯ç›®æ ‡å¯¹è±¡ï¼Œå¦‚æœä¸ä¼ å€¼ï¼Œé»˜è®¤ä¸ºwindow123456789101112Function.prototype._call = function(target, ...args)&#123; if(typeof this !== &#x27;function&#x27;)&#123; throw new Error(&#x27;must be a function&#x27;) &#125; if(!(target instanceof Object)&#123; return target &#125; if(Object.isFrozen(target) || Object.isSeal(target))&#123; return target &#125; target = target || window;&#125; 4. éšå¼ç»‘å®šï¼Œæ”¹å˜æ„é€ å‡½æ•°çš„è°ƒç”¨è€…é—´æ¥æ”¹å˜ this æŒ‡å‘123456789101112131415Function.prototype._call = function(target, ...args)&#123; if(typeof this !== &#x27;function&#x27;)&#123; throw new Error(&#x27;must be a function&#x27;) &#125; if(!(target instanceof Object)&#123; return target &#125; if(Object.isFrozen(target) || Object.isSeal(target))&#123; return target &#125; target = target || window; target.fn = this; // éšå¼ç»‘å®šï¼Œæ”¹å˜æ„é€ å‡½æ•°çš„è°ƒç”¨è€…é—´æ¥æ”¹å˜ this æŒ‡å‘ let result = target.fn(...args) return result;&#125; è¿™é‡Œæˆ‘çœ‹å¾ˆå¤šäººç”¨äº† target.fnå»å°†thisæŒ‡å‘è¿™ä¸ªå‚æ•°ï¼Œä½†æ˜¯ä¸‡ä¸€è¿™ä¸ªfnæœ¬èº«å°±åœ¨targetå½“ä¸­å£°æ˜äº†å‘¢ï¼Ÿ è¿™é‡Œæˆ‘çš„æƒ³æ³•æ˜¯ä»¥ä¸€ä¸ªç¬¦å·ä½œä¸ºé”®ï¼Œä¿å­˜è¿™ä¸ªé”®åï¼Œä¹‹åè°ƒç”¨å’Œèµ‹å€¼å°±ä¸æ€•å‡ºé—®é¢˜äº†ï¼Œå› ä¸ºå£°æ˜æ–°å¾—ç¬¦å·çš„å¼•ç”¨åªæ˜¯æš‚æ—¶çš„ï¼Œä¹Ÿä¸å¯èƒ½å­˜åœ¨é‡å¤çš„æƒ…å†µï¼Œä¹‹ååˆ é™¤ä¹Ÿæ–¹ä¾¿ æ”¹å–„ä¹‹åçš„ä»£ç ä¸ºï¼š 1234567891011121314151617Function.prototype._call = function(target, ...args)&#123; if(typeof this !== &#x27;function&#x27;)&#123; throw new Error(&#x27;must be a function&#x27;) &#125; if(!(target instanceof Object)&#123; return target &#125; if(Object.isFrozen(target) || Object.isSealed(target))&#123; return target &#125; target = target || window; const fn = Symbol(&#x27;fn&#x27;); target[fn] = this; // éšå¼ç»‘å®šï¼Œæ”¹å˜æ„é€ å‡½æ•°çš„è°ƒç”¨è€…é—´æ¥æ”¹å˜ this æŒ‡å‘ let result = target[fn](...args); delete target[fn]; // è¿™é‡Œè¦æŠŠè¿™ç©æ„åˆ äº† return result;&#125; æµ‹è¯•æ­£å¸¸ä¼ 1234567891011121314151617181920212223242526272829303132333435function Person(address) &#123; this.name = &quot;weng&quot;; this.address = address;&#125;let obj = &#123; name: &quot;weng&quot;,&#125;;let arr = [1, 2, 3, 4];let set = new Set([1, 2, 3, 4]);let map = new Map([ [&quot;key1&quot;, 1], [&quot;key2&quot;, 2],]);let stringObj = new String(&quot;2121&quot;);let numberObj = new Number(1212);let booleanObj = new Boolean(false);Person._call(obj, &quot;fujian&quot;);Person._call(arr, &quot;fujian&quot;);Person._call(set, &quot;fujian&quot;);Person._call(map, &quot;fujian&quot;);Person._call(stringObj, &quot;fujian&quot;);Person._call(numberObj, &quot;fujian&quot;);Person._call(booleanObj, &quot;fujian&quot;);console.log(obj);console.log(arr);console.log(set);console.log(map);console.log(stringObj);console.log(numberObj);console.log(booleanObj); æ‰“å°å‡ºæ¥çš„æ˜¯é…±ç´«çš„ ä¼ åŸºæœ¬æ•°æ®ç±»å‹æ•°æ®12345678910111213141516const symb = Symbol(&quot;dsadas&quot;);const num = 1212;const str = &quot;1212&quot;;const isNull = null;const isUndefined = undefined;const isBoolean = false;Person._call(symb, &quot;fujian&quot;);Person._call(num, &quot;fujian&quot;);Person._call(str, &quot;fujian&quot;);Person._call(isNull, &quot;fujian&quot;);Person._call(isUndefined, &quot;fujian&quot;);Person._call(isBoolean, &quot;fujian&quot;);console.log(symb, num, str, isNull, isUndefined, isBoolean); æœ€ç»ˆæ‰“å°å‡ºæ¥çš„æ˜¯é…±ç´«çš„ ä¼ ä¸€ä¸ªå†»ç»“æˆ–è€…å°é—­çš„å¯¹è±¡123456789101112const obj = Object.freeze(&#123; key: 1,&#125;);const obj2 = Object.seal(&#123; key: 2,&#125;);Person._call(obj, &quot;fujian&quot;);Person._call(obj2, &quot;fujian&quot;);console.log(obj);console.log(obj2); æ‰“å°ç»“æœæ˜¯è¿™æ ·ï¼š ç›´æ¥è°ƒç”¨1Person.call(); é‚£è¿™æ—¶å€™ä½œç”¨å¯¹è±¡åœ¨æµè§ˆå™¨é‡Œå¤´å°±æ˜¯windowäº†ï¼Œæ„é€ å‡½æ•°é‡Œå¤´çš„èµ‹å€¼æ“ä½œå¯ä»¥åœ¨windowå¯¹è±¡é‡Œå¤´ä½“ç°ã€‚ æœ€ç»ˆä»£ç ä¼˜åŒ–äº†ä¸€å“ˆå­ 123456789101112131415161718Function.prototype._call = function (target, ...args) &#123; if (typeof this !== &quot;function&quot;) &#123; throw new Error(&quot;must be a function&quot;); &#125; if ( !(target instanceof Object) || Object.isFrozen(target) || Object.isSealed(target) ) &#123; return target; &#125; target = target || window; const fn = Symbol(&quot;fn&quot;); target[fn] = this; // éšå¼ç»‘å®šï¼Œæ”¹å˜æ„é€ å‡½æ•°çš„è°ƒç”¨è€…é—´æ¥æ”¹å˜ this æŒ‡å‘ let result = target[fn](...args); delete target[fn]; return result;&#125;; ä¸æ™“å¾—å¯¹ä¸å¯¹åæ­£è‡ªå·±æ„Ÿè§‰ ä¸€èˆ¬","tags":["Javascript","é¢è¯•é¢˜","call","apply"],"categories":["Javascript"]},{"title":"æ‰‹å†™new","path":"/2021/06/01/æ‰‹å†™new/","content":"æ‰‹å†™newæ“ä½œç¬¦è¦æ‰‹å†™newçš„æ“ä½œå®ç° å¿…é¡»å…ˆäº†è§£newçš„è¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆ åˆ›å»ºä¸€ä¸ªæ–°å¾—å¯¹è±¡ï¼ˆobjï¼‰ å°†æ–°å¯¹è±¡çš„__proto__æŒ‡å‘æ„é€ å‡½æ•°çš„prototype å°†æ„é€ å‡½æ•°çš„thisæ‰§è¡Œè¿™ä¸ªæ–°å¯¹è±¡ï¼ˆobjï¼‰ æ‰§è¡Œæ„é€ å‡½æ•°ä¸­çš„ä»£ç (ä¸ºè¿™ä¸ªæ–°å¯¹è±¡æ·»åŠ å±æ€§å’Œæ–¹æ³•); è¿”å›è¿™ä¸ªæ–°å¯¹è±¡;ï¼ˆè¿™é‡Œæ„é€ å‡½æ•°å¯èƒ½ä¼šæ˜¾å¼è¿”å›å€¼ï¼Œå¾—åšå¤„ç†ï¼Œå¯ä»¥çœ‹çœ‹ æ„é€ å‡½æ•°è¿”å›å€¼ é‚£ç¯‡æ–‡ç« ï¼‰ æ€»ç»“å°±æ˜¯éœ€è¦å®ç°ä»¥ä¸‹çš„åŠŸèƒ½ï¼š è®©å®ä¾‹å¯ä»¥è®¿é—®åˆ°ç§æœ‰çš„å±æ€§ å®ä¾‹å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°åŸå‹æ‰€åœ¨é“¾ä¸Šçš„å±æ€§ï¼ˆä¹Ÿå°±æ˜¯åŸå‹é“¾ï¼‰ é’ˆå¯¹æ„é€ å‡½æ•°æ˜¾å¼è¿”å›çš„å€¼åšå¤„ç† æ­¥éª¤é¦–å…ˆå…ˆå†™å‡ºä¸€ä¸ªå«åš _newçš„å‡½æ•°ï¼Œç±»ä¼¼æ„é€ å‡½æ•°çš„ä¼ å‚å½¢å¼ structFn: å‡½æ•° args: ç»™æ„é€ å‡½æ•°ä¼ çš„å‚æ•° 12function _new(structFn, ...args)&#123;&#125; 1. ç¬¬ä¸€ä¸ªå‚æ•°ç±»å‹åˆ¤æ–­structFn æŒ‡çš„å°±æ˜¯æ„é€ å‡½æ•°ï¼Œé¦–å…ˆæ˜ç™½ä¸€ç‚¹ï¼Œnewæ“ä½œç¬¦åå¤´åªèƒ½å¤Ÿè·Ÿéšå‡½æ•°ï¼Œè¦å…ˆåšç±»å‹åˆ¤æ–­(ES6ä¸­çš„classä¹Ÿæ˜¯ä¸€æ ·çš„) 12345function _new(structFn, ...args) &#123; if (typeof structFn !== &quot;function&quot;) &#123; throw &#x27;structFn must be a function&#x27; &#125;&#125; 2. åˆ›å»ºæ–°å¯¹è±¡ï¼Œå¹¶ä¸”å…‹éš†æ„é€ å‡½æ•°çš„åŸå‹ï¼Œå°†åŸå‹èµ‹å€¼ç»™æ–°å¯¹è±¡çš„[[Prototype]]æŒ‡é’ˆ1234567function _new(structFn, ...args) &#123; if (typeof structFn !== &quot;function&quot;) &#123; throw &#x27;structFn must be a function&#x27; &#125; let obj = new Object; obj.__proto__ = Object.create(structFn.prototype);&#125; 3. æ‰§è¡Œæ„é€ å‡½æ•°ä¸­çš„åˆå§‹åŒ–é€»è¾‘ï¼Œå¹¶ä¸”å°†thisæŒ‡å‘æ–°å¯¹è±¡è¿™é‡Œå£°æ˜reså˜é‡ï¼Œå°†æ„é€ å‡½æ•°çš„thisæŒ‡å‘äº†æ–°å¯¹è±¡ï¼Œå¹¶ä¸”å°†argså‰©ä½™å‚æ•°ä¼ å…¥æ„é€ å‡½æ•°ï¼Œä¿å­˜æ‰§è¡Œæ„é€ å‡½æ•°ä¹‹åè¿”å›å€¼å­˜åœ¨res 12345678function _new(structFn, ...args) &#123; if (typeof structFn !== &quot;function&quot;) &#123; throw &quot;structFn must be a function&quot;; &#125; let obj = new Object(); obj.__proto__ = Object.create(structFn.prototype); let res = fn.call(obj, ...args);&#125; 4. å¯¹æ„é€ å‡½æ•°æ‰§è¡Œä¹‹åçš„è¿”å›å€¼åšå¤„ç†å› ä¸ºæ ¹æ®æ„é€ å‡½æ•°çš„è¿”å›å€¼æƒ…å†µæ¥çœ‹ï¼Œæ¯”è¾ƒå€¼å¾—æ³¨é‡çš„å°±æ˜¯è¿”å›ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„æ—¶å€™ï¼Œå’Œè¿”å›null ä»¥åŠåŸºæœ¬æ•°æ®ç±»å‹çš„æ—¶å€™åŒºåˆ«ï¼Œå¼•ç”¨ç±»å‹ï¼ˆæ¯”å¦‚new String() new Object() {} new Number() è¿™äº›çš„ï¼‰å°±ç›´æ¥è¿”å›äº†ï¼Œnullä»¥åŠåŸºæœ¬æ•°æ®ç±»å‹å°±é»˜è®¤è¿”å›this 1234567891011function _new(structFn, ...args) &#123; if (typeof structFn !== &quot;function&quot;) &#123; throw &quot;structFn must be a function&quot;; &#125; let obj = new Object(); obj.__proto__ = Object.create(structFn.prototype); let res = fn.call(obj, ...args); const isObject = typeof res === &quot;object&quot; &amp;&amp; res !== null; const isFunction = typeof res === &quot;function&quot;; return isFunction || isObject ? res : obj;&#125; è¿™é‡Œé€šè¿‡isObjectå’ŒisFunctionæ¥ç¡®å®šè¿”å›å€¼çš„ç±»å‹ æµ‹è¯•é¦–å…ˆæ£€æµ‹ä¸€ä¸‹ 12345678910111213141516171819202122function _new(structFn, ...args) &#123; if (typeof structFn !== &quot;function&quot;) &#123; throw &quot;structFn must be a function&quot;; &#125; let obj = new Object(); obj.__proto__ = Object.create(structFn.prototype); let res = structFn.call(obj, ...args); const isObject = typeof res === &quot;object&quot; &amp;&amp; res !== null; const isFunction = typeof res === &quot;function&quot;; return isFunction || isObject ? res : obj;&#125;function Person(name) &#123; this.name = name;&#125;const per1 = _new(Person, &#x27;weng&#x27;);const per2 = new Person(&#x27;weng&#x27;);console.log(per1);console.log(per2); è¿™é‡Œåˆ†åˆ«æ‰“å°å‡ºä½¿ç”¨ newæ“ä½œç¬¦å’Œ_newå‡½æ•°çš„å®ä¾‹ è¿™é‡Œä¼šå‘ç°ï¼Œæˆ‘ä»¬è‡ªå·±å†™çš„_newæ“ä½œå‡½æ•°å¾—å‡ºçš„å®ä¾‹[[Prototype]]æŒ‡é’ˆçš„æŒ‡å‘æŒ‡å‘çš„æ˜¯Personå®ä¾‹ï¼Œé€šè¿‡Personå®ä¾‹é“¾æ¥åˆ°Personæ„é€ å‡½æ•°çš„åŸå‹çš„ï¼Œè¿™æ˜¯å› ä¸ºè¿™é‡ŒåŒ…äº†ä¸€å±‚ 1Object.create(structFn.prototype) ç›¸å½“äºè¿™é‡Œé€šè¿‡åŸå‹å¼ç»§æ‰¿ï¼Œå…‹éš†äº†ä¸€ä»½æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼Œå‡ºå‘ç‚¹æ˜¯ä¸ºäº†ä¸åœ¨ä½¿ç”¨å¤šä½™æ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå®ç°æ•°æ®å…±äº«, åŸç†å…¶å®å¦‚ä¸‹ 12345function object(o)&#123; function Fn()&#123;&#125;; Fn.prototype = o; return new Fn();&#125;; æˆ‘è§‰å¾—æ²¡å¿…è¦ï¼Œç›´æ¥è®©ï¼ŒstructFn.prototypeä¹Ÿå°±æ˜¯æ„é€ å‡½æ•°çš„åŸå‹ç›´æ¥ç­‰äºæ–°å¯¹è±¡çš„[[Prototype]]ç‰¹æ€§å°±è¡Œ äºæ˜¯å°±æ”¹ä¸º 1obj.__proto__ = structFn.prototype; ä¹‹åæ‰“å°å‡ºå…¶ä»–ç›¸å…³çš„ 12345678console.log(per1.__proto__);console.log(per2.__proto__);console.log(Object.getPrototypeOf(per1) === Object.getPrototypeOf(per2));console.log(Person.prototype.isPrototypeOf(per1));console.log(Person.prototype.isPrototypeOf(per2));console.log(per1 instanceof Person);console.log(per2 instanceof Person); ç»“æœå¦‚ä¸‹: OKæˆåŠŸæ‰‹å†™äº†ä¸€ä¸ªnewï¼Œæ¥ä¸‹æ¥å°±å†è¯•è¯•èƒ½ä¸èƒ½å†™call, aplly, bindè¿™äº›ç”¨c/c ++å†™çš„åº•å±‚ä»£ç ","tags":["Javascript","é¢è¯•é¢˜","æ„é€ å‡½æ•°","new"],"categories":["Javascript"]},{"title":"æ„é€ å‡½æ•°çš„è¿”å›å€¼","path":"/2021/06/01/æ„é€ å‡½æ•°çš„è¿”å›å€¼/","content":"æ„é€ å‡½æ•°çš„è¿”å›å€¼åœ¨ä½¿ç”¨new æ“ä½œç¬¦å»æ‰§è¡Œæ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œæ„é€ å‡½æ•°çš„è¿”å›å€¼ä¼šå†³å®šäº†æœ€ç»ˆæ„å»ºå‡ºæ¥çš„å®ä¾‹æ˜¯é•¿ä»€ä¹ˆæ ·å­çš„ ä¾‹å¦‚ä»¥ä¸‹ä¾‹å­ 1234567function Person()&#123; this.name = &#x27;weng&#x27;;&#125;const per1 = new Person();console.log(per1); ä¸€èˆ¬æƒ…å†µä¸‹æ„é€ å‡½æ•°æ˜¯ä¸éœ€è¦è¿”å›å€¼çš„ï¼Œé»˜è®¤æ˜¯è¿”å›thisï¼Œå†…éƒ¨çš„è¿™äº›è¡Œä¸ºéƒ½ä¼šæŒ‡å®šåˆ°this ä½†æ˜¯æœ‰äº›é¢è¯•é¢˜å°±è¦ä½ æ•´æ´»ï¼Œæ‰€ä»¥è¿˜æ˜¯äº†è§£ä»¥ä¸‹è¿”å›å€¼å¯¹åˆå§‹åŒ–åçš„å®ä¾‹çš„å½±å“å§ 1234567891011121314// return; // è¿”å› this// return null; // è¿”å› this// return this; // è¿”å› this// return false; // è¿”å› this// return &#x27;hello world&#x27;; // è¿”å› this// return 2; // è¿”å› this// return &#123;&#125;; // è¿”å› æ–°å»ºçš„ &#123;&#125;, person.name = undefined// return []; // è¿”å› æ–°å»ºçš„ [], person.name = undefined// return function()&#123;&#125;; // è¿”å› æ–°å»ºçš„ functionï¼ŒæŠ›å¼ƒ this, person.name = undefined// return new Boolean(false); // è¿”å› æ–°å»ºçš„ booleanï¼ŒæŠ›å¼ƒ this, person.name = undefined// return new String(&#x27;hello world&#x27;); // è¿”å› æ–°å»ºçš„ stringï¼ŒæŠ›å¼ƒ this, person.name = undefined// return new Number(32); // è¿”å› æ–°çš„ numberï¼ŒæŠ›å¼ƒ this, person.name = undefined æ€»ç»“ä¸€ä¸‹ï¼Œæ„é€ å‡½æ•°ä¸­ç›´æ¥ return ä¸€ä¸ªéå¼•ç”¨ç±»å‹å€¼æˆ–è€…nullï¼Œä¼šç›´æ¥è¿”å›thiså¯¹è±¡ï¼›å¦‚æœè¿”å›ä¸€ä¸ªå¤æ‚å¯¹è±¡æˆ–æ˜¯ new å…³é”®å­—åˆå§‹åŒ–çš„å¯¹è±¡ï¼Œä¼šç›´æ¥è¿”å›æ­¤å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å¼•ç”¨ç±»å‹å€¼ã€‚","tags":["Javascript","æ„é€ å‡½æ•°"],"categories":["Javascript"]},{"title":"ç»§æ‰¿ä¹‹å¯„ç”Ÿå¼ç»„åˆç»§æ‰¿","path":"/2021/05/31/ç»§æ‰¿ä¹‹å¯„ç”Ÿå¼ç»„åˆç»§æ‰¿/","content":"å¯„ç”Ÿå¼ç»„åˆç»§æ‰¿åœ¨ç»„åˆå¼ç»§æ‰¿çš„é‚£ç¯‡æ–‡ç« è¯´è¿‡ï¼Œç»„åˆå¼ç»§æ‰¿ï¼Œä¼šå°†çˆ¶ç±»çš„æ„é€ å‡½æ•°è°ƒç”¨ä¸¤æ¬¡ã€‚ æœ¬è´¨ä¸Šï¼Œå­ç±»åŸå‹æœ€ç»ˆå¼è¦åŒ…å«è¶…ç±»çš„æ‰€æœ‰å®ä¾‹å±æ€§ï¼Œå­ç±»çš„æ„é€ å‡½æ•°åªè¦åœ¨æ‰§è¡Œé€‚åˆé‡å†™åŸå‹å°±è¡Œäº† å†çœ‹çœ‹ç»„åˆå¼ç»§æ‰¿çš„ä¾‹å­ 1234567891011121314151617181920function SuperType(name)&#123; this.name = name; this.numbers = [1,2,3,4];&#125;SuperType.prototype.sayName = function()&#123; console.log(this.name);&#125;function SubType(name, age)&#123; SuperType.call(this, name); this.age = age;&#125;SubType.prototype = new SuperType();SubType.constructor = SubType;SubType.prototype.sayAge = function()&#123; console.log(this.age);&#125; è¿™ä¸ªè¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹ï¼š å¯ä»¥çœ‹å‡ºè¿™é‡Œé‡å¤è°ƒç”¨äº†SuperTypeå‡½æ•°ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªï¼Œå¼•å‡ºäº†äº†å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ åŸç†é€šè¿‡ç›—ç”¨æ„é€ å‡½æ•°ç»§æ‰¿å±æ€§ï¼Œä½†ä½¿ç”¨æ··åˆå¼åŸå‹é“¾ç»§æ‰¿çš„æ–¹æ³•ã€‚åŸºæœ¬æ€è·¯æ˜¯ä¸é€šè¿‡è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ç»™å­ç±»åŸå‹èµ‹å€¼ï¼Œè€Œæ˜¯å–å¾—çˆ¶ç±»åŸå‹çš„ä¸€ä¸ªå‰¯æœ¬ã€‚ è¯´åˆ°åº•å°±æ˜¯ä½¿ç”¨å¯„ç”Ÿå¼ç»§æ‰¿æ¥ç»§æ‰¿çˆ¶ç±»åŸå‹ï¼Œç„¶åå°†è¿”å›çš„æ–°å¯¹è±¡èµ‹å€¼ç»™å­ç±»åŸå‹ 12345function inheritPrototype(subType, superType)&#123; let prototype = object(superType.prototype); // åˆ›å»ºå¯¹è±¡ prototype.constructor = subType; // å¢å¼ºå¯¹è±¡ subType.prototype = prototype; // èµ‹å€¼å¯¹è±¡&#125; inheritPrototypeå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œå­æ„é€ å‡½æ•°å’Œçˆ¶ç±»æ„é€ å‡½æ•° åˆ›å»ºçˆ¶ç±»åŸå‹çš„ä¸€ä¸ªå‰¯æœ¬ ç»™è¿”å›çš„åŸå‹å¯¹è±¡è®¾ç½®constructorå±æ€§è®¾ç½®ä¸ºè‡ªèº«ï¼Œè§£å†³åŸå‹è¦†ç›–ä¸¢å¤±constructorçš„é—®é¢˜ æœ€åå°†æ–°åˆ›å»ºçš„å¯¹è±¡èµ‹å€¼ç»™å­ç±»å‹çš„åŸå‹ è¿™é‡Œåªè°ƒç”¨äº†ä¸€æ¬¡çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œé¿å…äº†SubTypeåŸå‹ä¸Šä¸å¿…è¦çš„å±æ€§ã€‚ è€Œä¸”åŸå‹é”®ä¹Ÿä¿æŒä¸å˜ï¼Œå› æ­¤instanceofæ“ä½œç¬¦å’ŒisPrototypeOf()æ–¹æ³•æ­£å¸¸æœ‰æ•ˆã€‚ å¯„ç”Ÿå¼ç»„åˆç»§æ‰¿å¯ä»¥ç®—æ˜¯å¼•ç”¨ç±»å‹ç»§æ‰¿çš„æœ€ä½³æ¨¡å¼","tags":["Javascript","æ„é€ å‡½æ•°","åŸå‹é“¾","åŸå‹","ç»§æ‰¿","ç»„åˆå¼ç»§æ‰¿","å¯„ç”Ÿå¼ç»„åˆç»§æ‰¿"],"categories":["Javascript"]},{"title":"ç»§æ‰¿ä¹‹å¯„ç”Ÿå¼ç»§æ‰¿","path":"/2021/05/31/ç»§æ‰¿ä¹‹å¯„ç”Ÿå¼ç»§æ‰¿/","content":"å¯„ç”Ÿå¼ç»§æ‰¿å¯„ç”Ÿå¼ç»§æ‰¿èƒŒåçš„æ€è·¯ç±»ä¼¼äºå¯„ç”Ÿ æ„é€ å‡½æ•°å’Œå·¥å‚æ¨¡å¼ æ€è·¯å¦‚ä¸‹ï¼š åˆ›å»ºä¸€ä¸ªå®ç°ç»§æ‰¿çš„å‡½æ•°ï¼Œè¿™é‡Œåªè¦æ˜¯èƒ½è¿”å›å¯¹è±¡çš„å‡½æ•°å°±è¡Œï¼Œä¾‹å¦‚ åŸå‹å¼ç»§æ‰¿çš„objectå‡½æ•°ï¼ˆObject.create()ï¼‰ ç„¶åä»¥æŸç§æ–¹å¼å¢å¼ºå¯¹è±¡ï¼Œè¿”å›å¯¹è±¡ ä¾‹å­ï¼š 1234567function create(o)&#123; let clone = object(o); clone.sayHi = function()&#123; console.log(&#x27;hello world&#x27;); &#125; return clone;&#125; å¯„ç”Ÿå¼ç»§æ‰¿åŒæ ·é€‚åˆä¸»è¦å…³æ³¨å¯¹è±¡ï¼Œè€Œä¸åœ¨ä¹ç±»å‹å’Œæ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ã€‚ å¯„ç”Ÿå¼ç»§æ‰¿å­˜åœ¨é—®é¢˜é€šè¿‡å¯„ç”Ÿå¼ç»§æ‰¿ç»™å¯¹è±¡æ·»åŠ å‡½æ•°ä¼šå¯¼è‡´å‡½æ•°éš¾ä»¥é‡ç”¨ï¼Œä¸æ„é€ å‡½æ•°æ¨¡å¼ç±»ä¼¼","tags":["Javascript","åŸå‹","ç»§æ‰¿","åŸå‹å¼ç»§æ‰¿","å·¥å‚æ¨¡å¼","å¯„ç”Ÿå¼ç»§æ‰¿"],"categories":["Javascript"]},{"title":"ç»§æ‰¿ä¹‹åŸå‹å¼ç»§æ‰¿","path":"/2021/05/31/ç»§æ‰¿ä¹‹åŸå‹å¼ç»§æ‰¿/","content":"åŸå‹å¼ç»§æ‰¿è¿™æ˜¯ä¸€ç§ä¸æ¶‰åŠä¸¥æ ¼æ„ä¹‰ä¸Šæ„é€ å‡½æ•°çš„ç»§æ‰¿æ–¹å¼ è¿™ä¸ªæ€è·¯å°±æ˜¯ï¼Œä¸éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªç±»å‹ï¼Œå°±å¯ä»¥é€šè¿‡åŸå‹å®ç°å¯¹è±¡ä¹‹é—´çš„ä¿¡æ¯å…±äº« å°±ä»ç„¶æ˜¯ä¸ºäº†å®ç°å¯¹è±¡ä¹‹é—´çš„ä¿¡æ¯å…±äº« ç›®æ ‡å‡½æ•°å¦‚ä¸‹ 12345function object(o)&#123; function F()&#123;&#125; F.prototype = o; return new F();&#125; æ€è·¯å¦‚ä¸‹ï¼š objectå‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ª ä¸´æ—¶ çš„æ„é€ å‡½æ•°åœ¨å‡½æ•°ä½œç”¨åŸŸå†…ï¼Œé€€å‡ºå‡½æ•°å°±ç›´æ¥é”€æ¯çš„é‚£ç§ å°†ä¼ å…¥çš„å¯¹è±¡èµ‹å€¼ç»™è¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„åŸå‹ï¼Œç„¶åè¿”å›è¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„å®ä¾‹ å…¶å®æœ¬è´¨ä¸Šæ˜¯å¯¹è¿™ä¸ªä¼ å…¥çš„objectè¿›è¡Œä¸€æ¬¡æµ…å¤åˆ¶ 123456789101112131415161718192021222324252627282930function object(o) &#123; function F() &#123;&#125; F.prototype = o; return new F();&#125;let person = &#123; name: &quot;weng&quot;, numbers: [1, 2, 3, 4],&#125;;let person2 = object(person);person2.name = &quot;kaimin&quot;;person2.numbers.push(5);let person3 = object(person);person3.name = &quot;helloworld&quot;;person2.numbers.push(6);console.log(Object.getPrototypeOf(person));console.log(Object.getPrototypeOf(person2));console.log(Object.getPrototypeOf(person3));console.log(person2.name);console.log(person3.name);console.log(person3.numbers);console.log(person.name);console.log(person.numbers); è¿™æ˜¯æœ€ç»ˆçš„æ‰“å°ç»“æœ è¿™é‡Œçš„person, person2, person3ä¹‹é—´çš„æ•°æ®éƒ½æ˜¯å…±äº«çš„ Object.create()ES5å°†è¿™ç§åŸå‹å¼ç»§æ‰¿çš„æ¦‚å¿µè§„èŒƒåŒ–äº†ã€‚ Object.create()æ¥å—ä¸¤ä¸ªå‚æ•° ä½œä¸ºæ–°å¯¹è±¡åŸå‹çš„å¯¹è±¡ ç»™æ–°å¯¹è±¡å®šä¹‰çš„é¢å¤–å±æ€§å¯¹è±¡ åªæœ‰åœ¨ä¼ ç¬¬ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼ŒObject.createä¸è¿™é‡Œçš„object()æ–¹æ³•ä¸€æ · Object.create()çš„ç¬¬äºŒä¸ªå‚æ•°ä¸Object.definePropertiesç¬¬äºŒä¸ªå‚æ•°ä¸€æ ·ï¼šæ¯ä¸€ä¸ªæ–°å¢çš„å±æ€§éƒ½é€šè¿‡å„è‡ªçš„æè¿°ç¬¦æ¥æè¿°ã€‚è¿™ç§æ–¹å¼æ·»åŠ çš„çš„å±æ€§ä¼šé®è”½åŸå‹å¯¹è±¡ä¸Šçš„åŒåå±æ€§ å®é™…ä¸Šå’ŒåŸå‹æ¨¡å¼ä¸€æ ·çš„ï¼Œåªæ˜¯ä¸éœ€è¦æ˜¾å¼çš„å»åˆ›å»ºæ„é€ å‡½æ•°äº†ã€‚é€‚ç”¨äºéœ€è¦åœ¨å¯¹è±¡ä¹‹é—´å…±äº«ä¿¡æ¯çš„åœºåˆ","tags":["Javascript","åŸå‹é“¾","åŸå‹","ç»§æ‰¿","åŸå‹å¼ç»§æ‰¿"],"categories":["Javascript"]},{"title":"ç»§æ‰¿ä¹‹ç»„åˆç»§æ‰¿","path":"/2021/05/31/ç»§æ‰¿ä¹‹ç»„åˆç»§æ‰¿/","content":"ç»„åˆç»§æ‰¿ï¼ˆä¼ªç»å…¸ç»§æ‰¿ï¼‰ç»„åˆç»§æ‰¿ç»¼åˆäº†åŸå‹é“¾å’Œç›—ç”¨æ„é€ å‡½æ•°ï¼Œå°†ä¸¤è€…çš„ä¼˜ç‚¹é›†ä¸­èµ·æ¥äº†ã€‚ åŸºæœ¬æ€è·¯æ˜¯ï¼š ä½¿ç”¨åŸå‹é“¾ç»§æ‰¿åŸå‹ä¸Šçš„å±æ€§å’Œæ–¹æ³• å†é€šè¿‡ç›—ç”¨æ„é€ å‡½æ•°ç»§æ‰¿å®ä¾‹å±æ€§ å¦‚ä¸‹ä¾‹å­ï¼š 1234567891011121314151617181920212223242526272829function SuperType(name)&#123; this.name = name; this.numbers = [1,2,3,4];&#125;SuperType.prototype.sayName = function()&#123; console.log(this.name);&#125;function SubType(name, age)&#123; SuperType.call(this, name); this.age = age;&#125;SubType.prototype = new SuperType();SubType.prototype.sayAge = function()&#123; console.log(this.age);&#125;let instance1 = new SubType(&#x27;weng&#x27;, 23);instance1.numbers.push(5);console.log(instance1.numbers); // 1,2,3,4,5instance1.sayName(); // wenginstance1.sayAge(); // 23let instance2 = new SubType(&#x27;helloworld&#x27;, 24);console.log(instance2.numbers); // 1,2,3,4 ç”¨ä»¥ä¸Šçš„æ–¹å¼åˆ›å»ºçš„å®ä¾‹ï¼Œå¯ä»¥å®ç°è‡ªèº«çš„å±æ€§æ˜¯ç‹¬ç«‹çš„ï¼Œæ–¹æ³•å¯ä»¥æ˜¯å…±äº«çš„ ç»„åˆç»§æ‰¿æ˜¯jsä¸­ç”¨çš„æœ€å¤šçš„ç»§æ‰¿æ¨¡å¼ è€Œç»„åˆç»§æ‰¿ä¹Ÿä¿ç•™äº†instanceofæ“ä½œç¬¦å’ŒisPrototypeOf()æ–¹æ³•è¯†åˆ«åˆæˆå¯¹è±¡çš„èƒ½åŠ› å¯ä»¥æ‰§è¡Œä¸€ä¸‹è¯­å¥æ£€éªŒä¸€ä¸‹ï¼Œå…¶å®è¿™ç¯‡æ–‡ç« å’ŒåŸå‹é‚£å—çš„ä¾‹å­ä¸€æ ·ï¼Œé‚£è¾¹æ›´è§£é‡Šäº†å®ä¾‹å’Œè¿™ä¸¤ä¸ªæ„é€ å‡½æ•°ä¹‹é—´çš„å…³ç³» 12345678console.log(SubType.prototype);console.log(SubType.prototype.isPrototypeOf(instance1));console.log(SuperType.prototype.isPrototypeOf(instance1));console.log(SuperType.prototype.isPrototypeOf(SubType.prototype))console.log(Object.getPrototypeOf(instance1));console.log(instance1.__proto__);console.log(instance1.__proto__.constructor);console.log(SubType.prototype.constructor); ç»„åˆç»§æ‰¿çš„é—®é¢˜çœ‹ä»¥ä¸Šçš„ç»„åˆç»§æ‰¿ä»£ç ï¼Œä½ ä¼šå‘ç°è¿™é‡Œçš„è¶…ç±»ä¹Ÿå°±æ˜¯SuperTypeè¢«å®ä¾‹åŒ–äº†ä¸¤æ¬¡ åœ¨SubTypeå°†å…¶åŸå‹è¦†ç›–ä¸ºSuperTypeæ„é€ å‡½æ•°newå‡ºæ¥çš„å®ä¾‹çš„æ—¶å€™ åœ¨SubTypeæ„é€ å‡½æ•°åˆ›å»ºå®ä¾‹çš„æ—¶å€™ï¼Œæ„é€ å‡½æ•°å†…éƒ¨ç›´æ¥è°ƒç”¨äº†SuperTypeï¼Œè¿™é‡Œåˆåˆå§‹åŒ–äº†ä¸€æ¬¡ é€ æˆçš„é—®é¢˜å°±æ˜¯ï¼ŒSuperTypeåˆ›å»ºå‡ºæ¥çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶SubTypeçš„åŸå‹ï¼Œä¼šå¸¦æœ‰SuperTypeæ„é€ å‡½æ•°åˆå§‹åŒ–çš„å‚æ•°ï¼Œå¹¶ä¸”ï¼ŒSubTypeæ„é€ å‡½æ•°åˆ›å»ºå‡ºæ¥çš„å®ä¾‹ï¼Œä¹Ÿä¼šå¸¦ç€SuperTypeçš„å±æ€§ï¼Œè¿™é‡Œå°±é‡å¤äº†ã€‚","tags":["Javascript","æ„é€ å‡½æ•°","åŸå‹é“¾","åŸå‹","ç»§æ‰¿","ç»„åˆå¼ç»§æ‰¿"],"categories":["Javascript"]},{"title":"ç»§æ‰¿ä¹‹ç›—ç”¨æ„é€ å‡½æ•°","path":"/2021/05/31/ç»§æ‰¿ä¹‹ç›—ç”¨æ„é€ å‡½æ•°/","content":"ç›—ç”¨æ„é€ å‡½æ•°ï¼ˆå¯¹è±¡ä¼ªè£…ï¼‰ä¸ºäº†è§£å†³åŸå‹ä¸­åŒ…å«å¼•ç”¨å€¼çš„é—®é¢˜ï¼Œå¼•å‡ºç›—ç”¨æ„é€ å‡½æ•°çš„ä¸€ç§æ–¹æ³• åŸºæœ¬æ€è·¯ï¼šåœ¨å­ç±»çš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œä½¿ç”¨aplly()å’Œcall()æ–¹æ³•ä»¥æ–°åˆ›å»ºçš„å¯¹è±¡ä¸ºä¸Šä¸‹æ–‡æ‰§è¡Œæ„é€ å‡½æ•°ã€‚ ä¾‹å¦‚ï¼š 123456789101112131415function SuperType()&#123; this.numbers = [1,2,3,4];&#125;function SubType()&#123; SuperType.call(this);&#125;let instance1 = new SubType();instance1.numbers.push(5);console.log(instance1.numbers); // [1,2,3,4,5]let instance2 = new SubType();console.log(instance2.numbers); // [1,2,3,4]; ä»¥ä¸Šçš„ç›—ç”¨ï¼Œå³è®©SuperTypeæ„é€ å‡½æ•°åœ¨ä¸ºSubTypeçš„å®ä¾‹åˆ›å»ºçš„æ–°å¯¹è±¡çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œäº†ã€‚è¿™å°±æ˜¯ç›¸å½“äºåœ¨æ–°çš„SubTypeå¯¹è±¡ä¸Šè¿è¡Œäº†SuperTypeæ„é€ å‡½æ•°ä¸­çš„æ‰€æœ‰åˆå§‹åŒ–ä»£ç ã€‚ç»“æœå°±æ˜¯æ¯ä¸€ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„numberså±æ€§ 1. ä¼ é€’å‚æ•°ç›¸æ¯”äºåŸå‹é“¾çš„ä½¿ç”¨ï¼Œç›—ç”¨æ„é€ å‡½æ•°ä¼˜ç‚¹å°±æ˜¯ï¼Œå¯ä»¥åœ¨å­ç±»æ„é€ å‡½æ•°ä¸­å‘çˆ¶ç±»æ„é€ å‡½æ•°ä¼ å‚æ•°ã€‚ 1234567891011function SuperType(name)&#123; this.name = name;&#125;function SubType()&#123; SuperType.call(this, &#x27;weng&#x27;); this.age = 23;&#125;let instance = new SubType();console.log(instance.name); // weng ä¸ºäº†ç¡®ä¿è°ƒç”¨SuperTypeçš„æ—¶å€™è¦†ç›–äº†SubTypeè‡ªèº«å®šä¹‰çš„å±æ€§ï¼Œæœ€å¥½å…ˆè°ƒç”¨çˆ¶å‡½æ•°ä¹‹åå†ç»™å­ç±»æ·»åŠ é¢å¤–å±æ€§ 2. ç›—ç”¨æ„é€ å‡½æ•°çš„é—®é¢˜è¿™ä¸ªé—®é¢˜æ˜¾è€Œæ˜“è§ ä¹Ÿæ˜¯å¿…é¡»å†æ„é€ å‡½æ•°ä¸­å®šä¹‰æ–¹æ³•ï¼Œå› æ­¤å‡½æ•°ä¸èƒ½é‡ç”¨ å­ç±»ä¹Ÿä¸èƒ½è®¿é—®çˆ¶ç±»åŸå‹ä¸Šå®šä¹‰å¾—æ–¹æ³•ï¼Œå› æ­¤æ‰€æœ‰ç±»å‹åªèƒ½ä½¿ç”¨æ„é€ å‡½æ•°æ¨¡å¼ ç”±äºå­˜åœ¨è¿™äº›é—®é¢˜ï¼Œç›—ç”¨å‡½æ•°ä¹Ÿä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œ å¯ä»¥çœ‹çœ‹ ç»§æ‰¿ä¹‹ç»„åˆç»§æ‰¿ è¿™ç¯‡æ–‡ç« ","tags":["Javascript","æ„é€ å‡½æ•°","åŸå‹é“¾","åŸå‹","ç»§æ‰¿"],"categories":["Javascript"]},{"title":"ç»§æ‰¿ä¹‹åŸå‹é“¾","path":"/2021/05/31/ç»§æ‰¿ä¹‹åŸå‹é“¾/","content":"ç»§æ‰¿ä¹‹åŸå‹é“¾é¦–å…ˆå†æ˜ç¡®ä¸€ä¸‹æ„é€ å‡½æ•°ï¼ŒåŸå‹ï¼Œå®ä¾‹ä¹‹é—´å…³ç³» æ¯ä¸€ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ åŸå‹å¯¹è±¡æœ‰ä¸ªå±æ€§å«åšconstructoræŒ‡å›æ„é€ å‡½æ•° å®ä¾‹æ˜¯ç”¨æ„é€ å‡½æ•°åˆ›å»ºå‡ºæ¥çš„ï¼Œå®ƒæœ‰ä¸€ä¸ªæŒ‡é’ˆ[[Prototype]]æŒ‡å‘å…¶æ„é€ å‡½æ•°çš„åŸå‹ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å®ä¾‹çš„åŸå‹ æŒ‰ç…§ä¸Šé¢çš„è¯´æ³•ï¼Œå‡è®¾ï¼Œå¦‚æœä¸€ä¸ªåŸå‹æ˜¯å¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹ï¼Œé‚£å°±æ„å‘³ç€è¿™ä¸ªåŸå‹æœ¬èº«æœ‰ä¸€ä¸ªå†…éƒ¨æŒ‡é’ˆæŒ‡å‘ä»–çš„æ„é€ å‡½æ•°çš„åŸå‹ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„åŸå‹ï¼Œç›¸åº”çš„å¦å¤–ä¸€ä¸ªåŸå‹ä¹Ÿæœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¦å¤–ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚æ‰€ä»¥ åœ¨å®ä¾‹å’ŒåŸå‹ä¹‹é—´æ„é€ äº†ä¸€æ¡åŸå‹é“¾ å®ç°ä¸€æ¡åŸå‹é“¾çš„ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920function SuperType()&#123; this.property = true;&#125;SuperType.prototype.getSuperValue = function()&#123; return this.property;&#125;function SubType()&#123; this.subproperty = false;&#125;// è¿™é‡Œç›´æ¥ç»§æ‰¿SuperTypeï¼Œå°†åŸå‹æŒ‡å‘SuperTypeçš„å®ä¾‹SubType.prototype = new SuperType();SubType.prototype.getSubValue = function()&#123; return this.subproperty;&#125;let instance = new SubType();console.log(instance.getSuperValue()); // true; ä»¥ä¸‹æ˜¯ä»–ä»¬çš„åŸå‹é“¾å›¾ï¼š è¿™ä¸ªä¾‹å­ç»§æ‰¿çš„å…³é”®å°±æ˜¯åœ¨äºï¼Œå°†SubTypeçš„é»˜è®¤åŸå‹è®¾ç½®ä¸ºäº†SubTypeçš„å®ä¾‹ï¼Œè¿™æ ·SubTypeçš„å®ä¾‹ä¸ä»…èƒ½ä»superTypeçš„å®ä¾‹ä¸­ç»§æ‰¿å±æ€§æ–¹æ³•ï¼Œè€Œä¸”è¿˜å’ŒSuperTypeæŒ‚é’©äº† è¿™ä¸ªæ—¶å€™ instanceå†…éƒ¨çš„[[Prototype]]æŒ‡å‘SubType.prototype SubType.prototypeé€šè¿‡å†…éƒ¨çš„[[Prototype]]æŒ‡å‘äº†SuperType.prototype è°ƒç”¨æˆ–è€…è®¿é—®å®ä¾‹çš„ä¸€ä¸ªå±æ€§ï¼Œè¿™ä¸ªæœç´¢è¿‡ç¨‹æ˜¯é€çº§å‘ä¸Šçš„ï¼Œå¦‚æœå®ä¾‹ä¸Šæ²¡æœ‰æ‰¾åˆ°å±æ€§æˆ–è€…æ–¹æ³•å°±å›å»åŸå‹ä¸Šæ‰¾ï¼Œå¦‚æœè¿˜æ²¡æœ‰ï¼Œå°±å»åŸå‹çš„åŸå‹ä¸Šæ‰¾ï¼Œç›´åˆ°ä¸€ç›´æ‰¾åˆ°Object.prototype.__proto__ä¸ºnullçš„æ—¶å€™ï¼Œå°±æ˜¯ä¸€ç›´æ‰¾åˆ°åŸç”Ÿå¯¹è±¡çš„åŸå‹æŒ‡å‘çš„åŸå‹ï¼ˆåŸå‹é“¾æœ«ç«¯ï¼‰ ä¸Šé¢çš„ä¾‹å­å®é™…çš„åŸå‹é“¾æ˜¯å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ åŸå‹é“¾å­˜åœ¨çš„é—®é¢˜åŸå‹é“¾æ¯•ç«Ÿä¹Ÿæ˜¯ç”±åŸå‹æ­èµ·æ¥çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±åŒ…å«äº†åŸå‹å­˜åœ¨çš„é—®é¢˜ åœ¨åŸå‹é‚£ç¯‡æ–‡ç« è¯´è¿‡ é—®é¢˜ä¸€åŸå‹ä¸­åŒ…å«å¼•ç”¨å€¼çš„æ—¶å€™ï¼Œä¼šåœ¨å®ä¾‹é—´å…±äº« æ‰€ä»¥ä¸ºä»€ä¹ˆé€šå¸¸ä¸€äº›å±æ€§æ˜¯å®šä¹‰åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥å­˜åœ¨åŸå‹ä¸Š é—®é¢˜äºŒå­ç±»å‹åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ä¸èƒ½å¤Ÿç»™çˆ¶ç±»å‹çš„æ„é€ å‡½æ•°ä¼ å‚æ•°ã€‚ å®é™…ä¸Šæˆ‘ä»¬è¿˜æ— æ³•åœ¨ä¸å½±å“æ‰€æœ‰å¯¹è±¡å®ä¾‹çš„æƒ…å†µä¸‹æŠŠå‚æ•°ä¼ ç»™çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚ æ‰€ä»¥åŸå‹é“¾åŸºæœ¬ä¸ä¼šè¢«å•ç‹¬ä½¿ç”¨ è¿™ä¸ªæ—¶å€™å°±è¡ç”Ÿå‡ºäº†è§£å†³åŸå‹é“¾å­˜åœ¨é—®é¢˜çš„å‡ ç§ç»§æ‰¿æ–¹æ¡ˆ ä¾‹å¦‚ ç›—ç”¨æ„é€ å‡½æ•° ç»„åˆç»§æ‰¿ åŸå‹å¼ç»§æ‰¿ å¯„ç”Ÿå¼ç»§æ‰¿ å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿","tags":["åŸå‹é“¾","åŸå‹","ç»§æ‰¿"],"categories":["Javascript"]},{"title":"ç®—æ³•ä¹‹æ»‘åŠ¨çª—å£","path":"/2021/05/30/ç®—æ³•ä¹‹æ»‘åŠ¨çª—å£/","content":"leetcodeç¬¬209é“é¢˜ç›® é“¾æ¥ é¢˜ç›®æ˜¯ é¢˜è§£ 12345678910111213141516171819202122232425/** * @param &#123;number&#125; target * @param &#123;number[]&#125; nums * @return &#123;number&#125; */var minSubArrayLen = function (target, nums) &#123; let left = 0; let right = 0; let minL = Infinity; let sum = 0; while (right &lt; nums.length) &#123; sum += nums[right]; while (sum &gt;= target) &#123; minL = Math.min(minL, right - left + 1); sum -= nums[left]; left++; if (sum &lt; target) &#123; break; &#125; &#125; right++; &#125; return minL === Infinity ? 0 : minL&#125;;","tags":["Javascript","é¢è¯•é¢˜","ç®—æ³•","æ»‘åŠ¨çª—å£"],"categories":["ç®—æ³•"]},{"title":"åˆ›å»ºå¯¹è±¡ä¹‹åŸå‹æ¨¡å¼","path":"/2021/05/30/åˆ›å»ºå¯¹è±¡ä¹‹åŸå‹æ¨¡å¼/","content":"åŸå‹æ¨¡å¼æ¯ä¸€ä¸ªå‡½æ•°éƒ½ä¼šåˆ›å»ºä¸€ä¸ªprototypeçš„å±æ€§ åŸå‹æ–¹å¼ 12345678910111213function Person()&#123;&#125;Person.prototype.name = &#x27;weng&#x27;;Person.prototype.age = 23;Person.sayName = function()&#123; console.log(this.name);&#125;let per1 = new Person();ler per2 = new Person();per1.sayName(); // weng 1.ä¸æ„é€ å‡½æ•°çš„ä¸åŒåŸå‹æ¨¡å¼æ˜¯ç›´æ¥å†æ„é€ å‡½æ•°çš„prototypeå±æ€§ä¸ŠåŠ å¯¹è±¡å’Œç›¸åº”çš„å±æ€§ï¼ˆä¹Ÿå°±æ˜¯å†æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ä¸Šé¢åŠ å±æ€§ï¼‰ ä¸æ„é€ å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œä½¿ç”¨è¿™ç§åŸå‹æ¨¡å¼å®šä¹‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œä¹‹ååˆ›å»ºå‡ºæ¥çš„å®ä¾‹ï¼Œéƒ½æ˜¯ä¸€èµ·å…±äº«è¿™äº›å±æ€§çš„ï¼Œå› æ­¤ ä¸Šè¿°çš„per1å’Œper2çš„sayName()å‡½æ•°æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªæŒ‡é’ˆ, ä»–ä»¬çš„åŸå‹ä¹ŸåŒæ ·éƒ½æ˜¯Personæ„é€ å‡½æ•°æŒ‡å‘çš„åŸå‹å¯¹è±¡ 1console.log(per1.sayName = per2.sayName); 2. ç†è§£åŸå‹è‡ªå®šä¹‰æ„é€ å‡½æ•°çš„æ—¶å€™ï¼ŒåŸå‹å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼ˆprototypeæŒ‡å‘çš„å¯¹è±¡ï¼‰ï¼Œä¼šè‡ªåŠ¨è·å¾—ä¸€ä¸ªconstructorçš„å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯é‡æ–°æŒ‡å‘è‡ªå®šä¹‰çš„æ„é€ å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰çˆ¶ç±»çš„è¯ï¼Œå…¶ä»–çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯ç»§æ‰¿äºjså†…éƒ¨çš„Objectå¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•ã€‚ 1console.log(Person.prototype.constructor === Person; // true; ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°çš„Personè‡ªå®šä¹‰æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå®ä¾‹ 1let per1 = new Person() è¿™ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·çš„ per1å®ä¾‹ï¼ˆå¯¹è±¡ï¼‰å†…éƒ¨çš„[[Prototype]]æŒ‡é’ˆå°±ä¼šè¢«èµ‹å€¼ä¸ºPersonæ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯Person.prototypeï¼‰ per1å¯ä»¥è®¿é—®Personçš„åŸå‹ä¸Šæ‰€æœ‰å±æ€§ jsè„šæœ¬ä¸­æ˜¯æ²¡æœ‰è®¿é—®[[Prototype]]ç‰¹æ€§çš„æ ‡å‡†æ–¹å¼ï¼Œä½†æ˜¯è°·æ­Œæµè§ˆå™¨ç«ç‹è¿˜æœ‰safariä¼šåœ¨æ¯ä¸€ä¸ªå¯¹è±¡ä¸Šæš´éœ²__proto__å±æ€§ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥ç›´æ¥è®¿é—®æ„é€ å‡½æ•°çš„åŸå‹ä¹Ÿå°±æ˜¯è¿™ä¸ªå®ä¾‹çš„åŸå‹ ä½†æ˜¯ï¼Œå®ä¾‹æ˜¯å’Œæ„é€ å‡½æ•°æ²¡æœ‰ç›´æ¥çš„è”ç³»çš„ï¼Œåªå’Œæ„é€ å‡½æ•°çš„åŸå‹åˆå…³è” 1console.log(Person.prototype === per1.__proto__); // true; Objectçš„åŸå‹çš„åŸå‹æ˜¯null 123console.log(Person.prototype.__proto__ === Object.prototype) // trueconsole.log(Person.prototype.__proto__.constructor === Object); //trueconsole.log(Person.prototype.__proto__.__proto__ === null); å¦‚å›¾å¯ä»¥çœ‹å‡ºå®ä¾‹ï¼Œæ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°çš„åŸå‹ä¹‹é—´çš„å…³ç³» è¿™é‡Œæ¯”è¾ƒé‡è¦çš„ç‚¹åœ¨äº æ„é€ å‡½æ•°çš„åŸå‹ï¼ˆPerson.prototypeï¼‰çš„constructorå±æ€§æ˜¯æŒ‡å›Personæ„é€ å‡½æ•°çš„ å®ä¾‹å’Œæ„é€ å‡½æ•°ä¹‹é—´æ²¡æœ‰ç›´æ¥è”ç³» æ‰€æœ‰é€šè¿‡åŒä¸€ä¸ªæ„é€ å‡½æ•°æ„å»ºå‡ºæ¥çš„å®ä¾‹ï¼Œå…¶ä¸­[[Prototype]]æŒ‡é’ˆæ˜¯æŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹ã€‚ 3. æ£€æŸ¥å®ä¾‹åŸå‹1. instanceofç”±å®ä¾‹ç›´æ¥è°ƒç”¨ï¼Œå»åˆ¤æ–­å®ä¾‹çš„åŸå‹é“¾ä¸­æ˜¯å¦æœ‰æŸä¸ªæ„é€ å‡½æ•°çš„åŸå‹ è¿™é‡Œä¸€å®šè¦æ³¨æ„ï¼Œæ˜¯åˆ¤æ–­æŸä¸ªæ„é€ å‡½æ•°çš„åŸå‹ 123console.log(per1 instanceof Person); // trueconsole.log(per1 instanceof Object); // true;console.log(Person.prototype instanceof Object); // true; å¦‚ç¬¬äºŒå¤§ç‚¹çš„å›¾1å¯ä»¥çœ‹æ¸…è¿™æ ·çš„ç»§æ‰¿å…³ç³»ï¼Œç»§æ‰¿å…³ç³»å¦ä¸€ç¯‡æ–‡ç« å†è¯´ 2. isPrototypeOfè¿™ä¸ªæ–¹æ³•æ˜¯ä¸ºäº†ç¡®å®šä¸¤ä¸ªå¯¹è±¡ä¹‹é—´åŸå‹çš„å…³ç³» å› ä¸ºå¦‚ç¬¬2å¤§ç‚¹æ‰€è¯´ï¼Œä¸æ˜¯æ‰€æœ‰çš„å®ç°éƒ½å¯¹å¤–æš´éœ²çš„[[Prototype]]çš„æŒ‡é’ˆ æ‰€ä»¥å¯ä»¥ç›´æ¥åœ¨åŸå‹ä¸Šå»è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ£€æµ‹æŸä¸ªå¯¹è±¡æ˜¯å¦çš„[[Prototype]]çš„æŒ‡é’ˆæ˜¯å¦æŒ‡å‘å®ƒï¼Œå› æ­¤ä¹Ÿèƒ½å¤Ÿæ£€æµ‹å‡ºä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³ç³» 1console.log(Person.prototype.isPrototypeOf(per1)); // true; 3. Object.getPrototypeOf()è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›å‚æ•°çš„å†…éƒ¨[[Prototype]]çš„æŒ‡é’ˆï¼ˆè¿™ä¸ª[[Prototype]]ä¹Ÿå…¶å®å°±æ˜¯å‚æ•°çš„ç‰¹æ€§ï¼Œå¯ä»¥å»ä¸€ç¯‡å«åšå¯¹è±¡çš„å±æ€§ç‰¹æ€§è¯¦è§£çš„æ–‡ç« æŸ¥çœ‹ï¼‰ è¿™ä¸ªå‡½æ•°ä¼ å…¥ä¸€ä¸ª å®ä¾‹ï¼Œ è¿”å›è¿™ä¸ªå®ä¾‹çš„åŸå‹å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ 12console.log(Object.getPrototypeOf(per1)===Person.prototype);Object.getPrototypeOf(per1).name; // weng 4. *Object.setPrototypeOf()è¿™ä¸ªæ–¹æ³•å¯ä»¥ç»™å®ä¾‹çš„[[Prototype]]æŒ‡é’ˆå†™å…¥ä¸€ä¸ªæ–°çš„å€¼ï¼Œè¿™æ ·å¯ä»¥é‡å†™ä¸€ä¸ªå®ä¾‹çš„åŸå‹ç»§æ‰¿å…³ç³» 12345678910111213let a = &#123; name: &#x27;weng&#x27;; age:23&#125;;let b = &#123; name: &#x27;kaimin&#x27;&#125;Object.setPrototypeof(b, a);console.log(b.name) // kaiminconsole.log(b.age) // 23console.log(Object.getPrototypeOf(b) === a); // true; è¿™é‡Œä¸æ¨èä½¿ç”¨è¿™ç§è¦†ç›–å®ä¾‹åŸå‹æŒ‡å‘çš„æ–¹å¼æ”¹å˜åŸå‹ç»§æ‰¿çš„å…³ç³»ï¼Œä¼šä¸¥é‡çš„å½±å“ä»£ç çš„æ€§èƒ½ã€‚ Mozillaæ–‡æ¡£ä¸­è¯´çš„â€œåœ¨æ‰€æœ‰æµè§ˆå™¨å’Œjsçš„å¼•æ“ä¸­ï¼Œä¿®æ”¹ç»§æ‰¿å…³ç³»çš„å½±å“éƒ½æ˜¯å¾®å¦™è€Œä¸”æ·±è¿œçš„ã€‚è¿™ç§å½±å“å¹¶ä¸æ˜¯æ‰§è¡Œä»¥ä¸Šè¿™ä¸ªä»£ç é‚£ä¹ˆç®€å•ï¼Œè€Œæ˜¯ä¼šæ¶‰åŠåˆ°æ‰€æœ‰è®¿é—®äº†é‚£äº›ä¿®æ”¹è¿‡ [[Prototype]]æŒ‡å‘çš„å®ä¾‹çš„ä»£ç â€ å› ä¸ºæœ‰ä¸Šè¿°çš„å¼Šç«¯ï¼Œå¯ä»¥çœ‹å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼Œç»§æ‰¿ä¹‹åŸå‹å¼ç»§æ‰¿ ä¸­è®²åˆ°çš„åˆ›å»ºæ–°å¯¹è±¡çš„å½¢å¼ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼äºObject.create()æ¥åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼ŒåŒæ—¶ç»™ä»–æŒ‡å®šä¸€ä¸ªåŸå‹ï¼Œè¿™å—ç»§æ‰¿ä¼šåœ¨ç»§æ‰¿æ–‡ç« ä¸­è¯¦ç»†è§£é‡Š 12345678910let a = &#123; name: &#x27;weng&#x27;; age:23&#125;;let b = Object.create(a);b.name = &#x27;kaimin&#x27;;console.log(b.name) // kaiminconsole.log(b.age) // 23console.log(Object.getPrototypeOf(b)) // a Object.createè¿™ç§å½¢å¼å…¶å®æ˜¯ä»¥åŒ¿åæ„é€ å‡½æ•°çš„å½¢å¼ï¼ŒæŒ‡å®šè¿™ä¸ªåŒ¿åå‡½æ•°çš„åŸå‹ä¸ºä½ æƒ³è¦çš„é‚£ä¸ªå®ä¾‹ï¼Œå› ä¸ºè¿™é‡Œå’±ä»¬åªæ˜¯åœ¨ä¹è¿™ä¸ªæ–°åˆ›å»ºçš„å®ä¾‹ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯bï¼‰ä»–çš„[[Prototype]]çš„æŒ‡å‘æ˜¯å¦æ˜¯æŒ‡å‘æ‰€éœ€å¯¹è±¡ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯aï¼‰çš„ï¼Œå®Œå…¨å¯ä»¥è·³è¿‡æ˜¾ç¤ºåˆ›å»ºæ„é€ å‡½æ•°çš„å½¢å¼ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•ä¸ä»…ä»…ä¸ä¼šæ”¹å˜åŸæ¥å®ä¾‹ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯aï¼‰çš„[[Prototype]]æŒ‡å‘ï¼Œè€Œä¸”åˆè®©æ–°å®ä¾‹çš„åŸå‹æŒ‡å‘äº†aï¼Œå°±å¾ˆæ£’ï¼Œè¿™é‡Œå…·ä½“è¿˜æ˜¯å»ç»§æ‰¿é‚£è¾¹æ–‡ç« çœ‹ 4.åŸå‹çš„å±‚çº§ä¾‹å¦‚ä»¥ä¸‹ä»£ç  123456789101112131415function BasePerson()&#123; this.country = &#x27;China&#x27;; this.age = 23;&#125;function Person()&#123; this.name = &#x27;weng&#x27;;&#125;Person.prototype = new BasePersn();const per1 = new Person();per1.address = &#x27;fujian&#x27;;console.log(per1.age) // 23 ä»¥ä¸Šä»£ç çš„å„ä¸ªå…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼› è¿™é‡Œæ¯”è¾ƒé‡è¦çš„æ˜¯Person.prototypeï¼Œè¿™é‡Œæ‰‹åŠ¨ç»™ä»–èµ‹å€¼ç»™äº†new BasePerson()æ„é€ å‡ºæ¥çš„å®ä¾‹ï¼Œåé¢åˆæ‰‹åŠ¨çš„ç»™æŠŠä»–çš„constructorå±æ€§èµ‹å€¼ç»™äº†Personï¼Œè¿™é‡Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæœ¬æ–‡æœ€åä¼šè¯´æ˜ ä¹‹åå‘¢ï¼ŒPersonçš„åŸå‹å¯¹è±¡ä¸­æœ‰äº†BasePersonæ„é€ å‡½æ•°å†…éƒ¨åˆå§‹åŒ–çš„æ—¶å€™çš„ä¸€äº›å‚æ•° æŒ‰ç…§è¿™ä¸Šé¢çš„å±‚çº§å…³ç³» 123per1.name; // wengper1.address; // fujianper1.age; // 23 è¿™é‡Œå…¶å®éƒ½æ˜¯å¯ä»¥è®¿é—®åˆ°çš„ åœ¨é€šè¿‡å®ä¾‹è®¿é—®å±æ€§çš„æ—¶å€™ï¼Œä¼šæŒ‰è¿™ä¸ªå±æ€§çš„åç§°å¼€å§‹æœç´¢ï¼Œä¸€å±‚å±‚å¾€ä¸Šèµ°ï¼Œä¸€å¼€å§‹æœç´¢å®ä¾‹æœ¬èº«æ˜¯å¦æœ‰è¿™äº›å±æ€§ ï¼Œå¦‚æœæœ‰å°±è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ç»§ç»­é€šè¿‡ [[Prototype]]çš„æŒ‡é’ˆå‘ä¸Šæœç´¢åŸå‹ã€‚ constructoråªå­˜åœ¨äºåŸå‹å¯¹è±¡ä¸Šé¢ï¼Œå…¶å®ä¹Ÿå¯ä»¥é€šè¿‡è®¿é—®å®ä¾‹çš„åŸå‹æŒ‡é’ˆæ¥è®¿é—®è¿™ä¸ªconstructor å¦‚æœæœ‰å­˜åœ¨åŒåå±æ€§çš„è¯ï¼Œå®åŠ›ä¸Šåˆ›å»ºçš„ä¼šè¦†ç›–åŸå‹ä¸Šçš„ï¼Œä½†ä¸è‡³äºæ”¹å˜åŸå‹ä¸Šçš„åŒåå±æ€§ï¼Œåªæ˜¯ç»™ä»–ç›–ä½çœ‹ä¸è§äº† 1.åˆ é™¤å®ä¾‹ä¸­çš„å±æ€§deleteæ“ä½œç¬¦å·å¯ä»¥åˆ é™¤å®ä¾‹ä¸Šé¢å®šä¹‰çš„å±æ€§å€¼ï¼Œè°ƒç”¨æ—¶å€™ï¼Œè¿™ä¸ªå®ä¾‹çš„åŸå‹ä¸Šçš„å€¼ä¸ä¼šè¢«åˆ é™¤ è¦åˆ é™¤çš„è¯å¾—ç›´æ¥åœ¨åŸå‹ä¸Šåšæ“ä½œ ä¾‹å¦‚ä¸Šé¢çš„ä»£ç æ„å»ºçš„å®ä¾‹per1 12delete per1.address;console.log(per1.address) // undefined é€šè¿‡åˆ é™¤å®ä¾‹ä¸Šçš„å±æ€§ï¼Œå¯èƒ½ä¼šæš´éœ²å‡ºåŸå‹ä¸Šçš„åŒåå±æ€§ï¼Œè¿™é‡Œçš„è¯å…·ä½“è€Œè®ºï¼Œé‚£æ€ä¹ˆåˆ¤æ–­è¿™ä¸ªå±æ€§æ˜¯åœ¨åŸå‹ä¸Šè¿˜æ˜¯åœ¨å®ä¾‹ä¸Šçš„å‘¢ï¼Ÿ 2. åˆ¤æ–­å±æ€§åœ¨åŸå‹ä¸Šè¿˜æ˜¯åœ¨å®ä¾‹ä¸Š1. hasOwnProperty()è¿™ä¸ªæ–¹æ³•å¯ä»¥ç”¨æ¥åˆ¤æ–­æŸä¸ªå±æ€§æ˜¯å¦åœ¨å®ä¾‹ä¸Šé¢ï¼ˆè¿™ä¸ªå‡½æ•°ä¸è¿›å…¥å®ä¾‹çš„åŸå‹ä¸­å»æœç´¢æŒ‡å®šå±æ€§ï¼‰ è¿™ä¸ªæ–¹æ³•ç›´æ¥åœ¨å®ä¾‹ä¸Šè°ƒç”¨ï¼Œç»§æ‰¿è‡³Objectæ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼Œå¦‚æœå®³æ€•å®ä¾‹çš„ä¸­æœ‰åŒåæ–¹æ³•çš„è¯å¯ä»¥ä½¿ç”¨Object.prototype.hasOwnProperty.call(this)æ¥è°ƒç”¨ æ¯”å¦‚ä¸Šé¢çš„per1å®ä¾‹åœ¨æ²¡æœ‰åˆ é™¤addrssçš„æƒ…å†µä¸‹ 1234per1.hasOwnProperty(&#x27;address&#x27;); // true;per1.hasOwnProperty(&#x27;name&#x27;); // true;per1.hasOwnProperty(&#x27;age&#x27;); // false; per1.ageå®é™…ä¸Šè¿”å›çš„æ˜¯è¿™ä¸ªå®ä¾‹åŸå‹ä¸Šçš„ageï¼ŒhasOwnPropertyæ˜¯è®¿é—®ä¸åˆ°çš„ é‚£å¦‚æœè¦ç¡®å®šæ˜¯å¦åŸå‹ä¸Šæœ‰è¿™ä¸ªå€¼å‘¢ï¼Ÿä¸ç”¨per1[â€˜â€¦.â€™]æ¥åˆ¤æ–­ 2. ininæ“ä½œç¬¦æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ åœ¨for-inä¸­ä½¿ç”¨ å•ç‹¬ä½¿ç”¨ è¿™é‡Œå…ˆè¯´è¯´å•ç‹¬ä½¿ç”¨inï¼Œä¸‹é¢å¾—ç¬¬5ç‚¹è¯´for-in inæ“ä½œç¬¦å·å¯ä»¥é€šè¿‡å¯¹è±¡è®¿é—®æŒ‡å®šå±æ€§æ—¶å€™è¿”å›trueï¼Œæ— è®ºæ˜¯åœ¨åŸå‹ä¸Šè¿˜æ˜¯åœ¨å®ä¾‹ä¸Šé¢ï¼Œéƒ½å¯ä»¥è®¿é—®çš„åˆ° ä¾‹å¦‚ä¸Šé¢çš„per1å¯¹è±¡ 123console.log(&#x27;name&#x27; in per1); // trueconsole.log(&#x27;address&#x27; in per1); // trueconsole.log(&#x27;age&#x27; in per1); // true 3. ç¡®å®šå®ä¾‹çš„æŸä¸ªå±æ€§ä¸åœ¨å®ä¾‹ä¸Šï¼Œåªåœ¨åŸå‹ä¸Šç»“åˆç¬¬4å¤§ç‚¹çš„ç¬¬äºŒå°ç‚¹çš„ä¸¤ä¸ªæ“ä½œç¬¦ï¼Œå¯ä»¥ç¡®å®šä¸€ä¸ªå‡½æ•° 123function hasPrototypeProperty(object,name)&#123; return !object.hasOwnProperty(name) &amp;&amp; (name in object);&#125; 4. è·å–å®ä¾‹çš„å±æ€§1. Object.keys()è·å–å®ä¾‹ä¸Šçš„å±æ€§ï¼ˆä»…ä»…æ˜¯å®ä¾‹ä¸Šå¯æšä¸¾å±æ€§ï¼‰2. for-inéå†å®ä¾‹ä»¥åŠå…¶åŸå‹ä¸Šçš„æ‰€æœ‰å±æ€§ï¼ˆä»…ä»…æ˜¯å¯æšä¸¾å±æ€§ï¼‰3.Object.getOwnPropertyNames()è·å–ä»…ä»…æ˜¯å®ä¾‹ä¸Šçš„å±æ€§ï¼ˆæ˜¯å¦å¯æšä¸¾éƒ½èƒ½è·å–ï¼‰ä¾‹å¦‚ï¼š æ­£å¸¸æ¥è¯´ï¼Œä¸€ä¸ªå®ä¾‹çš„åŸå‹å¯¹è±¡ä¸Šçš„constructorå±æ€§éƒ½æ˜¯ä¸å¯ä»¥æšä¸¾çš„ï¼Œæ˜¯ä¸èƒ½å¤Ÿé€šè¿‡1ï¼Œ2ä¸¤ä¸ªæ–¹æ³•è·å–çš„ 12let keys = Object.getOwnPropertyNames(Person.prototype);console.log(keys); // [...., &#x27;constructor&#x27;] 4. Object.getOwnPropertySymbols() ä»…ä»…é’ˆå¯¹ç¬¦å·é’ˆå¯¹å®ä¾‹å±æ€§ï¼ˆæ˜¯å¦æšä¸¾éƒ½å¯ä»¥ï¼‰123456let k1 = Symbol(&#x27;k1&#x27;);let o = &#123; [k1]: &#x27;helloworld&#x27;&#125;console.log(o);// [Symbol(k1)] 5. å±æ€§çš„æšä¸¾é¡ºåºä»¥ä¸Šå¯ä»¥æ€»ç»“å‡ ç§è·å–å®ä¾‹æˆ–è€…å®ä¾‹åŸå‹ä¸Šçš„ä¸€äº›å±æ€§çš„æ–¹æ³• for-in Object.keys() Object.getOwnPropertyNames() Object.getOwnPropertySymbols(); è¿™é‡Œæ¶‰åŠåˆ°è·å–å±æ€§çš„é¡ºåºï¼Œè¿˜æœ‰ä¸€ä¸ªObject.assignè¿™ç±»æµ…å±‚å¤åˆ¶å¯¹è±¡çš„æ–¹å¼ for-inä»¥åŠObject.keys()è·å–åˆ°çš„å±æ€§å€¼çš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œå–å†³äºjsçš„å¼•æ“ Object.getOwnPropertyNames()ï¼ŒObject.getOwnPropertySymbols(); ä»¥åŠObject.assignå¾—å‡ºæ¥çš„å±æ€§çš„æšä¸¾é¡ºåºéƒ½æ˜¯ç¡®å®šçš„ã€‚ æŒ‰ç…§ä»¥ä¸‹è§„åˆ™ï¼š å…ˆå‡åºæšä¸¾æ•°å€¼é”® ä»¥æ’å…¥é¡ºåºæšä¸¾å­—ç¬¦ä¸²å’Œç¬¦å·é”® å¯¹è±¡å­—é¢é‡ä¸­å®šä¹‰çš„é”®ï¼Œä»¥é€—å·åˆ†éš”çš„é¡ºåºæ’å…¥ ä¾‹å¦‚ï¼š 123456789101112131415161718let k1 = Symbol(&#x27;k1&#x27;), k2 = Symbol(&#x27;k2&#x27;);let o = &#123; 1: 1, first:&#x27;first&#x27;, [k1]:&#x27;hello&#x27;, second:&#x27;second&#x27;, 0:0&#125;o[k2] = &#x27;world&#x27;;o[3] = 3;o.third = &#x27;third&#x27;;o[2] = 2;console.log(Object.getOwnPropertyNames(0));// [&quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;first&quot;,&quot;second&quot;,&quot;third&quot;];console.log(Object.getOwnPropertySymbols(o));// [Symbol(k1),Symbol(k2)]; 6. åŸå‹ä¸­å­˜åœ¨çš„é—®é¢˜ å¼±åŒ–äº†å‘æ„é€ å‡½æ•°ä¼ é€’åˆå§‹åŒ–å‚æ•°çš„èƒ½åŠ›ï¼Œä¼šå¯¼è‡´æ‰€æœ‰å®ä¾‹é»˜è®¤éƒ½å–å¾—ç›¸åŒçš„å±æ€§å€¼ åŸå‹ä¸Šå¼•ç”¨å€¼å±æ€§çš„é—®é¢˜ ç¬¬ä¸€ç‚¹æ˜¯æ˜¾è€Œæ˜“è§çš„ ç¬¬äºŒç‚¹ä¸­ä¸¾ä¸ªä¾‹å­ 1234567function Person()&#123;&#125;Person.prototype.arr = [1,2,3,4];let per1 = new Person();let per2 = new Person();per1.arr.push(5);console.log(per2.arr) // [1,2,3,4, 5]; å¼•ç”¨ç±»å‹çš„arrå®šä¹‰åœ¨åŸå‹ä¸Šï¼Œè¿™æ—¶å€™å¯¹per1ä¸Šçš„arrå±æ€§è¿›è¡Œä¿®æ”¹ï¼Œå› ä¸ºper1å®ä¾‹ä¸Šä¸å­˜åœ¨arrçš„å±æ€§ï¼Œé‚£ä¹ˆä¼šæ‰¾åˆ°åŸå‹ä¸­çš„arrï¼Œè¿™æ—¶å€™é€šè¿‡arr.pushæ˜¯ç›´æ¥ä½œç”¨åœ¨åŸå‹ä¸­çš„arrçš„ï¼Œæ‰€ä»¥ï¼Œå¼•ç”¨ç±»å‹å±æ€§ä¹‹é—´çš„å…±äº«ç‰¹æ€§å¯¼è‡´per2.arrè®¿é—®çš„ä¹Ÿæ˜¯åŸå‹ä¸Šçš„arrï¼Œæ„æ€å°±æ˜¯å¼•ç”¨ç±»å‹è®¿é—®çš„éƒ½æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå°±ç‰¹ä¹ˆå’Œå¯¹è±¡ä¸€æ ·ã€‚ æœ¬ç¯‡æ–‡ç« ä¸­ç•™ä¸‹æ¥çš„ç–‘é—®1. constructoræ‰‹åŠ¨èµ‹å€¼çš„æƒ…å†µä»¥ä¸Šç¬¬4å¤§ç‚¹ä¸­çš„å±‚çº§å…³ç³»ä»£ç ä¸­ï¼Œæ‰‹åŠ¨å°†åŸå‹ä¸­çš„constructorèµ‹å€¼ç»™äº†Person 12345678910111213141516function BasePerson()&#123; this.country = &#x27;China&#x27;; this.age = 23;&#125;function Person()&#123; this.name = &#x27;weng&#x27;;&#125;Person.prototype = new BasePersn();Person.prototype.constructor = Person;const per1 = new Person();per1.address = &#x27;fujian&#x27;;console.log(per1.age) // 23 å› ä¸ºåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPerson.prototypeè¢«æ‰‹åŠ¨è®¾ç½®ä¸ºä¸€ä¸ªBasePersonæ„å»ºå‡½æ•°æ„å»ºå‡ºæ¥çš„æ–°å®ä¾‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ç›¸å½“äºé‡å†™äº†Personæ„é€ å‡½æ•°çš„åŸå‹ï¼Œè¿™æ ·é‡å†™ä¹‹åï¼ŒPerson.prototypeå°±ä¸å†æŒ‡å‘è‡ªèº«çš„Personï¼Œç”±æœ¬æ–‡å¼€å¤´è¯´çš„ä¸€æ ·ï¼Œå‡½æ•°æ„å»ºçš„æ—¶å€™ä¼šé»˜è®¤åˆ›å»ºåŸå‹ï¼Œä¹Ÿå°±æ˜¯prototypeå¯¹è±¡ï¼Œä¹Ÿä¼šè‡ªåŠ¨ç»™åŸå‹çš„contructorèµ‹å€¼ï¼Œè¿™ä¸ªå†™æ³•å®Œå…¨è¦†ç›–äº†é»˜è®¤çš„prototypeï¼Œé€ æˆäº†constructorä¸å†æŒ‡å‘è‡ªèº«çš„æ„é€ å‡½æ•°ï¼Œè€Œæ˜¯æŒ‡å‘äº†Objectæ„é€ å‡½æ•°Object(){} è¿™ä¸ªæ—¶å€™å°±ä¸åœ¨èƒ½å¤Ÿé€šè¿‡constructorå±æ€§æ¥è¯†åˆ«æ˜¯ä»€ä¹ˆç±»å‹äº†ï¼Œè¿˜æ˜¯å¾—ç”¨instanceof å†æ¯”å¦‚ä¸‹é¢çš„ä»£ç  12345678910111213function Person()&#123; &#125;let f = new Person();Person.prototype = &#123; name:&#x27;weng&#x27;, sayName()&#123; console.log(this.name); &#125;&#125;f.sayName(); // æŠ¥é”™ï¼ŒsayName is not a function è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ ç”±äºfå®ä¾‹æ˜¯åœ¨é‡å†™PersonåŸå‹ä¹‹å‰å°±å·²ç»æ„å»ºå‡ºæ¥äº†çš„ï¼Œå®ƒçš„[[Prototype]]æŒ‡é’ˆæŒ‡å‘çš„åŸå‹å¯¹è±¡æ˜¯ä¸€å¼€å§‹Personæ„é€ å‡½æ•°æ‰€æŒ‡å‘çš„ï¼Œé‚£æœ¬èº«å°±ä¸å­˜åœ¨sayNameè¿™ä¸ªæ–¹æ³•ï¼Œè¿™æ—¶å€™Personçš„åŸå‹è¢«è¦†ç›–äº†ï¼Œå’Œfä¸€ç‚¹å…³ç³»éƒ½æ²¡æœ‰ï¼› è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆä¸èƒ½ç”¨å®ä¾‹è®¿é—®constructoræ¥åˆ¤æ–­ç±»å‹æ ‡è¯†äº†å¾—ç”¨intanceof é‚£è¿™æ—¶å€™æ¥è§£å†³ä¸Šé¢æ‰‹åŠ¨èµ‹å€¼constructorçš„é—®é¢˜ å¦‚æœconstructorçš„å€¼å¾ˆé‡è¦ï¼Œå¯ä»¥åœ¨ä¸Šè¿°ä»£ç ä¸­åŠ å…¥ 1234567891011function Person()&#123; &#125;let f = new Person();Person.prototype = &#123; constructor: Person, name:&#x27;weng&#x27;, sayName()&#123; console.log(this.name); &#125;&#125; è¿™æ ·å°±å¯ ä½†æ˜¯åˆå­˜åœ¨ä¸ªé—®é¢˜ å’±ä»¬çŸ¥é“åŸå‹ä¸Šçš„constructorçš„å±æ€§æ˜¯ä¸å¯æšä¸¾çš„ï¼Œä¹Ÿå°±æ˜¯constructoræœ¬èº«è¿™ä¸ªå±æ€§çš„ç‰¹æ€§[[Enumberable]]ç‰¹æ€§æ˜¯falseï¼Œä½†æ˜¯è¿™æ ·å®šä¹‰çš„constructorå±æ€§æ˜¯å¯ä»¥æšä¸¾çš„ï¼Œé‚£è¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹çœ‹ é‚£ç¯‡ å¯¹è±¡å±æ€§ç‰¹æ€§çš„æ–‡ç« ï¼Œç„¶åå®šä¹‰è¿™ä¸ªå±æ€§","tags":["Javascript","é¢è¯•é¢˜","åŸå‹æ¨¡å¼"],"categories":["Javascript"]},{"title":"åˆ›å»ºå¯¹è±¡ä¹‹æ„é€ å‡½æ•°æ¨¡å¼","path":"/2021/05/28/åˆ›å»ºå¯¹è±¡ä¹‹æ„é€ å‡½æ•°æ¨¡å¼/","content":"ESä¸­çš„æ„é€ å‡½æ•°æ˜¯ç”¨æ¥åˆ›å»ºç‰¹ç‚¹ç±»å‹çš„å¯¹è±¡çš„ï¼ŒåƒObjectå’ŒArrayè¿™æ ·çš„åŸç”Ÿæ„é€ å‡½æ•°ï¼Œç›´æ¥å†ç¯å¢ƒä¸­èƒ½ç”¨ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ„é€ å‡½æ•° å°±å¾—è‡ªå®šä¹‰å±æ€§å’Œæ–¹æ³•äº† å®šä¹‰æ„é€ å‡½æ•°ä¾‹å¦‚ä¸‹é¢æ˜¯ä¸€ä¸ªå·¥å‚æ¨¡å¼çš„å‡½æ•°ï¼Œå°†ä»–æ”¹é€ æˆæ„é€ å‡½æ•°å½¢å¼ 123456789101112131415161718192021function createPerson(name, age)&#123; let o = new Object(); o.name = name; o.age = age; o.sayName = function()&#123; console.log(this.name); &#125; return o;&#125;// æ”¹æˆæ„é€ å‡½æ•°function Person(name,age)&#123; this.name = name; this.age = age; this.sayName = function()&#123; console.log(this.name) &#125;&#125;let per1 = new Person(&#x27;weng&#x27;, 20);per1.sayName(); // weng å½“ç„¶ä¹Ÿå¯ä»¥è¿™æ ·å®šä¹‰å’Œnewæ„é€ å‡½æ•° 12345let Person = function()&#123; .....&#125;let person1 = new Person; // ä¸ä¼ å‚å¯ä»¥ä¸åŠ æ‹¬å· å½“ç„¶æ„é€ å‡½æ•°ä¹Ÿæ˜¯å‡½æ•°ï¼Œè°ƒç”¨æ–¹å¼ä¹Ÿå¾ˆå¤š 12Person(&#x27;weng&#x27;, &#x27;23&#x27;); // è¿™ç§ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯è¿™æ ·æ„å»ºå‡ºæ¥çš„å®ä¾‹ä¼šè¢«æ·»åŠ åˆ°windowä¸Šå»window.sayName() // weng ä¹Ÿå¯ä»¥åœ¨å¦ä¸€ä¸ªå¯¹è±¡ä½œç”¨åŸŸä¸­è°ƒç”¨ 123let o = new Object();Person.call(o, &#x27;weng&#x27;, 23);o.sayName() // weng è¿™é‡Œè¦è®°ä½ï¼Œè°ƒç”¨ä¸€ä¸ªå‡½æ•°æ²¡æœ‰æ˜ç¡®çš„æŒ‡å®šthisçš„æƒ…å†µä¸‹ï¼ˆå³æ²¡æœ‰ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ï¼Œæˆ–æ²¡æœ‰ä½¿ç”¨callæˆ–è€…applyè½¬æ¢thisæŒ‡å‘çš„è¯ï¼Œthiså§‹ç»ˆæŒ‡å‘Globalå¯¹è±¡ï¼ˆæµè§ˆå™¨ä¸­å¼windowï¼‰ æ„é€ å‡½æ•°ä¸å·¥å‚æ¨¡å¼åŒºåˆ«åœ¨ä¸Šé¢ä¾‹å­ä¸­åªæ˜¯ç”¨Person()æ„é€ å‡½æ•°æ›¿ä»£äº†createPerson()å·¥å‚å‡½æ•°ã€‚å®é™…ä¸Šå†…éƒ¨æ˜¯å’ŒcreatePersonä¸€æ ·çš„ã€‚ åŒºåˆ«åœ¨äº æ²¡æœ‰æ˜¾ç¤ºçš„å»newä¸€ä¸ªobject å±æ€§å’Œæ–¹æ³•éƒ½ç›´æ¥èµ‹å€¼äº†this æ²¡æœ‰return 1. ä»¥newæ“ä½œç¬¦å»è°ƒç”¨æ„é€ å‡½æ•°ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œ åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ è¿™ä¸ªæ–°å¯¹è±¡å†…éƒ¨çš„[[Prototype]]ç‰¹æ€§è¢«èµ‹å€¼ä¸ºæ„é€ å‡½æ•°çš„prototype æ„é€ å‡½æ•°å†…éƒ¨çš„thisè¢«èµ‹å€¼ä¸ºè¿™ä¸ªæ–°å¯¹è±¡ï¼ˆå°±thisæŒ‡å‘äº†ç¬¬ä¸€æ­¥çš„æ–°å¯¹è±¡ï¼‰ æ‰§è¡Œæ„é€ å‡½æ•°å†…éƒ¨ä»£ç  å¦‚æœæ„é€ å‡½æ•°è¿”å›éç©ºå¯¹è±¡ï¼Œåˆ™è¿”å›è¯¥å¯¹è±¡ï¼›å¦è€…è¿”å›åˆšåˆ›å»ºçš„æ–°å¯¹è±¡ è¿™é‡Œå¦‚æœè¿”å›å€¼æ˜¯ä¸€ä¸ªéç©ºå¯¹è±¡ï¼Œé‚£è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºä¼šé»˜è®¤è¦†ç›–æ„é€ å‡½æ•°åœ¨ç¬¬å››æ­¥å¯¹åˆ›å»ºçš„å†…å­˜å¯¹è±¡è¿›è¡Œæ“ä½œå¾—å‡ºçš„è¡Œä¸ºï¼Œå¦‚æœè¿”å›å…¶ä»–ç±»å‹å€¼æ˜¯ä¸ä¼šçš„ï¼› è¿™å—è®¾è®¡åˆ°åŸå‹å’Œç»§æ‰¿æ–¹é¢çš„ä¸œè¥¿ï¼Œåœ¨åŸå‹ç»§æ‰¿é‚£è¾¹æ–‡ç« å¯ä»¥çœ‹ 2. è‡ªå®šä¹‰æ„é€ å‡½æ•°ç¡®ä¿å®ä¾‹è¢«æ ‡è¯†ä¸ºç‰¹å®šç±»å‹ç›¸æ¯”äºå·¥å‚æ¨¡å¼ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å¥½å¤„ ä¾‹å¦‚ï¼š 1234const person1 = new Person();console.log(person1.contructor == Person); // trueconsole.log(person1 instanceof Person) // true; åˆ›å»ºå‡ºæ¥çš„person1çš„protypeä¼šæŒ‡å‘å®ƒçš„åŸå‹å¯¹è±¡ï¼Œè¿™ä¸ªåŸå‹å¯¹è±¡é‡Œå¤´æœ‰ä¸ªå±æ€§å«åšcontructoræ˜¯å›æŒ‡å‘Personæ„é€ å‡½æ•°çš„ï¼Œå¯ä»¥ç”¨person.contructorå’Œperson1 instanceof Personæ¥åˆ¤æ–­ ç›¸å½“äºæœ‰ä¸ªæ ‡è¯†ï¼Œå‘Šè¯‰è¿™ä¸ªå®ä¾‹æ˜¯å“ªä¸ªæ„é€ å‡½æ•°åˆ›å»ºå‡ºæ¥çš„ ä½†æ˜¯ä¸€èˆ¬æ¥è¯´ç”¨instanceofæ¥åˆ¤æ–­å¯¹è±¡ç±»å‹æ˜¯æ›´å¯é çš„æ–¹å¼ æ„é€ å‡½æ•°çš„é—®é¢˜é—®é¢˜å¾ˆæ˜æ˜¾ å°±æ˜¯åœ¨å®ä¾‹ä¸Šå®šä¹‰çš„æ–¹æ³•ä¼šåœ¨åˆ›å»ºæ¯ä¸ªå®ä¾‹çš„æ—¶å€™éƒ½ä¼šå†å»åˆ›å»ºä¸€æ¬¡ 123let per1 = new Person();let per2 = new Person();console.log(per1.sayName === per2.sayName) // false å› ä¸ºéƒ½æ˜¯è°ƒç”¨åŒä¸€ç§è¡Œä¸ºçš„å‡½æ•°ï¼Œå¯èƒ½æœ‰äº›æ—¶å€™å‚æ•°ä¸åŒï¼Œä½†æ˜¯è¡Œä¸ºä¸€æ ·çš„å°±æ²¡å¿…è¦å†å»åˆ›å»ºä¸€ä¸ª è¿™ä¸ªæ—¶å€™ä¼šè€ƒè™‘æŠŠå…¬å…±å‡½æ•°æå‡ºå»åˆ°å¤–éƒ¨ 12345678function sayName()&#123; console.log(this.name)&#125;function Person(name,age)&#123; this.name = name; this.age = age; this.sayName = sayName;&#125; è¿™æ ·è§£å†³äº†ä¸é‡å¤åˆ›å»ºnew Functionçš„é—®é¢˜ï¼Œå› ä¸ºæ¯ä¸ªå®ä¾‹sayNameæŒ‡é’ˆéƒ½æ˜¯æŒ‡å‘å¤–éƒ¨åŒä¸€ä¸ªå‡½æ•°ï¼› ä½†æ˜¯è¿™æ ·ç¼ºé™·ä¹Ÿå¾ˆæ˜æ˜¾å•Š å…¨å±€ä½œç”¨åŸŸä¹±äº†ï¼Œå¦‚æœå†…éƒ¨æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œé‚£ä¸å¾—å†å…¨å±€å†åˆ›å»ºå¤šä¸ªå‡½æ•° æ‰€ä»¥è¿™æ—¶å€™éœ€è¦åŸå‹æ¨¡å¼ï¼Œå¦ä¸€ç¯‡æ–‡ç« çœ‹","tags":["Javascript","æ„é€ å‡½æ•°","new"],"categories":["Javascript","é¢è¯•é¢˜"]},{"title":"jsçš„ç±»å‹è½¬æ¢","path":"/2021/05/28/jsçš„ç±»å‹è½¬æ¢/","content":"è‡ªæˆ‘æ£€æµ‹1[] == ![] // -&gt; true Déƒ¨åˆ†æœ‰ç­”æ¡ˆ æ˜¾å¼ç±»å‹è½¬æ¢å’Œéšå¼ç±»å‹è½¬æ¢å¼ºåˆ¶è½¬æ¢ç»å¸¸å‘ç”Ÿåœ¨åŠ¨æ€ç±»å‹è¯­è¨€è¿è¡Œæ—¶ã€‚æˆ‘ä»¬ç»å¸¸ä¼šå†™ç±»å‹è½¬æ¢ï¼Œå¦‚ï¼š 123var a=1 var b=a+&#x27;&#x27; // éšå¼ &#x27;1&#x27;var c=String(a) // æ˜¾å¼ &#x27;1&#x27; è¿™é‡Œçš„éšå¼å’Œæ˜¾å¼æ˜¯ç›¸å¯¹äºå¼€å‘è€…è€Œè¨€çš„ã€‚å¯ä»¥ä»ä»£ç ä¸­çœ‹å‡ºæ¥ç±»å‹è½¬æ¢çš„æ˜¯æ˜¾å¼ï¼Œååˆ™ä¸ºéšå¼ã€‚ A.æŠ½è±¡å€¼æ“ä½œ1.ToStringéå­—ç¬¦ä¸²-&gt;å­—ç¬¦ä¸²ã€‚ åŸºæœ¬ç±»å‹12345null -&gt; &#x27;null&#x27;undefined -&gt; &#x27;undefined&#x27;true -&gt; &#x27;true&#x27;1 -&gt; &#x27;1&#x27;1 * 1 000 000 000 000 000 000 000 -&gt; &#x27;1e+21&#x27; å¤æ‚ç±»å‹å½“å¯¹è±¡æœ‰è‡ªå·±çš„toString()æ–¹æ³•ï¼Œå­—ç¬¦ä¸²åŒ–æ—¶å°±ä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œä½¿ç”¨å…¶è¿”å›å€¼ã€‚ 12345678const obj=&#123; a:&#x27;test&#x27;, toString()&#123; return &#x27;yeah~~&#x27; &#125;&#125;//æ²¡æœ‰è‡ªå®šä¹‰çš„toString()æ–¹æ³•åº”è¯¥è¿”å›[object Object]111ï¼Œconsole.log(obj+&#x27;111&#x27;) // yeah~~111 JSONå­—ç¬¦ä¸²åŒ–å¯¹äºå¤§å¤šæ•°ç®€å•å€¼æ¥è¯´ï¼ŒJSON.stringify()å’ŒtoString()çš„æ•ˆæœåŸºæœ¬ç›¸åŒï¼Œåºåˆ—åŒ–çš„ç»“æœæ€»æ˜¯å­—ç¬¦ä¸²ã€‚æœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„æƒ…å†µï¼š 1JSON.stringify(&#x27;hello&#x27;) // &quot;&quot;hello&quot;&quot; å«æœ‰åŒå¼•å·çš„å­—ç¬¦ä¸² å¯¹äºundefinedã€functionã€symbolæ¥è¯´ä¼šè¿”å›undefinedï¼Œåœ¨æ•°ç»„ä¸­è¿”å›nullã€åœ¨å¯¹è±¡ä¸­è‡ªåŠ¨å¿½ç•¥ã€‚ 1234JSON.stringify(undefined) // undefinedJSON.stringify(function()&#123;&#125;) // undefinedJSON.stringify([function()&#123;&#125;,2]) // &quot;[null,2]&quot;JSON.stringify(&#123;a:function()&#123;&#125;,b:2&#125;) // &quot;&#123;&quot;b&quot;:2&#125;&quot; 1234567const obj=&#123; a:&#x27;test&#x27;, toJSON()&#123; return &#x27;yeah~~&#x27; &#125;&#125;console.log(JSON.stringify(obj)) ç­”æ¡ˆï¼š 1&quot;yeah~~&quot; 2.ToNumberåŸºæœ¬ç±»å‹1234true -&gt; 1false -&gt; 0undefined -&gt; NaNnull -&gt; 0 å¤„ç†å­—ç¬¦ä¸²å¤±è´¥æ—¶è¿”å›NaNã€‚ å¤æ‚ç±»å‹å¯¹è±¡ï¼ˆåŒ…æ‹¬æ•°ç»„ï¼‰ï¼Œå…ˆè¢«è½¬æ¢ä¸ºç›¸åº”çš„åŸºæœ¬ç±»å‹å€¼ï¼Œå¦‚æœè¿”å›çš„æ˜¯éæ•°å­—çš„åŸºæœ¬ç±»å‹å€¼ï¼Œåˆ™æŒ‰ç…§ä¸Šé¢çš„è§„åˆ™å¼ºåˆ¶è½¬æ¢ä¸ºæ•°å­—ã€‚ å°†å€¼è½¬æ¢ä¸ºç›¸åº”çš„åŸºæœ¬ç±»å‹å€¼ï¼Œå…ˆæ£€æŸ¥è¯¥å€¼æ˜¯å¦æœ‰valueOf()æ–¹æ³•ï¼Œæœ‰å¹¶ä¸”è¿”å›åŸºæœ¬ç±»å‹å€¼ï¼Œåˆ™ä½¿ç”¨è¯¥å€¼è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼›æ²¡æœ‰å°±ä½¿ç”¨toString()çš„è¿”å›å€¼è¿›è¡Œå¼ºåˆ¶è½¬æ¢ã€‚å¦‚æœä»¥ä¸Šéƒ½ä¸è¿”å›åŸºç±»å‹å€¼ï¼Œäº§ç”ŸTypeErroré”™è¯¯ã€‚ 1234567const obj=&#123; toString()&#123; return &#x27;1&#x27; &#125;&#125;console.log(&#123;&#125;) // NaNconsole.log(Number(obj)) // 1 æ³¨æ„ä½¿ç”¨Object.create(null)åˆ›å»ºçš„å¯¹è±¡ï¼Œæ— æ³•è¿›è¡Œå¼ºåˆ¶è½¬æ¢ï¼æ˜¯å› ä¸ºå…¶[[Prototype]]ä¸ºç©ºï¼Œæ²¡æœ‰valueOf()å’ŒtoString()æ–¹æ³•ã€‚ 3.ToBooleanå‡å€¼ï¼ˆfalsy valueï¼‰jsä¸­çš„å€¼å¯è¢«åˆ†ä¸ºä¸¤ç±»ï¼šå¯è¢«å¼ºåˆ¶è½¬æ¢ä¸ºfalseçš„å€¼ï¼Œå’Œå…¶ä»–ï¼ˆå¯ä»¥è¢«å¼ºåˆ¶è½¬æ¢ä¸ºtrueçš„å€¼ï¼‰ã€‚ ä»¥ä¸‹è¿™äº›ä¸ºå‡å€¼ï¼š 12345undefinednullfasle+0 -0 NaN&quot;&quot; è™½ç„¶æ²¡æœ‰æ˜ç¡®è§„å®šï¼Œæˆ‘ä»¬å¯ä»¥é»˜è®¤é™¤äº†è¿™äº›å€¼ä»¥å¤–çš„æ‰€æœ‰å€¼ä¸ºçœŸå€¼ã€‚ B.æ˜¾å¼å¼ºåˆ¶ç±»å‹è½¬æ¢å­—ç¬¦ä¸²å’Œæ•°å­—ä¹‹é—´çš„æ˜¾å¼è½¬æ¢ä¸€èˆ¬é€šè¿‡String()å’ŒNumber()è¿™ä¸¤ä¸ªå†…å»ºå‡½æ•°å®ç°çš„ã€‚å¦‚ï¼š 12String(1) // &quot;1&quot;Number(&#x27;1.25&#x27;) // 1.25 é€šè¿‡ä¸€å…ƒè¿ç®—ç¬¦ä»¥åŠtoString()ä¹Ÿè¢«è®¤ä¸ºæ˜¯æ˜¾ç¤ºå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ 1+&#x27;25&#x27; // 25 æ—¥æœŸæ˜¾ç¤ºè½¬æ¢ä¸ºæ•°å­—ä¸€å…ƒè¿ç®—ç¬¦æœ‰ä¸€ä¸ªå¸¸ç”¨çš„ç”¨é€”æ˜¯ï¼Œå°†Dateå¯¹è±¡å¼ºåˆ¶è½¬æ¢ä¸ºUnixæ—¶é—´æˆ³ï¼Œå¦‚ï¼š 1+new Date() // 1516625381333 æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ›´æ˜¾å¼çš„æ–¹æ³•ï¼š 1new Date().getTime() // 1516625518125 æœ€å¥½è¿˜æ˜¯ä½¿ç”¨Date.now()æ¥è·å¾—å½“å‰çš„æ—¶é—´æˆ³ã€‚ ä½æ“ä½œç¬¦~~è¿ç®—ç¬¦ï¼ŒæŒ‰ä½éï¼Œåè½¬æ“ä½œç¬¦çš„æ¯”ç‰¹ä½ã€‚ä½æ“ä½œç¬¦ä¼šå¼ºåˆ¶æ“ä½œæ•°ä½¿ç”¨32ä½æ ¼å¼ï¼Œé€šè¿‡ToInt32å®ç°ï¼ˆToInt32å…ˆæ‰§è¡ŒToNUmberå¼ºåˆ¶è½¬æ¢ï¼Œä¹‹åå†æ‰§è¡ŒToInt32ï¼‰ã€‚å¦‚æœä½ ä¸å¤ªæ˜ç™½ä»–çš„è¿ç®—æœºåˆ¶ï¼Œè¯·è®°ä½ä¸€ä¸ªå…¬å¼ï¼š 12~4 -&gt; -5~x =&gt; -(x+1) ~åœ¨æ—¥å¸¸å¼€å‘ä¸­å¾ˆå°‘ä¼šç”¨åˆ°ï¼Œä½†åœ¨æˆ‘ä»¬å¤„ç†indexOf()æ—¶ï¼Œå¯ä»¥å°†ç»“æœå¼ºåˆ¶è½¬æ¢ä¸ºçœŸ/å‡å€¼ã€‚ 123const str=&#x27;hello&#x27;str.indexOf(&#x27;a&#x27;) // -1~str.indexOf(&#x27;a&#x27;) //0 -&gt; å‡å€¼ ~~xè¿˜å¯ä»¥ç”¨æ¥æˆªé™¤å°æ•°éƒ¨åˆ†ï¼Œå¦‚ï¼š 1~~-22.8 -&gt; -22 æ˜¾å¼è§£ææ•°å­—å­—ç¬¦ä¸²è§£æå’Œè½¬æ¢çš„åŒºåˆ«ä½¿ç”¨parseInt()å°†å­—ç¬¦ä¸²è§£æä¸ºæ•°å­—ï¼Œå®ƒä¸Numberçš„ä½œç”¨å¹¶ä¸ä¸€æ ·ï¼š parseIntåªèƒ½è§£æå­—ç¬¦ä¸²ï¼Œä¼ å…¥å…¶ä»–ç±»å‹å‚æ•°ï¼Œå¦‚trueã€function(){}ç­‰ï¼Œè¿”å›NaNã€‚ parseIntå¯ä»¥è§£æå«æœ‰éæ•°å­—å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œå¦‚parseInt(&#39;2px&#39;)å°†ä¼šè§£æä¸º2ï¼ŒNumberåˆ™ä¼šè¿”å›NaNã€‚ å¯¹äºparseIntæœ‰ä¸€ä¸ªç»å…¸çš„ä¾‹å­ï¼Œ 1parseInt(1/0,19) -&gt; 18 è¿™æ˜¯å› ä¸º1/0ä¸ºInfinityï¼Œå…ˆè¢«è½¬åŒ–ä¸ºå­—ç¬¦ä¸²&#39;Infinity&#39;ï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºiï¼Œåœ¨jsä¸­æœ‰æ•ˆæ•°å­—ä¸º09å’Œ0iï¼Œæ‰€ä»¥ä¹‹åçš„nä¸ä¼šè¢«è§£æï¼Œåªè§£æåˆ°iä¸ºæ­¢ï¼Œiä¸ºç¬¬18ä½ï¼Œæ‰€ä»¥è¾“å‡ºä¸º18. æ˜¾å¼è½¬æ¢ä¸ºå¸ƒå°”å€¼å’Œä¸Šé¢çš„Number(),String()ä¸€æ ·ï¼ŒBoolean()ä¸ºæ˜¾å¼çš„ToBooleanå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ä½†è¿™ä¸ªåœ¨å¼€å‘ä¸­å¹¶ä¸å¸¸ç”¨ï¼Œé€šå¸¸ä½¿ç”¨!!æ¥è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ åœ¨if()...ä¸Šä¸‹æ–‡ä¸­ï¼Œå¦‚æ²¡æœ‰ä½¿ç”¨Boolean()æˆ–!!è½¬æˆå¸ƒå°”å€¼ï¼Œåˆ™ä¼šè¿›è¡Œéšå¼è½¬æ¢ã€‚ä½†è¿˜æ˜¯å»ºè®®ä½¿ç”¨æ˜¾å¼è½¬æ¢ï¼Œè®©ä»£ç å¯è¯»æ€§æ›´é«˜ã€‚ C.éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢1.å­—ç¬¦ä¸²å’Œæ•°å­—ä¹‹é—´çš„éšå¼è½¬æ¢+/-æ“ä½œç¬¦+å¦‚ä½•åˆ¤æ–­æ˜¯è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¿˜æ˜¯æ•°å€¼åŠ æ³•å‘¢ï¼Ÿ +çš„å…¶ä¸­ä¸€ä¸ªæ“ä½œç¬¦ä¸ºå­—ç¬¦ä¸²ï¼ˆæˆ–æ˜¯é€šè¿‡ToPrimitiveæŠ½è±¡æ“ä½œåè½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„å€¼ï¼‰åˆ™è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¦åˆ™æ‰§è¡Œæ•°å­—åŠ æ³•ã€‚ æ‰€ä»¥ï¼Œé€šå¸¸ä¸Šæˆ‘ä»¬å°†ç©ºå­—ç¬¦ä¸²ä¸æ•°å€¼è¿›è¡Œæ‹¼æ¥ï¼Œå°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ 123const a=&#x27;2&#x27;const b=a-0b // -&gt; 2 é€šè¿‡-ä¹Ÿå¯å°†aå¼ºåˆ¶è½¬æ¢ä¸ºæ•°å­—ï¼Œæˆ–è€…ä½¿ç”¨a*1æˆ–a/1ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªè¿ç®—ç¬¦åªé€‚ç”¨äºæ•°å­—ï¼Œæ‰€ä»¥æ¯”è¾ƒå°‘è§ã€‚ 123const a=[1]const b=[3]a-b // -&gt; -2 2.éšå¼ç±»å‹è½¬æ¢ä¸ºå¸ƒå°”å€¼åœ¨ä»¥ä¸‹æƒ…å†µä¸­ï¼Œéå¸ƒå°”å€¼ä¼šè¢«éšå¼è½¬æ¢ä¸ºå¸ƒå°”å€¼ã€‚ if()ä¸­çš„åˆ¤æ–­è¡¨è¾¾å¼ for(;;)ä¸­çš„æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼ while(â€¦)å’Œdo..while(..)å¾ªç¯ä¸­çš„æ¡ä»¶è¡¨è¾¾å¼ ? : ä¸­çš„æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼ é€»è¾‘è¿ç®—ç¬¦ || å’Œ &amp;&amp; å·¦è¾¹çš„æ“ä½œæ•°ã€‚ ä½†&amp;&amp;å’Œ||è¿”å›çš„å€¼å¹¶ä¸ä¸€å®šæ˜¯å¸ƒå°”å€¼ï¼Œè€Œæ˜¯ä¸¤ä¸ªæ“ä½œä¹¦ä¸­å…¶ä¸­çš„ä¸€ä¸ªã€‚å¦‚ï¼š 1234123||&#x27;hello&#x27; // 12342&amp;&amp;&#x27;abc&#x27; // &#x27;abc&#x27;null || &#x27;hello&#x27; // -&gt;&#x27;hello&#x27;null &amp;&amp; &#x27;hello&#x27; // -&gt;null 3.Symbolçš„å¼ºåˆ¶ç±»å‹è½¬æ¢ES6å…è®¸ä»ç¬¦å·åˆ°å­—ç¬¦ä¸²å¾—æ˜¾ç¤ºç±»å‹è½¬æ¢ï¼Œä½†ä½¿ç”¨éšå¼è½¬æ¢ä¼šæŠ¥é”™ã€‚ 123const s1=Symbol(&#x27;test&#x27;)String(s1) -&gt; &quot;Symbol(test)&quot;&#x27;&#x27;+s1 -&gt; Uncaught TypeError: Cannot convert a Symbol value to a string åŒæ—¶ï¼ŒSymbolç±»å‹ä¹Ÿä¸èƒ½è¢«è½¬æ¢ä¸ºæ•°å­—ï¼ˆæ— è®ºæ˜¯æ˜¾å¼è¿˜æ˜¯éšå¼ï¼‰ï¼Œä½†å¯ä»¥è¢«è½¬æ¢ä¸ºå¸ƒå°”å€¼ã€‚ D.å®½æ¾ç›¸ç­‰ï¼ˆ == ï¼‰å’Œä¸¥æ ¼ç›¸ç­‰ï¼ˆ === ï¼‰==å…è®¸åœ¨ç›¸ç­‰æ¯”è¾ƒä¸­è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä½†===åˆ™ä¸å…è®¸ã€‚ å®½æ¾ç›¸ç­‰çš„è½¬æ¢è§„åˆ™ï¼ˆ==ï¼‰ å¯¹äºåŸºæœ¬ç±»å‹ï¼šä¸¤ä¸ªå€¼çš„ç±»å‹ç›¸åŒï¼Œåˆ™æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ã€‚ é™¤äº†NaNï¼ˆNaNæ˜¯jsä¸­å”¯ä¸€ä¸ç­‰äºè‡ªèº«çš„å€¼ï¼‰å’Œ+0/-0ï¼ˆ+0 === -0ï¼‰ã€‚ç±»å‹ä¸åŒçš„ä¸¤ä¸ªå€¼å‚è€ƒç¬¬ä¸‰æ¡ã€‚ å¯¹äºå¯¹è±¡ï¼ˆåŒ…æ‹¬å‡½æ•°å’Œæ•°ç»„ï¼‰ï¼šä»–ä»¬æŒ‡å‘åŒä¸€å¼•ç”¨æ—¶ï¼Œå³è§†ä¸ºç›¸ç­‰ï¼Œä¸å‘ç”Ÿå¼ºåˆ¶è½¬æ¢ã€‚ åœ¨æ¯”è¾ƒä¸¤ä¸ªä¸åŒç±»å‹çš„å€¼æ—¶ï¼Œä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ï¼Œå°†å…¶è½¬ä¸ºç›¸åŒçš„ç±»å‹åå†æ¯”è¾ƒã€‚ å­—ç¬¦ä¸²å’Œæ•°å­—ä¹‹é—´çš„ç›¸ç­‰æ¯”è¾ƒ1234const a=&#x27;12&#x27;const b=12a==b //truea===b //false è§„åˆ™ä¸ºï¼š==ä¸¤è¾¹ï¼Œå“ªè¾¹ä¸ºæ•°å€¼ç±»å‹ï¼Œåˆ™å¦ä¸€è¾¹è½¬ä¸ºæ•°å€¼ç±»å‹ã€‚ å…¶å®ƒç±»å‹å’Œå¸ƒå°”ç±»å‹ä¹‹é—´çš„ç›¸ç­‰æ¯”è¾ƒ123const a=&#x27;12&#x27;const b=truea==b // false aä¸ºçœŸå€¼ï¼Œä¸ºä»€ä¹ˆè¿”å›false å› ä¸ºåœ¨==ä¸¤è¾¹ï¼Œå“ªè¾¹ä¸ºå¸ƒå°”ç±»å‹ï¼Œå“ªè¾¹è½¬ä¸ºæ•°å€¼ç±»å‹ï¼ï¼ åŒæ ·ï¼Œa==falseä¹Ÿä¼šè¿”å›falseï¼Œå› ä¸ºè¿™é‡Œçš„å¸ƒå°”å€¼ä¼šè¢«å¼ºåˆ¶è½¬æ¢ä¸ºæ•°å­—0. nullå’Œundefinedä¹‹é—´çš„ç›¸ç­‰æ¯”è¾ƒåªè¦è®°ä½ï¼š 12null == undefined //truenull === undefined //false å¯¹è±¡å’Œéå¯¹è±¡ä¹‹é—´çš„ç›¸ç­‰æ¯”è¾ƒå¯¹äºå¸ƒå°”å€¼å’Œå¯¹è±¡ä¹‹é—´çš„æ¯”è¾ƒï¼Œå…ˆæŠŠå¸ƒå°”å€¼è½¬æ¢ä¸ºæ•°å€¼ç±»å‹ã€‚ æ•°å€¼æˆ–å­—ç¬¦ä¸²ä¸å¯¹è±¡ä¹‹é—´çš„æ¯”è¾ƒï¼Œå¯¹è±¡å…ˆä¼šè°ƒç”¨ToPromitiveæŠ½è±¡æ“ä½œï¼Œä¹‹åå†è½¬ä¸ºæ•°å€¼è¿›è¡Œæ¯”è¾ƒã€‚ 12345678910111213const a=12const b=[12]a==b //trueb-&gt;&#x27;12&#x27;-&gt;12const c=Object(null)c==null //fasle è¿™é‡Œcè¢«è½¬æ¢ä¸ºç©ºå¯¹è±¡&#123;&#125;const d=Object(undefined)d==undefined // fasle è¿™é‡Œdè¢«è½¬æ¢ä¸ºç©ºå¯¹è±¡&#123;&#125;const e=Object(NaN)e==NaN // fasle è¿™é‡Œeè¢«è½¬æ¢ä¸ºNumber(NaN) -&gt; NaN ä½†NaNä¸ç­‰äºè‡ªèº«ï¼Œæ‰€ä»¥ä¸ºfalse å‡ ä¸ªå…¸å‹çš„å‘123456789101112// å°å‘&quot;0&quot; == false // -&gt; true è¿™é‡Œfalseå…ˆè¢«è½¬ä¸º0ï¼Œ&quot;0&quot;ä¹Ÿä¼šè½¬ä¸º0ï¼Œæ‰€ä»¥ä¸ºtrue&quot;0&quot; == &quot;&quot; // -&gt; false ä¸¤ä¸ªéƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œç›´æ¥æ¯”è¾ƒ0 == &#x27;&#x27; // -&gt; true ç©ºå­—ç¬¦ä¸²ç›´æ¥è½¬ä¸º0false == [] // -&gt; true falseå…ˆè½¬ä¸º0ï¼›[]ç©ºæ•°ç»„è½¬ä¸º&#x27;&#x27;ï¼Œä¹‹åToNumberæ“ä½œè½¬ä¸º0// å¤§å‘[] == ![] // -&gt; true [] è¿™é‡Œ![]å…ˆè¢«å¼ºåˆ¶è½¬æ¢ä¸ºfalseï¼Œå˜æˆ[]ä¸fasleçš„æ¯”è¾ƒï¼Œä¹‹åfasle-&gt;0ï¼›[]-&gt;&#x27;&#x27;-&gt;0ï¼Œæ‰€ä»¥ä¸ºtrueã€‚2=[2] // -&gt; true [2]-&gt;&#x27;2&#x27;-&gt;2 æ‰€ä»¥ä¸ºtrue&#x27;&#x27;==[null] // true [null]-&gt;&#x27;&#x27;0==&#x27; &#x27; // -&gt; true &#x27; &#x27;-&gt;&#x27;&#x27;-&gt;0&#x27;true&#x27;==true // -&gt; false true-&gt;0;&#x27;true&#x27;-&gt;NaNï¼Œæ‰€ä»¥ä¸ºfalse å¦‚æœä½ è¿˜æ˜¯ä¸€å¤´é›¾æ°´çš„è¯ï¼Œè¯·ä»”ç»†é˜…è¯»Déƒ¨åˆ†è¿™å‡ ç§ç›¸äº’æ¯”è¾ƒçš„è§„åˆ™å’ŒCéƒ¨åˆ†çš„éšå¼ç±»å‹è½¬æ¢ã€‚åªè¦è®°ä½ï¼Œé‡åˆ°ä¸¤ä¸ªä¸åŒç±»å‹çš„å€¼ï¼Œè½¬æ¢ä¼˜å…ˆé¡ºåºä¸ºå¸ƒå°”å€¼&gt;å¯¹è±¡&gt;å­—ç¬¦ä¸²&gt;æ•°å­—ï¼›æ¯ä¸€æ­¥çš„è½¬æ¢åˆ°ç›¸åŒç±»å‹çš„å€¼å³åœæ­¢è½¬æ¢ï¼Œè¿›è¡Œæ¯”è¾ƒåˆ¤æ–­ã€‚ E.æŠ½è±¡å…³ç³»æ¯”è¾ƒå‡ºç°éå­—ç¬¦ä¸²å°±å…ˆè½¬ä¸ºæ•°å­—ç±»å‹ï¼›å¦‚æœä¸¤è€…éƒ½ä¸ºå­—ç¬¦ä¸²ï¼ŒæŒ‰ç…§å­—æ¯é¡ºåºæ¥æ¯”è¾ƒï¼Œå¦‚ï¼š 12[&#x27;22&#x27;]&lt;[&#x27;023&#x27;] // -&gt; false è¿™é‡Œå¹¶ä¸è½¬ä¸ºæ•°å­—ï¼Œ0åœ¨å­—æ¯é¡ºåºä¸Šå°äº2ï¼Œæ‰€ä»¥ä¸ºfalse22&lt;[&#x27;023&#x27;] // -&gt; true å¯¹äºå¯¹è±¡æ¥è¯´ï¼Œä¹ŸåŒæ ·æ˜¯è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå†è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚: 1234567const a=&#123;a:1&#125;const b=&#123;a:2&#125;a&gt;b // -&gt; falsea&lt;b // -&gt; falsea==b // -&gt; falsea&lt;=b // -&gt; truea&gt;=b // -&gt; true è¿™ä¸ªä¾‹å­æ¯”è¾ƒå¥‡æ€ªï¼Œè™½ç„¶ä»–ä»¬è½¬æˆå­—ç¬¦ä¸²éƒ½ä¸º[Object Object]ï¼Œä½†ä¸¤ä¸ªå¯¹è±¡çš„æ¯”è¾ƒå¹¶ä¸æ˜¯è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œè€Œæ˜¯çœ‹ä»–ä»¬çš„å¼•ç”¨æ˜¯å¦æŒ‡å‘åŒä¸€å€¼ã€‚è¿™é‡Œ&lt;=è¢«å¤„ç†ä¸º!&gt;ï¼Œæ‰€ä»¥ä¸ºtrueï¼› &gt;=åŒç†ã€‚","tags":["ç±»å‹è½¬æ¢","==","==="],"categories":["Javascript","é¢è¯•é¢˜"]},{"title":"é¢è¯•éœ€è¦çŸ¥é“ç‚¹","path":"/2021/05/28/é¢è¯•éœ€è¦çŸ¥é“ç‚¹/","content":"1.JS ç±»å‹æœ‰å“ªäº›ï¼Ÿ2.TCP,HTTP,CDN3.å¤§æ•°ç›¸åŠ ã€ç›¸ä¹˜ç®—æ³•é¢˜ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ bigintï¼Œå½“ç„¶å†åŠ ä¸Šå­—ç¬¦ä¸²çš„å¤„ç†ä¼šæ›´å¥½ã€‚4.NaNå¦‚ä½•åˆ¤æ–­5.instanceof` åŸç† âœ”6.æ‰‹å†™ instanceof âœ”7.ç±»å‹è½¬æ¢éšå¼è½¬æ¢å’Œå¼ºåˆ¶è½¬æ¢ âœ”8.this, ç®­å¤´å‡½æ•°9.é—­åŒ… âœ”10.new, æ‰‹å†™newï¼Œnewåšäº†å“ªäº›äº‹ï¼Ÿnew è¿”å›ä¸åŒç±»å‹çš„æ—¶å€™æ˜¯ä»€ä¹ˆè¡¨ç° âœ”11.ä½œç”¨åŸŸï¼Œä½œç”¨åŸŸé“¾ï¼Œå…¨å±€ä½œç”¨åŸŸï¼Œå‡½æ•°ä½œç”¨åŸŸï¼Œå—çº§ä½œç”¨åŸŸ âœ”12.åŸå‹ï¼ŒåŸå‹é“¾ï¼ŒåŸå‹ç»§æ‰¿ï¼Œ jsä¸­æ˜¯å¦‚ä½•å®ç°ç»§æ‰¿çš„ï¼Œé€šè¿‡åŸå‹å®ç°çš„ç»§æ‰¿å’Œclassæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæ‰‹å†™ä»»æ„ä¸€ç§åŸå‹ç»§æ‰¿ âœ”13.æ·±æ‹·è´ï¼Œæµ…æ‹·è´âœ”14.Promise** allã€race ï¼Œ ä½¿ç”¨allå®ç°å¹¶è¡Œéœ€æ±‚ï¼Œ æ‰‹å†™allçš„å®ç° é¡µé¢ä¸Šæœ‰ä¸‰ä¸ªæŒ‰é’®ï¼Œåˆ†åˆ«ä¸º Aã€Bã€Cï¼Œç‚¹å‡»å„ä¸ªæŒ‰é’®éƒ½ä¼šå‘é€å¼‚æ­¥è¯·æ±‚ä¸”äº’ä¸å½±å“ï¼Œæ¯æ¬¡è¯·æ±‚å›æ¥çš„æ•°æ®éƒ½ä¸ºæŒ‰é’®çš„åå­—ã€‚ è¯·å®ç°å½“ç”¨æˆ·ä¾æ¬¡ç‚¹å‡» Aã€Bã€Cã€Aã€Cã€B çš„æ—¶å€™ï¼Œæœ€ç»ˆè·å–çš„æ•°æ®ä¸º ABCACBã€‚ 15.async, await16.æµè§ˆå™¨æ¸²æŸ“ä¹Ÿé¡µé¢è¿‡ç¨‹å«ä¹‰æµè§ˆå™¨ç¼“å­˜ï¼ˆBrowser Cachingï¼‰æ˜¯ä¸ºäº†åŠ é€Ÿæµè§ˆï¼Œæµè§ˆå™¨åœ¨ç”¨æˆ·ç£ç›˜ä¸Šå²æœ€è¿‘è¯·æ±‚è¿‡çš„æ–‡æ¡£è¿›è¡Œå­˜å‚¨ï¼Œå½“ç”¨æˆ·å†æ¬¡è®¿é—®è¿™ä¸ªæ–‡æ¡£æ—¶ï¼Œæµè§ˆå™¨ä¼šä»æœ¬åœ°ç£ç›˜æ˜¾ç¤ºæ­¤æ–‡æ¡£ï¼Œä»è€Œæå‡é¡µé¢åŠ è½½é€Ÿç‡ã€‚ cacheçš„ä½œç”¨ å‡å°‘å»¶è¿Ÿï¼Œè®©ç½‘ç«™çš„è¿è¡Œé€Ÿåº¦æ›´å¿«ï¼Œå¸¦æ¥æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼› é¿å…ç½‘ç»œæ‹¥å¡ï¼Œå‡å°‘è¯·æ±‚é‡ï¼Œå‡å°‘è¾“å‡ºå¸¦å®½ï¼› å®ç°æ‰‹æ®µcache-controlä¸­çš„max-ageæ˜¯å®ç°å†…å®¹cacheçš„é‡è¦æ‰‹æ®µï¼Œå¸¸ç”¨çš„ç­–ç•¥æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š max-ageå’ŒETagçš„ç»„åˆï¼› ä»…max-ageï¼› max-ageå’ŒLast-Modifiedï¼ˆIf-Modified-Sinceï¼‰çš„ç»„åˆï¼› æ‹“å±•åœ¨æ­¤ï¼Œæ‹“å±•ä¸€ä¸‹æœ‰å…³å¼ºåˆ¶ç¼“å­˜ï¼ˆ200ï¼‰å’Œåå•†ç¼“å­˜ï¼ˆ304ï¼‰éƒ¨åˆ†çš„å†…å®¹ã€‚ å¼ºåˆ¶ç¼“å­˜ï¼ˆä¹Ÿç§°å¼ºç¼“å­˜ï¼‰ï¼ŒæŒ‡å½“æµè§ˆå™¨å»è¯·æ±‚æŸä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å°±åœ¨respone headeré‡Œé¢å¯¹è¯¥æ–‡ä»¶åšäº†ç¼“å­˜é…ç½®ã€‚å¼ºåˆ¶ç¼“å­˜ä¸ä¼šå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–èµ„æºï¼Œåœ¨chromeæ§åˆ¶å°çš„networké€‰é¡¹ä¸­å¯ä»¥çœ‹åˆ°è¯¥è¯·æ±‚è¿”å›200çš„çŠ¶æ€ç ; åå•†ç¼“å­˜ï¼šå¼ºåˆ¶ç¼“å­˜ç»™èµ„æºè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œåœ¨æœªè¿‡æœŸæ—¶ï¼Œå¯ä»¥è¯´æ˜¯ç»™ç”¨æˆ·è‡ªç»™è‡ªè¶³ç”¨çš„ã€‚ä½†æ˜¯å½“èµ„æºè¿‡æœŸæ—¶ï¼Œå°±éœ€è¦å»è¯·æ±‚æœåŠ¡å™¨ï¼Œè¿™æ—¶å€™è¯·æ±‚æœåŠ¡å™¨çš„è¿‡ç¨‹å°±å¯ä»¥è®¾ç½®æˆåå•†ç¼“å­˜ã€‚åå•†ç¼“å­˜å°±æ˜¯éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿›è¡Œäº¤äº’çš„ã€‚åå•†ç¼“å­˜å°†ç¼“å­˜ä¿¡æ¯ä¸­çš„Etagå’ŒLast-Modifiedé€šè¿‡è¯·æ±‚å‘ç»™æœåŠ¡å™¨ï¼Œç”±æœåŠ¡å™¨æ ¡éªŒï¼Œè¿”å›çŠ¶æ€ç 304æ—¶ï¼Œæµè§ˆå™¨å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ç¼“å­˜ã€‚ å…±åŒç‚¹ï¼š éƒ½æ˜¯ä»å®¢æˆ·ç«¯ä¸­è¯»å–æ•°æ®ï¼› åŒºåˆ«ï¼š å¼ºç¼“å­˜ä¸ä¼šå‘å‡ºè¯·æ±‚ï¼Œåå•†ç¼“å­˜ä¼šå‘å‡ºè¯·æ±‚ã€‚ ç¼“å­˜ä¸­headerï¼ˆå¤´éƒ¨ï¼‰çš„å‚æ•°ï¼š ï¼ˆ1ï¼‰ã€å¼ºåˆ¶ç¼“å­˜ï¼š Expiresï¼ˆå¸¸ç”¨ï¼‰ï¼šresponse headeré‡Œçš„è¿‡æœŸæ—¶é—´ï¼Œæµè§ˆå™¨å†æ¬¡åŠ è½½èµ„æºæ—¶ï¼Œå¦‚æœåœ¨è¿™ä¸ªè¿‡æœŸæ—¶é—´å†…ï¼Œåˆ™å‘½ä¸­å¼ºç¼“å­˜ã€‚ Cache-Controlï¼ˆå¸¸ç”¨ï¼‰ï¼šå½“å€¼è®¾ä¸ºmax-age=120æ—¶ï¼Œåˆ™ä»£è¡¨åœ¨è¿™ä¸ªè¯·æ±‚æ­£ç¡®è¿”å›æ—¶é—´ï¼ˆæµè§ˆå™¨ä¹Ÿä¼šè®°å½•ä¸‹æ¥ï¼‰çš„2åˆ†é’Ÿå†…å†æ¬¡åŠ è½½èµ„æºï¼Œå°±ä¼šå‘½ä¸­å¼ºç¼“å­˜ã€‚ no-cacheï¼šä¸ä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚éœ€è¦ä½¿ç”¨ç¼“å­˜åå•†ï¼Œæ¥éªŒè¯æ˜¯å¦è¿‡æœŸï¼› no-storeï¼šä¸å¯ç¼“å­˜ï¼› publicï¼šå®¢æˆ·ç«¯å’Œä»£ç†æœåŠ¡å™¨éƒ½å¯ç¼“å­˜ï¼› privateï¼šåªèƒ½æœ‰å®¢æˆ·ç«¯ç¼“å­˜ï¼› ï¼ˆ2ï¼‰ã€åå•†ç¼“å­˜ Etagï¼šå³æ–‡ä»¶hashï¼Œæ¯ä¸ªæ–‡ä»¶å”¯ä¸€ã€‚webæœåŠ¡å™¨å“åº”è¯·æ±‚æ—¶ï¼Œå‘Šè¯‰æµè§ˆå™¨å½“å‰èµ„æºåœ¨æœåŠ¡å™¨çš„å”¯ä¸€æ ‡è¯†ï¼ˆç”Ÿæˆè§„åˆ™ç”±æœåŠ¡å™¨å†³å®šï¼‰ï¼› If-None-Matchï¼šå½“èµ„æºè¿‡æœŸæ—¶ï¼ˆä½¿ç”¨Cache-Controlæ ‡è¯†çš„max-ageï¼‰ï¼Œå‘ç°èµ„æºå…·æœ‰Etagå£°æ˜ï¼Œåˆ™å†æ¬¡å‘webæœåŠ¡å™¨è¯·æ±‚æ—¶å¸¦ä¸Šå¤´If-None-Match ï¼ˆEtagçš„å€¼ï¼‰ã€‚webæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åå‘ç°æœ‰å¤´If-None-Match åˆ™ä¸è¢«è¯·æ±‚èµ„æºçš„ç›¸åº”æ ¡éªŒä¸²è¿›è¡Œæ¯”å¯¹ï¼Œå†³å®šæ˜¯å¦å‘½ä¸­åå•†ç¼“å­˜ï¼› Last-Modify/If-Modify-Sinceï¼šæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ï¼Œç²¾ç¡®åˆ°ç§’ã€‚æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚ä¸€ä¸ªèµ„æºçš„æ—¶å€™ï¼ŒæœåŠ¡å™¨è¿”å›çš„headerä¸­ä¼šåŠ ä¸ŠLast-Modifyï¼ŒLast-modifyæ˜¯ä¸€ä¸ªæ—¶é—´æ ‡è¯†è¯¥èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´ï¼›å½“æµè§ˆå™¨å†æ¬¡è¯·æ±‚è¯¥èµ„æºæ—¶ï¼Œrequestçš„è¯·æ±‚å¤´ä¸­ä¼šåŒ…å«If-Modify-Sinceï¼Œè¯¥å€¼ä¸ºç¼“å­˜ä¹‹å‰è¿”å›çš„Last-Modifyã€‚æœåŠ¡å™¨æ”¶åˆ°If-Modify-Sinceåï¼Œæ ¹æ®èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´åˆ¤æ–­æ˜¯å¦å‘½ä¸­ç¼“å­˜ï¼› ğŸŒˆğŸŒˆæ³¨æ„ï¼š Etagè¦ä¼˜äºLast-Modifiedï¼› åœ¨ä¼˜å…ˆçº§ä¸Šï¼ŒæœåŠ¡å™¨æ ¡éªŒä¼˜å…ˆè€ƒè™‘Etagï¼› åœ¨æ€§èƒ½ä¸Šï¼ŒEtagè¦é€ŠäºLast-Modifiedã€‚ 17.å¦‚ä½•æ€§èƒ½ä¼˜åŒ–18.CDN ä¼˜åŒ–æœ‰å“ªäº›ï¼Œ CDNæ˜¯ä»€ä¹ˆ19.webpack æ’ä»¶åŸç†ï¼Œå¦‚ä½•å†™ä¸€ä¸ªæ’ä»¶20.æ‰‹å†™ bind âœ”ã€reduce21.é˜²æŠ–æˆªæµ âœ”22.éå†æ ‘ï¼Œæ±‚æ ‘çš„æœ€å¤§å±‚æ•°ã€‚æ±‚æŸå±‚æœ€å¤šçš„èŠ‚ç‚¹æ•°23.å‰ç«¯æ¨¡å—åŒ–çš„ç†è§£24.éšå¼è½¬æ¢25.æ•°å­—åœ¨è®¡ç®—æœºæ€ä¹ˆå‚¨å­˜çš„26.çŸ¥é“ä»€ä¹ˆæ˜¯äº‹ä»¶å§”æ‰˜å—ï¼Ÿæ¦‚å¿µï¼š äº‹ä»¶å†’æ³¡æ˜¯æŒ‡åµŒå¥—æœ€æ·±çš„å…ƒç´ è§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œç„¶åè¿™ä¸ªäº‹ä»¶é¡ºç€åµŒå¥—é¡ºåºåœ¨çˆ¶å…ƒç´ ä¸Šè§¦å‘ã€‚è€Œäº‹ä»¶å§”æ‰˜ï¼Œæ˜¯åˆ©ç”¨äº‹ä»¶å†’æ³¡åŸç†ï¼Œè®©è‡ªå·±æ‰€è§¦å‘çš„äº‹ä»¶ï¼Œè®©å…¶çˆ¶å…ƒç´ ä»£æ›¿æ‰§è¡Œã€‚ å†’æ³¡é˜»æ­¢æ–¹å¼ï¼šä½¿ç”¨event.cancelBubble = trueæˆ–è€…event.stopPropgation()ï¼ˆä½äºIE9ï¼‰ã€‚ é»˜è®¤äº‹ä»¶é˜»æ­¢æ–¹å¼ï¼š e.preventDefault();æˆ–return false;ã€‚ 27.windowçš„onloadäº‹ä»¶å’Œdomcontentloadedè°å…ˆè°åï¼Ÿ28.macrotask å’Œ microtask29.æµè§ˆå™¨ç¼“å­˜,HTTPç¼“å­˜ å¯¹æ¯”ç¼“å­˜ï¼Ÿå¼ºç¼“å­˜ï¼Ÿå¯¹åº”è¯·æ±‚å¤´30.commonjså’Œesmodule31.xssæ”»å‡»å’Œcsrfæ”»å‡»32.æ—¶é’ˆå’Œåˆ†é’ˆçš„å¤¹è§’33.Javascriptçš„äº‹ä»¶æµæ¨¡å‹éƒ½æœ‰ä»€ä¹ˆâ€œäº‹ä»¶å†’æ³¡â€ï¼š å½“è§¦å‘ä¸€ä¸ªèŠ‚ç‚¹çš„äº‹ä»¶æ—¶ï¼Œä¼šä»å½“å‰èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡è§¦å‘å…¶ç¥–å…ˆèŠ‚ç‚¹çš„åŒç±»å‹äº‹ä»¶ï¼Œç›´åˆ°DOMæ ¹èŠ‚ç‚¹ã€‚ï¼ˆé€çº§å‘ä¸Šï¼‰ â€œäº‹ä»¶æ•è·â€ï¼š å½“è§¦å‘ä¸€ä¸ªèŠ‚ç‚¹çš„äº‹ä»¶æ—¶ï¼Œä¼šä»DOMæ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡è§¦å‘å…¶ç¥–å…ˆèŠ‚ç‚¹çš„åŒç±»å‹äº‹ä»¶ï¼Œç›´åˆ°å½“å‰èŠ‚ç‚¹è‡ªèº«ã€‚ï¼ˆé€çº§å‘ä¸‹ï¼‰ â€œDOMäº‹ä»¶æµâ€ï¼š domåŒæ—¶æ”¯æŒä¸¤ç§äº‹ä»¶æ¨¡å‹ï¼Œä½†æ•è·æ€§äº‹ä»¶å…ˆå¼€å§‹ï¼Œä»documentå¼€å§‹ä¹Ÿç»“æŸäºdocumentï¼Œdomæ¨¡å‹çš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºæ–‡æœ¬ä¹Ÿå¯ä»¥è§¦å‘äº‹ä»¶ã€‚ç®€å•çš„è¯´åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šäº‹ä»¶æ•æ‰ï¼Œ ç›®æ ‡é˜¶æ®µï¼Œ äº‹ä»¶å†’æ³¡ 34.jså»¶è¿ŸåŠ è½½çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿdeferå±æ€§ï¼ˆé¡µé¢loadåæ‰§è¡Œï¼‰ï¼šè„šæœ¬ä¼šè¢«å»¶è¿Ÿåˆ°æ•´ä¸ªé¡µé¢éƒ½è§£æå®Œæ¯•ä¹‹åå†æ‰§è¡Œã€‚è‹¥æ˜¯è®¾ç½®äº†deferå±æ€§ï¼Œå°±ç­‰äºå‘Šè¯‰æµè§ˆå™¨ç«‹å³ä¸‹è½½ï¼Œä½†æ˜¯ä¼šå»¶è¿Ÿæ‰§è¡Œã€‚æ³¨æ„deferå±æ€§åªé€‚ç”¨äºå¤–éƒ¨è„šæœ¬æ–‡ä»¶ã€‚ async å±æ€§ï¼ˆé¡µé¢loadå‰æ‰§è¡Œï¼‰ï¼šä¸ºäº†ä¸è®©é¡µé¢ç­‰å¾…è„šæœ¬ä¸‹è½½å’Œæ‰§è¡Œï¼Œå¼‚æ­¥åŠ è½½é¡µé¢å’Œå…¶ä»–å†…å®¹ã€‚asyncåŒæ ·ä¹Ÿåªé€‚ç”¨äºå¤–éƒ¨æ–‡ä»¶ï¼ˆä¸ä¼šå½±å“é¡µé¢åŠ è½½ï¼Œä½†æ˜¯ä¸èƒ½æ§åˆ¶åŠ è½½çš„é¡ºåºï¼‰ã€‚ åŠ¨æ€åˆ›å»ºDOMæ–¹å¼ï¼› ä½¿ç”¨jQueryçš„getScript()æ–¹æ³•ï¼› ä½¿ç”¨setTimeoutå»¶è¿Ÿæ–¹æ³•ï¼› è®©jsæ–‡ä»¶æœ€ååŠ è½½ã€‚ 35.Cookieåœ¨å®¢æˆ·æœºä¸Šæ˜¯å¦‚ä½•å­˜å‚¨çš„cookiesæ˜¯æœåŠ¡å™¨æš‚æ—¶æ”¾åœ¨æˆ‘ä»¬ç”µè„‘é‡Œçš„æ–‡æœ¬æ–‡ä»¶ï¼Œå¥½è®©æœåŠ¡å™¨æ¥è¾¨è®¤æˆ‘ä»¬çš„è®¡ç®—æœºã€‚ å½“æˆ‘ä»¬åœ¨æµè§ˆç½‘ç«™çš„æ—¶å€™ï¼ŒwebæœåŠ¡å™¨ä¼šå…ˆå‘é€å°éƒ¨åˆ†èµ„æ–™æ”¾åœ¨æˆ‘ä»¬çš„è®¡ç®—æœºä¸­ï¼Œcookiesä¼šå¸®åŠ©æˆ‘ä»¬ï¼Œå°†æˆ‘ä»¬åœ¨ç½‘ç«™ä¸Šæ‰“å°çš„æ–‡å­—æˆ–ä¸€äº›é€‰æ‹©è®°å½•ä¸‹æ¥ï¼Œå½“æˆ‘ä»¬å†æ¬¡è®¿é—®åŒä¸€ä¸ªç½‘ç«™ï¼ŒwebæœåŠ¡å™¨ä¼šå…ˆæ£€æŸ¥æœ‰æ²¡æœ‰å®ƒä¸Šæ¬¡ç•™ä¸‹çš„cookiesèµ„æ–™ã€‚ è‹¥æœ‰ï¼Œä¼šä¾æ®cookiesé‡Œé¢çš„å†…å®¹æ¥åˆ¤æ–­ä½¿ç”¨è€…ï¼Œä»è€Œç»™æˆ‘ä»¬æ¨å‡ºç›¸åº”çš„ç½‘é¡µå†…å®¹ã€‚ 36.DOMå’ŒBOMæ˜¯ä»€ä¹ˆé¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼šjavascriptæ˜¯ç”±ECMAScriptï¼ŒDOMï¼ŒBOMä¸‰éƒ¨åˆ†æ„æˆçš„ã€‚ ECMAScriptæ˜¯ä¸€ç§è¯­è¨€ï¼Œæ˜¯å¯¹è§„å®šçš„è¯­æ³•ï¼Œæ“ä½œï¼Œå…³é”®å­—ï¼Œè¯­å¥çš„ä¸€ä¸ªæè¿°ï¼Œjavascriptå®ç°äº†ECMAScript; DOMæ˜¯æ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼ŒåŒ…æ‹¬äº†è·å–å…ƒç´ ï¼Œä¿®æ”¹æ ·å¼ä»¥åŠæ“ä½œå…ƒç´ ç­‰ä¸‰æ–¹é¢çš„å†…å®¹ï¼Œä¹Ÿæ˜¯é€šå¸¸æˆ‘ä»¬ç”¨çš„æœ€å¤šçš„æ“ä½œï¼Œå…¶æä¾›äº†å¾ˆå¤šå…¼å®¹æ€§çš„å†™æ³•ï¼› BOMæ˜¯æµè§ˆå™¨å¯¹è±¡æ¨¡å‹ï¼ŒåŒ…æ‹¬æµè§ˆå™¨çš„ä¸€äº›æ“ä½œï¼Œwindow.onload, window.openç­‰è¿˜æœ‰æµè§ˆå™¨æ—¶é—´ï¼Œç›‘å¬çª—å£çš„æ”¹å˜onresizeï¼Œç›‘å¬æ»šåŠ¨äº‹ä»¶onscrollç­‰ï¼› 37.å¦‚ä½•å®ç°å¤šä¸ªæ ‡ç­¾ä¹‹é—´çš„é€šä¿¡ è°ƒç”¨ localStorageï¼› ï¼ˆ1ï¼‰ã€åœ¨ä¸€ä¸ªæ ‡ç­¾å†…ä½¿ç”¨localStorageã€‚setItem(key, value)æ·»åŠ ï¼ˆåˆ é™¤æˆ–ä¿®æ”¹ï¼‰å†…å®¹ï¼› ï¼ˆ2ï¼‰ã€åœ¨å¦ä¸€ä¸ªæ ‡ç­¾é¡µé¢ç›‘å¬storageäº‹ä»¶ï¼› ï¼ˆ3ï¼‰ã€å¾—åˆ°localStorageå­˜å‚¨çš„å€¼ï¼Œå³å¯å®ç°ä¸ç”¨é¡µé¢ä¹‹é—´çš„é€šä¿¡ã€‚ è°ƒç”¨ cookie+setInterval()ï¼› ï¼ˆ1ï¼‰ã€å°†è¦ä¼ é€’çš„ä¿¡æ¯å­˜å‚¨åœ¨cookieä¸­ï¼Œå¯ä»¥è®¾ç½®å®šæ—¶è¯»å–cookieçš„ä¿¡æ¯ï¼Œå³å¯éšæ—¶è·å–æƒ³è¦ä¼ é€’çš„ä¿¡æ¯ã€‚ ä½¿ç”¨ Webworkerï¼› ï¼ˆ1ï¼‰ã€webworkerä½œä¸ºæµè§ˆå™¨çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªé¢å¤–çš„çº¿ç¨‹æ¥æ‰§è¡Œä¸€äº›jsä»£ç ï¼Œå¹¶ä¸”å¯¹æµè§ˆå™¨ç”¨æˆ·ç•Œé¢ä¸å½±å“ï¼› ï¼ˆ2ï¼‰ã€æ™®é€šçš„Webworkerç”¨ new worker()å³å¯åˆ›å»ºï¼Œè¿™ç§webworkeræ˜¯å½“å‰é¡µé¢ä¸“æœ‰çš„ã€‚ç„¶åè¿˜æœ‰ç§å…±äº«worker(SharedWorker)ï¼Œè¿™ç§æ˜¯å¯ä»¥å¤šä¸ªæ ‡ç­¾é¡µã€iframeå…±åŒä½¿ç”¨ï¼› ä½¿ç”¨ SharedWorkerï¼› ï¼ˆ1ï¼‰ã€SharedWorkerå¯ä»¥è¢«å¤šä¸ªwindowå…±åŒä½¿ç”¨ï¼Œä½†å¿…é¡»ä¿è¯è¿™äº›æ ‡ç­¾é¡µéƒ½æ˜¯åŒæºçš„(ç›¸åŒçš„åè®®ï¼Œä¸»æœºå’Œç«¯å£å·)ï¼› 38. jsåƒåœ¾å›æ”¶çš„å‡ ç§æ–¹å¼javascriptå…·æœ‰è‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œåƒåœ¾å™¨å›æ”¶ä¼šæŒ‰ç…§å›ºå®šçš„æ—¶é—´é—´éš”å‘¨æœŸæ€§çš„æ‰§è¡Œã€‚ å¸¸è§çš„åƒåœ¾å›æ”¶æœºåˆ¶æœ‰ä¸¤ç§ï¼š æ ‡è®°æ¸…é™¤ï¼Œå¼•ç”¨è®¡æ•°ã€‚ æ ‡è®°æ¸…é™¤åŸç†ï¼š å½“å˜é‡è¿›å…¥ç¯å¢ƒæ—¶ï¼Œå°†è¿™ä¸ªå˜é‡æ ‡è®°ä¸ºâ€œè¿›å…¥ç¯å¢ƒâ€ã€‚å½“å˜é‡ç¦»å¼€æ—¶ï¼Œåˆ™å°†å…¶æ ‡è®°ä¸ºâ€œç¦»å¼€ç¯å¢ƒâ€ã€‚æ ‡è®°â€œç¦»å¼€ç¯å¢ƒâ€çš„å°±å›æ”¶å†…å­˜ã€‚ å·¥ä½œæµç¨‹ï¼š åƒåœ¾å›æ”¶å™¨ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™ä¼šç»™å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ‰€æœ‰å˜é‡éƒ½åŠ ä¸Šæ ‡è®°ï¼› å»æ‰ç¯å¢ƒä¸­çš„å˜é‡ä»¥åŠè¢«ç¯å¢ƒä¸­çš„å˜é‡å¼•ç”¨çš„å˜é‡çš„æ ‡è®°ï¼› å†è¢«åŠ ä¸Šæ ‡è®°çš„ä¼šè¢«è§†ä¸ºå‡†å¤‡åˆ é™¤çš„å˜é‡ï¼› åƒåœ¾å›æ”¶å™¨å®Œæˆå†…å­˜æ¸…é™¤å·¥ä½œï¼Œé”€æ¯é‚£äº›å¸¦æ ‡è®°çš„å€¼å¹¶å›æ”¶ä»–ä»¬æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼› å¼•ç”¨è®¡æ•°åŸç†ï¼š è·Ÿè¸ªè®°å½•æ¯ä¸ªå€¼è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼Œå£°æ˜ä¸€ä¸ªå˜é‡ï¼Œå¹¶å°†å¼•ç”¨ ç±»å‹èµ‹å€¼ç»™è¿™ä¸ªå˜é‡ï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°+1ï¼Œå½“å˜é‡çš„å€¼å˜æˆäº†å¦ä¸€ä¸ªï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°-1ï¼Œå½“å€¼çš„å¼•ç”¨æ¬¡æ•°ä¸º0çš„æ—¶å€™ï¼Œå°±å›æ”¶ã€‚ å·¥ä½œæµç¨‹ï¼š å£°æ˜äº†ä¸€ä¸ªå˜é‡å¹¶å°†ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å€¼èµ‹å€¼ç»™è¿™ä¸ªå˜é‡ï¼Œè¿™ä¸ªå¼•ç”¨å€¼çš„å¼•ç”¨æ¬¡æ•°å°±æ˜¯1ï¼› åŒä¸€ä¸ªå€¼åˆè¢«èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå¼•ç”¨ç±»å‹å€¼æ­¤æ—¶çš„å¼•ç”¨æ¬¡æ•°+1ï¼› å½“åŒ…å«è¿™ä¸ªå¼•ç”¨ç±»å‹å€¼çš„å˜é‡åˆè¢«èµ‹å€¼æˆå¦ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼•ç”¨å‘¢æ€§å€¼çš„å¼•ç”¨æ¬¡æ•°-1ï¼› å½“å¼•ç”¨æ¬¡æ•°å˜æˆ0æ—¶ï¼Œè¯´æ˜ç›®å‰æ— æ³•è®¿é—®æ­¤å€¼ï¼› å½“åƒåœ¾æ”¶é›†å™¨ä¸‹ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œå®ƒä¼šé‡Šæ”¾å¼•ç”¨æ¬¡æ•°æ˜¯0çš„å€¼æ‰€å çš„å†…å­˜ï¼› 39.åœ¨æµè§ˆå™¨ä¸­è¾“å…¥URLåˆ°æ•´ä¸ªé¡µé¢æ˜¾ç¤ºåœ¨ç”¨æˆ·é¢å‰æ—¶è¿™ä¸ªè¿‡ç¨‹ä¸­åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼ˆ1ï¼‰ã€DNSè§£æ æ£€æŸ¥æµè§ˆå™¨è‡ªèº«çš„DNSç¼“å­˜ï¼› è‹¥æ²¡æœ‰ï¼Œæœç´¢æ“ä½œç³»ç»Ÿè‡ªèº«çš„DNSç¼“å­˜ï¼› è‹¥æ²¡æœ‰ï¼Œå°è¯•è¯»å–hostsæ–‡ä»¶ï¼› è‹¥æ²¡æœ‰ï¼Œå¯å‘æœ¬åœ°é…ç½®çš„é¦–é€‰DNSæœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼› .winç³»ç»Ÿè‹¥æ²¡æœ‰å¥½åˆ°ï¼Œå¯ä»¥æ“ä½œç³»ç»ŸæŸ¥æ‰¾NetBIOS name cacheæˆ–æŸ¥è¯¢winsæœåŠ¡å™¨æˆ–å¹¿æ’­æŸ¥æ‰¾æˆ–è¯»å–LMHOSTSæ–‡ä»¶ï¼› ï¼ˆè‹¥ä»¥ä¸Šéƒ½æ²¡æœ‰ï¼Œåˆ™è§£æå¤±è´¥ï¼‰ ï¼ˆ2ï¼‰ã€TCPä¸‰æ¬¡æ¡æ‰‹ ï¼ˆ3ï¼‰ã€æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€httpè¯·æ±‚ ä¸€æ—¦å»ºç«‹äº†TCPé“¾æ¥ï¼Œwebæµè§ˆå™¨å°±ä¼šå‘webæœåŠ¡å™¨å‘é€è¯·æ±‚å‘½ä»¤ã€‚ ï¼ˆ4ï¼‰ã€æµè§ˆå™¨å‘é€è¯·æ±‚å¤´ä¿¡æ¯ æµè§ˆå™¨å‘é€å…¶è¯·æ±‚å‘½ä»¤ä¹‹åï¼Œè¿˜è¦ä»¥å¤´ä¿¡æ¯çš„å½¢å¼æƒ³webæœåŠ¡å™¨å‘é€ä¸€äº›åˆ«çš„ä¿¡æ¯ï¼Œä¹‹åæµè§ˆå™¨å‘é€äº†ä¸€ç©ºç™½è¡Œå¼€é€šçŸ¥æœåŠ¡å™¨ï¼Œå®ƒå·²ç»ç»“æŸäº†è¯¥å¤´ä¿¡æ¯çš„å‘é€ã€‚ ï¼ˆ5ï¼‰ã€æœåŠ¡å™¨å¤„ç†è¯·æ±‚ æœåŠ¡å™¨æ”¶åˆ°httpè¯·æ±‚ä¹‹åï¼Œç¡®å®šç”¨ç›¸åº”çš„ä¸€çœ¼æ¥å¤„ç†è¯·æ±‚ã€‚è¯»å–å‚æ•°å¹¶è¿›è¡Œé€»è¾‘æ“ä½œåï¼Œç”ŸæˆæŒ‡å®šçš„æ•°æ®ã€‚ ï¼ˆ6ï¼‰ã€æœåŠ¡å™¨åšå‡ºå“åº” å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚åï¼ŒæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯åšå‡ºåº”ç­”ã€‚ ï¼ˆ7ï¼‰ã€æœåŠ¡å™¨å‘é€åº”ç­”å¤´ä¿¡æ¯ æ­£å¦‚å®¢æˆ·ç«¯ä¼šéšåŒè¯·æ±‚å‘é€å…³äºè‡ªèº«çš„ä¿¡æ¯ä¸€æ ·ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šéšåŒåº”ç­”å‘ç”¨æˆ·å‘é€å…³äºå®ƒè‡ªå·±çš„æ•°æ®ä»¥åŠè¢«è¯·æ±‚çš„æ–‡æ¡£ã€‚ ï¼ˆ8ï¼‰ã€æœåŠ¡å™¨å‘é€æ•°æ® webæœåŠ¡å™¨å‘æµè§ˆå™¨å‘é€ä¿¡æ¯åï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªç©ºç™½è¡Œæ¥è¡¨ç¤ºå¤´ä¿¡æ¯çš„å‘é€åˆ°æ­¤ç»“æŸã€‚æ¥ç€ï¼Œå®ƒä¼šä»¥Content-Typeåº”ç­”å¤´ä¿¡æ¯æ‰€æè¿°çš„æ ¼å¼å‘é€ç”¨æˆ·æ‰€è¯·æ±‚çš„å®é™…æ•°æ®ã€‚ ï¼ˆ9ï¼‰ã€ TCPå…³é—­ï¼ˆå››æ¬¡æŒ¥æ‰‹ï¼‰ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€æ—¦webæœåŠ¡å™¨å‘æµè§ˆå™¨å‘é€äº†è¯·æ±‚æ•°æ®ï¼Œå®ƒå°±è¦å…³é—­tcpé“¾æ¥ã€‚å¦‚æœæµè§ˆå™¨æˆ–æœåŠ¡å™¨åœ¨å…¶å¤´ä¿¡æ¯åŠ å…¥äº†Connection:keep-alive,åˆ™ä¼šä¿æŒé•¿è¿æ¥çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯TCPé“¾æ¥åœ¨å‘é€åä»ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œæµè§ˆå™¨å¯ä»¥ç»§ç»­é€šè¿‡ä»™ç«¥çš„é“¾æ¥å‘é€è¯·æ±‚ã€‚ ï¼ˆä¼˜ç‚¹ï¼šä¿æŒé“¾æ¥èŠ‚çœäº†ä¸ºæ¯ä¸ªè¯·æ±‚å»ºç«‹æ–°é“¾æ¥æ‰€å±çš„æ—¶é—´ï¼Œè¿˜èŠ‚çº¦äº†ç½‘ç»œå®½å¸¦ ï¼‰","tags":["Javascript","é¢è¯•"],"categories":["é¢è¯•é¢˜"]},{"title":"jså¯¹è±¡å±æ€§è¯¦è§£","path":"/2021/05/27/jså¯¹è±¡å±æ€§è¯¦è§£/","content":"ECMA-262ä½¿ç”¨ä¸€äº›å†…éƒ¨ç‰¹æ€§æ¥æè¿°å±æ€§çš„ç‰¹å¾ã€‚è¿™äº›ç‰¹å¾æ˜¯ç”±ä¸ºjså®ç°å¼•æ“çš„è§„èŒƒå®šä¹‰çš„ï¼Œå¼€å‘è€…åœ¨jsä¸­ä¸èƒ½ç›´æ¥è®¿é—®è¿™äº›ç‰¹æ€§ï¼Œæè¿°å†…éƒ¨ç‰¹æ€§ï¼Œä¸€èˆ¬ä¼šæŠŠè¿™ä¸ªç‰¹æ€§æ‹¬èµ·æ¥ç±»ä¼¼è¿™æ ·[[Enumerable]] å±æ€§çš„ç±»å‹å±æ€§åˆ†ä¸¤ç§ æ•°æ®å±æ€§ è®¿é—®å™¨å±æ€§ 1. æ•°æ®å±æ€§æ•°å€¼å±æ€§åŒ…å«ä¸€ä¸ªä¿å­˜æ•°æ®å€¼çš„ä½ç½®ã€‚ ä»¥ä¸‹æœ‰4ç§ç‰¹æ€§æè¿°ä»–ä»¬çš„è¡Œä¸º [[Configurable]]ï¼š è¡¨ç¤ºå±æ€§ä»¥ä¸‹ç‰¹æ€§ã€‚ï¼ˆé»˜è®¤æƒ…å†µä¸‹æ˜¯trueï¼‰ æ˜¯å¦å¯ä»¥é€šè¿‡ deleteåˆ é™¤å¹¶ä¸”é‡æ–°å®šä¹‰ å¯ä»¥ä¿®æ”¹ä»–çš„ç‰¹æ€§ æ˜¯å¦å¯ä»¥æŠŠå®ƒæ”¹ä¸ºè®¿é—®å™¨å±æ€§ [[Enumberable]]ï¼šè¡¨ç¤ºå±æ€§ã€‚ï¼ˆé»˜è®¤æƒ…å†µæ˜¯trueï¼‰ æ˜¯å¦å¯ä»¥é€šè¿‡ for-inå¾ªç¯è¿”å› [[Writable]]ï¼šè¡¨ç¤ºè¿™ä¸ªå±æ€§çš„å€¼æ˜¯å¦å¯ä»¥è¢«ä¿®æ”¹å‘¢ï¼Œé»˜è®¤æƒ…å†µä¸ºtrue [[Value]]ï¼šåŒ…å«å±æ€§å®é™…çš„å€¼ã€‚ï¼ˆè¿™ä¸ªå°±æ˜¯æ•°æ®å±æ€§ä¿å­˜æ•°æ®å€¼çš„ä½ç½®ï¼Œå€¼ä¼šä»è¿™ä¸ªä½ç½®è¯»å–ï¼Œä»¥åŠå†™å…¥ï¼‰é»˜è®¤å€¼æ˜¯undefined 1. ä¿®æ”¹å±æ€§çš„é»˜è®¤ç‰¹æ€§ä¾‹å¦‚ï¼š 12345let person = &#123;\tname: &#x27;weng&#x27;&#125;// è¿™é‡Œnameå±æ€§çš„ç‰¹æ€§[[Value]]å°±ä¼šè¢«èµ‹å€¼ä¸º weng// è€Œå…¶ä»–çš„ç‰¹æ€§é»˜è®¤éƒ½æ˜¯ä¸ºtrue å‡å¦‚è¦ ä¿®æ”¹ç‰¹æ€§éœ€è¦ç”¨åˆ°å¯¹è±¡çš„ Object.definePropertyæ–¹æ³• è¿™ä¸ªæ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•° è¦ç»™æ·»åŠ å±æ€§çš„å¯¹è±¡ï¼Œå±æ€§åç§°ï¼Œ ä¸€ä¸ªæè¿°ç¬¦å¯¹è±¡ï¼ˆå°±æ˜¯ç›¸å…³ç‰¹æ€§çš„æè¿°å±æ€§ï¼Œconfigurableï¼Œwritable, enumerable, valueï¼‰ 123456789let person = &#123;&#125;;Object.defineProperty(person, &quot;name&quot;, &#123; writable: false, value: &#x27;weng&#x27;&#125;);// è¿™é‡Œè®¾ç½®äº†`[[Writable]]`å±æ€§ä¸ºfalseï¼Œè¡¨ç¤ºè¿™ä¸ªå±æ€§ä¸èƒ½å†è¢«ä¿®æ”¹äº†console.log(person.name) // wengperson.name = &#x27;helloworld&#x27;; // ä¿®æ”¹æ— æ•ˆconsole.log(person.name) // weng ä¸Šè¿°è¿™ç§æƒ…å†µï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¹‹ä¸‹å°è¯•ä¿®æ”¹å±æ€§ä¼šæŠ›å‡ºé”™è¯¯ åˆ›å»ºä¸€ä¸ªä¸å¯é…ç½®çš„å±æ€§å¦‚ä¸‹ 12345678let person = &#123;&#125;;Object.defineProperty(person, &#x27;name&#x27;, &#123; configurable: false, value: &#x27;weng&#x27;&#125;)// è¿™é‡ŒæŠŠå¯¹è±¡çš„[[Configurable]]ç‰¹æ€§è®¾ç½®ä¸ºfalsedelete person.name; // åˆ é™¤æ— æ•ˆconsole.log(person.name) // weng è¿™é‡Œå¦‚æœä¿®æ”¹äº†[[Configurable]]ç‰¹æ€§ä¸ºä¸å¯é…ç½®ï¼Œä¹‹åéƒ½ä¸èƒ½å†å˜å›å¯é…ç½®çš„äº†ï¼Œå¦‚æœå†è°ƒç”¨Object.definePropertyæŠŠè¿™ä¸ªç‰¹æ€§è®¾ç½®ä¸ºtrueä¼šæŠ¥é”™ å¹¶ä¸”è®¾ç½®è¿™ä¸ªç‰¹æ€§ä¸ºfalseï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰å…¶ä»–ç‰¹æ€§ï¼Œé‚£ä¹ˆå…¶ä»–ç‰¹æ€§éƒ½é»˜è®¤ä¸ºfalse 2. è®¿é—®å™¨å±æ€§è®¿é—®å™¨å±æ€§æ˜¯ä¸åŒ…å«æ•°æ®å€¼çš„ã€‚ ä»–ä»¬åŒ…å«ä¸€ä¸ªï¼ˆgetterï¼‰å‡½æ•°å’Œä¸€ä¸ªï¼ˆsetterï¼‰å‡½æ•°ï¼› è¯»å–å±æ€§æ—¶å€™è°ƒå– getter å†³å®šäº†åº”è¯¥æ€ä¹ˆè¿”å›å€¼ï¼Œ è®¾ç½®å±æ€§çš„æ—¶å€™è°ƒç”¨ setterï¼Œsetterå‡½æ•°å‘Šè¯‰ä½ æ€ä¹ˆå¯¹æ•°æ®åšå‡ºä¿®æ”¹ æœ‰å››ä¸ªå±æ€§æè¿°ä»–ä»¬çš„è¡Œä¸º [[Configurable]]ï¼šé»˜è®¤æƒ…å†µä¸‹ä¸ºtrue æ˜¯å¦å¯é€šè¿‡deleteåˆ é™¤å¹¶é‡æ–°å®šä¹‰ æ˜¯å¦å¯ä»¥ä¿®æ”¹å®ƒçš„ç‰¹æ€§ æ˜¯å¦å¯ä»¥æŠŠä»–æ”¹ä¸ºæ•°æ®å±æ€§ [[Enumerable]]ï¼š é»˜è®¤æƒ…å†µä¸‹ä¸ºtrue è¡¨ç¤ºå±æ€§æ˜¯å¦å¯ä»¥é€šè¿‡ for-inå¾ªç¯- [[Get]]ï¼š è·å–å‡½æ•°ï¼Œåœ¨è¯»å–å±æ€§æ—¶å€™è°ƒç”¨ã€‚é»˜è®¤å€¼ä¸ºundefined [[Set]]ï¼š è®¾ç½®å‡½æ•°ï¼Œåœ¨å†™å…¥å±æ€§æ—¶å€™è°ƒç”¨ã€‚é»˜è®¤å€¼ä¸ºundefined å’Œæ•°æ®å±æ€§ä¸€æ ·ï¼Œè®¿é—®å™¨çš„å±æ€§ä¹Ÿæ˜¯ä¸èƒ½ç›´æ¥å®šä¹‰çš„ï¼Œå¿…é¡»ä½¿ç”¨Object.defineProperty() å¦‚ä¸‹ä¾‹å­ï¼š 123456789101112131415161718const book = &#123; year_: 2021, // è¡¨ç¤ºç§æœ‰å±æ€§ä¸èƒ½è¢«å¤–éƒ¨è®¿é—® edition: 1&#125;Object.defineProperty(book, &quot;year&quot;, &#123; get()&#123; return this.year_; &#125; set(newValue)&#123; if(newValue &gt; 2021)&#123; this.year_ = newValue; this.edition += newValue - 2021 &#125;\t&#125;&#125;)book.year = 2022;console.log(book.edition) // 2 ä»¥ä¸Šæ˜¯è®¿é—®å™¨å±æ€§çš„ç»å…¸ä½¿ç”¨åœºæ™¯ è·å–å‡½æ•°å’Œè®¾ç½®å‡½æ•°ä¸ä¸€å®šéƒ½éœ€è¦å®šä¹‰ åªå®šä¹‰è·å–å‡½æ•°æ„å‘³ç€å±æ€§æ˜¯åªè¯»çš„ å½“ç„¶å¯ä»¥ä»¥ä¸Šçš„Object.definePropertyåªèƒ½å®šä¹‰å•ä¸ªå±æ€§ï¼Œå¯ä»¥ä½¿ç”¨Object.definePropertiesæ¥å®šä¹‰å¤šä¸ªå±æ€§å€¼ä»¥åŠç‰¹æ€§ 1234567891011121314151617let book = &#123;&#125;Object.defineProperties(book, &#123; year_:&#123; value: 2021 &#125;, edition:&#123; value: 1 &#125;, year: &#123; get()&#123; .... &#125; set()&#123; .... &#125; &#125;&#125;) è¯»å–å±æ€§çš„ç‰¹æ€§1. Object.getOwnPropertyDescriptor()ä½¿ç”¨ Object.getOwnPropertyDescriptor()æ–¹æ³•å¯ä»¥è·å–æŒ‡å®šå±æ€§çš„å±æ€§æè¿°ç¬¦ã€‚ æ¥å—ä¸¤ä¸ªå‚æ•° å±æ€§æ‰€åœ¨å¯¹è±¡ï¼Œä»¥åŠè¦å–å¾—å…¶æè¿°ç¬¦å·çš„å±æ€§åï¼ˆæ•°æ®å±æ€§ï¼Œå’Œè®¿é—®å™¨å±æ€§ï¼‰ã€‚è¿”å›ä¸€ä¸ªå¯¹è±¡ ä¾‹å¦‚ï¼š 1234567891011121314151617181920let book = &#123;&#125;;Object.defineProperties(book, &#123; year_:&#123; value: 2021 &#125;, edition:&#123; value: 1 &#125;, year: &#123; get()&#123; .... &#125; set()&#123; .... &#125; &#125;&#125;)let desc = Object.getOwnPropertyDescriptor(book,&quot;year_&quot;);let descYear = Object.getOwnPropertyDescriptor(book, &quot;year&quot;); descçš„å€¼å¦‚ä¸‹ descYearå€¼å¦‚ä¸‹ï¼š 2. Object.getOwnPropertyDescriptors()es2017æ–°å¢çš„é™æ€æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨æ¯ä¸ªè‡ªæœ‰å±æ€§ä¸Šè°ƒç”¨Object.defineProperties 1console.log(Object.getOwnPropertyDescriptors(book)); æ‰“å°å‡ºæ¥çš„å¦‚ä¸‹ æ³¨æ„ï¼šè¿™ä¸¤ä¸ªæ–¹æ³•åªå¯¹å®ä¾‹å±æ€§æœ‰æ•ˆæœï¼Œæ˜¯ä¸èƒ½å–å¾—åŸå‹å±æ€§ä¸Šçš„æè¿°ç¬¦ï¼Œå¦‚æœéœ€è¦å–å¾—åŸå‹å±æ€§ä¸Šçš„æè¿°ç¬¦ï¼Œå°±å¾—ç›´æ¥å†åŸå‹å¯¹è±¡ä¸Šé¢ç›´æ¥è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•","tags":["Javascript","object"],"categories":["Javascript"]},{"title":"å¦‚ä½•å¯¹ä¸¤ä¸ªè¶…å¤§æ•°å­—å­—ç¬¦ä¸²åšç›¸åŠ æ“ä½œ","path":"/2021/05/26/å¦‚ä½•å¯¹ä¸¤ä¸ªè¶…å¤§æ•°å­—å­—ç¬¦ä¸²åšç›¸åŠ æ“ä½œ/","content":"å¦‚ä½•å¯¹ä¸¤ä¸ªè¶…å¤§æ•°å­—å­—ç¬¦ä¸²åšç›¸åŠ æ“ä½œ123var a = &#x27;10000000000000000000000&#x27;var b = &#x27;456789345678945678945678&#x27;function add(a,b) 123456789101112131415161718192021222324function add(a,b)&#123; // è·å–å„è‡ªé•¿åº¦ a = a.split(&#x27;&#x27;), b = b.split(&#x27;&#x27;); let sum=[],go=0; while(a.length || b.length)&#123; // é€šè¿‡popæ¯æ¬¡å–ä¸€ä¸ª let num1 = parseInt(a.pop()) || 0; let num2 = parseInt(b.pop()) || 0; // ä¸¤å€¼ç›¸åŠ ï¼Œå¦‚æœæœ‰è¿›ä½å°± + go let tmp = num1 + num2 + go; if(tmp &gt; 9)&#123; go = 1; // å–ä½™æ•° tmp %= 10; &#125;else&#123; go = 0; &#125; // array.unshift(item)è¡¨ç¤ºåœ¨æ•°ç»„arrayçš„æœ€å‰é¢æ’å…¥ sum.unshift(tmp) &#125; if(go) sum.unshift(1); return sum.join(&#x27;&#x27;);&#125;","tags":["Javascript","é¢è¯•é¢˜"],"categories":["é¢è¯•é¢˜"]},{"title":"ä»é¡µé¢ A æ‰“å¼€ä¸€ä¸ªæ–°é¡µé¢ Bï¼ŒB é¡µé¢å…³é—­ï¼ˆåŒ…æ‹¬æ„å¤–å´©æºƒï¼‰ï¼Œå¦‚ä½•é€šçŸ¥ A é¡µé¢ï¼Ÿ","path":"/2021/05/26/é¡µé¢é€šä¿¡ï¼ˆä»é¡µé¢ A æ‰“å¼€ä¸€ä¸ªæ–°é¡µé¢ Bï¼ŒB é¡µé¢å…³é—­ï¼ˆåŒ…æ‹¬æ„å¤–å´©æºƒï¼‰ï¼Œå¦‚ä½•é€šçŸ¥ A é¡µé¢ï¼Ÿï¼‰/","content":"ä»é¡µé¢ A æ‰“å¼€ä¸€ä¸ªæ–°é¡µé¢ Bï¼ŒB é¡µé¢å…³é—­ï¼ˆåŒ…æ‹¬æ„å¤–å´©æºƒï¼‰ï¼Œå¦‚ä½•é€šçŸ¥ A é¡µé¢ï¼Ÿé¦–å…ˆèƒ½å¤Ÿæ‹†è§£ä¸€ä¸‹è¿™ä¸ªé¢˜æ„ Bæ‰‹åŠ¨å…³é—­ï¼Œå¦‚ä½•é€šçŸ¥Aé¡µé¢ Bæ„å¤–å…³é—­ï¼Œè¢«çº¿ç¨‹æ€æ­»å¥”æºƒçš„æ—¶å€™å¦‚ä½•é€šçŸ¥Aé¡µé¢ 1. Bé¡µé¢æ­£å¸¸å…³é—­çš„æ—¶å€™1. é¦–å…ˆè¦å›ç­”å‡ºé¡µé¢å…³é—­æ—¶ä¼šè§¦å‘çš„äº‹ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ é¡µé¢å…³é—­æ—¶å…ˆæ‰§è¡Œwindow.onbeforeunloadï¼Œç„¶åæ‰§è¡Œwindow.onunload æˆ‘ä»¬å¯ä»¥åœ¨ window.onbeforeunload æˆ– window.onunload é‡Œé¢è®¾ç½®å›è°ƒã€‚ 2. ç„¶åå›ç­”å¦‚ä½•ä¼ å‚ï¼Ÿ æœ€å…ˆæƒ³åˆ°çš„æ˜¯ï¼šç”¨ window.open æ–¹æ³•è·³è½¬åˆ°ä¸€ä¸ªå·²ç»æ‰“å¼€çš„é¡µé¢ï¼ˆAé¡µé¢ï¼‰ï¼Œurl ä¸Šå¯ä»¥æŒ‚å‚ä¼ é€’ä¿¡æ¯ã€‚ åœ¨ chrome æµè§ˆå™¨ä¸‹ä¼šæŠ¥é”™â€œBlocked popup during beforeunload.â€ åœ¨ MDN é‡Œæ‰¾åˆ°äº†è§£é‡Šï¼šHTMLè§„èŒƒæŒ‡å‡ºåœ¨æ­¤äº‹ä»¶ä¸­è°ƒç”¨window.alert()ï¼Œwindow.confirm()ä»¥åŠwindow.prompt()æ–¹æ³•ï¼Œå¯èƒ½ä¼šå¤±æ•ˆã€‚Window: beforeunload event åœ¨ç«ç‹æµè§ˆå™¨ä¸‹ä¸ä¼šæŠ¥é”™ï¼Œå¯ä»¥æ­£å¸¸æ‰“å¼€ A é¡µé¢ã€‚ 3. æˆåŠŸä¼ å‚åï¼ŒA é¡µé¢æ˜¯å¦‚ä½•ç›‘å¬ URL çš„ï¼Ÿ onhashchange æ˜¯ä¸ºæ‚¨æ’å¿§è§£éš¾ã€‚Window: hashchange eventï¼šå½“URLçš„ç‰‡æ®µæ ‡è¯†ç¬¦æ›´æ”¹æ—¶ï¼Œå°†è§¦å‘hashchangeäº‹ä»¶ (è·Ÿåœ¨ï¼ƒç¬¦å·åé¢çš„URLéƒ¨åˆ†ï¼ŒåŒ…æ‹¬ï¼ƒç¬¦å·) å¦‚æœä½ ä¼ å‚æ˜¯ä»¥ A.html?xxx çš„å½¢å¼ï¼Œé‚£å°±éœ€è¦ç›‘å¬ window.location.hrefã€‚ // é¡µé¢A 123456789101112131415161718&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt; &lt;div&gt;è¿™æ˜¯ A é¡µé¢&lt;/div&gt; &lt;button onclick=&quot;toB()&quot;&gt;ç‚¹å‡»æ‰“å¼€ B é¡µé¢&lt;/button&gt; &lt;script&gt; window.name = &#x27;A&#x27; // è®¾ç½®é¡µé¢å function toB() &#123; window.open(&quot;B.html&quot;, &quot;B&quot;) // æ‰“å¼€æ–°é¡µé¢å¹¶è®¾ç½®é¡µé¢å &#125; window.addEventListener(&#x27;hashchange&#x27;, function () &#123;// ç›‘å¬ hash alert(window.location.hash) &#125;, false); &lt;/script&gt;&lt;/body&gt;&lt;/html&gt; // é¡µé¢B 1234567891011121314&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt; &lt;div&gt;è¿™æ˜¯ B é¡µé¢&lt;/div&gt; &lt;script&gt; window.onbeforeunload = function (e) &#123; window.open(&#x27;A.html#close&#x27;, &quot;A&quot;) // url æŒ‚å‚ è·³å›åˆ°å·²æ‰“å¼€çš„ A é¡µé¢ return &#x27;ç¡®å®šç¦»å¼€æ­¤é¡µå—ï¼Ÿ&#x27;; &#125; &lt;/script&gt;&lt;/body&gt;&lt;/html&gt; å…¶å®ä¼ å‚ä¹Ÿå¯ä»¥é€šè¿‡æœ¬åœ°ç¼“å­˜ä¼ å‚ï¼ŒA é¡µé¢è®¾ç½®ç›‘å¬,åœ¨ B é¡µé¢è®¾ç½® loacalStorage 123456789// A.htmlwindow.addEventListener(&quot;storage&quot;, function (e) &#123;// ç›‘å¬ storage alert(e.newValue);&#125;);// B.htmlwindow.onbeforeunload = function (e) &#123; localStorage.setItem(&quot;name&quot;,&quot;close&quot;); return &#x27;ç¡®å®šç¦»å¼€æ­¤é¡µå—ï¼Ÿ&#x27;;&#125; 2. å¥”æºƒçš„æƒ…å†µä¸‹è¿™ä¸ªå¥½é¸¡å„¿æ¼ç«","tags":["Javascript","é¢è¯•é¢˜","onbeforeunload","onunload"],"categories":["é¢è¯•é¢˜"]},{"title":"windo.open(å¯¼èˆªä¸æ‰“å¼€æ–°çª—å£)","path":"/2021/05/26/windo-open-å¯¼èˆªä¸æ‰“å¼€æ–°çª—å£/","content":"å¯¼èˆªä¸æ‰“å¼€æ–°çª—å£window.open() ç”¨äºå¯¼èˆªåˆ°æŒ‡å®šçš„URL æ‰“å¼€æ–°æµè§ˆå™¨çª—å£ æ¥å—4ä¸ªå‚æ•°ï¼ŒæŒ‡å®šURLï¼Œç›®æ ‡çª—å£ï¼ˆåå­—ï¼‰ï¼Œç‰¹æ€§å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ–°çª—å£åœ¨æµè§ˆå™¨å†å²è®°å½•ä¸­æ˜¯å¦æ›¿ä»£å½“å‰åŠ è½½é¡µé¢çš„å¸ƒå°”å€¼ï¼ˆä¸€èˆ¬åœ¨ä¸æ‰“å¼€æ–°çª—å£çš„æ—¶å€™ä½¿ç”¨ï¼‰ 12window.open(&quot;https://www.baidu.com/&quot;, &quot;baidu&quot;);// ä¸&lt;a href=&quot;https://www.baidu.com/&quot; target=&quot;baidu&quot; /&gt; å¦‚æœæœ‰ä¸€ä¸ªçª—å£åå«baiduï¼Œåˆ™è¿™ä¸ªçª—å£å°±ä¼šæ‰“å¼€è¿™URLï¼›å¦è€…å°±ä¼šæ‰“å¼€ä¸€ä¸ªæ–°çª—å£å¹¶å°†å…¶å‘½åä¸ºbaidu ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿå¯ä»¥æ˜¯å¦‚ä¸‹å‡ ä¸ª _self _parent _top _blank 1. å¼¹å‡ºçª—å£window.openä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ä»–çš„apiå»æ“ä½œæ‰“å¼€çš„è¿™ä¸ªæ–°çª—å£ 123456789const openWindow = window.open(&#x27;https://www.baidu.com/&#x27;,&#x27;baidu&#x27;,&#x27;height=400,width=500,top=10,left=10,resizable=yes&#x27;);// ç§»åŠ¨æ‰“å¼€çš„çª—å£openWindow.moveTo(100, 100);// å…³é—­æ‰“å¼€çš„çª—å£openWindow.close();//å…³é—­ä¹‹åè¿™ä¸ªå¯¹è±¡ä»ç„¶å­˜åœ¨,å¯ä»¥åˆ¤æ–­å®ƒclosedå±æ€§window.closed // true; å¼¹å‡ºçš„çª—å£å¯ä»¥å…³é—­è‡ªå·± 1top.close(); æ–°å»ºçš„çª—å£windowå¯¹è±¡ä¸Šæœ‰ä¸ªå±æ€§opener,æŒ‡å‘ä»–æ‰“å¼€çš„çª—å£ è¿™ä¸ªå±æ€§åªåœ¨å¼¹å‡ºçª—å£çš„æœ€ä¸Šå±‚windowå¯¹è±¡æœ‰å®šä¹‰,å°±æ˜¯æŒ‡é’ˆ 1opendWidon.opener === window // true å› ä¸ºæœ‰äº†è¿™ä¸ªæŒ‡é’ˆ,è¡¨ç¤ºçš„æ–°å¼€çš„çª—å£ä¸èƒ½ç‹¬ç«‹è¿è¡Œåœ¨è¿›ç¨‹å½“ä¸­,å¦‚æœéœ€è¦åˆ™éœ€è¦æŠŠopenerå±æ€§è®¾ç½®ä¸ºnull,ä¸ä¸»é¡µé¢åˆ‡æ–­é“¾æ¥ä¹‹å,è¿™ä¸ªé“¾æ¥æ˜¯ä¸å¯ä»¥åœ¨æ¢å¤çš„ 2.åˆ¤æ–­å¼¹çª—æ˜¯å¦è¢«å±è”½äº†æµè§ˆå™¨å¯èƒ½å­˜åœ¨å¼¹çª—å±è”½ç¨‹åº,æ‰€ä»¥å¯ä»¥é€šè¿‡æ£€æµ‹window.open()è¿”å›çš„å€¼æ˜¯å¦ä¸ºnullå°±èƒ½ç¡®å®šå¼¹çª—æ˜¯å¦è¢«å±è”½äº† ä½†æ˜¯æœ‰æ—¶å€™window.openéƒ½ä¼šæŠ¥é”™ æ‰€ä»¥ç”¨ä¸€å±‚trycatchåŒ…è£¹ä¼šå¥½ä¸€ç‚¹ 123456789let blocked = false;try&#123; let openWindow = window.open(&#x27;https://baidu.com&#x27;,&quot;_blank&quot;); if(openWindow === null)&#123; blocked = true; &#125;&#125; catch(e)&#123; blocked = true&#125;","tags":["Javascript","window.open","å¯¼èˆª"],"categories":["Javascript"]},{"title":"fetché…ç½®è¯·æ±‚å¤´ä¸‹è½½æ–‡ä»¶ï¼ˆæ–‡ä»¶æµæ˜¾ç¤ºè¿›åº¦ï¼‰","path":"/2021/04/14/fetché…ç½®è¯·æ±‚å¤´ä¸‹è½½æ–‡ä»¶ï¼ˆæ–‡ä»¶æµæ˜¾ç¤ºè¿›åº¦ï¼‰/","content":"ä¸Šä»£ç ï¼Œåˆ°æ—¶å€™å†å†™ä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Œå› ä¸ºæ‡’ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546import &#123; WritableStream,&#125; from &#x27;web-streams-polyfill/ponyfill&#x27;; import StreamSaver from &#x27;streamsaver&#x27;;const handleFileDownLoad = async (url, username, password, filename) =&gt; &#123; const tempHeader = new Headers(); tempHeader.append(&#x27;Authorization&#x27;, `Basic $&#123;Base64.encode(`$&#123;username&#125;:$&#123;password&#125;`)&#125;`); fetch(`$&#123;url&#125;?pipelineDownLoad=true`, &#123; method: &#x27;GET&#x27;, headers: tempHeader, // mode: &#x27;no-cors&#x27;, // redirect: &#x27;manual&#x27;, &#125;) .then((response) =&gt; &#123; console.log(response); if (!window.WritableStream) &#123; StreamSaver.WritableStream = WritableStream; window.WritableStream = WritableStream; &#125; const fileStream = StreamSaver.createWriteStream(filename, &#123; writableStrategy: true, readableStrategy: true, &#125;); const readableStream = response.body; if (window.WritableStream &amp;&amp; readableStream?.pipeTo) &#123; return readableStream.pipeTo(fileStream).then(() =&gt; &#123; message.success(&#x27;ä¸‹è½½æˆåŠŸ&#x27;); &#125;); &#125; const writer = fileStream.getWriter(); window.writer = writer; const reader = response.body?.getReader(); const pump = () =&gt; reader?.read() .then((res) =&gt; (res.done ? writer.close() : writer.write(res.value).then(pump))); pump(); // message.success(&#x27;ä¸‹è½½æˆåŠŸ&#x27;); return true; &#125;).catch((error) =&gt; &#123; throw new Error(error); &#125;); &#125;;","tags":["fetch","authè®¤è¯"],"categories":["fetch"]},{"title":"jsæ•°æ®ç±»å‹ä»¥åŠtypeOfæ“ä½œç¬¦å·","path":"/2021/03/14/jsæ•°æ®ç±»å‹ä»¥åŠtypeOfæ“ä½œç¬¦å·/","content":"ES6æœ‰6ä¸­ ç®€å•æ•°æ®ç±»å‹ï¼ˆåŸå§‹ç±»å‹ï¼‰å’Œä¸€ç§å¤æ‚æ•°æ®ç±»å‹ ç®€å•ï¼šUndifined, Null, Boolean, Number, String, Symbol å¤æ‚ï¼šobject æ‰€æœ‰çš„å€¼éƒ½å¯ä»¥ç”¨ä»¥ä¸Š7ç§æ¥è¡¨ç¤º typeofæ“ä½œç¬¦ESçš„ç±»å‹ç³»ç»Ÿæ˜¯æ¾æ•£çš„ï¼Œtypeofå¯ä»¥ç¡®å®šä»»æ„å˜é‡çš„æ•°æ®ç±»å‹ã€‚ typeofå¯¹ä¸€ä¸ªå€¼ä½¿ç”¨ä¼šè¿”å›çš„å­—ç¬¦ä¸²ä¹‹ä¸€ â€œundefinedâ€ è¡¨ç¤ºå€¼æœªå®šä¹‰ â€œbooleanâ€ å¸ƒå°”å€¼ â€œstringâ€ å­—ç¬¦ä¸² â€œnumberâ€ æ•°å€¼ â€œobjectâ€ è¡¨ç¤ºä¸ºå¯¹è±¡ï¼ˆè€Œä¸æ˜¯å‡½æ•°ï¼‰æˆ–è€…null â€œfunctionâ€è¡¨ç¤ºå‡½æ•° â€œsymbolâ€è¡¨ç¤ºç¬¦å· å‡½æ•°åœ¨esä¸­è¢«è®¤ä¸ºæ˜¯å¯¹è±¡ï¼Œä½†æ˜¯ä¸ä»£è¡¨ä¸€ç§æ•°æ®ç±»å‹ å› æ­¤typeofå¯ä»¥å¾ˆå¥½çš„åŒºåˆ«å®ƒå’Œå…¶ä»–å¯¹è±¡çš„åŒºåˆ« ç±»å‹undefinedåªæœ‰ä¸€ä¸ªå€¼ï¼Œå°±æ˜¯ç‰¹æ®Šå€¼undefined å½“ç”¨letæˆ–è€…var å£°æ˜äº†å˜é‡ä½†æ˜¯æ²¡æœ‰åˆå§‹åŒ–ï¼ˆç»™ä¸€ä¸ªåˆå§‹å€¼ï¼‰çš„æ—¶å€™ï¼Œè¿™ä¸ªå˜é‡å°±ç›¸å½“äºèµ‹äºˆäº†undefinedå€¼ 12let msg;console.log(msg);// undefined æˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼çš„å»ç»™å€¼èµ‹å€¼ä¸€ä¸ªundefinedï¼Œå› ä¸ºç³»ç»Ÿè‡ªåŠ¨éƒ½ä¼šç»™æœªåˆå§‹åŒ–çš„å€¼èµ‹å€¼undefined *æ³¨æ„: ä½¿ç”¨typeofï¼Œæœªå£°æ˜çš„å˜é‡å’Œæœªåˆå§‹åŒ–çš„å˜é‡è¿”å›éƒ½æ˜¯undefined 123typeof a; // undefinedlet b;typeof b; // undefined NULLnullç±»å‹ä¹Ÿæ˜¯åŒæ ·åªæœ‰ä¸€ä¸ªå€¼ï¼Œç‰¹æ®Šå€¼Nullï¼› nullé€»è¾‘ä¸Šè®²ï¼Œè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡æŒ‡é’ˆï¼Œæ¯•ç«Ÿtypeof nullçš„æ—¶å€™æ˜¯â€˜objectâ€™; å› æ­¤åœ¨å®šä¹‰å°†æ¥è¦ä¿å­˜å¯¹è±¡å€¼å¾—å˜é‡å¾—æ—¶å€™ï¼Œå»ºè®®ä½¿ç”¨nullåˆå§‹åŒ– undefinedå€¼æ˜¯ç”±nullå€¼æ´¾ç”Ÿè€Œæ¥çš„ï¼Œå› æ­¤ECMA-262å°†ä»–ä»¬å®šä¹‰ä¸ºè¡¨é¢ä¸Šç›¸ç­‰ã€‚ 1console.log(null == undefined) *==æ“ä½œç¬¦ä¼šå¯¹æ•°æ®ä¸¤å¤´å¾—æ•°æ®ç±»å‹è¿›è¡Œè½¬æ¢ï¼Œè¿™ä¸ªå•ç‹¬å†™ä¸€ç¯‡è®² Booleanbooleanå°±ä¸¤å€¼ï¼Œtrue or falseï¼› è™½ç„¶åªæœ‰ä¸¤ä¸ªå€¼ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ç‰¹å®šå¾—Boolean()è½¬å‹å‡½æ•°å°†å…¶ä»–ç±»å‹å¾—å€¼è½¬æ¢ä¸ºå¸ƒå°”å€¼ 1.Boolean()è½¬å‹ä¸åŒç±»å‹å€¼è½¬æ¢ä¸ºå¸ƒå°”å€¼å¾—è½¬æ¢è§„åˆ™å¦‚ä¸‹ æ•°æ®ç±»å‹ è½¬ä¸ºtrue è½¬ä¸ºfalse Boolean true false String éç©ºå­—ç¬¦ä¸² â€œâ€ Undefined N/A(ä¸å­˜åœ¨) undefined Number é0å¾—æ•°å€¼ï¼ˆInfinityï¼‰ 0, NaN Object ä»»ä½•å¯¹è±¡ null *åƒä¸€äº›ifç­‰æµæ§åˆ¶è¯­å¥ä¼šè‡ªåŠ¨å¾—å°†å…¶ä»–ç±»å‹å€¼è½¬æ¢ä¸ºbooleanç±»å‹å€¼ 12345const a = &#x27;2121&#x27;;if(a)&#123; console.log(hello);&#125;// hello; *Numberæœ€æœ‰æ„æ€å¾—æ•°æ®ç±»å‹äº† Numberç±»å‹ä½¿ç”¨å¾—æ˜¯IEEE 754æ ¼å¼è¡¨ç¤ºæ•´æ•°å’Œæµ®ç‚¹å€¼ åè¿›åˆ¶ å…«è¿›åˆ¶(0å¼€å¤´ï¼Œæ•°å­—0~7) åå…­è¿›åˆ¶ï¼ˆ0xå¼€å¤´ï¼Œæ•°å­—09ï¼Œå­—æ¯AFï¼‰ 123let a1 = 55; // 55let a2 = 070; // å…«è¿›åˆ¶çš„ 56let a3 = 098; // æ— æ•ˆå…«è¿›åˆ¶,è‡ªåŠ¨è½¬ä¸ºåè¿›åˆ¶98 1. æµ®ç‚¹æ•°è¡¨ç¤ºï¼š1.1ï¼Œ 1.2 ï¼Œ 3.125e7ï¼Œ 3.125e-8 *æµ®ç‚¹æ•°ç²¾ç¡®åº¦é—®é¢˜ 1234if(0.1 + 0.2==0.3)&#123; console.log(&#x27;hello&#x27;) &#125;// è¿™é‡Œçš„0.1 + 0.2 æ˜¯ä¸ç­‰äº0.3çš„ 2. å€¼å¾—èŒƒå›´å†…å­˜é™åˆ¶ï¼ŒESä¸èƒ½è¡¨ç¤ºè¿™ä¸–ç•Œä¸Šæ‰€æœ‰å¾— æœ€å°å€¼å­˜åœ¨ï¼šNumber.MIN_VALUEä¸­ æœ€å¤§å€¼å­˜åœ¨ï¼šNumber.MAX_VALUEä¸­ å¦‚æœä¸¤ä¸ªå€¼å¾—è¿ç®—è¶…è¿‡è¿™ä¸¤ä¸ªæé™å€¼ï¼Œåˆ™ä¼šæ˜¯Infinityè¡¨ç¤º 3. NaNç‰¹æ®Šå¾—æ•°å€¼ï¼šNaNï¼Œæ„æ€å°±æ˜¯ä¸æ˜¯ä¸€ä¸ªæ•°å€¼ï¼› ç”¨äºæœ¬æ¥æ˜¯è¦è¿”å›æ•°å€¼å¾—æ“ä½œå¤±è´¥äº†ï¼ˆä¸æŠ›é”™ï¼‰ 1ï¼‰æ¶‰åŠä»»ä½•NaNå¾—æ“ä½œéƒ½ä¼šè¿”å›NaN2ï¼‰console(NaN == NaN)ä¸ºfalse 3ï¼‰isNaN()å‡½æ•°åˆ¤æ–­ä¼ å…¥å¾—å€¼æ˜¯å¦ â€ä¸æ˜¯æ•°å€¼â€œ è¯¥å‡½æ•°ä¼šå°†ä¼ å…¥å¾—å€¼å°è¯•å»è½¬æ¢ä¸ºæ•°å€¼ï¼Œä»»ä½•ä¸èƒ½è½¬æ¢ä¸ºæ•°å€¼å¾—å€¼éƒ½ä¼šå¯¼è‡´è¿™ä¸ªå‡½æ•°è¿”å›true 12345isNaN(NaN) // trueisNaN(10) // falseisNaN(&#x27;10&#x27;) // falseisNaN(&#x27;blue&#x27;) //trueisNaN(true) // false isNaNå¯ä»¥ç”¨äºæµ‹è¯•å¯¹è±¡ï¼Œé¦–å…ˆä¼šå»è°ƒç”¨å¯¹è±¡å¾—valueOf()æ–¹æ³•ï¼Œç¡®å®šè¿”å›å¾—å€¼æ˜¯å¦å¯ä»¥è½¬æ¢ä¸ºæ•°å€¼ï¼Œå¦‚æœä¸è¡Œå†è°ƒç”¨toString()æ–¹æ³•å¹¶æµ‹è¯•è¿”å›å€¼ï¼› 4. æ•°å€¼è½¬æ¢æœ‰3ä¸ªå‡½æ•°å¯ä»¥å°†éæ•°å€¼å‹æ•°æ®è½¬ä¸ºæ•°å€¼ Number(), parseInt(), parseFloat() 1) Number()è½¬å‹å‡½æ•°å¯ä»¥ç”¨äºä»»æ„ç±»å‹å¾—æ•°æ® è½¬å‹è§„åˆ™å¦‚ä¸‹ å¸ƒå°”å€¼ï¼Œtrueä¸º1ï¼Œfalseä¸º0 æ•°å€¼ï¼Œç›´æ¥è¿”å›æ•°å€¼ nullï¼Œè¿”å›0 undefinedï¼Œè¿”å›NaN å­—ç¬¦ä¸² åŒ…å«æ•°å€¼å­—ç¬¦ä¸²ï¼ŒåŒ…æ‹¬å‰é¢å¸¦ç€+ï¼Œ- å·å¾—æƒ…å†µï¼Œåˆ™è½¬æ¢ä¸ºä¸€ä¸ªåè¿›åˆ¶æ•°å€¼ 123Number(&quot;1&quot;) // 1Number(&quot;123abc&quot;) // 123Number(&quot;0111&quot;) // 111 å­—ç¬¦ä¸²åŒ…å«æµ®ç‚¹å€¼å­—ç¬¦ä¸² 1Number(&quot;1.1&quot;) // 1.1 - å­—ç¬¦ä¸²åŒ…å«æœ‰æ•ˆå¾—åå…­è¿›åˆ¶æ ¼å¼ï¼Œåˆ™è½¬æ¢ä¸ºè¯¥åå…­è¿›åˆ¶å¯¹åº”å¾—åè¿›åˆ¶æ•° 1Number(&quot;0xA&quot;) // 10 - ç©ºå­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›0 - é™¤äº†ä»¥ä¸Šæƒ…å†µå¤–ï¼Œè¿”å›NaN å¯¹è±¡ è°ƒç”¨å¯¹è±¡å¾—valueOf()æ–¹æ³•ï¼Œå¹¶ä¸”æŒ‰ç…§ä¸Šè¿°è§„åˆ™è½¬æ¢è¿”å›å¾—å€¼ã€‚å¦‚æœè½¬æ¢ç»“æœæ˜¯NaNï¼Œåˆ™å†è°ƒç”¨å¯¹è±¡å¾—toString()æ–¹æ³•ï¼Œå†æŒ‰è§„åˆ™å»è½¬æ¢ 1Number(&quot;hello world&quot;) // NaN ä¸€å…ƒåŠ æ“ä½œç¬¦ä¹Ÿéµå¾ªNumber()è½¬æ¢è§„åˆ™ 2) ParseInt()æ­¤å‡½æ•°æ›´åŠ ä¸“æ³¨äºå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æ•°å€¼æ¨¡å¼ å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯æ•°å€¼å­—ç¬¦ï¼Œ + -ç¬¦å·ï¼Œåˆ™ç«‹å³è¿”å›NaN ç©ºå­—ç¬¦ä¸²ä¹Ÿç«‹å³è¿”å›NaN 12345parseInt(&quot;123&quot;) //123parseInt(&quot;123abc&quot;) // 123parseInt(&quot;&quot;) // NaNparseInt(&quot;0xf&quot;) // 15parseInt(&quot;07&quot;) // 7 ä¹Ÿæ¥å—ç¬¬äºŒä¸ªå‚æ•° 123parseInt(&quot;0xAF&quot;,16) // 175parseInt(&quot;AF&quot;,16) // 175parseInt(&quot;AF&quot;) //NaN 3) ParseFloat()å’ŒparseIntç›¸ä¼¼ Stringå­—ç¬¦ä¸²æ•°æ®ç±»å‹è¡¨ç¤ºé›¶æˆ–è€…å¤šä¸ª16ä½å¾—Unicodeå­—ç¬¦åºåˆ— 1. å­—ç¬¦å­—é¢é‡ç”¨äºè¡¨ç¤ºéæ‰“å°å­—ç¬¦æˆ–è€…å…¶ä»–ç”¨é€”å­—ç¬¦ 1234567891011\\t \\b\\r\\f\\\\\\&#x27;\\&quot;\\`\\xnn\\unnn å¦‚æœå­—ç¬¦ä¸²åŒ…å«åŒå­—èŠ‚å­—ç¬¦ï¼Œlengthå°±ä¸å¥½ç¡®å®šäº† 2. å­—ç¬¦ä¸²ç‰¹ç‚¹esä¸­å¾—å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œä¸€æ—¦åˆ›å»ºï¼Œå€¼å°±ä¸èƒ½å†å˜åŒ–ï¼Œè¦ä¿®æ”¹å…¶ä¸­ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œå¿…é¡»å…ˆé”€æ¯åŸæ¥å¾—å­—ç¬¦ä¸²å†å°†åŒ…å«æ–°å€¼çš„å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¿å­˜åˆ°è¯¥å˜é‡ 3. è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼ˆtoString &amp; String()ï¼‰é€‚ç”¨äº æ•°å€¼ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”å€¼ï¼Œå¯¹è±¡ï¼ˆå­—ç¬¦ä¸²çš„toStringåªæ˜¯ç®€å•çš„è¿”å›è‡ªèº«çš„ä¸€ä¸ªå‰¯æœ¬ï¼‰ï¼Œnullå’Œundefinedæ²¡æœ‰è¿™ä¸ªæ–¹æ³• 1ï¼‰toString()toStringå†å¯¹æ•°å€¼ç±»å‹è¿›è¡Œè½¬æ¢çš„æ—¶å€™å¯ä»¥ä¼ å…¥å‚æ•°ï¼Œå…¶ä»–çš„ç±»å‹ä¸å…è®¸ 12345let num = 10;num.toString(); // &quot;10&quot;num.toString(2); // &quot;1010&quot;num.toString(8); // &quot;12&quot;num.toString(16); // &quot;a&quot; 2) String()å¦‚æœä¸ç¡®å®šä¸€ä¸ªå€¼æ˜¯å¦ä¸ºnullæˆ–è€…undefinedå¯ä»¥ä½¿ç”¨String()è½¬å‹å‡½æ•° è½¬æ¢è§„åˆ™â†“ å¦‚æœå€¼æœ‰toString()çš„æ–¹æ³•ï¼Œåˆ™è°ƒç”¨è¯¥æ–¹æ³•è¿”å›ç»“æœ å¦‚æœåªæ˜¯nullè¿”å›â€nullâ€ï¼Œundefinedè¿”å›â€undefinedâ€ ç”¨åŠ å·ç»™ä¸€å€¼åŠ ä¸Šä¸€ä¸ªç©ºå­—ç¬¦ä¸²â€â€ä¹Ÿå¯ä»¥å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸² 4. æ¨¡æ¿å­—é¢é‡12const name = &#x27;lihua&#x27;;console.log(`hello $&#123;name&#125;`); // hello lihua æ¨¡æ¿å­—é¢é‡ä¿ç•™æ¢è¡Œç¬¦å·, ç©ºæ ¼ 1234567const one = &#x27;first line second line&#x27;; // first line// second lineconst two = `first linesecond line`;// first line// second line æ¨¡æ¿å­—é¢é‡ä¸æ˜¯å­—ç¬¦ä¸²è€Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„jså¥æ³•è¡¨è¾¾å¼ï¼Œåªä¸è¿‡æ±‚å€¼ä¹‹åæ˜¯å­—ç¬¦ä¸² æ‰€æœ‰çš„æ’å…¥å€¼æœ€åéƒ½ä¼šä½¿ç”¨toString()å¼ºåˆ¶è½¬å‹ç»´å­—ç¬¦ä¸²ï¼Œé€‚ç”¨ä¸ä»»ä½•çš„jsè¡¨è¾¾å¼ 1234let foo = &#123; toString: ()=&gt; &#x27;world&#x27;&#125;;console.log(`hello $&#123;foo&#125;`); æ¨¡æ¿å­—é¢é‡æ ‡ç­¾å‡½æ•° 12345678910111213141516171819let a = 6;let b = 5;function simpleTag(strings, aValExpression, bValExpression, sum)&#123; console.log(strings); console.log(aValExpression);\tconsole.log(bValExpression); console.log(sum);\treturn &#x27;motherfucker&#x27;;&#125;let resUntagged = `$&#123;a&#125; + $&#123;b&#125; = $&#123;a + b&#125;`;let resTagged = simpleTag`$&#123;a&#125; + $&#123;b&#125; = $&#123;a + b&#125;`;// [&quot;&quot;, &quot;+&quot;, &quot;=&quot;, &quot;&quot;]// 6 // 5// 11console.log(resUntagged); // 6 + 9 = 15console.log(resTagged); // motherfucker è¡¨è¾¾å¼çš„å‚æ•°ä¸€èˆ¬å¯å˜ï¼Œæ‰€ä»¥ç”¨â€¦rest ä¼ å…¥ 1234567891011121314151617let a = 6;let b = 5;function simpleTag(strings, ...rest)&#123; console.log(strings); for(const express of rest)&#123; console.log(express); &#125;\treturn &#x27;motherfucker&#x27;;&#125;let resTagged = simpleTag`$&#123;a&#125; + $&#123;b&#125; = $&#123;a + b&#125;`;// [&quot;&quot;, &quot;+&quot;, &quot;=&quot;, &quot;&quot;]// 6 // 5// 11console.log(resTagged); // motherfucker å¦‚æœéœ€è¦é€šè¿‡ä¸€ä¸ªæ ‡ç­¾å‡½æ•°å¾—åˆ°åŸå§‹å­—ç¬¦ä¸²çš„è¯ 12345678let a = 6;let b = 9;function zipTag(strings, ...rest)&#123; return strings[0] + rest.map((e, i)=&gt;`$&#123;e&#125;$&#123;strings[i+1]&#125;`).join(&#x27;&#x27;);&#125;console.log(zipTag`$&#123;a&#125; + $&#123;b&#125; = $&#123;a + b&#125;`); // 6 + 9 = 15 åŸå§‹å­—ç¬¦ä¸²è·å–, å¯ä»¥ä½¿ç”¨String.rawæ ‡ç­¾å‡½æ•°ï¼Œä»è€Œè·å–åˆ°ä¸æ˜¯è¢«è½¬æ¢åçš„å­—ç¬¦ 12345console.log(`hello world`);// hello// worldconsole.log(String.raw`hello world`) // &quot;hello world&quot; ä½†æ˜¯å¯¹äºå®é™…çš„æ¢è¡Œç¬¦å·æ˜¯ä¸å¯ä»¥çš„ Symbolç¬¦å·å±æ€§æ˜¯å¯¹å†…å­˜ä¸­ç¬¦å·çš„ä¸€ä¸ªå¼•ç”¨ 1.åŸºæœ¬ç”¨æ³•123let sym = Symbol();let symV = Symbol(&#x27;V&#x27;);typeof sym; // symbol è¿™é‡Œä¸å¯ä»¥ä½¿ç”¨åƒBoolean, String, Numberé‚£æ ·ä½¿ç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–åŒ…è£…å¯¹è±¡ 1let sym = new Symbol(); // TypeError: Symbol is not a constructor 2.åˆ›å»ºå…¨å±€ç¬¦å·æ³¨å†Œè¡¨Symbol.for()å…¨å±€åˆ›å»ºç¬¦å·å®ç° å…±äº« é‡ç”¨ 1let globleSym = Symbol.for(&quot;mine&quot;); ç¬¬ä¸€æ¬¡è°ƒç”¨Symbol.for()ä¼šå»å…¨å±€æ³¨å†Œä¸€ä¸ªç¬¦å·ï¼Œå¦‚æœå†æ¬¡è°ƒç”¨åˆ™ç›´æ¥ä»æ³¨å†Œè¡¨ä¸­æ£€æŸ¥ï¼Œå¹¶ä¸”è¿”å›è¯¥ç¬¦å·å®ä¾‹ï¼› å…¨å±€æ³¨å†Œå’Œä½¿ç”¨æ™®é€šæ–¹å¼å®šä¹‰çš„ç¬¦å·å®ä¾‹ä¸ç­‰ 12345678let a = Symbol.for(&#x27;hello&#x27;);let b = Symbol.for(&#x27;hello&#x27;);let c= Symbol(&#x27;hello&#x27;);a === b // truea === c // false ä¼ ç»™Symbol.for()å‡½æ•°çš„ä»»ä½•å€¼éƒ½ä¼šè¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸² let empty = Symbol.for(); empty // Symbol(undefined); å¯ä»¥ä½¿ç”¨ Symbol.keyFor()æ¥æŸ¥è¯¢å…¨å±€æ³¨å†Œè¡¨ï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—ç¬¦å·ï¼Œè¿”å›è¯¥å…¨å±€ç¬¦å·å¯¹åº”çš„å­—ç¬¦ä¸²é”®ï¼ˆå¦‚æœæ²¡æœ‰åˆ™è¿”å›undefined, å¦‚æœä¼ å…¥çš„ä¸æ˜¯ç¬¦å·åˆ™ä¼šæŠ¥é”™ 12345let s = Symbol.for(&#x27;foo&#x27;);console.log(Symbol.keyFor(s)); // foo\tlet a = Symbol(&#x27;bar&#x27;);console.log(Symbol.keyFor(a)); // undefined 3. ä½¿ç”¨ç¬¦å·ä½œä¸ºå±æ€§å‡¡æ˜¯å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æˆ–æ•°å€¼ä½œå±æ€§çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨ç¬¦å·ï¼ŒåŒ…æ‰©äº†Object.defineProperty() / Object.defineProperties()å®šä¹‰å±æ€§ 12345678910let s1 = Symbol(&#x27;hello&#x27;), s2 = Symbol(&#x27;world&#x27;), s3 = Symbol(&#x27;beauty&#x27;);let o = &#123; [s1]: &#x27;1212&#x27;&#125;;console.log(o); // &#123;Symbol(hello): 1212&#125;Object.defineProperties(o, &#123; [s2]: &#x27;ssss&#x27;, [s3]: &#x27;2121&#x27;&#125;) Object.getOwnPropertyNames()è¿”å›å¯¹è±¡å®ä¾‹çš„å¸¸è§„å±æ€§æ•°ç»„ Object.getOwnPropertySymbols()è¿”å›å¯¹è±¡å®ä¾‹çš„ç¬¦å·å±æ€§æ•°ç»„ Object.getOwnPropertyDescriptors()è¿”å›åŒæ—¶åŒ…å«å¸¸è§„å’Œç¬¦å·å±æ€§æè¿°ç¬¦çš„å¯¹è±¡ Reflect.ownKeys()ä¼šè¿”å›ä¸¤ç§ç±»å‹çš„é”® 4.å¸¸ç”¨çš„å†…ç½®ç¬¦å·ES6å¼•å…¥äº†ä¸€äº›å¸¸ç”¨çš„å†…ç½®ç¬¦å·ï¼Œç”¨äºæš´éœ²è¯­è¨€å†…éƒ¨çš„è¡Œä¸ºï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥è®¿é—®ï¼Œé‡å†™æˆ–è€…æ¨¡æ‹Ÿè¿™äº›è¡Œä¸º æ”¹å˜åŸç”Ÿè¡Œä¸ºã€‚æ¯”å¦‚for-ofå¾ªç¯ä¼šåœ¨ç›¸å…³å¯¹è±¡ä¸Šä½¿ç”¨Symbol.iteratorå±æ€§ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡åœ¨è‡ªå®šä¹‰çš„å¯¹è±¡ä¸Šé¢é‡æ–°å®šä¹‰è¿™ä¸ª[Symbol.iterator]ä»è€Œæ”¹å˜for-oféå†å¯¹è±¡æ—¶å€™çš„è¡Œä¸º 1ï¼‰ Symbol.asyncIterator ï¼ˆå¼‚æ­¥è¿­ä»£å™¨ç¬¦å·ï¼‰(ES2018)è¿™ä¸ªç¬¦å·ä½œä¸ºä¸€ä¸ªå±æ€§ï¼Œæ ‡è¯†ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›å¯¹è±¡é»˜è®¤çš„AsyncIteratorï¼Œç”±for-await-ofè¯­å¥ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯å¼‚æ­¥è¿­ä»£APIå‡½æ•° 1234567class Foo&#123; async *[Symbol.asyncIterator]()&#123;&#125;&#125;let f = new Foo();console.log(f[Symbol.asyncIterator()]);// AsyncGenerator(&lt;suspended&gt;) ç”±æ­¤ç¬¦å·å‡½æ•°ç”Ÿæˆçš„å¯¹è±¡åº”è¯¥æ˜¾å¼é€šè¿‡next()æ–¹æ³•é™†ç»­è¿”å›Promiseå®ä¾‹ï¼Œä¹Ÿå¯ä»¥éšå¼é€šè¿‡å¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°è¿”å› 1234567891011121314151617181920212223242526class Emitter &#123; constructor(max)&#123; this.max = max; this.index = 0; &#125; async *[Symbol.asyncIterator]()&#123; while(this.index&lt; this.max)&#123; yield new Promise((resolve)=&gt;resolve (this.index++)); &#125; &#125;&#125;async function count(number)&#123; let emitter = new Emitter(number); for await(const x of emitter)&#123; console.log(x) &#125;&#125;count(5);// 0// 1// 2// 3// 4// 2) Symbol.hasInstanceæ ‡è¯†ä¸€ä¸ªæ–¹æ³•ï¼Œå†³å®šä¸€ä¸ªæ„é€ å™¨å¯¹è±¡æ˜¯å¦è®¤å¯ä¸€ä¸ªå¯¹è±¡å¼å®ƒçš„å®ä¾‹ã€‚ç”±instanceof æ“ä½œç¬¦ä½¿ç”¨ 12345678910111213function Foo()&#123;&#125;let f = new Foo();console.log(f instanceof Foo); // trueconsole.log(Foo[Symbol.hasInstance](f)) // true;class FlaseInstance()&#123; static [Symbol.hasInstance]()&#123; return false &#125;&#125;let a = new FalseInstance();console.log(a intanceof FalseInstance) //false 3) Symbol.isConcatSpreadableæ ‡è¯†ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœæ˜¯trueä»¥ä¸ºç€å¯¹è±¡æ”¹ç”¨Array.prototype.concat()æ‰“å¹³å…¶æ•°ç»„å…ƒç´ ã€‚ ES6ä¸­çš„Array.prototype.concat()æ–¹æ³•ä¼šæ ¹æ®æ¥æ”¶åˆ°çš„å¯¹è±¡ç±»å‹é€‰æ‹©å¦‚ä½•å°†ä¸€ä¸ªç±»æ•°ç»„å¯¹è±¡æ‹¼æ¥æˆæ•°ç»„å®ä¾‹ã€‚ å¦‚å€¼ä¸ºfalseï¼Œåˆ™ä¼šå¯¼è‡´æ•´ä¸ªå¯¹è±¡è¢«è¿½åŠ åˆ°æ•°ç»„æœ«å°¾ï¼Œå…¶ä»–ä¸æ˜¯ç±»æ•°ç»„å¯¹è±¡çš„å¯¹è±¡åœ¨trueæƒ…å†µä¸‹ä¼šè¢«å¿½ç•¥ 12345678910111213let init = [&#x27;foo&#x27;];let arr = [&#x27;bar&#x27;];console.log(arr[Symbol.isConcatSpreadable]) // undefinedconsole.log(init,concat(arr)) // [&#x27;foo&#x27;, &#x27;bar&#x27;]arr[Symbol.isConcatSpreadable] = false;console.log(init.concat(arr)) // [&#x27;foo&#x27;, Array(1)];let likeObj = &#123; length:1, 0: &#x27;bar&#x27;&#125;;console.log(likeObj[Symbol.isConcatSpreadable]); //undefinedconsole.log(init.cancat(likeObj)) // [&#x27;foo&#x27;, &#123;...&#125;];likeObj[Symbol.isConcatSpreadable] = true;console.log(init.concat(likeObj)) // [&#x27;foo&#x27;, &#x27;bar&#x27;] 4) Symbol.iteratoræ ‡è¯†ä¸€ä¸ªæ–¹æ³•ï¼Œè¿”å›å¯¹è±¡é»˜è®¤è¿­ä»£å™¨ï¼Œç”±for-ofè¯­å¥ä½¿ç”¨ è¿™ä¸ä¸Šé¢çš„Symbol.asyncIteratorç›¸ç±»ä¼¼ 1234567891011121314151617181920212223class Bar &#123;\tconstructor(max)&#123; this.max = max; this.index = 0;\t&#125;\t*[Symbol.iterator]()&#123; while(this.index &lt; this.max)&#123; yield this.index++; &#125;\t&#125;&#125;function count()&#123;\tlet bar = new Bar(5);\tfor(const x of bar)&#123; console.log(x)\t&#125;&#125;// 0// 1// 2// 3// 4 5) Symbol.matchæ ‡è¯†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨æ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…å­—ç¬¦ä¸²ï¼› ç”±String.prototype.match()æ–¹æ³•ä½¿ç”¨ï¼Œä½¿ç”¨ä»¥Symbol.matchä¸ºé”®çš„å‡½æ•°æ¥å¯¹è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ±‚å€¼ã€‚æ­£åˆ™è¡¨è¾¾å¼çš„åŸå‹ä¸Šé»˜è®¤æœ‰è¿™ä¸ªå‡½æ•°çš„å®šä¹‰ 1234console.log(RegExp.prototype[Symbol.match]);// f [Symbol.match]() &#123; [native code] &#125;console.log(&#x27;foobar&#x27;.match(/bar/));// [&quot;bar&quot;, index: 3, input: &quot;foobar&quot;, groups: undefined] ç»™è¿™ä¸ªæ–¹æ³•ä¼ å…¥éæ­£åˆ™çš„è¡¨è¾¾å¼å€¼ä¼šå¯¼è‡´è¯¥å€¼å‘—è½¬æ¢ä¸ºRegExpå¯¹è±¡ï¼Œå¦‚æœæƒ³è¦æ”¹å˜è¿™è¡Œä¸ºï¼Œå…è®¸æ–¹æ³•ç›´æ¥ä½¿ç”¨å‚æ•°ï¼Œåˆ™é‡æ–°å®šä¹‰Symbol.match 123456789101112131415161718class FooMatcher &#123; static [Symbol.match](target)&#123; return target.includes(&#x27;foo&#x27;) &#125;&#125;console.log(&#x27;foobar&#x27;.match(FooMacther)) // true;class StringMatcher&#123; constructor(str)&#123; this.str = str; &#125; [Symbol.match](target)&#123; return target.includes(this.str); &#125;&#125;console.log(&#x27;foobar&#x27;.match(new StringMacther(&#x27;foo&#x27;))) // true 6) Symbol.replaceæ ‡è¯†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æ–¹æ³•ï¼Œæ›¿æ¢ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­åŒ¹é…çš„å­ä¸²ï¼› ç”±String.prototype.replace()æ–¹æ³•ä¼šä½¿ç”¨ä»¥Symbol.replaceä¸ºé”®çš„å‡½æ•°æ¥å¯¹æ­£åˆ™è¡¨è¾¾å¼æ±‚å€¼, å’Œä¸Šé¢çš„matchä¸€æ ·ï¼Œä¸ºäº†é˜»æ­¢é»˜è®¤çš„éæ­£åˆ™è¡¨è¾¾å¼å€¼è¢«å¼ºè¡Œè½¬æ¢ä¸ºRegExpå¯¹è±¡ï¼Œå¯ä»¥è¦†ç›–é»˜è®¤è¡Œä¸º 123456789101112131415161718class FooReplacer &#123; static [Symbol.replace](target, replacememt) &#123; return target,split(&#x27;foo&#x27;).join(replacement); &#125;&#125;console.log(&#x27;barfoobaz&#x27;.replace(FooReplacer, &#x27;quz&#x27;));// barquxbazclass StringReplacer &#123; constructor(str)&#123; this.str = str; &#125; [Symbol.replace](target, replacement)&#123; return target.split(this.str).join(replacement); &#125;&#125;console.log(&#x27;barfoobaz&#x27;.replace(new StringReplacer(&#x27;foo&#x27;), &#x27;quz&#x27;));// barfoobaz 7ï¼‰Symbol.searchæ ‡è¯†ä¸€ä¸ªæ­£åˆ™çš„æ–¹æ³•ï¼Œè¿”å›å­—ç¬¦ä¸²ä¸­åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„ç´¢ä»¥ã€‚ ç”±String.prototype.search()æ–¹æ³•ä½¿ç”¨ã€‚String.prototype.search()æ–¹æ³•ä¼šä½¿ç”¨ä»¥Symbol.searchä¸ºé”®çš„å‡½æ•°æ¥å¯¹æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼, åŒæ ·å’Œä¸Šè¿°ä¸¤ä¸ªæ–¹æ³•ä¸€æ ·ï¼Œä¸ºäº†é˜»æ­¢é»˜è®¤çš„è¡Œä¸ºï¼Œå¯ä»¥è¦†ç›– 123456789101112console.log(&#x27;foobar&#x27;.search(/bar/)); //3class StringSearcher &#123;\tconstructor(str)&#123; this.str = str;\t&#125;\t[Symbol.search](target)&#123; return target.indexOf(this.str);\t&#125;&#125;console.log(&#x27;foobar&#x27;.search(new StringSeacher(&#x27;foo&#x27;))); // 0 8) Symbol.speciesæ ‡è¯†ä¸€ä¸ªå±æ€§ã€‚è¡¨ç¤ºä¸€ä¸ªå‡½æ•°å€¼ï¼Œè¯¥å‡½æ•°ä½œä¸ºåˆ›å»ºæ´¾ç”Ÿå¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚ ç”¨Symbol.speciedå®šä¹‰é™æ€çš„è·å–å™¨ï¼ˆgetterï¼‰æ–¹æ³•ï¼Œå¯è¦†ç›– 1234567891011121314151617class Bar extends Array &#123;&#125;class Baz extends Array &#123; static get [Symbol.species]()&#123; return Array; &#125;&#125;let bar = new Bar();console.log(bar instanceof Array) // true;console.log(bar instanceof Bar) // true;let baz = new Baz()console.log(baz instanceof Array) // trueconsole.log(baz instanceof Baz) // truebaz = baz.concat(&#x27;baz&#x27;);console.log(baz instanceof Array) // trueconsole.log(baz instanceof Baz) // false 9) Symbol.toPrimitiveæ ‡è¯†ä¸€ä¸ªå±æ€§æ ‡è¯†ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†å¯¹è±¡è½¬æ¢ä¸ºç›¸åº”çš„åŸå§‹å€¼ã€‚æœ‰ToPrimitiveæŠ½è±¡æ“ä½œä½¿ç”¨ å¾ˆå¤šå†…ç½®æ“ä½œéƒ½ä¼šå°è¯•å¼ºåˆ¶å°†å¯¹è±¡è½¬æ¢ä¸ºåŸå§‹çš„å€¼ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²æ•°å€¼å’ŒæœªæŒ‡å®šçš„åŸå§‹ç±»å‹ã€‚å¯¹äºä¸€ä¸ªè‡ªå®šä¹‰å¯¹è±¡å®ä¾‹ï¼Œé€šè¿‡è¿™ä¸ªå®ä¾‹çš„Symbol.toPrimitiveå±æ€§è¦†ç›–é»˜è®¤è¡Œä¸º 123456789101112131415161718192021222324252627class Foo&#123;&#125;let foo = new Foo();console.log(3 + foo); // 3[object Object]console.log(3 - foo); // NaNconsole.log(String(foo)); // [object Object]class Baz&#123; constructor()&#123; this[Symbol.toPrimitive] = function(hint)&#123; switch(hint)&#123; case &#x27;number&#x27;: return 3; case &#x27;string&#x27;: return &#x27;string bar&#x27;; case &#x27;default&#x27;: default: return &#x27;default bar&#x27;; &#125; &#125; &#125;&#125;let bar = new Bar();console.log(3 + bar) // 3default barconsole.log(3 - bar) // 0console.log(String(3)) // string bar 10ï¼‰Symbol.toStringTagæ ‡è¯†ä¸€ä¸ªå±æ€§è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²ç”¨å†åˆ›å»ºå¯¹è±¡çš„é»˜è®¤å­—ç¬¦ä¸²æè¿°ã€‚ç”±å†…ç½®æ–¹æ³•Object.prototype.toString()ä½¿ç”¨ é€šè¿‡toString()æ–¹æ³•è·å–å¯¹è±¡æ ‡è¯†æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æ£€ç´¢ç”±Symbol.toStringTagæŒ‡å®šçš„å®ä¾‹è¡¨ç¤ºç¬¦å·ï¼Œé»˜è®¤ä¸ºâ€Objectâ€ã€‚ å†…ç½®ç±»å‹ä»¥åŠæŒ‡å®šäº†è¿™ä¸ªå€¼ï¼Œè‡ªå®šä¹‰ç±»å®åŠ›è¿˜æ˜¯éœ€è¦æ˜ç¡®å®šä¹‰çš„ 1234567891011121314151617let s = new Set();console.log(s) // Set(0)&#123;&#125;console.log(s.toString()); // [object Set];console.log(s[Symbol.toStringTag]); // Setclass Baz&#123; constructor()&#123; this[Symbol.toStringTag] = &quot;Bar&quot;; &#125;&#125;let baz = new Baz(); // Baz &#123;&#125;console.log(baz.toString()) // [object Baz]console.log(baz[Symbol.toStringTag]) // Baz","tags":["Javascript","typeOf"],"categories":["Javascript"]},{"title":"var, let, constå£°æ˜å˜é‡","path":"/2021/03/14/var-let-constå£°æ˜å˜é‡/","content":"ECMAscriptä¸­å˜é‡æ˜¯æ¾æ•£ç±»å‹çš„ï¼Œæ„æ€å°±æ˜¯å¯ä»¥ç”¨äºä¿å­˜ä»»ä½•ç±»å‹çš„æ•°æ® æœ‰3ä¸ªå…³é”®å­—å¯ä»¥å£°æ˜å˜é‡ var, const, let var åœ¨æ‰€æœ‰ç‰ˆæœ¬ECMAscriptä¸­éƒ½èƒ½ç”¨ï¼Œlet conståªèƒ½åœ¨ES6ä¸­ä½¿ç”¨ var å…³é”®å­—1var a = 11212 1. var å£°æ˜ä½œç”¨åŸŸä½¿ç”¨varæ“ä½œç¬¦å·å®šä¹‰çš„å˜é‡ä¼šæˆä¸ºåŒ…å«å®ƒçš„å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œä¼šè¢«æ‹¿åˆ°å‡½æ•°æˆ–å…¨å±€ä½œç”¨åŸŸå¾—é¡¶éƒ¨ 12345function hello()&#123;\tvar a = &#x27;hi&#x27;; // å±€éƒ¨å˜é‡&#125;hello();console.log(a); // å‡ºé”™ è¿™é‡Œå£°æ˜äº†aå˜é‡ï¼Œå‡½æ•°ä½¿ç”¨å®Œé€€å‡ºä¹‹åå°±é”€æ¯äº†è¿™ä¸ªaå˜é‡ ä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µï¼Œç›´æ¥åœ¨å‡½æ•°ä¸­å£°æ˜å…¨å±€å˜é‡ 12345function hello()&#123; a=&#x27;hi&#x27;;&#125;hello();console.log(a); // hi è°ƒç”¨hello()å‡½æ•°ä¹‹åå…¨å±€æ³¨å…¥äº†ä¸€ä¸ªaçš„å˜é‡ï¼Œè¿™ä¸ªå˜é‡ è™½ç„¶å¯ä»¥é€šè¿‡çœç•¥varæ“ä½œç¬¦å®šä¹‰å…¨å±€å˜é‡ï¼Œä½†æ˜¯ä¸æ¨èã€‚å±€éƒ¨ä½œç”¨åŸŸä¸­å®šä¹‰å…¨å±€å˜é‡å¾ˆéš¾ç»´æŠ¤ã€‚ 2. varå£°æ˜æå¼ï¼ˆå˜é‡æå‡hoistï¼‰å¦‚ä¸‹ 12345function foo()&#123; console.log(a); var a = &#x27;1212&#x27;;&#125;foo(); // undifined aå˜é‡åœ¨å®šä¹‰ä¹‹å‰å°±å·²ç»è¢«è®¿é—®ï¼Œä½†æ˜¯å…³é”®å­—ä¼šè‡ªåŠ¨æå‡åˆ°å‡½æ•°ä½œç”¨åŸŸçš„é¡¶éƒ¨ ç­‰ä»·äº 123456function foo()&#123; var a; console.log(a); a = &#x27;1212&#x27;;&#125;foo(); 3. å…¨å±€å˜é‡å£°æ˜åœ¨å…¨å±€ä¸­ä½¿ç”¨varæ¥å£°æ˜å˜é‡ï¼Œè¿™ä¸ªå˜é‡ä¼šæˆä¸ºwindowå¯¹è±¡çš„å±æ€§ 12var name = &#x27;weng&#x27;;console.log(window.name) // weng letå£°æ˜1. letçš„å—ä½œç”¨åŸŸ letå’Œvarçš„ä½œç”¨å·®ä¸å¤šï¼Œä½†æ˜¯æœ‰å¾ˆå¤§åŒºåˆ«ã€‚æœ€æ˜æ˜¾çš„æ˜¯Letå£°æ˜çš„èŒƒå›´æ˜¯å—ä½œç”¨åŸŸï¼Œ è€Œvarå£°æ˜çš„èŒƒå›´æ˜¯å‡½æ•°ä½œç”¨åŸŸ var 12345if(true)&#123; var name = &#x27;a&#x27;; console.log(name); // a&#125;console.log(name); // a let 12345if(true)&#123; let name = &#x27;a&#x27;; console.log(name); // a&#125;console.log(name); // ReferenceError:name æ²¡æœ‰å®šä¹‰ è¿™é‡Œç”¨letå£°æ˜çš„å˜é‡ä¹‹æ‰€ä»¥ä¸èƒ½åœ¨ifå—å¤–éƒ¨è¢«å¼•ç”¨ï¼Œæ˜¯å› ä¸ºå®ƒçš„ä½œç”¨åŸŸä»…é™äºè¯¥å—çš„å†…éƒ¨ å—ä½œç”¨åŸŸæ˜¯å‡½æ•°ä½œç”¨åŸŸçš„å­é›†ï¼Œ å‡½æ•°ä½œç”¨åŸŸ &gt; å—ä½œç”¨åŸŸ å› æ­¤é€‚ç”¨äºvarçš„ä½œç”¨åŸŸä¹Ÿé€‚ç”¨äºletä½œç”¨åŸŸ å½“ç„¶letä¹Ÿä¸å…è®¸åŒä¸€ä¸ªå—ä½œç”¨åŸŸä¸­å‡ºç°å†—ä½™çš„å£°æ˜ï¼Œè¿™æ ·ä¼šæŠ¥é”™ 12345var name;var name;let age;let age; // SntaxError;æ ‡è¯†ç¬¦ageå·²ç»å£°æ˜è¿‡äº† jså¼•æ“ä¼šè®°å½•ç”¨äºå˜é‡å£°æ˜çš„æ ‡è¯†ç¬¦ä»¥åŠå…¶æ‰€åœ¨çš„å—ä½œç”¨åŸŸï¼ŒåµŒå¥—ä½¿ç”¨ç›¸åŒçš„æ ‡è¯†ç¬¦ä¸ä¼šæŠ¥é”™ï¼Œå› ä¸ºåœ¨åŒä¸€å—ä¸­æ²¡æœ‰é‡å¤å£°æ˜ 123456let age =30;console.log(age);function hello()&#123;\tlet age = 20; console.log(age); // 20&#125; 2. æš‚æ—¶æ€§æ­»åŒºï¼ˆletä¸å­˜åœ¨å˜é‡æå‡ï¼‰let ä¸varçš„å¦å¤–ä¸€ä¸ªé‡è¦åŒºåˆ«å°±æ˜¯letå£°æ˜çš„å˜é‡ä¸ä¼šåœ¨æ‰€å¯¹åº”çš„å—ä½œç”¨åŸŸä¸­è¢«æå‡ 12console.log(name); // ReferenceError; ageæœªè¢«å®šä¹‰let age = 2; letå’ŒvaråŒç†ï¼Œåœ¨è®¿é—®nameå˜é‡çš„æ—¶å€™jsä¼šå»æ‰¾å—åé¢çš„letå£°æ˜ï¼Œåªæ˜¯varå£°æ˜çš„å˜é‡å¯ä»¥æå‰è®¿é—®ï¼Œletä¸èƒ½å¤Ÿæå‰è®¿é—®ï¼› åœ¨letå£°æ˜ä¹‹å‰æ‰§è¡Œç¬é—´è¢«ç§°ä½œâ€œæš‚æ—¶æ€§æ­»åŒºâ€ 3.å…¨å±€å˜é‡å£°æ˜12let age = 26;console.log(window.age) // undifined letå…¨å±€å£°æ˜çš„å˜é‡å¹¶ä¸ä¼šæˆä¸ºwindowå¯¹è±¡çš„å±æ€§è¿™ç‚¹ä¸varæœ‰åŒºåˆ« ä¸è¿‡letå£°æ˜åœ¨å…¨å±€ä½œç”¨åŸŸä¸­å‘ç”Ÿï¼Œç›¸å¯¹åº”çš„å˜é‡ä¼šåœ¨é¡µé¢çš„å£°æ˜å‘¨æœŸä¸­ç»­å­˜ 4.forå¾ªç¯ä¸­çš„letå£°æ˜åœ¨letå‡ºç°ä¹‹å‰ï¼Œforå¾ªç¯ä½“å®šä¹‰çš„è¿­ä»£å˜é‡ä¼šæ¸—é€åˆ°å¾ªç¯ä½“çš„å¤–éƒ¨ 1234for(var i =0;i&lt;9;i++)&#123; // ....&#125;console.log(i); // 9 åœ¨ä½¿ç”¨letä¹‹åè¿™ä¸ªé—®é¢˜å°±æ¶ˆå¤±äº†ï¼› 1234for(let i = 0;i&lt;9;i++)&#123; // ....&#125;console.log(i); // ReferenceError;i æ²¡æœ‰å®šä¹‰ åœ¨ä½¿ç”¨varçš„æ—¶å€™ï¼Œæœ€å¸¸è§çš„é—®é¢˜å°±æ˜¯å¯¹è¿­ä»£å˜é‡çš„å¥‡ç‰¹å£°æ˜å’Œä¿®æ”¹ 12345for(var i = 0;i&lt;5;i++)&#123; setTimeout(()=&gt;console.log(i),0);&#125;// ä½ ä»¥ä¸ºçš„è¾“å‡º0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5//å®é™… 5ï¼Œ5ï¼Œ5ï¼Œ5ï¼Œ5 ä¹‹æ‰€ä»¥è¿™æ ·æ˜¯å› ä¸ºåœ¨é€€å‡ºå¾ªç¯çš„æ—¶å€™ï¼Œè¿­ä»£å˜é‡ä¿å­˜çš„æ˜¯å¯¼è‡´å¾ªç¯é€€å‡ºçš„å€¼ï¼š5. ä¹‹åæ‰§è¡Œå¼‚æ­¥é€»è¾‘çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„iéƒ½æ˜¯åŒä¸€ä¸ªå˜é‡ï¼Œå› æ­¤éƒ½æ˜¯åŒä¸€ä¸ªæœ€ç»ˆå€¼ è€Œä½¿ç”¨leyå£°æ˜è¿­ä»£å˜é‡çš„æ—¶å€™ï¼Œjså¼•æ“ä¼šåœ¨åå°ä¸ºæ¯ä¸ªè¿­ä»£å¾ªç¯å£°æ˜ä¸€ä¸ªæ–°çš„è¿­ä»£å˜é‡ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªå†…éƒ¨çš„å¼‚æ­¥å‡½æ•°å¼•ç”¨çš„éƒ½æ˜¯ä¸åŒçš„å˜é‡å®ä¾‹ï¼Œæ‰€ä»¥console.log()è¾“å‡ºçš„æ˜¯æˆ‘ä»¬æœŸæœ›çš„å€¼ constå£°æ˜ constå’Œletç›¸åŒï¼Œå”¯ä¸€åŒºåˆ«å°±æ˜¯å®ƒå£°æ˜çš„å˜é‡æ—¶å¿…é¡»åˆå§‹è¯ä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”åç»­å°è¯•ä¿®æ”¹å£°æ˜çš„å˜é‡ä¼šå¯¼è‡´æŠ¥é”™ *æ³¨æ„ constå£°æ˜å¾—é™åˆ¶åªé€‚ç”¨äºå®ƒæŒ‡å‘çš„å˜é‡çš„å¼•ç”¨ï¼Œæ¢å¥è¯è¯´ï¼Œå¦‚æœconstå˜é‡çš„å¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆä¿®æ”¹è¿™ä¸ªå¯¹è±¡å†…éƒ¨çš„å±æ€§ï¼Œå¹¶ä¸è¿åconstçš„é™åˆ¶ ä¸€èˆ¬constç”¨åœ¨for..of for.. in è¯­å¥ä¸­","tags":["Javascript","å˜é‡"],"categories":["Javascript"]},{"title":"frå•ä½é…åˆgridå¸ƒå±€","path":"/2021/03/12/frå•ä½é…åˆgridå¸ƒå±€/","content":"åœ¨ç½‘æ ¼å¸ƒå±€ä¸­çš„è¿ç”¨ ç½‘æ ¼å¸ƒå±€æ”¯æŒå¼¹æ€§å°ºå¯¸ï¼ˆflex-sizeï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è‡ªé€‚åº”å¸ƒå±€æŠ€æœ¯ã€‚fræ˜¯ä¸€ä¸ªç›¸å¯¹å°ºå¯¸å•ä½ï¼Œè¡¨ç¤ºå‰©ä½™ç©ºé—´åšç­‰åˆ†ï¼Œæ­¤é¡¹åˆ†é…åˆ°çš„ç™¾åˆ†æ¯”(å¦‚æœåªæœ‰ä¸€ä¸ªé¡¹ä½¿ç”¨æ­¤å•ä½ï¼Œé‚£å°±å å‰©ä½™ç©ºé—´çš„100%ï¼Œæ‰€ä»¥å¤šä¸ªé¡¹è”åˆä½¿ç”¨æ›´æœ‰æ„ä¹‰) å¼¹æ€§å°ºå¯¸ä½¿ç”¨frå°ºå¯¸å•ä½ï¼Œå…¶æ¥è‡ª â€œfractionâ€ æˆ– â€œfractional unitâ€ å•è¯çš„å‰ä¸¤ä¸ªå­—æ¯ï¼Œè¡¨ç¤ºæ•´ä½“ç©ºé—´çš„ä¸€éƒ¨åˆ†ã€‚ ç»“åˆgridå¸ƒå±€å¯ä»¥å®ç°ç­‰åˆ†è¡Œåˆ—çš„çƒ¦æ¼ ç¤ºä¾‹ ä»£ç å¦‚ä¸‹ 123456789101112131415161718192021222324&lt;style&gt; .grid &#123; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px 20px; width: 500px; padding: 10px; background: bisque; &#125; .grid-item &#123; background-color: aquamarine; &#125;&lt;/style&gt;&lt;div class=&quot;grid&quot;&gt; &lt;div class=&quot;grid-item&quot;&gt; &lt;p&gt;12121&lt;/p&gt; &lt;/div&gt; &lt;div class=&quot;grid-item&quot;&gt; &lt;p&gt;12121&lt;/p&gt; &lt;/div&gt; &lt;div class=&quot;grid-item&quot;&gt; &lt;p&gt;12121&lt;/p&gt; &lt;/div&gt;&lt;/div&gt; å‘å¦‚æœå†…éƒ¨çš„å…ƒç´ å†…å®¹å¾ˆå¤šå°±ä¼šå®¹æ˜“é€ æˆä¸ç­‰åˆ†çš„æƒ…å†µ å¦‚å›¾ è§£å†³æ–¹æ¡ˆ 1grid-template-columns: repeat(3, minmax(10px,1fr)); ç»™äº†10pxçš„æœ€å°å®½åº¦å€¼ã€‚è§£å†³äº†æœ€å°å®½åº¦ä¸ç¡®å®šå¯¼è‡´çš„æº¢å‡ºé—®é¢˜ã€åŒæ—¶10pxæœ€å°å®½åº¦æ¯”èµ·0pxé¿å…äº†å…ƒç´ ç›´æ¥æ¶ˆå¤±ï¼Œå½“é—®é¢˜å‡ºç°æ—¶å¯å‡å°è°ƒè¯•æˆæœ¬ã€‚","tags":["Css","gridå¸ƒå±€"],"categories":["Css"]},{"title":"ç®­å¤´å‡½æ•°ç†è§£","path":"/2021/03/08/ç®­å¤´å‡½æ•°ç†è§£/","content":"ç®­å¤´å‡½æ•°es6è¯­æ³• 12// ES6è¯­æ³•const fn = v =&gt; v; ä¸€. ç‰¹ç‚¹1. è¯­æ³•ç®€ä»‹ç®­å¤´å‡½æ•°çœå»äº†functionå…³é”®å­—ï¼Œç”¨=&gt;ä»£æ›¿functionï¼Œåœ†æ‹¬å·ä»£è¡¨å‚æ•°éƒ¨åˆ†ï¼Œå½“åªæœ‰ä¸€ä¸ªå‚æ•°æ—¶ï¼Œåœ†æ‹¬å·å¯çœç•¥ï¼Œå½“åªæœ‰ä¸€è¡Œè¿”å›è¯­å¥æ—¶ï¼Œreturnå’ŒèŠ±æ‹¬å·&#123;&#125;éƒ½å¯ä»¥çœç•¥ã€‚ 1234567891011// æ±‚ä¸¤æ•°ä¹‹å’Œconst fn = (a, b) =&gt; &#123;return a + b;&#125;; // ç­‰ä»·äº const fn = (a, b) =&gt; a + b;// æ±‚ä¸€ä¸ªæ•°ç»„å„é¡¹ä¹‹å’Œconst sum = [1, 2, 3, 4, 5].reduce((x, y) =&gt; x + y, 0); // 15// å°†æ•°ç»„ä¸­çš„å…ƒç´ æŒ‰ä»å°åˆ°å¤§é¡ºåºæ’åºconst array = [2, 4, 1, 5, 9, 7].sort((x, y) =&gt; x - y); // [1, 2, 4, 5, 7, 9]// è¿‡æ»¤æ•°ç»„ä¸­ä¸ºå¶æ•°çš„æ•°å­—const array = [0, 1, 2, 3, 4, 5, 6].filter(x =&gt; x % 2 === 0); // [0, 2, 4, 6] 2. ä¸ç»‘å®šthis ç®­å¤´å‡½æ•°ä½“å†…çš„thisæ°¸è¿œæŒ‡å‘çš„æ˜¯å®šä¹‰æ—¶æ‰€åœ¨çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯è°ƒç”¨æ—¶æ‰€åœ¨çš„å¯¹è±¡ã€‚ 1234567891011121314151617function Fn() &#123; this.s1 = 0; this.s2 = 0; // ç®­å¤´å‡½æ•° setInterval(() =&gt; this.s1++, 1000); // æ™®é€šå‡½æ•° setInterval(function() &#123; this.s2++; &#125;, 1000);&#125;var fn = new Fn();setTimeout(() =&gt; console.log(&#x27;s1= &#x27;, fn.s1), 3100); // 3.1ç§’åè¾“å‡ºs1= 3setTimeout(() =&gt; console.log(&#x27;s2= &#x27;, fn.s2), 3100); // 3.1ç§’åè¾“å‡ºs2= 0 ä¸Šé¢ä»£ç ä¸­ï¼ŒFnå‡½æ•°å†…éƒ¨è®¾ç½®äº†ä¸¤ä¸ªå®šæ—¶å™¨ï¼Œåˆ†åˆ«ä½¿ç”¨äº†ç®­å¤´å‡½æ•°å’Œæ™®é€šå‡½æ•°ã€‚ ç®­å¤´å‡½æ•°ä¸­çš„thisæŒ‡å‘å®šä¹‰æ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸï¼ˆå³Fnå‡½æ•°ï¼‰ï¼Œthis.s1++æ˜¯å¤„åœ¨ç®­å¤´å‡½æ•°ä¸­ï¼Œè¿™é‡Œçš„thiså°±æ˜¯fnï¼Œæ‰€ä»¥fn.s1çš„å€¼ä¸º3ã€‚ è€Œæ™®é€šå‡½æ•°ä¸­çš„thisæŒ‡å‘è¿è¡Œæ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸï¼ˆå³å…¨å±€å¯¹è±¡windowï¼‰ï¼Œthis.s2++å®é™…ç­‰äºwindow.s2++ï¼Œfn.s2ä¸€æ¬¡éƒ½æ²¡æœ‰æ›´æ–°ï¼Œå› è€Œå¾—åˆ°çš„æ˜¯0ã€‚ æ‰€ä»¥ï¼Œä»ä¸¥æ ¼æ„ä¹‰ä¸Šè®²ï¼Œç®­å¤´å‡½æ•°ä¸­ä¸ä¼šåˆ›å»ºè‡ªå·±çš„thisï¼Œè€Œæ˜¯ä¼šä»è‡ªå·±ä½œç”¨åŸŸé“¾çš„ä¸Šä¸€å±‚ç»§æ‰¿ã€‚ 12345678910111213141516171819const Person = &#123; name: &#x27;Kimmy&#x27;, age: 20, doSomething: function() &#123; setTimeout(() =&gt; console.log(`name: $&#123;this.name&#125;, age: $&#123;this.age&#125;`), 1000); &#125;&#125;;Person.doSomething(); // name: Kimmy, age: 20const Person2 = &#123; name: &#x27;Kimmy&#x27;, age: 20, doSomething: () =&gt; &#123; setTimeout(() =&gt; console.log(`name: $&#123;this.name&#125;, age: $&#123;this.age&#125;`), 1000); &#125;&#125;;Person2.doSomething(); // name: , age: undefined ä¸Šé¢ä¸¤æ®µä»£ç çš„å”¯ä¸€åŒºåˆ«åœ¨äºdoSomething()å‡½æ•°çš„å†™æ³•ï¼ŒPersonä¸­ä½¿ç”¨äº†æ™®é€šå‡½æ•°å®šä¹‰ï¼ŒPerson2ä¸­ä½¿ç”¨äº†ç®­å¤´å‡½æ•°å®šä¹‰ã€‚ åœ¨ç¬¬ä¸€æ®µä»£ç ä¸­ï¼ŒPerson.doSomeThing()ä¸­çš„thisæŒ‡å‘å‡½æ•°çš„è°ƒç”¨ä½“ï¼Œå³Personæœ¬èº«ï¼Œåœ¨è°ƒç”¨setTimeout()å‡½æ•°æ—¶ï¼Œç”±äºå…¶å‡½æ•°ä½“éƒ¨åˆ†æ˜¯é€šè¿‡ç®­å¤´å‡½æ•°å®šä¹‰çš„ï¼Œå†…éƒ¨çš„thisä¼šç»§æ‰¿çˆ¶ä½œç”¨åŸŸçš„thisï¼ˆå³Personï¼‰ï¼Œä»è€Œè¾“å‡ºname: Kimmy, age: 20ã€‚ åœ¨ç¬¬äºŒæ®µä»£ç ä¸­ï¼ŒPerson2.doSomething()ä¸­çš„thisæŒ‡å‘å¤–å±‚ä½œç”¨åŸŸï¼Œè€ŒPerson2çš„çˆ¶ä½œç”¨åŸŸæ˜¯å…¨å±€ä½œç”¨åŸŸwindowï¼Œåœ¨è°ƒç”¨setTimeout()å‡½æ•°æ—¶ï¼Œç”±äºå…¶å‡½æ•°ä½“éƒ¨åˆ†æ˜¯é€šè¿‡ç®­å¤´å‡½æ•°å®šä¹‰çš„ï¼Œå†…éƒ¨çš„thisä¼šç»§æ‰¿doSomething()å‡½æ•°æ‰€åœ¨çš„ä½œç”¨åŸŸthisï¼ˆå³windowï¼‰ï¼Œè€Œwindowä¸Šnameå±æ€§æ˜¯&#39;&#39;ï¼Œageå±æ€§ä¸å­˜åœ¨ï¼Œæ‰€ä»¥Person2.doSomething()è¾“å‡ºname: , age: undefinedã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œç®­å¤´å‡½æ•°æ ¹æœ¬æ²¡æœ‰è‡ªå·±çš„thisï¼Œå¯¼è‡´å†…éƒ¨çš„thiså°±æ˜¯å¤–å±‚ä»£ç å—çš„thisã€‚æ­£å› ä¸ºå®ƒæ²¡æœ‰thisï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸èƒ½ç”¨ä½œæ„é€ å‡½æ•°ã€‚ 3. ä¸æ”¯æŒ call()ã€ apply()ã€bind() å‡½æ•°çš„ç‰¹æ€§é€šè¿‡è°ƒç”¨ call() ã€apply()ã€bind() å‡½æ•°å¯ä»¥æ”¹å˜ä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œä¸»ä½“ï¼Œå³æ”¹å˜è¢«è°ƒç”¨å‡½æ•°ä¸­ this çš„æŒ‡å‘ ä½†ç®­å¤´å‡½æ•°ä¸­ä¸æ”¯æŒ call() ã€apply()ã€bind()ç­‰ï¼Œå› ä¸ºç®­å¤´å‡½æ•°ä¸­æ²¡æœ‰è‡ªå·±çš„ this ï¼Œè€Œæ˜¯ç»§æ‰¿çˆ¶ä½œç”¨åŸŸä¸­çš„ thisã€‚ 12345678910function fn() &#123; return () =&gt; &#123; console.log(`id= $&#123;this.id&#125;`); &#125;&#125;let f = fn.call(&#123;id: 1&#125;); // id= 1let f2 = f.call(&#123;id: 2&#125;)()(); // id = 1let f3 = f().call(&#123;id: 3&#125;)(); // id= 1let f4 = f()().call(&#123;id: 4&#125;); // id= 1 ä¸Šé¢ä»£ç ä¸­åªæœ‰ä¸€ä¸ªthisï¼Œå³å‡½æ•°fnçš„thisï¼Œæ‰€ä»¥f2ã€f3ã€f4éƒ½è¾“å‡ºåŒæ ·çš„ç»“æœã€‚å› ä¸ºå†…å±‚å‡½æ•°æ—¶ç®­å¤´å‡½æ•°ï¼Œæ²¡æœ‰è‡ªå·±çš„thisï¼Œå®ƒä»¬çš„thiséƒ½æ˜¯æœ€å¤–å±‚fnå‡½æ•°æ˜¯thisã€‚ 4. ä¸ç»‘å®š arguments åœ¨æ™®é€šå‡½æ•°functionä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡argumentså¯¹è±¡æ¥è·å–åˆ°å®é™…ä¼ å…¥çš„å‚æ•°å€¼ï¼Œä½†åœ¨ç®­å¤´å‡½æ•°ä¸­æ˜¯ä¸å­˜åœ¨çš„ã€‚ 123456789101112const fn = () =&gt; &#123; console.log(arguments);&#125;fn(1, 2); // Uncaught ReferenceError: arguments is not definedfunction fn() &#123; setTimeout(() =&gt; &#123; console.log(arguments); &#125;, 0);&#125;fn(1, 2); // [1, 2] 5.æ”¯æŒåµŒå¥—12345const pipeline = (...funcs) =&gt; val =&gt; funcs.reduce((a, b =&gt; b(a)), val);const plus1 = a =&gt; a + 1;const mult2 = a =&gt; a * 2;const addThenMult = pipeline(plus1, mult2);addThenMult(5); // 12 äºŒ.ç®­å¤´å‡½æ•°ä¸é€‚ç”¨åœºæ™¯ï¼ˆ1ï¼‰å®šä¹‰å¯¹è±¡çš„æ–¹æ³•ä¸”è¯¥æ–¹æ³•å†…éƒ¨åŒ…æ‹¬this1234567const Person = &#123; name: &#x27;Kimmy&#x27;, age: 20, doSomething: () =&gt; &#123; this.age++; &#125;&#125;; Person.doSomething()æ–¹æ³•æ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œè°ƒç”¨Person.doSomething()æ—¶ï¼Œå¦‚æœæ˜¯æ™®é€šå‡½æ•°ï¼Œè¯¥æ–¹æ³•å†…éƒ¨çš„thisæŒ‡å‘Personï¼Œå¦‚æœå†™æˆä¸Šé¢é‚£æ ·çš„ç®­å¤´å‡½æ•°ï¼Œä½¿å¾—thisæŒ‡å‘å…¨å±€å¯¹è±¡ã€‚ ï¼ˆ2ï¼‰ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°ï¼Œä¸èƒ½ä½¿ç”¨ new æ“ä½œç¬¦æ„é€ å‡½æ•°æ—¶é€šè¿‡newæ“ä½œç¬¦ç”Ÿæˆå¯¹è±¡å®ä¾‹çš„ï¼Œç”Ÿæˆå®ä¾‹çš„è¿‡ç¨‹ä¹Ÿæ˜¯é€šè¿‡æ„é€ å‡½æ•°ç»™å®ä¾‹ç»‘å®šthisçš„è¿‡ç¨‹ï¼Œè€Œç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„thisï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°ï¼Œä¹Ÿä¸èƒ½é€šè¿‡newæ“ä½œç¬¦æ¥è°ƒç”¨ç®­å¤´å‡½æ•°ã€‚ 1234567891011// æ™®é€šå‡½æ•°function Person(name) &#123; this.name = name;&#125;let p = new Person(&#x27;Kimmy&#x27;); // æ­£å¸¸// ç®­å¤´å‡½æ•°let Person = (name) =&gt; &#123; this.name = name;&#125;let p = new Person(&#x27;Kimmy&#x27;); // Uncaught TypeError: Person is not a constructor ï¼ˆ3ï¼‰æ²¡æœ‰ prototype å±æ€§12345678let a = () =&gt; 1;function b() &#123; return 2;&#125;a.prototype // undefinedb.prototype // &#123;constructor: Æ’&#125; ï¼ˆ4ï¼‰ä¸é€‚åˆå°†åŸå‹å‡½æ•°å®šä¹‰æˆç®­å¤´å‡½æ•°åœ¨ç»™æ„é€ å‡½æ•°æ·»åŠ åŸå‹å‡½æ•°æ—¶ï¼Œå¦‚æœä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œå…¶ä¸­çš„thisä¼šæŒ‡å‘å…¨å±€ä½œç”¨åŸŸwindowï¼Œè€Œå¹¶ä¸ä¼šæŒ‡å‘æ„é€ å‡½æ•°ï¼Œå› æ­¤å¹¶ä¸ä¼šè®¿é—®åˆ°æ„é€ å‡½æ•°æœ¬èº«ï¼Œä¹Ÿå°±æ— æ³•è®¿é—®åˆ°å®ä¾‹å±æ€§ï¼Œè¿™å°±å¤±å»äº†ä½œä¸ºåŸå‹å‡½æ•°çš„æ„ä¹‰ã€‚","tags":["Javascript","ES6"],"categories":["Javascript"]},{"title":"å·¥ä½œä¸­å¸¸ç”¨çš„Gitå‘½ä»¤","path":"/2021/03/04/å·¥ä½œä¸­å¸¸ç”¨çš„Gitå‘½ä»¤/","content":"å¸¸ç”¨çš„åŸºæœ¬æ“ä½œgit initè¿™ä¸ªgit initä¸ç”¨å¤šè¯´ï¼Œå¤§å®¶éƒ½çŸ¥é“è¿™ä¸ªå‘½ä»¤æ˜¯åˆå§‹åŒ–å½“å‰ç›®å½•å˜æˆå¯ä»¥ä½¿ç”¨gitç®¡ç†çš„ä»“åº“ï¼Œå¹¶ä¸”æ˜¯ç©ºçš„ã€‚ git clone è¿œç¨‹åœ°å€[url]é€šè¿‡git cloneå‘½ä»¤ä»è¿œç¨‹åœ°å€ä¸‹è½½å‡ºæ¥ï¼Œè¿™ä¸ªä¹Ÿä¸ç”¨è¿‡å¤šæè¿°ã€‚ git statusgit statusæŸ¥çœ‹æœ¬æ¬¡æœ¬åœ°æœ‰å¤šå°‘ä¸ªæ–‡ä»¶å‘ç”Ÿå˜æ›´ã€‚å¯ä»¥çœ‹åˆ°index.cssdå’Œindex.htmlå‘ç”Ÿå˜æ›´ git loggit logæŸ¥çœ‹å½“å‰æäº¤çš„æ—¥å¿—ã€‚ git diffgit diffæ˜¯æŸ¥çœ‹å½“å‰æ”¹åŠ¨çš„æ–‡ä»¶å…·ä½“ä»£ç å†…å®¹æ¯”å¯¹ã€‚ git checkout .git checkout .å°±æ˜¯æ‰€æœ‰æœ‰æ”¹åŠ¨çš„å…¨éƒ¨æ¢å¤åˆ°åŸæ¥çš„æ ·å­, å½“ç„¶ä¹Ÿå¯ä»¥æ¢å¤æŒ‡å®šçš„å¦‚ï¼šgit checkout index.cssåªæ¢å¤è¿™ä¸ªæ–‡ä»¶å½“å‰çš„ä¿®æ”¹ã€‚ git add .git add .æ˜¯å°†ä¿®æ”¹çš„å†…å®¹æ–°å¢åˆ°æš‚å­˜åŒºï¼Œä¹Ÿå¯ä»¥æäº¤æŒ‡å®šçš„çš„æ–‡ä»¶ã€‚ git commit -m â€œä½ çš„è¦æäº¤çš„æ³¨é‡Šâ€git commit -mè¿™é‡Œçš„å†…å®¹ä»æš‚å­˜åŒºå†™å…¥åˆ°å¯¹è±¡åº“ä¸­, æ³¨æ„æ³¨é‡Šå¿…é¡»å†™ã€‚ git tagæŸ¥çœ‹å½“å‰tagæ ‡ç­¾ git tag tagName(ä½ çš„tagåç§°)æ–°å»ºä¸€ä¸ªTagæ ‡ç­¾ git tag -a tagName -m â€œtagå¤‡æ³¨â€æ–°å»ºä¸€ä¸ªtagæ ‡ç­¾å¸¦æœ‰å¤‡æ³¨ä¿¡æ¯ git show tagName(ä½ çš„tagæ ‡ç­¾å)æŸ¥çœ‹å½“å‰tagå¤‡æ³¨ä¿¡æ¯ git push origin tagName(ä½ çš„tagåç§°)git push origin v1.0æ¨é€åˆ°è¿œç¨‹ git push origin branch(ä½ çš„åˆ†æ”¯)git push origin branchæ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚ git pull origin branch(ä½ çš„åˆ†æ”¯)git pull origin branchä»è¿œç¨‹æ‹‰å–åˆ°æœ¬åœ°ã€‚ git checkout branch(ä½ çš„åˆ†æ”¯)git checkout branchåˆ‡æ¢åˆ°åˆ«çš„åˆ†æ”¯ä¸Šã€‚ git checkout -b branch(ä½ çš„åˆ†æ”¯)git checkout -b branch(åˆ†æ”¯åç§°)æ–°å»ºä¸€ä¸ªåˆ†æ”¯å¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯ä¸Šã€‚ git branch -vgit branch -væŸ¥çœ‹å½“å‰çš„åˆ†æ”¯å¹¶ä¸”åé¢å¸¦æœ‰æœ€åä¸€æ¬¡æäº¤çš„ä¿¡æ¯ git branch -agit branch -aæŸ¥çœ‹å½“å‰æ‰€æœ‰çš„åˆ†æ”¯åŒ…æ‹¬è¿œç¨‹åˆ†æ”¯ git branch branch(ä½ çš„åˆ†æ”¯)git branch barnch(ä½ çš„åˆ†æ”¯åç§°)æ–°å»ºä¸€ä¸ªæœ¬åœ°åˆ†æ”¯ã€‚ git branch -D name(åˆ†æ”¯å)git branch -D name(åˆ†æ”¯å) åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼Œä½†æ˜¯ä¸èƒ½åœ¨å½“å‰çš„åˆ†æ”¯ä¸Šåˆ é™¤å½“å‰åˆ†æ”¯ï¼Œå¿…é¡»åˆ‡æ¢åˆ°åˆ«çš„åˆ†æ”¯ä¸Šï¼Œåˆ é™¤å…¶å®ƒåˆ†æ”¯ã€‚ git remote -vgit remote -væŸ¥çœ‹æºåœ°å€ git remove remote name(æºåœ°å€åå­—)git remove remote nameåˆ é™¤æºåœ°å€ã€‚ git remote add name(æºåœ°å€åå­—) è¿œç¨‹åœ°å€[url]git remote add name urlæ·»åŠ ä¸€ä¸ªæºåœ°å€ä¸ºè¦æäº¤ä»“åº“çš„åœ°å€ã€‚ git fetch origin name(è¿œç¨‹åˆ†æ”¯åç§°)git fetch origin nameå¦‚æœæˆ‘ä»¬æœ¬åœ°æ²¡æœ‰è¯¥åˆ†æ”¯ï¼Œè¿œç¨‹æœ‰è¯¥åˆ†æ”¯ï¼Œæˆ‘ä»¬å…ˆæ‹‰ä¸‹æ¥è¿œç¨‹åˆ†æ”¯ï¼Œå¹¶ä¸”æ–°å»ºæœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯å…³è”ä¸Šå°±å¯ä»¥äº†ã€‚ git merge name(è¦åˆå¹¶çš„åˆ†æ”¯åç§°)git merge name(è¦åˆå¹¶çš„åˆ†æ”¯åç§°)å°†è¦åˆå¹¶çš„åˆ†æ”¯åˆå¹¶åˆ°å…¶å®ƒåˆ†æ”¯ä¸Šã€‚å°†teståˆ†æ”¯ä¸Šçš„ä»£ç åˆå¹¶åˆ°developä¸Šã€‚ ç‰¹æ®Šé—®é¢˜åœºæ™¯æ€ä¹ˆè§£å†³åªæƒ³æŠŠä¸€ä¸ªæäº¤åˆå¹¶åˆ°å…¶å®ƒåˆ†æ”¯ä¸Šæ¯”å¦‚ä¸€ä¸ªåœºæ™¯developåˆ†æ”¯ä¸Šæœ‰ä¸€äº›ç‰¹æ®Šçš„ä»£ç ï¼Œæ‰€ä»¥ä¸èƒ½æŠŠè¿™ä¸ªåˆ†æ”¯ä¸Šçš„ä»£ç åˆå¹¶åˆ°teståˆ†æ”¯ä¸Šï¼Œæˆ‘ä»¬åªæƒ³åˆå¹¶å½“å‰ä¿®æ”¹çš„ä»£ç ï¼Œè¯¥æ€ä¹ˆåŠå‘¢git cherry-pickå°±æ˜¯ç”¨æ¥è§£å†³è¿™é—®é¢˜çš„ï¼Œæ¥çœ‹ä¸‹é¢ä¾‹å­ã€‚ ä¸Šé¢exampleä¸­ï¼Œgit cherry-pickåé¢è·Ÿç€ä¸€ä¸ªidè¿™ä¸ªidå°±æ˜¯åˆ«çš„åˆ†æ”¯æäº¤è®°å½•çš„idï¼ŒæŸ¥çœ‹è¿™ä¸ªidçš„è¯ä¸Šé¢è¯´è¿‡äº†ä½¿ç”¨git logæŸ¥çœ‹æ—¥å¿—ã€‚æˆ‘è¿™ä¸ªæ¡ˆä¾‹ä»£ç æ˜¯æ²¡æœ‰å‘ç”Ÿå†²çªæƒ…å†µçš„ï¼Œé‚£ä¹ˆæœ‰çš„å°ä¼™ä¼´å‘ç”Ÿå†²çªçš„è¯ï¼Œå…ˆè§£å†³å†²çªç„¶ågit add .åœ¨git cherry-pick --continueè¿™ä¸ªå‚æ•°æ˜¯ç»§ç»­æ‰§è¡Œå½“å‰çš„git cherry-pickè¿‡ç¨‹ã€‚ä¸‹é¢æ¥æŸ¥çœ‹å‡ ä¸ªå‚æ•° --continue ç”¨æˆ·è§£å†³ä»£ç å†²çªåï¼Œç¬¬ä¸€æ­¥å°†ä¿®æ”¹çš„æ–‡ä»¶é‡æ–°åŠ å…¥æš‚å­˜åŒºï¼ˆgit add .ï¼‰ï¼Œç¬¬äºŒæ­¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œè®© Cherry pick è¿‡ç¨‹ç»§ç»­æ‰§è¡Œã€‚ --abort å‘ç”Ÿä»£ç å†²çªåï¼Œæ”¾å¼ƒåˆå¹¶ï¼Œå›åˆ°æ“ä½œå‰çš„æ ·å­. --quit å‘ç”Ÿä»£ç å†²çªåï¼Œé€€å‡º Cherry pickï¼Œä½†æ˜¯ä¸å›åˆ°æ“ä½œå‰çš„æ ·å­ å¦‚æœcommitæ—¶æ³¨é‡Šå†™é”™äº†æ€ä¹ˆåŠï¼Ÿ1git commit --amend -m &quot;é‡æ–°æäº¤æ³¨é‡Š&quot; è¿œç¨‹å¼ºåˆ¶è¦†ç›–åˆ°æœ¬åœ°1234$ git fetch --all(ä¸‹è½½è¿œç¨‹åº“çš„æ‰€æœ‰å†…å®¹)$ git reset --hard origin/master(è¿œç¨‹çš„åˆ†æ”¯åç§°)$ git pullå¤åˆ¶ä»£ç  commitæäº¤å®Œæ€ä¹ˆæ’¤å›git reset HEAD~1æ’¤å›åˆšæ‰çš„æ³¨é‡Šï¼Œå¦‚æœæäº¤äº†2æ¬¡commité‚£ä¹ˆå°±æ’¤å›2æ¬¡git reset HEAD~2ã€‚ Gitå¼€å‘é”™åˆ†æ”¯äº†æ²¡æäº¤ä»£ç æ—¶ 12345git add .git stash (æŠŠæš‚å­˜åŒºçš„ä»£ç æ”¾å…¥åˆ°gitæš‚å­˜æ ˆ)git checkout name(åˆ‡æ¢åˆ°æ­£ç¡®çš„åˆ†æ”¯)git stash pop(æŠŠgitæš‚å­˜æ ˆçš„ä»£ç æ”¾å‡ºæ¥)å¤åˆ¶ä»£ç  æäº¤ä»£ç å 123456git reset HEAD~1 ï¼ˆæœ€è¿‘ä¸€æ¬¡æäº¤æ”¾å›æš‚å­˜åŒº, å¹¶å–æ¶ˆæ­¤æ¬¡æäº¤ï¼‰git stash (æš‚å­˜åŒºçš„ä»£ç æ”¾å…¥åˆ°gitæš‚å­˜æ ˆ)git checkout (åº”è¯¥æäº¤ä»£ç çš„åˆ†æ”¯)git stash pop (æŠŠgitæš‚å­˜æ ˆçš„ä»£ç æ”¾å‡ºæ¥)git checkout (åˆ‡æ¢åˆ°åˆšæ‰æäº¤é”™çš„åˆ†æ”¯ä¸Š)git push origin é”™è¯¯çš„åˆ†æ”¯ -f (æŠŠæ–‡ä»¶å›é€€æ‰)","tags":["git"],"categories":["git"]},{"title":"è¯»æ·±å…¥æµ…å‡ºwebpackåšçš„ç¬”è®°","path":"/2021/02/21/è¯»æ·±å…¥æµ…å‡ºwebpackåšçš„ç¬”è®°/","content":"ç¬¬ä¸€ç« 1.2 å¸¸è§æ„å»ºå·¥å…·å¯¹æ¯”","tags":["ä¹¦ç±","æ·±å…¥æµ…å‡ºwebpack"],"categories":["webpack"]},{"title":"å¤„ç†æ–‡ä»¶æµ","path":"/2021/02/05/å¤„ç†æ–‡ä»¶æµ/","content":"å¦‚æœåœ¨é¡¹ç›®ä¸­ç¬¬ä¸€æ¬¡é‡åˆ°ä¸‹è½½ã€å¯¼å‡ºæ–‡ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½ä¼šç›´æ¥å»è¯·æ±‚APIï¼ŒæœŸæœ›ä¼šä¸‹è½½ä¸€ä¸ªæ–‡ä»¶åˆ°æœ¬åœ°ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥æ‰“å¼€å®ƒã€‚ä½†æ˜¯çœ‹åˆ°çš„ç»“æœå´å‡ºä¹æ„æ–™ã€‚ å¹¶æ²¡æœ‰å‡ºç°æœŸæœ›çš„æƒ…å½¢ï¼Œè€Œæ˜¯è¿”å›äº†ä¸€å †â€œä¹±ç â€ã€‚ AJAXæ— æ³•ä¸‹è½½æ–‡ä»¶çš„åŸå› ä¸‹è½½å…¶å®æ˜¯æµè§ˆå™¨çš„å†…ç½®äº‹ä»¶ï¼Œæµè§ˆå™¨çš„ GETè¯·æ±‚ï¼ˆframeã€aï¼‰ã€ POSTè¯·æ±‚ï¼ˆformï¼‰å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š responseä¼šäº¤ç”±æµè§ˆå™¨å¤„ç† responseå†…å®¹å¯ä»¥ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ã€å­—ç¬¦ä¸²ç­‰ ä½†æ˜¯AJAXè¯·æ±‚ä¸ä¸€æ ·ï¼š responseä¼šäº¤ç”± Javascript å¤„ç† responseå†…å®¹åªèƒ½æ¥æ”¶å­—ç¬¦ä¸²æ‰èƒ½ç»§ç»­å¤„ç† å› æ­¤ï¼ŒAJAXæœ¬èº«æ— æ³•è§¦å‘æµè§ˆå™¨çš„ä¸‹è½½åŠŸèƒ½ã€‚ Axioså¦‚ä½•å®ç°ä¸‹è½½ å‘é€è¯·æ±‚ è·å¾—response é€šè¿‡responseåˆ¤æ–­è¿”å›æ˜¯å¦ä¸ºæµæ–‡ä»¶ å¦‚æœæ˜¯æ–‡ä»¶åˆ™åœ¨é¡µé¢ä¸­æ’å…¥frame/aæ ‡ç­¾ åˆ©ç”¨frame/aæ ‡ç­¾å®ç°æµè§ˆå™¨çš„getä¸‹è½½ é¦–å…ˆå°è£…ä¸€ä¸ªdownloadæ–¹æ³•ï¼Œç”¨äºå‘é€è¯·æ±‚ 12345678910111213141516171819202122232425// request.jsimport Axios form &#x27;axios&#x27;;/* * @params &#123;string&#125; url è¯·æ±‚åœ°å€ * @params &#123;object&#125; resOpts è¯·æ±‚é…ç½®å‚æ•° */const download = (url, resOpts = &#123;&#125;) =&gt; &#123; const &#123; type = &#x27;get&#x27;, data = &#x27;&#x27; &#125; = resOpts const queryArgs = &#123; url, method: type, data, headers: &#123; Accept: &#x27;application/json&#x27;, &#x27;Content-Type&#x27;: &#x27;application/json; charset=utf-8&#x27;, withCredentials: true, &#125;, &#125; // tips: è¿™é‡Œç›´æ¥è¿”å›çš„æ˜¯responseæ•´ä½“! return Axios.request(queryArgs).catch(err =&gt; console.log(err))&#125;... æ‹¿åˆ°responseä¹‹åæˆ‘ä»¬éœ€è¦å°†æµæ–‡ä»¶é€šè¿‡æµè§ˆå™¨ä¸‹è½½ 1234567891011121314151617181920212223242526272829303132// utils.jsexport function convertRes2Blob(response) &#123; // æå–æ–‡ä»¶å const fileName = response.headers[&#x27;content-disposition&#x27;].match( /filename=(.*)/ )[1] // å°†äºŒè¿›åˆ¶æµè½¬ä¸ºblob const blob = new Blob([response.data], &#123; type: &#x27;application/octet-stream&#x27; &#125;) if (typeof window.navigator.msSaveBlob !== &#x27;undefined&#x27;) &#123; // å…¼å®¹IEï¼Œwindow.navigator.msSaveBlobï¼šä»¥æœ¬åœ°æ–¹å¼ä¿å­˜æ–‡ä»¶ window.navigator.msSaveBlob(blob, decodeURI(filename)) &#125; else &#123; // åˆ›å»ºæ–°çš„URLå¹¶æŒ‡å‘Fileå¯¹è±¡æˆ–è€…Blobå¯¹è±¡çš„åœ°å€ const blobURL = window.URL.createObjectURL(blob) // åˆ›å»ºaæ ‡ç­¾ï¼Œç”¨äºè·³è½¬è‡³ä¸‹è½½é“¾æ¥ const tempLink = document.createElement(&#x27;a&#x27;) tempLink.style.display = &#x27;none&#x27; tempLink.href = blobURL tempLink.setAttribute(&#x27;download&#x27;, decodeURI(filename)) // å…¼å®¹ï¼šæŸäº›æµè§ˆå™¨ä¸æ”¯æŒHTML5çš„downloadå±æ€§ if (typeof tempLink.download === &#x27;undefined&#x27;) &#123; tempLink.setAttribute(&#x27;target&#x27;, &#x27;_blank&#x27;) &#125; // æŒ‚è½½aæ ‡ç­¾ document.body.appendChild(tempLink) tempLink.click() document.body.removeChild(tempLink) // é‡Šæ”¾blob URLåœ°å€ window.URL.revokeObjectURL(blobURL) &#125;&#125; ç¼ºç‚¹ downloadè¯·æ±‚æ–¹æ³•ä¸convertRes2Blobå¤„ç†æ–‡ä»¶ä¸‹è½½çš„æ–¹æ³•ï¼Œéœ€è¦åˆ†å¼€è°ƒç”¨ downloadä½¿ç”¨ç‹¬ç«‹çš„å®ä¾‹ï¼Œä¸èƒ½å…¬ç”¨ä¸€ä¸ªaxiosï¼ŒåŸºç¡€é…ç½®éœ€è¦å•ç‹¬ç»´æŠ¤","tags":["Javascript","Blob"],"categories":["Javascript"]},{"title":"æ­£åœ¨è¯»çš„ä¹¦ç±","path":"/2021/01/19/æ­£åœ¨è¯»çš„ä¹¦ç±/","content":"ã€Šæ·±å…¥æµ…å‡ºwebpackã€‹ï¼šhttps://webpack.wuhaolin.cn/%E5%89%8D%E8%A8%80.html","tags":["Javascript","webpack"],"categories":["æ­£åœ¨è¯»çš„ä¹¦ç±"]},{"title":"requestAnimationFrameå’Œä¸€èˆ¬è®¡æ—¶å™¨å¤„ç†åŠ¨ç”»åŒºåˆ«","path":"/2020/12/28/requestAnimationFrameå’Œä¸€èˆ¬è®¡æ—¶å™¨å¤„ç†åŠ¨ç”»åŒºåˆ«/","content":"åœ¨Webåº”ç”¨ä¸­ï¼Œå®ç°åŠ¨ç”»æ•ˆæœçš„æ–¹æ³•æ¯”è¾ƒå¤šï¼ŒJavascript ä¸­å¯ä»¥é€šè¿‡å®šæ—¶å™¨ setTimeoutæ¥å®ç°ï¼Œcss3 å¯ä»¥ä½¿ç”¨ transitionå’Œ animationæ¥å®ç°ï¼Œhtml5 ä¸­çš„ canvas ä¹Ÿå¯ä»¥å®ç°ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œhtml5 è¿˜æä¾›ä¸€ä¸ªä¸“é—¨ç”¨äºè¯·æ±‚åŠ¨ç”»çš„APIï¼Œé‚£å°±æ˜¯ requestAnimationFrameï¼Œé¡¾åæ€ä¹‰å°±æ˜¯è¯·æ±‚åŠ¨ç”»å¸§ã€‚ ç¼–å†™åŠ¨ç”»å¾ªç¯çš„å…³é”®æ˜¯è¦çŸ¥é“å»¶è¿Ÿæ—¶é—´å¤šé•¿åˆé€‚ã€‚ä¸€æ–¹é¢ï¼Œå¾ªç¯é—´éš”å¿…é¡»è¶³å¤ŸçŸ­ï¼Œè¿™æ ·æ‰èƒ½è®©ä¸åŒçš„åŠ¨ç”»æ•ˆæœæ˜¾å¾—å¹³æ»‘æµç•…ï¼›å¦ä¸€æ–¹é¢ï¼Œå¾ªç¯é—´éš”è¿˜è¦è¶³å¤Ÿé•¿ï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿æµè§ˆå™¨æœ‰èƒ½åŠ›æ¸²æŸ“äº§ç”Ÿçš„å˜åŒ–ã€‚ å¤§å¤šæ•°ç”µè„‘æ˜¾ç¤ºå™¨çš„åˆ·æ–°é¢‘ç‡æ˜¯60Hzï¼Œå¤§æ¦‚ç›¸å½“äºæ¯ç§’é’Ÿé‡ç»˜60æ¬¡ã€‚å¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šå¯¹é‡ç»˜æ“ä½œåŠ ä»¥é™åˆ¶ï¼Œä¸è¶…è¿‡æ˜¾ç¤ºå™¨çš„é‡ç»˜é¢‘ç‡ï¼Œå› ä¸ºå³ä½¿è¶…è¿‡é‚£ä¸ªé¢‘ç‡ç”¨æˆ·ä½“éªŒä¹Ÿä¸ä¼šæœ‰æå‡ã€‚å› æ­¤ï¼Œæœ€å¹³æ»‘åŠ¨ç”»çš„æœ€ä½³å¾ªç¯é—´éš”æ˜¯1000ms/60ï¼Œçº¦ç­‰äº16.6msã€‚ è€ŒsetTimeoutå’ŒsetIntervalçš„é—®é¢˜æ˜¯ï¼Œå®ƒä»¬éƒ½ä¸ç²¾ç¡®ã€‚å®ƒä»¬çš„å†…åœ¨è¿è¡Œæœºåˆ¶å†³å®šäº†æ—¶é—´é—´éš”å‚æ•°å®é™…ä¸Šåªæ˜¯æŒ‡å®šäº†æŠŠåŠ¨ç”»ä»£ç æ·»åŠ åˆ°æµè§ˆå™¨UIçº¿ç¨‹é˜Ÿåˆ—ä¸­ä»¥ç­‰å¾…æ‰§è¡Œçš„æ—¶é—´ã€‚å¦‚æœé˜Ÿåˆ—å‰é¢å·²ç»åŠ å…¥äº†å…¶ä»–ä»»åŠ¡ï¼Œé‚£åŠ¨ç”»ä»£ç å°±è¦ç­‰å‰é¢çš„ä»»åŠ¡å®Œæˆåå†æ‰§è¡Œã€‚ requestAnimationFrameé‡‡ç”¨ç³»ç»Ÿæ—¶é—´é—´éš”ï¼Œä¿æŒæœ€ä½³ç»˜åˆ¶æ•ˆç‡ï¼Œä¸ä¼šå› ä¸ºé—´éš”æ—¶é—´è¿‡çŸ­ï¼Œé€ æˆè¿‡åº¦ç»˜åˆ¶ï¼Œå¢åŠ å¼€é”€ï¼›ä¹Ÿä¸ä¼šå› ä¸ºé—´éš”æ—¶é—´å¤ªé•¿ï¼Œä½¿ç”¨åŠ¨ç”»å¡é¡¿ä¸æµç•…ï¼Œè®©å„ç§ç½‘é¡µåŠ¨ç”»æ•ˆæœèƒ½å¤Ÿæœ‰ä¸€ä¸ªç»Ÿä¸€çš„åˆ·æ–°æœºåˆ¶ï¼Œä»è€ŒèŠ‚çœç³»ç»Ÿèµ„æºï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œæ”¹å–„è§†è§‰æ•ˆæœ ç›¸å…³æ¦‚å¿µ1. é¡µé¢æ¿€æ´»ï¼ˆå¯è§ï¼‰ å½“é¡µé¢è¢«æœ€å°åŒ–æˆ–è€…è¢«åˆ‡æ¢æˆåå°æ ‡ç­¾é¡µæ—¶ï¼Œé¡µé¢ä¸ºä¸å¯è§ï¼Œæµè§ˆå™¨ä¼šè§¦å‘ä¸€ä¸ª visibilitychangeäº‹ä»¶,å¹¶è®¾ç½®document.hiddenå±æ€§ä¸ºtrueï¼›åˆ‡æ¢åˆ°æ˜¾ç¤ºçŠ¶æ€æ—¶ï¼Œé¡µé¢ä¸ºå¯è§ï¼Œä¹ŸåŒæ ·è§¦å‘ä¸€ä¸ª visibilitychangeäº‹ä»¶ï¼Œè®¾ç½®document.hiddenå±æ€§ä¸ºfalseã€‚ 2. åŠ¨ç”»å¸§è¯·æ±‚å›è°ƒå‡½æ•°åˆ—è¡¨ æ¯ä¸ªDocumentéƒ½æœ‰ä¸€ä¸ªåŠ¨ç”»å¸§è¯·æ±‚å›è°ƒå‡½æ•°åˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨å¯ä»¥çœ‹æˆæ˜¯ç”±``å…ƒç»„ç»„æˆçš„é›†åˆã€‚å…¶ä¸­handlerIdæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå”¯ä¸€åœ°æ ‡è¯†äº†å…ƒç»„åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®ï¼›callbackæ˜¯å›è°ƒå‡½æ•°ã€‚ 3. å±å¹•åˆ·æ–°é¢‘ç‡ å³å›¾åƒåœ¨å±å¹•ä¸Šæ›´æ–°çš„é€Ÿåº¦ï¼Œä¹Ÿå³å±å¹•ä¸Šçš„å›¾åƒæ¯ç§’é’Ÿå‡ºç°çš„æ¬¡æ•°ï¼Œå®ƒçš„å•ä½æ˜¯èµ«å…¹(Hz)ã€‚ å¯¹äºä¸€èˆ¬ç¬”è®°æœ¬ç”µè„‘ï¼Œè¿™ä¸ªé¢‘ç‡å¤§æ¦‚æ˜¯60Hzï¼Œ è¿™ä¸ªå€¼çš„è®¾å®šå—å±å¹•åˆ†è¾¨ç‡ã€å±å¹•å°ºå¯¸å’Œæ˜¾å¡çš„å½±å“ã€‚ 4. åŠ¨ç”»åŸç†æ ¹æ®ä¸Šé¢çš„åŸç†æˆ‘ä»¬çŸ¥é“ï¼Œä½ çœ¼å‰æ‰€çœ‹åˆ°å›¾åƒæ­£åœ¨ä»¥æ¯ç§’60æ¬¡çš„é¢‘ç‡åˆ·æ–°ï¼Œç”±äºåˆ·æ–°é¢‘ç‡å¾ˆé«˜ï¼Œå› æ­¤ä½ æ„Ÿè§‰ä¸åˆ°å®ƒåœ¨åˆ·æ–°ã€‚è€ŒåŠ¨ç”»æœ¬è´¨å°±æ˜¯è¦è®©äººçœ¼çœ‹åˆ°å›¾åƒè¢«åˆ·æ–°è€Œå¼•èµ·å˜åŒ–çš„è§†è§‰æ•ˆæœï¼Œè¿™ä¸ªå˜åŒ–è¦ä»¥è¿è´¯çš„ã€å¹³æ»‘çš„æ–¹å¼è¿›è¡Œè¿‡æ¸¡ã€‚ é‚£æ€ä¹ˆæ ·æ‰èƒ½åšåˆ°è¿™ç§æ•ˆæœå‘¢ï¼Ÿ åˆ·æ–°é¢‘ç‡ä¸º60Hzçš„å±å¹•æ¯16.7msåˆ·æ–°ä¸€æ¬¡ï¼Œæˆ‘ä»¬åœ¨å±å¹•æ¯æ¬¡åˆ·æ–°å‰ï¼Œå°†å›¾åƒçš„ä½ç½®å‘å·¦ç§»åŠ¨ä¸€ä¸ªåƒç´ ï¼Œå³1pxã€‚è¿™æ ·ä¸€æ¥ï¼Œå±å¹•æ¯æ¬¡åˆ·å‡ºæ¥çš„å›¾åƒä½ç½®éƒ½æ¯”å‰ä¸€ä¸ªè¦å·®1pxï¼Œå› æ­¤ä½ ä¼šçœ‹åˆ°å›¾åƒåœ¨ç§»åŠ¨ï¼›ç”±äºæˆ‘ä»¬äººçœ¼çš„è§†è§‰åœç•™æ•ˆåº”ï¼Œå½“å‰ä½ç½®çš„å›¾åƒåœç•™åœ¨å¤§è„‘çš„å°è±¡è¿˜æ²¡æ¶ˆå¤±ï¼Œç´§æ¥ç€å›¾åƒåˆè¢«ç§»åˆ°äº†ä¸‹ä¸€ä¸ªä½ç½®ï¼Œå› æ­¤ä½ æ‰ä¼šçœ‹åˆ°å›¾åƒåœ¨æµç•…çš„ç§»åŠ¨ï¼Œè¿™å°±æ˜¯è§†è§‰æ•ˆæœä¸Šå½¢æˆçš„åŠ¨ç”»ã€‚ ç‰¹ç‚¹requestAnimationFrameä¼šæŠŠæ¯ä¸€å¸§ä¸­çš„æ‰€æœ‰DOMæ“ä½œé›†ä¸­èµ·æ¥ï¼Œåœ¨ä¸€æ¬¡é‡ç»˜æˆ–å›æµä¸­å°±å®Œæˆï¼Œå¹¶ä¸”é‡ç»˜æˆ–å›æµçš„æ—¶é—´é—´éš”ç´§ç´§è·Ÿéšæµè§ˆå™¨çš„åˆ·æ–°é¢‘ç‡ åœ¨éšè—æˆ–ä¸å¯è§çš„å…ƒç´ ä¸­ï¼ŒrequestAnimationFrameå°†ä¸ä¼šè¿›è¡Œé‡ç»˜æˆ–å›æµï¼Œè¿™å½“ç„¶å°±æ„å‘³ç€æ›´å°‘çš„CPUã€GPUå’Œå†…å­˜ä½¿ç”¨é‡ requestAnimationFrameæ˜¯ç”±æµè§ˆå™¨ä¸“é—¨ä¸ºåŠ¨ç”»æä¾›çš„APIï¼Œåœ¨è¿è¡Œæ—¶æµè§ˆå™¨ä¼šè‡ªåŠ¨ä¼˜åŒ–æ–¹æ³•çš„è°ƒç”¨ï¼Œå¹¶ä¸”å¦‚æœé¡µé¢ä¸æ˜¯æ¿€æ´»çŠ¶æ€ä¸‹çš„è¯ï¼ŒåŠ¨ç”»ä¼šè‡ªåŠ¨æš‚åœï¼Œæœ‰æ•ˆèŠ‚çœäº†CPUå¼€é”€ ç”¨æ³•å¼‚æ­¥ï¼Œä¼ å…¥çš„å‡½æ•°åœ¨é‡ç»˜ä¹‹å‰è°ƒç”¨ã€‚ requestAnimationFrameçš„ç”¨æ³•ä¸setTimeoutå¾ˆç›¸ä¼¼ï¼Œåªæ˜¯ä¸éœ€è¦è®¾ç½®æ—¶é—´é—´éš”è€Œå·²ã€‚ 1. å†™æ³•ï¼šhandlerId = requestAnimationFrame(callback)(1) ä¼ å…¥ä¸€ä¸ªcallbackå‡½æ•°ï¼Œå³åŠ¨ç”»å‡½æ•°; (2) è¿”å›å€¼handlerIdä¸ºæµè§ˆå™¨å®šä¹‰çš„ã€å¤§äº0çš„æ•´æ•°ï¼Œå”¯ä¸€æ ‡è¯†äº†è¯¥å›è°ƒå‡½æ•°åœ¨åˆ—è¡¨ä¸­ä½ç½®ã€‚ 2. æµè§ˆå™¨æ‰§è¡Œè¿‡ç¨‹:(1) é¦–å…ˆè¦åˆ¤æ–­document.hiddenå±æ€§æ˜¯å¦ä¸ºtrue,å³é¡µé¢å¤„äºå¯è§çŠ¶æ€ä¸‹æ‰ä¼šæ‰§è¡Œï¼› (2) æµè§ˆå™¨æ¸…ç©ºä¸Šä¸€è½®çš„åŠ¨ç”»å‡½æ•°ï¼› (3) è¿™ä¸ªæ–¹æ³•è¿”å›çš„handlerId å€¼ä¼šå’ŒåŠ¨ç”»å‡½æ•°callbackï¼Œä»¥`` è¿›å…¥åˆ°åŠ¨ç”»å¸§è¯·æ±‚å›è°ƒå‡½æ•°åˆ—ï¼› (4) æµè§ˆå™¨ä¼šéå†åŠ¨ç”»å¸§è¯·æ±‚å›è°ƒå‡½æ•°åˆ—è¡¨ï¼Œæ ¹æ®handlerId çš„å€¼å¤§å°ï¼Œä¾æ¬¡å»æ‰§è¡Œç›¸åº”çš„åŠ¨ç”»å‡½æ•°ã€‚ 3. å–æ¶ˆåŠ¨ç”»å‡½æ•°çš„æ–¹æ³•ï¼š1cancelAnimationFrame(handlerId) setTimeoutå’ŒrequestAnimationFrameåŒºåˆ«1. setTimeout ç†è§£äº†ä¸Šé¢çš„æ¦‚å¿µä»¥åï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼ŒsetTimeoutå…¶å®å°±æ˜¯é€šè¿‡è®¾ç½®ä¸€ä¸ªé—´éš”æ—¶é—´æ¥ä¸æ–­çš„æ”¹å˜å›¾åƒçš„ä½ç½®ï¼Œä»è€Œè¾¾åˆ°åŠ¨ç”»æ•ˆæœçš„ã€‚ä½†åˆ©ç”¨seTimeoutå®ç°çš„åŠ¨ç”»åœ¨æŸäº›ä½ç«¯æœºä¸Šä¼šå‡ºç°å¡é¡¿ã€æŠ–åŠ¨çš„ç°è±¡ã€‚ è¿™ç§ç°è±¡çš„äº§ç”Ÿæœ‰ä¸¤ä¸ªåŸå› ï¼š setTimeoutçš„æ‰§è¡Œæ—¶é—´å¹¶ä¸æ˜¯ç¡®å®šçš„ã€‚åœ¨Javascriptä¸­ï¼Œ setTimeoutä»»åŠ¡è¢«æ”¾è¿›äº†å¼‚æ­¥é˜Ÿåˆ—ä¸­ï¼Œåªæœ‰å½“ä¸»çº¿ç¨‹ä¸Šçš„ä»»åŠ¡æ‰§è¡Œå®Œä»¥åï¼Œæ‰ä¼šå»æ£€æŸ¥è¯¥é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡æ˜¯å¦éœ€è¦å¼€å§‹æ‰§è¡Œï¼Œå› æ­¤ setTimeout çš„å®é™…æ‰§è¡Œæ—¶é—´ä¸€èˆ¬è¦æ¯”å…¶è®¾å®šçš„æ—¶é—´æ™šä¸€äº›ã€‚ åˆ·æ–°é¢‘ç‡å—å±å¹•åˆ†è¾¨ç‡å’Œå±å¹•å°ºå¯¸çš„å½±å“ï¼Œå› æ­¤ä¸åŒè®¾å¤‡çš„å±å¹•åˆ·æ–°é¢‘ç‡å¯èƒ½ä¼šä¸åŒï¼Œè€Œ setTimeoutåªèƒ½è®¾ç½®ä¸€ä¸ªå›ºå®šçš„æ—¶é—´é—´éš”ï¼Œè¿™ä¸ªæ—¶é—´ä¸ä¸€å®šå’Œå±å¹•çš„åˆ·æ–°æ—¶é—´ç›¸åŒã€‚ ä»¥ä¸Šä¸¤ç§æƒ…å†µéƒ½ä¼šå¯¼è‡´setTimeoutçš„æ‰§è¡Œæ­¥è°ƒå’Œå±å¹•çš„åˆ·æ–°æ­¥è°ƒä¸ä¸€è‡´ï¼Œä»è€Œå¼•èµ·ä¸¢å¸§ç°è±¡ã€‚ é‚£ä¸ºä»€ä¹ˆæ­¥è°ƒä¸ä¸€è‡´å°±ä¼šå¼•èµ·ä¸¢å¸§å‘¢ï¼Ÿ é¦–å…ˆè¦æ˜ç™½ï¼ŒsetTimeoutçš„æ‰§è¡Œåªæ˜¯åœ¨å†…å­˜ä¸­å¯¹å›¾åƒå±æ€§è¿›è¡Œæ”¹å˜ï¼Œè¿™ä¸ªå˜åŒ–å¿…é¡»è¦ç­‰åˆ°å±å¹•ä¸‹æ¬¡åˆ·æ–°æ—¶æ‰ä¼šè¢«æ›´æ–°åˆ°å±å¹•ä¸Šã€‚å¦‚æœä¸¤è€…çš„æ­¥è°ƒä¸ä¸€è‡´ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´ä¸­é—´æŸä¸€å¸§çš„æ“ä½œè¢«è·¨è¶Šè¿‡å»ï¼Œè€Œç›´æ¥æ›´æ–°ä¸‹ä¸€å¸§çš„å›¾åƒã€‚å‡è®¾å±å¹•æ¯éš”16.7msåˆ·æ–°ä¸€æ¬¡ï¼Œè€ŒsetTimeoutæ¯éš”10msè®¾ç½®å›¾åƒå‘å·¦ç§»åŠ¨1pxï¼Œ å°±ä¼šå‡ºç°å¦‚ä¸‹ç»˜åˆ¶è¿‡ç¨‹ï¼š ç¬¬0ms: å±å¹•æœªåˆ·æ–°ï¼Œç­‰å¾…ä¸­ï¼ŒsetTimeoutä¹Ÿæœªæ‰§è¡Œï¼Œç­‰å¾…ä¸­ï¼› ç¬¬10ms: å±å¹•æœªåˆ·æ–°ï¼Œç­‰å¾…ä¸­ï¼ŒsetTimeoutå¼€å§‹æ‰§è¡Œå¹¶è®¾ç½®å›¾åƒå±æ€§left=1pxï¼› ç¬¬16.7ms: å±å¹•å¼€å§‹åˆ·æ–°ï¼Œå±å¹•ä¸Šçš„å›¾åƒå‘å·¦ç§»åŠ¨äº†1pxï¼Œ setTimeoutæœªæ‰§è¡Œï¼Œç»§ç»­ç­‰å¾…ä¸­ï¼› ç¬¬20ms: å±å¹•æœªåˆ·æ–°ï¼Œç­‰å¾…ä¸­ï¼ŒsetTimeoutå¼€å§‹æ‰§è¡Œå¹¶è®¾ç½®left=2px; ç¬¬30ms: å±å¹•æœªåˆ·æ–°ï¼Œç­‰å¾…ä¸­ï¼ŒsetTimeoutå¼€å§‹æ‰§è¡Œå¹¶è®¾ç½®left=3px; ç¬¬33.4ms: å±å¹•å¼€å§‹åˆ·æ–°ï¼Œå±å¹•ä¸Šçš„å›¾åƒå‘å·¦ç§»åŠ¨äº†3pxï¼Œ setTimeoutæœªæ‰§è¡Œï¼Œç»§ç»­ç­‰å¾…ä¸­ï¼› â€¦ ä»ä¸Šé¢çš„ç»˜åˆ¶è¿‡ç¨‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œå±å¹•æ²¡æœ‰æ›´æ–°left=2pxçš„é‚£ä¸€å¸§ç”»é¢ï¼Œå›¾åƒç›´æ¥ä»1pxçš„ä½ç½®è·³åˆ°äº†3pxçš„çš„ä½ç½®ï¼Œè¿™å°±æ˜¯ä¸¢å¸§ç°è±¡ï¼Œè¿™ç§ç°è±¡å°±ä¼šå¼•èµ·åŠ¨ç”»å¡é¡¿ã€‚ 2. requestAnimationFrameä¸setTimeoutç›¸æ¯”ï¼ŒrequestAnimationFrameæœ€å¤§çš„ä¼˜åŠ¿æ˜¯ç”±ç³»ç»Ÿæ¥å†³å®šå›è°ƒå‡½æ•°çš„æ‰§è¡Œæ—¶æœºã€‚å…·ä½“ä¸€ç‚¹è®²ï¼Œå¦‚æœå±å¹•åˆ·æ–°ç‡æ˜¯60Hz,é‚£ä¹ˆå›è°ƒå‡½æ•°å°±æ¯16.7msè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœåˆ·æ–°ç‡æ˜¯75Hzï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶é—´é—´éš”å°±å˜æˆäº†1000/75=13.3msï¼Œæ¢å¥è¯è¯´å°±æ˜¯ï¼ŒrequestAnimationFrameçš„æ­¥ä¼è·Ÿç€ç³»ç»Ÿçš„åˆ·æ–°æ­¥ä¼èµ°ã€‚å®ƒèƒ½ä¿è¯å›è°ƒå‡½æ•°åœ¨å±å¹•æ¯ä¸€æ¬¡çš„åˆ·æ–°é—´éš”ä¸­åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™æ ·å°±ä¸ä¼šå¼•èµ·ä¸¢å¸§ç°è±¡ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´åŠ¨ç”»å‡ºç°å¡é¡¿çš„é—®é¢˜ã€‚ è¿™ä¸ªAPIçš„è°ƒç”¨å¾ˆç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910var progress = 0;//å›è°ƒå‡½æ•°function render() &#123; progress += 1; //ä¿®æ”¹å›¾åƒçš„ä½ç½® if (progress &lt; 100) &#123; //åœ¨åŠ¨ç”»æ²¡æœ‰ç»“æŸå‰ï¼Œé€’å½’æ¸²æŸ“ window.requestAnimationFrame(render); &#125;&#125;//ç¬¬ä¸€å¸§æ¸²æŸ“window.requestAnimationFrame(render);å¤åˆ¶ä»£ç  é™¤æ­¤ä¹‹å¤–ï¼ŒrequestAnimationFrameè¿˜æœ‰ä»¥ä¸‹ä¸¤ä¸ªä¼˜åŠ¿ï¼š CPUèŠ‚èƒ½ï¼šä½¿ç”¨setTimeoutå®ç°çš„åŠ¨ç”»ï¼Œå½“é¡µé¢è¢«éšè—æˆ–æœ€å°åŒ–æ—¶ï¼ŒsetTimeoutä»ç„¶åœ¨åå°æ‰§è¡ŒåŠ¨ç”»ä»»åŠ¡ï¼Œç”±äºæ­¤æ—¶é¡µé¢å¤„äºä¸å¯è§æˆ–ä¸å¯ç”¨çŠ¶æ€ï¼Œåˆ·æ–°åŠ¨ç”»æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå®Œå…¨æ˜¯æµªè´¹CPUèµ„æºã€‚è€ŒrequestAnimationFrameåˆ™å®Œå…¨ä¸åŒï¼Œå½“é¡µé¢å¤„ç†æœªæ¿€æ´»çš„çŠ¶æ€ä¸‹ï¼Œè¯¥é¡µé¢çš„å±å¹•åˆ·æ–°ä»»åŠ¡ä¹Ÿä¼šè¢«ç³»ç»Ÿæš‚åœï¼Œå› æ­¤è·Ÿç€ç³»ç»Ÿæ­¥ä¼èµ°çš„requestAnimationFrameä¹Ÿä¼šåœæ­¢æ¸²æŸ“ï¼Œå½“é¡µé¢è¢«æ¿€æ´»æ—¶ï¼ŒåŠ¨ç”»å°±ä»ä¸Šæ¬¡åœç•™çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œï¼Œæœ‰æ•ˆèŠ‚çœäº†CPUå¼€é”€ã€‚ å‡½æ•°èŠ‚æµï¼šåœ¨é«˜é¢‘ç‡äº‹ä»¶(resize,scrollç­‰)ä¸­ï¼Œä¸ºäº†é˜²æ­¢åœ¨ä¸€ä¸ªåˆ·æ–°é—´éš”å†…å‘ç”Ÿå¤šæ¬¡å‡½æ•°æ‰§è¡Œï¼Œä½¿ç”¨requestAnimationFrameå¯ä¿è¯æ¯ä¸ªåˆ·æ–°é—´éš”å†…ï¼Œå‡½æ•°åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™æ ·æ—¢èƒ½ä¿è¯æµç•…æ€§ï¼Œä¹Ÿèƒ½æ›´å¥½çš„èŠ‚çœå‡½æ•°æ‰§è¡Œçš„å¼€é”€ã€‚ä¸€ä¸ªåˆ·æ–°é—´éš”å†…å‡½æ•°æ‰§è¡Œå¤šæ¬¡æ—¶æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºæ˜¾ç¤ºå™¨æ¯16.7msåˆ·æ–°ä¸€æ¬¡ï¼Œå¤šæ¬¡ç»˜åˆ¶å¹¶ä¸ä¼šåœ¨å±å¹•ä¸Šä½“ç°å‡ºæ¥ã€‚","tags":["è®¡æ—¶å™¨","requestAnimationFrame"],"categories":["Javascript"]},{"title":"æ—¶é—´åˆ†ç‰‡","path":"/2020/12/28/æ—¶é—´åˆ†ç‰‡/","content":"æµ·é‡æ•°æ®ä¼˜åŒ–-æ—¶é—´åˆ†ç‰‡æ—¶é—´åˆ†ç‰‡çš„æ¦‚å¿µï¼Œå°±æ˜¯ä¸€æ¬¡æ€§æ¸²æŸ“å¤§é‡æ•°æ®ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ä¼šå‡ºç°å¡é¡¿ç­‰ç°è±¡ã€‚æˆ‘ä»¬å¿…é¡»è¦æ˜ç™½çš„ä¸€ä¸ªé“ç†ï¼Œjsæ‰§è¡Œæ°¸è¿œè¦æ¯”domæ¸²æŸ“å¿«çš„å¤šã€‚ ï¼Œæ‰€ä»¥å¯¹äºå¤§é‡çš„æ•°æ®ï¼Œä¸€æ¬¡æ€§æ¸²æŸ“ï¼Œå®¹æ˜“é€ æˆå¡é¡¿ï¼Œå¡æ­»çš„æƒ…å†µã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä¾‹å­ ./Content.tsx 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import &#123; Button &#125; from &#x27;choerodon-ui&#x27;;import Icon from &#x27;choerodon-ui/lib/icon/Icon&#x27;;import &#123; map &#125; from &#x27;lodash&#x27;;import &#123; observer &#125; from &#x27;mobx-react-lite&#x27;;import React, &#123; useEffect, useRef, useState &#125; from &#x27;react&#x27;;import &#x27;./index.less&#x27;;import &#123; useDemos &#125; from &#x27;./stores&#x27;;const Demos = () =&gt; &#123; const &#123; mainStore, &#125; = useDemos(); const &#123; lists, setLists, &#125; = mainStore; useEffect(() =&gt; &#123; &#125;, []); function add() &#123; setLists(new Array(40000).fill(0)); &#125; function reset() &#123; setLists([]); &#125; return ( &lt;div className=&quot;demos&quot;&gt; &lt;div&gt; &lt;Button funcType=&quot;raised&quot; type=&quot;primary&quot; onClick=&#123;add&#125;&gt;add +&lt;/Button&gt; &lt;Button funcType=&quot;raised&quot; type=&quot;primary&quot; onClick=&#123;reset&#125;&gt;reset&lt;/Button&gt; &#123; map(lists, (item:number, i:number) =&gt; ( &lt;div className=&quot;demos-item&quot; key=&#123;i&#125;&gt; &#123;`item-$&#123;i&#125;`&#125; &lt;Icon type=&quot;close&quot; /&gt; &lt;/div&gt; )) &#125; &lt;/div&gt; &lt;/div&gt; );&#125;;export default observer(Demos); ./stores/index.tsx 1234567891011121314151617181920212223242526272829303132333435363738394041/* eslint-disable max-len */import React, &#123; createContext, useCallback, useContext, useMemo,&#125; from &#x27;react&#x27;;import &#123; DataSet &#125; from &#x27;choerodon-ui/pro&#x27;;import &#123; injectIntl &#125; from &#x27;react-intl&#x27;;import &#123; inject &#125; from &#x27;mobx-react&#x27;;import useStore from &#x27;./useStore&#x27;;interface ContextProps &#123;&#125;const Store = createContext(&#123;&#125; as ContextProps);export function useDemos() &#123; return useContext(Store);&#125;export const StoreProvider = injectIntl(inject(&#x27;AppState&#x27;)((props: any) =&gt; &#123; const &#123; children, intl: &#123; formatMessage &#125;, AppState: &#123; currentMenuType: &#123; projectId &#125; &#125;, &#125; = props; const mainStore = useStore(); const value = &#123; ...props, formatMessage, projectId, mainStore, &#125;; return ( &lt;Store.Provider value=&#123;value&#125;&gt; &#123;children&#125; &lt;/Store.Provider&gt; );&#125;)); ./stores/useStore.tsx 12345678910111213import &#123; useLocalStore &#125; from &#x27;mobx-react-lite&#x27;;export default function useStore() &#123; return useLocalStore(() =&gt; (&#123; lists: [], setLists(value:any) &#123; this.lists = value; &#125;, &#125;));&#125;export type StoreProps = ReturnType&lt;typeof useStore&gt;; ./index.tsx 123456789101112import React from &#x27;react&#x27;;import &#123; StoreProvider &#125; from &#x27;./stores&#x27;;import Content from &#x27;./Content&#x27;;const Index = (props: any) =&gt; ( &lt;StoreProvider &#123;...props&#125;&gt; &lt;Content /&gt; &lt;/StoreProvider&gt;);export default Index; ./index.less 1234567891011121314151617.demos &#123; &amp;-item &#123; border: 1px solid #0fc2e2; background-color: #4adcf0; color: #fff; border-radius: 4px; height: 50px; width: 400px; text-align: center; font-size: 20px; line-height: 50px; &amp; + &amp; &#123; margin-top: 10px; &#125; &#125;&#125; æœ€ä¸»è¦çš„ä»£ç å°±æ˜¯Content.tsx æ¼”ç¤ºå¦‚ä¸‹ æˆ‘ä»¬çœ‹åˆ° 40000 ä¸ª ç®€å•åˆ—è¡¨æ¸²æŸ“äº†ï¼Œå°†è¿‘5ç§’çš„æ—¶é—´ã€‚ä¸ºäº†è§£å†³ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®çš„é—®é¢˜ã€‚æˆ‘ä»¬å¼•å‡ºäº†æ—¶é—´åˆ†ç‰‡çš„æ¦‚å¿µï¼Œå°±æ˜¯ç”¨setTimeoutæŠŠä»»åŠ¡åˆ†å‰²ï¼Œåˆ†æˆè‹¥å¹²æ¬¡æ¥æ¸²æŸ“ã€‚ä¸€å…±40000ä¸ªæ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥æ¯æ¬¡æ¸²æŸ“100ä¸ªï¼Œ åˆ†æ¬¡400æ¸²æŸ“ã€‚(è¿™é‡Œç”¨çš„æ˜¯window.requestAnimationFrame()) 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859import &#123; Button &#125; from &#x27;choerodon-ui&#x27;;import Icon from &#x27;choerodon-ui/lib/icon/Icon&#x27;;import &#123; map &#125; from &#x27;lodash&#x27;;import &#123; observer &#125; from &#x27;mobx-react-lite&#x27;;import React, &#123; useEffect, useRef, useState &#125; from &#x27;react&#x27;;import &#x27;./index.less&#x27;;import &#123; useDemos &#125; from &#x27;./stores&#x27;;const Demos = () =&gt; &#123; const &#123; mainStore, &#125; = useDemos(); const &#123; lists, setLists, &#125; = mainStore; useEffect(() =&gt; &#123; &#125;, []); function handleSlice(list:number[], times:number) &#123; if (times === 400) return; window.requestAnimationFrame(() =&gt; &#123; const newLists = list.slice(times, (times + 1) * 10); setLists(lists.concat(newLists)); handleSlice(list, times + 1); &#125;); &#125; function add() &#123; handleSlice(new Array(4000).fill(0), 0); &#125; function reset() &#123; setLists([]); &#125; return ( &lt;div className=&quot;demos&quot;&gt; &lt;div&gt; &lt;Button funcType=&quot;raised&quot; type=&quot;primary&quot; onClick=&#123;add&#125;&gt;add +&lt;/Button&gt; &lt;Button funcType=&quot;raised&quot; type=&quot;primary&quot; onClick=&#123;reset&#125;&gt;reset&lt;/Button&gt; &#123; map(lists, (item:number, i:number) =&gt; ( &lt;div className=&quot;demos-item&quot; key=&#123;i&#125;&gt; &#123;`item-$&#123;i&#125;`&#125; &lt;Icon type=&quot;close&quot; /&gt; &lt;/div&gt; )) &#125; &lt;/div&gt; &lt;/div&gt; );&#125;;export default observer(Demos); æ¼”ç¤º:","tags":["Javascript","å¤§æ•°æ®å¤„ç†"],"categories":["Javascript"]},{"title":"å‰ç«¯ç”Ÿæˆpdf","path":"/2020/12/26/å‰ç«¯ç”Ÿæˆpdf/","content":"é¡¹ç›®ä¸Šè¦æ±‚ï¼Œèƒ½å¤Ÿæ ¹æ®é¡µé¢ä¸Šæ‰€å±•ç¤ºçš„æµ‹è¯•æŠ¥å‘Šï¼Œç”Ÿæˆä¸€ä»½pdfã€‚ æ ¹æ®æ¨¡æ¿ï¼š æœ€ç»ˆç”Ÿæˆçš„æ•ˆæœï¼š åŸç†ï¼šé€šè¿‡æ’ä»¶js-pdfä»¥åŠä¸€ä¸ªhtml2canvasæ’ä»¶ç»“åˆï¼Œé¦–å…ˆé€šè¿‡ html2canvas å¯ä»¥åœ¨æµè§ˆå™¨ç«¯ç›´æ¥å¯¹æ•´ä¸ªæˆ–éƒ¨åˆ†é¡µé¢è¿›è¡Œæˆªå±ã€‚è„šæœ¬é€šè¿‡è¯»å–DOMå¹¶å°†ä¸åŒçš„æ ·å¼åº”ç”¨åˆ°è¿™äº›å…ƒç´ ä¸Šï¼Œä»è€Œå°†å½“é¡µé¢æ¸²æŸ“æˆä¸€ä¸ªCanvaså›¾ç‰‡ã€‚ ä¹‹ååˆ©ç”¨js-pdfæ’ä»¶æ·»åŠ å›¾ç‰‡ï¼Œå°†ç”Ÿæˆçš„canvaså›¾ç‰‡æ’å…¥pdfä¸­ã€‚ ä¿å­˜å¯¼å‡ºpdf 1. è·å–åƒç´ æ¯”1234567/* æ ¹æ®window.devicePixelRatioè·å–åƒç´ æ¯” */ function DPR() &#123; if (window.devicePixelRatio &amp;&amp; window.devicePixelRatio &gt; 1) &#123; return window.devicePixelRatio; &#125; return 1; &#125; devicePixelRatioå±æ€§æ˜¯å¹²å˜›çš„windowçš„è¯¥å±æ€§èƒ½å¤Ÿè·å–åˆ°å½“å‰æ˜¾ç¤ºè®¾å¤‡ç‰©ç†åˆ†è¾¨ç‡ä¸cssçš„åƒç´ åˆ†è¾¨ç‡ä¹‹é—´çš„æ¯”ç‡ã€‚ç®€å•è¯´å°±æ˜¯å‘Šè¯‰æµè§ˆå™¨åº”è¯¥ä½¿ç”¨å¤šå°‘ä¸ªç‰©ç†åƒç´ æ¥ä¼šåœ¨å•ä¸ªcssåƒç´ ã€‚ 2. ç»˜åˆ¶canvasé¦–å…ˆè¦çœ‹ç»˜åˆ¶canvaséœ€è¦çš„ä¸€äº›å‚æ•°éœ€è¦é…ç½® html2canvas(element, options);è¿”å›ä¸€ä¸ªpromise element é¡µé¢ä¸Šçš„domå…ƒç´ ï¼ˆè¿™é‡Œè¦æ³¨æ„ä¸€äº›cssæ ·å¼æ˜¯ä¸æ”¯æŒçš„ï¼‰ optionsé…ç½®è¯¦æƒ…çœ‹è¿™é‡Œä¸‹é¢åªæ˜¯ç”¨åˆ°é¡¹ç›®ä¸Šéœ€è¦çš„éœ€æ±‚ 1ï¼‰è·å–element12345const pdfRef = React.useRef();return ( &lt;div className=&#123;`$&#123;prefixCls&#125;`&#125; ref=&#123;pdfRef&#125;&gt; ...... &lt;/div&gt; 2) é…ç½®options12345678910111213141516171819const getOpts = ()=&gt; &#123; const target:any = pdfRef.current;\tconst width = target.offsetWidth; // è·å–dom å®½åº¦ const height = target.offsetHeight; // è·å–dom é«˜åº¦ const scale = DPR(); const tempCanvas = document.createElement(&#x27;canvas&#x27;); tempCanvas.width = width * scale; // å®šä¹‰canvas å®½åº¦ * ç¼©æ”¾ tempCanvas.height = height * scale; // å®šä¹‰canvasé«˜åº¦ *ç¼©æ”¾ const opts = &#123; useCORS: true, allowTaint: true, canvas: tempCanvas, // ç°æœ‰çš„ç”»å¸ƒå…ƒç´ ç”¨ä½œç»˜å›¾çš„åŸºç¡€ scale, // æå‡ç”»é¢è´¨é‡ï¼Œä½†æ˜¯ä¼šå¢åŠ æ–‡ä»¶å¤§å° scrollX: 0, scrollY: 0, &#125;; return opts;&#125; å…³äºåœ¨é…ç½®é¡¹ä¸­è®¾ç½®è·¨åŸŸ useCORSå’ŒallowTaintä¸¤ç§éƒ½å¯ä»¥è®¾ç½®è·¨åŸŸï¼› ä¸ºä»€ä¹ˆè¦è®¾ç½®è·¨åŸŸï¼šæˆ‘ä»¬å›¾ç‰‡ä¸€èˆ¬éƒ½æ˜¯æ”¾åˆ°é™æ€èµ„æºæœåŠ¡å™¨ä¸Šçš„ï¼Œèµ„æºæœåŠ¡å™¨åœ°å€ä¸€èˆ¬å’Œé¡¹ç›®åœ°å€æ˜¯ä¸ä¸€æ ·çš„ï¼›è™½ç„¶å›¾ç‰‡å¯ä»¥åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºï¼Œä½†æ˜¯ç”¨canvasç»˜å›¾æ—¶å´ç»˜åˆ¶ä¸å‡ºæ¥ï¼› 3. æ ¹æ®ç”Ÿæˆçš„canvasç”Ÿæˆpdf123html2canvas(target, opts).then(async (canvas) =&gt; &#123; (....å¤„ç†é€»è¾‘)&#125;); 1ï¼‰é¦–å…ˆè½¬æ¢å›¾ç‰‡ HTMLCanvasElement.toDataURL() æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«å›¾ç‰‡å±•ç¤ºçš„ data URI 1234const contentWidth = canvas.width;const contentHeight = canvas.height;// å°†canvasè½¬ä¸ºbase64å›¾ç‰‡const pageData = canvas.toDataURL(&#x27;image/jpeg&#x27;, 1); 2) è®¾ç½®pdfçš„å¤§å°ä»¥åŠç”Ÿæˆçš„å›¾ç‰‡å¤§å°å› ä¸ºpdfçš„åƒç´ å•ä½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œè½¬æ¢; å·²çŸ¥ 1pt/1px = 0.75, pt = (px/scale)*0.75 è¿™é‡Œçš„scaleå°±æ˜¯ä¸Šé¢çš„åƒç´ æ¯” 12345678// è®¾ç½®pdfçš„å°ºå¯¸ï¼Œpdfè¦ä½¿ç”¨ptå•ä½ å·²çŸ¥ 1pt/1px = 0.75 pt = (px/scale)* 0.75// 2ä¸ºä¸Šé¢çš„scale ç¼©æ”¾äº†2å€const pdfX = (contentWidth + 10) / scale * 0.75;const pdfY = (contentHeight) / scale * 0.75; // 500ä¸ºåº•éƒ¨ç•™ç™½// è®¾ç½®å†…å®¹å›¾ç‰‡çš„å°ºå¯¸ï¼Œimgæ˜¯ptå•ä½const imgX = pdfX;const imgY = (contentHeight / scale * 0.75); // å†…å®¹å›¾ç‰‡è¿™é‡Œä¸éœ€è¦ç•™ç™½çš„è·ç¦» 3ï¼‰æ’å…¥å›¾ç‰‡å¹¶ç”Ÿæˆpdf12345const pdf = new JsPDF(&#x27;&#x27;, &#x27;pt&#x27;, [pdfX, pdfY]); // ç¬¬ä¸€ä¸ªå‚æ•°æ–¹å‘ï¼šé»˜è®¤&#x27;&#x27;æ—¶ä¸ºçºµå‘// å°†å†…å®¹å›¾ç‰‡æ·»åŠ åˆ°pdfä¸­ï¼Œå› ä¸ºå†…å®¹å®½é«˜å’Œpdfå®½é«˜ä¸€æ ·ï¼Œå°±åªéœ€è¦ä¸€é¡µï¼Œä½ç½®å°±æ˜¯ 0,0await pdf.addImage(pageData, &#x27;jpeg&#x27;, 0, 0, imgX, imgY);pdf.save(`APIæµ‹è¯•æŠ¥å‘Šï¼ˆ#$&#123;viewId&#125;ï¼‰.pdf`); 4. å‡ºç°çš„é—®é¢˜ä»¥åŠè§£å†³æ–¹æ³•1ï¼‰å¯¼å‡ºçš„pdfä¸­å›¾ç‰‡æ¨ªå‘ä½ç½®è¢«æˆªæ–­å¦‚å›¾ï¼š è¿™æ˜¯å› ä¸ºéœ€è¦ç”Ÿæˆçš„domçš„å®½åº¦å¤§äºå…¶é«˜åº¦ï¼Œç”Ÿæˆå›¾ç‰‡æ’å…¥pdfçš„æ—¶å€™ç”±äºpdfé»˜è®¤è®¾ç½®çš„æ˜¯çºµå‘æ’åˆ—ï¼Œå›¾ç‰‡ä¼šè¢«æ’‘å¤§ä»¥é€‚åº”pdfçš„é«˜åº¦ï¼› æŒ‰ç…§ä¸‹æ–¹å¤„ç† 12345678// åˆå§‹åŒ–jspdf ç¬¬ä¸€ä¸ªå‚æ•°æ–¹å‘ï¼šé»˜è®¤&#x27;&#x27;æ—¶ä¸ºçºµå‘ï¼Œç¬¬äºŒä¸ªå‚æ•°è®¾ç½®pdfå†…å®¹å›¾ç‰‡ä½¿ç”¨çš„é•¿åº¦å•ä½ä¸ºptï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºPDFçš„å¤§å°ï¼Œå•ä½æ˜¯pt let direct; if (contentHeight &lt; contentWidth) &#123; direct = &#x27;l&#x27;; &#125; else &#123; direct = &#x27;p&#x27;; &#125; const pdf = new JsPDF(direct, &#x27;pt&#x27;, [pdfX, pdfY]); å½“é«˜åº¦å°äºå®½åº¦çš„æ—¶å€™å°†pdfè¿›è¡Œæ¨ªçºµå‘çš„è°ƒæ•´ï¼Œä»¥é€‚åº”æ’å…¥å›¾ç‰‡çš„å®½é«˜","tags":["Javascript","PDF"],"categories":["Javascript"]},{"title":"undefineå’Œvoid()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ","path":"/2020/12/25/undefineå’Œvoid-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ/","content":"åœ¨ JavaScript ä¸­ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯ undefinedï¼Œä¸€èˆ¬éƒ½è¿™æ ·å†™ï¼š 123function isUndefined(input) &#123; return input === void 0;&#125; ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ void 0 å‘¢ï¼Ÿ void æ˜¯ JS ä¸­çš„ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œè¯­æ³•æ˜¯ï¼š 1void expression å®ƒè¿”å› undefined çš„åŸå§‹å€¼ï¼ŒåŒæ—¶è¯­å¥ä¸­çš„ expression ä¼šè¢«è¿ç®—ï¼Œä¹Ÿå³äº§ç”Ÿäº†å‰¯ä½œç”¨ã€‚å¯ä»¥è¿™æ ·ç†è§£ï¼šå®ƒè¿ç®—äº†è¡¨è¾¾å¼ï¼Œä½†æ˜¯ä¸è¿”å›å€¼ï¼ˆæˆ–è€…è¯´è¿”å› undefinedï¼‰ã€‚ æ‰€ä»¥ï¼Œé€šå¸¸ä½¿ç”¨ void 0 æ¥å¾—åˆ° undefinedã€‚ ä½†æ˜¯ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ undefined å‘¢ï¼Ÿ è¦å¼„æ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œå…ˆçœ‹çœ‹ undefined è¿™ä¸ªè¯åœ¨ä¸åŒè¯­å¢ƒä¸‹çš„å«ä¹‰ã€‚ undefined æ˜¯æœ¯è¯­ï¼ˆglossaryï¼‰ã€‚è¢«ç”¨äºè¡¨ç¤ºä¸€ä¸ªæ¦‚å¿µæ—¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªæœ¯è¯­ï¼Œè¿™ä¸ªæœ¯è¯­è¡¨ç¤ºè¿™æ ·ä¸€ä¸ªæ¦‚å¿µï¼šæœªå®šä¹‰çš„å€¼ï¼ˆå³ undefinedï¼‰ã€‚åœ¨ JS ä¸­ï¼Œåªå£°æ˜è€Œæœªè¢«èµ‹å€¼çš„å˜é‡ã€å‡½æ•°é‡Œæœªä¼ å®å‚çš„å½¢å‚ï¼Œéƒ½å¯¹åº”æ­¤æ¦‚å¿µã€‚ undefined æ˜¯ç±»å‹ï¼ˆtypeï¼‰ã€‚ä¸ºäº†åœ¨è¯­è¨€å±‚é¢å®ç°ä¸Šè¿°çš„ undefined æ¦‚å¿µï¼ŒJS ä¸ºè¿™ä¸ªæ¦‚å¿µæä¾›äº†ä¸€ç§åŸå§‹ç±»å‹ï¼ˆprimitive typeï¼‰ï¼Œå³ undefined ç±»å‹ã€‚ undefined æ˜¯å€¼ï¼ˆvalueï¼‰ã€‚ä¸Šè¿°çš„ undefined ç±»å‹éå¸¸ç‰¹æ®Šï¼Œä¸åƒå…¶ä»–è¯¸å¦‚ stringã€number ç±»å‹å¯ä»¥å®šä¹‰å‡ºæ— é™å¤šçš„ä¸åŒå˜é‡ï¼Œundefined ç±»å‹çš„å€¼åªå¯èƒ½æœ‰ä¸€ä¸ªï¼Œå¯ä»¥ç§°ä¹‹ä¸º undefined åŸå§‹å€¼ï¼ˆprimitive valueï¼‰ã€‚è¿™ä¸ªå€¼åœ¨ JS ä¸­æ²¡æœ‰å­—é¢é‡ï¼Œå‡†ç¡®çš„è¯´æ˜¯ JS æ²¡æœ‰ä¸ºç¨‹åºå‘˜æä¾›ä¸€ä¸ªè¡¨ç¤º undefined åŸå§‹å€¼çš„å­—é¢é‡ï¼ˆå¯èƒ½æœ‰äººä¼šè¯´ä»£ç é‡Œ undefined ä¸å°±æ˜¯å­—é¢é‡å—ï¼Ÿè¯·çœ‹ä¸‹ä¸€æ¡ï¼‰ã€‚ undefined æ˜¯å±æ€§ï¼ˆundefinedï¼‰ã€‚ä»£ç ä¸­å‡ºç°çš„ undefined æ˜¯å…¨å±€å˜é‡çš„å±æ€§ï¼Œæ‰€ä»¥è¯´ JS ä»£ç é‡Œå‡ºç°çš„ undefined å¹¶ä¸æ˜¯å­—é¢é‡ã€‚å¯ä»¥è¿™æ ·ç†è§£ï¼šJS ä¸€å¼€å§‹å°±åœ¨å†…éƒ¨å°† undefined åŸå§‹å€¼èµ‹ç»™äº† undefined å±æ€§ã€‚ ç°åœ¨å†æ¥å›ç­”ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ void 0 è€Œä¸ç›´æ¥ç”¨ undefinedã€‚ å…ˆè¯´ä¸ºä»€ä¹ˆä½¿ç”¨ void 0ã€‚å› ä¸º void 0 è¿”å›çš„å€¼æ˜¯ undefined åŸå§‹å€¼ï¼Œè¿™ä¸æˆ‘ä»¬å†™ä»£ç çš„æ„å›¾å®Œå…¨ä¸€è‡´ã€‚ å†è¯´ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ undefinedã€‚ å› ä¸ºåœ¨ä¸¤ç§æƒ…å†µä¸‹å®ƒæœ‰å¯èƒ½ä¸æˆ‘ä»¬çš„æ„å›¾ä¸ä¸€è‡´ã€‚ ç¬¬ä¸€ç§æƒ…å†µï¼šæ—¢ç„¶ undefined æ˜¯ä¸€ä¸ªå±æ€§ï¼Œé‚£å®ƒå°±æœ‰å¯èƒ½è¢«é‡æ–°èµ‹å€¼ã€‚ä½†æ˜¯è¿™ä¸ªæ‹…å¿ƒæ˜¯æ˜¯å¤šä½™çš„ï¼Œå› ä¸ºä» ES5 å¼€å§‹ undefined å±æ€§å°±æ˜¯æ˜¯ä¸€ä¸ªåªè¯»å±æ€§äº†ï¼Œä¸å¯èƒ½è¢«é‡æ–°èµ‹å€¼ã€‚å¯ä»¥é€šè¿‡å®éªŒéªŒè¯ï¼Œæ‰“å¼€ node CLIï¼š 123456789&gt; Object.getOwnPropertyDescriptor(global, &#x27;undefined&#x27;)&#123; value: undefined, writable: false, enumerable: false, configurable: false &#125;&gt; undefined = &#x27;a string&#x27;&#x27;a string&#x27;&gt; typeof undefined&#x27;undefined&#x27; ä½†æ˜¯å³ä¾¿å¦‚æ­¤ï¼Œä¸ºå…¼å®¹æ€§è€ƒè™‘è¿˜æ˜¯è¦é¿å…ç›´æ¥æ‹¿ undefined æ¥åšæ¯”è¾ƒã€‚ ç¬¬äºŒç§æƒ…å†µï¼šå±€éƒ¨å˜é‡ã€‚å› ä¸º undefined åœ¨ JS ä¸­å¹¶ä¸æ˜¯ä¿ç•™å­—ï¼Œæ‰€ä»¥åœ¨å±€éƒ¨ä½œç”¨åŸŸä¸­å®Œå…¨å¯ä»¥å®šä¹‰ä¸€ä¸ªå˜é‡åä¸º undefined çš„å±€éƒ¨å˜é‡ã€‚çœ‹å¦‚ä¸‹ä»£ç ï¼š 1234(function()&#123; let undefined = &#x27;a string&#x27;; console.log(undefined)&#125;)() ä»£ç è¿è¡Œçš„ç»“æœæ˜¯: 1a string æ€»ç»“ï¼šä½¿ç”¨ void 0 æ˜¯æœ‰è¶³å¤Ÿç†ç”±çš„ã€‚","tags":["Javascript"],"categories":["Javascript"]},{"title":"reactä½•æ—¶renderå‘¢ï¼Ÿ","path":"/2020/12/24/reactä½•æ—¶renderå‘¢ï¼Ÿ/","content":"å¯¹äºå¦‚ä¸‹Demoï¼Œç‚¹å‡»Parentç»„ä»¶çš„divï¼Œè§¦å‘æ›´æ–°ï¼ŒSonç»„ä»¶ä¼šæ‰“å°child render!ä¹ˆï¼Ÿ 12345678910111213141516171819202122function Son() &#123; console.log(&#x27;child render!&#x27;); return &lt;div&gt;Son&lt;/div&gt;;&#125;function Parent(props) &#123; const [count, setCount] = React.useState(0); return ( &lt;div onClick=&#123;() =&gt; &#123;setCount(count + 1)&#125;&#125;&gt; count:&#123;count&#125; &#123;props.children&#125; &lt;/div&gt; );&#125;function App() &#123; return ( &lt;Parent&gt; &lt;Son/&gt; &lt;/Parent&gt; );&#125;const rootEl = document.querySelector(&quot;#root&quot;);ReactDOM.render(&lt;App/&gt;, rootEl); 1ä¸ä¼š renderéœ€è¦æ»¡è¶³çš„æ¡ä»¶Reactåˆ›å»ºFiberæ ‘æ—¶ï¼Œæ¯ä¸ªç»„ä»¶å¯¹åº”çš„fiberéƒ½æ˜¯é€šè¿‡å¦‚ä¸‹ä¸¤ä¸ªé€»è¾‘ä¹‹ä¸€åˆ›å»ºçš„ï¼š renderã€‚å³è°ƒç”¨renderå‡½æ•°ï¼Œæ ¹æ®è¿”å›çš„JSXåˆ›å»ºæ–°çš„fiberã€‚ bailoutã€‚å³æ»¡è¶³ä¸€å®šæ¡ä»¶æ—¶ï¼ŒReactåˆ¤æ–­è¯¥ç»„ä»¶åœ¨æ›´æ–°å‰åæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œåˆ™å¤ç”¨è¯¥ç»„ä»¶åœ¨ä¸Šä¸€æ¬¡æ›´æ–°çš„fiberä½œä¸ºæœ¬æ¬¡æ›´æ–°çš„fiberã€‚ å¯ä»¥çœ‹åˆ°ï¼Œå½“å‘½ä¸­bailouté€»è¾‘æ—¶ï¼Œæ˜¯ä¸ä¼šè°ƒç”¨renderå‡½æ•°çš„ã€‚ æ‰€ä»¥ï¼ŒSonç»„ä»¶ä¸ä¼šæ‰“å°child render!æ˜¯å› ä¸ºå‘½ä¸­äº†bailouté€»è¾‘ã€‚ bailoutéœ€è¦æ»¡è¶³çš„æ¡ä»¶ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¿›å…¥bailouté€»è¾‘ï¼Ÿå½“åŒæ—¶æ»¡è¶³å¦‚ä¸‹4ä¸ªæ¡ä»¶æ—¶ï¼š 1. oldProps === newProps ï¼Ÿå³æœ¬æ¬¡æ›´æ–°çš„propsï¼ˆnewPropsï¼‰ä¸ç­‰äºä¸Šæ¬¡æ›´æ–°çš„propsï¼ˆoldPropsï¼‰ã€‚ æ³¨æ„è¿™é‡Œæ˜¯å…¨ç­‰æ¯”è¾ƒã€‚ æˆ‘ä»¬çŸ¥é“ç»„ä»¶renderä¼šè¿”å›JSXï¼ŒJSXæ˜¯React.createElementçš„è¯­æ³•ç³–ã€‚ æ‰€ä»¥renderçš„è¿”å›ç»“æœå®é™…ä¸Šæ˜¯React.createElementçš„æ‰§è¡Œç»“æœï¼Œå³ä¸€ä¸ªåŒ…å«propså±æ€§çš„å¯¹è±¡ã€‚ å³ä½¿æœ¬æ¬¡æ›´æ–°ä¸ä¸Šæ¬¡æ›´æ–°propsä¸­æ¯ä¸€é¡¹å‚æ•°éƒ½æ²¡æœ‰å˜åŒ–ï¼Œä½†æ˜¯æœ¬æ¬¡æ›´æ–°æ˜¯React.createElementçš„æ‰§è¡Œç»“æœï¼Œæ˜¯ä¸€ä¸ªå…¨æ–°çš„propså¼•ç”¨ï¼Œæ‰€ä»¥oldProps !== newPropsã€‚ å¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†PureComponentæˆ–Memoï¼Œé‚£ä¹ˆåœ¨åˆ¤æ–­æ˜¯è¿›å…¥renderè¿˜æ˜¯bailoutæ—¶ï¼Œä¸ä¼šåˆ¤æ–­oldPropsä¸newPropsæ˜¯å¦å…¨ç­‰ï¼Œè€Œæ˜¯ä¼šå¯¹propså†…æ¯ä¸ªå±æ€§è¿›è¡Œæµ…æ¯”è¾ƒã€‚ 2. contextæ²¡æœ‰å˜åŒ–å³contextçš„valueæ²¡æœ‰å˜åŒ–ã€‚ 3. workInProgress.type === current.type ï¼Ÿæ›´æ–°å‰åfiber.typeæ˜¯å¦å˜åŒ–ï¼Œæ¯”å¦‚divæ˜¯å¦å˜ä¸ºpã€‚ 4. !includesSomeLane(renderLanes, updateLanes) ï¼Ÿå½“å‰fiberä¸Šæ˜¯å¦å­˜åœ¨æ›´æ–°ï¼Œå¦‚æœå­˜åœ¨é‚£ä¹ˆæ›´æ–°çš„ä¼˜å…ˆçº§æ˜¯å¦å’Œæœ¬æ¬¡æ•´æ£µfiberæ ‘è°ƒåº¦çš„ä¼˜å…ˆçº§ä¸€è‡´ï¼Ÿ å¦‚æœä¸€è‡´åˆ™è¿›å…¥renderé€»è¾‘ã€‚ å°±æˆ‘ä»¬çš„Demoæ¥è¯´ï¼ŒParentæ˜¯æ•´æ£µæ ‘ä¸­å”¯ä¸€èƒ½è§¦å‘æ›´æ–°çš„ç»„ä»¶ï¼ˆé€šè¿‡è°ƒç”¨setCountï¼‰ã€‚ æ‰€ä»¥Parentå¯¹åº”çš„fiberæ˜¯å”¯ä¸€æ»¡è¶³æ¡ä»¶4çš„fiberã€‚ Demoçš„è¯¦ç»†æ‰§è¡Œé€»è¾‘æ‰€ä»¥ï¼ŒDemoä¸­Sonè¿›å…¥bailouté€»è¾‘ï¼Œä¸€å®šæ˜¯åŒæ—¶æ»¡è¶³ä»¥ä¸Š4ä¸ªæ¡ä»¶ã€‚æˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥çœ‹ã€‚ æ¡ä»¶2ï¼ŒDemoä¸­æ²¡æœ‰ç”¨åˆ°contextï¼Œæ»¡è¶³ã€‚ æ¡ä»¶3ï¼Œæ›´æ–°å‰åtypeéƒ½ä¸ºSonå¯¹åº”çš„å‡½æ•°ç»„ä»¶ï¼Œæ»¡è¶³ã€‚ æ¡ä»¶4ï¼ŒSonæœ¬èº«æ— æ³•è§¦å‘æ›´æ–°ï¼Œæ»¡è¶³ã€‚ æ‰€ä»¥ï¼Œé‡ç‚¹æ˜¯æ¡ä»¶1ã€‚è®©æˆ‘ä»¬è¯¦ç»†æ¥çœ‹ä¸‹ã€‚ æœ¬æ¬¡æ›´æ–°å¼€å§‹æ—¶ï¼ŒFiberæ ‘å­˜åœ¨å¦‚ä¸‹2ä¸ªfiberï¼š 123FiberRootNode | RootFiber å…¶ä¸­FiberRootNodeæ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¹èŠ‚ç‚¹ï¼ŒRootFiberæ˜¯è°ƒç”¨ReactDOM.renderåˆ›å»ºçš„fiberã€‚ é¦–å…ˆï¼ŒRootFiberä¼šè¿›å…¥bailoutçš„é€»è¾‘ï¼Œæ‰€ä»¥è¿”å›çš„App fiberå’Œæ›´æ–°å‰æ˜¯ä¸€è‡´çš„ã€‚ 12345FiberRootNode | RootFiber | App fiber ç”±äºApp fiberæ˜¯RootFiberèµ°bailouté€»è¾‘è¿”å›çš„ï¼Œæ‰€ä»¥å¯¹äºApp fiberï¼ŒoldProps === newPropsã€‚å¹¶ä¸”bailoutå‰©ä¸‹3ä¸ªæ¡ä»¶ä¹Ÿæ»¡è¶³ã€‚ æ‰€ä»¥App fiberä¹Ÿä¼šèµ°bailouté€»è¾‘ï¼Œè¿”å›Parent fiberã€‚ 1234567FiberRootNode | RootFiber | App fiber | Parent fiber ç”±äºæ›´æ–°æ˜¯Parent fiberè§¦å‘çš„ï¼Œæ‰€ä»¥ä»–ä¸æ»¡è¶³æ¡ä»¶4ï¼Œä¼šèµ°renderçš„é€»è¾‘ã€‚ æ¥ä¸‹æ¥æ˜¯å…³é”® å¦‚æœrenderè¿”å›çš„Sonæ˜¯å¦‚ä¸‹å½¢å¼ï¼š 1&lt;Son/&gt; ä¼šç¼–è¯‘ä¸º 1React.createElement(Son, null) æ‰§è¡Œåè¿”å›JSXã€‚ ç”±äºpropsçš„å¼•ç”¨æ”¹å˜ï¼ŒoldProps !== newPropsã€‚ä¼šèµ°renderé€»è¾‘ã€‚ ä½†æ˜¯åœ¨Demoä¸­Sonæ˜¯å¦‚ä¸‹å½¢å¼ï¼š 1&#123;props.children&#125; å…¶ä¸­ï¼Œprops.childrenæ˜¯Sonå¯¹åº”çš„JSXï¼Œè€Œè¿™é‡Œçš„propsæ˜¯App fiberèµ°bailouté€»è¾‘åè¿”å›çš„ã€‚ æ‰€ä»¥Sonå¯¹åº”çš„JSXä¸ä¸Šæ¬¡æ›´æ–°æ—¶ä¸€è‡´ï¼ŒJSXä¸­ä¿å­˜çš„propsä¹Ÿå°±ä¸€è‡´ï¼Œæ»¡è¶³æ¡ä»¶1ã€‚ å¯ä»¥çœ‹åˆ°ï¼ŒSonæ»¡è¶³bailoutçš„æ‰€æœ‰æ¡ä»¶ï¼Œæ‰€ä»¥ä¸ä¼šrenderã€‚","tags":["React"],"categories":["React"]},{"title":"ä¼˜é›…çš„å¤„ç†asnyc await","path":"/2020/11/08/ä¼˜é›…çš„å¤„ç†asnyc-await/","content":"ä¸Šä»£ç  123456789const errorCaptured = async (asyncFunc) =&gt; &#123; try &#123; const res = await asyncFunc(); return [null, res]; &#125; catch (error) &#123; return [error, null]; &#125;&#125;;","tags":["Javascript","async await"],"categories":["Javascript"]},{"title":"useRefæ‹¿å­ç»„ä»¶æ–¹æ³•","path":"/2020/11/08/useRefæ‹¿å­ç»„ä»¶æ–¹æ³•/","content":"useRefæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œä¸”useRefè¿”å›ä¸€ä¸ªå¯å˜çš„refå¯¹è±¡ï¼ˆå¯¹è±¡ï¼ï¼ï¼ï¼‰ initialValueè¢«èµ‹å€¼ç»™å…¶è¿”å›å€¼çš„.currentå¯¹è±¡ å¯ä»¥ä¿å­˜ä»»ä½•ç±»å‹çš„å€¼:domã€å¯¹è±¡ç­‰ä»»ä½•å¯è¾¨å€¼ refå¯¹è±¡ä¸è‡ªå»ºä¸€ä¸ª{currentï¼šâ€˜â€™}å¯¹è±¡çš„åŒºåˆ«æ˜¯ï¼šuseRefä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è¿”å›åŒä¸€ä¸ªrefå¯¹è±¡ï¼Œå³è¿”å›çš„refå¯¹è±¡åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸å˜ã€‚è‡ªå»ºå¯¹è±¡æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½å»ºç«‹ä¸€ä¸ªæ–°çš„ã€‚ refå¯¹è±¡çš„å€¼å‘ç”Ÿæ”¹å˜ä¹‹åï¼Œä¸ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚æœ‰ä¸€ä¸ªçªé—¨ï¼ŒæŠŠå®ƒçš„æ”¹è¾¹åŠ¨ä½œæ”¾åˆ°useState()ä¹‹å‰ã€‚ æœ¬è´¨ä¸Šï¼ŒuseRefå°±æ˜¯ä¸€ä¸ªå…¶.currentå±æ€§ä¿å­˜ç€ä¸€ä¸ªå¯å˜å€¼â€œç›’å­â€ã€‚ç›®å‰æˆ‘ç”¨åˆ°çš„æ˜¯pageRefå’ŒsortRefåˆ†åˆ«ç”¨æ¥ä¿å­˜åˆ†é¡µä¿¡æ¯å’Œæ’åºä¿¡æ¯ã€‚ ä¸Šä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950// çˆ¶ç»„ä»¶import React, &#123; useRef, useEffect, useImperativeHandle, forwardRef,&#125; from &quot;react&quot;;import Child from &#x27;./TestItem&#x27;;const RefDemo = () =&gt; &#123; const domRef = useRef(1); const childRef = useRef(null); useEffect(() =&gt; &#123; console.log(&quot;ref:deom-init&quot;, domRef, domRef.current); console.log(&quot;ref:child-init&quot;, childRef, childRef.current); &#125;,[]); const showChild = () =&gt; &#123; console.log(&quot;ref:child&quot;, childRef, childRef.current); childRef.current.say(); &#125;; return ( &lt;div style=&#123;&#123; margin: &quot;100px&quot;, border: &quot;2px dashed&quot;, padding: &quot;20px&quot; &#125;&#125;&gt; &lt;h2&gt;è¿™æ˜¯å¤–å±‚ç»„ä»¶&lt;/h2&gt; &lt;div onClick=&#123;() =&gt; &#123; console.log(&quot;ref:deom&quot;, domRef, domRef.current); domRef.current.focus(); if(!domRef.current.value)&#123; domRef.current.value = &#x27;hh&#x27;; &#125; &#125;&#125; &gt; &lt;label&gt;è¿™æ˜¯ä¸€ä¸ªdomèŠ‚ç‚¹&lt;/label&gt;&lt;input ref=&#123;domRef&#125; /&gt; &lt;/div&gt; &lt;br /&gt; &lt;p onClick=&#123;showChild&#125; style=&#123;&#123; marginTop: &quot;20px&quot; &#125;&#125;&gt; è¿™æ˜¯å­ç»„ä»¶ &lt;/p&gt; &lt;div style=&#123;&#123; border: &quot;1px solid&quot;, padding: &quot;10px&quot; &#125;&#125;&gt; &lt;Child ref=&#123;childRef&#125; /&gt; &lt;/div&gt; &lt;/div&gt; );&#125;;export default RefDemo; useImperativeHandle(ref,createHandle,[deps])å¯ä»¥è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ã€‚å¦‚æœä¸ä½¿ç”¨ï¼Œçˆ¶ç»„ä»¶çš„ref(chidlRef)è®¿é—®ä¸åˆ°ä»»ä½•å€¼ï¼ˆchildRef.current==nullï¼‰ useImperativeHandleåº”è¯¥ä¸forwradRefæ­é…ä½¿ç”¨ React.forwardRefä¼šåˆ›å»ºä¸€ä¸ªReactç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶èƒ½å¤Ÿå°†å…¶æ¥å—çš„refå±æ€§è½¬å‘åˆ°å…¶ç»„ä»¶æ ‘ä¸‹çš„å¦ä¸€ä¸ªç»„ä»¶ä¸­ã€‚ React.forwardæ¥å—æ¸²æŸ“å‡½æ•°ä½œä¸ºå‚æ•°ï¼ŒReactå°†ä½¿ç”¨propå’Œrefä½œä¸ºå‚æ•°æ¥è°ƒç”¨æ­¤å‡½æ•° 123456789101112131415161718192021// å­ç»„ä»¶import React, &#123; useRef, useEffect, useImperativeHandle, forwardRef,&#125; from &quot;react&quot;;const ChildComponent = (props, ref) =&gt; &#123; useImperativeHandle(ref, () =&gt; (&#123; say: sayHello, &#125;)); const sayHello = () =&gt; &#123; alert(&quot;hello,æˆ‘æ˜¯å­ç»„ä»¶&quot;); &#125;; return &lt;h3&gt;å­ç»„ä»¶&lt;/h3&gt;;&#125;;const Child = forwardRef(ChildComponent);export default Child;","tags":["React","React hooks"],"categories":["React"]},{"title":"ç½‘æ ¼å¸ƒå±€å…·ä½“å®ç°","path":"/2020/10/14/ç½‘æ ¼å¸ƒå±€å…·ä½“å®ç°/","content":"éœ€æ±‚ç±»ä¼¼ä¸‹å›¾çš„æ•ˆæœï¼š éœ€æ±‚åˆ†æ è¿™ç§å°±æ˜¯ç½‘æ ¼å¸ƒå±€ çˆ¶å®¹å™¨çš„å®½è‡ªé€‚åº”ï¼Œå­å®¹å™¨çš„å®½è®¡ç®—å…¬å¼ä¸º (100% - (n - 1) * 24) / n ã€‚å¦‚æœé¡µé¢å®½åº¦å¤§äº1280pxï¼Œnç­‰äº5ï¼Œå°äº1280pxæ—¶ï¼Œnç­‰äº4ï¼Œé¡µé¢æœ€å°å®½åº¦æ˜¯960px; è§£å†³æ–¹æ¡ˆGridå¸ƒå±€æ•™ç¨‹çœ‹è¿™é‡Œï¼šé˜®ä¸€å³°gridå¸ƒå±€æ•™ç¨‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot; /&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt; &lt;title&gt;Document&lt;/title&gt; &lt;/head&gt; &lt;style&gt; .parent &#123; display: grid; grid-template-columns: repeat(5, 1fr); grid-row-gap: 24px; grid-column-gap: 24px; &#125; .children &#123; background-color: antiquewhite; height: 20px; &#125; @media screen and (max-width: 1280px) &#123; .parent &#123; grid-template-columns: repeat(4, 1fr); &#125; &#125; &lt;/style&gt; &lt;body&gt; &lt;div class=&quot;parent&quot;&gt; &lt;div class=&quot;children&quot;&gt; &lt;div class=&quot;children-content&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;children&quot;&gt; &lt;div class=&quot;children-content&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;children&quot;&gt; &lt;div class=&quot;children-content&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;children&quot;&gt; &lt;div class=&quot;children-content&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;children&quot;&gt; &lt;div class=&quot;children-content&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;children&quot;&gt; &lt;div class=&quot;children-content&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;children&quot;&gt; &lt;div class=&quot;children-content&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;children&quot;&gt; &lt;div class=&quot;children-content&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;children&quot;&gt; &lt;div class=&quot;children-content&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;children&quot;&gt; &lt;div class=&quot;children-content&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt;&lt;/html&gt;","tags":["Css","gridå¸ƒå±€","flexå¸ƒå±€"],"categories":["Css"]},{"title":"ç­–ç•¥æ¨¡å¼","path":"/2020/08/30/ç­–ç•¥æ¨¡å¼/","content":"ç­–ç•¥æ¨¡å¼ åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œè¦å®ç°æŸä¸€ä¸ªåŠŸèƒ½æœ‰å¤šç§æ–¹æ¡ˆå¯ä»¥é€‰æ‹©ã€‚ å®šä¹‰ï¼šå®šä¹‰ä¸€ç³»åˆ—åœ°ç®—æ³•ï¼ŒæŠŠä»–ä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿ä»–ä»¬å¯ä»¥äº’ç›¸æ›¿æ¢","tags":["Javascript","è®¾è®¡æ¨¡å¼"],"categories":["è®¾è®¡æ¨¡å¼"]},{"title":"å‡½æ•°æŸ¯é‡ŒåŒ–","path":"/2020/08/24/å‡½æ•°æŸ¯é‡ŒåŒ–/","content":"æŸ¯é‡ŒåŒ– åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒæŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰æ˜¯æŠŠæ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°å˜æ¢æˆæ¥å—ä¸€ä¸ªå•ä¸€å‚æ•°(æœ€åˆå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°)çš„å‡½æ•°ï¼Œå¹¶ä¸”è¿”å›æ¥å—ä½™ä¸‹çš„å‚æ•°ä¸”è¿”å›ç»“æœçš„æ–°å‡½æ•°çš„æŠ€æœ¯ã€‚ ä¾‹å¦‚éœ€è¦å®ç°ä»¥ä¸‹å¾—ç¤ºä¾‹ 123456add(1, 2, 3) // 6add(1) // 1add(1)(2) // 3add(1, 2)(3) // 6add(1)(2)(3) // 6add(1)(2)(3)(4) // 10 æœ¬æ¥æœ‰è¿™ä¹ˆä¸€ä¸ªæ±‚å’Œå‡½æ•°dynamicAdd()ï¼Œæ¥å—ä»»æ„ä¸ªå‚æ•°ã€‚ 12345function dynamicAdd() &#123; return [...arguments].reduce((prev, curr) =&gt; &#123; return prev + curr &#125;, 0)&#125; ç°åœ¨éœ€è¦é€šè¿‡æŸ¯é‡ŒåŒ–æŠŠå®ƒå˜æˆä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè¿™ä¸ªæ–°çš„å‡½æ•°é¢„ç½®äº†ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¸”å¯ä»¥åœ¨è°ƒç”¨æ—¶ç»§ç»­ä¼ å…¥å‰©ä½™å‚æ•°ã€‚ 12345678910111213141516171819function curry(fn,firstArg)&#123;\t// è¿”å›ä¸€ä¸ªæ–°å‡½æ•°\treturn function()&#123; // å°†argumentsè½¬åŒ–ä¸ºçœŸæ­£æ•°ç»„ var restArgs = Array.from(arguments); return fn.apply(this,[firstArg,...restArgs])\t&#125;&#125;// æŸ¯é‡ŒåŒ–ï¼Œé¢„ç½®å‚æ•°10var add10 = curry(dynamicAdd, 10)add10(5); // 15// æŸ¯é‡ŒåŒ–ï¼Œé¢„ç½®å‚æ•°20var add20 = curry(dynamicAdd, 20);add20(5); // 25// ä¹Ÿå¯ä»¥å¯¹ä¸€ä¸ªå·²ç»æŸ¯é‡ŒåŒ–çš„å‡½æ•°add10ç»§ç»­æŸ¯é‡ŒåŒ–ï¼Œæ­¤æ—¶é¢„ç½®å‚æ•°10å³å¯var anotherAdd20 = curry(add10, 10);anotherAdd20(5); // 25 æŸ¯é‡ŒåŒ–æ˜¯åœ¨ä¸€ä¸ªå‡½æ•°çš„åŸºç¡€ä¸Šè¿›è¡Œå˜æ¢ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„é¢„ç½®äº†å‚æ•°çš„å‡½æ•°ã€‚æœ€ååœ¨è°ƒç”¨æ–°å‡½æ•°æ—¶ï¼Œå®é™…ä¸Šè¿˜æ˜¯ä¼šè°ƒç”¨æŸ¯é‡ŒåŒ–å‰çš„åŸå‡½æ•°ã€‚ å¹¶ä¸”æŸ¯é‡ŒåŒ–å¾—åˆ°çš„æ–°å‡½æ•°å¯ä»¥ç»§ç»­è¢«æŸ¯é‡ŒåŒ– å®é™…ä½¿ç”¨æ—¶ä¹Ÿä¼šå‡ºç°æŸ¯é‡ŒåŒ–çš„å˜ä½“ï¼Œä¸å±€é™äºåªé¢„ç½®ä¸€ä¸ªå‚æ•°ã€‚ 123456789101112function curry(fn) &#123; // ä¿å­˜é¢„ç½®å‚æ•° var presetArgs = [].slice.call(arguments, 1) // è¿”å›ä¸€ä¸ªæ–°å‡½æ•° return function() &#123; // æ–°å‡½æ•°è°ƒç”¨æ—¶ä¼šç»§ç»­ä¼ å‚ var restArgs = [].slice.call(arguments) // å‚æ•°åˆå¹¶ï¼Œé€šè¿‡applyè°ƒç”¨åŸå‡½æ•° return fn.apply(this, [...presetArgs, ...restArgs]) &#125;&#125; 1. å‚æ•°å®šé•¿çš„æŸ¯é‡ŒåŒ–å‡è®¾å­˜åœ¨ä¸€ä¸ªåŸå‡½æ•°fnï¼Œfnæ¥å—ä¸‰ä¸ªå‚æ•°a, b, cï¼Œé‚£ä¹ˆå‡½æ•°fnæœ€å¤šè¢«æŸ¯é‡ŒåŒ–ä¸‰æ¬¡ï¼ˆæœ‰æ•ˆåœ°ç»‘å®šå‚æ•°ç®—ä¸€æ¬¡ï¼‰ã€‚ 1234567891011function fn(a, b, c) &#123; return a + b + c&#125;var c1 = curry(fn, 1);var c2 = curry(c1, 2);var c3 = curry(c2, 3);c3(); // 6// å†æ¬¡æŸ¯é‡ŒåŒ–ä¹Ÿæ²¡æœ‰æ„ä¹‰ï¼ŒåŸå‡½æ•°åªéœ€è¦ä¸‰ä¸ªå‚æ•°var c4 = curry(c3, 4);c4(); ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¯é‡ŒåŒ–ç¼“å­˜çš„å‚æ•°æ•°é‡ï¼Œæ¥åˆ¤æ–­æ˜¯å¦åˆ°è¾¾äº†æ‰§è¡Œæ—¶æœºã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªæŸ¯é‡ŒåŒ–çš„é€šç”¨æ¨¡å¼ã€‚ 1234567891011121314151617181920function curry(fn) &#123; // è·å–åŸå‡½æ•°çš„å‚æ•°é•¿åº¦ const argLen = fn.length; // ä¿å­˜é¢„ç½®å‚æ•° const presetArgs = [].slice.call(arguments, 1) // è¿”å›ä¸€ä¸ªæ–°å‡½æ•° return function() &#123; // æ–°å‡½æ•°è°ƒç”¨æ—¶ä¼šç»§ç»­ä¼ å‚ const restArgs = [].slice.call(arguments) const allArgs = [...presetArgs, ...restArgs] if (allArgs.length &gt;= argLen) &#123; // å¦‚æœå‚æ•°å¤Ÿäº†ï¼Œå°±æ‰§è¡ŒåŸå‡½æ•° return fn.apply(this, allArgs) &#125; else &#123; // å¦åˆ™ç»§ç»­æŸ¯é‡ŒåŒ– return curry.call(null, fn, ...allArgs) &#125; &#125;&#125; 12345678function fn(a,b,c)&#123;\treturn a+b+c;&#125;var curried = curry(fn);curried(1,2,3);curried(1,2)(3);curried(1)(2,3);curried(1)(2)(3); 2. å‚æ•°ä¸å®šé•¿åœ°æŸ¯é‡ŒåŒ– åœ¨å‚æ•°ä¸å®šé•¿çš„æƒ…å†µä¸‹ï¼Œè¦åŒæ—¶æ”¯æŒ1~Næ¬¡è°ƒç”¨è¿˜æ˜¯æŒºéš¾ å¦‚æœè¦æ”¯æŒå‚æ•°ä¸å®šé•¿çš„åœºæ™¯ï¼Œå·²ç»æŸ¯é‡ŒåŒ–çš„å‡½æ•°åœ¨æ‰§è¡Œå®Œæ¯•æ—¶ä¸èƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œåªèƒ½è¿”å›ä¸€ä¸ªå‡½æ•°ï¼›åŒæ—¶è¦è®©JSå¼•æ“åœ¨è§£æå¾—åˆ°çš„è¿™ä¸ªç»“æœæ—¶ï¼Œèƒ½æ±‚å‡ºæˆ‘ä»¬é¢„æœŸçš„å€¼ ç»curryå¤„ç†ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°å‡½æ•°ï¼Œè¿™ä¸€ç‚¹ä¸å˜ã€‚ 123// curryæ˜¯ä¸€ä¸ªå‡½æ•°var curried = curry(add); æ–°å‡½æ•°æ‰§è¡Œåä»ç„¶è¿”å›ä¸€ä¸ªç»“æœå‡½æ•°ã€‚ 123// curried10ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°var curried10 = curried(10);var curried30 = curried10(20); ç»“æœå‡½æ•°å¯ä»¥è¢«Javascriptå¼•æ“è§£æï¼Œå¾—åˆ°ä¸€ä¸ªé¢„æœŸçš„å€¼ã€‚ 1curried10; // 10 å…³é”®ç‚¹åœ¨äº3ï¼Œå¦‚ä½•è®©Javascriptå¼•æ“æŒ‰æˆ‘ä»¬çš„é¢„æœŸè¿›è¡Œè§£æï¼Œè¿™å°±å›åˆ°JavascriptåŸºç¡€äº†ã€‚åœ¨è§£æä¸€ä¸ªå‡½æ•°çš„åŸå§‹å€¼æ—¶ï¼Œä¼šç”¨åˆ°toString 1234567891011121314151617function curry(fn) &#123; // ä¿å­˜é¢„ç½®å‚æ•° const presetArgs = [].slice.call(arguments, 1) // è¿”å›ä¸€ä¸ªæ–°å‡½æ•° function curried () &#123; // æ–°å‡½æ•°è°ƒç”¨æ—¶ä¼šç»§ç»­ä¼ å‚ const restArgs = [].slice.call(arguments) const allArgs = [...presetArgs, ...restArgs] return curry.call(null, fn, ...allArgs) &#125; // é‡å†™toString curried.toString = function() &#123; return fn.apply(null, presetArgs) &#125; return curried;&#125; æ€»ç»“æŸ¯é‡ŒåŒ–æ˜¯ä¸€ç§å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³ï¼Œå®é™…ä¸Šåœ¨é¡¹ç›®ä¸­å¯èƒ½ç”¨å¾—å°‘ï¼Œæˆ–è€…è¯´ç”¨å¾—ä¸æ·±å…¥ï¼Œä½†æ˜¯å¦‚æœä½ æŒæ¡äº†è¿™ç§æ€æƒ³ï¼Œä¹Ÿè®¸åœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´ç‚¹ï¼Œä½ ä¼šç”¨å¾—ä¸Šï¼ å¤§æ¦‚æ¥è¯´ï¼ŒæŸ¯é‡ŒåŒ–æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š ç®€æ´ä»£ç ï¼šæŸ¯é‡ŒåŒ–åº”ç”¨åœ¨è¾ƒå¤æ‚çš„åœºæ™¯ä¸­ï¼Œæœ‰ç®€æ´ä»£ç ï¼Œå¯è¯»æ€§é«˜çš„ä¼˜ç‚¹ã€‚ å‚æ•°å¤ç”¨ï¼šå…¬å…±çš„å‚æ•°å·²ç»é€šè¿‡æŸ¯é‡ŒåŒ–é¢„ç½®äº†ã€‚ å»¶è¿Ÿæ‰§è¡Œï¼šæŸ¯é‡ŒåŒ–æ—¶åªæ˜¯è¿”å›ä¸€ä¸ªé¢„ç½®å‚æ•°çš„æ–°å‡½æ•°ï¼Œå¹¶æ²¡æœ‰ç«‹åˆ»æ‰§è¡Œï¼Œå®é™…ä¸Šåœ¨æ»¡è¶³æ¡ä»¶åæ‰ä¼šæ‰§è¡Œã€‚ ç®¡é“å¼æµæ°´çº¿ç¼–ç¨‹ï¼šåˆ©äºä½¿ç”¨å‡½æ•°ç»„è£…ç®¡é“å¼çš„æµæ°´çº¿å·¥åºï¼Œä¸æ±¡æŸ“åŸå‡½æ•°ã€‚","tags":["Javascript","é—­åŒ…"],"categories":["Javascript"]},{"title":"å•ä¾‹æ¨¡å¼","path":"/2020/08/23/å•ä¾‹æ¨¡å¼/","content":"å•ä¾‹æ¨¡å¼ ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ç»™ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚ 1. å®ç°ç®€å•çš„å•ä¾‹æ¨¡å¼12345678910111213141516171819var Singleton = function(name)&#123;\tthis.name = name;&#125;Singleton.instance = null;Singleton.prototype.getName = function()&#123;\talert(this.name);&#125;Singleton.getInstance = function(name)&#123; if(!this.instance)&#123; this.instance = new Singleton(name); &#125; return this.instance&#125;var a1 = Singleton.getInstance(&#x27;a1&#x27;);var a2 = Singleton.getInstance(&#x27;a2&#x27;);a1 === a2 // true; æˆ–è€…ç›´æ¥ç”¨é—­åŒ… 123456789101112131415var Singleton = function(name)&#123;\tthis.name = name;&#125;Singleton.prototype.getName = function()&#123;\taltert(this.name);&#125;Singleton.getInstance = (function()&#123;\tvar instance = null;\treturn function(name)&#123; if(!instance)&#123; instance = new Singleton(name); &#125; return this.instance;\t&#125;&#125;)(); è¿™ç§æ–¹å¼ç›¸å¯¹ç®€å•ï¼Œä½†æ˜¯å¢åŠ äº†è¿™ä¸ªç±»çš„â€œä¸é€æ˜æ€§â€ï¼Œè¿™ä¸ªç±»çš„ä½¿ç”¨è€…å¿…é¡»çŸ¥é“è¿™ä¸ªæ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œä¸ä¹‹å‰çš„newä¸€ä¸ªç±»ä¸åŒï¼Œä½¿ç”¨è€…è¦ç”¨getinstanceæ¥è·å–å¯¹è±¡ 2.é€æ˜çš„å•ä¾‹æ¨¡å¼ ç›®æ ‡ï¼šå®ç°ä¸€ä¸ªâ€œé€æ˜çš„å•ä¾‹ç±»â€ï¼Œç”¨æˆ·ä»è¿™ä¸ªç±»ä¸­åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œå¯ä»¥åƒä½¿ç”¨å…¶ä»–ä»»ä½•æ™®é€šç±»ä¸€æ ·ã€‚ ä¸‹é¢ä¾‹å­ç”¨CreateDivå•ä¾‹ç±»ï¼Œè´Ÿè´£åœ¨é¡µé¢ä¸­åˆ›å»ºå”¯ä¸€çš„divèŠ‚ç‚¹ 1234567891011121314151617181920var CreateDiv = (function&#123;\tvar instance;\tvar CreateDiv = function(html)&#123; if(instance)&#123; return instance; &#125; this.html = html; this.init(); return instance = this;\t&#125;\tCreateDiv.prototype.init = function()&#123; var div = document.createElement(&#x27;div&#x27;); div.innerHtml = this.html; document.body.appendChild(div);\t&#125;\treturn CreateDiv;&#125;)();var a1 = new CreateDiv(&#x27;a1&#x27;);var a2 = new CreateDiv(&#x27;a2&#x27;);a1 === a2 // true; è™½ç„¶é€æ˜äº†ï¼Œä½†æœ‰ç¼ºç‚¹ï¼Œä¸ºäº†æŠŠinstanceå°èµ·æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†è‡ªæ‰§è¡Œçš„åŒ¿åå‡½æ•°å’Œé—­åŒ…ï¼Œå¹¶ä¸”è®©è¿™ä¸ªåŒ¿åå‡½æ•°è¿”å›çœŸæ­£çš„Singletonæ„é€ æ–¹æ³•ï¼Œå¢åŠ äº†å¤æ‚åº¦ã€‚ å‡å¦‚æŸå¤©æˆ‘ä»¬éœ€è¦åˆ©ç”¨è¿™ä¸ªç±»ï¼Œå†é¡µé¢ä¸­åˆ›å»ºè®¸å¤šdivï¼Œåˆ™å°±è¦è®©è¿™ä¸ªå•ä¾‹ç±»å˜æˆä¸€ä¸ªæ™®é€šçš„å¯äº§ç”Ÿå¤šä¸ªå®ä¾‹çš„ç±»ï¼Œé‚£æˆ‘ä»¬å¿…é¡»å¾—æ”¹å†™CreateDivæ„é€ å‡½æ•°ï¼ŒæŠŠæ§åˆ¶åˆ›å»ºå”¯ä¸€å¯¹è±¡çš„é‚£æ®µå»æ‰ã€‚ 3.ç”¨ä»£ç†å®ç°ç”±ä¸Šå¯ä»¥çŸ¥é“ï¼Œè¦æƒ³ä½¿å¾—è¿™ä¸ªå•ä¾‹ç±»å˜æˆä¸€ä¸ªæ™®é€šçš„å¯ä»¥äº§ç”Ÿå¤šä¸ªå®ä¾‹çš„ç±»ï¼Œé‚£æˆ‘ä»¬å¿…é¡»å¾—æ”¹ã€‚ è¿™æ—¶å€™æˆ‘ä»¬æŠŠè´Ÿè´£ç®¡ç†å•ä¾‹çš„ä»£ç ç§»é™¤å‡ºå»ï¼Œä½¿ä»–æˆä¸ºä¸€ä¸ªæ™®é€šçš„åˆ›å»ºdivçš„ç±»ï¼š 123456789var CreateDiv = function(html)&#123;\tthis.html = html;\tthis.init();&#125;CreateDiv.prototype.init = function()&#123;\tvar div = document.createElement(&#x27;div&#x27;);\tdiv.innerHTML = this.html;\tdocument.body.appendChild(div);&#125; æ¥ä¸‹æ¥å¼•å…¥ä»£ç†ç±»ProxySingletonCreateDiv 123456789101112var ProxySingletonCreateDiv = (function()&#123;\tvar instance;\treturn function(html)&#123; if(!instance)&#123; instance = new CreateDiv(html); &#125; return instance;\t&#125;&#125;)();var a1 = new ProxySingletonCreateDiv(&#x27;a1&#x27;);var a2 = new ProxySingletonCreateDiv(&#x27;a2&#x27;);a1 === a2; // true; è¿™ä¸¤ä¸ªè¿èµ·æ¥å°±å°±å¯ä»¥å°±å¯ä»¥å®ç°å•ä¾‹æ¨¡å¼çš„å®ç°ï¼Œé€šè¿‡ä»£ç†ç±»åŠ ä¸Šä¸€ä¸ªCreateDivæ™®é€šç±»ï¼Œç»„åˆ 4. jsä¸­çš„å•ä¾‹æ¨¡å¼jsæ˜¯ä¸€é—¨æ— ç±»è¯­è¨€ã€‚ä¼ ç»Ÿçš„å•ä¾‹æ¨¡å¼å®ç°å†jsä¸­å¹¶ä¸é€‚ç”¨ å•ä¾‹æ¨¡å¼çš„æ ¸å¿ƒæ˜¯ç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—® å…¨å±€å˜é‡ä¸æ˜¯å•ä¾‹æ¨¡å¼ï¼Œå•å†jså¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæŠŠå…¨å±€å˜é‡å½“æˆå•ä¾‹æ¥ä½¿ç”¨ 1var a =&#123;&#125;; ä½†æ˜¯è¿™æ ·å˜é‡å®¹æ˜“è¢«è¦†ç›–ã€‚ å› æ­¤éœ€è¦é™ä½å…¨å±€å˜é‡å‘½åçš„æ±¡æŸ“ã€‚ 4.1 ä½¿ç”¨å‘½åç©ºé—´12345678var namespace = &#123;\ta:function()&#123; ...\t&#125;,\tb:function()&#123; ...\t&#125;&#125; 4.2 ä½¿ç”¨é—­åŒ…å°è£…ç§æœ‰å˜é‡è¿™ç§æ–¹æ³•æŠŠä¸€äº›å˜é‡å°è£…å†é—­åŒ…å†…éƒ¨ï¼Œåªæš´éœ²æ¥å£ä¸å¤–ç•Œé€šä¿¡ 12345678var user = (function()&#123;\tvar _name = &#x27;seven&#x27;,_age = 29;\treturn &#123; getUserInfo:function()&#123; return _name + &#x27;-&#x27; + _age; &#125;\t&#125;&#125;)(); æˆ‘ä»¬ç”¨ä¸‹åˆ’çº¿çº¦å®š_name å’Œ _ageã€‚ 5.æƒ°æ€§å•ä¾‹æƒ°æ€§å•ä¾‹æŒ‡çš„æ˜¯éœ€è¦çš„æ—¶å€™æ‰å»åˆ›å»ºçš„å¯¹è±¡å®ä¾‹ã€‚ ä¾‹å¦‚ï¼šæˆ‘ä»¬éœ€è¦ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®æ˜¾ç¤ºä¸€ä¸ªå¼¹çª—ï¼Œè¿™ä¸ªæµ®çª—å†è¿™ä¸ªé¡µé¢é‡Œå¤´æ˜¯å”¯ä¸€çš„ï¼Œä¸å¯èƒ½åŒæ—¶å‡ºç°ä¸¤ä¸ª æ–¹æ³•ä¸€ï¼šåœ¨é¡µé¢åŠ è½½ä¹‹åå°±å»åˆ›å»ºï¼Œç„¶åç‚¹å‡»btnæŠŠä»–æ˜¾ç¤ºå‡ºæ¥ 12345678910111213141516171819&lt;html&gt; &lt;body&gt; &lt;button id=&quot;loginBtn&quot;&gt; ç™»å½• &lt;/button&gt; &lt;/body&gt; &lt;script&gt; var loginLayer = (function()&#123; var div = document.createElement(&#x27;div&#x27;); div.innerHTML = &#x27;æˆ‘æ˜¯ç™»å½•æµ®çª—&#x27;; div.style.display = &#x27;none&#x27;; document.body.appendChild(div); return div; &#125;)(); document.getElementById(&#x27;loginBtn&#x27;).onclick = function()&#123; loginLayer.style.display = &#x27;block&#x27; &#125; &lt;/script&gt;&lt;/html&gt; ï¼Œä½†æ˜¯å¦‚æœæœ‰æ—¶å€™ä¸éœ€è¦å°±ä¸éœ€è¦æµªè´¹ç©ºé—´å»åˆ›å»ºèŠ‚ç‚¹ï¼Œéœ€è¦æ”¹è¿› ç°åœ¨æ˜¯ç‚¹å‡»çš„æ—¶å€™æ‰ä¼šå»åˆ›å»ºèŠ‚ç‚¹ 1234567891011121314151617181920&lt;html&gt; &lt;body&gt; &lt;button id=&quot;loginBtn&quot;&gt; ç™»å½• &lt;/button&gt; &lt;/body&gt; &lt;script&gt; var loginLayer = function()&#123; var div = document.createElement(&#x27;div&#x27;); div.innerHTML = &#x27;æˆ‘æ˜¯ç™»å½•æµ®çª—&#x27;; div.style.display = &#x27;none&#x27;; document.body.appendChild(div); return div; &#125;; document.getElementById(&#x27;loginBtn&#x27;).onclick = function()&#123; var loginLayer = createLoginLayer(); loginLayer.style.display = &#x27;block&#x27; &#125; &lt;/script&gt;&lt;/html&gt; ä½†æ˜¯è™½ç„¶å®ç°äº†æƒ°æ€§ï¼Œè¿™æ ·å°±å¤±å»äº†å•ä¾‹çš„æ•ˆæœï¼Œé¢‘ç¹çš„å¢åˆ ä¸å¤ªåˆé€‚ã€‚ æ­¤æ—¶å¯ä»¥ç”¨ä¸€ä¸ªå˜é‡åˆ¤æ–­æ˜¯å¦å·²ç»åˆ›å»ºè¿‡æµ®çª—äº†ã€‚ 12345678910111213141516var createLoginLayer = (function()&#123;\tvar div;\treturn function()&#123; if(!div)&#123; var div = document.createElement(&#x27;div&#x27;); div.innerHTML = &#x27;æˆ‘æ˜¯ç™»å½•æµ®çª—&#x27;; div.style.display = &#x27;none&#x27;; document.body.appendChild(div); &#125; return div;\t&#125;&#125;)()document.getElementById(&#x27;loginBtn&#x27;).onclick = function()&#123; var loginLayer = createLoginLayer(); loginLayer.style.display = &#x27;block&#x27;&#125; ä½†æ˜¯è¿™ä¸ªå´è¿åäº†å•ä¸€èŒè´£åŸåˆ™ï¼Œè¿™é‡Œåˆ›å»ºå’Œç®¡ç†å•ä¾‹çš„é€»è¾‘å…¨éƒ¨éƒ½æ”¾åœ¨äº†ä¸€ä¸ªfuncé‡Œå¤´ï¼Œä½†ä¸‹æ¬¡å¦‚æœè¦åˆ›å»ºiframeæˆ–è€…å…¶ä»–çš„ä¸œè¥¿ï¼Œé‚£å°±åªèƒ½ç…§æŠ„ä»£ç äº† å› æ­¤æŠŠä¸å˜çš„éƒ¨åˆ†åˆ†å‡ºæ¥ï¼ŒæŠŠç®¡ç†å•ä¾‹çš„é€»è¾‘æŠ½å‡ºæ¥ï¼Œä¹‹åä¼ åˆ›å»ºçš„é€»è¾‘å°±è¡Œäº†ã€‚ 123456var getSingle = function(fn)&#123;\tvar result ;\treturn function()&#123; return result || result = fn.apply(this,arguments);\t&#125;&#125; æ¥ä¸‹æ¥å°±å¯ä»¥ç”¨äºåˆ›å»ºå¼¹çª—çš„æ–¹æ³•ç”¨äºå‚æ•°fnçš„å½¢å¼ä¼ å…¥getSingleï¼Œåˆ›å»ºå•¥éƒ½è¡Œï¼Œç”¨resultä¿å­˜fnçš„å·±ç®—ç»“æœã€‚resultèº«åœ¨é—­åŒ…ä¸­ï¼Œæ°¸è¿œä¸ä¼šé”€æ¯ï¼Œä¹‹åå¦‚æœresultæœ‰å€¼ï¼Œç›´æ¥è¿”å› 1234567891011121314var createLoginLayer = function()&#123;\tvar div = document.createElement(&#x27;div&#x27;); div.innerHTML = &#x27;æˆ‘æ˜¯ç™»å½•æµ®çª—&#x27;; div.style.display = &#x27;none&#x27;; document.body.appendChild(div); return div;&#125;var createSingleLoginLayer = getSingle(createLoginLayer);document.getElementById(&#x27;loginBtn&#x27;).onclick = function()&#123; var loginLayer = createSingleLoginLayer(); loginLayer.style.display = &#x27;block&#x27;&#125;// åˆ›å»ºifameå•¥çš„ä¹Ÿæ˜¯ä¸€æ ·","tags":["è®¾è®¡æ¨¡å¼","å•ä¾‹æ¨¡å¼"],"categories":["è®¾è®¡æ¨¡å¼"]},{"title":"typeScriptæ€»ç»“","path":"/2020/08/02/typeScriptæ€»ç»“/","content":"tsä¸­éœ€è¦ç†è§£çš„- any vs unknownany è¡¨ç¤ºä»»æ„ç±»å‹ï¼Œè¿™ä¸ªç±»å‹ä¼šé€ƒç¦» Typescript çš„ç±»å‹æ£€æŸ¥ï¼Œå’Œåœ¨ Javascript ä¸­ä¸€æ ·ï¼Œany ç±»å‹çš„å˜é‡å¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œï¼Œç¼–è¯‘æ—¶ä¸ä¼šæŠ¥é”™ã€‚ unknown ä¹Ÿå¯ä»¥è¡¨ç¤ºä»»æ„ç±»å‹ï¼Œä½†å®ƒåŒæ—¶ä¹Ÿå‘Šè¯‰ Typescript å¼€å‘è€…å¯¹å…¶ä¹Ÿæ˜¯ä¸€æ— æ‰€çŸ¥ï¼Œåšä»»ä½•æ“ä½œæ—¶éœ€è¦æ…é‡ã€‚è¿™ä¸ªç±»å‹ä»…å¯ä»¥æ‰§è¡Œæœ‰é™çš„æ“ä½œï¼ˆ==ã€=== ã€||ã€&amp;&amp;ã€?ã€!ã€typeofã€instanceof ç­‰ç­‰ï¼‰ï¼Œå…¶ä»–æ“ä½œéœ€è¦å‘ Typescript è¯æ˜è¿™ä¸ªå€¼æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå¦åˆ™ä¼šæç¤ºå¼‚å¸¸ã€‚ 12345678910111213141516let foo: anylet bar: unknownfoo.functionNotExist()bar.functionNotExist() // å¯¹è±¡çš„ç±»å‹ä¸º &quot;unknown&quot;ã€‚if (!!bar) &#123; // ==ã€=== ã€||ã€&amp;&amp;ã€?ã€!ã€typeofã€instanceof console.log(bar)&#125;bar.toFixed(1) // Errorif (typeof bar=== &#x27;number&#x27;) &#123; bar.toFixed(1) // OK&#125; any ä¼šå¢åŠ äº†è¿è¡Œæ—¶å‡ºé”™çš„é£é™©ï¼Œä¸åˆ°ä¸‡ä¸å¾—å·²ä¸è¦ä½¿ç”¨ã€‚è¡¨ç¤ºã€ä¸çŸ¥é“ä»€ä¹ˆç±»å‹ã€‘çš„åœºæ™¯ä¸‹ä½¿ç”¨ unknownã€‚ - {} vs object vs Objectobject è¡¨ç¤ºçš„æ˜¯å¸¸è§„çš„ Javascript å¯¹è±¡ç±»å‹ï¼ŒéåŸºç¡€æ•°æ®ç±»å‹ã€‚ 1234567891011121314declare function create(o: object): void;create(&#123; prop: 0 &#125;); // OKcreate(null); // Errorcreate(undefined); // Errorcreate(42); // Errorcreate(&quot;string&quot;); // Errorcreate(false); // Errorcreate(&#123; toString() &#123; return 3; &#125;,&#125;); // OK &#123;&#125; è¡¨ç¤ºçš„é nullï¼Œé undefined çš„ä»»æ„ç±»å‹ã€‚ 1234567891011121314declare function create(o: &#123;&#125;): void;create(&#123; prop: 0 &#125;); // OKcreate(null); // Errorcreate(undefined); // Errorcreate(42); // OKcreate(&quot;string&quot;); // OKcreate(false); // OKcreate(&#123; toString() &#123; return 3; &#125;,&#125;); // OK Object å’Œ &#123;&#125; å‡ ä¹ä¸€è‡´ï¼ŒåŒºåˆ«æ˜¯ Object ç±»å‹ä¼šå¯¹ Object åŸå‹å†…ç½®çš„æ–¹æ³•ï¼ˆtoString/hasOwnPrepertyï¼‰è¿›è¡Œæ ¡éªŒã€‚ 1234567891011121314declare function create(o: Object): void;create(&#123; prop: 0 &#125;); // OKcreate(null); // Errorcreate(undefined); // Errorcreate(42); // OKcreate(&quot;string&quot;); // OKcreate(false); // OKcreate(&#123; toString() &#123; return 3; &#125;,&#125;); // Error - Never ç±»å‹never ç±»å‹è¡¨ç¤ºçš„æ˜¯é‚£äº›æ°¸ä¸å­˜åœ¨çš„å€¼çš„ç±»å‹ã€‚ ä¾‹å¦‚ï¼Œnever ç±»å‹æ˜¯é‚£äº›æ€»æ˜¯ä¼šæŠ›å‡ºå¼‚å¸¸æˆ–æ ¹æœ¬å°±ä¸ä¼šæœ‰è¿”å›å€¼çš„å‡½æ•°è¡¨è¾¾å¼æˆ–ç®­å¤´å‡½æ•°è¡¨è¾¾å¼çš„è¿”å›å€¼ç±»å‹ã€‚ 123456789// è¿”å›neverçš„å‡½æ•°å¿…é¡»å­˜åœ¨æ— æ³•è¾¾åˆ°çš„ç»ˆç‚¹function error(message: string): never &#123; throw new Error(message);&#125;function infiniteLoop(): never &#123; while (true) &#123;&#125;&#125; åœ¨ TypeScript ä¸­ï¼Œå¯ä»¥åˆ©ç”¨ never ç±»å‹çš„ç‰¹æ€§æ¥å®ç°å…¨é¢æ€§æ£€æŸ¥ï¼Œå…·ä½“ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910111213type Foo = string | number;function controlFlowAnalysisWithNever(foo: Foo) &#123; if (typeof foo === &quot;string&quot;) &#123; // è¿™é‡Œ foo è¢«æ”¶çª„ä¸º string ç±»å‹ &#125; else if (typeof foo === &quot;number&quot;) &#123; // è¿™é‡Œ foo è¢«æ”¶çª„ä¸º number ç±»å‹ &#125; else &#123; // foo åœ¨è¿™é‡Œæ˜¯ never const check: never = foo; &#125;&#125; æ³¨æ„åœ¨ else åˆ†æ”¯é‡Œé¢ï¼Œæˆ‘ä»¬æŠŠæ”¶çª„ä¸º never çš„ foo èµ‹å€¼ç»™ä¸€ä¸ªæ˜¾ç¤ºå£°æ˜çš„ never å˜é‡ã€‚å¦‚æœä¸€åˆ‡é€»è¾‘æ­£ç¡®ï¼Œé‚£ä¹ˆè¿™é‡Œåº”è¯¥èƒ½å¤Ÿç¼–è¯‘é€šè¿‡ã€‚ä½†æ˜¯å‡å¦‚åæ¥æœ‰ä¸€å¤©ä½ çš„åŒäº‹ä¿®æ”¹äº† Foo çš„ç±»å‹ï¼š 12type Foo = string | number | boolean; ç„¶è€Œä»–å¿˜è®°åŒæ—¶ä¿®æ”¹ controlFlowAnalysisWithNever æ–¹æ³•ä¸­çš„æ§åˆ¶æµç¨‹ï¼Œè¿™æ—¶å€™ else åˆ†æ”¯çš„ foo ç±»å‹ä¼šè¢«æ”¶çª„ä¸º boolean ç±»å‹ï¼Œå¯¼è‡´æ— æ³•èµ‹å€¼ç»™ never ç±»å‹ï¼Œè¿™æ—¶å°±ä¼šäº§ç”Ÿä¸€ä¸ªç¼–è¯‘é”™è¯¯ã€‚é€šè¿‡è¿™ä¸ªæ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿controlFlowAnalysisWithNever æ–¹æ³•æ€»æ˜¯ç©·å°½äº† Foo çš„æ‰€æœ‰å¯èƒ½ç±»å‹ã€‚ é€šè¿‡è¿™ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šä½¿ç”¨ never é¿å…å‡ºç°æ–°å¢äº†è”åˆç±»å‹æ²¡æœ‰å¯¹åº”çš„å®ç°ï¼Œç›®çš„å°±æ˜¯å†™å‡ºç±»å‹ç»å¯¹å®‰å…¨çš„ä»£ç ã€‚ - type vs interfaceä¸¤è€…éƒ½å¯ä»¥ç”¨æ¥å®šä¹‰ç±»å‹ã€‚ interfaceï¼ˆæ¥å£ï¼‰ åªèƒ½å£°æ˜å¯¹è±¡ç±»å‹ï¼Œæ”¯æŒå£°æ˜åˆå¹¶ï¼ˆå¯æ‰©å±•ï¼‰ã€‚ 12345678910111213interface User &#123; id: string&#125; interface User &#123; name: string&#125; const user = &#123;&#125; as User console.log(user.id);console.log(user.name); typeï¼ˆç±»å‹åˆ«åï¼‰ä¸æ”¯æŒå£°æ˜åˆå¹¶ã€è¡Œä¸ºæœ‰ç‚¹åƒconst, let æœ‰å—çº§ä½œç”¨åŸŸã€‚ 1234567891011121314type User = &#123; id: string,&#125;if (true) &#123; type User = &#123; name: string, &#125; const user = &#123;&#125; as User; console.log(user.name); console.log(user.id) // ç±»å‹â€œUserâ€ä¸Šä¸å­˜åœ¨å±æ€§â€œidâ€ã€‚&#125; type æ›´ä¸ºé€šç”¨ï¼Œå³ä¾§å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼ŒåŒ…æ‹¬è¡¨è¾¾å¼è¿ç®—ï¼Œä»¥åŠæ˜ å°„ç±»å‹ç­‰ç­‰ã€‚ 123type A = numbertype B = A | stringtype ValueOf&lt;T&gt; = T[keyof T]; å¦‚æœä½ æ˜¯åœ¨å¼€å‘ä¸€ä¸ªåŒ…ï¼Œæ¨¡å—ï¼Œå…è®¸åˆ«äººè¿›è¡Œæ‰©å±•å°±ç”¨ interfaceï¼Œå¦‚æœéœ€è¦å®šä¹‰åŸºç¡€æ•°æ®ç±»å‹æˆ–è€…éœ€è¦ç±»å‹è¿ç®—ï¼Œä½¿ç”¨ typeã€‚ - enum vs const enumé»˜è®¤æƒ…å†µä¸‹ enum ä¼šè¢«ç¼–è¯‘æˆ Javascript å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ value åå‘æŸ¥æ‰¾ã€‚ 1234567891011121314151617181920enum ActiveType &#123; active = 1, inactive = 2,&#125;function isActive(type: ActiveType) &#123;&#125;isActive(ActiveType.active);// ============================== compile result:// var ActiveType;// (function (ActiveType) &#123;// ActiveType[ActiveType[&quot;active&quot;] = 1] = &quot;active&quot;;// ActiveType[ActiveType[&quot;inactive&quot;] = 2] = &quot;inactive&quot;;// &#125;)(ActiveType || (ActiveType = &#123;&#125;));// function isActive(type) &#123; &#125;// isActive(ActiveType.active);ActiveType[1]; // OKActiveType[10]; // OKï¼ï¼ï¼ cosnt enum é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šç”Ÿæˆ Javascript å¯¹è±¡è€Œæ˜¯æŠŠä½¿ç”¨åˆ°çš„ä»£ç ç›´æ¥è¾“å‡º valueï¼Œä¸æ”¯æŒ value åå‘æŸ¥æ‰¾ã€‚ 123456789101112131415const enum ActiveType &#123; active = 1, inactive = 2,&#125;function isActive(type: ActiveType) &#123;&#125;isActive(ActiveType.active);// ============================== compile result:// function isActive(type) &#123; &#125;// isActive(1 /* active */);ActiveType[1]; // ErrorActiveType[10]; // Error ç±»å‹è¿ç®—é›†åˆè¿ç®—&amp; åœ¨ JS ä¸­è¡¨ç¤ºä½ä¸è¿ç®—ç¬¦ï¼Œåœ¨ Typescript ä¸­ç”¨æ¥è®¡ç®—ä¸¤ä¸ªç±»å‹çš„äº¤é›†ã€‚ 123type Type1 = &quot;a&quot; | &quot;b&quot;;type Type2 = &quot;b&quot; | &quot;c&quot;;type Type3 = Type1 &amp; Type2; // &#x27;b&#x27; | åœ¨ JS ä¸­è¡¨ç¤ºä½æˆ–è¿ç®—ç¬¦ï¼Œåœ¨ Typescript ä¸­ç”¨æ¥è®¡ç®—ä¸¤ä¸ªç±»å‹çš„å¹¶é›†ã€‚ 1234type Type1 = &quot;a&quot; | &quot;b&quot;;type Type2 = &quot;b&quot; | &quot;c&quot;;type Type3 = Type1 | Type2; // &#x27;a&#x27; &#x27;b&#x27; &#x27;c&#x27; ç´¢å¼•ç­¾åç´¢å¼•ç­¾åå¯ä»¥ç”¨æ¥å®šä¹‰å¯¹è±¡å†…çš„å±æ€§ã€å€¼çš„ç±»å‹ï¼Œä¾‹å¦‚å®šä¹‰ä¸€ä¸ª React ç»„ä»¶ï¼Œå…è®¸ Props å¯ä»¥ä¼ ä»»æ„ key ä¸º stringï¼Œvalue ä¸º number çš„ propsã€‚ 12345678interface Props &#123; [key: string]: number&#125;&lt;Component count=&#123;1&#125; /&gt; // OK&lt;Component count=&#123;true&#125; /&gt; // Error&lt;Component count=&#123;&#x27;1&#x27;&#125; /&gt; // Error ç±»å‹é”®å…¥ç±»å‹é”®å…¥å…è®¸ Typescript åƒå¯¹è±¡å–å±æ€§å€¼ä¸€æ ·ä½¿ç”¨ç±»å‹ã€‚ 123456789101112type User = &#123; userId: string friendList: &#123; fristName: string lastName: string &#125;[]&#125;type UserIdType = User[&#x27;userId&#x27;] // stringtype FriendList = User[&#x27;friendList&#x27;] // &#123; fristName: string; lastName: string; &#125;[]type Friend = FriendList[number] // &#123; fristName: string; lastName: string; &#125; åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨ç±»å‹é”®å…¥çš„åŠŸèƒ½ä» User ç±»å‹ä¸­è®¡ç®—å‡ºäº†å…¶ä»–çš„å‡ ç§ç±»å‹ã€‚FriendList[number] è¿™é‡Œçš„ number æ˜¯å…³é”®å­—ï¼Œç”¨æ¥å–æ•°ç»„å­é¡¹çš„ç±»å‹ã€‚åœ¨å…ƒç»„ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨å­—é¢é‡æ•°å­—å¾—åˆ°æ•°ç»„å…ƒç´ çš„ç±»å‹ã€‚ 123type Tuple = [number, string]type First = Tuple[0] // numbertype Second = Tuple[1] // string typeof valuetypeof å…³é”®å­—åœ¨ JS ä¸­ç”¨æ¥è·å–å˜é‡çš„ç±»å‹ï¼Œè¿ç®—ç»“æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå€¼ï¼‰ã€‚è€Œåœ¨ TS ä¸­è¡¨ç¤ºçš„æ˜¯æ¨ç®—ä¸€ä¸ªå˜é‡çš„ç±»å‹ï¼ˆç±»å‹ï¼‰ 123456let str1 = &#x27;fooooo&#x27;type Type1 = typeof str1 // type stringconst str2 = &#x27;fooooo&#x27;type Type2 = typeof str2 // type &quot;fooooo&quot; typeof åœ¨è®¡ç®—å˜é‡å’Œå¸¸é‡æ—¶æœ‰æ‰€ä¸åŒï¼Œç”±äºå¸¸é‡æ—¶ä¸ä¼šå˜çš„ï¼Œæ‰€ä»¥ Typescript ä¼šä½¿ç”¨ä¸¥æ ¼çš„ç±»å‹ï¼Œä¾‹å¦‚ä¸‹é¢ Type2 çš„ä¾‹å­ï¼Œstr2 çš„æ˜¯ä¸ª â€˜foooooâ€™ ç±»å‹çš„å­—ç¬¦ä¸²ã€‚è€Œå˜é‡ä¼šæ˜¯å®½æ¾çš„å­—ç¬¦ä¸²ç±»å‹ã€‚ keyof Typekeyof å…³é”®å­—å¯ä»¥ç”¨æ¥è·å–ä¸€ä¸ªå¯¹è±¡ç±»å‹çš„æ‰€æœ‰ key ç±»å‹ã€‚ 1234567type User = &#123; id: string; name: string;&#125;;type UserKeys = keyof User; //&quot;id&quot; | &quot;name&quot; enum åœ¨ Typescript ä¸­æœ‰ä¸€å®šçš„ç‰¹æ®Šæ€§ï¼ˆæœ‰æ—¶è¡¨ç¤ºç±»å‹ï¼Œåˆæ˜¯è¡¨ç¤ºå€¼ï¼‰ï¼Œå¦‚æœè¦è·å– enum çš„ key ç±»å‹ï¼Œéœ€è¦å…ˆæŠŠå®ƒå½“æˆå€¼ï¼Œç”¨ typeof å†ç”¨ keyofã€‚ 1234567enum ActiveType &#123; Active, Inactive&#125;type KeyOfType = keyof typeof ActiveType // &quot;Active&quot; | &quot;Inactive&quot; extendsextends å…³é”®å­—åŒæ ·å­˜åœ¨å¤šç§ç”¨é€”ï¼Œåœ¨ interface ä¸­è¡¨ç¤ºç±»å‹æ‰©å±•ï¼Œåœ¨æ¡ä»¶ç±»å‹è¯­å¥ä¸­è¡¨ç¤ºå¸ƒå°”è¿ç®—ï¼Œåœ¨æ³›å‹ä¸­èµ·åˆ°é™åˆ¶çš„ä½œç”¨ï¼Œåœ¨ class ä¸­è¡¨ç¤ºç»§æ‰¿ã€‚ 12345678910111213141516171819202122232425// è¡¨ç¤ºç±»å‹æ‰©å±•interface A &#123; a: string&#125;interface B extends A &#123; // &#123; a: string, b: string &#125; b: string&#125;// æ¡ä»¶ç±»å‹ä¸­èµ·åˆ°å¸ƒå°”è¿ç®—çš„åŠŸèƒ½type Bar&lt;T&gt; = T extends string ? &#x27;string&#x27; : nevertype C = Bar&lt;number&gt; // nevertype D = Bar&lt;string&gt; // stringtype E = Bar&lt;&#x27;fooo&#x27;&gt; // string// èµ·åˆ°ç±»å‹é™åˆ¶çš„ä½œç”¨type Foo&lt;T extends object&gt; = Ttype F = Foo&lt;number&gt; // ç±»å‹â€œnumberâ€ä¸æ»¡è¶³çº¦æŸâ€œobjectâ€ã€‚type G = Foo&lt;string&gt; // ç±»å‹â€œstringâ€ä¸æ»¡è¶³çº¦æŸâ€œobjectâ€ã€‚type H = Foo&lt;&#123;&#125;&gt; // OK// ç±»ç»§æ‰¿class I &#123;&#125;class J extends I &#123;&#125; æ³›å‹å‡è®¾ filter æ–¹æ³•ä¼ å…¥ä¸€ä¸ªæ•°å­—ç±»å‹çš„æ•°ç»„ï¼ŒåŠä¸€ä¸ªè¿”å›å¸ƒå°”å€¼çš„æ–¹æ³•ï¼Œæœ€ç»ˆè¿‡æ»¤å‡ºæƒ³è¦çš„ç»“æœè¿”å›ï¼Œå£°æ˜å¤§è‡´å¦‚ä¸‹ã€‚ 12345declare function filter( array: number[], fn: (item: unknown) =&gt; boolean): number[]; è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œéœ€è¦ä½¿ç”¨ filter æ–¹æ³•æ¥è¿‡æ»¤ä¸€äº›å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨ Typescript çš„å‡½æ•°é‡è½½çš„åŠŸèƒ½ï¼Œfilter å†…éƒ¨ä»£ç ä¸å˜ï¼Œåªéœ€è¦æ·»åŠ ç±»å‹å®šä¹‰ã€‚ 12345678910declare function filter( array: string[], fn: (item: unknown) =&gt; boolean): string[];declare function filter( array: number[], fn: (item: unknown) =&gt; boolean): number[]; åˆè¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œéœ€è¦ç”¨ filter æ¥è¿‡æ»¤ boolean[], è¿‡æ»¤ object[], è¿‡æ»¤å…¶ä»–å…·ä½“ç±»å‹ï¼Œå¦‚æœä»ç„¶ä½¿ç”¨é‡è½½çš„æ–¹æ³•å°†ä¼šå‡ºç°éå¸¸å¤šé‡å¤çš„ä»£ç ã€‚è¿™æ—¶å€™å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨æ³›å‹äº†ï¼ŒDont repeat yourselfã€‚ æ³›å‹å°±åƒ Typescript â€œè¯­è¨€â€ ä¸­çš„â€œæ–¹æ³•â€ï¼Œå¯ä»¥é€šè¿‡â€œä¼ å‚â€æ¥å¾—åˆ°æ–°çš„ç±»å‹ã€‚æ—¥å¸¸å¼€å‘ä¸­ç»å¸¸ç”¨åˆ°çš„æ³›å‹æœ‰ Promiseã€Arrayã€React.Component ç­‰ç­‰ã€‚ ä½¿ç”¨æ³›å‹æ¥æ”¹é€  filter æ–¹æ³•: 12345declare function filter&lt;T&gt;( array: T[], fn: (item: unknown) =&gt; boolean): T[]; åªéœ€è¦åœ¨æ–¹æ³•ååé¢åŠ ä¸Šå°–æ‹¬å·&lt;T&gt;ï¼Œè¡¨ç¤ºæ–¹æ³•æ”¯æŒä¸€ä¸ªæ³›å‹å‚æ•°ï¼Œ(è¿™é‡Œçš„ T å¯ä»¥æ”¹ä¸ºä»»æ„ä½ å–œæ¬¢çš„å˜é‡åï¼Œå¤§éƒ¨åˆ†äººçš„åå¥½æ˜¯ä» Tã€Uã€Vâ€¦å¼€å§‹å‘½å)ï¼Œarray: T[] è¡¨ç¤ºä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ³›å‹æ¨¡æ¿ç±»å‹çš„æ•°ç»„ï¼Œ:T[] è¡¨ç¤ºæ–¹æ³•ä¼šè¿”å›æ¨¡æ¿ç±»å‹çš„æ•°ç»„ã€‚Typescript å°†ä¼šè‡ªåŠ¨æ ¹æ®ä¼ å‚ç±»å‹è¾¨åˆ«å‡º T å®é™…ä»£è¡¨çš„ç±»å‹ï¼Œè¿™æ ·å°±å¯ä»¥ä¿ç•™ç±»å‹çš„åŒæ—¶ï¼Œé¿å…é‡å¤ä»£ç äº† 123filter([1, 2, 3], () =&gt; true) // function filter&lt;number&gt;(array: number[], fn: (item: unknown) =&gt; boolean): number[]filter([&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;], () =&gt; true) // function filter&lt;string&gt;(array: string[], fn: (item: unknown) =&gt; boolean): string[] æŠŠæ³›å‹æ¯”å–»æˆâ€œæ–¹æ³•â€ä¹‹åï¼Œå¾ˆå¤šè¡Œä¸ºéƒ½å¾ˆå¥½ç†è§£ã€‚â€œæ–¹æ³•â€å¯ä»¥ä¼ å‚ï¼Œå¯ä»¥æœ‰å¤šä¸ªå‚æ•°ï¼Œå¯ä»¥æœ‰é»˜è®¤å€¼ï¼Œæ³›å‹ä¹Ÿå¯ä»¥ã€‚ 12345678type Foo&lt;T, U = string&gt; = &#123; // å¤šå‚æ•°ã€é»˜è®¤å€¼ foo: Array&lt;T&gt; // å¯ä»¥ä¼ é€’ bar: U&#125;type A = Foo&lt;number&gt; // type A = &#123; foo: number[]; bar: string; &#125;type B = Foo&lt;number, number&gt; // type B = &#123; foo: number[]; bar: number; &#125; åˆ«å¿˜äº†ï¼Œæ³›å‹å‚æ•°è¿˜å¯ä»¥æœ‰é™åˆ¶ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ extends çš„ä½œç”¨æ˜¯é™åˆ¶ T è‡³å°‘æ˜¯ä¸ª HTMLElement ç±»å‹ã€‚ 12345type MyEvent&lt;T extends HTMLElement = HTMLElement&gt; = &#123; target: T, type: string&#125; æ˜ å°„ç±»å‹å…³é”®å­— inin å…³é”®å­—åœ¨ç±»å‹ä¸­è¡¨ç¤ºç±»å‹æ˜ å°„ï¼Œå’Œç´¢å¼•ç­¾åçš„å†™æ³•æœ‰äº›ç›¸ä¼¼ã€‚ä¸‹é¢çš„ä¾‹å­ä¸­å£°æ˜ä¸€ä¸ª Props çš„ç±»å‹ï¼Œkey ç±»å‹ä¸º â€˜countâ€™ | â€˜idâ€™ ç±»å‹ï¼Œvalue ä¸º number ç±»å‹ã€‚ 1234567891011121314151617181920type Props = &#123; [key in &#x27;count&#x27; | &#x27;id&#x27;]: number&#125;const props1: Props = &#123; // OK count: 1, id: 1&#125;const props2: Props = &#123; count: &#x27;1&#x27;, // ERROR id: 1&#125;const props3: Props = &#123; count: 1, id: 1, name: 1 // ERROR&#125; RecordRecord å®šä¹‰é”®ç±»å‹ä¸º Keysã€å€¼ç±»å‹ä¸º Values çš„å¯¹è±¡ç±»å‹ã€‚ ç¤ºä¾‹ : 1234567891011enum ErrorCodes &#123; Timeout = 10001, ServerBusy = 10002, &#125;const ErrorMessageMap: Record&lt;ErrorCodes, string&gt; = &#123; [ErrorCodes.Timeout]: &#x27;Timeout, please try again&#x27;, [ErrorCodes.ServerBusy]: &#x27;Server is busy now&#x27;&#125; ç±»å‹æ˜ å°„è¿˜å¯ä»¥ç”¨æ¥åšå…¨é¢æ€§æ£€æŸ¥ï¼Œä¾‹å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­å¦‚æœæ¼äº†æŸä¸ª ErrorCodesï¼ŒTypescript åŒæ ·ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ 123456789101112enum ErrorCodes &#123; Timeout = 10001, ServerBusy = 10002, AuthFailed = 10003&#125;// ç±»å‹ &quot;&#123; 10001: string; 10002: string; &#125;&quot; ä¸­ç¼ºå°‘å±æ€§ &quot;10003&quot;ï¼Œä½†ç±»å‹ &quot;Record&lt;ErrorCodes, string&gt;&quot; ä¸­éœ€è¦è¯¥å±æ€§const ErrorMessageMap: Record&lt;ErrorCodes, string&gt; = &#123; [ErrorCodes.Timeout]: &#x27;Timeout, please try again&#x27;, [ErrorCodes.ServerBusy]: &#x27;Server is busy now&#x27;&#125; ä»£ç å®ç°ï¼š 123type Record&lt;K extends keyof any, T&gt; = &#123; [P in K]: T;&#125;; PartialPartial å¯ä»¥å°†ç±»å‹å®šä¹‰çš„å±æ€§å˜æˆå¯é€‰ã€‚ ç¤ºä¾‹ï¼š 123456789type User = &#123; id?: string, gender: &#x27;male&#x27; | &#x27;female&#x27;&#125;type PartialUser = Partial&lt;User&gt; // &#123; id?: string, gender?: &#x27;male&#x27; | &#x27;female&#x27;&#125;function createUser (user: PartialUser = &#123; gender: &#x27;male&#x27; &#125;) &#123;&#125; User ç±»å‹å¯¹äº gender å±æ€§æ˜¯è¦æ±‚å¿…é¡»æœ‰çš„(: ç”¨æˆ·å¿…é¡»æœ‰æ€§åˆ«æ‰è¡Œã€‚è€Œåœ¨è®¾è®¡ createUser æ–¹æ³•æ—¶ï¼Œä¸ºäº†æ–¹ä¾¿ç¨‹åºä¼šç»™ gender èµ‹äºˆé»˜è®¤å€¼ã€‚è¿™æ—¶å€™å¯ä»¥å°†å‚æ•°ä¿®æ”¹æˆ Partialï¼Œä½¿ç”¨è€…å°±å¯ä»¥ä¸ç”¨å¿…é¡»ä¼  gender äº†ã€‚ ä»£ç å®ç°ï¼š 1234type Partial&lt;T&gt; = &#123; [U in keyof T]?: T[U];&#125;; RequiredRequired å’Œ Partial çš„ä½œç”¨ç›¸åï¼Œæ˜¯å°†å¯¹è±¡ç±»å‹çš„å±æ€§éƒ½å˜æˆå¿…é¡»ã€‚ ç¤ºä¾‹ï¼š 123456789101112type User = &#123; id?: string, gender: &#x27;male&#x27; | &#x27;female&#x27;&#125;type RequiredUser = Required&lt;User&gt; // &#123; readonly id: string, readonly gender: &#x27;male&#x27; | &#x27;female&#x27;&#125;function showUserProfile (user: RequiredUser) &#123; console.log(user.id) // ä¸éœ€è¦åŠ  ï¼ console.log(user.gender)&#125; ä»»ç„¶ä½¿ç”¨ User ç±»å‹ï¼Œid å±æ€§å®šä¹‰çš„æ—¶å€™æ˜¯å¯é€‰çš„ï¼ˆè¦åˆ›å»ºäº†æ‰æœ‰ idï¼‰ï¼Œè€Œå±•ç¤ºçš„æ—¶å€™ User id è‚¯å®šå·²ç»å­˜åœ¨äº†ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨ Requiredï¼Œé‚£ä¹ˆè°ƒç”¨ showUserProfile æ—¶ User æ‰€æœ‰å±æ€§éƒ½å¿…é¡»é undefinedã€‚ ä»£ç å®ç°ï¼š 1234type Required&lt;T&gt; = &#123; [U in keyof T]-?: T[U];&#125;; -? ç¬¦å·åœ¨è¿™é‡Œè¡¨ç¤ºçš„æ„æ€æ˜¯å»æ‰å¯é€‰ç¬¦å· ?ã€‚ ReadonlyReadonly æ˜¯å°†å¯¹è±¡ç±»å‹çš„å±æ€§éƒ½å˜æˆåªè¯»ã€‚ ç¤ºä¾‹ï¼š 123456789type ReadonlyUser = Readonly&lt;User&gt; // &#123; readonly id?: string, readonly gender: &#x27;male&#x27; | &#x27;female&#x27;&#125;const user: ReadonlyUser = &#123; id: &#x27;1&#x27;, gender: &#x27;male&#x27;&#125;user.gender = &#x27;femail&#x27; // æ— æ³•åˆ†é…åˆ° &quot;gender&quot; ï¼Œå› ä¸ºå®ƒæ˜¯åªè¯»å±æ€§ã€‚ ä»£ç å®ç°ï¼š 1234type Readonly&lt;T&gt; = &#123; readonly [U in keyof T]: T[U];&#125;; PickPick æ˜¯æŒ‘é€‰ç±»å‹ä¸­çš„éƒ¨åˆ†å±æ€§ã€‚ ç¤ºä¾‹ï¼š 12345678910111213141516type Location = &#123; latitude: number longitude: number city: string address: string province: string district: string&#125;type LatLong = Pick&lt;Location, &#x27;latitude&#x27; | &#x27;longitude&#x27;&gt; // &#123; latitude: number; longitude: number; &#125;const region: LatLong = &#123; latitude: 22.545001, longitude: 114.011712&#125; ä»£ç å®ç°ï¼š 1234type Pick&lt;T, K extends keyof T&gt; = &#123; [P in K]: T[P];&#125;; OmitOmit ç»“åˆäº† Pick å’Œ Excludeï¼Œå°†å¿½ç•¥å¯¹è±¡ç±»å‹ä¸­çš„éƒ¨åˆ† keysã€‚ ç¤ºä¾‹ï¼š 12345678910111213interface Todo &#123; title: string; description: string; completed: boolean;&#125;type TodoPreview = Omit&lt;Todo, &quot;description&quot;&gt;; // &#123; title: string; completed: boolean; &#125;const todo: TodoPreview = &#123; title: &quot;Clean room&quot;, completed: false,&#125;; ä»£ç å®ç°ï¼š 12type Omit&lt;T, K extends keyof any&gt; = Pick&lt;T, Exclude&lt;keyof T, K&gt;&gt;; æ¡ä»¶ç±»å‹ä¸‰ç›®è¿ç®—ç¬¦Typescript ç±»å‹è¿ç®—ä¹Ÿæ”¯æŒâ€œä¸‰ç›®è¿ç®—ç¬¦â€ï¼Œç§°ä¹‹ä¸ºæ¡ä»¶ç±»å‹ï¼Œä¸€èˆ¬é€šè¿‡ extends å…³é”®å­—åˆ¤æ–­æ¡ä»¶æˆä¸æˆç«‹ï¼Œæˆç«‹çš„è¯å¾—åˆ°ä¸€ä¸ªç±»å‹ï¼Œä¸æˆç«‹çš„è¯è¿”å›å¦ä¸€ä¸ªç±»å‹ã€‚æ¡ä»¶ç±»å‹é€šå¸¸æ˜¯ä¸æ³›å‹åŒæ—¶å‡ºç°çš„ï¼ˆï¼šå› ä¸ºå¦‚æœæ˜¯å·²çŸ¥å›ºå®šç±»å‹å°±æ²¡å¿…è¦å†åˆ¤æ–­äº†ã€‚ 12345type IsString&lt;T&gt; = T extends string ? true : falsetype A = IsString&lt;number&gt; // falsetype B = IsString&lt;string&gt; // true åœ¨å¤„ç†å¹¶é›†æ—¶ï¼Œæ¡ä»¶ç±»å‹è¿˜å…·æœ‰æ¡ä»¶åˆ†é…çš„é€»è¾‘ï¼Œnumber | string åšæ¡ä»¶è¿ç®—ç­‰ä»·äº number æ¡ä»¶è¿ç®— | string æ¡ä»¶è¿ç®— 123456type ToArray&lt;T&gt; = T[]type A = ToArray&lt;number | string&gt; // (string | number)[]type ToArray2&lt;T&gt; = T extends unknown ? T[] : T[];type B = ToArray2&lt;number | string&gt;; // string[] | number[] inferé™¤äº†æ˜¾ç¤ºå£°æ˜æ³›å‹å‚æ•°ï¼ŒTypescript è¿˜æ”¯æŒåŠ¨æ€æ¨å¯¼æ³›å‹ï¼Œç”¨åˆ°çš„æ˜¯ infer å…³é”®å­—ã€‚ä»€ä¹ˆåœºæ™¯ä¸‹è¿˜éœ€è¦åŠ¨æ€æ¨å¯¼ï¼Ÿé€šå¸¸æ˜¯éœ€è¦é€šè¿‡ä¼ å…¥çš„æ³›å‹å‚æ•°å»è·å–æ–°çš„ç±»å‹ï¼Œè¿™å’Œç›´æ¥å®šä¹‰ä¸€ä¸ªæ–°çš„æ³›å‹å‚æ•°ä¸ä¸€æ ·ã€‚ ä¾‹å¦‚ç°åœ¨å®šä¹‰äº† ApiResponse çš„ä¸¤ä¸ªå…·ä½“ç±»å‹ UserResponse å’Œ EventResponseï¼Œå¦‚æœæƒ³å¾—åˆ° User å®ä½“ç±»å‹å’Œ Event å®ä½“ç±»å‹éœ€è¦æ€ä¹ˆåšï¼Ÿ 123456789101112131415type ApiResponse&lt;T&gt; = &#123; code: number data: T&#125;;type UserResponse = ApiResponse&lt;&#123; id: string, name: string&#125;&gt;type EventResponse = ApiResponse&lt;&#123; id: string, title: string&#125;&gt; å½“ç„¶å¯ä»¥æ‹å‡ºæ¥å•ç‹¬å®šä¹‰æ–°çš„ç±»å‹ã€‚ 1234567type User = &#123; id: string, name: string&#125;type UserResponse = ApiResponse&lt;User&gt; ä½†å¦‚æœç±»å‹æ˜¯ç”±å…¶ä»–äººæä¾›çš„å°±ä¸å¥½å¤„ç†äº†ã€‚è¿™æ—¶å¯ä»¥å°è¯•ä¸‹ä½¿ç”¨ inferï¼Œä»£ç å¦‚ä¸‹ï¼š 12345type ApiResponseEntity&lt;T&gt; = T extends ApiResponse&lt;infer U&gt; ? U : never;type User = ApiResponseEntity&lt;UserResponse&gt;; // &#123; id: string; name: string; &#125;type Event = ApiResponseEntity&lt;EventResponse&gt;; // &#123; id: string; title: string; &#125; ç¤ºä¾‹ä¸­ï¼Œåˆ¤æ–­ä¼ å…¥çš„ç±»å‹ T æ˜¯ä¸æ˜¯ T extends ApiResponse çš„å­é›†ï¼Œè¿™é‡Œçš„ infer æ—¢æ˜¯è®© Typescript å°è¯•å»ç†è§£ T å…·ä½“æ˜¯é‚£ç§ç±»å‹çš„ ApiResponseï¼Œç”Ÿæˆæ–°çš„æ³›å‹å‚æ•° Uã€‚å¦‚æœæ»¡è¶³ extends æ¡ä»¶åˆ™å°† U ç±»å‹è¿”å›ã€‚ å……åˆ†ç†è§£äº†æ¡ä»¶ç±»å‹å’Œ inferå…³é”®å­—ä¹‹åï¼ŒTypescript è‡ªå¸¦çš„æ¡ä»¶æ³›å‹å·¥å…·ä¹Ÿå°±å¾ˆå¥½ç†è§£äº†ã€‚ ReturnTypeReturntype ç”¨æ¥è·å–æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ ç¤ºä¾‹ï¼š 123type A = (a: number) =&gt; stringtype B = ReturnType&lt;A&gt; // string ä»£ç å®ç°ï¼š 1234type ReturnType&lt;T&gt; = T extends ( ...args: any[]) =&gt; infer R ? R : any; ParametersParameters ç”¨æ¥è·å–æ–¹æ³•çš„å‚æ•°ç±»å‹ ç¤ºä¾‹ï¼š 123type EventListenerParamsType = Parameters&lt;typeof window.addEventListener&gt;;// [type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions | undefined] ä»£ç å®ç°ï¼š 123type Parameters&lt;T extends (...args: any) =&gt; any&gt; = T extends (...args: infer P) =&gt; any ? P : never; ExcludeExclude ç”¨æ¥è®¡ç®—åœ¨ T ä¸­è€Œä¸åœ¨ U ä¸­çš„ç±»å‹ ç¤ºä¾‹ï¼š 1234type A = number | stringtype B = stringtype C = Exclude&lt;A, B&gt; // number ä»£ç å®ç°ï¼š 12type Exclude&lt;T, U&gt; = T extends U ? never : T; ExtractExtract ç”¨æ¥è®¡ç®— T ä¸­å¯ä»¥èµ‹å€¼ç»™ U çš„ç±»å‹ ç¤ºä¾‹ï¼š 1234type A = number | stringtype B = stringtype C = Extract&lt;A, B&gt; // string ä»£ç å®ç°ï¼š 1type Extract&lt;T, U&gt; = T extends U ? T : never; NonNullableä»ç±»å‹ä¸­æ’é™¤ null å’Œ undefined ç¤ºä¾‹ï¼š 12345type A = &#123; a?: number | null&#125;type B = NonNullable(A[&#x27;a&#x27;]) // number ä»£ç å®ç°ï¼š 1type NonNullable&lt;T&gt; = T extends null | undefined ? never : T; Eventäº‹ä»¶å¯¹è±¡ç±»å‹å¸¸ç”¨çš„Eventäº‹ä»¶å¯¹è±¡ç±»å‹ ClipboardEvent&lt;T =Element&gt; å‰ªè´´æ¿äº‹ä»¶å¯¹è±¡ DragEvent&lt;T =Element&gt; æ‹–æ‹½äº‹ä»¶å¯¹è±¡ ChangeEvent&lt;T =Element&gt; Change äº‹ä»¶å¯¹è±¡ KeyboardEvent&lt;T =Element&gt; é”®ç›˜äº‹ä»¶å¯¹è±¡ MouseEvent&lt;T =Element&gt; é¼ æ ‡äº‹ä»¶å¯¹è±¡ TouchEvent&lt;T =Element&gt; è§¦æ‘¸äº‹ä»¶å¯¹è±¡ WheelEvent&lt;T =Element&gt; æ»šè½®äº‹ä»¶å¯¹è±¡ AnimationEvent&lt;T =Element&gt; åŠ¨ç”»äº‹ä»¶å¯¹è±¡ TransitionEvent&lt;T =Element&gt; è¿‡æ¸¡äº‹ä»¶å¯¹è±¡ 123456import &#123; MouseEvent &#125; from &#x27;react&#x27;;interface IProps &#123; onClick (event: MouseEvent&lt;HTMLDivElement&gt;): void,&#125; ç»„ä»¶å¼€å‘æœ‰çŠ¶æ€ç»„ä»¶1234export class MyForm extends React.Component&lt;FormProps, FormState&gt; &#123;\t...&#125; å…¶ä¸­çš„FormPropså’ŒFormStateåˆ†åˆ«ä»£è¡¨è¿™çŠ¶æ€ç»„ä»¶çš„propså’Œstateçš„interface æ³¨æ„ï¼šåœ¨åªæœ‰stateè€Œæ²¡æœ‰propsçš„æƒ…å†µä¸‹ï¼Œpropsçš„ä½ç½®å¯ä»¥ç”¨{}æˆ–è€…objectå ä½ï¼Œè¿™ä¸¤ä¸ªå€¼éƒ½è¡¨ç¤ºæœ‰æ•ˆçš„ç©ºå¯¹è±¡ã€‚ æ— çŠ¶æ€ç»„ä»¶æ— çŠ¶æ€ç»„ä»¶ä¹Ÿè¢«ç§°ä¸ºå±•ç¤ºç»„ä»¶ï¼Œå¦‚æœä¸€ä¸ªå±•ç¤ºç»„ä»¶æ²¡æœ‰å†…éƒ¨çš„stateå¯ä»¥è¢«å†™ä¸ºçº¯å‡½æ•°ç»„ä»¶ã€‚ å¦‚æœå†™çš„æ˜¯å‡½æ•°ç»„ä»¶ï¼Œåœ¨@types/reactä¸­å®šä¹‰äº†ä¸€ä¸ªç±»å‹type SFC = StatelessComponent;ã€‚æˆ‘ä»¬å†™å‡½æ•°ç»„ä»¶çš„æ—¶å€™ï¼Œèƒ½æŒ‡å®šæˆ‘ä»¬çš„ç»„ä»¶ä¸ºSFCæˆ–è€…StatelessComponentã€‚è¿™ä¸ªé‡Œé¢å·²ç»é¢„å®šä¹‰äº†childrenç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¯æ¬¡å°±ä¸ç”¨æŒ‡å®šç±»å‹childrençš„ç±»å‹äº†ã€‚ 123456789101112131415161718192021222324import React, &#123; ReactNode, SFC &#125; from &#x27;react&#x27;;import style from &#x27;./step-complete.less&#x27;;export interface IProps &#123; title: string | ReactNode; description: string | ReactNode;&#125;const StepComplete:SFC&lt;IProps&gt; = (&#123; title, description, children &#125;) =&gt; &#123; return ( &lt;div className=&#123;style.complete&#125;&gt; &lt;div className=&#123;style.completeTitle&#125;&gt; &#123;title&#125; &lt;/div&gt; &lt;div className=&#123;style.completeSubTitle&#125;&gt; &#123;description&#125; &lt;/div&gt; &lt;div&gt; &#123;children&#125; &lt;/div&gt; &lt;/div&gt; );&#125;;export default StepComplete;","tags":["Typescript"],"categories":["Typescript"]},{"title":"30-seconds-of-js","path":"/2020/07/24/30-seconds-of-js/","content":"æ–¹æ³•- å¯¹è±¡è½¬queryStringsé€šè¿‡Object.entriesä»¥åŠreduceè¿›è¡ŒqueryStringçš„ç´¯åŠ ï¼Œåªèƒ½å°†å¯¹è±¡ä¸­å€¼ä¸ºstringçš„è½¬è¿›å»ï¼Œå¯ä»¥æ”¹è¿› 123456789const objectToQuerystring = (queryParams) =&gt; &#123; return Object.entries(queryParams).reduce((queryString, [key, value], index) =&gt; &#123; const symbol = queryString.length === 0 ? &#x27;?&#x27; : &#x27;&amp;&#x27;; queryString += typeof value === &#x27;string&#x27; ? `$&#123;symbol&#125;$&#123;key&#125;=$&#123;value&#125;` : &#x27;&#x27;; return queryString; &#125;, &#x27;&#x27;);&#125;// ?name=weng&amp;address=11111 - æ·±åº¦å†»ç»“ä¸€ä¸ªå¯¹è±¡ä½¿ç”¨Object.keysï¼ˆï¼‰è·å–æ‰€ä¼ é€’å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œä½¿ç”¨Array.prototype.forEachï¼ˆï¼‰éå†å®ƒä»¬ã€‚ åœ¨æ‰€æœ‰å±æ€§ä¸Šé€’å½’è°ƒç”¨Object.freezeï¼ˆobjï¼‰ï¼Œæ£€æŸ¥æ˜¯å¦ä½¿ç”¨Object.isFrozenï¼ˆï¼‰å†»ç»“äº†æ¯ä¸ªå±æ€§ï¼Œå¹¶æ ¹æ®éœ€è¦åº”ç”¨deepFreezeï¼ˆï¼‰ã€‚ æœ€åï¼Œä½¿ç”¨Object.freezeï¼ˆï¼‰å†»ç»“ç»™å®šçš„å¯¹è±¡ã€‚ 123456789101112131415const deepFreeze = obj =&gt; &#123; Object.keys(obj).forEach(prop =&gt; &#123; if (typeof(obj[prop]) === &#x27;object&#x27; &amp;&amp; !Object.isFrozen(obj[prop])) deepFreeze(obj[prop]); &#125;); return Object.freeze(obj);&#125;;EXAMPLES&#x27;use strict&#x27;;const o = deepFreeze([1, [2, 3]]);o[0] = 3; // not allowedo[1][0] = 4; // not allowed as well - è·å–å½“å‰urlï¼ˆä¸å¸¦ä»»ä½•å‚æ•°ï¼‰è¿”å›æ²¡æœ‰ä»»ä½•å‚æ•°çš„å½“å‰URLã€‚ ä½¿ç”¨String.prototype.indexOfï¼ˆï¼‰æ£€æŸ¥ç»™å®šçš„urlæ˜¯å¦å…·æœ‰å‚æ•°ï¼Œä½¿ç”¨String.prototype.sliceï¼ˆï¼‰åˆ é™¤å®ƒä»¬ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰ã€‚ 12const getBaseURL = url =&gt; url.indexOf(&#x27;?&#x27;) &gt; 0 ? url.slice(0, url.indexOf(&#x27;?&#x27;)) : url; - è·å–å½“å‰URLä¸‹çš„å€¼è¿”å›ä¸€ä¸ªåŒ…å«å½“å‰URLå‚æ•°çš„å¯¹è±¡ã€‚ ä½¿ç”¨å¸¦æœ‰é€‚å½“æ­£åˆ™è¡¨è¾¾å¼çš„String.prototype.matchï¼ˆï¼‰æ¥è·å–æ‰€æœ‰é”®å€¼å¯¹ï¼Œä½¿ç”¨Array.prototype.reduceï¼ˆï¼‰æ¥æ˜ å°„å®ƒä»¬å¹¶å°†å®ƒä»¬ç»„åˆæˆä¸€ä¸ªå¯¹è±¡ã€‚ ä¼ é€’location.searchä½œä¸ºå‚æ•°ä»¥åº”ç”¨äºå½“å‰ç½‘å€ã€‚ 12345const getURLParameters = url =&gt; (url.match(/([^?=&amp;]+)(=([^&amp;]*))/g) || []).reduce( (a, v) =&gt; ((a[v.slice(0, v.indexOf(&#x27;=&#x27;))] = v.slice(v.indexOf(&#x27;=&#x27;) + 1)), a), &#123;&#125;); JavaScript api-for in , for of å’Œ forEachfor infor â€¦ inç”¨äºè¿­ä»£å¯¹è±¡çš„æ‰€æœ‰å¯æšä¸¾å±æ€§ï¼ŒåŒ…æ‹¬ç»§æ‰¿çš„å¯æšä¸¾å±æ€§ã€‚ è¯¥è¿­ä»£è¯­å¥å¯ç”¨äºæ•°ç»„å­—ç¬¦ä¸²æˆ–æ™®é€šå¯¹è±¡ï¼Œä½†ä¸èƒ½ç”¨äºMapæˆ–Setå¯¹è±¡ã€‚ 1234567891011for (let prop in [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]) console.log(prop); // 0, 1, 2 (array indexes)for (let prop in &#x27;str&#x27;) console.log(prop); // 0, 1, 2 (string indexes)for (let prop in &#123;a: 1, b: 2, c: 3&#125;) console.log(prop); // a, b, c (object property names)for (let prop in new Set([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;a&#x27;, &#x27;d&#x27;])) console.log(prop); // undefined (no enumerable properties) for offor â€¦ ofç”¨äºè¿­ä»£å¯è¿­ä»£å¯¹è±¡ï¼Œè¿­ä»£å…¶å€¼è€Œä¸æ˜¯å…¶å±æ€§ã€‚ è¯¥è¿­ä»£è¯­å¥å¯ç”¨äºæ•°ç»„ï¼Œå­—ç¬¦ä¸²ï¼ŒMapæˆ–Setå¯¹è±¡ï¼Œä½†ä¸èƒ½ç”¨äºæ™®é€šå¯¹è±¡ã€‚ 1234567891011for (let val of [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]) console.log(val); // a, b, c (array values)for (let val of &#x27;str&#x27;) console.log(val); // s, t, r (string characters)for (let val of &#123;a: 1, b: 2, c: 3&#125;) console.log(prop); // TypeError (not iterable)for (let val of new Set([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;a&#x27;, &#x27;d&#x27;])) console.log(val); // a, b, d (Set values) forEachforEachï¼ˆï¼‰æ˜¯ArrayåŸå‹çš„ä¸€ç§æ–¹æ³•ï¼Œå®ƒå…è®¸æ‚¨éå†æ•°ç»„çš„å…ƒç´ ã€‚ å°½ç®¡forEachï¼ˆï¼‰ä»…è¿­ä»£æ•°ç»„ï¼Œä½†å®ƒå¯ä»¥åœ¨è¿­ä»£æ—¶è®¿é—®æ¯ä¸ªå…ƒç´ çš„å€¼å’Œç´¢å¼•ã€‚ 1234567[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;].forEach( val =&gt; console.log(val) // a, b, c (array values));[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;].forEach( (val, i) =&gt; console.log(i) // 0, 1, 2 (array indexes));","tags":["Javascript"],"categories":["Javascript"]},{"title":"reactå¸¸ç”¨åº“","path":"/2020/07/19/reactå¸¸ç”¨åº“/","content":"griddle-react react-bootstrap react-cropper core-js Material UI superagent restful-error-es6 browserify react-select-popover æ ‡ç­¾é€‰æ‹© react-infinite-scroll æ— é™æ»šåŠ¨ semantic-ui react-date-rangeæ—¥æœŸé€‰æ‹© react-scroll å¿«é€Ÿå®šä½æ»šåŠ¨ react-timer-mixin suer timer react-autosuggest auto input react-native-swiperè½®æ’­ react-split-containeråˆ†å‰²çº¿æ‹–æ‹½ ,æºç å·²ä¸‹æ¶? reactjs-iscrollä¸‹æ‹‰ä¸Šæ‹‰åˆ·æ–° react-hammerjsè§¦å±äº‹ä»¶åº“ react-emoji-react emojiè¡¨æƒ…åº“ react-aceåœ¨çº¿ç¼–è¾‘å™¨ react-highcharts highchart react-dropzone ä¸Šä¼  react-fileupload-progressæ–‡ä»¶ä¸Šä¼ å¸¦processor react-fontawesome å­—ä½“iconåº“ react-pdf pdfæ–‡æ¡£æ“ä½œ react-desktopæ¡Œé¢UI react-intl Internationalize React apps react-image-galleryå›¾ç‰‡è½®æ’­ react-s-alert alert react-event-calendaräº‹ä»¶æ—¥å† react-color-picker é¢œè‰²é€‰æ‹©å™¨ react-lazyload å»¶è¿ŸåŠ è½½ react-tag-input tag input revalidatoræ ¼å¼éªŒè¯ react-bootstrap-daterangepickeræ—¶é—´èŒƒå›´ react-transitive-numberå¢å‡æ•° react-css-transition-replaceåŠ¨ç”» react-images image list react-clockwall æ—¶é—´ç”»å¸ƒ react-autobind fun auto bind react-simple-markdown-editor markdownç¼–è¾‘ react-remarkable markdown æ˜¾ç¤º random-gem éšæœºæ•° react-masonry-component ç€‘å¸ƒæµ react-alap é«˜å¾·åœ°å›¾ react-baidu-map ç™¾åº¦åœ°å›¾ react-swipeable-views viewsæ»‘åŠ¨ react-swipnable-tabs å¯æ¨ªå‘æ»šåŠ¨çš„tab react-motion åŠ¨ç”» react-image-fallback å›¾ç‰‡lazyåŠ è½½ react-mobile-datepicker æ»šåŠ¨é€‰æ‹©æ—¶é—´ react-images å¹»ç¯ç‰‡ç¯ç®± react-image-magnify å›¾ç‰‡ç»†èŠ‚æ”¾å¤§ urlencode node encodeç¼–ç  react-mobile-datepicker æ»šåŠ¨é€‰æ‹©æ—¶é—´ å¹´æœˆæ—¥ react-mobile-datetimepickeræ»šåŠ¨é€‰æ‹©æ—¶é—´ å¹´æœˆæ—¥æ—¶åˆ† react-fastclickæ¶ˆé™¤touch click 300mså»¶è¿Ÿ react-sortable react-anything-sortable æ‹–åŠ¨æ’åº react-autosuggest è‡ªåŠ¨æç¤º react-image-crop å›¾ç‰‡è£å‰ª react-device-detect æ£€æµ‹æµè§ˆå™¨ç‰ˆæœ¬çš„","tags":["Npm"],"categories":["React"]},{"title":"reactè·¯ç”±æ‹¦æˆªè‡ªå®šä¹‰å¼¹æ¡†","path":"/2020/07/18/reactè·¯ç”±æ‹¦æˆªè‡ªå®šä¹‰å¼¹æ¡†/","content":"https://medium.com/@michaelchan_13570/using-react-router-v4-prompt-with-custom-modal-component-ca839f5faf39","tags":["React-router"],"categories":["React"]},{"title":"ä¸€äº›æ•´åˆçš„é…ç½®åº“","path":"/2020/07/11/ä¸€äº›æ•´åˆçš„é…ç½®åº“/","content":"ä»£ç è§„èŒƒåº“umi-fabric ä¸€ä¸ªåŒ…å« prettierï¼Œeslintï¼Œstylelint çš„é…ç½®æ–‡ä»¶åˆé›† github : https://github.com/umijs/fabric lint-staged Lint å°±æ˜¯å¯¹ä»£ç åšé™æ€åˆ†æï¼Œå¹¶è¯•å›¾æ‰¾å‡ºæ½œåœ¨é—®é¢˜çš„å·¥å…·ï¼Œå®æˆ˜ä¸­æˆ‘ä»¬ä¹Ÿç”¨ Lint æ¥æŒ‡ä½¿ç”¨å·¥å…·çš„è¿‡ç¨‹ã€‚ npm: https://www.npmjs.com/package/lint-staged husky Husky can prevent bad git commit, git push and more ğŸ¶ woof! npm: https://www.npmjs.com/package/husky","tags":["webpack","gulp"],"categories":["é…ç½®åº“"]},{"title":"å†™JSçš„æ—¶å€™ä¸€äº›å°æŠ€å·§æˆ–è€…å¸¸ç”¨æ“ä½œ","path":"/2020/07/11/å†™JSçš„æ—¶å€™ä¸€äº›å°æŠ€å·§/","content":"è®°å½•ä¸€äº›å¹³æ—¶å¼€å‘è¿‡ç¨‹æˆ–è€…ç¼–å†™JSè¿‡ç¨‹å°æŠ€å·§æˆ–è€…æ³¨æ„äº‹é¡¹ å…³äºæ•°ç»„- å˜é‡èµ‹å€¼123const array = new Array(); // ä¸€èˆ¬ä¸è¿™æ ·æä¸€ä¸ªæ•°ç»„const array = []; // è¿™æ ·ææ‰æ£’ - æ•°ç»„æ’åº sortæ˜¯æµè§ˆå™¨å†…ç½®æ–¹æ³• 123const arr = [1,2,3,4,5];arr.sort((a,b)=&gt;a-b);arr.sort((a,b)=&gt;b-a); - æ•°ç»„æµ…æ‹·è´ä¸€èˆ¬ä¸ç”¨ä¸€ä¸ªå¾ªç¯å°†æ•°ç»„å¤åˆ¶ä¸€ä¸ª 1234const arr = [1,2,3];//å¤åˆ¶const arrCopy = [ ...arr ] // ç›´æ¥ç”¨æ‹“å±•è¿ç®—ç¬¦ - å¤šä¸ªæ•°ç»„åˆå¹¶1234const arr1 = [1,2,3,4];const arr2 = [5,6,7,8];arr3 = [...arr1,...arr2];// [1,2,3,4,5,6,7,8]; - ç±»æ•°ç»„è½¬æˆæ•°ç»„1234567const fakeArr = [0:&#x27;hello&#x27;,1:&#x27;world&#x27;,2:&#x27;shit&#x27;,length:3];// badconst arr = Array.prototype.slice.call(arrLike)// goodconst arr = Array.from(arrLike); - æ•°ç»„è§£æ„12345678const arr = [1, 2, 3, 4]// badconst first = arr[0]const second = arr[1]// goodconst [first, second] = arr; // æ³¨æ„ä¸åƒå¯¹è±¡é‚£æ ·æ˜¯&#123;&#125;ç¬¦å·ï¼Œè€Œæ˜¯[] - æ›¿æ¢æ•°ç»„ä¸­çš„ç‰¹å®šå€¼1234const arr = [1,2,3,4,5];arr.splice(0,2,&quot;hello&quot;,&quot;world&quot;); // 0~2 å¼€å§‹ 2é™¤å¤–å¼€å§‹æŒ‰é¡ºåºæ›¿æ¢å€¼// [&#x27;hello&#x27;,&#x27;world&#x27;,3,4,5] - Array.from æ›¿æ¢mapæ•ˆæœ123456789101112131415const arr = [\t&#123; name:&#x27;weng&#x27;, age:21,\t&#125;,\t&#123; name:&#x27;wang&#x27;, age:11,\t&#125;,\t&#123; name:&#x27;sange&#x27;, age:41\t&#125;,];Array.from(arr,(&#123;name&#125;)=&gt;name); // [&#x27;weng&#x27;,&#x27;wang&#x27;,&#x27;sange&#x27;]; - æ•°ç»„å»é‡1234const arr = [1,2,3,4,5,5,6,6,7,7,10,10];const uniqueArr = Array.from(new Set(arr));const uniqueArr = [ ...new Set(arr) ]; // good - äºŒç»´æ•°ç»„è½¬ä¸€ç»´æ•°ç»„12345const arr = [[1,2,3,4],[5,6,7]];[].concat.apply(...arr); // [1,2,3,4,5,6,7] ç¡®ä¿åœ¨æ­¤æ•°ç»„æ˜¯çº¯äºŒç»´æ•°ç»„çš„æƒ…å†µä¸‹const arr = [[1,2,3,4],[5,6],7]; // ç±»ä¼¼è¿™æ ·çš„ä¸èƒ½ç”¨ä»¥ä¸Šçš„æ–¹æ³•è½¬ä¸€ç»´æ•°ç»„ï¼Œå¯ä»¥ç”¨es6çš„flatarr.flat(); // [1,2,3,4,5,6,7] - å¤šç»´æ•°ç»„è½¬ä¸€ç»´æ•°ç»„12345678const arr = [1,2,3,[[4,5],7,6],[0,10,8]];arr.flat(Infinity); // è¿™ä¸ªç©æ„ç‰›é€¼// å½“å…¼å®¹æ€§ä¸å¥½çš„æ—¶å€™var arr = [1,[2,3],[4,[5,6,[7]]]]while(arr.some(Array.isArray))&#123; arr = [].concat(...arr)&#125; // ä¸€æ‹›æå®š - å»é™¤æ•°ç»„ä¸­çš„ç©ºå¯¹è±¡123456789const arr = [&#123;name:1,age:2&#125;,&#123;&#125;,&#123;&#125;];const deleteObj=(arr)=&gt;&#123;\tif(Array.isArray(arr) &amp;&amp; arr.length&gt;1)&#123; arr.filter(item =&gt; &#123; return Object.keys(item).length&gt;0 &#125;)\t&#125;\treturn [];&#125; - æ•°ç»„ä¸­çš„æ‰€æœ‰å€¼æ˜¯å¦éƒ½æ»¡è¶³æ¡ä»¶ å¦‚æœæä¾›çš„è°“è¯å‡½æ•°å¯¹é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ è¿”å›trueï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚ 123const all = (arr, fn = Boolean) =&gt; arr.every(fn);all([4,2,3],x=&gt; x&gt;1) // trueall([1,2,3],x=&gt;x&gt;1) // false; - æ•°ç»„ä¸­æ˜¯å¦æœ‰ä¸€é¡¹æ»¡è¶³1[1,2,3].some(item =&gt; item &gt;2); - åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå€¼1234567const arr = [1,2,3,4,5,6];arr.indexOf(1)!==-1 // true æ–¹æ³•1arr.includes(1) // true æ–¹æ³•2arr.find(item =&gt; item === 1); // è¿”å›æ•°ç»„ä¸­æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè¿”å›undefined - è¿”å›ä¸¤ä¸ªæ•°ç»„ä¸ä¸€æ ·çš„å€¼123456const difference = (a,b)=&gt; &#123;\tconst s = new Set(b);\treturn a.filter(x=&gt;!s.has(x));&#125;difference([1,2,3],[3]) // [1,2]; - æ•°ç»„ç´¯åŠ ç´¯ä¹˜123456789const arr = [1,2,3,4,5,6];// ç´¯ä¹˜arr.reduce((t,v)=&gt;t*v,1); // tå°±æ˜¯æ€»ä¹˜ç§¯eval(arr.join(&#x27;*&#x27;)); // evalä¼šå°†ä¼ è¿›å»çš„stringç”¨ä½œjsä»£ç æ‰§è¡Œ// ç´¯åŠ arr.reduce((t,v)=&gt;t+v,0);eval(arr.join(&#x27;+&#x27;)); // evalä¼šå°†ä¼ è¿›å»çš„stringç”¨ä½œjsä»£ç æ‰§è¡Œ - å°†æ•°ç»„è½¬æ¢ä¸ºå¯¹è±¡123const arr = [&#x27;weng&#x27;,&#x27;wang&#x27;,&#x27;zhang&#x27;,&#x27;li&#x27;];objArr = &#123;...arr&#125;;// &#123;0:&#x27;weng&#x27;,1:&#x27;wang&#x27;,2:&#x27;zhang&#x27;,3:&#x27;li&#x27;&#125; å…³äºå¯¹è±¡- å¯¹è±¡ç»“æ„èµ‹å€¼ æ›´æ¨èä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ â€¦ï¼Œè€Œä¸æ˜¯ Object.assignã€‚è§£æ„èµ‹å€¼è·å–å¯¹è±¡æŒ‡å®šçš„å‡ ä¸ªå±æ€§æ—¶ï¼Œæ¨èç”¨ rest è¿ç®—ç¬¦ï¼Œä¹Ÿæ˜¯ â€¦ã€‚ 1234567891011121314const obj = &#123;\tname:&#x27;hello&#x27;,\tage:23,&#125;;// badconst copy = Object.assign(&#123;&#125;, obj, &#123; c: 3 &#125;) // copy =&gt; &#123; name: &#x27;hello&#x27;, age: 23, c: 3 &#125;// so goodconst objCopy = &#123; ...obj, address:&#x27;beijing&#x27; &#125;; // objCopy =&gt; &#123;name: &#x27;hello&#x27;, age: 23,address:&#x27;beijing&#x27;&#125;// è§£æ„æ‹†åˆ†å¯¹è±¡å¾—æ—¶å€™const &#123;address,...restObj&#125; = objCopy; // address = &#x27;beijing&#x27; resObj =&#123;name:&#x27;hello&#x27;,age:23,&#125; - å¯¹è±¡å±æ€§å€¼çš„ç¼©å†™1234567891011121314const age = 23;const name = &#x27;wengkaimin&#x27;;// bad const Obj = &#123;\tname:name,\tage:age,&#125;//goodconst objG = &#123;\tname,\tage,&#125; å±æ€§çš„ç¼©å†™è¦æ”¾åœ¨å¯¹è±¡çš„å¼€å¤´æ‰èˆ’æœç‚¹ 1234567891011121314// bad const Obj = &#123;\taddress:&#x27;beijing&#x27;\tname,\tage,&#125;//goodconst objG = &#123;\tname,\tage,\taddress:&#x27;beijing&#x27;&#125; - ä½¿ç”¨åŠ¨æ€å¯¹è±¡å±æ€§åˆ›å»ºå¯¹è±¡12345678910function getName(&#123;name&#125;)&#123;\treturn `VIP$&#123;name&#125;`&#125;const obj = &#123;\tage:23,\trealName:&#x27;wengkaimin&#x27;,\t[getName(&#x27;xiaohua&#x27;)]: true,&#125; clg(obj) // obj=&gt; &#123;age:23,realName:&#x27;wengkaimin&#x27;,VIPxiaohua:true&#125; - å¯¹è±¡é‡Œå­˜åœ¨æ–¹æ³•æ—¶å€™123456789101112131415// badconst obj = &#123;\tname:&#x27;hello world&#x27;,\tgetName:function()&#123; return this.name\t&#125;,&#125;// goooooood const obj = &#123;\tname:&#x27;hello world&#x27;,\tgetName()&#123; return this.name\t&#125;,&#125; - ä¸è¦ç›´æ¥è°ƒç”¨ObjectåŸå‹ä¸­çš„æ–¹æ³• Object.prototype ä¸­çš„hasOwnPropertyï¼ŒisPrototypeOfç­‰ç­‰ï¼Œä¸èƒ½å†™å‡ºobject.hasOwnProperty 1234567891011121314const objTest = &#123;name:&#x27;1&#x27;,hasOwnProperty:true&#125;;//bad console.log(objTest.hasOwnProperty(key)) // error è¿™ç©æ„hasOwnPropertyåœ¨è¿™ä¸ªå¯¹è±¡ä¸­æ˜¯å±æ€§ï¼Œä»åŸå‹é“¾æœ€é¡¶å±‚æ‰¾çš„è¯ç¬¬ä¸€å±‚å°±è¢«æ‰¾åˆ°äº†ï¼Œå°±ä¸ä¼šå†å»æ‰¾objTestçš„åŸå‹ä¸‹çš„hasOwnPropertyå‡½æ•°äº†// gooooodconsole.log(Object.prototype.hasOwnProperty.call(objTest,name)); // &#x27;1&#x27;// best const has = Object.prototype.hasOwnProperty // å­˜èµ·æ¥ï¼Œè¿™ä¸ªæ¨¡å—å†…å°±å¯ä»¥å¤šæ¬¡æŸ¥æ‰¾,å°±ä¸éœ€è¦æ¯æ¬¡å†™é‚£ä¹ˆé•¿console.log(has.call(objTest,name));/* or */import has from &#x27;has&#x27;; // https://www.npmjs.com/package/hasconsole.log(has(object, name)); - æµ…æ‹·è´1234const shallowClone = obj =&gt; Object.assign(&#123;&#125;,obj);// ä¸Šé¢è¯´äº†ä¸æ¨èè¿™æ ·å†™æ³•const shallowClone = obj =&gt; &#123;...obj&#125;; - æ·±æ‹·è´123456789101112const deepMapKeys = (obj, fn) =&gt; Array.isArray(obj) ? obj.map(val =&gt; deepMapKeys(val, fn)) : typeof obj === &#x27;object&#x27; ? Object.keys(obj).reduce((acc, current) =&gt; &#123; const key = fn(current); const val = obj[current]; acc[key] = val !== null &amp;&amp; typeof val === &#x27;object&#x27; ? deepMapKeys(val, fn) : val; return acc; &#125;, &#123;&#125;) : obj; å…³äºå‡½æ•°- å‡½æ•°å‚æ•°ä½¿ç”¨é»˜è®¤å€¼æ›¿ä»£ä½¿ç”¨æ¡ä»¶è¯­å¥è¿›è¡Œèµ‹å€¼ã€‚1234567891011// goodfunction newFun(name = &#x27;Jack&#x27;) &#123; ...&#125;// badfunction newFun(name) &#123; const userNameName = name || &#x27;Jack&#x27; ...&#125; - å‡½æ•°å‚æ•°ä½¿ç”¨ç»“æ„è¯­æ³• å‡½æ•°å‚æ•°è¶Šå°‘è¶Šå¥½ï¼Œå¦‚æœå‚æ•°è¶…è¿‡ä¸¤ä¸ªï¼Œè¦ä½¿ç”¨ ES6 çš„è§£æ„è¯­æ³•ï¼Œä¸ç”¨è€ƒè™‘å‚æ•°çš„é¡ºåºã€‚ 1234567891011121314151617// goodfunction createMenu(&#123; title, body, buttonText, cancellable &#125;) &#123; ...&#125;createMenu(&#123; title: &#x27;Foo&#x27;, body: &#x27;Bar&#x27;, cancellable: true, buttonText: &#x27;Baz&#x27;,&#125;)// badfunction createMenu(title, body, buttonText, cancellable) &#123; // ...&#125; - ä¼˜å…ˆä½¿ç”¨ rest è¯­æ³•â€¦ï¼Œè€Œä¸æ˜¯arguments1234567891011// badfunction concatenateAll() &#123; const args = Array.prototype.slice.call(arguments) // argumentsæ˜¯ä¼ªæ•°ç»„ï¼Œå¤„ç†æˆæ•°ç»„ï¼Œè¿™é‡Œç”¨ä¸Šé¢è¯´çš„Array.from(arguments)æ‰å¥½ return args.join(&#x27;&#x27;)&#125;// goodfunction concatenateAll(...args) &#123; return args.join(&#x27;&#x27;)&#125; - å‡½æ•°è¿”å›å€¼æ˜¯å¤šä¸ªçš„æƒ…å†µä¸‹1234567891011121314151617181920// å½“æˆ‘ä»¬è°ƒç”¨å‡½æ•°å¹¶å°†å€¼åˆ†é…ç»™ a,b,c,d æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„è¿”å›æ•°æ®çš„é¡ºåºã€‚è¿™é‡Œçš„ä¸€ä¸ªå°é”™è¯¯å¯èƒ½ä¼šæˆä¸ºè°ƒè¯•çš„å™©æ¢¦,è€Œä¸”å€˜è‹¥åªéœ€è¦c,då€¼ï¼Œé‚£ä¹ˆå°±æ— æ³•ç¡®åˆ‡è·å–const func =()=&gt;&#123; const a = 1; const b = 2;\tconst c = 3; const d = 4; return [a,b,c,d]; // very bad&#125;const [a,b,c,d] = func();// ä½¿ç”¨å¯¹è±¡ç»“æ„const func =()=&gt;&#123; const a = 1; const b = 2;\tconst c = 3; const d = 4; return &#123;a,b,c,d&#125;; // good&#125;const &#123;c,d&#125; = func(); å…³äºå­—ç¬¦ä¸²- å­—ç¬¦ä¸²ç¿»è½¬1234567function reverseStr(str = &quot;&quot;) &#123; return str.split(&quot;&quot;).reduceRight((t, v) =&gt; t + v);&#125;const str = &quot;reduce123&quot;;console.log(reverseStr(str)); // &quot;321recuder&quot; å…³äºæ•°å­—- åˆ¤æ–­å¥‡å¶æ•°123const num=5;!!(num &amp; 1) // true!!(num % 2) // true - æ•°å­—åƒåˆ†ä½123456789101112131415// æ–¹æ³•ä¸€function thousandNum(num = 0) &#123; const str = (+num).toString().split(&quot;.&quot;); const int = nums =&gt; nums.split(&quot;&quot;).reverse().reduceRight((t, v, i) =&gt; t + (i % 3 ? v : `$&#123;v&#125;,`), &quot;&quot;).replace(/^,|,$/g, &quot;&quot;); const dec = nums =&gt; nums.split(&quot;&quot;).reduce((t, v, i) =&gt; t + ((i + 1) % 3 ? v : `$&#123;v&#125;,`), &quot;&quot;).replace(/^,|,$/g, &quot;&quot;); return str.length &gt; 1 ? `$&#123;int(str[0])&#125;.$&#123;dec(str[1])&#125;` : int(str[0]);&#125;thousandNum(1234); // &quot;1,234&quot;thousandNum(1234.00); // &quot;1,234&quot;thousandNum(0.1234); // &quot;0.123,4&quot;console.log(thousandNum(1234.5678)); // &quot;1,234.567,8&quot;// æ–¹æ³•äºŒ(121314).toLocaleString(); - å­—ç¬¦ä¸²è½¬æ•°å­—æ–¹æ³•ä¸€ å®é™…å°±æ˜¯ç”¨ *1æ¥è½¬åŒ–ä¸ºæ•°å­—ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨äº†.valueOfçš„æ–¹æ³• 12345&#x27;32&#x27; * 1 // 32&#x27;ds&#x27; * 1 // NaNnull * 1 // 0undefine * 1 // NaN1 * &#123; valueOf:()=&gt;&#x27;3&#x27;&#125;; æ–¹æ³•äºŒ123456+ &#x27;123&#x27; // 123+ &#x27;ds&#x27; // NaN+ &#x27;&#x27; // 0+ null // 0+ undefine // NaN+ &#123;valueOf: ()=&gt;&#x27;3&#x27;&#125; // 3 - åˆ¤æ–­å°æ•°æ˜¯å¦ç›¸ç­‰æ–¹æ³•1ï¼š1234567891011Number.EPSILON=(function()&#123; //è§£å†³å…¼å®¹æ€§é—®é¢˜ return Number.EPSILON?Number.EPSILON:Math.pow(2,-52);&#125;)();//ä¸Šé¢æ˜¯ä¸€ä¸ªè‡ªè°ƒç”¨å‡½æ•°ï¼Œå½“JSæ–‡ä»¶åˆšåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå°±ä¼šå»åˆ¤æ–­å¹¶è¿”å›ä¸€ä¸ªç»“æœfunction numbersequal(a,b)&#123; return Math.abs(a-b)&lt;Number.EPSILON; &#125;//æ¥ä¸‹æ¥å†åˆ¤æ–­ const a=0.1+0.2, b=0.3;console.log(numbersequal(a,b)); //è¿™é‡Œå°±ä¸ºtrueäº† æ–¹æ³•2ï¼š1(0.1*100+0.2*100)/100===0.3 - åŒä½è¿ç®—ç¬¦ åŒä½è¿ç®—ç¬¦æ¯”Math.floor()å’ŒMath.ceil()é€Ÿåº¦å¿« 123456789~~7.5 // 7Math.ceil(7.5) // 8Math.floor(7.5) // 7~~-7.5 // -7Math.floor(-7.5) // -8Math.ceil(-7.5) // -7 æ‰€ä»¥è´Ÿæ•°æ—¶ï¼ŒåŒä½è¿ç®—ç¬¦å’ŒMath.ceilç»“æœä¸€è‡´ï¼Œæ­£æ•°æ—¶å’ŒMath.floorç»“æœä¸€è‡´ - å–æ•´å’Œå¥‡å¶æ€§åˆ¤æ–­å–æ•´ 1234567891011121314151617183.3 | 0 // 3-3.9 | 0 // -3parseInt(3.3) // 3parseInt(-3.3) // -3// å››èˆäº”å…¥å–æ•´Math.round(3.3) // 3Math.round(-3.3) // -3// å‘ä¸Šå–æ•´Math.ceil(3.3) // 4Math.ceil(-3.3) // -3// å‘ä¸‹å–æ•´Math.floor(3.3) // 3Math.floor(-3.3) // -4 åˆ¤æ–­å¥‡å¶ 123const num=5;!!(num &amp; 1) // true!!(num % 2) // true å¸ƒå°”å‹å…¶ä»–éç©ºåˆ¤æ–­ä¹‹å‰å†™æ³• 123if(value !== null &amp;&amp; value !== undefined &amp;&amp; value !== &#x27;&#x27;)&#123; //...&#125; ç°åœ¨ 123if(value??&#x27;&#x27; !== &#x27;&#x27;)&#123; //...&#125;","tags":["Javascript"],"categories":["Javascript"]},{"title":"é˜²æŠ–åŠ¨å’ŒèŠ‚æµ","path":"/2020/05/03/é˜²æŠ–åŠ¨å’ŒèŠ‚æµ/","content":"åœºæ™¯ï¼š åœ¨é¡µé¢ä¸­å¾ˆå¤šçš„äº‹ä»¶æ˜¯ä¼šé¢‘ç¹æ‰§è¡Œçš„ã€å¦‚ï¼š windowçš„resizeï¼Œscrolläº‹ä»¶ æ‹–æ‹½è¿‡ç¨‹ä¸­çš„ mousemoveäº‹ä»¶ æ–‡å­—è¾“å…¥è¿‡ç¨‹ä¸­çš„keyupç­‰äº‹ä»¶ è¿™äº›äº‹ä»¶ä¸€æ—¦è§¦å‘ä¼šé¢‘ç¹æ‰§è¡Œã€ä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬å¯èƒ½åªéœ€è¦åœ¨ç‰¹å®šçš„æ—¶å€™å»æ‰§è¡Œç»‘å®šäº†è¿™äº›äº‹ä»¶çš„å‡½æ•° ä¾‹å¦‚ï¼šæˆ‘éœ€è¦æ£€æµ‹ä¸€æ¬¡æ‹–æ‹‰æµè§ˆå™¨ï¼Œç§»åŠ¨è¿‡ç¨‹ä¸­éƒ½ç®—æ˜¯ä¸€æ¬¡ï¼ŒçŸ¥é“æœ€åé¼ æ ‡æŠ¬èµ·æ¥äº†ï¼Œæ‰ç®—æ˜¯å®Œæˆäº†ä¸€æ¬¡æ‹‰ä¼¸çª—å£ï¼›æœ‰æ¯”å¦‚ï¼Œæˆ‘ä»¬è¾“å…¥æœç´¢æ¡†å†…çš„æ–‡å­—çš„æ—¶å€™ï¼Œéœ€è¦å‘ajax åˆ°åå°å»è¯·æ±‚æ•°æ®ï¼Œå®é™…ä¸Šæˆ‘ä»¬å¹¶ä¸éœ€è¦æ¯ä¸€æ¬¡çš„è¾“å…¥éƒ½å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œè€Œæ˜¯åœ¨ç”¨æˆ·å·²ç»è¾“å®Œäº†ä¸€æ•´æ®µè¯æˆ–è€…æ˜¯å‡ ä¸ªæ–‡å­—ä¹‹åå†å»å‘é€ä¸€ä¸ªajaxï¼Œè¿™æ ·ä¼šèŠ‚çœå¾ˆå¤šçš„èµ„æºå¼€é”€ ã€‚ç­‰ç­‰çš„è¿™äº›é—®é¢˜éƒ½éœ€è¦å‡½æ•°é˜²æŠ–åŠ¨æˆ–è€…å‡½æ•°èŠ‚æµæ¥è§£å†³ é˜²æŠ–ï¼ˆdebounceï¼‰åŸç†ï¼š å½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªåŠ¨ä½œçš„æ—¶å€™ï¼Œä¼šè®¾ç½®åœ¨næ¯«ç§’åæ‰æ‰§è¡Œï¼Œè€Œåœ¨è¿™næ¯«ç§’å†…ï¼Œå¦‚æœè¿™ä¸ªåŠ¨ä½œå†æ¬¡è¢«è°ƒç”¨çš„è¯åˆ™å°†é‡æ–°åœ¨è®¡ç®—næ¯«ç§’ï¼Œé‡‡å–æ‰§è¡Œè¿™ä¸ªä¸œè¥¿ã€‚ å½“ä¸€æ¬¡äº‹ä»¶å‘ç”Ÿåï¼Œäº‹ä»¶å¤„ç†å™¨è¦ç­‰ä¸€å®šé˜ˆå€¼çš„æ—¶é—´ï¼Œå¦‚æœè¿™æ®µæ—¶é—´è¿‡å»å å†ä¹Ÿæ²¡æœ‰ äº‹ä»¶å‘ç”Ÿï¼Œå°±å¤„ç†æœ€åä¸€æ¬¡å‘ç”Ÿçš„äº‹ä»¶ã€‚å‡è®¾è¿˜å·® 0.01 ç§’å°±åˆ°è¾¾æŒ‡å®šæ—¶é—´ï¼Œè¿™æ—¶åˆæ¥äº†ä¸€ä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆä¹‹å‰çš„ç­‰å¾…ä½œåºŸï¼Œéœ€è¦é‡æ–°å†ç­‰å¾…æŒ‡å®šæ—¶é—´ã€‚ ä¾‹å¦‚ï¼š 12345678910111213141516171819202122&lt;body&gt; &lt;style&gt; #container &#123; width: 200px; height: 300px; background-color: aquamarine; &#125; &lt;/style&gt; &lt;div id=&quot;container&quot;&gt; &lt;/div&gt; &lt;script&gt; var count = 1; var containerDom = document.getElementById(&#x27;container&#x27;); function addNumber() &#123; containerDom.innerHTML = count++; &#125; containerDom.onmousemove = addNumber; &lt;/script&gt;&lt;/body&gt; é¼ æ ‡åªè¦ç§»åŠ¨é‚£ä¹ˆå°±ä¼šé¢‘ç¹çš„å»è§¦å‘addNumberçš„å‡½æ•° è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯¹ä»–è¿›è¡Œé˜²æŠ–åŠ¨ å…ˆå†™æˆ‘ä»¬çš„ç¬¬ä¸€ç‰ˆå‡½æ•° 1234567function debounce(fun, wait) &#123; var time; return function () &#123; clearTimeout(time); time = setTimeout(fun, wait); &#125;&#125; ä¹‹ååŒ…è£¹ä½è¿™ä¸ªaddnumberçš„å‡½æ•° ç°åœ¨éšä½ æ€ä¹ˆç§»åŠ¨ï¼Œåæ­£ä½ ç§»åŠ¨å®Œ 1000ms å†…ä¸å†è§¦å‘ï¼Œæˆ‘æ‰æ‰§è¡Œäº‹ä»¶ã€‚çœ‹çœ‹ä½¿ç”¨æ•ˆæœï¼š é¡¿æ—¶å°±ä» 165 æ¬¡é™ä½æˆäº† 1 æ¬¡! ä¹‹åæˆ‘ä»¬å¯¹ä»–ä¼˜åŒ– thisæŒ‡å‘ä¼˜åŒ–å¦‚æœæˆ‘ä»¬å†addNumberå‡½æ•°ä¸­åŠ å…¥console.log(this)ï¼Œæ²¡æœ‰å†addNumberå¤–å±‚åŒ…è£¹debounceçš„æ—¶å€™thisæŒ‡å‘æ˜¯ 1&lt;div id=&quot;container&quot;&gt;&lt;/div&gt; ä½†æ˜¯åŒ…è£¹äº†debounceä¹‹åthiså°±ä¼šæŒ‡å‘windowså¯¹è±¡ æ‰€ä»¥éœ€è¦å¯¹å®ƒè¿›è¡Œä¿®æ”¹ 1234567891011121314151617var count = 0;var containerDom = document.getElementById(&#x27;container&#x27;);function addNumber() &#123; containerDom.innerHTML = `&lt;div&gt; å€¼ä¸º$&#123;++count&#125; &lt;/div&gt;`; console.log(this);&#125;function debounce(fun, wait) &#123; var time; return function () &#123; var that = this; clearTimeout(time); time = setTimeout(fun.bind(that), wait); &#125;&#125;containerDom.onmousemove = debounce(addNumber, 1000); ä½†æ˜¯è¿™é‡Œåˆæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¿™æ ·åŒ…è£¹debounceçš„æ—¶å€™ï¼Œonmousemoveè‡ªå¸¦çš„äº‹ä»¶å¯¹è±¡eventå°±ä¼šä¸¢å¤±ï¼Œæ²¡æœ‰å°†å‚æ•°ä¼ è¿›å»ï¼Œæ•…æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€å“ˆï¼Œè¿™æ ·å†æˆ‘ä»¬éœ€è¦ç”¨åˆ°eventå¯¹è±¡çš„æ—¶å€™å°±èƒ½æ‹¿å¾—åˆ° 123456789101112131415161718var count = 0;var containerDom = document.getElementById(&#x27;container&#x27;);function addNumber(e) &#123; containerDom.innerHTML = `&lt;div&gt; å€¼ä¸º$&#123;++count&#125; &lt;/div&gt;`; console.log(this); console.log(e);&#125;function debounce(fun, wait) &#123; var time; return function () &#123; var that = this, args = arguments; clearTimeout(time); time = setTimeout(fn.bind(that, ...args), wait); &#125;&#125;containerDom.onmousemove = debounce(addNumber, 1000); è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å‡½æ•°å°±éå¸¸çš„å®Œå–„äº†ã€‚ ç¬¬ä¸€æ¬¡ç«‹åˆ»æ‰§è¡Œå‡è®¾æˆ‘éœ€è¦ç«‹å³è§¦å‘è¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯åˆæƒ³é˜²æŠ–ï¼Œå°±æ˜¯ç›¸å½“äºå…ˆæ‰§è¡Œå‡½æ•°å†Nç§’å†…å¦‚æœå†æ­¤è§¦å‘è¿™ä¸ªå‡½æ•°ï¼Œå°±ç»™ä»–é‡æ–°è®¡ç®—ç­‰å¾…å€¼ã€‚ 12345678910111213141516171819function debounce(fun, wait, immediate) &#123; var time; return function () &#123; var that = this, args = arguments; if (time) clearTimeout(time); if (immediate) &#123; // å¦‚æœå·²ç»æ‰§è¡Œè¿‡ï¼Œä¸å†æ‰§è¡Œ var callNow = !time; time = setTimeout(function () &#123; time = null &#125;, wait); if (callNow) fun.apply(that, args); &#125; else &#123; time = setTimeout(function () &#123; fun.apply(that, args); &#125;, wait); &#125; &#125;&#125; å®Œ~ èŠ‚æµ å¯ä»¥ç†è§£ä¸ºäº‹ä»¶åœ¨ä¸€ä¸ªç®¡é“ä¸­ä¼ è¾“ï¼ŒåŠ ä¸Šè¿™ä¸ªèŠ‚æµé˜€ä»¥åï¼Œäº‹ä»¶çš„æµé€Ÿå°±ä¼šå‡æ…¢ã€‚å®é™…ä¸Šè¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯å¦‚æ­¤ï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨é¢‘ç‡é™åˆ¶åœ¨ä¸€å®šé˜ˆå€¼å†…ï¼Œä¾‹å¦‚ 1sï¼Œé‚£ä¹ˆ 1s å†…è¿™ä¸ªå‡½æ•°ä¸€å®šä¸ä¼šè¢«è°ƒç”¨ä¸¤æ¬¡ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€ç‰ˆçš„èŠ‚æµ,è¿™é‡Œçš„thiså’Œargumentå¤„ç†æ–¹å¼å’Œä¸Šé¢çš„é˜²æŠ–æ˜¯ä¸€æ ·çš„å¤„ç†æ–¹å¼ 1234567891011function throttle(fn, wait) &#123;\tlet prev = new Date();\treturn function() &#123; const args = arguments; const now = new Date(); if (now - prev &gt; wait) &#123; fn.apply(this, args); prev = new Date(); &#125;\t&#125;&#125; æŒ‰ç…§ä»¥ä¸Šçš„å®ç°ï¼Œç¬¬ä¸€æ¬¡è¿›å…¥çš„æ—¶å€™å°±ç«‹é©¬æ‰§è¡Œäº‹ä»¶ï¼Œä½†æ˜¯å¦‚æœæœ€åä¸€æ¬¡çš„æ—¶é—´å’Œpreçš„æ—¶é—´æ’å€¼å°äºæˆ‘ä»¬çš„waitæ—¶é—´ï¼Œè¿™æ—¶å€™çš„å‡½æ•°æ˜¯ä¸æ‰§è¡Œçš„ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³è¦è®©å®ƒæ‰§è¡Œï¼Œè¿™æ—¶å€™åŠ å…¥å®šæ—¶å™¨ï¼Œè®©ä»–åœ¨æœ€åä¸€æ¬¡è°ƒç”¨æ‰§è¡Œå‡½æ•°çš„æ—¶å€™ï¼Œç®—å‡ºå®ƒè·ç¦»waitçš„æ—¶é—´è¿˜å‰©å¤šå°‘ï¼Œç„¶åè®©ä»–åœ¨å‰©ä½™æ—¶é—´å†…å†æ‰§è¡Œï¼› æœ€ç»ˆçš„ä»£ç æ˜¯è¿™æ · 123456789101112131415function throttle(fn, wait) &#123; let prev = new Date(); let time; return function () &#123; const args = arguments; const now = new Date(); clearTimeout(time); if (now - prev &gt;= wait) &#123; fn.apply(this, args); prev = new Date(); &#125; else &#123; time = setTimeout(fn.bind(this, args), wait - (prev - now)); &#125; &#125;;&#125;","tags":["Javascript","é˜²æŠ–åŠ¨","èŠ‚æµ"],"categories":["Javascript"]},{"title":"åŠ¨æ€åˆ›å»ºæ–‡æœ¬åŸŸå¦‚ä½•åˆ¤æ–­æ–‡æœ¬æ˜¯å¦è¶…å‡ºæ‰€åœ¨å®¹å™¨","path":"/2020/04/07/åŠ¨æ€åˆ›å»ºæ–‡æœ¬åŸŸå¦‚ä½•åˆ¤æ–­æ–‡æœ¬æ˜¯å¦è¶…å‡ºæ‰€åœ¨å®¹å™¨/","content":"åœ¨é¡¹ç›®ä¸Šå¼€å‘çš„æ—¶å€™ç¢°åˆ°äº†ä¸€ä¸ªè¿™æ ·çš„éœ€æ±‚ æ¯ä¸€ä¸ªæ“ä½œè®°å½•éƒ½æ˜¯åŠ¨æ€åˆ›å»ºå‡ºæ¥çš„ï¼ŒåŒ…æ‹¬æ–‡æœ¬åŸŸï¼Œåç«¯è¿”å›ä¸€ä¸ªcontentè¡¨ç¤ºæ–‡æœ¬çš„å†…å®¹ï¼›æ¯ä¸ªæ–‡æœ¬éƒ½æ˜¯å®šå®½çš„ï¼ˆå½“ç„¶å¿…é¡»åœ¨è¿™ä¸ªå®¹å™¨å†…éƒ¨ï¼‰ï¼Œä¸€æ—¦contentæ•°æ®è¶…å‡ºäº†æ–‡æœ¬åŸŸçš„å®šå®½å°±ä¼šä»¥çœç•¥å·çš„å½¢å¼è¡¨ç¤ºè¿˜æœ‰æ›´å¤šæ–‡æœ¬ï¼Œå¹¶ä¸”é‡ç‚¹æ¥äº†ï¼šè¶…å‡ºçš„æ¯ä¸ªæ¨¡å—å¿…é¡»åœ¨å¤´éƒ¨å±•ç°å‡ºä¸€ä¸ªbuttonæŒ‰é’®ï¼Œç‚¹å‡»buttonæŒ‰é’®èƒ½å¤Ÿå±•ç¤ºæ›´å¤šçš„æ•°æ® ä¸‹é¢è¯´ä¸€ä¸‹æˆ‘åˆšå¼€å§‹çš„æ€è·¯ï¼šé€šè¿‡åˆ¤æ–­contentå­—ç¬¦çš„é•¿åº¦å»åŠ¨æ€æ¸²æŸ“è¿™ä¸ªbuttonï¼ˆä¸è¡Œï¼‰ã€‚ å› ä¸ºä¸ä»…ä»…contentå½“ä¸­åŒ…æ‹¬äº†ä¸­æ–‡å­—ç¬¦ï¼Œè‹±æ–‡å­—ç¬¦ï¼Œè¿˜åŒ…æ‹¬æ ‡ç‚¹ç¬¦å·æ•°å­—ç­‰ç­‰ï¼Œä¸èƒ½å•çº¯çš„é€šè¿‡æ­¤æ–¹æ³•æ¥å»åˆ¤æ–­ã€‚ å› æ­¤æƒ³äº†ä¸€ä¸‹ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªç›‘å¬å™¨ï¼Œé€šè¿‡ç›‘å¬å¯¹åº”çš„æ–‡æœ¬ï¼Œåˆ¤æ–­å®ƒå®½åº¦çš„å˜åŒ–æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Œä»è€Œè¿›è¡Œé¡µé¢çš„äºŒæ¬¡æ¸²æŸ“ï¼Œå†ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„åŸºç¡€ä¸ŠåŠ ä¸Šbutton ç»è¿‡ä¸€ä¸ªå¤§ä½¬çš„æŒ‡å¯¼ï¼Œå‘ç°å¯ä»¥ç”¨æ­¤æ–¹æ³•å®ç° é€šè¿‡new ResizeObserver()çš„apiå»ç›‘å¬ä¸€ä¸ªdomå…ƒç´ çš„æ–‡æœ¬åŸŸå˜åŒ–ï¼Œè¯¦ç»†ç”¨æ³•å¯ä»¥çœ‹ä¸‹é¢è¿™ä¸ªæ–‡ç« ï¼ŒResizeObserveræ˜¯ä»€ä¹ˆï¼Ÿ è¿˜æœ‰è¿™ ResizeObserver API è‡³äºä¸ºä»€ä¹ˆè¦ç”¨ scrollWidth å’Œwidthæ¥åˆ¤æ–­ï¼Œæ‡‚å¾—éƒ½æ‡‚ï¼Œä¸æ‡‚å¾—å»æŸ¥æ¦‚å¿µå»ï¼ŒscrollWidth, clientWidth, offsetWidthçš„åŒºåˆ« æˆ‘ç”¨çš„æ˜¯react hooksï¼Œæ‰€ä»¥è¦å®ç°ç›‘å¬ï¼Œå¿…é¡»å†useEffecté‡Œé¢æ¨¡æ‹Ÿå‡ºwindow.onload ä¸‹é¢è¯´ä¸€ä¸‹æˆ‘è¯¦ç»†å¾—è§£æ³•ï¼š è¦æ§åˆ¶buttonå¾—æ˜¾éšï¼Œæ—¢ç„¶ç”¨äº†reactè‚¯å®šæ˜¯è¦é¢å‘æ•°æ®å±‚æ¥æ”¹å˜é¡µé¢ï¼Œå› æ­¤åœ¨åˆšå¼€å§‹è·å–åˆ°è¿™ä¸ªæ“ä½œè®°å½•çš„æ•°æ®çš„æ—¶å€™ï¼Œç»™ä»–æ¯ä¸€é¡¹åŠ ä¸Šä¸€ä¸ªå‚æ•°å«åšdisplayï¼Œä¹‹åå†åœ¨æ‰€éœ€è¦æ¸²æŸ“çš„buttonä¸Šæ‰‹åŠ¨åŠ ä¸Šstyleï¼ˆè¿™é‡Œç”¨çš„æ˜¯çŒªé½¿é±¼proç»„ä»¶çš„DataSetï¼‰ ä¹‹ååœ¨useEffectå½“ä¸­å»ç›‘å¬è¿™äº›åŠ¨æ€æ¸²æŸ“çš„æ–‡æœ¬åŸŸ 1234567891011121314151617useEffect(() =&gt; &#123; const flow = document.getElementsByClassName(&#x27;c7n-pOverflow&#x27;); if (flow &amp;&amp; flow.length &gt; 0) &#123; for (let i = 0; i &lt; flow.length; i += 1) &#123; new ResizeObserver((entries) =&gt; &#123; entries.forEach((entry) =&gt; &#123; const pDom = entry.target; const scrollW = Math.ceil(pDom.scrollWidth); const width = Math.ceil(pDom.clientWidth); if (scrollW &gt; width) &#123; optsDs.records[i].set(&#x27;display&#x27;, &#x27;block&#x27;); &#125; &#125;); &#125;).observe(flow[i]); &#125; &#125; &#125;); æ³¨æ„ï¼ŒuseEffectçš„æœ€åä¸€ä¸ªå‚æ•°ä¸èƒ½å†™ã€‚ é€šè¿‡å¾ªç¯è¿™ä¸ªè¯·æ±‚åˆ°listæ•°æ®çš„æ–‡æœ¬æ•°ç»„ï¼Œå»ç›‘å¬æ¯ä¸€ä¸ªæ–‡æœ¬åŸŸçš„å˜åŒ–ï¼Œ é€šè¿‡åˆ¤å®šè¿™ä¸ªæ–‡æœ¬åŸŸçš„scrollWidthå’Œwidthå»åŠ¨æ€åœ°å†æ¬¡æ”¹å˜å¯¹åº”æ•°æ®ä¸­çš„displayå±æ€§ï¼Œå°±èƒ½å®ç°é¡µé¢çš„äºŒæ¬¡æ¸²æŸ“ã€‚ 123if (scrollW &gt; width) &#123; optsDs.records[i].set(&#x27;display&#x27;, &#x27;block&#x27;);&#125; è¿™æ˜¯æ–‡æœ¬åŸŸçš„æ ·å¼ 1234567891011p &#123; font-size: .12rem; font-weight: 400; margin: .08rem 0 0 0; color: rgba(58, 52, 95, 0.65); line-height: .2rem; max-width: 4.09rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;&#125; è¿™é‡Œä¸€å®šæ˜¯è¦è®¾ç½®å®½åº¦çš„ï¼Œæ— è®ºæ˜¯widthè¿˜æ˜¯max-widthåªè¦èƒ½å®ç°å®ƒè¶…å‡ºæº¢å‡ºå°±è¡Œã€‚","tags":["Javascript","useEffect","React Hooks"],"categories":["Javascript"]},{"title":"JSä¸­typeofå’Œinstanceofçš„åŒºåˆ«","path":"/2020/03/31/JSä¸­typeofå’Œinstanceofçš„åŒºåˆ«/","content":"undefined, number, string, booleanå±äºç®€å•çš„å€¼ç±»å‹ï¼Œä¸æ˜¯å¯¹è±¡ã€‚å‰©ä¸‹çš„å‡ ç§æƒ…å†µâ€”â€”å‡½æ•°ã€æ•°ç»„ã€å¯¹è±¡ã€nullã€new Number(10)éƒ½æ˜¯å¯¹è±¡ã€‚ä»–ä»¬éƒ½æ˜¯å¼•ç”¨ç±»å‹ã€‚ åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨ç±»å‹ typeof1234567891011console.log(typeof (x)); // &#x27;undefined&#x27;console.log(typeof (10)); // &#x27;number&#x27;console.log(typeof (&#x27;abc&#x27;)); // &#x27;string&#x27;console.log(typeof (true)); // &#x27;boolean&#x27;console.log(typeof (function () &#123; &#125;)); // &#x27;function&#x27;console.log(typeof ([1, &#x27;dsa&#x27;, true])); // &#x27;object&#x27;console.log(typeof (&#123; a: 123, b: true &#125;)); // &#x27;object&#x27;console.log(typeof (null)); // &#x27;object&#x27;console.log(typeof (new Number(0))); // &#x27;object&#x27;console.log(typeof(new Date())); // &#x27;object&#x27;console.log(typeof(/a/g)); // &#x27;object&#x27; æˆ‘ä»¬å¯ä»¥ç”¨typeofåˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯å¦å­˜åœ¨ 123if(typeof a !==&#x27;undefined&#x27;)&#123;\talert(&#x27;OK&#x27;)&#125; è€Œä¸æ˜¯if(a)è¿™æ ·çš„ç”¨æ³•ï¼Œå› ä¸ºå¦‚æœè¿™æ ·aä¸ºå®šä¹‰å°±ä¼šæŠ¥é”™ã€‚ ç®€å•çš„å€¼ç±»å‹ç›´æ¥ç”¨typeofå°±èƒ½å¤Ÿåˆ¤æ–­å‡ºæ¥ ä½†æ˜¯å¼•ç”¨ç±»å‹ä½¿ç”¨ typeof åˆ¤æ–­å°±ä¸å¤ªå‡†ç¡®ã€‚å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œä¾‹å¦‚æ•°ç»„ï¼Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ—¥æœŸï¼Œå¯¹è±¡ç­‰typeofè¿”å›å€¼éƒ½æ˜¯ä¸º object å‡½æ•°çš„è¿”å›å€¼åˆ™æ˜¯function åœ¨ JavaScript ä¸­ï¼Œåˆ¤æ–­ä¸€ä¸ªå˜é‡çš„ç±»å‹å°å°ä¼šç”¨ typeof è¿ç®—ç¬¦ï¼Œåœ¨ä½¿ç”¨ typeof è¿ç®—ç¬¦æ—¶é‡‡ç”¨å¼•ç”¨ç±»å‹å­˜å‚¨å€¼ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œæ— è®ºå¼•ç”¨çš„æ˜¯ä»€ä¹ˆç±»å‹çš„å¯¹è±¡ï¼Œå®ƒéƒ½è¿”å› â€œobjectâ€ã€‚è¿™å°±éœ€è¦ç”¨åˆ°instanceofæ¥æ£€æµ‹æŸä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯å¦ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ã€‚ instanceof1è¯­æ³•ï¼šobject instanceof constructor å‚æ•°ï¼šobjectï¼ˆè¦æ£€æµ‹çš„å¯¹è±¡.ï¼‰constructorï¼ˆæŸä¸ªæ„é€ å‡½æ•°ï¼‰ æè¿°ï¼šinstanceofè¿ç®—ç¬¦ç”¨æ¥æ£€æµ‹constructor.prototypeæ˜¯å¦å­˜åœ¨äºå‚æ•°objectçš„åŸå‹é“¾ä¸Š å¯¹è±¡ä¸å‡½æ•°çš„å…³ç³»ï¼š å‡½æ•°æ˜¯ä¸€ç§å¯¹è±¡ï¼Œä½†å‡½æ•°ä¸åƒæ•°ç»„æ­£åˆ™æ—¥æœŸè¿™äº›å¯¹è±¡ã€‚å…¶ä»–çš„å¯¹è±¡ï¼ˆå‡½æ•°é™¤å¤–ï¼‰éƒ½æ˜¯å¯¹è±¡çš„ä¸€ä¸ªå­é›†ï¼Œä½†æ˜¯å‡½æ•°å´å¯ä»¥åˆ›é€ å‡ºå¯¹è±¡æ¥ 12345function People()&#123;\tthis.name = &#x27;hello world&#x27;;\tthis.birth - 1998;&#125;var people = new People(); peopleè¿™ä¸ªå¯¹è±¡æ˜¯ç”±Peopleçš„æ„é€ å‡½æ•°åˆ›å»ºå‡ºæ¥çš„ï¼Œ instanceofçš„ä½¿ç”¨è§„åˆ™ï¼šA instanceof B Aæ²¿ç€protoè¿™æ¡çº¿æ¥æ‰¾ï¼ŒåŒæ—¶Bæ²¿ç€prototypeè¿™æ¡çº¿æ¥æ‰¾ï¼Œå¦‚æœä¸¤æ¡çº¿èƒ½æ‰¾åˆ°åŒä¸€ä¸ªå¼•ç”¨ï¼Œå³åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå°±è¿”å›trueã€‚å¦‚æœæ‰¾åˆ°ç»ˆç‚¹è¿˜æœªé‡åˆï¼Œåˆ™è¿”å›falseã€‚ ä¾‹å¦‚ï¼š å¯ä»¥ç”¨äºåˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯å¦æ˜¯æŸä¸ªå¯¹è±¡çš„å®ä¾‹1console.log(people instanceof People); // true 1console.log(people instanceof Object); // true å› ä¸ºpeopleæ˜¯ç”± Peopleæ„é€ å‡½æ•°æå‡ºæ¥çš„ï¼Œè€ŒPeopleåˆæ˜¯objectçš„å­ç±» å¯ä»¥åœ¨ç»§æ‰¿å…³ç³»ä¸­ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå®ä¾‹æ˜¯å¦å±äºå®ƒçš„çˆ¶ç±»å‹ä¾‹å¦‚ï¼š 123456789function People() &#123; this.name = &#x27;hello world&#x27;; this.birth = 1998;&#125;function Male()&#123;&#125;Male.prototype = new People();const man = new Male();console.log(man instanceof Male); // true console.log(man instanceof People); // true åˆå¦‚ï¼š 1234567891011121314151617181920212223242526// å®šä¹‰æ„é€ å‡½æ•°function C()&#123;&#125; function D()&#123;&#125; var o = new C();// trueï¼Œå› ä¸º Object.getPrototypeOf(o) === C.prototypeo instanceof C; // falseï¼Œå› ä¸º D.prototypeä¸åœ¨oçš„åŸå‹é“¾ä¸Šo instanceof D; o instanceof Object; // true,å› ä¸ºObject.prototype.isPrototypeOf(o)è¿”å›trueC.prototype instanceof Object // true,åŒä¸ŠC.prototype = &#123;&#125;;var o2 = new C();o2 instanceof C; // trueo instanceof C; // false,C.prototypeæŒ‡å‘äº†ä¸€ä¸ªç©ºå¯¹è±¡,è¿™ä¸ªç©ºå¯¹è±¡ä¸åœ¨oçš„åŸå‹é“¾ä¸Š.D.prototype = new C(); // ç»§æ‰¿var o3 = new D();o3 instanceof D; // trueo3 instanceof C; // true éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¡¨è¾¾å¼ obj instanceof Foo è¿”å›trueï¼Œåˆ™å¹¶ä¸æ„å‘³ç€è¯¥è¡¨è¾¾å¼ä¼šæ°¸è¿œè¿”å›trueï¼Œå› ä¸ºFoo.prototypeå±æ€§çš„å€¼æœ‰å¯èƒ½ä¼šæ”¹å˜ï¼Œæ”¹å˜ä¹‹åçš„å€¼å¾ˆæœ‰å¯èƒ½ä¸å­˜åœ¨äºobjçš„åŸå‹é“¾ä¸Šï¼Œè¿™æ—¶åŸè¡¨è¾¾å¼çš„å€¼å°±ä¼šæˆä¸ºfalseã€‚å¦å¤–ä¸€ç§æƒ…å†µä¸‹ï¼ŒåŸè¡¨è¾¾å¼çš„å€¼ä¹Ÿä¼šæ”¹å˜ï¼Œå°±æ˜¯æ”¹å˜å¯¹è±¡objçš„åŸå‹é“¾çš„æƒ…å†µï¼Œè™½ç„¶åœ¨ç›®å‰çš„ESè§„èŒƒä¸­ï¼Œæˆ‘ä»¬åªèƒ½è¯»å–å¯¹è±¡çš„åŸå‹è€Œä¸èƒ½æ”¹å˜å®ƒï¼Œä½†å€ŸåŠ©äºéæ ‡å‡†çš„__proto__é­”æ³•å±æ€§ï¼Œæ˜¯å¯ä»¥å®ç°çš„ã€‚æ¯”å¦‚æ‰§è¡Œobj.__proto__ = &#123;&#125;ä¹‹åï¼Œobj instanceof Fooå°±ä¼šè¿”å›falseäº†ã€‚ 1234567function People()&#123; this.name = &#x27;hello&#x27;&#125;const a = new People();console.log(a instanceof People); // truea.__proto__ = &#123;&#125;;console.log(a instanceof People); // false","tags":["ES6","åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨ç±»å‹"],"categories":["Javascript"]},{"title":"å®ç°è¾¹æ¡†loadingåŠ¨ç”»æ•ˆæœ","path":"/2020/03/30/å®ç°è¾¹æ¡†loadingåŠ¨ç”»æ•ˆæœ/","content":"æ•ˆæœå›¾å¦‚ä¸‹ ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485&lt;body&gt; &lt;style&gt; .box &#123; display: inline-block; position: relative; width: 220px; height: 100px; box-sizing: border-box; &#125; .box::before &#123; content: &#x27;&#x27;; position: absolute; left: -4px; top: -4px; right: 0; width: 228px; height: 108px; bottom: 0; z-index: -1; box-sizing: border-box; border-radius: 5px; background: linear-gradient(to right, #0638a8, #0ab7f9, #06a892); box-sizing: border-box; animation: borderAround 1.5s infinite linear; &#125; @keyframes borderAround &#123; 0%, 100% &#123; clip: rect(0 228px 4px 76px); &#125; 10% &#123; clip: rect(0, 152px, 4px, 0); &#125; 20% &#123; clip: rect(0, 76px, 54px, 0); &#125; 30% &#123; clip: rect(0, 4px, 112px, 0); &#125; 40% &#123; clip: rect(54px, 76px, 112px, 0); &#125; 50% &#123; clip: rect(104px, 152px, 112px, 0); &#125; 60% &#123; clip: rect(104px, 228px, 112px, 76px); &#125; 70% &#123; clip: rect(54px, 228px, 112px, 152px); &#125; 80% &#123; clip: rect(0, 228px, 112px, 224px); &#125; 90% &#123; clip: rect(0, 228px, 54px, 152px); &#125; &#125; .child &#123; width: 100%; height: 100%; background: #FFF; z-index: 999; &#125; &lt;/style&gt; &lt;div class=&quot;box&quot;&gt; &lt;div class=&quot;child&quot;&gt; dsadasd &lt;/div&gt; &lt;/div&gt;&lt;/body&gt;","tags":["Css","loadingåŠ¨ç”»"],"categories":["Css"]},{"title":"å‚ç›´å±…ä¸­çš„å‡ ç§æ–¹å¼","path":"/2020/03/26/å‚ç›´å±…ä¸­çš„å‡ ç§æ–¹å¼/","content":"åœ¨é˜…è¯»æ­¤æ–‡ç« ä¹‹å‰è¦ææ˜ç™½è¡Œå†…å…ƒç´ å’Œå—çº§å…ƒç´ çš„åŒºåˆ«ï¼Œå’Œå…¶å¸¸ç”¨çš„æ ‡ç­¾ è¡Œå†…å…ƒç´ å’Œå—çº§å…ƒç´  è¡Œå†…å…ƒç´ å‚ç›´å±…ä¸­1. è®¾ç½®å¤–å±‚å—å…ƒç´ çš„heightï¼Œline-heightä¸ºç›¸åŒçš„å€¼é€‚ç”¨èŒƒå›´ï¼šä½œç”¨äºå•è¡Œä¸ºæ–‡å­—ï¼Œä½¿æ–‡å­—å‚ç›´å±…ä¸­æ˜¾ç¤º åŸç†ï¼šline-heightä¸font-sizeçš„è®¡ç®—ä¹‹å·®ï¼ˆåœ¨cssä¸­æˆä¸ºâ€œè¡Œé—´è·â€ï¼‰åˆ†ä¸ºä¸¤åŠï¼Œåˆ†åˆ«åŠ åˆ°ä¸€ä¸ªæ–‡æœ¬è¡Œå†…å®¹çš„é¡¶éƒ¨å’Œåº•éƒ¨ã€‚ï¼ˆå¯ä»¥åŒ…å«è¿™äº›å†…å®¹çš„æœ€å°æ¡†å°±æ˜¯è¡Œæ¡†ï¼‰å®ç°äº†å•è¡Œæ–‡å­—å±…ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617&lt;body&gt; &lt;style&gt; .container &#123; height: 50px; line-height: 50px; background:aqua; &#125; .content &#123; background-color: bisque; &#125; &lt;/style&gt; &lt;div class=&quot;container&quot;&gt; &lt;span class=&quot;content&quot;&gt;å‚ç›´å±…ä¸­&lt;/span&gt; &lt;/div&gt;&lt;/body&gt; 2. vertical-aligné€‚ç”¨èŒƒå›´ï¼šå¤–å±‚å—å…ƒç´ åŒ…å«å¤§äºä¸€ä¸ªè¡Œå†…å…ƒç´ éœ€è¦å‚ç›´å±…ä¸­æ—¶ ï¼ˆå¦‚å›¾ç‰‡å’Œæ–‡å­—éœ€è¦å‚ç›´å±…ä¸­æ˜¾ç¤ºæ—¶ï¼‰ï¼Œå¯ä»¥é€šè¿‡å¯¹å›¾ç‰‡çš„æ ‡ç­¾æˆ–æ–‡å­—çš„æ ‡ç­¾ï¼ˆè¡Œå†…å…ƒç´ ï¼‰è®¾ç½®vertical-alignï¼Œå¯ä»¥è¾¾åˆ°æ•ˆæœï¼› ç‰¹ç‚¹ï¼š çˆ¶çº§å—å…ƒç´ ä¸éœ€è¦è®¾ç½®å®½é«˜ åªéœ€å°†åŸºçº¿è¾ƒé«˜çš„è¡Œå†…å…ƒç´ è®¾ç½®vertial-alignå°±è¡Œ vertical-alignå±æ€§çš„å®šä¹‰ï¼šè¯¥å±æ€§å®šä¹‰è¡Œå†…å…ƒç´ çš„åŸºçº¿ç›¸å¯¹äºè¯¥å…ƒç´ æ‰€åœ¨è¡Œçš„åŸºçº¿çš„å‚ç›´å¯¹é½ã€‚å…è®¸æŒ‡å®šè´Ÿé•¿åº¦å€¼å’Œç™¾åˆ†æ¯”å€¼ã€‚è¿™ä¼šä½¿å…ƒç´ é™ä½è€Œä¸æ˜¯å‡é«˜ã€‚åœ¨è¡¨å•å…ƒæ ¼ä¸­ï¼Œè¿™ä¸ªå±æ€§ä¼šè®¾ç½®å•å…ƒæ ¼æ¡†ä¸­çš„å•å…ƒæ ¼å†…å®¹çš„å¯¹é½æ–¹å¼ã€‚ 1234567891011121314151617181920&lt;body&gt; &lt;style&gt; .container &#123; background: aqua; &#125; .content &#123; background-color: bisque; &#125; img &#123; vertical-align: middle; &#125; &lt;/style&gt; &lt;div class=&quot;container&quot;&gt; &lt;span class=&quot;content&quot;&gt;å‚ç›´å±…ä¸­&lt;/span&gt; &lt;img src=&quot;https://www.baidu.com/img/bd_logo1.png&quot; /&gt; &lt;/div&gt;&lt;/body&gt; 3. å¤–å±‚çˆ¶å…ƒç´ display: table-cell;vertical-align: middleç‰¹ç‚¹ï¼š å¤–å±‚å…ƒç´ éœ€è¦è®¾ç½®é«˜åº¦ é€‚ç”¨èŒƒå›´ï¼š é€‚ç”¨äºåœ¨å—å…ƒç´ å†…å­˜åœ¨å•ä¸ªè¡Œå†…å—å…ƒç´ ï¼Œå°†å®ƒå‚ç›´å±…ä¸­ï¼› 1234567891011121314&lt;body&gt; &lt;style&gt; .container &#123; background: aqua; height: 300px; display: table-cell; vertical-align: middle; &#125; &lt;/style&gt; &lt;div class=&quot;container&quot;&gt; &lt;img src=&quot;https://www.baidu.com/img/bd_logo1.png&quot; /&gt; &lt;/div&gt;&lt;/body&gt; 4. display:flex; align-items:centerç‰¹ç‚¹ï¼š flexå¸ƒå±€ çˆ¶å…ƒç´ å¯ä»¥ä¸è®¾ç½®é«˜åº¦ï¼Œå®½åº¦ç”±å†…éƒ¨è¡Œå†…å…ƒç´ æ’‘èµ·ï¼ˆè¿™é‡Œè®¾ç½®é«˜åº¦æ˜¯ä¸ºäº†çœ‹çš„æ›´æ¸…æ¥šï¼‰ 1234567891011121314151617181920&lt;body&gt; &lt;style&gt; .container &#123; height: 300px; background: aqua; display: flex; align-items: center; &#125; img &#123; max-width: 300px; &#125; &lt;/style&gt; &lt;div class=&quot;container&quot;&gt; &lt;span&gt;12111111111111111111111111111111111111111111111111eeeeeeeeeeee1111111dwaedwqqqqqqqqqqqqqqqqq&lt;/span&gt; &lt;img src=&quot;https://www.baidu.com/img/bd_logo1.png&quot; /&gt; &lt;/div&gt;&lt;/body&gt; 5. ç»å¯¹å®šä½+è´Ÿå¤–è¾¹è·ï¼›é€‚ç”¨èŒƒå›´ï¼šåŒ…è£¹çš„è¡Œå†…å…ƒç´ å¿…é¡»æ˜¯å¯ä»¥è®¾ç½®é«˜åº¦çš„ï¼Œä½†æ˜¯åƒæ–‡æœ¬å…ƒç´ æ˜¯ä¸å»ºè®®ä½¿ç”¨è¿™ä¸ªçš„ï¼Œå› ä¸ºæ–‡æœ¬çš„å†…å®¹ä¸ç¡®å®šï¼Œé™¤éå®šé«˜ä¸”è®¾ç½®è¶…å‡ºæº¢å‡º 123456789101112131415161718192021&lt;body&gt; &lt;style&gt; .container &#123; height: 300px; background: aqua; position: relative; &#125; img &#123; height: 200px; margin-top: -100px; top: 50%; position: absolute; &#125; &lt;/style&gt; &lt;div class=&quot;container&quot;&gt; &lt;img src=&quot;https://www.baidu.com/img/bd_logo1.png&quot; /&gt; &lt;/div&gt;&lt;/body&gt; å—çº§å…ƒç´ å‚ç›´å±…ä¸­ç±»ä¼¼ï¼Œä¸è§£é‡Š å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­åˆ©ç”¨ displayï¼štableï¼›å’Œdisplay:table-cell; æ¥å®ç°å¤šè¡Œæ–‡æœ¬çš„å‚ç›´å±…ä¸­ 1234567891011121314151617181920212223242526&lt;body&gt; &lt;style&gt; .container &#123; height: 300px; background: aqua; display: table; &#125; p &#123; display: table-cell; vertical-align: middle; background-color: bisque; &#125; &lt;/style&gt; &lt;div class=&quot;container&quot;&gt; &lt;p&gt; dsadwqdssacadseqdsfcdsfsasddsa dwqdssacadseqdsfcdsfsasddsadwqd ssacadseqdsfcdsfsasddsadwqdssaca dseqdsfcdsfsasddsadwqdssacadseqds fcdsfsasddsadwqdssacadseqdsfcdsfsasd &lt;/p&gt; &lt;/div&gt;&lt;/body&gt; æœªçŸ¥å…ƒç´ çš„å®½é«˜æƒ…å†µåœ¨å‰é¢çš„å®ç°è¡Œå†…å…ƒç´ çš„å‚ç›´å±…ä¸­ä¸­æœ‰æåˆ°å‡ ç§æ–¹æ³• 1. ç»„åˆä½¿ç”¨displayï¼štable-cellå’Œvertical-alignã€text-alignï¼Œä½¿çˆ¶å…ƒç´ å†…çš„æ‰€æœ‰è¡Œå†…å…ƒç´ æ°´å¹³å‚ç›´å±…ä¸­ï¼ˆå†…éƒ¨divè®¾ç½®displayï¼šinline-blockå³å¯ï¼‰è¿™åœ¨å­å…ƒç´ ä¸ç¡®å®šå®½åº¦å’Œé«˜åº¦æ—¶ ä¸å…¶ä»–ä¸€äº›displayå±æ€§ç±»ä¼¼ï¼Œtable-cellåŒæ ·ä¼šè¢«å…¶ä»–ä¸€äº›csså±æ€§ç ´åï¼Œä¾‹å¦‚floatï¼Œpositionï¼šabsoluteï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨displayï¼štable-cellæ—¶ï¼Œå°½é‡ä¸è¦ä½¿ç”¨floatæˆ–è€…position:absoluteï¼ˆå¯ä»¥è€ƒè™‘ä¸ºä¹‹å¢åŠ ä¸€ä¸ªçˆ¶divå®šä¹‰floatç­‰å±æ€§ã€‚ï¼‰ï¼›è®¾ç½®äº†table-cellçš„å…ƒç´ å¯¹å®½åº¦å’Œé«˜åº¦æ•æ„Ÿï¼ˆåœ¨çˆ¶å…ƒç´ ä¸Šè®¾ç½®table-rowç­‰å±æ€§ï¼Œä¹Ÿä¼šä½¿å…¶ä¸æ„ŸçŸ¥heightã€‚ï¼‰ï¼Œå¯¹marginå€¼æ— ååº”ï¼Œå“åº”paddingå±æ€§ 1234567891011121314151617181920212223242526&lt;body&gt; &lt;style&gt; .father &#123; width: 400px; height: 200px; border: 1px solid #000; display: table-cell; text-align: center; vertical-align: middle; &#125; .son &#123; width: 200px; height: 100px; background: red; display: inline-block; &#125; &lt;/style&gt; &lt;div class=&quot;father&quot;&gt; &lt;div class=&quot;son&quot;&gt; display:table-cell;&lt;/br&gt;text-align:center;&lt;/br&gt; vertical-align:middle &lt;/div&gt; &lt;/div&gt;&lt;/body&gt; å¯¹table-cellå…ƒç´ è®¾ç½®ç™¾åˆ†æ¯”ï¼ˆå¦‚100%ï¼‰çš„å®½é«˜å€¼æ˜¯æ— æ•ˆçš„ï¼Œä½†æ˜¯å¯ä»¥å°†å…ƒç´ è®¾ç½®display:tableï¼Œå†å°†çˆ¶å…ƒç´ è®¾ç½®ç™¾åˆ†æ¯”è·¨é«˜ï¼Œå­å…ƒç´ table-cellä¼šè‡ªåŠ¨æ’‘æ»¡çˆ¶å…ƒç´ ã€‚è¿™å°±å¯ä»¥åšç›¸å¯¹äºæ•´ä¸ªé¡µé¢çš„æ°´å¹³å‚ç›´å±…ä¸­ã€‚å—¯ï¼Œçœ‹ä¸‹é¢çš„ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940&lt;body&gt; &lt;style&gt; html, body &#123; height: 100%; margin: 0; padding: 0; &#125; #box &#123; display: table; width: 100%; height: 100%; &#125; .father &#123; width: 400px; height: 200px; border: 1px solid #000; display: table-cell; text-align: center; vertical-align: middle; &#125; .son &#123; width: 200px; height: 100px; background: red; display: inline-block; &#125; &lt;/style&gt; &lt;div id=&quot;box&quot;&gt; &lt;div class=&quot;father&quot;&gt; &lt;div class=&quot;son&quot;&gt; display:table-cell;&lt;/br&gt;text-align:center;&lt;/br&gt; vertical-align:middle &lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/body&gt; 2. display:flexçš„æ–¹æ³•å‚è€ƒä¸Šé¢æ‰€è¯´çš„è¡Œå†…å…ƒç´ çš„æ–¹æ³• è®¾ç½®containerçš„displayçš„ç±»å‹ä¸ºflexï¼Œæ¿€æ´»ä¸ºflexboxæ¨¡å¼ã€‚ justify-contentå®šä¹‰æ°´å¹³æ–¹å‘çš„å…ƒç´ ä½ç½® align-itemså®šä¹‰å‚ç›´æ–¹å‘çš„å…ƒç´ ä½ç½® 3. display:inline-block +ä¼ªå…ƒç´ ç”Ÿæˆcontentå†…å®¹å®ç°åŸç†ï¼šåŸç†ï¼šåˆ©ç”¨inline-blockçš„vertical-align: middleå»å¯¹é½beforeä¼ªå…ƒç´ ï¼Œbeforeä¼ªå…ƒç´ çš„é«˜åº¦ä¸çˆ¶å¯¹è±¡ä¸€æ ·ï¼Œå°±å®ç°äº†é«˜åº¦æ–¹å‘çš„å¯¹é½ã€‚å±…ä¸­å—çš„å°ºå¯¸å¯ä»¥åšåŒ…è£¹æ€§ã€è‡ªé€‚åº”å†…å®¹ï¼Œå…¼å®¹æ€§ä¹Ÿç›¸å½“å¥½ã€‚ç¼ºç‚¹æ˜¯æ°´å¹³å±…ä¸­éœ€è¦è€ƒè™‘inline-blocké—´éš”ä¸­çš„ç•™ç™½ï¼ˆä»£ç æ¢è¡Œç¬¦é—ç•™é—®é¢˜ã€‚ï¼‰ã€‚ï¼ˆå®½åº¦æ˜¯å·²çŸ¥çš„ï¼Œé«˜åº¦å¯ä»¥æ˜¯æœªçŸ¥çš„ï¼‰ (è¿™é‡Œå­å…ƒç´ åŠ äº†å®½é«˜æ˜¯ä¸ºäº†æ–¹ä¾¿çœ‹ï¼Œå»æ‰ä¹Ÿæ— æ‰€è°“) 123456789101112131415161718192021222324252627282930313233&lt;body&gt; &lt;style&gt; .father &#123; width: 400px; height: 200px; border: 1px solid #000; text-align: center; &#125; .father:before &#123; content: &quot; &quot;; display: inline-block; vertical-align: middle; height: 100%; &#125; .son &#123; width: 200px; height: 100px; background: red; display: inline-block; vertical-align: middle; &#125; &lt;/style&gt; &lt;div class=&quot;father&quot;&gt; &lt;div class=&quot;son&quot;&gt; display:inline-block;&lt;/br&gt;ä¼ªå…ƒç´ ç”Ÿæˆcontentå†…å®¹&lt;/br&gt; &lt;/div&gt; &lt;/div&gt;&lt;/body&gt; 4. ç»å¯¹å®šä½+transformåå‘åç§»ã€‚position:absolute; transform:translate(-50%,-50%); åŸç†å¾ˆç®€å•ï¼šç”±äºtopã€leftåç§»äº†çˆ¶å¯¹è±¡çš„50%å®½åº¦é«˜åº¦ï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨transformåå‘åç§»å±…ä¸­å—çš„50%å®½é«˜ transformçš„è®¡ç®—åŸºå‡†æ˜¯å…ƒç´ æœ¬èº«ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç”¨50%æ¥åšåå‘åç§» (è¿™é‡Œå­å…ƒç´ åŠ äº†å®½é«˜æ˜¯ä¸ºäº†æ–¹ä¾¿çœ‹ï¼Œå»æ‰ä¹Ÿæ— æ‰€è°“) 123456789101112131415161718192021222324252627&lt;body&gt; &lt;style&gt; .father &#123; width: 400px; height: 200px; border: 1px solid #000; position: relative; &#125; .son &#123; width: 200px; height: 100px; background: red; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); &#125; &lt;/style&gt; &lt;div class=&quot;father&quot;&gt; &lt;div class=&quot;son&quot;&gt; position:absolute;&lt;/br&gt;left:50%;top:50%;&lt;/br&gt;transform &lt;/div&gt; &lt;/div&gt;&lt;/body&gt; çŸ¥é“å…ƒç´ å®½é«˜çš„æƒ…å†µä¸‹1.ç»å¯¹å®šä½ç›¸å¯¹å®šä½ï¼ˆ ç»å¯¹å®šä½+marginï¼šautoï¼›position:absolute; left:0; top:0; right:0; bottom:0; margin:autoï¼‰ä¸€ä¸ªæ¡ä»¶éƒ½ä¸èƒ½å°‘ 12345678910111213141516171819202122232425262728&lt;body&gt; &lt;style&gt; .father &#123; width: 400px; height: 200px; position: relative; border: 1px solid #000; &#125; .son &#123; width: 200px; height: 100px; background: red; position: absolute; left: 0; top: 0; bottom: 0; right: 0; margin: auto; &#125; &lt;/style&gt; &lt;div class=&quot;father&quot;&gt; &lt;div class=&quot;son&quot;&gt; position:absolute;&lt;/br&gt; left:0; top:0;&lt;/br&gt; right:0; bottom:0; &lt;/br&gt;margin:auto &lt;/div&gt; &lt;/div&gt;&lt;/body&gt; åŸç†ï¼š å½“ä¸€ä¸ªç»å¯¹å®šä½å…ƒç´ ï¼Œå…¶å¯¹ç«‹å®šä½æ–¹å‘å±æ€§åŒæ—¶æœ‰å…·ä½“å®šä½æ•°å€¼çš„æ—¶å€™ï¼Œæµä½“ç‰¹æ€§å°±å‘ç”Ÿäº†ã€‚ å…·æœ‰æµä½“ç‰¹æ€§ç»å¯¹å®šä½å…ƒç´ çš„margin:autoçš„å¡«å……è§„åˆ™å’Œæ™®é€šæµä½“å…ƒç´ ä¸€æ¨¡ä¸€æ ·ï¼š å¦‚æœä¸€ä¾§å®šå€¼ï¼Œä¸€ä¾§autoï¼Œautoä¸ºå‰©ä½™ç©ºé—´å¤§å°ï¼›å¦‚æœä¸¤ä¾§å‡æ˜¯auto, åˆ™å¹³åˆ†å‰©ä½™ç©ºé—´ï¼›ä¾‹å¦‚ï¼Œä¸‹é¢çš„CSSä»£ç ï¼š 12345678.father &#123; width: 300px; height:150px; position: relative;&#125;.son &#123; position: absolute; top: 0; right: 0; bottom: 0; left: 0;&#125; å¦‚å›¾æ‰€ç¤ºæµä½“å…ƒç´ ä¼šå¸ƒæ»¡æ•´ä¸ªçˆ¶å…ƒç´ ï¼Œæ­¤æ—¶.sonè¿™ä¸ªå…ƒç´ çš„å°ºå¯¸è¡¨ç°ä¸ºâ€œæ ¼å¼åŒ–å®½åº¦å’Œæ ¼å¼åŒ–é«˜åº¦â€ï¼Œå’Œçš„â€œæ­£å¸¸æµå®½åº¦â€ä¸€æ ·ï¼ŒåŒå±äºå¤–éƒ¨å°ºå¯¸ï¼Œä¹Ÿå°±æ˜¯å°ºå¯¸è‡ªåŠ¨å¡«å……çˆ¶çº§å…ƒç´ çš„å¯ç”¨å°ºå¯¸çš„ ç„¶åï¼Œæ­¤æ—¶æˆ‘ä»¬ç»™.sonè®¾ç½®å°ºå¯¸ï¼Œä¾‹å¦‚ 12345.son &#123; position: absolute; top: 0; right: 0; bottom: 0; left: 0; width: 200px; height: 100px;&#125; æ­¤æ—¶å®½é«˜è¢«é™åˆ¶ï¼ŒåŸæœ¬åº”è¯¥å¡«å……çš„ç©ºé—´å°±è¢«å¤šä½™äº†å‡ºæ¥ï¼Œè¿™å¤šä½™çš„ç©ºé—´å°±æ˜¯margin:autoè®¡ç®—çš„ç©ºé—´ï¼Œå› æ­¤ï¼Œå¦‚æœè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å†è®¾ç½®ä¸€ä¸ªmargin:autoï¼Œé‚£ä¹ˆï¼š 123456.son &#123; position: absolute; top: 0; right: 0; bottom: 0; left: 0; width: 200px; height: 100px; margin: auto;&#125; æˆ‘ä»¬è¿™ä¸ª.sonå…ƒç´ å°±æ°´å¹³å’Œå‚ç›´æ–¹å‘åŒæ—¶å±…ä¸­äº† 2. ç»å¯¹å®šä½+marginåå‘åç§»åœ¨ä¸Šé¢çš„è¡Œå†…å—å…ƒç´ ç§æœ‰æåŠåˆ° 12345positionï¼šabsolute; top:50%; left:50%; margin-left:-(width+padding)/2+&#x27;px&#x27;; margin-top:-(height+padding)/2+&#x27;px&#x27;; marginå€¼çš„è®¾ç½®ä¸èƒ½ä½¿ç”¨ç™¾åˆ†æ¯”ï¼Œå› ä¸ºmarginæ˜¯åŸºäºçˆ¶å…ƒç´ çš„å®½åº¦æ¥è®¡ç®—ç™¾åˆ†æ¯”çš„ è¿™ä¸ªåŸç†å’Œä¸Šé¢çš„æ–¹æ¡ˆ4å¾ˆç›¸ä¼¼ï¼Œç”±äºtopã€leftåç§»äº†çˆ¶å¯¹è±¡çš„50%å®½åº¦é«˜åº¦ï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨marginåå‘åç§»å±…ä¸­å—çš„50%å®½é«˜","tags":["Css","å‚ç›´å±…ä¸­"],"categories":["Css"]},{"title":"å—çº§å…ƒç´ ï¼Œè¡Œå†…å…ƒç´ å’Œè¡Œå†…å—å…ƒç´ ","path":"/2020/03/26/å—çº§å…ƒç´ ï¼Œè¡Œå†…å…ƒç´ å’Œè¡Œå†…å—å…ƒç´ /","content":"å—çº§å…ƒç´ æ¯ä¸ªå—çº§å…ƒç´ éƒ½æ˜¯ç‹¬å ä¸€è¡Œæˆ–è€…å¤šè¡Œï¼Œå¯ä»¥å¯¹å…¶å•ç‹¬è®¾ç½®é«˜åº¦ï¼Œå®½åº¦ä»¥åŠå¯¹é½ç­‰å±æ€§ å—çº§å…ƒç´ æœ‰divã€pã€tableï¼Œnavã€asideã€headerã€footerã€sectionã€articleã€ulï¼Œliã€ ~ ï¼Œaddressç­‰ã€‚ å—çº§å…ƒç´ çš„ç‰¹ç‚¹ å—çº§å…ƒç´ ä¼šç‹¬å ä¸€è¡ŒB é«˜åº¦ï¼Œè¡Œé«˜ï¼Œå¤–è¾¹è·å’Œå†…è¾¹è·éƒ½å¯ä»¥å•ç‹¬è®¾ç½® å®½åº¦é»˜è®¤æ˜¯å®¹å™¨çš„100% å¯ä»¥å®¹çº³å†…è”å…ƒç´ å’Œå…¶ä»–å—çº§å…ƒç´  è¡Œå†…å…ƒç´ è¡Œå†…å…ƒç´ ï¼ˆå†…è”å…ƒç´ ï¼‰ä¸å æœ‰ç‹¬ç«‹çš„åŒºåŸŸï¼Œä»…ä»…ä¾é è‡ªå·±çš„å­—ä½“å¤§å°æˆ–è€…æ˜¯å›¾åƒå¤§å°æ¥æ”¯æ’‘ç»“æ„ï¼Œä¸€èˆ¬ä¸å¯ä»¥è®¾ç½®å®½åº¦ï¼Œé«˜åº¦ä»¥åŠå¯¹é½ç­‰å±æ€§ å¸¸è§çš„è¡Œå†…å…ƒç´ æœ‰ï¼š,,,,,ç­‰ è¡Œå†…å…ƒç´ çš„ç‰¹ç‚¹ï¼š å’Œç›¸é‚»çš„è¡Œå†…å…ƒç´ åœ¨åŒä¸€è¡Œä¸Š é«˜åº¦å®½åº¦ä¸Šæ— æ•ˆï¼Œä½†æ˜¯æ°´å¹³æ–¹å‘ä¸Šçš„paddingå’Œmarginå¯ä»¥è®¾ç½®ï¼Œå‚ç›´æ–¹å‘ä¸Šæ— æ•ˆ é»˜è®¤çš„å®½åº¦å°±æ˜¯å®ƒæœ¬èº«çš„å®½åº¦ è¡Œå†…å…ƒç´ åªèƒ½å®¹çº³çº¯æ–‡æœ¬æˆ–è€…æ˜¯å…¶ä»–çš„è¡Œç±»å…ƒç´ ï¼Œé™¤äº†ï¼ˆaæ ‡ç­¾ï¼‰ notesï¼š åªæœ‰æ–‡å­—æ‰èƒ½ç»„æˆæ®µè½ï¼Œå› æ­¤ç±»ä¼¼,~,ç­‰éƒ½æ˜¯æ–‡å­—å—çº§æ ‡ç­¾ï¼Œæ‰€ä»¥é‡Œé¢ä¸èƒ½æ”¾å—çº§å…ƒç´  é“¾æ¥é‡Œé¢ä¸èƒ½å†å­˜æ”¾é“¾æ¥ è¡Œå†…å—å…ƒç´  å¸¸è§çš„æœ‰ï¼š, , å¯ä»¥è®¾ç½®ä»–ä»¬çš„å®½é«˜åº¦å’Œå¯¹é½çš„å±æ€§ è¡Œå†…å—å…ƒç´ çš„ç‰¹ç‚¹ï¼š å’Œç›¸é‚»çš„è¡Œå†…å…ƒç´ ï¼ˆè¡Œå†…å—ï¼‰å†ä¸€è¡Œä¸Šï¼Œä½†æ˜¯ä¸­é—´ä¼šæœ‰ç©ºç™½çš„é—´éš™ é»˜è®¤çš„å®½åº¦å°±æ˜¯æœ¬èº«å†…å®¹çš„å®½åº¦ é«˜åº¦ï¼Œè¡Œé«˜ï¼Œå†…è¾¹è·å’Œå¤–è¾¹è·éƒ½å¯ä»¥è®¾ç½® æ˜¾ç¤ºæ¨¡å¼çš„è½¬æ¢å—è½¬è¡Œå†…ï¼šdisplay:inline è¡Œå†…è½¬å—ï¼šdisplay:block å—ï¼Œè¡Œå†…å…ƒç´ è½¬æ¢ä¸ºè¡Œå†…å—ï¼šdisplay:inline-block","tags":["Html"],"categories":["Html"]},{"title":"æµè§ˆå™¨çš„æ¸²æŸ“æœºåˆ¶","path":"/2020/03/25/æµè§ˆå™¨çš„æ¸²æŸ“æœºåˆ¶/","content":"æµè§ˆå™¨çš„æ¸²æŸ“è¿‡ç¨‹*é¢è¯•é¢˜ï¼šåœ¨æµè§ˆå™¨åœ°å€æ é‡Œè¾“å…¥ä¸€ä¸ªURL,åˆ°è¿™ä¸ªé¡µé¢å‘ˆç°å‡ºæ¥ï¼Œä¸­é—´ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ ç›®å‰å¸‚é¢ä¸Šå¸¸è§çš„æµè§ˆå™¨å†…æ ¸å¯ä»¥åˆ†ä¸ºè¿™å››ç§ï¼šTridentï¼ˆIEï¼‰ã€Geckoï¼ˆç«ç‹ï¼‰ã€Blinkï¼ˆChromeã€Operaï¼‰ã€Webkitï¼ˆSafariï¼‰ã€‚è¿™é‡Œé¢å¤§å®¶æœ€è€³ç†Ÿèƒ½è¯¦çš„å¯èƒ½å°±æ˜¯ Webkit å†…æ ¸äº†ï¼ŒWebkit å†…æ ¸æ˜¯å½“ä¸‹æµè§ˆå™¨ä¸–ç•ŒçœŸæ­£çš„éœ¸ä¸»ã€‚æœ¬æ–‡æˆ‘ä»¬å°±ä»¥ Webkit ä¸ºä¾‹ï¼Œå¯¹ç°ä»£æµè§ˆå™¨çš„æ¸²æŸ“è¿‡ç¨‹è¿›è¡Œä¸€ä¸ªæ·±åº¦çš„å‰–æã€‚ 1. é¡µé¢åŠ è½½çš„è¿‡ç¨‹é¦–å…ˆéœ€è¦æ‰¾åˆ°è¿™ä¸ªURLåŸŸåçš„æœåŠ¡å™¨IP å¯»æ‰¾ç¼“å­˜ï¼Œ æŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰è®°å½•ï¼ˆæµè§ˆå™¨ç¼“å­˜ -&gt; ç³»ç»Ÿç¼“å­˜ -&gt; è·¯ç”±å™¨ç¼“å­˜ ï¼‰ï¼Œç¼“å­˜ä¸­æ²¡åˆ™å»æŸ¥æ‰¾ç³»ç»Ÿçš„hostsæ–‡ä»¶è®°å½•ï¼Œå¦‚æœå†æ²¡æœ‰å°±å»æŸ¥è¯¢DNSæœåŠ¡å™¨ã€‚ æµè§ˆå™¨ä¼šæ ¹æ®DNSæœåŠ¡å™¨å¾—åˆ°åŸŸåçš„IPåœ°å€ æ ¹æ®è¿™ä¸ªIP ä»¥åŠç›¸åº”çš„ç«¯å£å· æ„å»ºä¸€ä¸ªHTTPè¯·æ±‚ï¼Œå¹¶å°†è¿™ä¸ªHTTPè¯·æ±‚å°è£…åœ¨ä¸€ä¸ªTCPåŒ…ä¸­ï¼Œå‘é€ç»™æœåŠ¡å™¨ï¼ˆä¾æ¬¡ç»è¿‡ä¼ è¾“å±‚ï¼Œç½‘ç»œå±‚ï¼Œæ•°æ®é“¾è·¯å±‚ï¼Œç‰©ç†å±‚ï¼ŒæœåŠ¡å™¨ï¼‰ æœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ªåŒ…å¹¶ä¸”è§£æè¿™ä¸ªhttpè¯·æ±‚è¿”å›ç›¸åº”çš„HTMLç»™æµè§ˆå™¨ å…¶å®å°±æ˜¯ä¸€å † HMTL æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºåªæœ‰ HTML æ ¼å¼æµè§ˆå™¨æ‰èƒ½æ­£ç¡®è§£æï¼Œè¿™æ˜¯ W3C æ ‡å‡†çš„è¦æ±‚ã€‚æ¥ä¸‹æ¥å°±æ˜¯æµè§ˆå™¨çš„æ¸²æŸ“è¿‡ç¨‹ã€‚ 2. æµè§ˆå™¨çš„æ¸²æŸ“è¿‡ç¨‹ 1ï¼‰ æµè§ˆå™¨ä¼šè§£æä¸‰ä¸ªä¸œè¥¿ HTML/SVG/XHMLï¼ŒHTMLå­—ç¬¦ä¸²æè¿°äº†ä¸€ä¸ªé¡µé¢çš„ç»“æ„ï¼Œæµè§ˆå™¨ä¼šæŠŠHTMLç»“æ„å­—ç¬¦ä¸²è§£æè½¬æ¢DOMæ ‘å½¢ç»“æ„ï¼ˆDOMçš„æ„å»ºï¼‰ï¼ˆåœ¨domæ ‘çš„æ„å»ºè¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°JSè„šæœ¬å’Œå¤–éƒ¨JSè¿æ¥ï¼Œåˆ™ä¼šåœæ­¢æ„å»ºDOMæ ‘æ¥æ‰§è¡Œå’Œä¸‹è½½ç›¸åº”çš„ä»£ç ï¼Œé€ æˆé˜»å¡ï¼Œåé¢ä¼šè¯´åˆ°ï¼‰ã€‚ CSSï¼Œè§£æCSSäº§ç”ŸCSS rule treeï¼Œå’Œä»–DOMæ ‘çš„ç»“æ„æ¯”è¾ƒåƒ JSè„šæœ¬ï¼Œç­‰åˆ°JSè„šæœ¬æ–‡ä»¶åŠ è½½å®Œæˆä¹‹åï¼Œé€šè¿‡DOM APIå’ŒCSSOM APIæ¥æ“ä½œDOM treeå’ŒCSS rule tree 2ï¼‰è§£æå®Œæˆï¼Œæµè§ˆå™¨å¼•æ“ä¼šé€šè¿‡DOM treeå’Œcss Rule Treeæ¥æ„é€ Rendering Treeã€‚ Rendering Tree æ¸²æŸ“æ ‘å¹¶ä¸ç­‰åŒäºDOMæ ‘ï¼Œæ¸²æŸ“æ ‘åªä¼šåŒ…æ‹¬éœ€è¦æ˜¾ç¤ºçš„èŠ‚ç‚¹å’Œè¿™äº›èŠ‚ç‚¹çš„æ ·å¼ä¿¡æ¯ ï¼ˆè¿™é‡Œä¸»è¦åšçš„æ˜¯æ’é™¤éè§†è§‰èŠ‚ç‚¹ï¼Œæ¯”å¦‚scriptï¼Œmetaæ ‡ç­¾å’Œæ’é™¤displayä¸ºnoneçš„èŠ‚ç‚¹ï¼‰ CSSçš„rule treeä¸»è¦æ˜¯ä¸ºäº†å®ŒæˆåŒ¹é…å¹¶ä¸”æŠŠCSS ruleé™„åŠ ä¸ŠRendering treeä¸Šçš„æ¯ä¸€ä¸ªElementï¼ˆä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªFrameï¼‰ ç„¶åè®¡ç®—æ¯ä¸ªFrameçš„ä½ç½®ï¼Œå¾—åˆ°èŠ‚ç‚¹çš„å‡ ä½•ä¿¡æ¯ï¼ˆä½ç½®ï¼Œå¤§å°ï¼‰ï¼Œè¿™ä¸ªåˆå«åšå›æµï¼ˆlayoutï¼‰ æ ¹æ®æ¸²æŸ“æ ‘ä»¥åŠå›æµå¾—åˆ°çš„å‡ ä½•ä¿¡æ¯ï¼Œå¾—åˆ°èŠ‚ç‚¹çš„ç»å¯¹åƒç´ ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšé‡ç»˜ï¼ˆpaintingï¼‰ display:å°†åƒç´ å‘é€ç»™GPUï¼Œå±•ç¤ºåœ¨é¡µé¢ä¸Šã€‚ï¼ˆè¿™ä¸€æ­¥å…¶å®è¿˜æœ‰å¾ˆå¤šå†…å®¹ï¼Œæ¯”å¦‚ä¼šåœ¨GPUå°†å¤šä¸ªåˆæˆå±‚åˆå¹¶ä¸ºåŒä¸€ä¸ªå±‚ï¼Œå¹¶å±•ç¤ºåœ¨é¡µé¢ä¸­ã€‚è€Œcss3ç¡¬ä»¶åŠ é€Ÿçš„åŸç†åˆ™æ˜¯æ–°å»ºåˆæˆå±‚ 3ï¼‰æœ€åé€šè¿‡è°ƒç”¨æ“ä½œç³»ç»ŸNative GUIçš„apiç»˜åˆ¶ æ¥ä¸‹æ¥å™è¿°ä¸€äº›è¯¦ç»†æ­¥éª¤ æ„å»ºDOMæ ‘ æµè§ˆå™¨ä¼šéµå®ˆä¸€å¥—æ­¥éª¤å°†HTML æ–‡ä»¶è½¬æ¢ä¸º DOM æ ‘ã€‚å®è§‚ä¸Šï¼Œå¯ä»¥åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤ï¼š æµè§ˆå™¨ä»ç£ç›˜æˆ–ç½‘ç»œè¯»å–HTMLçš„åŸå§‹å­—èŠ‚ï¼Œå¹¶ä¸”æ ¹æ®æ–‡ä»¶çš„æŒ‡å®šç¼–ç ï¼ˆä¾‹ï¼šUTF-8ï¼‰æ¥å°†ä»–ä»¬è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚ï¼ˆç½‘ç»œä¸­ä¼ è¾“çš„å†…å®¹å…¶å®éƒ½æ˜¯0 1è¿™äº›å­—èŠ‚æ•°æ®ã€‚å½“æµè§ˆå™¨æ”¶åˆ°è¿™äº›å­—èŠ‚æ•°æ®ä»¥åï¼Œä¼šå°†ä»–ä»¬è½¬æˆå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å†™çš„ä»£ç ï¼‰ å°†å­—ç¬¦ä¸²è½¬æ¢æˆTOKENï¼Œä¾‹å¦‚ï¼š&lt; html &gt;,&lt; body &gt;ç­‰ã€‚Tokenä¸­ä¼šè‡ªåŠ¨æ ‡è¯†å‡ºå½“å‰Tokenæ˜¯â€œå¼€å§‹æ ‡ç­¾â€è¿˜æ˜¯â€œç»“æŸæ ‡ç­¾â€æˆ–è€…æ˜¯â€œæ–‡æœ¬â€ç­‰ä¿¡æ¯ã€‚ ç”ŸæˆèŠ‚ç‚¹å¯¹è±¡å¹¶ä¸”æ„å»ºDOMã€‚ï¼ˆ æ„å»ºDOMçš„è¿‡ç¨‹ä¸­ï¼Œä¸æ˜¯ç­‰æ‰€æœ‰Tokenéƒ½è½¬æ¢å®Œæˆåå†å»ç”ŸæˆèŠ‚ç‚¹å¯¹è±¡ï¼Œè€Œæ˜¯ä¸€è¾¹ç”ŸæˆTokenä¸€è¾¹æ¶ˆè€—Tokenæ¥ç”ŸæˆèŠ‚ç‚¹å¯¹è±¡ã€‚æ¢å¥è¯è¯´ï¼Œæ¯ä¸ªTokenè¢«ç”Ÿæˆåï¼Œä¼šç«‹åˆ»æ¶ˆè€—è¿™ä¸ªTokenåˆ›å»ºå‡ºèŠ‚ç‚¹å¯¹è±¡ã€‚æ³¨æ„ï¼šå¸¦æœ‰ç»“æŸæ ‡ç­¾æ ‡è¯†çš„Tokenä¸ä¼šåˆ›å»ºèŠ‚ç‚¹å¯¹è±¡ã€‚ ï¼‰ æ„å»ºCSSOMDOMä¼šæ•è·é¡µé¢çš„å†…å®¹ï¼Œä½†æµè§ˆå™¨è¿˜éœ€è¦çŸ¥é“é¡µé¢å¦‚ä½•å±•ç¤ºï¼Œæ‰€ä»¥éœ€è¦æ„å»ºCSSOMã€‚ æ„å»ºCSSOMçš„è¿‡ç¨‹ä¸æ„å»ºDOMçš„è¿‡ç¨‹éå¸¸ç›¸ä¼¼ï¼Œå½“æµè§ˆå™¨æ¥æ”¶åˆ°ä¸€æ®µCSSï¼Œæµè§ˆå™¨é¦–å…ˆè¦åšçš„æ˜¯è¯†åˆ«å‡ºTokenï¼Œç„¶åæ„å»ºèŠ‚ç‚¹å¹¶ç”ŸæˆCSSOMã€‚ åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨ä¼šç¡®å®šä¸‹æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„æ ·å¼åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œå¹¶ä¸”è¿™ä¸€è¿‡ç¨‹å…¶å®æ˜¯å¾ˆæ¶ˆè€—èµ„æºçš„ã€‚å› ä¸ºæ ·å¼ä½ å¯ä»¥è‡ªè¡Œè®¾ç½®ç»™æŸä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç»§æ‰¿è·å¾—ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨å¾—é€’å½’ CSSOM æ ‘ï¼Œç„¶åç¡®å®šå…·ä½“çš„å…ƒç´ åˆ°åº•æ˜¯ä»€ä¹ˆæ ·å¼ã€‚ æ³¨æ„ï¼šCSSåŒ¹é…HTMLå…ƒç´ æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚å’Œæœ‰æ€§èƒ½é—®é¢˜çš„äº‹æƒ…ã€‚æ‰€ä»¥ï¼ŒDOMæ ‘è¦å°ï¼ŒCSSå°½é‡ç”¨idå’Œclassï¼Œåƒä¸‡ä¸è¦è¿‡æ¸¡å±‚å ä¸‹å»ã€‚ æ„å»ºæ¸²æŸ“æ ‘ å½“æˆ‘ä»¬ç”Ÿæˆ DOM æ ‘å’Œ CSSOM æ ‘ä»¥åï¼Œå°±éœ€è¦å°†è¿™ä¸¤æ£µæ ‘ç»„åˆä¸ºæ¸²æŸ“æ ‘ã€‚ åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œä¸æ˜¯ç®€å•çš„å°†ä¸¤è€…åˆå¹¶å°±è¡Œäº†ã€‚ä¸ºäº†æ„å»ºæ¸²æŸ“æ ‘ï¼Œæµè§ˆå™¨ä¸»è¦å®Œæˆäº†ä»¥ä¸‹å·¥ä½œï¼š ä»DOMæ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹éå†æ¯ä¸ªå¯è§èŠ‚ç‚¹ã€‚ å¯¹äºæ¯ä¸ªå¯è§çš„èŠ‚ç‚¹ï¼Œæ‰¾åˆ°CSSOMæ ‘ä¸­å¯¹åº”çš„è§„åˆ™ï¼Œå¹¶åº”ç”¨å®ƒä»¬ã€‚ æ ¹æ®æ¯ä¸ªå¯è§èŠ‚ç‚¹ä»¥åŠå…¶å¯¹åº”çš„æ ·å¼ï¼Œç»„åˆç”Ÿæˆæ¸²æŸ“æ ‘ã€‚ ç¬¬ä¸€æ­¥ä¸­ï¼Œæ—¢ç„¶è¯´åˆ°äº†è¦éå†å¯è§çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾—å…ˆçŸ¥é“ï¼Œä»€ä¹ˆèŠ‚ç‚¹æ˜¯ä¸å¯è§çš„ã€‚ä¸å¯è§çš„èŠ‚ç‚¹åŒ…æ‹¬ï¼š ä¸€äº›ä¸ä¼šæ¸²æŸ“è¾“å‡ºçš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚scriptã€metaã€linkç­‰ã€‚ ä¸€äº›é€šè¿‡cssè¿›è¡Œéšè—çš„èŠ‚ç‚¹ã€‚æ¯”å¦‚display:noneã€‚æ³¨æ„ï¼Œåˆ©ç”¨visibilityå’Œopacityéšè—çš„èŠ‚ç‚¹ï¼Œè¿˜æ˜¯ä¼šæ˜¾ç¤ºåœ¨æ¸²æŸ“æ ‘ä¸Šçš„ã€‚åªæœ‰display:noneçš„èŠ‚ç‚¹æ‰ä¸ä¼šæ˜¾ç¤ºåœ¨æ¸²æŸ“æ ‘ä¸Šã€‚ æ³¨æ„ï¼šæ¸²æŸ“æ ‘åªåŒ…å«å¯è§çš„èŠ‚ç‚¹ å›æµå’Œé‡ç»˜åœ¨å¦ä¸€ç¯‡æ–‡ç« ï¼ˆåŒ…å«äº†æ¸²æŸ“æ€§èƒ½çš„ä¼˜åŒ–ç­–ç•¥ç­‰ï¼‰ ä¸€äº›ç–‘é—®æ¸²æŸ“è¿‡ç¨‹ä¸­ç¢°åˆ°JSæ–‡ä»¶åº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿæ¸²æŸ“è¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°äº†æ ‡ç­¾å°±åœæ­¢æ¸²æŸ“ï¼Œæ‰§è¡ŒJSä»£ç ã€‚å› ä¸ºæµè§ˆå™¨æœ‰GUIæ¸²æŸ“çº¿ç¨‹å’ŒJSå¼•æ“çº¿ç¨‹ï¼Œä¸ºäº†é˜²æ­¢æ¸²æŸ“å‡ºç°ä¸å¯é¢„æœŸçš„ç»“æœï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹æ˜¯äº’æ–¥çš„å…³ç³»ï¼ŒJSçš„åŠ è½½ï¼Œè§£æå’Œæ‰§è¡Œä¼šé˜»å¡DOMçš„æ„å»ºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ„å»ºDOMçš„æ—¶å€™,HTMLè§£æå™¨é‡åˆ°äº†JSï¼Œé‚£ä¹ˆä¼šæš‚åœæ„å»ºDOMï¼Œå°†æ§åˆ¶æƒç§»äº¤ç»™JSå¼•æ“ï¼Œç­‰JSå¼•æ“è¿è¡Œå®Œæ¯•ï¼Œæµè§ˆå™¨å†ä»ä¸­æ–­çš„åœ°æ–¹æ¢å¤DOMæ„å»ºã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æƒ³é¦–å±æ¸²æŸ“çš„è¶Šå¿«ï¼Œå°±è¶Šä¸åº”è¯¥åœ¨é¦–å±å°±åŠ è½½ JS æ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯éƒ½å»ºè®®å°† script æ ‡ç­¾æ”¾åœ¨ body æ ‡ç­¾åº•éƒ¨çš„åŸå› ã€‚å½“ç„¶åœ¨å½“ä¸‹ï¼Œå¹¶ä¸æ˜¯è¯´ script æ ‡ç­¾å¿…é¡»æ”¾åœ¨åº•éƒ¨ï¼Œå› ä¸ºä½ å¯ä»¥ç»™ script æ ‡ç­¾æ·»åŠ  defer æˆ–è€… async å±æ€§ï¼ˆä¸‹æ–‡ä¼šä»‹ç»è¿™ä¸¤è€…çš„åŒºåˆ«ï¼‰ JSæ–‡ä»¶ä¸åªæ˜¯é˜»å¡DOMçš„æ„å»ºï¼Œå®ƒä¼šå¯¼è‡´CSSOMä¹Ÿé˜»å¡DOMçš„æ„å»ºã€‚ åŸæœ¬DOMå’ŒCSSOMçš„æ„å»ºæ˜¯äº’ä¸å½±å“ï¼Œäº•æ°´ä¸çŠ¯æ²³æ°´ï¼Œä½†æ˜¯ä¸€æ—¦å¼•å…¥äº†JavaScriptï¼ŒCSSOMä¹Ÿå¼€å§‹é˜»å¡DOMçš„æ„å»ºï¼Œåªæœ‰CSSOMæ„å»ºå®Œæ¯•åï¼ŒDOMå†æ¢å¤DOMæ„å»ºã€‚ è¿™æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ è¿™æ˜¯å› ä¸ºJavaScriptä¸åªæ˜¯å¯ä»¥æ”¹DOMï¼Œå®ƒè¿˜å¯ä»¥æ›´æ”¹æ ·å¼ï¼Œä¹Ÿå°±æ˜¯å®ƒå¯ä»¥æ›´æ”¹CSSOMã€‚å› ä¸ºä¸å®Œæ•´çš„CSSOMæ˜¯æ— æ³•ä½¿ç”¨çš„ï¼Œå¦‚æœJavaScriptæƒ³è®¿é—®CSSOMå¹¶æ›´æ”¹å®ƒï¼Œé‚£ä¹ˆåœ¨æ‰§è¡ŒJavaScriptæ—¶ï¼Œå¿…é¡»è¦èƒ½æ‹¿åˆ°å®Œæ•´çš„CSSOMã€‚æ‰€ä»¥å°±å¯¼è‡´äº†ä¸€ä¸ªç°è±¡ï¼Œå¦‚æœæµè§ˆå™¨å°šæœªå®ŒæˆCSSOMçš„ä¸‹è½½å’Œæ„å»ºï¼Œè€Œæˆ‘ä»¬å´æƒ³åœ¨æ­¤æ—¶è¿è¡Œè„šæœ¬ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°†å»¶è¿Ÿè„šæœ¬æ‰§è¡Œå’ŒDOMæ„å»ºï¼Œç›´è‡³å…¶å®ŒæˆCSSOMçš„ä¸‹è½½å’Œæ„å»ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¼šå…ˆä¸‹è½½å’Œæ„å»ºCSSOMï¼Œç„¶åå†æ‰§è¡ŒJavaScriptï¼Œæœ€ååœ¨ç»§ç»­æ„å»ºDOMã€‚","tags":["æµè§ˆå™¨ç›¸å…³"],"categories":["æµè§ˆå™¨"]},{"title":"ç”»ä¸€æ¡0.5pxçš„è¾¹","path":"/2020/03/25/ç”»ä¸€æ¡0-5pxçš„è¾¹/","content":"ä»€ä¹ˆæ˜¯åƒç´ ï¼Ÿ åƒç´ æ˜¯å±å¹•æ˜¾ç¤ºæœ€å°çš„å•ä½ï¼Œåœ¨ä¸€ä¸ª1080pçš„å±å¹•ä¸Šï¼Œå®ƒçš„åƒç´ æ•°é‡æ˜¯1920 1080ï¼Œå³æ¨ªè¾¹æœ‰1920ä¸ªåƒç´ ï¼Œè€Œç«–è¾¹ä¸º1080ä¸ªã€‚ä¸€ä¸ªåƒç´ å°±æ˜¯ä¸€ä¸ªå•ä½è‰²å—ï¼Œæ˜¯ç”±rgbaå››ä¸ªé€šé“æ··åˆè€Œæˆã€‚å¯¹äºä¸€ä¸ª1200ä¸‡åƒç´ çš„ç›¸æœºé•œå¤´æ¥è¯´ï¼Œå®ƒæœ‰1200ä¸‡ä¸ªæ„Ÿå…‰å•å…ƒï¼Œå®ƒèƒ½è¾“å‡ºçš„æœ€å¤§å›¾ç‰‡åˆ†è¾¨ç‡å¤§çº¦ä¸º3000 4000ã€‚ é‚£ä¹ˆåƒç´ æœ¬èº«æœ‰å¤§å°å—ï¼Œä¸€ä¸ªåƒç´ æœ‰å¤šå¤§ï¼Ÿ æœ‰çš„ï¼Œå¦‚æœä¸€ä¸ªåƒç´ è¶Šå°ï¼Œé‚£ä¹ˆåœ¨åŒæ ·å¤§å°çš„å±å¹•ä¸Šï¼Œéœ€è¦çš„åƒç´ ç‚¹å°±è¶Šå¤šï¼Œåƒç´ å°±è¶Šå¯†é›†ï¼Œå¦‚æœä¸€è‹±å¯¸æœ‰435ä¸ªåƒç´ ï¼Œé‚£ä¹ˆå®ƒçš„dpi/ppiå°±è¾¾åˆ°äº†435ã€‚Macbook Pro 15å¯¸çš„åˆ†è¾¨ç‡ä¸º2880 x 1800ï¼Œ15å¯¸æ˜¯æŒ‡å±å¹•çš„å¯¹è§’çº¿ä¸º15å¯¸ï¼ˆå…·ä½“ä¸º15.4ï¼‰ï¼Œæ ¹æ®é•¿å®½æ¯”æ¢ç®—ä¸€ä¸‹å¾—åˆ°æ¨ªè¾¹ä¸º13å¯¸ï¼Œæ‰€ä»¥ppiä¸º2880 / 13 = 220 ppi. åƒç´ è¶Šå¯†é›†å³ppi(pixel per inch)è¶Šé«˜ï¼Œé‚£ä¹ˆå±å¹•çœ‹èµ·æ¥å°±è¶Šç»†è…»è¶Šé«˜æ¸…ã€‚ æ€ä¹ˆåœ¨é«˜æ¸…å±ä¸Šç”»ä¸€æ¡0.5pxçš„è¾¹å‘¢ï¼Ÿ0.5pxç›¸å½“äºé«˜æ¸…å±ç‰©ç†åƒç´ çš„1pxã€‚è¿™æ ·çš„ç›®çš„æ˜¯åœ¨é«˜æ¸…å±ä¸Šçœ‹èµ·æ¥ä¼šæ›´ç»†ä¸€ç‚¹ï¼Œæ•ˆæœä¼šæ›´å¥½ä¸€ç‚¹ï¼Œä¾‹å¦‚æ›´ç»†çš„åˆ†éš”çº¿ã€‚ ç†è®ºä¸Špxçš„æœ€å°å•ä½æ˜¯1ï¼Œä½†æ˜¯ä¼šæœ‰å‡ ä¸ªç‰¹ä¾‹ï¼Œé«˜æ¸…å±çš„æ˜¾ç¤ºå°±æ˜¯ä¸€ä¸ªç‰¹ä¾‹ã€‚é«˜æ¸…å±ç¡®å®å¯ä»¥ç”»0.5pxï¼Œå¯¹æ¯”æ•ˆæœå¦‚ä¸‹ï¼š çŒœæƒ³æ–¹æ³•å¦‚ä¸‹ï¼š 1. ç›´æ¥è®¾ç½®å¦‚æœæˆ‘ä»¬ç›´æ¥è®¾ç½®0.5pxï¼Œåœ¨ä¸åŒçš„æµè§ˆå™¨ä¼šæœ‰ä¸åŒçš„è¡¨ç°ï¼Œä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š 123456789101112131415161718&lt;body&gt; &lt;style&gt; div&#123; width: 300px; background: #000; &#125; .half-px &#123; height: .5px; &#125; .one-px &#123; height: 1px; &#125; &lt;/style&gt; &lt;p&gt;0.5px&lt;/p&gt; &lt;div class=&quot;half-px&quot;&gt;&lt;/div&gt; &lt;p&gt;1px&lt;/p&gt; &lt;div class=&quot;one-px&quot;&gt;&lt;/div&gt;&lt;/body&gt; åœ¨PCä¸Šçš„ä¸åŒæµè§ˆå™¨ä¸Šæµ‹è¯•æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š å…¶ä¸­ChromeæŠŠ0.5pxå››èˆäº”å…¥å˜æˆäº†1pxï¼Œè€Œfirefox/safarièƒ½å¤Ÿç”»å‡ºåŠä¸ªåƒç´ çš„è¾¹ï¼Œå¹¶ä¸”Chromeä¼šæŠŠå°äº0.5pxçš„å½“æˆ0ï¼Œè€ŒFirefoxä¼šæŠŠä¸å°äº0.55pxå½“æˆ1pxï¼ŒSafariæ˜¯æŠŠä¸å°äº0.75pxå½“æˆ1pxï¼Œè¿›ä¸€æ­¥åœ¨æ‰‹æœºä¸Šè§‚å¯ŸiOSçš„Chromeä¼šç”»å‡º0.5pxçš„è¾¹ï¼Œè€Œå®‰å“(5.0)åŸç”Ÿæµè§ˆå™¨æ˜¯ä¸è¡Œçš„ã€‚æ‰€ä»¥ç›´æ¥è®¾ç½®0.5pxä¸åŒæµè§ˆå™¨çš„å·®å¼‚æ¯”è¾ƒå¤§ï¼Œå¹¶ä¸”æˆ‘ä»¬çœ‹åˆ°ä¸åŒç³»ç»Ÿçš„ä¸åŒæµè§ˆå™¨å¯¹å°æ•°ç‚¹çš„pxæœ‰ä¸åŒçš„å¤„ç†ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬æŠŠå•ä½è®¾ç½®æˆå°æ•°çš„pxåŒ…æ‹¬å®½é«˜ç­‰ï¼Œå…¶å®ä¸å¤ªå¯é ï¼Œå› ä¸ºä¸åŒæµè§ˆå™¨è¡¨ç°ä¸ä¸€æ ·ã€‚ 2. ç¼©æ”¾scale 0.512345678910111213141516171819&lt;body&gt; &lt;style&gt; div&#123; width: 300px; background: #000; &#125; .half-px &#123; height: 1px; transform: scaleY(.5); &#125; .one-px &#123; height: 1px; &#125; &lt;/style&gt; &lt;p&gt;1px + scaleY(.5)&lt;/p&gt; &lt;div class=&quot;half-px&quot;&gt;&lt;/div&gt; &lt;p&gt;1px&lt;/p&gt; &lt;div class=&quot;one-px&quot;&gt;&lt;/div&gt;&lt;/body&gt; æ•ˆæœå›¾å¦‚ä¸‹ï¼š æˆ‘ä»¬å‘ç°Chrome/Safariéƒ½å˜è™šäº†ï¼Œåªæœ‰Firefoxæ¯”è¾ƒå®Œç¾çœ‹èµ·æ¥æ˜¯å®çš„è€Œä¸”è¿˜å¾ˆç»†ï¼Œæ•ˆæœå’Œç›´æ¥è®¾ç½®0.5pxä¸€æ ·ã€‚æ‰€ä»¥é€šè¿‡transform: scaleä¼šå¯¼è‡´Chromeå˜è™šäº†ï¼Œè€Œç²—ç»†å‡ ä¹æ²¡æœ‰å˜åŒ–ï¼Œæ‰€ä»¥è¿™ä¸ªæ•ˆæœä¸å¥½ã€‚ æˆ‘ä»¬è¿˜æƒ³åˆ°åšç§»åŠ¨ç«¯çš„æ—¶å€™è¿˜ä½¿ç”¨äº†remåšç¼©æ”¾ï¼Œä½†å®é™…ä¸Šremçš„ç¼©æ”¾æœ€åè¿˜æ˜¯ä¼šè½¬åŒ–æˆpxï¼Œæ‰€ä»¥å’Œç›´æ¥ä½¿ç”¨0.5pxçš„æ–¹æ¡ˆæ˜¯ä¸€æ ·çš„ 3. çº¿æ€§æ¸å˜linear-gradient123456789101112131415161718&lt;body&gt; &lt;style&gt; .hr &#123; width: 300px; height: 1px; background-color: #000; &#125; .hr.gradient &#123; height: 1px; background: linear-gradient(0deg, #fff, #000); &#125; &lt;/style&gt; &lt;p&gt;linear-gradient(0deg, #fff, #000)&lt;/p&gt; &lt;div class=&quot;hr gradient&quot;&gt;&lt;/div&gt; &lt;p&gt;1px&lt;/p&gt; &lt;div class=&quot;hr&quot;&gt;&lt;/div&gt;&lt;/body&gt; linear-gradient(0deg, #fff, #000)çš„æ„æ€æ˜¯ï¼šæ¸å˜çš„è§’åº¦ä»ä¸‹å¾€ä¸Šï¼Œä»ç™½è‰²#fffæ¸å˜åˆ°é»‘è‰²#000ï¼Œè€Œä¸”æ˜¯çº¿æ€§çš„ï¼Œåœ¨é«˜æ¸…å±ä¸Šï¼Œ1pxçš„é€»è¾‘åƒç´ ä»£è¡¨çš„ç‰©ç†ï¼ˆè®¾å¤‡ï¼‰åƒç´ æœ‰2pxï¼Œç”±äºæ˜¯çº¿æ€§æ¸å˜ï¼Œæ‰€ä»¥ç¬¬1ä¸ªpxåªèƒ½æ˜¯#fffï¼Œè€Œå‰©ä¸‹çš„é‚£ä¸ªåƒç´ åªèƒ½æ˜¯#000ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†ç”»ä¸€åŠçš„ç›®çš„ã€‚é€»è¾‘åˆ†æå¾ˆå®Œç¾ï¼Œå®é™…çš„æ•ˆæœåˆæ€ä¹ˆæ ·å‘¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æˆ‘ä»¬å‘ç°è¿™ç§æ–¹æ³•åœ¨å„ä¸ªæµè§ˆå™¨ä¸Šé¢éƒ½ä¸å®Œç¾ï¼Œæ•ˆæœéƒ½æ˜¯è™šçš„ï¼Œå’Œå®Œç¾çš„0.5pxè¿˜æ˜¯æœ‰å·®è·ã€‚è¿™ä¸ªæ•ˆæœå’Œscale 0.5çš„å·®ä¸å¤šï¼Œéƒ½æ˜¯é€šè¿‡è™šåŒ–çº¿ï¼Œè®©äººè§‰å¾—å˜ç»†äº†ã€‚ 4. box-shadow12345678910111213141516171819&lt;body&gt; &lt;style&gt; .hr &#123; width: 300px; height: 1px; background-color: #000; &#125; .hr.boxShadow &#123; height: 1px; background: none; box-shadow: 0 0.5px 0 #000; &#125; &lt;/style&gt; &lt;p&gt;boxShadow&lt;/p&gt; &lt;div class=&quot;hr boxShadow&quot;&gt;&lt;/div&gt; &lt;p&gt;1px&lt;/p&gt; &lt;div class=&quot;hr&quot;&gt;&lt;/div&gt;&lt;/body&gt; è®¾ç½®box-shadowçš„ç¬¬äºŒä¸ªå‚æ•°ä¸º0.5pxï¼Œè¡¨ç¤ºé˜´å½±å‚ç›´æ–¹å‘çš„åç§»ä¸º0.5pxï¼Œæ•ˆæœå¦‚ä¸‹ï¼š è¿™ä¸ªæ–¹æ³•åœ¨Chromeå’ŒFirefoxéƒ½éå¸¸å®Œç¾ï¼Œä½†æ˜¯Safariä¸æ”¯æŒå°äº1pxçš„boxshadowï¼Œæ‰€ä»¥å®Œå…¨æ²¡æ˜¾ç¤ºå‡ºæ¥äº†ã€‚ä¸è¿‡è‡³å°‘æ‰¾åˆ°äº†ä¸€ç§æ–¹æ³•èƒ½å¤Ÿè®©PCçš„Chromeæ˜¾ç¤º0.5pxã€‚ 5. è®¾ç½®viewportçš„scale åœ¨ç§»ç«¯å¼€å‘é‡Œé¢ä¸€èˆ¬ä¼šæŠŠviewportçš„scaleè®¾ç½®æˆ 1&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-sacle=1&quot;&gt; å…¶ä¸­width=device-widthè¡¨ç¤ºå°†viewportè§†çª—çš„å®½åº¦è°ƒæ•´ä¸ºè®¾å¤‡çš„å®½åº¦ï¼Œè¿™ä¸ªå®½åº¦é€šå¸¸æ˜¯æŒ‡ç‰©ç†ä¸Šå®½åº¦ã€‚é»˜è®¤çš„ç¼©æ”¾æ¯”ä¾‹ä¸º1ï¼Œå¦‚iphone 6ç«–å±çš„å®½åº¦ä¸º750pxï¼Œå®ƒçš„dpr=2ï¼Œç”¨2pxè¡¨ç¤º1pxï¼Œè¿™æ ·è®¾ç½®ä¹‹åviewportçš„å®½åº¦å°±å˜æˆ375pxã€‚è¿™æ—¶å€™0.5pxçš„è¾¹å°±ä½¿ç”¨æˆ‘ä»¬ä¸Šé¢è®¨è®ºçš„æ–¹æ³•ã€‚ ä½†æ˜¯ä½ å¯ä»¥æŠŠscaleæ”¹æˆ0.5ï¼š 1&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-sacle=0.5&quot;&gt; è¿™æ ·çš„è¯ï¼Œviewportçš„å®½åº¦å°±æ˜¯åŸæœ¬çš„750pxï¼Œæ‰€ä»¥1ä¸ªpxè¿˜æ˜¯1pxï¼Œæ­£å¸¸ç”»å°±è¡Œï¼Œä½†è¿™æ ·ä¹Ÿæ„å‘³ç€UIéœ€è¦æŒ‰2å€å›¾çš„å‡ºï¼Œæ•´ä½“é¢é¢çš„å•ä½éƒ½ä¼šæ”¾å¤§ä¸€å€ã€‚ åœ¨iPhone Xå’Œä¸€äº›å®‰å“æ‰‹æœºç­‰dpr = 3çš„è®¾å¤‡ä¸Šï¼Œéœ€è¦è®¾ç½®scaleä¸º0.333333ï¼Œè¿™ä¸ªæ—¶å€™å°±æ˜¯3å€åœ°ç”»äº†ã€‚ ç»¼ä¸Šè®¨è®ºäº†åƒç´ å’Œviewportçš„ä¸€äº›æ¦‚å¿µï¼Œå¹¶ä»‹ç»å’Œæ¯”è¾ƒäº†åœ¨é«˜æ¸…å±ä¸Šç”»0.5pxçš„å‡ ç§æ–¹æ³•â€”â€”å¯ä»¥é€šè¿‡ç›´æ¥è®¾ç½®å®½é«˜borderä¸º0.5pxã€è®¾ç½®box-shadowçš„å‚ç›´æ–¹å‘çš„åç§»é‡ä¸º0.5pxã€å€ŸåŠ©çº¿æ€§æ¸å˜linear-gradientã€ä½¿ç”¨transform: scaleY(0.5)çš„æ–¹æ³•","tags":["Css","Html"],"categories":["Css"]},{"title":"CSSç›’å­æ¨¡å‹","path":"/2020/03/25/CSSç›’å­æ¨¡å‹/","content":"cssç›’å­æ¨¡å‹å…ˆçœ‹ä¾‹å­ï¼š 12345678910&lt;style&gt; div &#123; width: 300px; height: 400px; border: 5px solid #ccc; background-color: aqua; padding: 20px; &#125;&lt;/style&gt;&lt;div&gt;&lt;/div&gt; å¦‚å›¾æ‰€ç¤ºï¼šè®¾ç½®ä¸€ä¸ªå®½300px,é«˜400pxçš„divï¼Œborderä¸º5pxï¼Œpaddingå€¼è®¾ä¸º20px. è¿™é‡Œæˆ‘ä»¬ä¼šå‘ç°æ˜æ˜æˆ‘ä»¬è®¾ç½®äº†300*400é•¿å®½æ¯”ï¼Œä¸ºä»€ä¹ˆå‘ˆç°å‡ºæ¥çš„æ˜¯ä¸€ä¸ª350*450çš„ç›’å­å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªå›¾ï¼š åœ¨è¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬å‘ç°æˆ‘ä»¬è®¾ç½®çš„300*400å‡ºç°åœ¨äº†æœ€é‡Œé¢çš„é‚£ä¸ªè“æ¡†ä¸­ï¼Œä¸æ­¤åŒæ—¶æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨è¿™ä¸ªç›’æ¨¡å‹ä¸­é™¤äº†æˆ‘ä»¬è®¾ç½®çš„å†…å®¹ï¼ˆcontentï¼‰ï¼Œè¿˜æœ‰marginï¼ˆå¤–è¾¹è·ï¼‰ã€borderï¼ˆè¾¹æ¡†ï¼‰ã€paddingï¼ˆå†…è¾¹æ¡†ï¼‰ margin(å¤–è¾¹è·) - æ¸…é™¤è¾¹æ¡†å¤–çš„åŒºåŸŸï¼Œå¤–è¾¹è·æ˜¯é€æ˜çš„ã€‚border(è¾¹æ¡†) - å›´ç»•åœ¨å†…è¾¹è·å’Œå†…å®¹å¤–çš„è¾¹æ¡†ã€‚padding(å†…è¾¹è·) - æ¸…é™¤å†…å®¹å‘¨å›´çš„åŒºåŸŸï¼Œå†…è¾¹è·æ˜¯é€æ˜çš„ã€‚content(å†…å®¹) - ç›’å­çš„å†…å®¹ï¼Œæ˜¾ç¤ºæ–‡æœ¬å’Œå›¾åƒã€‚ ä¸ºäº†æ­£ç¡®è®¾ç½®å…ƒç´ åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­çš„å®½åº¦å’Œé«˜åº¦ï¼Œä½ éœ€è¦çŸ¥é“ç›’æ¨¡å‹æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ è€Œæˆ‘ä»¬åœ¨æµ‹è¯•æ•ˆæœå›¾çœ‹åˆ°çš„350*450ç›’å­ï¼Œ 350ï¼ˆwidthï¼‰ = 300ï¼ˆcontentï¼‰ + 20ï¼ˆpaddingï¼‰* 2 + 5ï¼ˆborderï¼‰* 2450ï¼ˆheightï¼‰= 400 ï¼ˆcontentï¼‰+ 20ï¼ˆpaddingï¼‰* 2 + 5ï¼ˆborderï¼‰* 2 cssçš„ä¸¤ç§ç›’å­æ¨¡å‹cssçš„ä¸¤ç§ç›’å­æ¨¡å‹ä¸åŒ W3Cçš„æ ‡å‡†ç›’æ¨¡å‹ åœ¨æ ‡å‡†çš„ç›’å­æ¨¡å‹ä¸­ï¼ŒwidthæŒ‡contentéƒ¨åˆ†çš„å®½åº¦ IEçš„ç›’æ¨¡å‹ åœ¨IEç›’å­æ¨¡å‹ä¸­ï¼Œwidthè¡¨ç¤ºcontent+padding+borderè¿™ä¸‰ä¸ªéƒ¨åˆ†çš„å®½åº¦ æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæˆ‘ä»¬ä¸Šé¢çš„ä½¿ç”¨çš„é»˜è®¤æ­£æ˜¯W3Cæ ‡å‡†ç›’æ¨¡å‹ ç›’å­æ¨¡å‹ç±»å‹çš„åˆ‡æ¢å¦‚æœæƒ³è¦åˆ‡æ¢ç›’æ¨¡å‹ä¹Ÿå¾ˆç®€å•ï¼Œè¿™é‡Œéœ€è¦å€ŸåŠ©css3çš„box-sizingå±æ€§ box-sizing: content-box æ˜¯W3Cç›’å­æ¨¡å‹ box-sizing: border-box æ˜¯IEç›’å­æ¨¡å‹ box-sizingçš„é»˜è®¤å±æ€§æ˜¯content-box","tags":["Css","ç›’å­æ¨¡å‹"],"categories":["Css"]},{"title":"å›æµå’Œé‡ç»˜(é‡æ’)","path":"/2020/03/24/å›æµå’Œé‡ç»˜-é‡æ’/","content":"å›æµå’Œé‡ç»˜ æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶","tags":["å›æµå’Œé‡ç»˜","æµè§ˆå™¨çš„æ¸²æŸ“æœºåˆ¶"],"categories":["æµè§ˆå™¨"]},{"title":"å¦‚ä½•ç”»ä¸€ä¸ªä¸‰è§’å½¢","path":"/2020/03/23/å¦‚ä½•ç”»ä¸€ä¸ªä¸‰è§’å½¢/","content":"ç”¨csså¦‚ä½•ç”»ä¸€ä¸ªä¸‰è§’å½¢ï¼Ÿ1234567891011&lt;style&gt; div &#123; width: 0; height: 0; border-top: 10px solid green; border-bottom: 10px solid transparent; border-left: 10px solid transparent; border-right: 10px solid transparent; &#125;&lt;/style&gt;&lt;div/&gt; ä¸‰è§’å½¢åŸç†ï¼šè¾¹æ¡†çš„å‡åˆ†åŸç†","tags":["Css"],"categories":["Css"]},{"title":"HTTPå¸¸ç”¨è¯·æ±‚å¤´","path":"/2020/03/23/HTTPå¸¸ç”¨è¯·æ±‚å¤´/","content":"å¸¸ç”¨è¯·æ±‚å¤´ åè®®å¤´ è¯´æ˜ Accept å¯æ¥å—çš„å“åº”å†…å®¹ç±»å‹ï¼ˆContent-Typesï¼‰ã€‚ Accept-Charset å¯æ¥å—çš„å­—ç¬¦é›† Accept-Encoding å¯æ¥å—çš„å“åº”å†…å®¹çš„ç¼–ç æ–¹å¼ã€‚ Accept-Language å¯æ¥å—çš„å“åº”å†…å®¹è¯­è¨€åˆ—è¡¨ã€‚ Accept-Datetime å¯æ¥å—çš„æŒ‰ç…§æ—¶é—´æ¥è¡¨ç¤ºçš„å“åº”å†…å®¹ç‰ˆæœ¬ Authorization ç”¨äºè¡¨ç¤ºHTTPåè®®ä¸­éœ€è¦è®¤è¯èµ„æºçš„è®¤è¯ä¿¡æ¯ Cache-Control ç”¨æ¥æŒ‡å®šå½“å‰çš„è¯·æ±‚/å›å¤ä¸­çš„ï¼Œæ˜¯å¦ä½¿ç”¨ç¼“å­˜æœºåˆ¶ã€‚ Connection å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰æƒ³è¦ä¼˜å…ˆä½¿ç”¨çš„è¿æ¥ç±»å‹ Cookie ç”±ä¹‹å‰æœåŠ¡å™¨é€šè¿‡Set-Cookieï¼ˆè§ä¸‹æ–‡ï¼‰è®¾ç½®çš„ä¸€ä¸ªHTTPåè®®Cookie Content-Length ä»¥8è¿›åˆ¶è¡¨ç¤ºçš„è¯·æ±‚ä½“çš„é•¿åº¦ Content-MD5 è¯·æ±‚ä½“çš„å†…å®¹çš„äºŒè¿›åˆ¶ MD5 æ•£åˆ—å€¼ï¼ˆæ•°å­—ç­¾åï¼‰ï¼Œä»¥ Base64 ç¼–ç çš„ç»“æœ Content-Type è¯·æ±‚ä½“çš„MIMEç±»å‹ ï¼ˆç”¨äºPOSTå’ŒPUTè¯·æ±‚ä¸­ï¼‰ Date å‘é€è¯¥æ¶ˆæ¯çš„æ—¥æœŸå’Œæ—¶é—´ï¼ˆä»¥RFC 7231ä¸­å®šä¹‰çš„â€HTTPæ—¥æœŸâ€æ ¼å¼æ¥å‘é€ï¼‰ Expect è¡¨ç¤ºå®¢æˆ·ç«¯è¦æ±‚æœåŠ¡å™¨åšå‡ºç‰¹å®šçš„è¡Œä¸º From å‘èµ·æ­¤è¯·æ±‚çš„ç”¨æˆ·çš„é‚®ä»¶åœ°å€ Host è¡¨ç¤ºæœåŠ¡å™¨çš„åŸŸåä»¥åŠæœåŠ¡å™¨æ‰€ç›‘å¬çš„ç«¯å£å·ã€‚å¦‚æœæ‰€è¯·æ±‚çš„ç«¯å£æ˜¯å¯¹åº”çš„æœåŠ¡çš„æ ‡å‡†ç«¯å£ï¼ˆ80ï¼‰ï¼Œåˆ™ç«¯å£å·å¯ä»¥çœç•¥ã€‚ If-Match ä»…å½“å®¢æˆ·ç«¯æä¾›çš„å®ä½“ä¸æœåŠ¡å™¨ä¸Šå¯¹åº”çš„å®ä½“ç›¸åŒ¹é…æ—¶ï¼Œæ‰è¿›è¡Œå¯¹åº”çš„æ“ä½œã€‚ä¸»è¦ç”¨äºåƒ PUT è¿™æ ·çš„æ–¹æ³•ä¸­ï¼Œä»…å½“ä»ç”¨æˆ·ä¸Šæ¬¡æ›´æ–°æŸä¸ªèµ„æºåï¼Œè¯¥èµ„æºæœªè¢«ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œæ‰æ›´æ–°è¯¥èµ„æºã€‚ If-Modified-Since å…è®¸åœ¨å¯¹åº”çš„èµ„æºæœªè¢«ä¿®æ”¹çš„æƒ…å†µä¸‹è¿”å›304æœªä¿®æ”¹ If-None-Match å…è®¸åœ¨å¯¹åº”çš„å†…å®¹æœªè¢«ä¿®æ”¹çš„æƒ…å†µä¸‹è¿”å›304æœªä¿®æ”¹ï¼ˆ 304 Not Modified ï¼‰ï¼Œå‚è€ƒ è¶…æ–‡æœ¬ä¼ è¾“åè®® çš„å®ä½“æ ‡è®° If-Range å¦‚æœè¯¥å®ä½“æœªè¢«ä¿®æ”¹è¿‡ï¼Œåˆ™å‘è¿”å›æ‰€ç¼ºå°‘çš„é‚£ä¸€ä¸ªæˆ–å¤šä¸ªéƒ¨åˆ†ã€‚å¦åˆ™ï¼Œè¿”å›æ•´ä¸ªæ–°çš„å®ä½“ If-Unmodified-Since ä»…å½“è¯¥å®ä½“è‡ªæŸä¸ªç‰¹å®šæ—¶é—´ä»¥æ¥æœªè¢«ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œæ‰å‘é€å›åº”ã€‚ Max-Forwards é™åˆ¶è¯¥æ¶ˆæ¯å¯è¢«ä»£ç†åŠç½‘å…³è½¬å‘çš„æ¬¡æ•°ã€‚ Origin å‘èµ·ä¸€ä¸ªé’ˆå¯¹è·¨åŸŸèµ„æºå…±äº«çš„è¯·æ±‚ï¼ˆè¯¥è¯·æ±‚è¦æ±‚æœåŠ¡å™¨åœ¨å“åº”ä¸­åŠ å…¥ä¸€ä¸ªAccess-Control-Allow-Originçš„æ¶ˆæ¯å¤´ï¼Œè¡¨ç¤ºè®¿é—®æ§åˆ¶æ‰€å…è®¸çš„æ¥æºï¼‰ã€‚ Pragma ä¸å…·ä½“çš„å®ç°ç›¸å…³ï¼Œè¿™äº›å­—æ®µå¯èƒ½åœ¨è¯·æ±‚/å›åº”é“¾ä¸­çš„ä»»ä½•æ—¶å€™äº§ç”Ÿã€‚ Proxy-Authorization ç”¨äºå‘ä»£ç†è¿›è¡Œè®¤è¯çš„è®¤è¯ä¿¡æ¯ã€‚ Range è¡¨ç¤ºè¯·æ±‚æŸä¸ªå®ä½“çš„ä¸€éƒ¨åˆ†ï¼Œå­—èŠ‚åç§»ä»¥0å¼€å§‹ã€‚ Referer è¡¨ç¤ºæµè§ˆå™¨æ‰€è®¿é—®çš„å‰ä¸€ä¸ªé¡µé¢ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¹‹å‰è®¿é—®é¡µé¢çš„é“¾æ¥å°†æµè§ˆå™¨å¸¦åˆ°äº†å½“å‰é¡µé¢ã€‚Refererå…¶å®æ˜¯Referrerè¿™ä¸ªå•è¯ï¼Œä½†RFCåˆ¶ä½œæ ‡å‡†æ—¶ç»™æ‹¼é”™äº†ï¼Œåæ¥ä¹Ÿå°±å°†é”™å°±é”™ä½¿ç”¨Refereräº†ã€‚ TE æµè§ˆå™¨é¢„æœŸæ¥å—çš„ä¼ è¾“æ—¶çš„ç¼–ç æ–¹å¼ï¼šå¯ä½¿ç”¨å›åº”åè®®å¤´Transfer-Encodingä¸­çš„å€¼ï¼ˆè¿˜å¯ä»¥ä½¿ç”¨â€trailersâ€è¡¨ç¤ºæ•°æ®ä¼ è¾“æ—¶çš„åˆ†å—æ–¹å¼ï¼‰ç”¨æ¥è¡¨ç¤ºæµè§ˆå™¨å¸Œæœ›åœ¨æœ€åä¸€ä¸ªå¤§å°ä¸º0çš„å—ä¹‹åè¿˜æ¥æ”¶åˆ°ä¸€äº›é¢å¤–çš„å­—æ®µã€‚ User-Agent æµè§ˆå™¨çš„èº«ä»½æ ‡è¯†å­—ç¬¦ä¸² Upgrade è¦æ±‚æœåŠ¡å™¨å‡çº§åˆ°ä¸€ä¸ªé«˜ç‰ˆæœ¬åè®®ã€‚ Via å‘Šè¯‰æœåŠ¡å™¨ï¼Œè¿™ä¸ªè¯·æ±‚æ˜¯ç”±å“ªäº›ä»£ç†å‘å‡ºçš„ã€‚ Warning ä¸€ä¸ªä¸€èˆ¬æ€§çš„è­¦å‘Šï¼Œè¡¨ç¤ºåœ¨å®ä½“å†…å®¹ä½“ä¸­å¯èƒ½å­˜åœ¨é”™è¯¯ã€‚","tags":["http"],"categories":["æœåŠ¡å™¨ç«¯"]},{"title":"HTTPè¿”å›çŠ¶æ€ç ","path":"/2020/03/23/HTTPè¿”å›çŠ¶æ€ç /","content":"çŠ¶æ€ç 100 Continue ç»§ç»­ã€‚å®¢æˆ·ç«¯åº”ç»§ç»­å…¶è¯·æ±‚ 101 Switching Protocols åˆ‡æ¢åè®®ã€‚æœåŠ¡å™¨æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ‡æ¢åè®®ã€‚åªèƒ½åˆ‡æ¢åˆ°æ›´é«˜çº§çš„åè®®ï¼Œä¾‹å¦‚ï¼Œåˆ‡æ¢åˆ°HTTPçš„æ–°ç‰ˆæœ¬åè®® 200 OK è¯·æ±‚æˆåŠŸã€‚ä¸€èˆ¬ç”¨äºGETä¸POSTè¯·æ±‚ 201 Created å·²åˆ›å»ºã€‚æˆåŠŸè¯·æ±‚å¹¶åˆ›å»ºäº†æ–°çš„èµ„æº 202 Accepted å·²æ¥å—ã€‚å·²ç»æ¥å—è¯·æ±‚ï¼Œä½†æœªå¤„ç†å®Œæˆ 203 Non-Authoritative Information éæˆæƒä¿¡æ¯ã€‚è¯·æ±‚æˆåŠŸã€‚ä½†è¿”å›çš„metaä¿¡æ¯ä¸åœ¨åŸå§‹çš„æœåŠ¡å™¨ï¼Œè€Œæ˜¯ä¸€ä¸ªå‰¯æœ¬ 204 No Content æ— å†…å®¹ã€‚æœåŠ¡å™¨æˆåŠŸå¤„ç†ï¼Œä½†æœªè¿”å›å†…å®¹ã€‚åœ¨æœªæ›´æ–°ç½‘é¡µçš„æƒ…å†µä¸‹ï¼Œå¯ç¡®ä¿æµè§ˆå™¨ç»§ç»­æ˜¾ç¤ºå½“å‰æ–‡æ¡£ 205 Reset Content é‡ç½®å†…å®¹ã€‚æœåŠ¡å™¨å¤„ç†æˆåŠŸï¼Œç”¨æˆ·ç»ˆç«¯ï¼ˆä¾‹å¦‚ï¼šæµè§ˆå™¨ï¼‰åº”é‡ç½®æ–‡æ¡£è§†å›¾ã€‚å¯é€šè¿‡æ­¤è¿”å›ç æ¸…é™¤æµè§ˆå™¨çš„è¡¨å•åŸŸ 206 Partial Content éƒ¨åˆ†å†…å®¹ã€‚æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†éƒ¨åˆ†GETè¯·æ±‚ 300 Multiple Choices å¤šç§é€‰æ‹©ã€‚è¯·æ±‚çš„èµ„æºå¯åŒ…æ‹¬å¤šä¸ªä½ç½®ï¼Œç›¸åº”å¯è¿”å›ä¸€ä¸ªèµ„æºç‰¹å¾ä¸åœ°å€çš„åˆ—è¡¨ç”¨äºç”¨æˆ·ç»ˆç«¯ï¼ˆä¾‹å¦‚ï¼šæµè§ˆå™¨ï¼‰é€‰æ‹© 301 Moved Permanently æ°¸ä¹…ç§»åŠ¨ã€‚è¯·æ±‚çš„èµ„æºå·²è¢«æ°¸ä¹…çš„ç§»åŠ¨åˆ°æ–°URIï¼Œè¿”å›ä¿¡æ¯ä¼šåŒ…æ‹¬æ–°çš„URIï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å®šå‘åˆ°æ–°URIã€‚ä»Šåä»»ä½•æ–°çš„è¯·æ±‚éƒ½åº”ä½¿ç”¨æ–°çš„URIä»£æ›¿ 302 Found ä¸´æ—¶ç§»åŠ¨ã€‚ä¸301ç±»ä¼¼ã€‚ä½†èµ„æºåªæ˜¯ä¸´æ—¶è¢«ç§»åŠ¨ã€‚å®¢æˆ·ç«¯åº”ç»§ç»­ä½¿ç”¨åŸæœ‰URI 303 See Other æŸ¥çœ‹å…¶å®ƒåœ°å€ã€‚ä¸301ç±»ä¼¼ã€‚ä½¿ç”¨GETå’ŒPOSTè¯·æ±‚æŸ¥çœ‹ 304 Not Modified æœªä¿®æ”¹ã€‚æ‰€è¯·æ±‚çš„èµ„æºæœªä¿®æ”¹ï¼ŒæœåŠ¡å™¨è¿”å›æ­¤çŠ¶æ€ç æ—¶ï¼Œä¸ä¼šè¿”å›ä»»ä½•èµ„æºã€‚å®¢æˆ·ç«¯é€šå¸¸ä¼šç¼“å­˜è®¿é—®è¿‡çš„èµ„æºï¼Œé€šè¿‡æä¾›ä¸€ä¸ªå¤´ä¿¡æ¯æŒ‡å‡ºå®¢æˆ·ç«¯å¸Œæœ›åªè¿”å›åœ¨æŒ‡å®šæ—¥æœŸä¹‹åä¿®æ”¹çš„èµ„æº 305 Use Proxy ä½¿ç”¨ä»£ç†ã€‚æ‰€è¯·æ±‚çš„èµ„æºå¿…é¡»é€šè¿‡ä»£ç†è®¿é—® 306 Unused å·²ç»è¢«åºŸå¼ƒçš„HTTPçŠ¶æ€ç  307 Temporary Redirect ä¸´æ—¶é‡å®šå‘ã€‚ä¸302ç±»ä¼¼ã€‚ä½¿ç”¨GETè¯·æ±‚é‡å®šå‘ 400 Bad Request å®¢æˆ·ç«¯è¯·æ±‚çš„è¯­æ³•é”™è¯¯ï¼ŒæœåŠ¡å™¨æ— æ³•ç†è§£ 401 Unauthorized è¯·æ±‚è¦æ±‚ç”¨æˆ·çš„èº«ä»½è®¤è¯ 402 Payment Required ä¿ç•™ï¼Œå°†æ¥ä½¿ç”¨ 403 Forbidden æœåŠ¡å™¨ç†è§£è¯·æ±‚å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æ‰§è¡Œæ­¤è¯·æ±‚ 404 Not Found æœåŠ¡å™¨æ— æ³•æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚æ‰¾åˆ°èµ„æºï¼ˆç½‘é¡µï¼‰ã€‚é€šè¿‡æ­¤ä»£ç ï¼Œç½‘ç«™è®¾è®¡äººå‘˜å¯è®¾ç½®â€æ‚¨æ‰€è¯·æ±‚çš„èµ„æºæ— æ³•æ‰¾åˆ°â€çš„ä¸ªæ€§é¡µé¢ 405 Method Not Allowed å®¢æˆ·ç«¯è¯·æ±‚ä¸­çš„æ–¹æ³•è¢«ç¦æ­¢ 406 Not Acceptable æœåŠ¡å™¨æ— æ³•æ ¹æ®å®¢æˆ·ç«¯è¯·æ±‚çš„å†…å®¹ç‰¹æ€§å®Œæˆè¯·æ±‚ 407 Proxy Authentication Required è¯·æ±‚è¦æ±‚ä»£ç†çš„èº«ä»½è®¤è¯ï¼Œä¸401ç±»ä¼¼ï¼Œä½†è¯·æ±‚è€…åº”å½“ä½¿ç”¨ä»£ç†è¿›è¡Œæˆæƒ 408 Request Time-out æœåŠ¡å™¨ç­‰å¾…å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ—¶é—´è¿‡é•¿ï¼Œè¶…æ—¶ 409 Conflict æœåŠ¡å™¨å®Œæˆå®¢æˆ·ç«¯çš„PUTè¯·æ±‚æ˜¯å¯èƒ½è¿”å›æ­¤ä»£ç ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿäº†å†²çª 410 Gone å®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºå·²ç»ä¸å­˜åœ¨ã€‚410ä¸åŒäº404ï¼Œå¦‚æœèµ„æºä»¥å‰æœ‰ç°åœ¨è¢«æ°¸ä¹…åˆ é™¤äº†å¯ä½¿ç”¨410ä»£ç ï¼Œç½‘ç«™è®¾è®¡äººå‘˜å¯é€šè¿‡301ä»£ç æŒ‡å®šèµ„æºçš„æ–°ä½ç½® 411 Length Required æœåŠ¡å™¨æ— æ³•å¤„ç†å®¢æˆ·ç«¯å‘é€çš„ä¸å¸¦Content-Lengthçš„è¯·æ±‚ä¿¡æ¯ 412 Precondition Failed å®¢æˆ·ç«¯è¯·æ±‚ä¿¡æ¯çš„å…ˆå†³æ¡ä»¶é”™è¯¯ 413 Request Entity Too Large ç”±äºè¯·æ±‚çš„å®ä½“è¿‡å¤§ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†ï¼Œå› æ­¤æ‹’ç»è¯·æ±‚ã€‚ä¸ºé˜²æ­¢å®¢æˆ·ç«¯çš„è¿ç»­è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šå…³é—­è¿æ¥ã€‚å¦‚æœåªæ˜¯æœåŠ¡å™¨æš‚æ—¶æ— æ³•å¤„ç†ï¼Œåˆ™ä¼šåŒ…å«ä¸€ä¸ªRetry-Afterçš„å“åº”ä¿¡æ¯ 414 Request-URI Too Large è¯·æ±‚çš„URIè¿‡é•¿ï¼ˆURIé€šå¸¸ä¸ºç½‘å€ï¼‰ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç† 415 Unsupported Media Type æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚é™„å¸¦çš„åª’ä½“æ ¼å¼ 416 Requested range not satisfiable å®¢æˆ·ç«¯è¯·æ±‚çš„èŒƒå›´æ— æ•ˆ 417 Expectation Failed æœåŠ¡å™¨æ— æ³•æ»¡è¶³Expectçš„è¯·æ±‚å¤´ä¿¡æ¯ 500 Internal Server Error æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚ 501 Not Implemented æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚çš„åŠŸèƒ½ï¼Œæ— æ³•å®Œæˆè¯·æ±‚ 502 Bad Gateway ä½œä¸ºç½‘å…³æˆ–è€…ä»£ç†å·¥ä½œçš„æœåŠ¡å™¨å°è¯•æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œä»è¿œç¨‹æœåŠ¡å™¨æ¥æ”¶åˆ°äº†ä¸€ä¸ªæ— æ•ˆçš„å“åº” 503 Service Unavailable ç”±äºè¶…è½½æˆ–ç³»ç»Ÿç»´æŠ¤ï¼ŒæœåŠ¡å™¨æš‚æ—¶çš„æ— æ³•å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å»¶æ—¶çš„é•¿åº¦å¯åŒ…å«åœ¨æœåŠ¡å™¨çš„Retry-Afterå¤´ä¿¡æ¯ä¸­ 504 Gateway Time-out å……å½“ç½‘å…³æˆ–ä»£ç†çš„æœåŠ¡å™¨ï¼ŒæœªåŠæ—¶ä»è¿œç«¯æœåŠ¡å™¨è·å–è¯·æ±‚ 505 HTTP Version not supported æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚çš„HTTPåè®®çš„ç‰ˆæœ¬ï¼Œæ— æ³•å®Œæˆå¤„ç†","tags":["http"],"categories":["æœåŠ¡å™¨ç«¯"]},{"title":"é¢è¯•é¢˜","path":"/2020/03/23/é¢è¯•é¢˜/","content":"*è¯´ä¸€ä¸‹httpå’Œhttps(1) httpå’Œhttpsçš„æ¦‚å¿µï¼š httpï¼šè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œæ˜¯äº’è”ç½‘ä¸Šä½¿ç”¨å¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ï¼Œæ˜¯ä¸€ç§å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†ï¼ˆTCPçš„æ ‡å‡†ï¼‰ï¼Œæ˜¯ç”¨äºä»wwwæœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ è¾“åè®®ï¼Œå®ƒå¯ä»¥ä½¿æµè§ˆå™¨æ›´åŠ é«˜æ•ˆï¼Œä½¿å¾—ç½‘ç»œä¼ è¾“å‡å°‘ httpsï¼šæ˜¯httpçš„å®‰å…¨ç‰ˆï¼Œhttpä¸‹åŠ å…¥äº†SSLå±‚ï¼ŒHTTPSçš„å®‰å…¨åŸºç¡€æ˜¯SSLï¼Œå› æ­¤åŠ å¯†è¯¦ç»†å†…å®¹å°±éœ€è¦SSLï¼Œhttpsçš„ä½œç”¨å°±æ˜¯å»ºç«‹ä¸€æ¡å®‰å…¨çš„é€šé“ï¼Œæ¥ç¡®ä¿ä¼ è¾“æ•°æ®çš„å®‰å…¨æ€§ï¼Œç®€å•æ¥è¯´httpsåè®®å°±æ˜¯ç”±httpå’Œsslåè®®æ„å»ºçš„å¯è¿›è¡ŒåŠ å¯†ä¼ è¾“å’Œèº«ä»½ç¡®è®¤çš„ç½‘ç»œåè®®ã€‚ (2) httpå’ŒhttpsåŒºåˆ«ï¼š httpséœ€è¦caè¯ä¹¦ï¼Œè´¹ç”¨é«˜ httpæ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä¿¡æ¯æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œhttpsåˆ™æ˜¯å…·æœ‰å®‰å…¨æ€§çš„sslåŠ å¯†ä¼ è¾“åè®®ã€‚ ä½¿ç”¨ä¸åŒé“¾æ¥æ–¹å¼ï¼šç«¯å£ä¸åŒï¼Œhttpæ˜¯80ï¼Œhttpsæ˜¯443 httpè¿æ¥ç®€å•ï¼Œæ— çŠ¶æ€çš„ï¼›httpsæ˜¯ç”±SSL+httpåè®®æ„å»ºçš„æ•°æ®åŠ å¯†ä¼ è¾“èº«ä»½è®¤è¯çš„ç½‘ç»œåè®®ã€‚ (3) httpsåè®®çš„ä¼˜ç‚¹ ç¡®ä¿æ•°æ®çš„ä¼ è¾“å®‰å…¨æ€§å’Œæ­£ç¡®å‘é€åˆ°å¯¹åº”çš„å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ã€‚ åŠ å¯†ä¼ è¾“å’Œèº«ä»½è®¤è¯ä½¿å¾—å…¶åœ¨æ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ä¸­ä¸å®¹æ˜“è¢«çªƒå–æ”¹å˜ï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§ (4) httpsåè®®çš„ç¼ºç‚¹ æ¡æ‰‹é˜¶æ®µæ¯”è¾ƒè´¹æ—¶ ç¼“å­˜æ•ˆç‡ä¸é«˜ï¼Œå¢åŠ æ•°æ®å¼€é”€ SLLåè®®è¦é’± SLLéœ€è¦ç»‘å®šIPï¼Œä¸€ä¸ªIPä¸èƒ½ç»‘å®šå¤šä¸ªåŸŸå *TCPä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸€å¥è¯æ¦‚æ‹¬å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½éœ€è¦ç›´åˆ°å„è‡ªå¯æ”¶å‘ï¼Œå› æ­¤éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ã€‚ ç®€åŒ–ä¸‰æ¬¡æ¡æ‰‹ï¼š 1&lt;imgÂ width=&quot;487&quot;Â alt=&quot;2018-07-10Â 3Â 42Â 11&quot;Â src=&quot;https://user-images.githubusercontent.com/17233651/42496289-1c6d668a-8458-11e8-98b3-65db50f64d48.png&quot;&gt; ä»å›¾ç‰‡å¯ä»¥å¾—åˆ°ä¸‰æ¬¡æ¡æ‰‹å¯ä»¥ç®€åŒ–ä¸ºï¼šCå‘èµ·è¯·æ±‚è¿æ¥Sç¡®è®¤ï¼Œä¹Ÿå‘èµ·è¿æ¥Cç¡®è®¤æˆ‘ä»¬å†çœ‹çœ‹æ¯æ¬¡æ¡æ‰‹çš„ä½œç”¨ï¼šç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šSåªå¯ä»¥ç¡®è®¤ è‡ªå·±å¯ä»¥æ¥å—Cå‘é€çš„æŠ¥æ–‡æ®µï¼Œç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šCå¯ä»¥ç¡®è®¤ Sæ”¶åˆ°äº†è‡ªå·±å‘é€çš„æŠ¥æ–‡æ®µï¼Œå¹¶ä¸”å¯ä»¥ç¡®è®¤ è‡ªå·±å¯ä»¥æ¥å—Så‘é€çš„æŠ¥æ–‡æ®µç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šSå¯ä»¥ç¡®è®¤ Cæ”¶åˆ°äº†è‡ªå·±å‘é€çš„æŠ¥æ–‡æ®µã€‚ TCPå’ŒUDPçš„åŒºåˆ« TCPæ˜¯é¢å‘è¿æ¥çš„ï¼ŒUDPæ˜¯æ— è¿æ¥çš„ï¼Œå°±æ˜¯å‘é€è¿æ¥ä¹‹å‰ä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥ TCPæä¾›å¯é çš„æœåŠ¡ã€‚é€šè¿‡TCPä¼ è¾“çš„æ•°æ®ï¼Œæ— å·®é”™ï¼Œä¸ä¸¢å¤±ï¼Œä¸é‡å¤ï¼ŒæŒ‰åºåˆ°è¾¾ã€‚UDPå°½æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œä¸ä¿è¯å¯é çš„äº¤ä»˜ã€‚å› ä¸ºTCPå¯é ä¸”é¢å‘è¿æ¥ï¼Œä¸ä¼šä¸¢å¤±æ•°æ®å› æ­¤é€‚åˆå¤§æ•°æ®é‡çš„äº¤æ¢ã€‚ TCPæ˜¯é¢å‘å­—èŠ‚æµï¼ŒUDPé¢å‘æŠ¥æ–‡ï¼Œå¦‚æœç½‘ç»œæ•…éšœå‡ºç°æ‹¥å¡ä¸ä¼šä½¿å¾—å‘é€é€Ÿç‡é™ä½ï¼Œä¼šå‡ºç°ä¸¢åŒ…ã€‚ TCPåªèƒ½1å¯¹1ï¼ŒUDPèƒ½å¤Ÿ1å¯¹1ï¼Œ1å¯¹å¤š TCPé¦–éƒ¨è¾ƒå¤§çš„å­—èŠ‚ä¸º20å­—èŠ‚ï¼ŒUDPåªæœ‰8å­—èŠ‚ TCPæ˜¯é¢å‘è¿æ¥çš„å¯é æ€§ä¼ è¾“ï¼Œè€ŒUDPæ˜¯ä¸å¯é çš„ ä¸€ä¸ªå›¾ç‰‡urlè®¿é—®åç›´æ¥ä¸‹è½½æ€æ ·å®ç°ï¼Ÿå‚è€ƒå›ç­”ï¼šè¯·æ±‚çš„è¿”å›å¤´é‡Œé¢ï¼Œç”¨äºæµè§ˆå™¨è§£æçš„é‡è¦å‚æ•°å°±æ˜¯OSSçš„APIæ–‡æ¡£é‡Œé¢çš„è¿”å›httpå¤´ï¼Œå†³å®šç”¨æˆ·ä¸‹è½½è¡Œä¸ºçš„å‚æ•°ã€‚ ä¸‹è½½çš„æƒ…å†µä¸‹ï¼š \\1. x-oss-object-type: Normal \\2. x-oss-request-id: 598D5ED34F29D01FE2925F41 \\3. x-oss-storage-class: Standard httpè¿”å›çš„çŠ¶æ€ç HTTPè¿”å›çš„çŠ¶æ€ç  httpå¸¸ç”¨è¯·æ±‚å¤´HTTPå¸¸ç”¨è¯·æ±‚å¤´ å‡ ä¸ªå¾ˆå®ç”¨çš„BOMå±æ€§å¯¹è±¡æ–¹æ³•?è¯´ä¸€ä¸‹http2.0http2.0æ˜¯åŸºäºhttp1.0ä¹‹åçš„é¦–æ¬¡æ›´æ–° æå‡äº†è®¿é—®çš„é€Ÿç‡ï¼šç›¸æ¯”è¾ƒäºHTTP1.0è¯·æ±‚èµ„æºæ‰€éœ€è¦çš„æ—¶é—´æ›´å°‘ï¼Œè®¿é—®çš„é€Ÿåº¦æ›´å¿« å…è®¸å¤šè·¯å¤ç”¨ï¼šå¤šè·¯å¤ç”¨å…è®¸åŒæ—¶é€šè¿‡å•ä¸€çš„HTTP/2è¿æ¥å‘é€å¤šé‡è¯·æ±‚-å“åº”ä¿¡æ¯ äºŒè¿›åˆ¶åˆ†å¸§ï¼šåœ¨http2.0ä¼šå°†æ‰€æœ‰çš„ä¼ è¾“ä¿¡æ¯åˆ†å‰²ä¸ºæ›´å°çš„ä¿¡æ¯æˆ–è€…å¸§ï¼Œå¹¶ä¸”å¯¹ä»–ä»¬è¿›è¡ŒäºŒè¿›åˆ¶ç¼–ç çš„é¦–éƒ¨å‹ç¼© *åœ¨åœ°å€æ é‡Œè¾“å…¥ä¸€ä¸ªURL,åˆ°è¿™ä¸ªé¡µé¢å‘ˆç°å‡ºæ¥ï¼Œä¸­é—´ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ é¦–å…ˆéœ€è¦æ‰¾åˆ°è¿™ä¸ªURLåŸŸåçš„æœåŠ¡å™¨IPï¼Œæµè§ˆå™¨é¦–å…ˆä¼šå¯»æ‰¾ç¼“å­˜ï¼ŒæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰è®°å½•ï¼ˆæµè§ˆå™¨ç¼“å­˜ -&gt; ç³»ç»Ÿç¼“å­˜ -&gt; è·¯ç”±å™¨ç¼“å­˜ ï¼‰ï¼Œç¼“å­˜ä¸­æ²¡åˆ™å»æŸ¥æ‰¾ç³»ç»Ÿçš„hostsæ–‡ä»¶è®°å½•ï¼Œå¦‚æœå†æ²¡æœ‰å°±å»æŸ¥è¯¢DNSæœåŠ¡å™¨ã€‚ æµè§ˆå™¨æ ¹æ®å¾—åˆ°çš„IPä»¥åŠç›¸åº”çš„ç«¯å£å·ï¼Œæ„å»ºä¸€ä¸ªHTTPè¯·æ±‚ï¼Œå¹¶å°†è¿™ä¸ªHTTPè¯·æ±‚å°è£…åœ¨ä¸€ä¸ªTCPåŒ…ä¸­ï¼Œå‘é€ç»™æœåŠ¡å™¨ï¼ˆä¾æ¬¡ç»è¿‡ä¼ è¾“å±‚ï¼Œç½‘ç»œå±‚ï¼Œæ•°æ®é“¾è·¯å±‚ï¼Œç‰©ç†å±‚ï¼ŒæœåŠ¡å™¨ï¼‰ æœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œè¿”å›ç›¸åº”çš„HTMLç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨æ ¹æ®HTMLæ„å»ºDOMæ ‘ï¼ˆåœ¨domæ ‘çš„æ„å»ºè¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°JSè„šæœ¬å’Œå¤–éƒ¨JSè¿æ¥ï¼Œåˆ™ä¼šåœæ­¢æ„å»ºDOMæ ‘æ¥æ‰§è¡Œå’Œä¸‹è½½ç›¸åº”çš„ä»£ç ï¼Œé€ æˆé˜»å¡ï¼‰ã€‚ ä¹‹åæ ¹æ®å¤–éƒ¨æ ·å¼ï¼Œå†…éƒ¨æ ·å¼ï¼Œå†…è”æ ·å¼å»æ„å»ºä¸€ä¸ªCSSå¯¹è±¡æ¨¡å‹æ ‘å«CSSOMæ ‘ï¼Œæ„å»ºå®Œæˆä¹‹åå’ŒDOMæ ‘åˆå¹¶ä¸ºæ¸²æŸ“æ ‘ï¼ˆ è¿™é‡Œä¸»è¦åšçš„æ˜¯æ’é™¤éè§†è§‰èŠ‚ç‚¹ï¼Œæ¯”å¦‚scriptï¼Œmetaæ ‡ç­¾å’Œæ’é™¤displayä¸ºnoneçš„èŠ‚ç‚¹ ï¼‰ è¿›è¡Œå¸ƒå±€ï¼Œç¡®å®šå„ä¸ªå…ƒç´ ä½ç½®å’Œå°ºå¯¸ æ¸²æŸ“é¡µé¢ã€‚ï¼ˆ å› ä¸ºhtmlæ–‡ä»¶ä¸­ä¼šå«æœ‰å›¾ç‰‡ï¼Œè§†é¢‘ï¼ŒéŸ³é¢‘ç­‰èµ„æºï¼Œåœ¨è§£æDOMçš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°è¿™äº›éƒ½ä¼šè¿›è¡Œå¹¶è¡Œä¸‹è½½ï¼Œæµè§ˆå™¨å¯¹æ¯ä¸ªåŸŸçš„å¹¶è¡Œä¸‹è½½æ•°é‡æœ‰ä¸€å®šçš„é™åˆ¶ï¼Œä¸€èˆ¬æ˜¯4-6ä¸ªï¼Œå½“ç„¶åœ¨è¿™äº›æ‰€æœ‰çš„è¯·æ±‚ä¸­æˆ‘ä»¬è¿˜éœ€è¦å…³æ³¨çš„å°±æ˜¯ç¼“å­˜ï¼Œç¼“å­˜ä¸€èˆ¬é€šè¿‡Cache-Controlã€Last-Modifyã€Expiresç­‰é¦–éƒ¨å­—æ®µæ§åˆ¶ã€‚ Cache-Controlå’ŒExpiresçš„åŒºåˆ«åœ¨äºCache-Controlä½¿ç”¨ç›¸å¯¹æ—¶é—´ï¼ŒExpiresä½¿ç”¨çš„æ˜¯åŸºäºæœåŠ¡å™¨ ç«¯çš„ç»å¯¹æ—¶é—´ï¼Œå› ä¸ºå­˜åœ¨æ—¶å·®é—®é¢˜ï¼Œä¸€èˆ¬é‡‡ç”¨Cache-Controlï¼Œåœ¨è¯·æ±‚è¿™äº›æœ‰è®¾ç½®äº†ç¼“å­˜çš„æ•°æ®æ—¶ï¼Œä¼šå…ˆ æŸ¥çœ‹æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœæ²¡æœ‰è¿‡æœŸåˆ™ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œè¿‡æœŸåˆ™è¯·æ±‚å¹¶åœ¨æœåŠ¡å™¨æ ¡éªŒæ–‡ä»¶æ˜¯å¦ä¿®æ”¹ï¼Œå¦‚æœä¸Šä¸€æ¬¡ å“åº”è®¾ç½®äº†ETagå€¼ä¼šåœ¨è¿™æ¬¡è¯·æ±‚çš„æ—¶å€™ä½œä¸ºIf-None-Matchçš„å€¼äº¤ç»™æœåŠ¡å™¨æ ¡éªŒï¼Œå¦‚æœä¸€è‡´ï¼Œç»§ç»­æ ¡éªŒ Last-Modifiedï¼Œæ²¡æœ‰è®¾ç½®ETagåˆ™ç›´æ¥éªŒè¯Last-Modifiedï¼Œå†å†³å®šæ˜¯å¦è¿”å›304 ï¼‰ æµè§ˆå™¨ç¼“å­˜å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼šæ·±å…¥ç†è§£æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶ æ¸²æŸ“æœºåˆ¶å¯ä»¥çœ‹ï¼šæ·±å…¥æµ…å‡ºæµè§ˆå™¨æ¸²æŸ“åŸç† GETå’ŒPOSTçš„åŒºåˆ«å‚è€ƒå›ç­”ï¼š getå‚æ•°é€šè¿‡urlä¼ é€’ï¼Œpostæ”¾åœ¨request bodyä¸­ã€‚ getè¯·æ±‚åœ¨urlä¸­ä¼ é€’çš„å‚æ•°æ˜¯æœ‰é•¿åº¦é™åˆ¶çš„ï¼Œè€Œpostæ²¡æœ‰ã€‚ getæ¯”postæ›´ä¸å®‰å…¨ï¼Œå› ä¸ºå‚æ•°ç›´æ¥æš´éœ²åœ¨urlä¸­ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨æ¥ä¼ é€’æ•æ„Ÿä¿¡æ¯ã€‚ getè¯·æ±‚åªèƒ½è¿›è¡Œurlç¼–ç ï¼Œè€Œpostæ”¯æŒå¤šç§ç¼–ç æ–¹å¼ getè¯·æ±‚ä¼šæµè§ˆå™¨ä¸»åŠ¨cacheï¼Œè€Œpostæ”¯æŒå¤šç§ç¼–ç æ–¹å¼ã€‚ getè¯·æ±‚å‚æ•°ä¼šè¢«å®Œæ•´ä¿ç•™åœ¨æµè§ˆå†å²è®°å½•é‡Œï¼Œè€Œpostä¸­çš„å‚æ•°ä¸ä¼šè¢«ä¿ç•™ã€‚ GETå’ŒPOSTæœ¬è´¨ä¸Šå°±æ˜¯TCPé“¾æ¥ï¼Œå¹¶æ— å·®åˆ«ã€‚ä½†æ˜¯ç”±äºHTTPçš„è§„å®šå’Œæµè§ˆå™¨/æœåŠ¡å™¨çš„é™åˆ¶ï¼Œå¯¼è‡´ä»–ä»¬åœ¨åº”ç”¨è¿‡ç¨‹ä¸­ä½“ç°å‡ºä¸€äº›ä¸åŒã€‚ GETäº§ç”Ÿä¸€ä¸ªTCPæ•°æ®åŒ…ï¼›POSTäº§ç”Ÿä¸¤ä¸ªTCPæ•°æ®åŒ…ã€‚ *Cookieã€sessionStorageã€localStorageçš„åŒºåˆ«å…±åŒç‚¹ï¼šéƒ½æ˜¯ä¿å­˜åœ¨æµè§ˆå™¨ç«¯ï¼Œå¹¶ä¸”æ˜¯åŒæºçš„ ä¸åŒç‚¹ï¼š å­˜å‚¨ç¯å¢ƒå’Œå¤§å°: cookieæ•°æ®å§‹ç»ˆåœ¨åŒæºçš„HTTPè¯·æ±‚ä¸­æºå¸¦ï¼ˆå³ä¾¿æ˜¯ä¸éœ€è¦ï¼‰ï¼Œå³cookieåœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´æ¥å›ä¼ é€’ï¼Œcookieçš„æ•°æ®è¿˜æœ‰è·¯å¾„çš„æ¦‚å¿µï¼Œå¯ä»¥é™åˆ¶cookieåªå±äºæŸä¸ªè·¯åŠ²ä¸‹ï¼Œå­˜å‚¨å¤§å°åªæœ‰4kå·¦å³ï¼›sessionStorage å’ŒlocalStorageä¸ä¼šè‡ªåŠ¨æŠŠæ•°æ®å‘é€ç»™æœåŠ¡å™¨ï¼Œä»…åœ¨æœ¬åœ°ç¼“å­˜ï¼Œæ•°æ®é‡éƒ½æ¯”cookieæ¥çš„è¦å¤§çš„å¤š æ•°æ®æŒä¹…æ€§ä¸åŒ: sessionStorageä»…åœ¨å½“å‰æµè§ˆå™¨çª—å£å…³é—­ä¹‹å‰æœ‰æ•ˆæœï¼Œè‡ªç„¶ä¸å¯èƒ½æŒç»­ä¿å­˜ï¼›localstorageå§‹ç»ˆæœ‰æ•ˆï¼Œçª—å£æˆ–è€…æµè§ˆå™¨å…³é—­ä¹Ÿä¸€ç›´ä¿å­˜ï¼Œå› æ­¤ç”¨ä½œæŒä¹…æ•°æ®ï¼›cookieåªåœ¨è®¾ç½®çš„cookieè¿‡æœŸæ—¶é—´ä¹‹å‰ä¸€ç›´æœ‰æ•ˆï¼Œå³çª—å£æˆ–æµè§ˆå™¨å…³é—­ã€‚ ï¼ˆkeyï¼šæœ¬èº«å°±æ˜¯ä¸€ä¸ªå›è¯è¿‡ç¨‹ï¼Œå…³é—­æµè§ˆå™¨åæ¶ˆå¤±ï¼Œsessionä¸ºä¸€ä¸ªå›è¯ï¼Œå½“é¡µé¢ä¸åŒå³ä½¿æ˜¯åŒä¸€é¡µé¢æ‰“å¼€ä¸¤æ¬¡ï¼Œä¹Ÿè¢«è§†ä¸ºåŒä¸€æ¬¡å›è¯ï¼‰ ä½œç”¨åŸŸä¸åŒï¼ˆå…±äº«èŒƒå›´ï¼‰ï¼šsessionStorage ä¸åœ¨ä¸åŒçš„æµè§ˆå™¨çª—å£ä¸­å…±äº«ï¼Œå³ä½¿æ˜¯åŒä¸€ä¸ªé¡µé¢ ï¼›localStorageåœ¨æ‰€æœ‰çš„åŒæºçª—å£ä¸­éƒ½æ˜¯å…±äº«çš„ï¼›cookieä¹Ÿæ˜¯åœ¨æ‰€æœ‰çš„åŒæºçª—å£ä¸­éƒ½æ˜¯å…±äº«çš„ã€‚ï¼ˆ åŒæºçª—å£éƒ½ä¼šå…±äº«ï¼Œå¹¶ä¸”ä¸ä¼šå¤±æ•ˆï¼Œä¸ç®¡çª—å£æˆ–è€…æµè§ˆå™¨å…³é—­ä¸å¦éƒ½ä¼šå§‹ç»ˆç”Ÿæ•ˆ ï¼‰ cookieçš„ä½œç”¨ ä¿å­˜ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼š ä¾‹å¦‚å°†ç”¨æˆ·idå­˜å‚¨äºä¸€ä¸ªcookieå†…ï¼Œè¿™æ ·å½“ç”¨æˆ·ä¸‹æ¬¡è®¿é—®è¯¥é¡µé¢æ—¶å°±ä¸éœ€è¦é‡æ–°ç™»å½•äº†ï¼Œç°åœ¨å¾ˆå¤šè®ºå›å’Œç¤¾åŒºéƒ½æä¾›è¿™æ ·çš„åŠŸèƒ½ã€‚ cookieè¿˜å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå½“è¶…è¿‡æ—¶é—´æœŸé™åï¼Œcookieå°±ä¼šè‡ªåŠ¨æ¶ˆå¤±ã€‚å› æ­¤ï¼Œç³»ç»Ÿå¾€å¾€å¯ä»¥æç¤ºç”¨æˆ·ä¿æŒç™»å½•çŠ¶æ€çš„æ—¶é—´ï¼šå¸¸è§é€‰é¡¹æœ‰ä¸€ä¸ªæœˆã€ä¸‰ä¸ª æœˆã€ä¸€å¹´ç­‰ã€‚ è·Ÿè¸ªç”¨æˆ·çš„è¡Œä¸ºï¼š ä¾‹å¦‚ä¸€ä¸ªå¤©æ°”é¢„æŠ¥ç½‘ç«™ï¼Œèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·é€‰æ‹©çš„åœ°åŒºæ˜¾ç¤ºå½“åœ°çš„å¤©æ°”æƒ…å†µã€‚å¦‚æœæ¯æ¬¡éƒ½éœ€è¦é€‰æ‹©æ‰€åœ¨åœ°æ˜¯çƒ¦ççš„ï¼Œå½“åˆ©ç”¨äº†cookieåå°±ä¼šæ˜¾å¾—å¾ˆäººæ€§åŒ–äº†ï¼Œç³»ç»Ÿèƒ½å¤Ÿè®°ä½ä¸Šä¸€æ¬¡è®¿é—®çš„åœ°åŒºï¼Œå½“ä¸‹æ¬¡å†æ‰“å¼€è¯¥é¡µé¢æ—¶ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨æ˜¾ç¤ºä¸Šæ¬¡ç”¨æˆ·æ‰€åœ¨åœ°åŒºçš„å¤©æ°”æƒ…å†µã€‚å› ä¸ºä¸€åˆ‡éƒ½æ˜¯åœ¨å å°å®Œæˆï¼Œæ‰€ä»¥è¿™æ ·çš„é¡µé¢å°±åƒä¸ºæŸä¸ªç”¨æˆ·æ‰€å®šåˆ¶çš„ä¸€æ ·ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿å®šåˆ¶é¡µé¢ã€‚å¦‚æœç½‘ç«™æä¾›äº†æ¢è‚¤æˆ–æ›´æ¢å¸ƒå±€çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨cookieæ¥è®°å½•ç”¨æˆ·çš„é€‰é¡¹ï¼Œä¾‹å¦‚ï¼šèƒŒæ™¯è‰²ã€åˆ†è¾¨ç‡ç­‰ã€‚å½“ç”¨æˆ·ä¸‹æ¬¡è®¿é—®æ—¶ï¼Œä»ç„¶å¯ä»¥ä¿å­˜ä¸Šä¸€æ¬¡è®¿é—®çš„ç•Œé¢é£æ ¼ã€‚","tags":["é¢è¯•é¢˜"],"categories":["é¢è¯•é¢˜"]},{"title":".gitingnoreåŒ¹é…è§„åˆ™ä»¥åŠè¯­æ³•","path":"/2020/03/19/gitingnoreåŒ¹é…è§„åˆ™ä»¥åŠè¯­æ³•/","content":"Gité…ç½® .gitignoreæ–‡ä»¶git å»–é›ªå³°gitæ•™ç¨‹ gitå®˜ç½‘ ä¸€. å¿½ç•¥è§„åˆ™åŒ¹é…è¯­æ³• é€šé…ç¬¦ è¯´æ˜ ç©ºæ ¼ ä»…ä½œä¸ºåˆ†éš”ç¬¦ # æ³¨é‡Š ! ä¸å¿½ç•¥æŸä¸ªæ–‡ä»¶ / å¼€å¤´ ä»…ä»…åŒ¹é…æ ¹ç›®å½• ç»“æŸ / åŒ¹é…è¯¥æ–‡ä»¶å¤¹åŠè¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å†…å®¹ * åŒ¹é…å¤šä¸ªå­—ç¬¦ ** åŒ¹é…å¤šçº§ç›®å½• ï¼Ÿ åŒ¹é…å•ä¸ªå­—ç¬¦ [] åŒ¹é…åŒ…å«å•ä¸ªå­—ç¬¦çš„åˆ—è¡¨ Tips: å½“å‰ç›®å½•å®šä¹‰çš„è§„åˆ™ä¼˜å…ˆçº§é«˜äºçˆ¶çº§ç›®å½•å®šä¹‰çš„è§„åˆ™ æ¯è¡ŒæŒ‡å®šä¸€æ¡å¿½ç•¥è§„åˆ™ å¦‚æœä¸€è¡Œè§„åˆ™ä¸åŒ…å«â€œ/â€ï¼Œåˆ™å®ƒåŒ¹é…å½“å‰.gitignoreæ–‡ä»¶æ‰€åœ¨è·¯å¾„çš„å†…å®¹ äºŒ. åŒ¹é…ç¤ºä¾‹ è§„åˆ™ è¯´æ˜ abc/ # å¿½ç•¥å½“å‰è·¯å¾„ä¸‹çš„ abc æ–‡ä»¶å¤¹ /abc # å¿½ç•¥æ ¹ç›®å½•ä¸‹çš„ abc æ–‡ä»¶ /*.txt # å¿½ç•¥æ ¹ç›®å½•ä¸‹çš„ abc.txtï¼Œä¸å¿½ç•¥ app/abc.txt abc/*.txt # å¿½ç•¥ abc/abc.txtï¼Œä¸å¿½ç•¥ abc/def/abc.txt å’Œ app/abc/abc.txt **/abc # å¿½ç•¥ /abcã€a/abcã€a/b/abc a/**/b # å¿½ç•¥ a/bã€a/x/y/b !/app/abc.txt # ä¸å¿½ç•¥ app ç›®å½•ä¸‹çš„ abc.txt æ–‡ä»¶ *.log # å¿½ç•¥æ‰€æœ‰ .log æ–‡ä»¶ abc.txt #å¿½ç•¥å½“å‰è·¯å¾„ä¸‹çš„ abc.txt æ–‡ä»¶ *abc/ #å¿½ç•¥åè¯ä¸­æœ«å°¾ä¸ºabcçš„æ–‡ä»¶å¤¹ * abc */ #å¿½ç•¥åç§°ä¸­é—´åŒ…å«abcçš„æ–‡ä»¶å¤¹ ä¸‰. .gitignoreæ–‡ä»¶ä¸ç”Ÿæ•ˆ.gitignoreåªèƒ½å¿½ç•¥é‚£äº›åŸæ¥æ²¡æœ‰è¢«trackçš„æ–‡ä»¶ï¼Œå¦‚æœæŸäº›æ–‡ä»¶å·²ç»è¢«çº³å…¥äº†ç‰ˆæœ¬ç®¡ç†ä¸­ï¼Œåˆ™ä¿®æ”¹.gitignoreæ˜¯æ— æ•ˆçš„ã€‚æ‰€ä»¥ä¸€å®šè¦å…»æˆåœ¨é¡¹ç›®å¼€å§‹å°±åˆ›å»º.gitignoreæ–‡ä»¶çš„ä¹ æƒ¯ã€‚ è§£å†³æ–¹æ³•å°±æ˜¯å…ˆæŠŠæœ¬åœ°ç¼“å­˜åˆ é™¤(æ”¹å˜æˆæœªtrackçŠ¶æ€)ï¼Œç„¶åå†æäº¤ï¼š å¦‚æœè¿œç¨‹ä»“åº“åŸæ¥å°±å·²ç»å­˜åœ¨ç°åœ¨.gitignoreè§„åˆ™ä¸­å¿½ç•¥çš„å†…å®¹ï¼Œé‚£ä¹ˆç°åœ¨é‚£äº›è§„åˆ™å¯¹é‚£äº›å†…å®¹æ˜¯æ— æ•ˆçš„ï¼Œå¿…é¡»å…ˆåˆ é™¤æœ¬åœ°ç¼“å­˜ $ git rm -r --cached ä¸è¿‡ï¼Œè¿™æ ·åšè™½ç„¶å¯ä»¥åˆ é™¤è¿œç¨‹ä»“åº“é‡Œè¢« .gitignore è§„åˆ™å¿½ç•¥çš„å†…å®¹ï¼Œä½†æ˜¯è¿™äº›å†…å®¹çš„ git å‹ç¼©ç‰ˆæœ¬ä¾ç„¶è¢«ä¿å­˜åœ¨å¯å›æ»šè®°å½•ä¸­ä»¥å¤‡ä»¥åå›æ»šï¼Œè¿™ä¼šå¯¼è‡´ git ä»“åº“è¿‡å¤§ã€‚è™½ç„¶æœ‰ä¸€äº›åŠæ³•å¯ä»¥ç»™ git ä»“åº“è¿›è¡Œç˜¦èº«ï¼Œä½†æ˜¯æ“ä½œæ¯”è¾ƒç¹çï¼Œéå¸¸çš„ä¸æ¨èã€‚å› æ­¤ï¼Œä¸ªäººè§‰å¾—è¿˜æ˜¯åº”è¯¥æœ‰è‰¯å¥½çš„ git ä½¿ç”¨ä¹ æƒ¯ï¼Œå¯¹äºä¸ç”¨æäº¤åˆ°ä»“åº“çš„å†…å®¹ï¼Œè¦ç¬¬ä¸€æ—¶é—´ç”¨ .gitignore è¿›è¡Œè¿‡æ»¤ã€‚å¯¹äºå ç”¨ç©ºé—´å°çš„å†…å®¹ï¼Œå¯ä»¥ä¸äºˆç†ä¼šï¼Œä½†å¦‚æœæœ‰è¾ƒå¤šã€è¾ƒå¤§æ–‡ä»¶ï¼Œä¸å…‰æ˜¯å äº†å¤ªå¤šçš„è¿œç¨‹ä»“åº“ç©ºé—´å’Œæœ¬åœ°ç©ºé—´ï¼Œå¹¶ä¸”åœ¨ cloneã€push çš„æ—¶å€™ï¼Œä¹Ÿä¼šå› ä¸ºä»“åº“è¿‡å¤§ï¼Œè€Œå½±å“ clone é€Ÿåº¦ã€‚ å››. æ¨¡æ¿java å¼€å‘é€šç”¨ç‰ˆæœ¬æ¨¡æ¿1234567891011121314151617181920212223242526272829303132333435#java*.class#package file*.war*.ear*.zip*.tar.gz*.rar#maven ignoretarget/build/#eclipse ignore.settings/.project.classpatch#Intellij idea.idea//idea/*.ipr*.iml*.iws# temp file*.log*.cache*.diff*.patch*.tmp# system ignore.DS_StoreThumbs.db å‰ç«¯é¡¹ç›®123456789101112131415161718192021222324252627282930313233343536373839404142# Numerous always-ignore extensions*.bak*.patch*.diff*.err # temp file for git conflict merging*.orig*.log*.rej*.swo*.swp*.zip*.vi*~*.sass-cache*.tmp.html*.dump # OS or Editor folders.DS_Store._*.cache.project.settings.tmproj*.esproj*.sublime-project*.sublime-workspacenbprojectthumbs.db*.iml # Folders to ignore.hg.svn.CVS.ideanode_modules/jscoverage_lib/bower_components/dist/","tags":["git"],"categories":["git"]},{"title":"å¸¸ç”¨ç½‘ç«™","path":"/2020/03/19/å¸¸ç”¨ç½‘ç«™/","content":"react reactå®˜æ–¹æ–‡æ¡£](https://reactjs.org/docs/getting-started.html) git å»–é›ªå³°gitæ•™ç¨‹ gitå®˜ç½‘ JavaScript èœé¸Ÿæ•™ç¨‹JSå‚è€ƒæ‰‹å†Œ webpack NPM https://www.npmjs.com/ ç§¦æ«çš„git blog: https://github.com/mqyqingfeng/Blog","tags":["Javascript","React","webpack","git"],"categories":["å¸¸ç”¨ç½‘ç«™"]},{"title":"é¡¹ç›®åˆå§‹åŒ–-HTMLæ¨¡æ¿","path":"/2020/03/18/é¡¹ç›®åˆå§‹åŒ–-HTMLæ¨¡æ¿/","content":"æˆ‘ä»¬åœ¨é¡¹ç›®åˆå§‹åŒ–çš„æ—¶å€™ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªhtmlçš„æ¨¡æ¿ï¼Œé‡Œé¢ä¼šåšå„ç§å…¼å®¹å’Œå£°æ˜ç­‰å·¥ä½œã€‚PCç«¯å¦‚æœéœ€è¦é€‚é…IE8éœ€è¦åŠ å…¥å¾ˆå¤šå«ç‰‡ï¼Œè€Œä¸”è¿˜è¦åšå¥½åŒæ ¸æµè§ˆå™¨çš„ä¼˜å…ˆé€‰æ‹©é…ç½®ç­‰ï¼›Mç«¯æ›´æ˜¯éœ€è¦åšåˆ°ä¸åŒåˆ†è¾¨ç‡å±å¹•çš„é€‚é…ï¼Œå¦å¤–è¿˜æœ‰300mså»¶è¿Ÿé—®é¢˜ã€‚è¿™é‡Œé€ä¸Šç¬”è€…åœ¨é¡¹ç›®å½“ä¸­æ•´ç†çš„ä¸¤ä¸ªæ¨¡æ¿ï¼Œå·²ç»ç»è¿‡äº†ä¸€å®šé¡¹ç›®çš„è€ƒéªŒï¼Œä¾›å¤§å®¶å‚è€ƒã€‚ å¦å¤–ï¼Œæœ¬æ–‡ä¸­æ¶‰åŠçš„Mç«¯é€‚é…å¹¶éremï¼Œè€Œæ˜¯ä¿®æ”¹viewportçš„æ˜¾ç¤ºæ¯”ä¾‹ï¼Œè¿™ä¸ªæ–¹æ¡ˆç›¸è¾ƒremæ¥è¯´èµ·ç æœ‰2ä¸ªä¼˜ç‚¹ï¼šä¸€æ˜¯çœå­—ç¬¦ï¼ŒäºŒæ˜¯ä¸ç”¨è®¡ç®—ï¼Œè®¾è®¡ç¨¿æ˜¯å¤šå°‘å°±æ˜¯å¤šå°‘ã€‚ä¸è¿‡åœ¨å®è·µå½“ä¸­ï¼ŒUCæµè§ˆå™¨è²Œä¼¼ä¸è®¤user-scalabe=0ï¼Œè¿˜æ˜¯ä¼šè¢«åŒå‡»æ”¾å¤§ï¼Œä¸è¿‡ç¬”è€…è®¤ä¸ºè¿˜æ˜¯å¯ä»¥æ¥å—çš„ã€‚å¦‚æœè¿˜é‡åˆ°äº†å…¶ä»–bugï¼Œè¯·åé¦ˆï¼Œè°¢è°¢ã€‚ PCæ¨¡æ¿123456789101112131415161718&lt;!DOCTYPE html&gt;&lt;html lang=&quot;zh&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot; /&gt; &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot; /&gt; &lt;meta name=&quot;renderer&quot; content=&quot;webkit&quot; /&gt; &lt;title&gt;Document&lt;/title&gt;&lt;!--[if lt IE 9]&gt; &lt;script src=&quot;//cdn.staticfile.org/html5shiv/r29/html5.min.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;//cdn.staticfile.org/respond.js/1.4.2/respond.min.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;//cdn.staticfile.org/es5-shim/4.5.9/es5-shim.min.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;//cdn.staticfile.org/es5-shim/4.5.9/es5-sham.min.js&quot;&gt;&lt;/script&gt;&lt;![endif]--&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;//cdn.staticfile.org/normalize/6.0.0/normalize.min.css&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt; Mæ¨¡æ¿1234567891011121314151617181920212223&lt;!DOCTYPE html&gt;&lt;html lang=&quot;zh&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot; /&gt; &lt;meta name=&quot;format-detection&quot; content=&quot;telephone=no&quot; /&gt; &lt;title&gt;Document&lt;/title&gt; &lt;script&gt; (function() &#123; var w = 750; // è®¾è®¡ç¨¿å°ºå¯¸ document.write(&#x27;&lt;meta name=&quot;viewport&quot; content=&quot;width=&#x27; + w + &#x27;, initial-scale=&#x27; + window.screen.width / w + &#x27;, user-scalable=0&quot; /&gt;&#x27;); &#125;)() &lt;/script&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;//cdn.staticfile.org/normalize/6.0.0/normalize.min.css&quot;&gt;&lt;/head&gt;&lt;body&gt; &lt;script src=&quot;//cdn.staticfile.org/fastclick/1.0.6/fastclick.min.js&quot;&gt;&lt;/script&gt; &lt;script&gt; document.addEventListener(&#x27;DOMContentLoaded&#x27;, function() &#123; Origami.fastclick(document.body); &#125;, false); &lt;/script&gt;&lt;/body&gt;&lt;/html&gt; å…¬å…±éƒ¨åˆ†è¯´æ˜1ã€åœ¨ HTML 4.01 ä¸­ï¼Œ&lt;!DOCTYPE&gt; å£°æ˜å¼•ç”¨ DTDï¼Œå› ä¸º HTML 4.01 åŸºäº SGMLã€‚DTD è§„å®šäº†æ ‡è®°è¯­è¨€çš„è§„åˆ™ï¼Œè¿™æ ·æµè§ˆå™¨æ‰èƒ½æ­£ç¡®åœ°å‘ˆç°å†…å®¹ã€‚HTML5 ä¸åŸºäº SGMLï¼Œæ‰€ä»¥ä¸éœ€è¦å¼•ç”¨ DTDã€‚è¯·å§‹ç»ˆå‘ HTML æ–‡æ¡£æ·»åŠ  &lt;!DOCTYPE&gt; å£°æ˜ï¼Œè¿™æ ·æµè§ˆå™¨æ‰èƒ½è·çŸ¥æ–‡æ¡£ç±»å‹ã€‚å®ƒä¸æ˜¯ HTML æ ‡ç­¾ï¼Œæ˜¯æŒ‡ç¤º web æµè§ˆå™¨å…³äºé¡µé¢ä½¿ç”¨å“ªä¸ª HTML ç‰ˆæœ¬è¿›è¡Œç¼–å†™çš„æŒ‡ä»¤ï¼›å¿…é¡»æ˜¯ HTML æ–‡æ¡£çš„ç¬¬ä¸€è¡Œï¼Œä½äº æ ‡ç­¾ä¹‹å‰ï¼Œæ²¡æœ‰ç»“æŸæ ‡ç­¾ï¼Œå¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼›å‚è€ƒæ–‡çŒ®ï¼šhttp://www.w3school.com.cn/tags/tag_doctype.asp 2ã€HTML çš„ lang å±æ€§å¯ç”¨äºç½‘é¡µæˆ–éƒ¨åˆ†ç½‘é¡µçš„è¯­è¨€ã€‚è¿™å¯¹æœç´¢å¼•æ“å’Œæµè§ˆå™¨æ˜¯æœ‰å¸®åŠ©çš„ã€‚æ ¹æ® W3C æ¨èæ ‡å‡†ï¼Œæ‚¨åº”è¯¥é€šè¿‡ æ ‡ç­¾ä¸­çš„ lang å±æ€§å¯¹æ¯å¼ é¡µé¢ä¸­çš„ä¸»è¦è¯­è¨€è¿›è¡Œå£°æ˜ã€‚å‚è€ƒæ–‡çŒ®ï¼šhttp://www.w3school.com.cn/tags/html_ref_language_codes.asp 3ã€å½“ä½ çš„ html æ–‡ä»¶æ˜¯ä»¥ UTF-8 ç¼–ç ä¿å­˜çš„ï¼Œè€Œä¸”é‡Œé¢æœ‰ä¸­æ–‡ï¼Œä½ è¯•è¯•åŠ ä¸ä¸åŠ åœ¨ Chrome çš„æ•ˆæœä½ å°±çŸ¥é“æœ‰æ²¡æœ‰åŒºåˆ«äº† 4ã€å‘Šè¯‰æµè§ˆå™¨æ˜¯å¦è¯†åˆ«ç‰¹å®šæ ¼å¼çš„æ–‡æœ¬ã€‚æ ¹æ®é¡¹ç›®éœ€æ±‚ä¿®æ”¹å€¼ã€‚ PCéƒ¨åˆ†è¯´æ˜1ã€æ§åˆ¶IEæ¸²æŸ“å†…æ ¸çš„é€‰æ‹©ã€‚chrome=1é’ˆå¯¹è£…äº†chrome frameæ’ä»¶çš„IEæµè§ˆå™¨èµ·ä½œç”¨ï¼Œä»¥é˜²ä¸‡ä¸€å†™ä¸Šã€‚å‚è€ƒæ–‡çŒ®ï¼šhttps://msdn.microsoft.com/en-us/library/ff955275(v=vs.85).aspx 2ã€æ§åˆ¶åŒæ ¸æµè§ˆå™¨æ¸²æŸ“å¼•æ“ï¼Œcontentçš„å–å€¼ä¸ºwebkitã€ie-compã€ie-standä¹‹ä¸€ï¼ŒåŒºåˆ†å¤§å°å†™ï¼Œåˆ†åˆ«ä»£è¡¨ç”¨webkitå†…æ ¸ï¼ŒIEå…¼å®¹å†…æ ¸ï¼ŒIEæ ‡å‡†å†…æ ¸ã€‚å‚è€ƒæ–‡çŒ®ï¼šhttp://se.360.cn/v6/help/meta.html 3ã€&lt;!â€“[if lt IE 9]&gt; //code hereå…¼å®¹IE9ä»¥ä¸‹ï¼ˆä¸å«ï¼‰çš„å†™æ³•ï¼Œåªæœ‰IEè®¤ã€‚ï¼ˆä¾‹å­ä¸­jsä¸ºIE9-çš„å«ç‰‡ï¼‰å‚è€ƒæ–‡çŒ®ï¼šhttp://www.weste.net/2013/8-9/93104.html Méƒ¨åˆ†è¯´æ˜1ã€jsè¾“å‡ºviewportç¼©æ”¾å±å¹•ï¼Œé€‚é…ä¸åŒå¤§å°è®¾å¤‡ 1234(function() &#123; var w = 750; //è®¾è®¡ç¨¿è®¾å¤‡å®½åº¦ document.write(&#x27;&lt;meta name=&quot;viewport&quot; content=&quot;width=&#x27; + w + &#x27;, initial-scale=&#x27; + window.screen.width / w + &#x27;, user-scalable=0&quot; /&gt;&#x27;);&#125;)() åŠ å…¥ä»¥ä¸Šä»£ç ï¼Œéœ€ä¿®æ”¹å˜é‡å€¼ä¸ºè®¾è®¡ç¨¿çš„è®¾å¤‡å®½åº¦ï¼Œæ ·å¼å…¨éƒ¨æŒ‰ç…§è®¾è®¡ç¨¿çš„æ•°å€¼å’Œå•ä½å†™å°±å¯ä»¥ã€‚è¯¦è§ï¼šç§»åŠ¨ç«¯å¸¸ç”¨å¸ƒå±€æ–¹æ³•å‚è€ƒæ–‡çŒ®ï¼šhttp://www.cnblogs.com/2050/p/3877280.html 2ã€fastclickè§£å†³iphoneç­‰æ‰‹æœºçš„300mså»¶è¿Ÿé—®é¢˜ 123456&lt;script src=&quot;//st01.chrstatic.com/themes/chr-cdn/fastclick/v1.0.6/fastclick.min.js&quot;&gt;&lt;/script&gt;&lt;script&gt; document.addEventListener(&#x27;DOMContentLoaded&#x27;, function() &#123; Origami.fastclick(document.body); &#125;, false);&lt;/script&gt; å…ˆåŠ è½½fastclick.min.jsï¼Œä¹‹åå°†éœ€è¦å»é™¤300msçš„domæŒ‚ä¸Šï¼Œå‹ç¼©ç‰ˆå†™Origami.fastclick(document.body);ï¼Œéå‹ç¼©ç‰ˆå†™FastClick.attach(document.body);å³å¯å‚è€ƒæ–‡çŒ®ï¼šhttps://github.com/ftlabs/fastclick/","tags":["Html"],"categories":["Html"]},{"title":"é…ç½®å‰ç«¯è„šæ‰‹æ¶çš„æ—¶å€™ç¢°åˆ°çš„é—®é¢˜","path":"/2020/03/18/é…ç½®å‰ç«¯è„šæ‰‹æ¶çš„æ—¶å€™ç¢°åˆ°çš„é—®é¢˜/","content":"è¿™æ®µæ—¶é—´åœ¨è‡ªå·±æ­å»ºå‰ç«¯çš„è„šæ‰‹æ¶ï¼Œé…ç½®å‚ç…§ ä»é›¶æ­å»ºå‰ç«¯å¼€å‘ç¯å¢ƒï¼ˆé›¶ï¼‰â€”â€”åŸºç¡€ç¯‡ï¼š1.npmã€gitåŠé¡¹ç›®åˆå§‹åŒ– ä»é›¶æ­å»ºå‰ç«¯å¼€å‘ç¯å¢ƒï¼ˆé›¶ï¼‰â€”â€”åŸºç¡€ç¯‡ï¼š2.webpackç”Ÿäº§ä¸å¼€å‘ç¯å¢ƒé…ç½® webpackå¼•å…¥jqueryçš„å‡ ç§æ–¹æ³• é…ç½®è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€äº›é—®é¢˜ï¼Œ Cannot find module &#39;@babel/core&#39; babel-loader@8 requires Babel 7.x (the package &#39;@babel/c è§£å†³å¸®åŠ©æ–‡ç« ï¼šbabelå®‰è£…é—®é¢˜ï¼ŒCannot find module â€˜@babel/coreâ€™ babel-loader@8 requires Babel 7.x (the package â€˜@babel/c Error: Cannot find module &#39;webpack/bin/config-yargs è§£å†³å¸®åŠ©æ–‡ç« ï¼šError: Cannot find module â€˜webpack/bin/config-yargsâ€™ æŠ¥é”™åŸå› , webpack@4.Xè¸©çš„å‘~ Error: Loading PostCSS Plugin failed: Cannot find module &#39;autoprefixer&#39;ï¼Œè§£å†³å¸®åŠ©æ–‡ç« ï¼š webpack4 postcss-loader autoprefixeræ— æ•ˆé—®é¢˜ Error: Loading PostCSS Plugin failed: Cannot find module â€˜autoprefixerâ€™ é—®é¢˜æ­£åœ¨å‘ç”Ÿâ€¦","tags":["webpack","Npm"]},{"title":"BFCå—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡","path":"/2020/03/16/BFCå—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡/","content":"å‚è€ƒæ–‡ç«  å‚è€ƒæ–‡ç« 2 ä»€ä¹ˆæ˜¯BFCï¼ŸBFCçš„å…¨ç§°ä¸ºï¼šå—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡(Block Formatting Context) ï¼Œå®ƒæ˜¯å¸ƒå±€è¿‡ç¨‹ä¸­ç”Ÿæˆå—çº§ç›’å­çš„åŒºåŸŸï¼Œä¹Ÿæ˜¯æµ®åŠ¨å…ƒç´ ä¸å…¶ä»–å…ƒç´ çš„äº¤äº’é™å®šåŒºåŸŸã€‚ç®€å•æ¥è¯´ï¼ŒBFCæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¸²æŸ“åŒºåŸŸ å®˜æ–¹è§£é‡Šï¼š ä¸€ä¸ªå—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼ˆblock formatting contextï¼‰ æ˜¯Webé¡µé¢çš„å¯è§†åŒ–CSSæ¸²æŸ“å‡ºçš„ä¸€éƒ¨åˆ†ã€‚å®ƒæ˜¯å—çº§ç›’å¸ƒå±€å‡ºç°çš„åŒºåŸŸï¼Œä¹Ÿæ˜¯æµ®åŠ¨å±‚å…ƒç´ è¿›è¡Œäº¤äº’çš„åŒºåŸŸã€‚ ä¸€ä¸ªå—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ç”±ä»¥ä¸‹ä¹‹ä¸€åˆ›å»ºï¼š æ ¹å…ƒç´ æˆ–å…¶å®ƒåŒ…å«å®ƒçš„å…ƒç´  æµ®åŠ¨å…ƒç´  (å…ƒç´ çš„ float ä¸æ˜¯ none) ç»å¯¹å®šä½å…ƒç´  (å…ƒç´ å…·æœ‰ position ä¸º absolute æˆ– fixed) å†…è”å— (å…ƒç´ å…·æœ‰ display: inline-block) è¡¨æ ¼å•å…ƒæ ¼ (å…ƒç´ å…·æœ‰ display: table-cellï¼ŒHTMLè¡¨æ ¼å•å…ƒæ ¼é»˜è®¤å±æ€§) è¡¨æ ¼æ ‡é¢˜ (å…ƒç´ å…·æœ‰ display: table-caption, HTMLè¡¨æ ¼æ ‡é¢˜é»˜è®¤å±æ€§) å…·æœ‰overflow ä¸”å€¼ä¸æ˜¯ visible çš„å—å…ƒç´ ï¼Œ display: flow-root column-span: all åº”å½“æ€»æ˜¯ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼Œå³ä¾¿å…·æœ‰ column-span: all çš„å…ƒç´ å¹¶ä¸è¢«åŒ…è£¹åœ¨ä¸€ä¸ªå¤šåˆ—å®¹å™¨ä¸­ã€‚ ä¸€ä¸ªå—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡åŒ…æ‹¬åˆ›å»ºå®ƒçš„å…ƒç´ å†…éƒ¨æ‰€æœ‰å†…å®¹ï¼Œé™¤äº†è¢«åŒ…å«äºåˆ›å»ºæ–°çš„å—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡çš„åä»£å…ƒç´ å†…çš„å…ƒç´ ã€‚ å—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡å¯¹äºå®šä½ (å‚è§ float) ä¸æ¸…é™¤æµ®åŠ¨ (å‚è§ clear) å¾ˆé‡è¦ã€‚å®šä½å’Œæ¸…é™¤æµ®åŠ¨çš„æ ·å¼è§„åˆ™åªé€‚ç”¨äºå¤„äºåŒä¸€å—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡å†…çš„å…ƒç´ ã€‚æµ®åŠ¨ä¸ä¼šå½±å“å…¶å®ƒå—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ä¸­å…ƒç´ çš„å¸ƒå±€ï¼Œå¹¶ä¸”æ¸…é™¤æµ®åŠ¨åªèƒ½æ¸…é™¤åŒä¸€å—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ä¸­åœ¨å®ƒå‰é¢çš„å…ƒç´ çš„æµ®åŠ¨ã€‚ æŒ‰ç…§ç»¼ä¸Šæ‰€è¿°çš„è¯ï¼ŒBFCæ˜¯ä¸€ä¸ªhtmlç›’å­ç„¶åå‘¢å¿…é¡»è‡³å°‘æ»¡è¶³ä¸‹åˆ—å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªæ¡ä»¶ floatçš„å€¼ä¸ä¸ºnone positionä¸ä¸ºstaticæˆ–è€…relative displayçš„å€¼ä¸º table-cell, table-caption, inline-block, flex, æˆ–è€… inline-flexä¸­çš„å…¶ä¸­ä¸€ä¸ª overflowçš„å€¼ä¸ä¸ºvisible éµå¾ªè§„åˆ™ BFCåœ¨Webé¡µé¢ä¸Šæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®¹å™¨ï¼Œå®¹å™¨å†…å¤–äº’ä¸å½±å“ å’Œæ ‡å‡†æ–‡æ¡£æµä¸€æ ·ï¼ŒBFCå†…çš„å…ƒç´ å‚ç›´æ–¹å‘çš„è¾¹è·ä¼šå‘ç”Ÿé‡å  BFCä¸ä¼šä¸æµ®åŠ¨å…ƒç´ çš„ç›’å­é‡å  è®¡ç®—BFCé«˜åº¦æ—¶å³ä½¿å­å…ƒç´ æµ®åŠ¨ä¹Ÿå‚ä¸è®¡ç®— å®ç°ä¸€ä¸ªBFC123.container &#123;\toverflow: hidden;&#125; 123&lt;div class=&quot;container&quot;&gt; test BFC&lt;/div&gt; BFCå¸¸è§ä½œç”¨ï¼ˆç‰¹æ€§ï¼ŒåŠŸèƒ½ï¼‰ä¸€. BFCä¸­çš„ç›’å­å¯¹é½ åœ¨BFCä¸­ï¼Œæ¯ä¸ªç›’å­çš„å·¦å¤–è¾¹æ¡†ç´§æŒ¨ç€åŒ…å«å—çš„å·¦è¾¹æ¡†ï¼ˆä»å³åˆ°å·¦çš„æ ¼å¼ï¼Œåˆ™ä¸ºç´§æŒ¨å³è¾¹æ¡†ï¼‰ã€‚å³ä½¿å­˜åœ¨æµ®åŠ¨ä¹Ÿæ˜¯è¿™æ ·çš„ï¼ˆå°½ç®¡ä¸€ä¸ªç›’å­çš„è¾¹æ¡†ä¼šç”±äºæµ®åŠ¨è€Œæ”¶ç¼©ï¼‰ï¼Œé™¤éè¿™ä¸ªç›’å­çš„å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„BFCæµ®åŠ¨ï¼Œç›’å­æœ¬èº«å°†ä¼šå˜å¾—æ›´çª„ï¼‰ã€‚ ç®€å•æ¥è¯´ï¼Œåœ¨ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰å±äºåŒä¸€ä¸ªBFCçš„ç›’å­éƒ½å·¦å¯¹é½ï¼ˆå·¦è‡³å³çš„æ ¼å¼ï¼‰ï¼Œä»–ä»¬çš„å·¦å¤–è¾¹æ¡†ç´§è´´ç€åŒ…å«å—çš„å·¦è¾¹æ¡†ã€‚åœ¨æœ€åä¸€ä¸ªç›’å­é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å°½ç®¡é‚£é‡Œæœ‰ä¸€ä¸ªæµ®åŠ¨å…ƒç´ ï¼ˆæ£•è‰²ï¼‰åœ¨å®ƒçš„å·¦è¾¹ï¼Œå¦ä¸€ä¸ªå…ƒç´ ï¼ˆç»¿è‰²ï¼‰ä»ç„¶ç´§è´´ç€åŒ…å«å—çš„å·¦è¾¹æ¡†ã€‚å…³äºä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§æƒ…å†µçš„åŸç†å°†ä¼šåœ¨ä¸‹é¢çš„æ–‡å­—ç¯ç»•éƒ¨åˆ†è¿›è¡Œè®¨è®º äºŒ. BFCå¯¼è‡´çš„å¤–è¾¹è·æŠ˜å  åœ¨å¸¸è§„æ–‡æ¡£æµä¸­ï¼Œç›’å­éƒ½æ˜¯ä»åŒ…å«å—çš„é¡¶éƒ¨å¼€å§‹ä¸€ä¸ªæ¥ç€ä¸€ä¸ªå‚ç›´å †æ”¾ã€‚ä¸¤ä¸ªå…„å¼Ÿç›’å­ä¹‹é—´çš„å‚ç›´è·ç¦»æ˜¯ç”±ä»–ä»¬ä¸ªä½“çš„å¤–è¾¹è·æ‰€å†³å®šçš„ï¼Œä½†ä¸æ˜¯ä»–ä»¬çš„ä¸¤ä¸ªå¤–è¾¹è·ä¹‹å’Œã€‚ åœ¨ä¸Šå›¾ä¸­æˆ‘ä»¬çœ‹åˆ°åœ¨çº¢è‰²ç›’å­ï¼ˆä¸€ä¸ªdivï¼‰ä¸­åŒ…å«ä¸¤ä¸ªç»¿è‰²çš„å…„å¼Ÿå…ƒç´ ï¼ˆpå…ƒç´ ï¼‰ï¼Œä¸€ä¸ªBFCå·²ç»è¢«åˆ›å»ºã€‚ 123456789.container &#123; overflow: hidden; background-color: yellow;&#125;.container p &#123; margin: 10px 0; background-color: green;&#125; 1234&lt;div class=&quot;container&quot;&gt; &lt;p&gt;hsdsdsddd&lt;/p&gt; &lt;p&gt;hsdsdsddd&lt;/p&gt;&lt;/div&gt; ç†è®ºä¸Šä¸¤ä¸ªå…„å¼Ÿå…ƒç´ ä¹‹é—´çš„è¾¹è·åº”è¯¥æ˜¯æ¥ä¸¤ä¸ªå…ƒç´ çš„è¾¹è·ä¹‹å’Œï¼ˆ20pxï¼‰ï¼Œä½†å®ƒå®é™…ä¸Šä¸º10pxã€‚è¿™å°±æ˜¯è¢«ç§°ä¸ºå¤–è¾¹è·æŠ˜å ã€‚å½“å…„å¼Ÿå…ƒç´ çš„å¤–è¾¹è·ä¸ä¸€æ ·æ—¶ï¼Œå°†ä»¥æœ€å¤§çš„é‚£ä¸ªå¤–è¾¹è·ä¸ºå‡†ã€‚ å¦ä¸€ç§æƒ…å†µå°±æ˜¯ä¸¤ä¸ªå…ƒç´ çš„marginå€¼ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆä»–ä»¬ä¸¤ä¸ªå…ƒç´ ç›´æ¥çš„è·ç¦»å°±æ˜¯ä»–ä»¬æœ€å¤§çš„marginè·ç¦» 12345678.container p:first-of-type &#123; margin: 10px 0; background-color: green;&#125;.container p:nth-of-type(2)&#123; margin: 20px 0; background-color: green;&#125; ä¸‰. ä½¿ç”¨BFCé˜²æ­¢å¤–è¾¹è·æŠ˜å æ¯—é‚»å—ç›’å­çš„å‚ç›´å¤–è¾¹è·æŠ˜å åªæœ‰ä»–ä»¬æ˜¯åœ¨åŒä¸€BFCæ—¶æ‰ä¼šå‘ç”Ÿã€‚å¦‚æœä»–ä»¬å±äºä¸åŒçš„BFCï¼ŒBFCæ˜¯ç‹¬ç«‹çš„å®¹å™¨ï¼Œ å®¹å™¨å†…å¤–äº’ä¸å½±å“ ï¼Œæ‰€ä»¥ä»–ä»¬ä¹‹é—´çš„å¤–è¾¹è·å°†ä¸ä¼šæŠ˜å ã€‚æ‰€ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„BFCæˆ‘ä»¬å¯ä»¥é˜²æ­¢å¤–è¾¹è·æŠ˜å ã€‚ 1234567&lt;div class=&quot;container&quot;&gt; &lt;p&gt;hsdsdsddd&lt;/p&gt; &lt;p&gt;hsdsdsddd&lt;/p&gt; &lt;div class=&quot;newBfc&quot;&gt; &lt;p&gt;sdadsadsa&lt;/p&gt; &lt;/div&gt;&lt;/div&gt; 1234567891011121314.container &#123; overflow: hidden; width: 200px; background-color: yellow;&#125;.container p &#123; margin: 10px 0; background-color: green;&#125;.newBfc &#123; overflow: hidden;&#125; å››. BFCå’Œæµ®åŠ¨é—®é¢˜ä¸€ä¸ªBFCå¯ä»¥åŒ…å«ä½æµ®åŠ¨çš„å…ƒç´ ã€‚ä¸€ä¸ªå®¹å™¨ä¸­æœ‰æµ®åŠ¨å…ƒç´ ï¼Œæˆ‘ä»¬å¤§å¤šæ—¶å€™æ˜¯é€šè¿‡æ¸…é™¤æµ®åŠ¨çš„æ–¹å¼clearfixæ¥è§£å†³ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡å®šä¹‰ä¸€ä¸ªBFCæ¥è¾¾åˆ°ç›®çš„ã€‚ ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š 12345678910111213141516&lt;style&gt; .container &#123; border: 10px solid yellow; min-height: 20px; &#125; .in &#123; height: 50px; width: 200px; float: left; background-color: forestgreen; &#125;&lt;/style&gt;&lt;div class=&quot;container&quot;&gt; &lt;div class=&quot;in&quot;&gt;&lt;/div&gt;&lt;/div&gt; æ­¤æ—¶å¦‚æœåŠ ä¸Šfloat:leftçš„è¯ï¼Œå°±ä¼šè„±ç¦»æ™®é€šçš„æ–‡æ¡£æµ é€šè¿‡ä½¿å¾—å¤–å±‚å…ƒç´ äº§ç”Ÿä¸€ä¸ªBFCä»è€ŒåŒ…è£¹ä½å†…å±‚æµ®åŠ¨çš„å…ƒç´  123456789101112131415161718&lt;style&gt; .container &#123; border: 10px solid yellow; min-height: 20px; overflow: hidden; /* äº§ç”ŸBFCå…¶ä¸­ä¸€ä¸ªæ¡ä»¶ */ &#125; .in &#123; height: 50px; width: 200px; float: left; background-color: forestgreen; &#125;&lt;/style&gt;&lt;div class=&quot;container&quot;&gt; &lt;div class=&quot;in&quot;&gt;&lt;/div&gt;&lt;/div&gt; 5. è§£å†³æµ®åŠ¨åå‘ç”Ÿå…ƒç´ é‡å çš„é—®é¢˜æ™®é€šæ–‡æ¡£æµä¸­ï¼Œå½“ä¸€ä¸ªå…ƒç´ ä½¿ç”¨float:leftè„±ç¦»æ­£å¸¸çš„æ–‡æ¡£æµä¹‹åï¼Œä¼šä½¿å¾—å…¶ä»–çš„å…ƒç´ ä¸å…¶å‘ç”Ÿé‡å ï¼ŒBFCå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ 123456789101112131415161718192021&lt;style&gt; .container &#123; background: grey; &#125; .left &#123; height: 100px; width: 100px; background-color: red; float: left; &#125; .right &#123; height: 150px; width: 150px; background: green; &#125;&lt;/style&gt;&lt;div class=&quot;container&quot;&gt; &lt;div class=&quot;left&quot;&gt;&lt;/div&gt; &lt;div class=&quot;right&quot;&gt;&lt;/div&gt;&lt;/div&gt; ä¸ºäº†ä½¿å…¶ä¸å‘ç”Ÿé‡å ï¼Œå¯ä»¥ä½¿å¾—rightå…ƒç´ äº§ç”ŸBFCï¼ˆBFCå®¹å™¨å†…å¤–äº’ä¸å½±å“ï¼‰ 123456.right &#123; height: 150px; width: 150px; background: green; overflow: hidden; &#125; å…­. å’Œæµ®åŠ¨çš„å…ƒç´ èƒ½å¤Ÿäº§ç”Ÿè¾¹ç•Œâ€‹ ç¬¬äº”ç‚¹è¯´åˆ°äº†å¦‚ä½•ç”¨BFCè§£å†³æµ®åŠ¨äº§ç”Ÿçš„ä¸¤ä¸ªå…ƒç´ é‡å çš„é—®é¢˜ï¼Œä¸€èˆ¬æ¥è¯´è¦è§£å†³è¿™ç§æµ®åŠ¨çš„é—®é¢˜ï¼Œéƒ½ä¼šè®©ç¬¬äº”ç‚¹ä¸­rightå…ƒç´ çš„margin-leftè®¾ç½®ä¸ºleftå…ƒç´ å®½åº¦ï¼Œå¦‚æœè¯´è¦å’Œæµ®åŠ¨çš„å…ƒç´ äº§ç”Ÿè¾¹è·çš„è¯ï¼Œå°±éœ€è¦ è·ç¦»+leftå…ƒç´ å®½åº¦ ã€‚ â€‹ æ­¤æ—¶è®©rightå…ƒç´ äº§ç”ŸBFCä¹‹åï¼Œå¾—è®©leftçš„margin-rightè®¾ç½®ä¸ºä½ æƒ³è¦çš„è¾¹è·ã€‚ 123456789101112131415161718192021222324&lt;style&gt; .container &#123; background: grey; &#125; .left &#123; height: 100px; width: 100px; background-color: red; float: left; margin-right: 10px; &#125; .right &#123; height: 150px; width: 150px; background: green; overflow: hidden; margin-left: 10px; &#125;&lt;/style&gt;&lt;div class=&quot;container&quot;&gt; &lt;div class=&quot;left&quot;&gt;&lt;/div&gt; &lt;div class=&quot;right&quot;&gt;&lt;/div&gt;&lt;/div&gt; ä¸ƒ. ä½¿ç”¨BFCé˜²æ­¢æ–‡å­—ç¯ç»• æœ‰æ—¶å€™ä¸€ä¸ªæµ®åŠ¨divå‘¨å›´çš„æ–‡å­—ç¯ç»•ç€å®ƒï¼ˆå¦‚ä¸‹å›¾ä¸­çš„å·¦å›¾æ‰€ç¤ºï¼‰ä½†æ˜¯åœ¨æŸäº›æ¡ˆä¾‹ä¸­è¿™å¹¶ä¸æ˜¯å¯å–çš„ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯å¤–è§‚è·Ÿä¸‹å›¾ä¸­çš„å³å›¾ä¸€æ ·çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯èƒ½ä½¿ç”¨å¤–è¾¹è·ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªBFCæ¥è§£å†³ã€‚ é¦–å…ˆè®©æˆ‘ä»¬ç†è§£æ–‡å­—ä¸ºä»€ä¹ˆä¼šç¯ç»•ã€‚ä¸ºæ­¤æˆ‘ä»¬éœ€è¦çŸ¥é“å½“ä¸€ä¸ªå…ƒç´ æµ®åŠ¨æ—¶ç›’å­æ¨¡å‹æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ è¿™ä¸ªpå…ƒç´ å¹¶æ²¡æœ‰ç§»åŠ¨ï¼Œä½†æ˜¯å®ƒå´å‡ºç°åœ¨æµ®åŠ¨å…ƒç´ çš„ä¸‹æ–¹ã€‚på…ƒç´ çš„line boxesï¼ˆæŒ‡çš„æ˜¯æ–‡æœ¬è¡Œï¼‰è¿›è¡Œäº†ç§»ä½ã€‚æ­¤å¤„line boxesçš„æ°´å¹³æ”¶ç¼©ä¸ºæµ®åŠ¨å…ƒç´ æä¾›äº†ç©ºé—´ã€‚ éšç€æ–‡å­—çš„å¢åŠ ï¼Œå› ä¸ºline boxesä¸å†éœ€è¦ç§»ä½,æœ€ç»ˆå°†ä¼šç¯ç»•åœ¨æµ®åŠ¨å…ƒç´ çš„ä¸‹æ–¹ï¼Œå› æ­¤å‡ºç°äº†é‚£æ ·çš„æƒ…å†µã€‚è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆå³ä½¿åœ¨æµ®åŠ¨å…ƒç´ å­˜åœ¨æ—¶ï¼Œæ®µè½ä¹Ÿå°†ç´§è´´åœ¨åŒ…å«å—çš„å·¦è¾¹æ¡†ä¸Šï¼Œè¿˜æœ‰ä¸ºä»€ä¹ˆline boxesä¼šç¼©å°ä»¥å®¹çº³æµ®åŠ¨å…ƒç´ ã€‚ å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿç§»åŠ¨æ•´ä¸ªpå…ƒç´ ï¼Œé‚£ä¹ˆè¿™ä¸ªç¯ç»•çš„é—®é¢˜å°±å¯ä»¥è§£å†³äº†ã€‚ åœ¨BFCä¸­ï¼Œæ¯ä¸ªç›’å­çš„å·¦å¤–è¾¹æ¡†ç´§æŒ¨ç€å·¦è¾¹æ¡†çš„åŒ…å«å—ï¼ˆä»å³åˆ°å·¦çš„æ ¼å¼åŒ–æ—¶ï¼Œåˆ™ä¸ºå³è¾¹æ¡†ç´§æŒ¨ï¼‰ã€‚å³ä½¿åœ¨æµ®åŠ¨é‡Œä¹Ÿæ˜¯è¿™æ ·çš„ï¼ˆå°½ç®¡ä¸€ä¸ªç›’å­çš„è¾¹æ¡†ä¼šå› ä¸ºæµ®åŠ¨è€Œèç¼©ï¼‰ï¼Œé™¤éè¿™ä¸ªç›’å­çš„å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„BFCï¼ˆè¿™ç§æƒ…å†µä¸‹,ç”±äºæµ®åŠ¨ï¼Œç›’å­æœ¬èº«å°†ä¼šå˜å¾—æ›´çª„ï¼‰ 123456&lt;div class=&quot;container&quot;&gt; &lt;div class=&quot;floated&quot;&gt;Floated div&lt;/div&gt; &lt;p&gt; Quae hic ut ab perferendis sit quod architecto,dolor debitis quam rem provident aspernatur tempora expedita. &lt;/p&gt; &lt;/div&gt; å› æ­¤ä¸ºäº†ä½¿å…¶ä¸äº§ç”Ÿè¿™æ ·æ–‡å­—ç¯ç»•çš„æ•ˆæœå¯ä»¥ä½¿å¾—päº§ç”Ÿä¸€ä¸ªBFCï¼Œè¿™æ ·å°±ä¸ä¼šç´§ç´§æŒ¨äº†ã€‚ 123456789101112131415161718192021&lt;style&gt; .container &#123; background: grey; &#125; .floated &#123; height: 20px; width: 100px; background-color: red; float: left; &#125; p&#123; display: flow-root; &#125;&lt;/style&gt;&lt;div class=&quot;container&quot;&gt; &lt;div class=&quot;floated&quot;&gt;Floated div&lt;/div&gt; &lt;p&gt; Quae hic ut ab perferendis sit quod architecto,dolor debitis quam rem provident aspernatur tempora expedita. &lt;/p&gt; &lt;/div&gt; å…«. åœ¨å¤šåˆ—å¸ƒå±€ä¸­ä½¿ç”¨BFC å¦‚æœæˆ‘ä»¬æ­£åœ¨åˆ›å»ºçš„ä¸€ä¸ªå¤šåˆ—å¸ƒå±€å æ»¡äº†æ•´ä¸ªå®¹å™¨çš„å®½åº¦ï¼Œåœ¨æŸäº›æµè§ˆå™¨ä¸­æœ€åä¸€åˆ—æœ‰æ—¶å€™å°†ä¼šè¢«æŒ¤åˆ°ä¸‹ä¸€è¡Œã€‚ä¼šå‘ç”Ÿè¿™æ ·å¯èƒ½æ˜¯å› ä¸ºæµè§ˆå™¨èˆå…¥ï¼ˆå–æ•´ï¼‰äº†åˆ—çš„å®½åº¦ä½¿å¾—æ€»å’Œçš„å®½åº¦è¶…è¿‡äº†å®¹å™¨çš„å®½åº¦ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä¸€ä¸ªåˆ—çš„å¸ƒå±€ä¸­å»ºç«‹äº†ä¸€ä¸ªæ–°çš„BFCï¼Œå®ƒå°†ä¼šåœ¨å‰ä¸€åˆ—å¡«å……å®Œä¹‹åçš„åé¢å æ®æ‰€å‰©ä½™çš„ç©ºé—´ã€‚ 12345678910111213141516171819&lt;style&gt; .column &#123; width: 31.33%; height: 100px; background-color: green; float: left; margin: 0 1%; &#125; .column:last-child &#123; float: none; overflow: hidden; &#125;&lt;/style&gt;&lt;div class=&quot;container&quot;&gt; &lt;div class=&quot;column&quot;&gt;column 1&lt;/div&gt; &lt;div class=&quot;column&quot;&gt;column 2&lt;/div&gt; &lt;div class=&quot;column&quot;&gt;column 3&lt;/div&gt;&lt;/div&gt;","tags":["BFC","Css"],"categories":["Css"]},{"title":"åŸå‹æ¨¡å¼å’ŒåŸºäºåŸå‹ç»§æ‰¿çš„Javascriptå¯¹è±¡ç³»ç»Ÿ","path":"/2020/03/16/åŸå‹æ¨¡å¼å’ŒåŸºäºåŸå‹ç»§æ‰¿çš„Javascriptå¯¹è±¡ç³»ç»Ÿ/","content":"åœ¨ä»¥ç±»ä¸ºä¸­å¿ƒçš„é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œç±»å’Œå¯¹è±¡çš„å…³ç³»å¯ä»¥æƒ³è±¡æˆé“¸æ¨¡å’Œé“¸ä»¶çš„å…³ç³»ï¼Œå¯¹è±¡æ€»æ˜¯ä»ç±»ä¸­åˆ›å»ºè€Œæ¥ã€‚è€Œåœ¨åŸå‹ç¼–ç¨‹çš„æ€æƒ³ä¸­ï¼Œç±»å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œå¯¹è±¡æœªå¿…éœ€è¦ä»ç±»ä¸­åˆ›å»ºè€Œæ¥ï¼Œä¸€ä¸ªå¯¹è±¡æ˜¯é€šè¿‡å…‹éš†å¦å¤–ä¸€ä¸ªå¯¹è±¡æ‰€å¾—åˆ°çš„ã€‚ 1. ä½¿ç”¨å…‹éš†çš„åŸå‹æ¨¡å¼ä»è®¾è®¡æ¨¡å¼çš„è§’åº¦è®²ï¼ŒåŸå‹æ¨¡å¼æ˜¯ç”¨äºåˆ›å»ºå¯¹è±¡çš„ä¸€ç§æ¨¡å¼ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ç§æ–¹æ³•æ˜¯å…ˆæŒ‡å®šå®ƒçš„ç±»å‹ï¼Œç„¶åé€šè¿‡ç±»æ¥åˆ›å»ºè¿™ä¸ªå¯¹è±¡ã€‚åŸå‹æ¨¡å¼é€‰æ‹©äº†å¦å¤–ä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¸å†å…³å¿ƒå¯¹è±¡çš„å…·ä½“ç±»å‹ï¼Œè€Œæ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åé€šè¿‡å…‹éš†æ¥åˆ›å»ºä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„å¯¹è±¡ æ—¢ç„¶åŸå‹æ¨¡å¼æ˜¯é€šè¿‡å…‹éš†æ¥åˆ›å»ºå¯¹è±¡çš„ï¼Œé‚£ä¹ˆå¾ˆè‡ªç„¶åœ°ä¼šæƒ³åˆ°ï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªè·ŸæŸä¸ªå¯¹è±¡ä¸€æ¨¡ä¸€æ ·çš„å¯¹è±¡ï¼Œå°±å¯ä»¥ä½¿ç”¨åŸå‹æ¨¡å¼ åŸå‹æ¨¡å¼çš„å®ç°å…³é”®ï¼Œæ˜¯è¯­è¨€æœ¬èº«æ˜¯å¦æä¾›äº† clone æ–¹æ³•ã€‚ECMAScript 5æä¾›äº† Object.createæ–¹æ³• 1234567891011121314151617var Plane = function () &#123; this.blood = 100; this.attackLevel = 1; this.defenceLevel = 1;&#125;var myPlane = new Plane();myPlane.blood = 500;myPlane.attackLevel = 10;myPlane.defenceLevel = 7;// åœ¨ä¸æ”¯æŒ Object.create æ–¹æ³•çš„æµè§ˆå™¨ä¸­ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç Object.create = Object.create || function (obj) &#123; var F = function () &#123; &#125;; F.prototype = obj; return new F();&#125;var clonePlane = Object.create(myPlane);console.log(clonePlane); 2. åŸå‹ç¼–ç¨‹èŒƒå‹çš„ä¸€äº›è§„åˆ™ æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å¯¹è±¡ è¦å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œä¸æ˜¯é€šè¿‡å®ä¾‹åŒ–ç±»ï¼Œè€Œæ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŸå‹å¹¶å…‹éš†å®ƒã€‚ å¯¹è±¡ä¼šè®°ä½å®ƒçš„åŸå‹ã€‚ å¦‚æœå¯¹è±¡æ— æ³•å“åº”æŸä¸ªè¯·æ±‚ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™å®ƒè‡ªå·±çš„åŸå‹ã€‚ 3. JavaScriptä¸­çš„åŸå‹ç»§æ‰¿(æ„å»ºå¯¹è±¡ç³»ç»Ÿ)åŒç†ï¼Œjsä¹ŸåŒæ ·éµå¾ªä»¥ä¸Šçš„ç¼–ç¨‹è§„åˆ™ 1. æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å¯¹è±¡JavaScriptåœ¨è®¾è®¡çš„æ—¶å€™ï¼Œæ¨¡ä»¿ Java å¼•å…¥äº†ä¸¤å¥—ç±»å‹æœºåˆ¶ï¼šåŸºæœ¬ç±»å‹å’Œå¯¹è±¡ç±»å‹ã€‚åŸºæœ¬ç±»å‹åŒ…æ‹¬ undefined ã€ number ã€ boolean ã€ string ã€ function ã€ object é™¤äº† undefined ä¹‹å¤–ï¼Œä¸€åˆ‡éƒ½åº”æ˜¯å¯¹è±¡ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼Œnumber ã€ boolean ã€ string è¿™å‡ ç§åŸºæœ¬ç±»å‹æ•°æ®ä¹Ÿå¯ä»¥é€šè¿‡â€œåŒ…è£…ç±»â€çš„æ–¹å¼å˜æˆå¯¹è±¡ç±»å‹æ•°æ®æ¥å¤„ç† ä¸èƒ½è¯´åœ¨ JavaScriptä¸­æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å¯¹è±¡ï¼Œä½†å¯ä»¥è¯´ç»å¤§éƒ¨åˆ†æ•°æ®éƒ½æ˜¯å¯¹è±¡ã€‚é‚£ä¹ˆç›¸ä¿¡åœ¨ JavaScriptä¸­ä¹Ÿä¸€å®šä¼šæœ‰ä¸€ä¸ªæ ¹å¯¹è±¡å­˜åœ¨ï¼Œè¿™äº›å¯¹è±¡è¿½æ ¹æº¯æºéƒ½æ¥æºäºè¿™ä¸ªæ ¹å¯¹è±¡ã€‚ JavaScript ä¸­çš„æ ¹å¯¹è±¡æ˜¯ Object.prototype å¯¹è±¡ã€‚ Object.prototype å¯¹è±¡æ˜¯ä¸€ä¸ªç©ºçš„å¯¹è±¡ã€‚æˆ‘ä»¬åœ¨JavaScript é‡åˆ°çš„æ¯ä¸ªå¯¹è±¡ï¼Œå®é™…ä¸Šéƒ½æ˜¯ä» Object.prototype å¯¹è±¡å…‹éš†è€Œæ¥çš„ï¼ŒObject.prototype å¯¹è±¡å°±æ˜¯å®ƒä»¬çš„åŸå‹ã€‚ å¯ä»¥åˆ©ç”¨ ECMAScript 5æä¾›çš„ Object.getPrototypeOf æ¥æŸ¥çœ‹è¿™ä¸¤ä¸ªå¯¹è±¡çš„åŸå‹ï¼š 1234var obj1 = new Object();var obj2 = &#123;&#125;;console.log( Object.getPrototypeOf( obj1 ) === Object.prototype ); // è¾“å‡ºï¼štrueconsole.log( Object.getPrototypeOf( obj2 ) === Object.prototype ); // è¾“å‡ºï¼štrue 2. è¦å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œä¸æ˜¯é€šè¿‡å®ä¾‹åŒ–ç±»ï¼Œè€Œæ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŸå‹å¹¶å…‹éš†å®ƒåœ¨ JavaScriptè¯­è¨€é‡Œï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å…³å¿ƒå…‹éš†çš„ç»†èŠ‚ï¼Œå› ä¸ºè¿™æ˜¯å¼•æ“å†…éƒ¨è´Ÿè´£å®ç°çš„ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„åªæ˜¯æ˜¾å¼åœ°è°ƒç”¨ var obj1 = new Object() æˆ–è€… var obj2 = &#123;&#125; ã€‚æ­¤æ—¶ï¼Œå¼•æ“å†…éƒ¨ä¼šä»Object.prototype ä¸Šé¢å…‹éš†ä¸€ä¸ªå¯¹è±¡å‡ºæ¥ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„å°±æ˜¯è¿™ä¸ªå¯¹è±¡. ç”¨ new è¿ç®—ç¬¦ä»æ„é€ å™¨ä¸­å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ 12345678910function Person( name )&#123;\tthis.name = name;&#125;;Person.prototype.getName = function()&#123;\treturn this.name;&#125;;var a = new Person( &#x27;sven&#x27; )console.log( a.name ); // è¾“å‡ºï¼šsvenconsole.log( a.getName() ); // è¾“å‡ºï¼šsvenconsole.log( Object.getPrototypeOf( a ) === Person.prototype ); // è¾“å‡ºï¼štrue è¿™é‡Œ Person å¹¶ä¸æ˜¯ç±»ï¼Œè€Œæ˜¯å‡½æ•°æ„é€ å™¨ï¼ŒJavaScript çš„å‡½æ•°æ—¢å¯ä»¥ä½œä¸ºæ™®é€šå‡½æ•°è¢«è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæ„é€ å™¨è¢«è°ƒç”¨,å½“ä½¿ç”¨ new è¿ç®—ç¬¦æ¥è°ƒç”¨å‡½æ•°æ—¶ï¼Œæ­¤æ—¶çš„å‡½æ•°å°±æ˜¯ä¸€ä¸ªæ„é€ å™¨ã€‚ ç”¨new è¿ç®—ç¬¦æ¥åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šä¹Ÿåªæ˜¯å…ˆå…‹éš† Object.prototype å¯¹è±¡ï¼Œå†è¿›è¡Œä¸€äº›å…¶ä»–é¢å¤–æ“ä½œçš„è¿‡ç¨‹ã€‚ å¯ä»¥æ¨¡æ‹Ÿnewçš„è¿‡ç¨‹ï¼š 123456789101112131415161718192021// æ¨¡æ‹Ÿnewçš„å®ç°æ–¹å¼// å…ˆæ¥ä¸€ä¸ªPersonæ„é€ å™¨function Person(name) &#123; this.name = name;&#125;Person.prototype.getName = function () &#123; return this.name;&#125;var objectFactory = function () &#123; var obj = new Object(), //ä»Object.prototypeä¸Šå…‹éš†ä¸€ä¸ªç©ºçš„å¯¹è±¡&#123;&#125; Constructor = [].shift.call(arguments); // å–å¾—å¤–éƒ¨ä¼ å…¥çš„æ„é€ å™¨ï¼Œæ­¤ä¾‹æ˜¯ Person obj.__proto__ = Constructor.prototype; // æŒ‡å‘æ­£ç¡®çš„åŸå‹ var ret = Constructor.apply(obj, arguments); // å€Ÿç”¨å¤–éƒ¨ä¼ å…¥çš„æ„é€ å™¨ç»™ obj è®¾ç½®å±æ€§ return typeof ret === &#x27;object&#x27; ? ret : obj; // ç¡®ä¿æ„é€ å™¨æ€»æ˜¯ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡&#125;var a = objectFactory(Person, &#x27;weng&#x27;);console.log(a.getName()); 3. å¯¹è±¡ä¼šè®°ä½å®ƒçš„åŸå‹å¯¹è±¡çš„åŸå‹â€ï¼Œå°± JavaScript çš„çœŸæ­£å®ç°æ¥è¯´ï¼Œå…¶å®å¹¶ä¸èƒ½è¯´å¯¹è±¡æœ‰åŸå‹ï¼Œè€Œåªèƒ½è¯´å¯¹è±¡çš„æ„é€ å™¨æœ‰åŸå‹ã€‚å¯¹äºâ€œå¯¹è±¡æŠŠè¯·æ±‚å§”æ‰˜ç»™å®ƒè‡ªå·±çš„åŸå‹â€è¿™å¥è¯ï¼Œæ›´å¥½çš„è¯´æ³•æ˜¯å¯¹è±¡æŠŠè¯·æ±‚å§”æ‰˜ç»™å®ƒçš„æ„é€ å™¨çš„åŸå‹ JavaScript ç»™å¯¹è±¡æä¾›äº†ä¸€ä¸ªåä¸º __proto__ çš„éšè—å±æ€§ï¼ŒæŸä¸ªå¯¹è±¡çš„ __proto__ å±æ€§é»˜è®¤ä¼šæŒ‡å‘å®ƒçš„æ„é€ å™¨çš„åŸå‹å¯¹è±¡ï¼Œå³ &#123;Constructor&#125;.prototypeã€‚åœ¨ä¸€äº›æµè§ˆå™¨ä¸­ï¼Œ __proto__ è¢«å…¬å¼€å‡ºæ¥ 12var a = new Object();console.log ( a.__proto__=== Object.prototype ); // è¾“å‡ºï¼štrue __proto__ å°±æ˜¯å¯¹è±¡è·Ÿâ€œå¯¹è±¡æ„é€ å™¨çš„åŸå‹â€è”ç³»èµ·æ¥çš„çº½å¸¦ã€‚æ­£å› ä¸ºå¯¹è±¡è¦é€šè¿‡_proto__ å±æ€§æ¥è®°ä½å®ƒçš„æ„é€ å™¨çš„åŸå‹ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ objectFactory å‡½æ•°æ¥æ¨¡æ‹Ÿç”¨ newåˆ›å»ºå¯¹è±¡æ—¶ï¼Œ éœ€è¦æ‰‹åŠ¨ç»™ obj å¯¹è±¡è®¾ç½®æ­£ç¡®çš„ __proto__ æŒ‡å‘ obj.__proto__ = Constructor.prototype; è®© obj.proto æŒ‡å‘ Person.prototype ï¼Œè€Œä¸æ˜¯åŸæ¥çš„ Object.prototype 4. å¦‚æœå¯¹è±¡æ— æ³•å“åº”æŸä¸ªè¯·æ±‚ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™å®ƒçš„æ„é€ å™¨çš„åŸå‹åœ¨ JavaScript ä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æ˜¯ä» Object.prototype å¯¹è±¡å…‹éš†è€Œæ¥çš„ï¼Œå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬åªèƒ½å¾—åˆ°å•ä¸€çš„ç»§æ‰¿å…³ç³»ï¼Œå³æ¯ä¸ªå¯¹è±¡éƒ½ç»§æ‰¿è‡ª Object.prototype å¯¹è±¡ï¼Œè¿™æ ·çš„å¯¹è±¡ç³»ç»Ÿæ˜¾ç„¶æ˜¯éå¸¸å—é™çš„ã€‚ å®é™…ä¸Šï¼Œè™½ç„¶ JavaScript çš„å¯¹è±¡æœ€åˆéƒ½æ˜¯ç”± Object.prototype å¯¹è±¡å…‹éš†è€Œæ¥çš„ï¼Œä½†å¯¹è±¡æ„é€ å™¨çš„åŸå‹å¹¶ä¸ä»…é™äº Object.prototype ä¸Šï¼Œè€Œæ˜¯å¯ä»¥åŠ¨æ€æŒ‡å‘å…¶ä»–å¯¹è±¡ã€‚è¿™æ ·ä¸€æ¥ï¼Œå½“å¯¹è±¡ a éœ€è¦å€Ÿç”¨å¯¹è±¡ b çš„èƒ½åŠ›æ—¶ï¼Œå¯ä»¥æœ‰é€‰æ‹©æ€§åœ°æŠŠå¯¹è±¡ a çš„æ„é€ å™¨çš„åŸå‹æŒ‡å‘å¯¹è±¡ b ï¼Œä»è€Œè¾¾åˆ°ç»§æ‰¿çš„æ•ˆæœ å¸¸ç”¨åŸå‹ç»§æ‰¿ä»£ç è§£æ12345var obj = &#123; name: &#x27;sven&#x27; &#125;;var A = function()&#123;&#125;;A.prototype = obj;var a = new A();console.log( a.name ); // è¾“å‡ºï¼šsven é¦–å…ˆï¼Œå°è¯•éå†å¯¹è±¡ a ä¸­çš„æ‰€æœ‰å±æ€§ï¼Œä½†æ²¡æœ‰æ‰¾åˆ° name è¿™ä¸ªå±æ€§ æŸ¥æ‰¾ name å±æ€§çš„è¿™ä¸ªè¯·æ±‚è¢«å§”æ‰˜ç»™å¯¹è±¡ a çš„æ„é€ å™¨çš„åŸå‹ï¼Œå®ƒè¢« a. __proto__ è®°å½•ç€å¹¶ä¸”æŒ‡å‘ .prototype ï¼Œè€Œ A.prototype è¢«è®¾ç½®ä¸ºå¯¹è±¡ obj åœ¨å¯¹è±¡ obj ä¸­æ‰¾åˆ°äº† name å±æ€§ï¼Œå¹¶è¿”å›å®ƒçš„å€¼ å½“æˆ‘ä»¬æœŸæœ›å¾—åˆ°ä¸€ä¸ªâ€œç±»â€ç»§æ‰¿è‡ªå¦å¤–ä¸€ä¸ªâ€œç±»â€çš„æ•ˆæœæ—¶ï¼Œå¾€å¾€ä¼šç”¨ä¸‹é¢çš„ä»£ç æ¥æ¨¡æ‹Ÿå®ç° 123456var A = function()&#123;&#125;;A.prototype = &#123; name: &#x27;sven&#x27; &#125;;var B = function()&#123;&#125;;B.prototype = new A();var b = new B();console.log( b.name ); // è¾“å‡ºï¼šsven é¦–å…ˆï¼Œå°è¯•éå†å¯¹è±¡ b ä¸­çš„æ‰€æœ‰å±æ€§ï¼Œä½†æ²¡æœ‰æ‰¾åˆ° name è¿™ä¸ªå±æ€§ æŸ¥æ‰¾ name å±æ€§çš„è¯·æ±‚è¢«å§”æ‰˜ç»™å¯¹è±¡ b çš„æ„é€ å™¨çš„åŸå‹ï¼Œå®ƒè¢« b. __proto__ è®°å½•ç€å¹¶ä¸”æŒ‡å‘B.prototype ï¼Œè€Œ B.prototypeè¢«è®¾ç½®ä¸ºä¸€ä¸ªé€šè¿‡ new A()åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ åœ¨è¯¥å¯¹è±¡ä¸­ä¾ç„¶æ²¡æœ‰æ‰¾åˆ° name å±æ€§ï¼Œäºæ˜¯è¯·æ±‚è¢«ç»§ç»­å§”æ‰˜ç»™è¿™ä¸ªå¯¹è±¡æ„é€ å™¨çš„åŸå‹A.prototype åœ¨ A.prototype ä¸­æ‰¾åˆ°äº† name å±æ€§ï¼Œå¹¶è¿”å›å®ƒçš„å€¼","tags":["javascript","jsè®¾è®¡æ¨¡å¼","åŸå‹é“¾"],"categories":["Javascript"]},{"title":"åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹","path":"/2020/03/16/åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹/","content":"ECMA scriptä¸­çš„æ•°æ®ç±»å‹ 1. åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆundefinedï¼Œbooleanï¼Œnumberï¼Œstringï¼Œnullï¼‰åŸºæœ¬æ•°æ®ç±»å‹ä¸»è¦æ˜¯ï¼šundefinedï¼Œbooleanï¼Œnumberï¼Œstringï¼Œnullã€‚ 1.1 åŸºæœ¬æ•°æ®ç±»å‹å­˜æ”¾åœ¨æ ˆä¸­å­˜æ”¾åœ¨æ ˆå†…å­˜ä¸­çš„ç®€å•æ•°æ®æ®µï¼Œæ•°æ®å¤§å°ç¡®å®šï¼Œå†…å­˜ç©ºé—´å¤§å°å¯ä»¥åˆ†é…ï¼Œæ˜¯ç›´æ¥æŒ‰å€¼å­˜æ”¾çš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è®¿é—®ã€‚ 1.2 åŸºæœ¬æ•°æ®ç±»å‹å€¼ä¸å¯å˜ javascriptä¸­çš„åŸå§‹å€¼ï¼ˆundefinedã€nullã€å¸ƒå°”å€¼ã€æ•°å­—å’Œå­—ç¬¦ä¸²ï¼‰ä¸å¯¹è±¡ï¼ˆåŒ…æ‹¬æ•°ç»„å’Œå‡½æ•°ï¼‰æœ‰ç€æ ¹æœ¬åŒºåˆ«ã€‚åŸå§‹å€¼æ˜¯ä¸å¯æ›´æ”¹çš„ï¼šä»»ä½•æ–¹æ³•éƒ½æ— æ³•æ›´æ”¹ï¼ˆæˆ–â€œçªå˜â€ï¼‰ä¸€ä¸ªåŸå§‹å€¼ã€‚å¯¹æ•°å­—å’Œå¸ƒå°”å€¼æ¥è¯´æ˜¾ç„¶å¦‚æ­¤ â€”â€” æ”¹å˜æ•°å­—çš„å€¼æœ¬èº«å°±è¯´ä¸é€šï¼Œè€Œå¯¹å­—ç¬¦ä¸²æ¥è¯´å°±ä¸é‚£ä¹ˆæ˜æ˜¾äº†ï¼Œå› ä¸ºå­—ç¬¦ä¸²çœ‹èµ·æ¥åƒç”±å­—ç¬¦ç»„æˆçš„æ•°ç»„ï¼Œæˆ‘ä»¬æœŸæœ›å¯ä»¥é€šè¿‡æŒ‡å®šç´¢å¼•æ¥å‡æ”¹å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ã€‚å®é™…ä¸Šï¼Œjavascript æ˜¯ç¦æ­¢è¿™æ ·åšçš„ã€‚å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„æ–¹æ³•çœ‹ä¸Šå»è¿”å›äº†ä¸€ä¸ªä¿®æ”¹åçš„å­—ç¬¦ä¸²ï¼Œå®é™…ä¸Šè¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å€¼ã€‚ åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼æ˜¯ä¸å¯å˜çš„ï¼ŒåŠ¨æ€ä¿®æ”¹äº†åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ï¼Œå®ƒçš„åŸå§‹å€¼ä¹Ÿæ˜¯ä¸ä¼šæ”¹å˜çš„ï¼Œä¾‹å¦‚ï¼š 12345var str = &quot;abc&quot;;console.log(str[1]=&quot;f&quot;); // fconsole.log(str); // abc è¿™ä¸€ç‚¹å…¶å®å¼€å§‹æˆ‘æ˜¯æ¯”è¾ƒè¿·æƒ‘çš„ï¼Œæ€»æ˜¯æ„Ÿè§‰ js æ˜¯ä¸€ä¸ªçµæ´»çš„è¯­è¨€ï¼Œä»»ä½•å€¼åº”è¯¥éƒ½æ˜¯å¯å˜çš„ï¼ŒçœŸæ˜¯å›¾æ ·å›¾æ£®ç ´ï¼Œæˆ‘ä»¬é€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯å¯¹ä¸€ä¸ªå˜é‡é‡æ–°èµ‹å€¼ï¼Œè€Œä¸æ˜¯æ”¹å˜åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ã€‚å°±å¦‚ä¸Šè¿°å¼•ç”¨æ‰€è¯´çš„é‚£æ ·ï¼Œåœ¨ js ä¸­æ²¡æœ‰æ–¹æ³•æ˜¯å¯ä»¥æ”¹å˜å¸ƒå°”å€¼å’Œæ•°å­—çš„ã€‚å€’æ˜¯æœ‰å¾ˆå¤šæ“ä½œå­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œä½†æ˜¯è¿™äº›æ–¹æ³•éƒ½æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œå¹¶æ²¡æœ‰æ”¹å˜å…¶åŸæœ‰çš„æ•°æ®ã€‚ æ‰€ä»¥ï¼Œè®°ä½è¿™ä¸€ç‚¹ï¼šåŸºæœ¬æ•°æ®ç±»å‹å€¼ä¸å¯å˜ã€‚ 1.3 åŸºæœ¬ç±»å‹çš„æ¯”è¾ƒæ˜¯å€¼çš„æ¯”è¾ƒåŸºæœ¬ç±»å‹çš„æ¯”è¾ƒæ˜¯å€¼çš„æ¯”è¾ƒï¼Œåªè¦å®ƒä»¬çš„å€¼ç›¸ç­‰å°±è®¤ä¸ºä»–ä»¬æ˜¯ç›¸ç­‰çš„ï¼Œä¾‹å¦‚ï¼š 123var a = 1;var b = 1;console.log(a === b);//true æ¯”è¾ƒçš„æ—¶å€™æœ€å¥½ä½¿ç”¨ä¸¥æ ¼ç­‰ï¼Œå› ä¸º == æ˜¯ä¼šè¿›è¡Œç±»å‹è½¬æ¢çš„ï¼Œæ¯”å¦‚ï¼š 123var a = 1;var b = true;console.log(a == b);//true 2. å¼•ç”¨ç±»å‹2.1 å¼•ç”¨ç±»å‹å­˜æ”¾åœ¨å †ä¸­å¼•ç”¨ç±»å‹ï¼ˆobjectï¼‰æ˜¯å­˜æ”¾åœ¨å †å†…å­˜ä¸­çš„ï¼Œå˜é‡å®é™…ä¸Šæ˜¯ä¸€ä¸ªå­˜æ”¾åœ¨æ ˆå†…å­˜çš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å †å†…å­˜ä¸­çš„åœ°å€ã€‚æ¯ä¸ªç©ºé—´å¤§å°ä¸ä¸€æ ·ï¼Œè¦æ ¹æ®æƒ…å†µå¼€è¿›è¡Œç‰¹å®šçš„åˆ†é…ï¼Œä¾‹å¦‚ã€‚ 123var person1 = &#123;name:&#x27;jozo&#x27;&#125;;var person2 = &#123;name:&#x27;xiaom&#x27;&#125;;var person3 = &#123;name:&#x27;xiaoq&#x27;&#125;; å †å†…å­˜ 2.2 å¼•ç”¨ç±»å‹å€¼å¯å˜å¼•ç”¨ç±»å‹æ˜¯å¯ä»¥ç›´æ¥æ”¹å˜å…¶å€¼çš„ï¼Œä¾‹å¦‚ï¼š 123var a = [1,2,3];a[1] = 5;console.log(a[1]); // 5 2.3 å¼•ç”¨ç±»å‹çš„æ¯”è¾ƒæ˜¯å¼•ç”¨çš„æ¯”è¾ƒæ‰€ä»¥æ¯æ¬¡æˆ‘ä»¬å¯¹ js ä¸­çš„å¼•ç”¨ç±»å‹è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼Œéƒ½æ˜¯æ“ä½œå…¶å¯¹è±¡çš„å¼•ç”¨ï¼ˆä¿å­˜åœ¨æ ˆå†…å­˜ä¸­çš„æŒ‡é’ˆï¼‰ï¼Œæ‰€ä»¥æ¯”è¾ƒä¸¤ä¸ªå¼•ç”¨ç±»å‹ï¼Œæ˜¯çœ‹å…¶çš„å¼•ç”¨æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚ä¾‹å¦‚ï¼š 123var a = [1,2,3];var b = [1,2,3];console.log(a === b); // falseå¤åˆ¶ä»£ç  è™½ç„¶å˜é‡ a å’Œå˜é‡ b éƒ½æ˜¯è¡¨ç¤ºä¸€ä¸ªå†…å®¹ä¸º 1ï¼Œ2ï¼Œ3 çš„æ•°ç»„ï¼Œä½†æ˜¯å…¶åœ¨å†…å­˜ä¸­çš„ä½ç½®ä¸ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´å˜é‡ a å’Œå˜é‡ b æŒ‡å‘çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä»–ä»¬æ˜¯ä¸ç›¸ç­‰çš„ã€‚ 3. ä¼ å€¼ä¸ä¼ å€äº†è§£äº†åŸºæœ¬æ•°æ®ç±»å‹ä¸å¼•ç”¨ç±»å‹çš„åŒºåˆ«ä¹‹åï¼Œæˆ‘ä»¬å°±åº”è¯¥èƒ½æ˜ç™½ä¼ å€¼ä¸ä¼ å€çš„åŒºåˆ«äº†ã€‚åœ¨æˆ‘ä»¬è¿›è¡Œèµ‹å€¼æ“ä½œçš„æ—¶å€™ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹çš„èµ‹å€¼ï¼ˆ=ï¼‰æ˜¯åœ¨å†…å­˜ä¸­æ–°å¼€è¾Ÿä¸€æ®µæ ˆå†…å­˜ï¼Œç„¶åå†æŠŠå†å°†å€¼èµ‹å€¼åˆ°æ–°çš„æ ˆä¸­ã€‚ä¾‹å¦‚ï¼š 123456var a = 10;var b = a;a ++ ;console.log(a); // 11console.log(b); // 10 æ‰€ä»¥è¯´ï¼ŒåŸºæœ¬ç±»å‹çš„èµ‹å€¼çš„ä¸¤ä¸ªå˜é‡æ˜¯ä¸¤ä¸ªç‹¬ç«‹ç›¸äº’ä¸å½±å“çš„å˜é‡ã€‚ ä½†æ˜¯å¼•ç”¨ç±»å‹çš„èµ‹å€¼æ˜¯ä¼ å€ã€‚åªæ˜¯æ”¹å˜æŒ‡é’ˆçš„æŒ‡å‘ï¼Œä¾‹å¦‚ï¼Œä¹Ÿå°±æ˜¯è¯´å¼•ç”¨ç±»å‹çš„èµ‹å€¼æ˜¯å¯¹è±¡ä¿å­˜åœ¨æ ˆä¸­çš„åœ°å€çš„èµ‹å€¼ï¼Œè¿™æ ·çš„è¯ä¸¤ä¸ªå˜é‡å°±æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤ä¸¤è€…ä¹‹é—´æ“ä½œäº’ç›¸æœ‰å½±å“ã€‚ä¾‹å¦‚ï¼š 123456789101112var a = &#123;&#125;; // aä¿å­˜äº†ä¸€ä¸ªç©ºå¯¹è±¡çš„å®ä¾‹var b = a; // aå’Œbéƒ½æŒ‡å‘äº†è¿™ä¸ªç©ºå¯¹è±¡a.name = &#x27;jozo&#x27;;console.log(a.name); // &#x27;jozo&#x27;console.log(b.name); // &#x27;jozo&#x27;b.age = 22;console.log(b.age);// 22console.log(a.age);// 22console.log(a == b);// true","tags":["Javascript","ES6","åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨ç±»å‹"],"categories":["Javascript"]},{"title":"é¸­å­ç±»å‹","path":"/2020/03/16/é¸­å­ç±»å‹/","content":"æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªå°æ•…äº‹æ¥æ›´æ·±åˆ»åœ°äº†è§£é¸­å­ç±»å‹ã€‚ ä»å‰åœ¨ JavaScriptç‹å›½é‡Œï¼Œæœ‰ä¸€ä¸ªå›½ç‹ï¼Œä»–è§‰å¾—ä¸–ç•Œä¸Šæœ€ç¾å¦™çš„å£°éŸ³å°±æ˜¯é¸­å­çš„å«å£°ï¼Œäºæ˜¯å›½ç‹å¬é›†å¤§è‡£ï¼Œè¦ç»„å»ºä¸€ä¸ª 1000 åªé¸­å­ç»„æˆçš„åˆå”±å›¢ã€‚å¤§è‡£ä»¬æ‰¾éäº†å…¨å›½ï¼Œç»ˆäºæ‰¾åˆ° 999åªé¸­å­ï¼Œä½†æ˜¯å§‹ç»ˆè¿˜å·®ä¸€åªï¼Œæœ€åå¤§è‡£å‘ç°æœ‰ä¸€åªéå¸¸ç‰¹åˆ«çš„é¸¡ï¼Œå®ƒçš„å«å£°è·Ÿé¸­å­ä¸€æ¨¡ä¸€æ ·ï¼Œäºæ˜¯è¿™åªé¸¡å°±æˆä¸ºäº†åˆå”±å›¢çš„æœ€åä¸€å‘˜ã€‚ è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬ï¼Œå›½ç‹è¦å¬çš„åªæ˜¯é¸­å­çš„å«å£°ï¼Œè¿™ä¸ªå£°éŸ³çš„ä¸»äººåˆ°åº•æ˜¯é¸¡è¿˜æ˜¯é¸­å¹¶ä¸é‡è¦ã€‚é¸­å­ç±»å‹æŒ‡å¯¼æˆ‘ä»¬åªå…³æ³¨å¯¹è±¡çš„è¡Œä¸ºï¼Œè€Œä¸å…³æ³¨å¯¹è±¡æœ¬èº«ï¼Œä¹Ÿå°±æ˜¯å…³æ³¨ HAS-A, è€Œä¸æ˜¯ IS-Aã€‚ 123456789101112131415161718192021222324var duck = &#123; type: &#x27;duck&#x27;, duckSinging: function () &#123; console.log(&#x27;gagagag&#x27;); &#125;&#125;var chicken = &#123; type: &#x27;chicken&#x27;, duckSinging: function () &#123; console.log(&#x27;gagagag&#x27;); &#125;&#125;var choir = [];var joinChoir = function (animal) &#123; if (animal &amp;&amp; typeof animal.duckSinging === &#x27;function&#x27;) &#123; choir.push(animal); console.log(`æ­å–œ$&#123;animal.type&#125;åŠ å…¥åˆå”±å›¢`); console.log(`åˆå”±å›¢å·²æœ‰äººæ•°ä¸º$&#123;choir.length&#125;`); &#125;&#125;joinChoir(duck);joinChoir(chicken); æˆ‘ä»¬çœ‹åˆ°ï¼Œå¯¹äºåŠ å…¥åˆå”±å›¢çš„åŠ¨ç‰©ï¼Œå¤§è‡£ä»¬æ ¹æœ¬æ— éœ€æ£€æŸ¥å®ƒä»¬çš„ç±»å‹ï¼Œè€Œæ˜¯åªéœ€è¦ä¿è¯å®ƒä»¬æ‹¥æœ‰ duckSinging æ–¹æ³•ã€‚å¦‚æœä¸‹æ¬¡æœŸæœ›åŠ å…¥åˆå”±å›¢çš„æ˜¯ä¸€åªå°ç‹—ï¼Œè€Œè¿™åªå°ç‹—åˆšå¥½ä¹Ÿä¼šé¸­å­å«ï¼Œæˆ‘ç›¸ä¿¡è¿™åªå°ç‹—ä¹Ÿèƒ½é¡ºåˆ©åŠ å…¥ã€‚ åœ¨åŠ¨æ€ç±»å‹è¯­è¨€çš„é¢å‘å¯¹è±¡è®¾è®¡ä¸­ï¼Œé¸­å­ç±»å‹çš„æ¦‚å¿µè‡³å…³é‡è¦ã€‚åˆ©ç”¨é¸­å­ç±»å‹çš„æ€æƒ³ï¼Œæˆ‘ä»¬ä¸å¿…å€ŸåŠ©è¶…ç±»å‹çš„å¸®åŠ©ï¼Œå°±èƒ½è½»æ¾åœ°åœ¨åŠ¨æ€ç±»å‹è¯­è¨€ä¸­å®ç°ä¸€ä¸ªåŸåˆ™ï¼šâ€œé¢å‘æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é¢å‘å®ç°ç¼–ç¨‹*â€ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¯¹è±¡è‹¥æœ‰ push å’Œ pop æ–¹æ³•ï¼Œå¹¶ä¸”è¿™äº›æ–¹æ³•æä¾›äº†æ­£ç¡®çš„å®ç°ï¼Œå®ƒå°±å¯ä»¥è¢«å½“ä½œæ ˆæ¥ä½¿ç”¨ã€‚ä¸€ä¸ªå¯¹è±¡å¦‚æœæœ‰ length å±æ€§ï¼Œä¹Ÿå¯ä»¥ä¾ç…§ä¸‹æ ‡æ¥å­˜å–å±æ€§ï¼ˆæœ€å¥½è¿˜è¦æ‹¥æœ‰ slice å’Œ splice ç­‰æ–¹æ³•ï¼‰ï¼Œè¿™ä¸ªå¯¹è±¡å°±å¯ä»¥è¢«å½“ä½œæ•°ç»„æ¥ä½¿ç”¨ã€‚ åœ¨é™æ€ç±»å‹è¯­è¨€ä¸­ï¼Œè¦å®ç°â€œé¢å‘æ¥å£ç¼–ç¨‹â€å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œå¾€å¾€è¦é€šè¿‡æŠ½è±¡ç±»æˆ–è€…æ¥å£ç­‰å°†å¯¹è±¡è¿›è¡Œå‘ä¸Šè½¬å‹ã€‚å½“å¯¹è±¡çš„çœŸæ­£ç±»å‹è¢«éšè—åœ¨å®ƒçš„è¶…ç±»å‹èº«åï¼Œè¿™äº›å¯¹è±¡æ‰èƒ½åœ¨ç±»å‹æ£€æŸ¥ç³»ç»Ÿçš„â€œç›‘è§†â€ä¹‹ä¸‹äº’ç›¸è¢«æ›¿æ¢ä½¿ç”¨ã€‚åªæœ‰å½“å¯¹è±¡èƒ½å¤Ÿè¢«äº’ç›¸æ›¿æ¢ä½¿ç”¨ï¼Œæ‰èƒ½ä½“ç°å‡ºå¯¹è±¡å¤šæ€æ€§çš„ä»·å€¼ã€‚ â€œé¢å‘æ¥å£ç¼–ç¨‹â€æ˜¯è®¾è®¡æ¨¡å¼ä¸­æœ€é‡è¦çš„æ€æƒ³ï¼Œä½†åœ¨ JavaScriptè¯­è¨€ä¸­ï¼Œâ€œé¢å‘æ¥å£ç¼–ç¨‹â€çš„è¿‡ç¨‹è·Ÿä¸»æµçš„é™æ€ç±»å‹è¯­è¨€ä¸ä¸€æ ·ï¼Œå› æ­¤ï¼Œåœ¨ JavaScriptä¸­å®ç°è®¾è®¡æ¨¡å¼çš„è¿‡ç¨‹ä¸åœ¨ä¸€äº›æˆ‘ä»¬ç†Ÿæ‚‰çš„è¯­è¨€ä¸­å®ç°çš„è¿‡ç¨‹ä¼šå¤§ç›¸å¾„åº­ã€‚","tags":["jsè®¾è®¡æ¨¡å¼","é¸­å­ç±»å‹"],"categories":["Javascript","ç‰¹å®šåè¯"]},{"title":"æ·±æ‹·è´ä¸æµ…æ‹·è´","path":"/2020/03/16/æµ…æ‹·è´å’Œæ·±æ‹·è´2/","content":"æ·±æ‹·è´ä¸æµ…æ‹·è´ä¸€ä¸‹éƒ¨åˆ†å‚ç…§çŸ¥ä¹ä¸­çš„æé—®ï¼š javascriptä¸­çš„æ·±æ‹·è´å’Œæµ…æ‹·è´ æµ…æ‹·è´èµ‹å€¼ï¼ˆ=ï¼‰å’Œæµ…æ‹·è´çš„åŒºåˆ«é‚£ä¹ˆèµ‹å€¼å’Œæµ…æ‹·è´æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Œæˆ‘ä»¬çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546var obj1 = &#123; &#x27;name&#x27; : &#x27;zhangsan&#x27;, &#x27;age&#x27; : &#x27;18&#x27;, &#x27;language&#x27; : [1,[2,3],[4,5]],&#125;;var obj2 = obj1;var obj3 = shallowCopy(obj1);function shallowCopy(src) &#123; var dst = &#123;&#125;; for (var prop in src) &#123; if (src.hasOwnProperty(prop)) &#123; dst[prop] = src[prop]; &#125; &#125; return dst;&#125;obj2.name = &quot;lisi&quot;;obj3.age = &quot;20&quot;;obj2.language[1] = [&quot;äºŒ&quot;,&quot;ä¸‰&quot;];obj3.language[2] = [&quot;å››&quot;,&quot;äº”&quot;];console.log(obj1); //obj1 = &#123;// &#x27;name&#x27; : &#x27;lisi&#x27;,// &#x27;age&#x27; : &#x27;18&#x27;,// &#x27;language&#x27; : [1,[&quot;äºŒ&quot;,&quot;ä¸‰&quot;],[&quot;å››&quot;,&quot;äº”&quot;]],//&#125;;console.log(obj2);//obj2 = &#123;// &#x27;name&#x27; : &#x27;lisi&#x27;,// &#x27;age&#x27; : &#x27;18&#x27;,// &#x27;language&#x27; : [1,[&quot;äºŒ&quot;,&quot;ä¸‰&quot;],[&quot;å››&quot;,&quot;äº”&quot;]],//&#125;;console.log(obj3);//obj3 = &#123;// &#x27;name&#x27; : &#x27;zhangsan&#x27;,// &#x27;age&#x27; : &#x27;20&#x27;,// &#x27;language&#x27; : [1,[&quot;äºŒ&quot;,&quot;ä¸‰&quot;],[&quot;å››&quot;,&quot;äº”&quot;]],//&#125;; å…ˆå®šä¹‰ä¸ªä¸€ä¸ªåŸå§‹çš„å¯¹è±¡ obj1ï¼Œç„¶åä½¿ç”¨èµ‹å€¼å¾—åˆ°ç¬¬äºŒä¸ªå¯¹è±¡ obj2ï¼Œç„¶åé€šè¿‡æµ…æ‹·è´ï¼Œå°† obj1 é‡Œé¢çš„å±æ€§éƒ½èµ‹å€¼åˆ° obj3 ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š obj1ï¼šåŸå§‹æ•°æ® obj2ï¼šèµ‹å€¼æ“ä½œå¾—åˆ° obj3ï¼šæµ…æ‹·è´å¾—åˆ° ç„¶åæˆ‘ä»¬æ”¹å˜ obj2 çš„ name å±æ€§å’Œ obj3 çš„ name å±æ€§ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ”¹å˜èµ‹å€¼å¾—åˆ°çš„å¯¹è±¡ obj2 åŒæ—¶ä¹Ÿä¼šæ”¹å˜åŸå§‹å€¼ obj1ï¼Œè€Œæ”¹å˜æµ…æ‹·è´å¾—åˆ°çš„çš„ obj3 åˆ™ä¸ä¼šæ”¹å˜åŸå§‹å¯¹è±¡ obj1ã€‚è¿™å°±å¯ä»¥è¯´æ˜èµ‹å€¼å¾—åˆ°çš„å¯¹è±¡ obj2 åªæ˜¯å°†æŒ‡é’ˆæ”¹å˜ï¼Œå…¶å¼•ç”¨çš„ä»ç„¶æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæµ…æ‹·è´å¾—åˆ°çš„çš„ obj3 åˆ™æ˜¯é‡æ–°åˆ›å»ºäº†æ–°å¯¹è±¡ã€‚ ç„¶è€Œï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥æ¥çœ‹ä¸€ä¸‹æ”¹å˜å¼•ç”¨ç±»å‹ä¼šæ˜¯ä»€ä¹ˆæƒ…å†µå‘¢ï¼Œæˆ‘åˆæ”¹å˜äº†èµ‹å€¼å¾—åˆ°çš„å¯¹è±¡ obj2 å’Œæµ…æ‹·è´å¾—åˆ°çš„ obj3 ä¸­çš„ language å±æ€§çš„ç¬¬äºŒä¸ªå€¼å’Œç¬¬ä¸‰ä¸ªå€¼ï¼ˆlanguage æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯å¼•ç”¨ç±»å‹ï¼‰ã€‚ç»“æœè§è¾“å‡ºï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œæ— è®ºæ˜¯ä¿®æ”¹èµ‹å€¼å¾—åˆ°çš„å¯¹è±¡ obj2 å’Œæµ…æ‹·è´å¾—åˆ°çš„ obj3 éƒ½ä¼šæ”¹å˜åŸå§‹æ•°æ®ã€‚ è¿™æ˜¯å› ä¸ºæµ…æ‹·è´åªå¤åˆ¶ä¸€å±‚å¯¹è±¡çš„å±æ€§ï¼Œå¹¶ä¸åŒ…æ‹¬å¯¹è±¡é‡Œé¢çš„ä¸ºå¼•ç”¨ç±»å‹çš„æ•°æ®ã€‚æ‰€ä»¥å°±ä¼šå‡ºç°æ”¹å˜æµ…æ‹·è´å¾—åˆ°çš„ obj3 ä¸­çš„å¼•ç”¨ç±»å‹æ—¶ï¼Œä¼šä½¿åŸå§‹æ•°æ®å¾—åˆ°æ”¹å˜ã€‚ æ·±æ‹·è´ï¼šå°† B å¯¹è±¡æ‹·è´åˆ° A å¯¹è±¡ä¸­ï¼ŒåŒ…æ‹¬ B é‡Œé¢çš„å­å¯¹è±¡ï¼Œ æµ…æ‹·è´ï¼šå°† B å¯¹è±¡æ‹·è´åˆ° A å¯¹è±¡ä¸­ï¼Œä½†ä¸åŒ…æ‹¬ B é‡Œé¢çš„å­å¯¹è±¡ â€“ å’ŒåŸæ•°æ®æ˜¯å¦æŒ‡å‘åŒä¸€å¯¹è±¡ ç¬¬ä¸€å±‚æ•°æ®ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ åŸæ•°æ®ä¸­åŒ…å«å­å¯¹è±¡ èµ‹å€¼ æ˜¯ æ”¹å˜ä¼šä½¿åŸæ•°æ®ä¸€åŒæ”¹å˜ æ”¹å˜ä¼šä½¿åŸæ•°æ®ä¸€åŒæ”¹å˜ æµ…æ‹·è´ å¦ æ”¹å˜ä¸ä¼šä½¿åŸæ•°æ®ä¸€åŒæ”¹å˜ æ”¹å˜ä¼šä½¿åŸæ•°æ®ä¸€åŒæ”¹å˜ æ·±æ‹·è´ å¦ æ”¹å˜ä¸ä¼šä½¿åŸæ•°æ®ä¸€åŒæ”¹å˜ æ”¹å˜ä¸ä¼šä½¿åŸæ•°æ®ä¸€åŒæ”¹å˜ æ·±æ‹·è´çœ‹äº†è¿™ä¹ˆåŠå¤©ï¼Œä½ ä¹Ÿåº”è¯¥æ¸…æ¥šä»€ä¹ˆæ˜¯æ·±æ‹·è´äº†å§ï¼Œå¦‚æœè¿˜ä¸æ¸…æ¥šï¼Œæˆ‘å°±å‰–è…¹è‡ªå°½(à²¥_à²¥) æ·±æ‹·è´æ˜¯å¯¹å¯¹è±¡ä»¥åŠå¯¹è±¡çš„æ‰€æœ‰å­å¯¹è±¡è¿›è¡Œæ‹·è´ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆè¿›è¡Œæ·±æ‹·è´å‘¢ï¼Ÿ æ€è·¯å°±æ˜¯é€’å½’è°ƒç”¨åˆšåˆšçš„æµ…æ‹·è´ï¼ŒæŠŠæ‰€æœ‰å±äºå¯¹è±¡çš„å±æ€§ç±»å‹éƒ½éå†èµ‹ç»™å¦ä¸€ä¸ªå¯¹è±¡å³å¯ã€‚æˆ‘ä»¬ç›´æ¥æ¥çœ‹ä¸€ä¸‹ Zepto ä¸­æ·±æ‹·è´çš„ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637// å†…éƒ¨æ–¹æ³•ï¼šç”¨æˆ·åˆå¹¶ä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡åˆ°ç¬¬ä¸€ä¸ªå¯¹è±¡// å‚æ•°ï¼š// target ç›®æ ‡å¯¹è±¡ å¯¹è±¡éƒ½åˆå¹¶åˆ°targeté‡Œ// source åˆå¹¶å¯¹è±¡// deep æ˜¯å¦æ‰§è¡Œæ·±åº¦åˆå¹¶function extend(target, source, deep) &#123; for (key in source) if (deep &amp;&amp; (isPlainObject(source[key]) || isArray(source[key]))) &#123; // source[key] æ˜¯å¯¹è±¡ï¼Œè€Œ target[key] ä¸æ˜¯å¯¹è±¡ï¼Œ åˆ™ target[key] = &#123;&#125; åˆå§‹åŒ–ä¸€ä¸‹ï¼Œå¦åˆ™é€’å½’ä¼šå‡ºé”™çš„ if (isPlainObject(source[key]) &amp;&amp; !isPlainObject(target[key])) target[key] = &#123;&#125; // source[key] æ˜¯æ•°ç»„ï¼Œè€Œ target[key] ä¸æ˜¯æ•°ç»„ï¼Œåˆ™ target[key] = [] åˆå§‹åŒ–ä¸€ä¸‹ï¼Œå¦åˆ™é€’å½’ä¼šå‡ºé”™çš„ if (isArray(source[key]) &amp;&amp; !isArray(target[key])) target[key] = [] // æ‰§è¡Œé€’å½’ extend(target[key], source[key], deep) &#125; // ä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œè¯´æ˜ source[key] æ˜¯ä¸€èˆ¬çš„å€¼ç±»å‹ï¼Œç›´æ¥èµ‹å€¼ç»™ target å°±æ˜¯äº† else if (source[key] !== undefined) target[key] = source[key]&#125;// Copy all but undefined properties from one or more// objects to the `target` object.$.extend = function(target)&#123; var deep, args = slice.call(arguments, 1); //ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºbooleanå€¼æ—¶ï¼Œè¡¨ç¤ºæ˜¯å¦æ·±åº¦åˆå¹¶ if (typeof target == &#x27;boolean&#x27;) &#123; deep = target; //targetå–ç¬¬äºŒä¸ªå‚æ•° target = args.shift() &#125; // éå†åé¢çš„å‚æ•°ï¼Œéƒ½åˆå¹¶åˆ°targetä¸Š args.forEach(function(arg)&#123; extend(target, arg, deep) &#125;) return target&#125; åˆ©ç”¨weakMapå®ç°é€’å½’clone123456789101112131415function clone(target, weakMap = new weakMap) &#123; if ((typeof target === &#x27;object&#x27;)) &#123; let cloneTarget = Array.isArray.call(target) ? [] : &#123;&#125;; if (weakMap.get(target)) &#123; return weakMap.get(target); &#125; weakMap.set(target, cloneTarget); for (const key in target) &#123; cloneTarget[key] = clone(target[key], weakMap); &#125; return cloneTarget; &#125; else &#123; return target; &#125;&#125; æ‰©å±•è¿ç®—ç¬¦ï¼ˆâ€¦ï¼‰ æ˜¯ä»€ä¹ˆç±»å‹çš„æ‹·è´ï¼Ÿ æµ…æ‹·è´","tags":["Javascript","ES6","æ·±æ‹·è´ä¸æµ…æ‹·è´"],"categories":["Javascript"]},{"title":"é™æ€ç±»å‹è¯­è¨€ä¸åŠ¨æ€ç±»å‹è¯­è¨€åŒºåˆ«","path":"/2020/03/16/é™æ€ç±»å‹è¯­è¨€ä¸åŠ¨æ€ç±»å‹è¯­è¨€åŒºåˆ«/","content":"ç¼–ç¨‹è¯­è¨€æŒ‰ç…§æ•°æ®ç±»å‹å¤§ä½“å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œå¦ä¸€ç±»æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ åŒºåˆ«é™æ€ç±»å‹è¯­è¨€åœ¨ç¼–è¯‘æ—¶ä¾¿å·²ç¡®å®šå˜é‡çš„ç±»å‹ï¼Œè€ŒåŠ¨æ€ç±»å‹è¯­è¨€çš„å˜é‡ç±»å‹è¦åˆ°ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œå¾…å˜é‡è¢«èµ‹äºˆæŸä¸ªå€¼ä¹‹åï¼Œæ‰ä¼šå…·æœ‰æŸç§ç±»å‹ã€‚ é™æ€ç±»å‹è¯­è¨€çš„ä¼˜ç‚¹é¦–å…ˆæ˜¯åœ¨ç¼–è¯‘æ—¶å°±èƒ½å‘ç°ç±»å‹ä¸åŒ¹é…çš„é”™è¯¯ï¼Œç¼–è¾‘å™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬æå‰é¿å…ç¨‹åºåœ¨è¿è¡ŒæœŸé—´æœ‰å¯èƒ½å‘ç”Ÿçš„ä¸€äº›é”™è¯¯ã€‚å…¶æ¬¡ï¼Œå¦‚æœåœ¨ç¨‹åºä¸­æ˜ç¡®åœ°è§„å®šäº†æ•°æ®ç±»å‹ï¼Œç¼–è¯‘å™¨è¿˜å¯ä»¥é’ˆå¯¹è¿™äº›ä¿¡æ¯å¯¹ç¨‹åºè¿›è¡Œä¸€äº›ä¼˜åŒ–å·¥ä½œï¼Œæé«˜ç¨‹åºæ‰§è¡Œé€Ÿåº¦ é™æ€ç±»å‹è¯­è¨€çš„ç¼ºç‚¹é¦–å…ˆæ˜¯è¿«ä½¿ç¨‹åºå‘˜ä¾ç…§å¼ºå¥‘çº¦æ¥ç¼–å†™ç¨‹åºï¼Œä¸ºæ¯ä¸ªå˜é‡è§„å®šæ•°æ®ç±»å‹ï¼Œå½’æ ¹ç»“åº•åªæ˜¯è¾…åŠ©æˆ‘ä»¬ç¼–å†™å¯é æ€§é«˜ç¨‹åºçš„ä¸€ç§æ‰‹æ®µï¼Œè€Œä¸æ˜¯ç¼–å†™ç¨‹åºçš„ç›®çš„ï¼Œæ¯•ç«Ÿå¤§éƒ¨åˆ†äººç¼–å†™ç¨‹åºçš„ç›®çš„æ˜¯ä¸ºäº†å®Œæˆéœ€æ±‚äº¤ä»˜ç”Ÿäº§ã€‚å…¶æ¬¡ï¼Œç±»å‹çš„å£°æ˜ä¹Ÿä¼šå¢åŠ æ›´å¤šçš„ä»£ç ï¼Œåœ¨ç¨‹åºç¼–å†™è¿‡ç¨‹ä¸­ï¼Œè¿™äº›ç»†èŠ‚ä¼šè®©ç¨‹åºå‘˜çš„ç²¾åŠ›ä»æ€è€ƒä¸šåŠ¡é€»è¾‘ä¸Šåˆ†æ•£å¼€æ¥ã€‚ åŠ¨æ€ç±»å‹è¯­è¨€çš„ä¼˜ç‚¹æ˜¯ç¼–å†™çš„ä»£ç æ•°é‡æ›´å°‘ï¼Œçœ‹èµ·æ¥ä¹Ÿæ›´åŠ ç®€æ´ï¼Œç¨‹åºå‘˜å¯ä»¥æŠŠç²¾åŠ›æ›´å¤šåœ°æ”¾åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šé¢ã€‚è™½ç„¶ä¸åŒºåˆ†ç±»å‹åœ¨æŸäº›æƒ…å†µä¸‹ä¼šè®©ç¨‹åºå˜å¾—éš¾ä»¥ç†è§£ï¼Œä½†æ•´ä½“è€Œè¨€ï¼Œä»£ç é‡è¶Šå°‘ï¼Œè¶Šä¸“æ³¨äºé€»è¾‘è¡¨è¾¾ï¼Œå¯¹é˜…è¯»ç¨‹åºæ˜¯è¶Šæœ‰å¸®åŠ©çš„ã€‚ åŠ¨æ€ç±»å‹è¯­è¨€çš„ç¼ºç‚¹æ˜¯æ— æ³•ä¿è¯å˜é‡çš„ç±»å‹ï¼Œä»è€Œåœ¨ç¨‹åºçš„è¿è¡ŒæœŸæœ‰å¯èƒ½å‘ç”Ÿè·Ÿç±»å‹ç›¸å…³çš„é”™è¯¯ã€‚ javascriptæ˜¯ä¸€é—¨åŠ¨æ€ç±»å‹è¯­è¨€ï¼ŒåŠ¨æ€ç±»å‹è¯­è¨€å¯¹å˜é‡ç±»å‹çš„å®½å®¹ç»™å®é™…ç¼–ç å¸¦æ¥äº†å¾ˆå¤§çš„çµæ´»æ€§ã€‚ç”±äºæ— éœ€è¿›è¡Œç±»å‹æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•è°ƒç”¨ä»»ä½•å¯¹è±¡çš„ä»»æ„æ–¹æ³•ï¼Œè€Œæ— éœ€å»è€ƒè™‘å®ƒåŸæœ¬æ˜¯å¦è¢«è®¾è®¡ä¸ºæ‹¥æœ‰è¯¥æ–¹æ³•ã€‚","tags":["è®¾è®¡æ¨¡å¼"],"categories":["Javascript"]},{"title":"é«˜é˜¶ç»„ä»¶","path":"/2020/03/16/é«˜é˜¶ç»„ä»¶/","content":"é«˜é˜¶ç»„ä»¶1.é«˜é˜¶ç»„ä»¶å®šä¹‰ é«˜é˜¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸”è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ 2.å‡½æ•°æ¨¡æ‹Ÿé«˜é˜¶å‡½æ•°12345678910function banana() &#123; let name = &#x27;wengkaimin&#x27;; console.log(`$&#123;name&#125; likes banana`);&#125;function apple(myName) &#123; let name = &#x27;wengkaimin&#x27;; console.log(`$&#123;name&#125; likes apple`);&#125;banana();apple(); ä»¥ä¸Šæœ‰å†—ä½™çš„ä»£ç ï¼Œåœ¨å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæœ‰ä¸€å¤§å †å†™ä¸€ä¸ªä¸­é—´å‡½æ•°æ¥å¤„ç†è¿™ä¸ªç›¸åŒçš„ä»£ç  1234567891011121314151617function banana(myName) &#123; console.log(`$&#123;myName&#125; likes banana`);&#125;function apple(myName) &#123; console.log(`$&#123;myName&#125; likes apple`)&#125;function getFruit(fun) &#123; let myFruit = (() =&gt; &#123; let myName = &#x27;wengkaimin&#x27;; fun(myName); &#125;) return myFruit&#125;banana = getFruit(banana);apple = getFruit(apple);banana();apple(); getFruitå‡½æ•°å°±å«åšä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œä»–å¸®æˆ‘ä»¬å¤„ç†äº†å‰é¢ä¸¤ä¸ªå‡½æ•°çš„ç›¸åŒæ¨¡å—ï¼Œå¸®å¿™æŠŠmyNameè‡ªåŠ¨çš„åŠ å…¥äº†æ‰€æœ‰ç»§æ‰¿getFruitçš„å‡½æ•°ï¼Œæ­¤åœºæ™¯åœ¨reactä¸­çš„é«˜é˜¶ç»„ä»¶æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚ 3.reactä¸­çš„é«˜é˜¶ç»„ä»¶æ”¹æˆreacté«˜é˜¶ç»„ä»¶å½¢å¼ 1234567891011121314151617181920212223242526import React, &#123; Component &#125; from &#x27;react&#x27;class Banana extends Component &#123; constructor(props) &#123; super(props); this.state = &#123; username: &#x27;&#x27; &#125; &#125; componentWillMount() &#123; let username = &#x27;wengkaimin&#x27; this.setState(&#123; username: username &#125;) &#125; render() &#123; return ( &lt;div&gt; &#123;this.state.username&#125; likes banana&lt;/div&gt; ) &#125;&#125;export default Banana; 1234567891011121314151617181920212223242526import React, &#123; Component &#125; from &#x27;react&#x27;class Apple extends Component &#123; constructor(props) &#123; super(props); this.state = &#123; username: &#x27;&#x27; &#125; &#125; componentWillMount() &#123; let username = &#x27;wengkaimin&#x27; this.setState(&#123; username: username &#125;) &#125; render() &#123; return ( &lt;div&gt; &#123;this.state.username&#125; likes apple&lt;/div&gt; ) &#125;&#125;export default Apple; ä»ä¸¤æ®µä»£ç æ¥çœ‹æœ‰å¾ˆå¤šé‡å¤çš„ç»„ä»¶ä»£ç ã€‚æŒ‰ç…§é«˜é˜¶å‡½æ•°çš„æ€æƒ³æˆ‘ä»¬ä¸­é—´å°è£…ä¸€ä¸ªé«˜é˜¶ç»„ä»¶æ¥å¤„ç†è¿™äº›ä¸œè¥¿ã€‚ 12345678910111213141516171819202122232425import React, &#123;Component&#125; from &#x27;react&#x27;export default (fruitComponent) =&gt; &#123; class Myfruit extends Component &#123; constructor() &#123; super(); this.state = &#123; username: &#x27;&#x27; &#125; &#125; componentWillMount() &#123; let username = &#x27;wengkaimin&#x27; this.setState(&#123; username: username &#125;) &#125; render() &#123; return &lt;fruitComponent username=&#123;this.state.username&#125;/&gt; &#125; &#125; return Myfruit&#125; ç®€åŒ–appleå’Œbananaç»„ä»¶ 123456789101112131415import React, &#123;Component&#125; from &#x27;react&#x27;;import Myfruit from &#x27;Myfruit&#x27;;class Banana extends Component &#123; render() &#123; return ( &lt;div&gt; &#123;this.props.username&#125; likes banana&lt;/div&gt; ) &#125;&#125;Banana = Myfruit(Banana);export default Banana; åŒç†appleé«˜é˜¶ç»„ä»¶æŠŠusernameé€šè¿‡propsæŠŠä»–ä¼ ç»™ç›®æ ‡ç»„ä»¶ã€‚","tags":["é«˜é˜¶ç»„ä»¶","ç»„ä»¶"],"categories":["Javascript"]},{"title":"this,callå’Œapply","path":"/2020/03/16/this-callå’Œapply/","content":"this, call å’Œapply1. this JavaScriptçš„ this æ€»æ˜¯æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œå…·ä½“æŒ‡å‘å“ªä¸ªå¯¹è±¡æ˜¯åœ¨è¿è¡Œæ—¶åŸºäºå‡½æ•°çš„æ‰§è¡Œç¯å¢ƒåŠ¨æ€ç»‘å®šçš„ï¼Œè€Œéå‡½æ•°è¢«å£°æ˜æ—¶çš„ç¯å¢ƒ 1.1 thisæŒ‡å‘ ä½œä¸ºå¯¹è±¡æ–¹æ³•è°ƒç”¨ ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨ æ„é€ å™¨è°ƒç”¨ Function.prototype.applyæˆ–``Function.prototype.call` 1.1.1 ä½œä¸ºå¯¹è±¡æ–¹æ³•è°ƒç”¨12345678var obj = &#123; a:1, getA:function()&#123; alert(this === obj); alert(this.a); &#125;&#125;obj.getA(); 1.1.2 ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨å½“å‡½æ•°ä¸ä½œä¸ºå¯¹è±¡çš„å±æ€§è¢«è°ƒç”¨æ—¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„æ™®é€šå‡½æ•°æ–¹å¼ï¼Œæ­¤æ—¶çš„ this æ€»æ˜¯æŒ‡å‘å…¨å±€å¯¹è±¡ã€‚åœ¨æµè§ˆå™¨çš„ JavaScripté‡Œï¼Œè¿™ä¸ªå…¨å±€å¯¹è±¡æ˜¯ window å¯¹è±¡ 123456789window.name = &#x27;globalName&#x27;;var myObject = &#123; name: &#x27;sven&#x27;, getName: function () &#123; return this.name; &#125;&#125;;var getName = myObject.getName; //ä½œä¸ºæ™®é€šå‡½æ•°ï¼Œè¿™æ—¶å€™thisæŒ‡å‘å…¨å±€ï¼Œå› ä¸ºå®ƒä¸æ˜¯ä»¥å¯¹è±¡çš„å±æ€§è°ƒç”¨çš„ï¼Œå¯ä»¥çœ‹1.2console.log(getName()); // globalName 1.1.3 æ„é€ å™¨è°ƒç”¨ JavaScript ä¸­æ²¡æœ‰ç±»ï¼Œä½†æ˜¯å¯ä»¥ä»æ„é€ å™¨ä¸­åˆ›å»ºå¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº† new è¿ç®—ç¬¦ï¼Œä½¿å¾—æ„é€ å™¨çœ‹èµ·æ¥æ›´åƒä¸€ä¸ªç±» é™¤äº†å®¿ä¸»æä¾›çš„ä¸€äº›å†…ç½®å‡½æ•°ï¼Œå¤§éƒ¨åˆ† JavaScriptå‡½æ•°éƒ½å¯ä»¥å½“ä½œæ„é€ å™¨ä½¿ç”¨ã€‚æ„é€ å™¨çš„å¤–è¡¨è·Ÿæ™®é€šå‡½æ•°ä¸€æ¨¡ä¸€æ ·ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºè¢«è°ƒç”¨çš„æ–¹å¼ã€‚å½“ç”¨ new è¿ç®—ç¬¦è°ƒç”¨å‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°æ€»ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæ„é€ å™¨é‡Œçš„ this å°±æŒ‡å‘è¿”å›çš„è¿™ä¸ªå¯¹è±¡ 12345var MyClass = function()&#123;this.name = &#x27;sven&#x27;;&#125;;var obj = new MyClass();alert ( obj.name ); // è¾“å‡ºï¼šsven ä½†ç”¨ new è°ƒç”¨æ„é€ å™¨æ—¶ï¼Œè¿˜è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæ„é€ å™¨æ˜¾å¼åœ°è¿”å›äº†ä¸€ä¸ª object ç±»å‹çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤æ¬¡è¿ç®—ç»“æœæœ€ç»ˆä¼šè¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬ä¹‹å‰æœŸå¾…çš„ this 12345678var MyClass = function()&#123;this.name = &#x27;sven&#x27;;return &#123; // æ˜¾å¼åœ°è¿”å›ä¸€ä¸ªå¯¹è±¡name: &#x27;anne&#x27;&#125;&#125;;var obj = new MyClass();alert ( obj.name ); // è¾“å‡ºï¼šanne å¦‚æœæ„é€ å™¨ä¸æ˜¾å¼åœ°è¿”å›ä»»ä½•æ•°æ®ï¼Œæˆ–è€…æ˜¯è¿”å›ä¸€ä¸ªéå¯¹è±¡ç±»å‹çš„æ•°æ®ï¼Œå°±ä¸ä¼šé€ æˆä¸Šè¿°é—®é¢˜ï¼š 123456var MyClass = function()&#123;this.name = &#x27;sven&#x27;return &#x27;anne&#x27;; // è¿”å› string ç±»å‹&#125;;var obj = new MyClass();alert ( obj.name ); // è¾“å‡ºï¼šsven 1.1.4 Function.prototype.call æˆ– Function.prototype.apply è°ƒç”¨è·Ÿæ™®é€šçš„å‡½æ•°è°ƒç”¨ç›¸æ¯”ï¼Œç”¨ Function.prototype.call æˆ– Function.prototype.apply å¯ä»¥åŠ¨æ€åœ°æ”¹å˜ä¼ å…¥å‡½æ•°çš„ this ï¼š 1234567891011var obj1 = &#123;\tname: &#x27;sven&#x27;,\tgetName: function()&#123; return this.name;\t&#125;&#125;;var obj2 = &#123;\tname: &#x27;anne&#x27;&#125;;console.log( obj1.getName() ); // è¾“å‡º: svenconsole.log( obj1.getName.call( obj2 ) ); // è¾“å‡ºï¼šanne 1.2 ä¸¢å¤±çš„this123456789var obj = &#123;myName: &#x27;sven&#x27;,\tgetName: function()&#123;\treturn this.myName;\t&#125;&#125;;console.log( obj.getName() ); // è¾“å‡ºï¼š&#x27;sven&#x27;var getName2 = obj.getName;console.log( getName2() ); // è¾“å‡ºï¼šundefined å½“è°ƒç”¨ obj.getName æ—¶ï¼Œ getName æ–¹æ³•æ˜¯ä½œä¸º obj å¯¹è±¡çš„å±æ€§è¢«è°ƒç”¨çš„ï¼Œå½“ç”¨å¦å¤–ä¸€ä¸ªå˜é‡ getName2 æ¥å¼•ç”¨ obj.getName ï¼Œå¹¶ä¸”è°ƒç”¨getName2 æ—¶ï¼Œæ­¤æ—¶æ˜¯ä»¥æ™®é€šå‡½æ•°çš„å½¢å¼æ¥è°ƒç”¨çš„ï¼Œ this æ˜¯æŒ‡å‘å…¨å±€ window çš„ å†æ¥ä¸ªæ —å­ 12345678document.getElementById = (function( func )&#123;\treturn function()&#123; return func.apply( document, arguments );&#125;&#125;)( document.getElementById );var getId = document.getElementById;var div = getId( &#x27;div1&#x27; );alert (div.id); // è¾“å‡ºï¼š div1 åˆ©ç”¨ apply æŠŠ document å½“ä½œ this ä¼ å…¥ getId å‡½æ•°ï¼Œå¸®åŠ©â€œä¿®æ­£â€ this å¦åˆ™å¦‚æœæƒ³è¦ç®€åŒ–document.getElementByIdå•çº¯çš„æ˜¯ä¸å¯å–çš„ 12var getId = document.getElementById; console.log(getId(&#x27;hello&#x27;)); 2. call å’Œapply2.1 åŒºåˆ«Function.prototype.callå’Œ Function.prototype.applyéƒ½æ˜¯éå¸¸å¸¸ç”¨çš„æ–¹æ³•ã€‚å®ƒä»¬çš„ä½œç”¨ä¸€æ¨¡ä¸€æ ·ï¼ŒåŒºåˆ«ä»…åœ¨äºä¼ å…¥å‚æ•°å½¢å¼çš„ä¸åŒ apply æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šäº†å‡½æ•°ä½“å†… this å¯¹è±¡çš„æŒ‡å‘ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªå¸¦ä¸‹æ ‡çš„é›†åˆï¼Œè¿™ä¸ªé›†åˆå¯ä»¥ä¸ºæ•°ç»„ï¼Œä¹Ÿå¯ä»¥ä¸ºç±»æ•°ç»„,apply æ–¹æ³•æŠŠè¿™ä¸ªé›†åˆä¸­çš„å…ƒç´ ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¢«è°ƒç”¨çš„å‡½æ•° call ä¼ å…¥çš„å‚æ•°æ•°é‡ä¸å›ºå®šï¼Œè·Ÿ apply ç›¸åŒçš„æ˜¯ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿæ˜¯ä»£è¡¨å‡½æ•°ä½“å†…çš„ this æŒ‡å‘ï¼Œä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹å¾€åï¼Œæ¯ä¸ªå‚æ•°è¢«ä¾æ¬¡ä¼ å…¥å‡½æ•° 123456var func = function (a, b, c) &#123; alert([a, b, c]); // è¾“å‡º [ 1, 2, 3 ]&#125;;func.call(null, 1, 2, 3);func.apply(null, [1, 2, 3]); å½“è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼ŒJavaScript çš„è§£é‡Šå™¨å¹¶ä¸ä¼šè®¡è¾ƒå½¢å‚å’Œå®å‚åœ¨æ•°é‡ã€ç±»å‹ä»¥åŠé¡ºåºä¸Šçš„åŒºåˆ«ï¼ŒJavaScriptçš„å‚æ•°åœ¨å†…éƒ¨å°±æ˜¯ç”¨ä¸€ä¸ªæ•°ç»„æ¥è¡¨ç¤ºçš„ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼Œ apply æ¯” call çš„ä½¿ç”¨ç‡æ›´é«˜ï¼Œæˆ‘ä»¬ä¸å¿…å…³å¿ƒå…·ä½“æœ‰å¤šå°‘å‚æ•°è¢«ä¼ å…¥å‡½æ•°ï¼Œåªè¦ç”¨ apply ä¸€è‚¡è„‘åœ°æ¨è¿‡å»å°±å¯ä»¥äº† å½“ä½¿ç”¨ call æˆ–è€… apply çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸º null ï¼Œå‡½æ•°ä½“å†…çš„ this ä¼šæŒ‡å‘é»˜è®¤çš„å®¿ä¸»å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ä¸­åˆ™æ˜¯ window æœ‰æ—¶å€™æˆ‘ä»¬ä½¿ç”¨ call æˆ–è€… apply çš„ç›®çš„ä¸åœ¨äºæŒ‡å®š this æŒ‡å‘ï¼Œè€Œæ˜¯å¦æœ‰ç”¨é€”ï¼Œæ¯”å¦‚å€Ÿç”¨å…¶ä»–å¯¹è±¡çš„æ–¹æ³•ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä¼ å…¥ null æ¥ä»£æ›¿æŸä¸ªå…·ä½“çš„å¯¹è±¡ï¼š 1Math.max.apply( null, [ 1, 2, 5, 3, 4 ] ) // è¾“å‡ºï¼š5 2.2 call å’Œ apply çš„ç”¨é€”2.2.1 æ”¹å˜ this æŒ‡å‘12345678910111213window.name = &#x27;motherfucker&#x27;;obj1 = &#123; name: &#x27;helloobj1&#x27;,&#125;obj2 = &#123; name: &#x27;hellowobj2&#x27;,&#125;var getName = function () &#123; console.log(this.name);&#125;getName();getName.apply(obj1);getName.apply(obj2); å®é™…å¼€å‘è¿‡ç¨‹ä¸­ä¼šé‡åˆ°thisæŒ‡å‘è¢«ä¸ç»æ„æ”¹å˜ ä¾‹å¦‚ï¼š 123document.getElementById( &#x27;div1&#x27; ).onclick = function()&#123;\talert( this.id ); // è¾“å‡ºï¼šdiv1&#125;; å‡å¦‚è¯¥äº‹ä»¶å‡½æ•°ä¸­æœ‰ä¸€ä¸ªå†…éƒ¨å‡½æ•° func ï¼Œåœ¨äº‹ä»¶å†…éƒ¨è°ƒç”¨ func å‡½æ•°æ—¶ï¼Œ func å‡½æ•°ä½“å†…çš„ thiså°±æŒ‡å‘äº† window ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬é¢„æœŸçš„ div 1234567document.getElementById( &#x27;div1&#x27; ).onclick = function()&#123;\talert( this.id ); // è¾“å‡ºï¼šdiv1\tvar func = function()&#123; alert ( this.id ); // è¾“å‡ºï¼šundefined\t&#125;\tfunc();&#125;; è§£å†³æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä¹‹å‰æåˆ°çš„ 12345678document.getElementById(&#x27;hello&#x27;).onclick = function () &#123; var that = this; console.log(that.id); // è¾“å‡ºï¼šhello var func = function () &#123; console.log(that.id); // è¾“å‡ºï¼šundefined &#125; func();&#125;; ç¬¬äºŒç§å°±æ˜¯callå’Œapply 123456document.getElementById( &#x27;div1&#x27; ).onclick = function()&#123;\tvar func = function()&#123; alert ( this.id ); // è¾“å‡ºï¼šdiv1\t&#125;\tfunc.call( this );&#125;;","tags":["javascript","Javascript thisæŒ‡å‘","call,apply"],"categories":["Javascript"]},{"title":"å¤šæ€","path":"/2020/03/16/å¤šæ€/","content":"å¤šæ€çš„å®é™…å«ä¹‰æ˜¯ï¼šåŒä¸€æ“ä½œä½œç”¨äºä¸åŒçš„å¯¹è±¡ä¸Šé¢ï¼Œå¯ä»¥äº§ç”Ÿä¸åŒçš„è§£é‡Šå’Œä¸åŒçš„æ‰§è¡Œç»“æœã€‚æ¢å¥è¯è¯´ï¼Œç»™ä¸åŒçš„å¯¹è±¡å‘é€åŒä¸€ä¸ªæ¶ˆæ¯çš„æ—¶å€™ï¼Œè¿™äº›å¯¹è±¡ä¼šæ ¹æ®è¿™ä¸ªæ¶ˆæ¯åˆ†åˆ«ç»™å‡ºä¸åŒçš„åé¦ˆã€‚ 123456789101112var makeSound = function (animal) &#123; if(animal instanceof Duck)&#123; console.log(&#x27;å˜å˜å˜&#x27;); &#125;else if(animal instanceof Dog)&#123; console.log(&#x27;æ±ªæ±ª&#x27;); &#125;&#125;var Duck = function()&#123;&#125;;var Dog = function()&#123;&#125;;makeSound(new Duck());makeSound(new Dog()); â€‹ è¿™æ®µä»£ç ç¡®å®ä½“ç°äº†â€œå¤šæ€æ€§â€ï¼Œå½“æˆ‘ä»¬åˆ†åˆ«å‘é¸­å’Œé¸¡å‘å‡ºâ€œå«å”¤â€çš„æ¶ˆæ¯æ—¶ï¼Œå®ƒä»¬æ ¹æ®æ­¤æ¶ˆæ¯ä½œå‡ºäº†å„è‡ªä¸åŒçš„ååº”ã€‚ä½†è¿™æ ·çš„â€œå¤šæ€æ€§â€æ˜¯æ— æ³•ä»¤äººæ»¡æ„çš„ï¼Œå¦‚æœåæ¥åˆå¢åŠ äº†ä¸€åªåŠ¨ç‰©ï¼Œæ¯”å¦‚ç‹—ï¼Œæ˜¾ç„¶ç‹—çš„å«å£°æ˜¯â€œæ±ªæ±ªæ±ªâ€ï¼Œæ­¤æ—¶æˆ‘ä»¬å¿…é¡»å¾—æ”¹åŠ¨ makeSound å‡½æ•°ï¼Œæ‰èƒ½è®©ç‹—ä¹Ÿå‘å‡ºå«å£°ã€‚ä¿®æ”¹ä»£ç æ€»æ˜¯å±é™©çš„ï¼Œä¿®æ”¹çš„åœ°æ–¹è¶Šå¤šï¼Œç¨‹åºå‡ºé”™çš„å¯èƒ½æ€§å°±è¶Šå¤§ï¼Œè€Œä¸”å½“åŠ¨ç‰©çš„ç§ç±»è¶Šæ¥è¶Šå¤šæ—¶ï¼Œ makeSound æœ‰å¯èƒ½å˜æˆä¸€ä¸ªå·¨å¤§çš„å‡½æ•°ã€‚ â€‹ å¤šæ€èƒŒåçš„æ€æƒ³æ˜¯å°†â€œåšä»€ä¹ˆâ€å’Œâ€œè°å»åšä»¥åŠæ€æ ·å»åšâ€åˆ†ç¦»å¼€æ¥ï¼Œä¹Ÿå°±æ˜¯å°†â€œä¸å˜çš„äº‹ç‰©â€ä¸ â€œå¯èƒ½æ”¹å˜çš„äº‹ç‰©â€åˆ†ç¦»å¼€æ¥ã€‚åœ¨è¿™ä¸ªæ•…äº‹ä¸­ï¼ŒåŠ¨ç‰©éƒ½ä¼šå«ï¼Œè¿™æ˜¯ä¸å˜çš„ï¼Œä½†æ˜¯ä¸åŒç±»å‹çš„åŠ¨ç‰©å…·ä½“æ€ä¹ˆå«æ˜¯å¯å˜çš„ã€‚æŠŠä¸å˜çš„éƒ¨åˆ†éš”ç¦»å‡ºæ¥ï¼ŒæŠŠå¯å˜çš„éƒ¨åˆ†å°è£…èµ·æ¥ï¼Œè¿™ç»™äºˆäº†æˆ‘ä»¬æ‰©å±•ç¨‹åºçš„èƒ½åŠ›ï¼Œç¨‹åºçœ‹èµ·æ¥æ˜¯å¯ç”Ÿé•¿çš„ï¼Œä¹Ÿæ˜¯ç¬¦åˆå¼€æ”¾ â€” å°é—­åŸåˆ™çš„ï¼Œç›¸å¯¹äºä¿®æ”¹ä»£ç æ¥è¯´ï¼Œä»…ä»…å¢åŠ ä»£ç å°±èƒ½å®ŒæˆåŒæ ·çš„åŠŸèƒ½ï¼Œè¿™æ˜¾ç„¶ä¼˜é›…å’Œå®‰å…¨å¾—å¤š 1. å¯¹è±¡çš„å¤šæ€æ€§12345678910111213141516var makeSound = function (animal) &#123; if (typeof animal === &#x27;object&#x27; &amp;&amp; animal.sound) &#123; animal.sound(); &#125; else &#123; console.log(&#x27;æˆ‘ä¸æ˜¯åŠ¨ç‰©æˆ‘ä¸èƒ½å«&#x27;) &#125;&#125;var Duck = function () &#123; &#125;;var Dog = function () &#123; &#125;;Duck.prototype.sound = function () &#123; console.log(&#x27;å˜å˜å˜å˜&#x27;);&#125;makeSound(new Duck());makeSound(new Dog()); 2. JavaScriptçš„å¤šæ€å¤šæ€çš„æ€æƒ³å®é™…ä¸Šæ˜¯æŠŠâ€œåšä»€ä¹ˆâ€å’Œâ€œè°å»åšâ€åˆ†ç¦»å¼€æ¥ï¼Œè¦å®ç°è¿™ä¸€ç‚¹ï¼Œå½’æ ¹ç»“åº•å…ˆè¦æ¶ˆé™¤ç±»å‹ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚å¦‚æœç±»å‹ä¹‹é—´çš„è€¦åˆå…³ç³»æ²¡æœ‰è¢«æ¶ˆé™¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ makeSound æ–¹æ³•ä¸­æŒ‡å®šäº†å‘å‡ºå«å£°çš„å¯¹è±¡æ˜¯æŸä¸ªç±»å‹ï¼Œå®ƒå°±ä¸å¯èƒ½å†è¢«æ›¿æ¢ä¸ºå¦å¤–ä¸€ä¸ªç±»å‹ã€‚ åœ¨ Javaä¸­ï¼Œå¯ä»¥é€šè¿‡å‘ä¸Šè½¬å‹æ¥å®ç°å¤šæ€ã€‚ è€Œ JavaScriptçš„å˜é‡ç±»å‹åœ¨è¿è¡ŒæœŸæ˜¯å¯å˜çš„ã€‚ä¸€ä¸ª JavaScriptå¯¹è±¡ï¼Œæ—¢å¯ä»¥è¡¨ç¤º Duck ç±»å‹çš„å¯¹è±¡ï¼Œåˆå¯ä»¥è¡¨ç¤º Chicken ç±»å‹çš„å¯¹è±¡ï¼Œè¿™æ„å‘³ç€ JavaScriptå¯¹è±¡çš„å¤šæ€æ€§æ˜¯ä¸ç”Ÿä¿±æ¥çš„ è¿™ç§ä¸ç”Ÿä¿±æ¥çš„å¤šæ€æ€§å¹¶ä¸éš¾è§£é‡Šã€‚JavaScriptä½œä¸ºä¸€é—¨åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œå®ƒåœ¨ç¼–è¯‘æ—¶æ²¡æœ‰ç±»å‹æ£€æŸ¥çš„è¿‡ç¨‹ï¼Œæ—¢æ²¡æœ‰æ£€æŸ¥åˆ›å»ºçš„å¯¹è±¡ç±»å‹ï¼Œåˆæ²¡æœ‰æ£€æŸ¥ä¼ é€’çš„å‚æ•°ç±»å‹ã€‚ ç”±æ­¤å¯è§ï¼ŒæŸä¸€ç§åŠ¨ç‰©èƒ½å¦å‘å‡ºå«å£°ï¼Œåªå–å†³äºå®ƒæœ‰æ²¡æœ‰ makeSound æ–¹æ³•ï¼Œè€Œä¸å–å†³äºå®ƒæ˜¯å¦æ˜¯æŸç§ç±»å‹çš„å¯¹è±¡ï¼Œè¿™é‡Œä¸å­˜åœ¨ä»»ä½•ç¨‹åº¦ä¸Šçš„â€œç±»å‹è€¦åˆâ€ã€‚åœ¨ JavaScriptä¸­ï¼Œå¹¶ä¸éœ€è¦è¯¸å¦‚å‘ä¸Šè½¬å‹ä¹‹ç±»çš„æŠ€æœ¯æ¥å–å¾—å¤šæ€çš„æ•ˆæœã€‚ 3. å¤šæ€åœ¨é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„ä½œç”¨æœ‰è®¸å¤šäººè®¤ä¸ºï¼Œå¤šæ€æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ä¸­æœ€é‡è¦çš„æŠ€æœ¯ã€‚ä½†æˆ‘ä»¬ç›®å‰è¿˜å¾ˆéš¾çœ‹å‡ºè¿™ä¸€ç‚¹ï¼Œæ¯•ç«Ÿå¤§éƒ¨åˆ†äººéƒ½ä¸å…³å¿ƒé¸¡æ˜¯æ€ä¹ˆå«çš„ï¼Œä¹Ÿä¸æƒ³çŸ¥é“é¸­æ˜¯æ€ä¹ˆå«çš„ã€‚è®©é¸¡å’Œé¸­åœ¨åŒä¸€ä¸ªæ¶ˆæ¯ä¹‹ä¸‹å‘å‡ºä¸åŒçš„å«å£°ï¼Œè¿™è·Ÿç¨‹åºå‘˜æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ Martin Fowleråœ¨ã€Šé‡æ„ï¼šæ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹é‡Œå†™åˆ°ï¼šå¤šæ€çš„æœ€æ ¹æœ¬å¥½å¤„åœ¨äºï¼Œä½ ä¸å¿…å†å‘å¯¹è±¡è¯¢é—®â€œä½ æ˜¯ä»€ä¹ˆç±»å‹â€è€Œåæ ¹æ®å¾—åˆ°çš„ç­”æ¡ˆè°ƒç”¨å¯¹è±¡çš„æŸä¸ªè¡Œä¸ºâ€”â€”ä½ åªç®¡è°ƒç”¨è¯¥è¡Œä¸ºå°±æ˜¯äº†ï¼Œå…¶ä»–çš„ä¸€åˆ‡å¤šæ€æœºåˆ¶éƒ½ä¼šä¸ºä½ å®‰æ’å¦¥å½“ã€‚ æ¢å¥è¯è¯´ï¼Œå¤šæ€æœ€æ ¹æœ¬çš„ä½œç”¨å°±æ˜¯é€šè¿‡æŠŠè¿‡ç¨‹åŒ–çš„æ¡ä»¶åˆ†æ”¯è¯­å¥è½¬åŒ–ä¸ºå¯¹è±¡çš„å¤šæ€æ€§ï¼Œä»è€Œæ¶ˆé™¤è¿™äº›æ¡ä»¶åˆ†æ”¯è¯­å¥ã€‚ Martin Fowlerçš„è¯å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªä¾‹å­å¾ˆå¥½åœ°è¯ é‡Šï¼š åœ¨ç”µå½±çš„æ‹æ‘„ç°åœºï¼Œå½“å¯¼æ¼”å–Šå‡ºâ€œactionâ€æ—¶ï¼Œä¸»è§’å¼€å§‹èƒŒå°è¯ï¼Œç…§æ˜å¸ˆè´Ÿè´£æ‰“ç¯å…‰ï¼Œåé¢çš„ç¾¤ä¼—æ¼”å‘˜å‡è£…ä¸­æªå€’åœ°ï¼Œé“å…·å¸ˆå¾€é•œå¤´é‡Œæ’’ä¸Šé›ªèŠ±ã€‚åœ¨å¾—åˆ°åŒä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½çŸ¥é“è‡ªå·±åº”è¯¥åšä»€ä¹ˆã€‚å¦‚æœä¸åˆ©ç”¨å¯¹è±¡çš„å¤šæ€æ€§ï¼Œè€Œæ˜¯ç”¨é¢å‘è¿‡ç¨‹çš„æ–¹å¼æ¥ç¼–å†™è¿™ä¸€æ®µä»£ç ï¼Œé‚£ä¹ˆç›¸å½“äºåœ¨ç”µå½±å¼€å§‹æ‹æ‘„ä¹‹åï¼Œå¯¼æ¼”æ¯æ¬¡éƒ½è¦èµ°åˆ°æ¯ä¸ªäººçš„é¢å‰ï¼Œç¡®è®¤å®ƒä»¬çš„èŒä¸šåˆ†å·¥ï¼ˆç±»å‹ï¼‰ï¼Œç„¶åå‘Šè¯‰ä»–ä»¬è¦åšä»€ä¹ˆã€‚å¦‚æœæ˜ å°„åˆ°ç¨‹åºä¸­ï¼Œé‚£ä¹ˆç¨‹åºä¸­å°†å……æ–¥ç€æ¡ä»¶åˆ†æ”¯è¯­å¥ã€‚ åˆ©ç”¨å¯¹è±¡çš„å¤šæ€æ€§ï¼Œå¯¼æ¼”åœ¨å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œå°±ä¸å¿…è€ƒè™‘å„ä¸ªå¯¹è±¡æ¥åˆ°æ¶ˆæ¯ååº”è¯¥åšä»€ä¹ˆã€‚å¯¹è±¡åº”è¯¥åšä»€ä¹ˆå¹¶ä¸æ˜¯ä¸´æ—¶å†³å®šçš„ï¼Œè€Œæ˜¯å·²ç»äº‹å…ˆçº¦å®šå’Œæ’ç»ƒå®Œæ¯•çš„ã€‚æ¯ä¸ªå¯¹è±¡åº”è¯¥åšä»€ä¹ˆï¼Œå·²ç»æˆä¸ºäº†è¯¥å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¢«å®‰è£…åœ¨å¯¹è±¡çš„å†…éƒ¨ï¼Œæ¯ä¸ªå¯¹è±¡è´Ÿè´£å®ƒä»¬è‡ªå·±çš„è¡Œä¸ºã€‚æ‰€ä»¥è¿™äº›å¯¹è±¡å¯ä»¥æ ¹æ®åŒä¸€ä¸ªæ¶ˆæ¯ï¼Œæœ‰æ¡ä¸ç´Šåœ°åˆ†åˆ«è¿›è¡Œå„è‡ªçš„å·¥ä½œã€‚ å°†è¡Œä¸ºåˆ†å¸ƒåœ¨å„ä¸ªå¯¹è±¡ä¸­ï¼Œå¹¶è®©è¿™äº›å¯¹è±¡å„è‡ªè´Ÿè´£è‡ªå·±çš„è¡Œä¸ºï¼Œè¿™æ­£æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„ä¼˜ç‚¹ã€‚","tags":["è®¾è®¡æ¨¡å¼","å¤šæ€"],"categories":["Javascript"]},{"title":"å°è£…","path":"/2020/03/16/å°è£…/","content":"å°è£…å°è£…çš„ç›®çš„æ˜¯å°†ä¿¡æ¯éšè—ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬è®¨è®ºçš„å°è£…æ˜¯å°è£…æ•°æ®å’Œå°è£…å®ç°ã€‚è¿™ä¸€èŠ‚å°†è®¨è®ºæ›´å¹¿ä¹‰çš„å°è£…ï¼Œä¸ä»…åŒ…æ‹¬å°è£…æ•°æ®å’Œå°è£…å®ç°ï¼Œè¿˜åŒ…æ‹¬å°è£…ç±»å‹å’Œå°è£…å˜åŒ–ã€‚ 1. å°è£…æ•°æ®åœ¨è®¸å¤šè¯­è¨€çš„å¯¹è±¡ç³»ç»Ÿä¸­ï¼Œå°è£…æ•°æ®æ˜¯ç”±è¯­æ³•è§£ææ¥å®ç°çš„ï¼Œè¿™äº›è¯­è¨€ä¹Ÿè®¸æä¾›äº† private ã€public ã€ protected ç­‰å…³é”®å­—æ¥æä¾›ä¸åŒçš„è®¿é—®æƒé™ã€‚ ä½† JavaScriptå¹¶æ²¡æœ‰æä¾›å¯¹è¿™äº›å…³é”®å­—çš„æ”¯æŒï¼Œæˆ‘ä»¬åªèƒ½ä¾èµ–å˜é‡çš„ä½œç”¨åŸŸæ¥å®ç°å°è£…ç‰¹æ€§ï¼Œè€Œä¸”åªèƒ½æ¨¡æ‹Ÿå‡º public å’Œ private è¿™ä¸¤ç§å°è£…æ€§ã€‚ 123456789var myObject = (function () &#123; var _name = &#x27;sven&#x27;; return &#123; getName: function () &#123; return _name; &#125; &#125;&#125;)()console.log(myObject.getName()); 2. å°è£…å®ç°å°è£…çš„ç›®çš„æ˜¯å°†ä¿¡æ¯éšè—ï¼Œå°è£…åº”è¯¥è¢«è§†ä¸ºâ€œä»»ä½•å½¢å¼çš„å°è£…â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå°è£…ä¸ä»…ä»…æ˜¯éšè—æ•°æ®ï¼Œè¿˜åŒ…æ‹¬éšè—å®ç°ç»†èŠ‚ã€è®¾è®¡ç»†èŠ‚ä»¥åŠéšè—å¯¹è±¡çš„ç±»å‹ç­‰ ä»å°è£…å®ç°ç»†èŠ‚æ¥è®²ï¼Œå°è£…ä½¿å¾—å¯¹è±¡å†…éƒ¨çš„å˜åŒ–å¯¹å…¶ä»–å¯¹è±¡è€Œè¨€æ˜¯é€æ˜çš„ï¼Œä¹Ÿå°±æ˜¯ä¸å¯è§çš„ã€‚å¯¹è±¡å¯¹å®ƒè‡ªå·±çš„è¡Œä¸ºè´Ÿè´£ã€‚å…¶ä»–å¯¹è±¡æˆ–è€…ç”¨æˆ·éƒ½ä¸å…³å¿ƒå®ƒçš„å†…éƒ¨å®ç°ã€‚å°è£…ä½¿å¾—å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ¾æ•£ï¼Œå¯¹è±¡ä¹‹é—´åªé€šè¿‡æš´éœ²çš„ APIæ¥å£æ¥é€šä¿¡ã€‚å½“æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¯ä»¥éšæ„åœ°ä¿®æ”¹å®ƒçš„å†…éƒ¨å®ç°ï¼Œåªè¦å¯¹å¤–çš„æ¥å£æ²¡æœ‰å˜åŒ–ï¼Œå°±ä¸ä¼šå½±å“åˆ°ç¨‹åºçš„å…¶ä»–åŠŸèƒ½ã€‚","tags":["è®¾è®¡æ¨¡å¼"],"categories":["Javascript"]},{"title":"å¸ƒå±€è¯¦è§£","path":"/2020/03/16/flexå¸ƒå±€è¯¦è§£/","content":"flexå¸ƒå±€æ·±å…¥äº†è§£1. flexå¸ƒå±€flexå®¹å™¨çš„å±æ€§ å±æ€§åç§° å±æ€§å«ä¹‰ å±æ€§å¯èƒ½çš„å€¼ flex-direction å†³å®šä¸»è½´çš„æ–¹å‘ row(é»˜è®¤) æ°´å¹³ï¼Œèµ·ç‚¹åœ¨å·¦ç«¯row-reverseæ°´å¹³ï¼Œèµ·ç‚¹åœ¨å³ç«¯column:å‚ç›´ï¼Œèµ·ç‚¹åœ¨ä¸Šæ²¿column-reverse:å‚ç›´ï¼Œèµ·ç‚¹åœ¨ä¸‹æ²¿ flex-wrap å†³å®šä¸€æ¡è½´çº¿æ”¾ä¸ä¸‹ï¼Œå¦‚ä½•æ¢è¡Œ Nowrap(é»˜è®¤) ä¸æ¢è¡ŒWrap:æ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸Šé¢Wrap-reverse:æ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸‹é¢ flex-flow æ˜¯ä¸Šé¢ä¸¤ä¸ªå±æ€§çš„ç®€å†™ é»˜è®¤å€¼æ˜¯ row nowrap justify-content å®šä¹‰é¡¹ç›®åœ¨ä¸»è½´ä¸Šçš„å¯¹é½æ–¹å¼ Flex-start(é»˜è®¤å€¼ï¼‰å·¦å¯¹é½Flex-end å³å¯¹é½Centerå±…ä¸­Space-between:ä¸¤ç«¯å¯¹é½ï¼Œé¡¹ç›®ä¹‹é—´çš„é—´éš”éƒ½ç›¸ç­‰Space-around:æ¯ä¸ªé¡¹ç›®ä¹‹é—´çš„é—´éš”ç›¸ç­‰ï¼Œæ‰€ä»¥é¡¹ç›®ä¹‹é—´çš„é—´éš”æ¯”é¡¹ç›®ä¸è¾¹æ¡†ä¹‹é—´çš„é—´éš”å¤§ä¸€å€ align-items å®šä¹‰é¡¹ç›®åœ¨äº¤å‰è½´ä¸Šå¦‚ä½•å¯¹é½ Flex-startäº¤å‰è½´çš„èµ·ç‚¹å¯¹é½Flex-endäº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½Center:äº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½Baselineï¼šé¡¹ç›®çš„ç¬¬ä¸€è¡Œæ–‡å­—çš„åŸºçº¿å¯¹é½Stretch ï¼ˆé»˜è®¤å€¼ï¼‰å¦‚æœé¡¹ç›®æœªè®¾ç½®é«˜åº¦æˆ–è€…è®¾ä¸ºautoï¼Œå°†å æ»¡æ•´ä¸ªå®¹å™¨çš„é«˜åº¦ align-content å®šä¹‰å¤šè·Ÿè½´çº¿å¯¹é½æ–¹å¼ï¼Œä¸€æ¡è½´çº¿è¯¥å±æ€§ä¸èµ·ä½œç”¨ Flex-start: ä¸äº¤å‰è½´çš„èµ·ç‚¹å¯¹é½Flex-end ä¸äº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½Center:ä¸äº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½Space-between:ä¸äº¤å‰è½´çš„ä¸¤ç«¯å¯¹é½ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”å¹³å‡åˆ†å¸ƒSpace-aroundï¼šæ¯æ ¹è½´çº¿ä¹‹é—´çš„é—´éš”éƒ½ç›¸ç­‰ï¼Œæ‰€ä»¥è½´çº¿ä¹‹é—´çš„é—´éš”æ¯”è½´çº¿ä¸è¾¹æ¡†ä¹‹é—´çš„é—´éš”å¤§ä¸€å€ *flexå®¹å™¨ä¸‹é¢é¡¹ç›®çš„å±æ€§ * å±æ€§åç§° å±æ€§å«ä¹‰ å±æ€§å¯èƒ½çš„å€¼ order å®šä¹‰é¡¹ç›®çš„æ’åˆ—é¡ºåºï¼Œæ•°å€¼è¶Šå°ï¼Œæ’åˆ—è¶Šé å‰ é»˜è®¤0 flex-grow å®šä¹‰é¡¹ç›®çš„æ”¾å¤§æ¯”ä¾‹ï¼Œå¦‚æœå­˜åœ¨å‰©ä½™ç©ºé—´ï¼Œä¸æ”¾å¤§ é»˜è®¤0ï¼ˆå¦‚æœæ‰€æœ‰é¡¹ç›®çš„flex-growå±æ€§ä¸º1ï¼Œåˆ™ç­‰åˆ†å‰©ä½™ç©ºé—´ï¼‰ flex-shrink å®šä¹‰é¡¹ç›®çš„ç¼©å°æ¯”ä¾‹ é»˜è®¤1 è´Ÿå€¼å¯¹è¯¥å±æ€§æ— æ•ˆ flex-basis å®šä¹‰åœ¨åˆ†é…å¤šä½™ç©ºé—´ä¹‹å‰ï¼Œé¡¹ç›®å æ®çš„ä¸»è½´ç©ºé—´ï¼Œæµè§ˆå™¨æ ¹æ®è¿™ä¸ªå±æ€§æ¥è®¡ç®—ä¸»è½´æ˜¯å¦æœ‰å¤šä½™ç©ºé—´ é»˜è®¤auto,å³é¡¹ç›®æœ¬æ¥å¤§å° flex æ˜¯ä¸Šé¢ä¸‰ä¸ªçš„ç®€å†™ é»˜è®¤å€¼ 0 1 auto åä¸¤ä¸ªå€¼å¯é€‰ align-self å…è®¸å•ä¸ªé¡¹ç›®ä¸å…¶ä»–é¡¹ç›®ä¸ä¸€æ ·çš„å¯¹é½æ–¹å¼ï¼Œå¯è¦†ç›–align-itemså±æ€§ é»˜è®¤å€¼auto è¡¨ç¤ºç»§æ‰¿çˆ¶å…ƒç´ çš„align-itemså±æ€§ï¼Œå¦‚æœæ²¡æœ‰çˆ¶å…ƒç´ ï¼Œåˆ™ç­‰åŒäºstretch 2.1 å¸¸ç”¨çš„å‚ç›´å±…ä¸­css12345678910111213.container &#123; display: flex; align-items: center; justify-content: center; height: 500px; background: #666; &#125;.box &#123; width: 200px; height: 200px; background: #ff0; &#125; Html123&lt;div class=&quot;container&quot;&gt; &lt;div class=&quot;box&quot;&gt;hello ç¿æºæ•&lt;/div&gt;&lt;/div&gt; æ•ˆæœå›¾ï¼š 2.2 å¸¸ç”¨çš„ul,liå¸ƒå±€æ¨ªå‘ç­‰å®½æ’åˆ— Html1234567&lt;ul class=&quot;container&quot;&gt; &lt;li&gt;ç¿&lt;/li&gt; &lt;li&gt;æº&lt;/li&gt; &lt;li&gt;æ•&lt;/li&gt; &lt;li&gt;ä½ &lt;/li&gt; &lt;li&gt;å¥½&lt;/li&gt; &lt;/ul&gt; css12345678910111213141516.container &#123; width: 500px; display: flex; list-style: none; padding: 0; &#125; .container &gt;li&#123; flex: 1; height: 50px; &#125; .container &gt;li:nth-of-type(2n)&#123; background: red &#125; .container &gt;li:nth-of-type(2n-1)&#123; background: green &#125; 2.3 éª°å­å¸ƒå±€è¯¦è§£ 2.3.1 å•é¡¹ç›® é¦–å…ˆï¼Œåªæœ‰å·¦ä¸Šè§’1ä¸ªç‚¹çš„æƒ…å†µã€‚Flexå¸ƒå±€é»˜è®¤å°±æ˜¯é¦–è¡Œå·¦å¯¹é½ï¼Œæ‰€ä»¥ä¸€è¡Œä»£ç å°±å¤Ÿäº†ã€‚ 123.box &#123; display: flex;&#125; è®¾ç½®é¡¹ç›®çš„å¯¹é½æ–¹å¼ï¼Œå°±èƒ½å®ç°å±…ä¸­å¯¹é½å’Œå³å¯¹é½ã€‚ 1234.box &#123; display: flex; justify-content: center;&#125; 1234.box &#123; display: flex; justify-content: flex-end;&#125; è®¾ç½®äº¤å‰è½´å¯¹é½æ–¹å¼ï¼Œå¯ä»¥å‚ç›´ç§»åŠ¨ä¸»è½´ã€‚å‚ç›´å±…ä¸­ 1234.box &#123; display: flex; align-items: center;&#125; 12345.box &#123; display: flex; justify-content: center; align-items: center;&#125; 12345.box &#123; display: flex; justify-content: center; align-items: flex-end;&#125; 12345.box &#123; display: flex; justify-content: flex-end; align-items: flex-end;&#125; 2.3.2 åŒé¡¹ç›® 1234.box &#123; display: flex; justify-content: space-between;&#125; 12345.box &#123; display: flex; flex-direction: column; justify-content: space-between;&#125; 123456.box &#123; display: flex; flex-direction: column; justify-content: space-between; align-items: center;&#125; 123456.box &#123; display: flex; flex-direction: column; justify-content: space-between; align-items: center;&#125; 1234567.box &#123; display: flex;&#125;.item:nth-child(2) &#123; align-self: center;&#125; 12345678.box &#123; display: flex; justify-content: space-between;&#125;.item:nth-child(2) &#123; align-self: flex-end;&#125; 2.3.3 ä¸‰é¡¹ç›® 1234567891011.box &#123; display: flex;&#125;.item:nth-child(2) &#123; align-self: center;&#125;.item:nth-child(3) &#123; align-self: flex-end;&#125; 2.3.3 å››é¡¹ç›® 123456.box &#123; display: flex; flex-wrap: wrap; justify-content: flex-end; align-content: space-between;&#125; HTML 12345678910&lt;div class=&quot;box&quot;&gt; &lt;div class=&quot;column&quot;&gt; &lt;span class=&quot;item&quot;&gt;&lt;/span&gt; &lt;span class=&quot;item&quot;&gt;&lt;/span&gt; &lt;/div&gt; &lt;div class=&quot;column&quot;&gt; &lt;span class=&quot;item&quot;&gt;&lt;/span&gt; &lt;span class=&quot;item&quot;&gt;&lt;/span&gt; &lt;/div&gt;&lt;/div&gt; css 1234567891011.box &#123; display: flex; flex-wrap: wrap; align-content: space-between;&#125;.column &#123; flex-basis: 100%; display: flex; justify-content: space-between;&#125; 2.3.4 å…­é¡¹ç›® 123456.box &#123; display: flex; flex-wrap: wrap; align-content: space-between;&#125; 123456.box &#123; display: flex; flex-direction: column; flex-wrap: wrap; align-content: space-between;&#125; 2.4 åœ£æ¯å¸ƒå±€ï¼ˆå¸¸è§ï¼‰ html123456789&lt;div class=&quot;container&quot;&gt; &lt;header&gt;Header&lt;/header&gt; &lt;div class=&quot;content&quot;&gt; &lt;main&gt;Main&lt;/main&gt; &lt;nav&gt;Nav&lt;/nav&gt; &lt;aside&gt;Aside&lt;/aside&gt; &lt;/div&gt; &lt;footer&gt;Footer&lt;/footer&gt; &lt;/div&gt; css12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849* &#123; margin: 0; padding: 0; &#125; html, body &#123; width: 100%; height: 100%; &#125; .container &#123; display: flex; /* å‚ç›´*/ flex-direction: column; width: 100%; /*è§†å£è¢«å‡åˆ†ä¸º100å•ä½çš„vh å æ®æ•´ä¸ªçª—å£*/ min-height: 100vh; &#125; header, footer &#123; background: #999; /*æ”¾å¤§ç¼©å°æ¯”ä¾‹ä¸º0 å æ®å‚ç›´æ–¹å‘80px*/ flex: 0 0 80px; &#125; .content &#123; display: flex; /*1 1 auto åä¸¤ä¸ªå€¼çœç•¥*/ flex: 1; &#125; nav &#123; /*é»˜è®¤ 0 æ•°å€¼è¶Šå° æ’åˆ—è¶Šé å‰*/ order: -1; flex: 0 0 80px; background: royalblue; &#125; aside &#123; flex: 0 0 80px; background: aqua; &#125; main &#123; flex: 1; background: green; &#125;","tags":["Css","flex","grid"],"categories":["Css"]},{"title":"==ä¸===åŒºåˆ«","path":"/2020/03/16/==ä¸===åŒºåˆ«/","content":"1. ç›¸ç­‰æ“ä½œç¬¦ï¼ˆ==å’Œ===ï¼‰1.1 ä½¿ç”¨==æ—¶ï¼Œä¸åŒç±»å‹çš„å€¼ä¹Ÿå¯ä»¥è¢«çœ‹ä½œç›¸ç­‰å¦‚æœxå’Œyæ˜¯ç›¸åŒç±»å‹ï¼ŒJavaScriptä¼šæ¯”è¾ƒå®ƒä»¬çš„å€¼æˆ–å¯¹è±¡å€¼ã€‚å…¶ä»–æ²¡æœ‰åˆ—åœ¨è¿™ä¸ªè¡¨æ ¼ä¸­çš„æƒ…å†µéƒ½ä¼šè¿”å›falsetoNumberå’ŒtoPrimitiveæ–¹æ³•æ˜¯å†…éƒ¨çš„ toNumberæ–¹æ³•å¯¹ä¸åŒç±»å‹è¿”å›çš„ç»“æœå¦‚ä¸‹ï¼š toPrimitiveæ–¹æ³•å¯¹ä¸åŒç±»å‹è¿”å›çš„ç»“æœå¦‚ä¸‹ï¼š éªŒè¯ï¼š æ˜¾è€Œæ˜“è§ç»“æœå¹¶ä¸ç›¸åŒï¼Œä¸ºå•¥ï¼Ÿ é¦–å…ˆï¼Œå¸ƒå°”å€¼ä¼šè¢«toNumberæ–¹æ³•è½¬æˆæ•°å­—ï¼Œå› æ­¤å¾—åˆ°wengkaimin == 1ã€‚ å…¶æ¬¡ï¼Œç”¨toNumberè½¬æ¢å­—ç¬¦ä¸²å€¼ã€‚å› ä¸ºå­—ç¬¦ä¸²åŒ…å«æœ‰å­—æ¯ï¼Œæ‰€ä»¥ä¼šè¢«è½¬æˆNaNï¼Œè¡¨è¾¾å¼ å°±å˜æˆäº†NaN == 1ï¼Œç»“æœå°±æ˜¯falseã€‚ è¿™è¡Œä»£ç ä¹Ÿæ˜¯åŒæ ·åŸç† é¦–å…ˆï¼Œå¸ƒå°”å€¼ä¼šè¢«toNumberæ–¹æ³•è½¬æˆæ•°å­—ï¼Œå› æ­¤å¾—åˆ°wengkaimin == 0ã€‚ å…¶æ¬¡ï¼Œç”¨toNumberè½¬æ¢å­—ç¬¦ä¸²å€¼ã€‚å› ä¸ºå­—ç¬¦ä¸²åŒ…å«æœ‰å­—æ¯ï¼Œæ‰€ä»¥ä¼šè¢«è½¬æˆNaNï¼Œè¡¨è¾¾å¼ å°±å˜æˆäº†NaN == 0ï¼Œç»“æœå°±æ˜¯false ä¸€æ ·çš„ï¼Œåªæ˜¯å°†å­—ç¬¦ä¸²è½¬æ•°å­—äº†ï¼Œâ€˜1â€™è½¬1ï¼ˆnumberï¼‰ç±»å‹ 1.2 === æ“ä½œç¬¦ å¦‚æœæ¯”è¾ƒçš„ä¸¤ä¸ªå€¼ç±»å‹ä¸åŒï¼Œæ¯”è¾ƒçš„ç»“æœå°±æ˜¯falseã€‚å¦‚æœ æ¯”è¾ƒçš„ä¸¤ä¸ªå€¼ç±»å‹ç›¸åŒï¼Œç»“æœä¼šæ ¹æ®ä¸‹è¡¨åˆ¤æ–­ å¦‚æœxå’Œyç±»å‹ä¸åŒï¼Œç»“æœå°±æ˜¯falseã€‚*ä¾‹å­ï¼š * 12console.log(&#x27;packt&#x27; === true); //false console.log(&#x27;packt&#x27; === &#x27;packt&#x27;); //true 123var person1 = &#123;name:&#x27;John&#x27;&#125;; var person2 = &#123;name:&#x27;John&#x27;&#125;; console.log(person1 === person2); //falseï¼Œä¸åŒçš„å¯¹è±¡","tags":["Javascript"],"categories":["Javascript"]},{"title":"nodejså­¦ä¹ è®°å½•","path":"/2020/03/16/nodejså­¦ä¹ è®°å½•/","content":"1.nodeè‡ªå¸¦æ¨¡å—fsæ–‡ä»¶ç®¡ç†nodejså®˜æ–¹æ–‡æ¡£ 1.1 readdirå’ŒreaddirSyncçš„åŒºåˆ« ä¸¤è€…éƒ½ç”¨ä¸è¯»å–æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶æœ‰å•¥ fs.readdir(path[, options], callback)å¼‚æ­¥å‡½æ•°ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªå›è°ƒ path options encoding é»˜è®¤å€¼: &#39;utf8&#39;ã€‚ withFileTypes é»˜è®¤å€¼: falseã€‚ callback(ä¸¤ä¸ªå‚æ•°ï¼Œé”™è¯¯å›è°ƒä¼˜å…ˆ) err é»˜è®¤å€¼ä¸ºnull files é”™è¯¯å¤„ç†ä»£ç ï¼š 1234567let dirs = fs.readdir(&#x27;./hello.txt&#x27;, (err, files) =&gt; &#123; if(err)&#123; console.log(err); &#125;else&#123; console.log(files); &#125;&#125;) fs.readdirSync(path[, options]) åŒæ­¥å‡½æ•° path options encodingé»˜è®¤å€¼: &#39;utf8&#39;ã€‚ withFileTypesé»˜è®¤å€¼: falseã€‚ è¿”å›: é”™è¯¯å¤„ç†ä»£ç ï¼š 1234567try &#123; let dirs = fs.readdirSync(&#x27;./node.js&#x27;); //å¼‚æ­¥&#125;catch (err) &#123; console.log(&#x27;ç²—ucol&#x27;); console.log(err)&#125; å› ä¸ºåŒæ­¥å‡½æ•°æ²¡æœ‰å¼‚æ­¥é‚£æ ·çš„å¤„ç†é”™è¯¯æœºåˆ¶ï¼Œå› æ­¤éœ€è¦é…åˆtry catchæ‰èƒ½æ•è·é”™è¯¯çš„åŒæ—¶åˆä¸æš‚åœä¸‹é¢çš„ä»£ç è¿è¡Œã€‚ 1.2 mkdirå’ŒmkdirSync åˆ›å»ºæ–‡ä»¶mkdiræ–‡æ¡£ 1.3 rename é‡å‘½å å’Œ rmdiråˆ é™¤æ–‡ä»¶rename rmdir 1.4 writeFile è¦†ç›–å†™å…¥ å’ŒappendFileæ·»åŠ å†™å…¥æ–‡ä»¶1.5 readFile è¯»å–æ–‡ä»¶å†…å®¹(äºŒè¿›åˆ¶æ•°æ®æµ)123fs.readFile(&#x27;name.txt&#x27;,(err,data)=&gt;&#123; console.log(data.toString(&#x27;UTF-8&#x27;))&#125;) å¯ä»¥ç”¨toString(â€˜UTF-8â€™)çš„æ–¹æ³•å°†æ–‡å­—æå–å‡ºæ¥ï¼› æˆ–è€…ç›´æ¥åœ¨é…ç½®é¡¹ä¸­ 123fs.readFile(&#x27;name.txt&#x27;, &#x27;UTF-8&#x27;, (err, data) =&gt; &#123; console.log(data)&#125;) 1.6 fs.stat(path[, options], callback)fs.stat 2. urlå†…ç½®æ¨¡å— 2.1 url.parse()å’Œurl.format()url.parse()å°†å…¶è§£ææˆä¸€ä¸ªurlå¯¹è±¡ï¼Œä»è€Œå¯ä»¥ä»urlä¸­è·å–hrefä¸­çš„å„ç§å€¼ url.format()å°†å¯¹è±¡å†æ‹¼èµ·æ¥ 123456let url = require(&quot;url&quot;);let urlStirng = &#x27;https://code.choerodon.com.cn/choerodon-framework?page=2&#x27;let urlObj = url.parse(urlStirng);console.log(urlObj);let string = url.format(urlObj);console.log(string) 3. querystringå†…ç½®æ¨¡å—querystring 3.1 stringfy()å¯¹è±¡è½¬æˆå­—ç¬¦ä¸²ï¼Œparse()æ ¹æ®ç¬¦å·è§£æquerystring3.2 escape()å’Œunescape()ç¼–ç ä¸è§£ç 123456789let qs = require(&#x27;querystring&#x27;)// let string = &#x27;name=weng&amp;pass=12121&amp;sex=0&amp;hello=111&#x27;// let obj = qs.parse(string);// console.log(obj)let string = &#x27;w=ä½ å¥½&amp;boo=21&#x27;;let code = qs.escape(string);console.log(code);let parseCode = qs.unescape(code);console.log(parseCode); 4. nodemailer ç¬¬ä¸‰æ–¹æ¨¡å—åŸºæœ¬çš„å‘é€é‚®ç®±ä»£ç ï¼š 123456789101112131415161718192021222324252627282930&#x27;use strict&#x27;;const nodemailer = require(&#x27;nodemailer&#x27;);// åˆ›å»ºå‘é€é‚®ä»¶çš„è¯·æ±‚å¯¹è±¡let transporter = nodemailer.createTransport(&#123; host: &#x27;smtp.qq.com&#x27;, //å‘é€æ–¹ç”¨çš„é‚®ç®± port: 465, //ç«¯å£å· secure: true, // true for 465, false for other ports auth: &#123; user: &#x27;736653759@qq.com&#x27;, // å‘ç”Ÿæ–¹é‚®ç®±åœ°å€ pass: &#x27;hebnhkaruvzlbfdg&#x27; // mtpéªŒè¯ç  &#125;&#125;);// send mail with defined transport objectlet mailObj = &#123; from: &#x27;&quot;Fred Foo ğŸ‘»&quot; &lt;736653759@qq.com&gt;&#x27;, to: &#x27;736653759@qq.com&#x27;, subject: &#x27;Hello test nodemailer âœ”&#x27;, // Subject line text: &#x27;Hello world of node.js?&#x27;, // plain text body html: &#x27;&lt;b&gt;Hello world?&lt;/b&gt;&#x27; // html body&#125;;// main().catch(console.error);setTimeout(() =&gt; &#123; transporter.sendMail(mailObj, (err, data) =&gt; &#123; console.log(data) &#125;)&#125;, 2000) 5. errorå¯¹è±¡é”™è¯¯å¯¹è±¡æœ¬èº«æ²¡æœ‰ç»ˆæ­¢ä»£ç æ‰§è¡Œï¼Œæ‰€ä»¥ä½ éœ€è¦throwæŠ›å‡ºå¼‚å¸¸ 12let err = new Error(&#x27;å‘ç”Ÿé”™è¯¯&#x27;);throw err; 6. çˆ¬è™«æ¡ˆä¾‹ ï¼ˆæ–¹æ³•2å¾…è¡¥å……ï¼‰ è·å–ç›®æ ‡ç½‘ç«™ åˆ†æç½‘ç«™å†…å®¹ cheerio å¯ä»¥ç”¨jqueryä¸­çš„é€‰æ‹©å™¨è¿›è¡Œç½‘é¡µå†…å®¹åˆ†æ cheerioä¸­æ–‡æ–‡æ¡£ 1234const cheerio = require(&#x27;cheerio&#x27;);let $ = cheerio.load(&#x27;&lt;div&gt;&lt;p&gt;hello&lt;/p&gt;&lt;img src = &quot;http://www.baidu.com&quot;/&gt;&#x27;);const img = $(&#x27;div img&#x27;).attr(&#x27;src&#x27;);console.log(img) å°†ä¸€ç»„htmlè½¬åŒ–ä¸ºç±»dom,å¯ä»¥é€šè¿‡cheerioå®ç°jqä¸­çš„$é€‰æ‹©å™¨ï¼Œä»è€Œå®ç°ä¸€äº›domè·å–çš„æ“ä½œã€‚ è·å–æœ‰æ•ˆä¿¡æ¯ï¼Œä¸‹è½½æˆ–è€…å…¶ä»–æ“ä½œ http https æ ¹æ®ä¸åŒçš„è¯·æ±‚é€‰æ‹©ä¸åŒçš„åè®®ã€‚ *çˆ¬å›¾ç‰‡çš„ä»£ç  æ–¹æ³•1ï¼šdownLoad.jsæ–‡ä»¶ 1234567891011121314151617181920212223242526const fs = require(&#x27;fs&#x27;);const path = require(&#x27;path&#x27;);const request = require(&#x27;request&#x27;);var dirPath = path.join(__dirname, &quot;MarvelImages&quot;); //__dirnameå½“å‰è·¯å¾„ï¼ŒåŠ ä¸Šè¦åˆ›å»ºçš„æ–‡ä»¶åfunction downloadfile(downloadUrl, index) &#123; // åˆ›å»ºæ–‡ä»¶å¤¹ if (!fs.existsSync(dirPath)) &#123; // åŒæ­¥æŸ¥è¯¢æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ fs.mkdirSync(dirPath); // åŒæ­¥åˆ›å»ºæ–‡ä»¶å¤¹ console.log(dirPath + &#x27;æ–‡ä»¶åˆ›å»ºæˆåŠŸ&#x27;); &#125; let imgUrlArray = downloadUrl.split(&#x27;/&#x27;); //åˆ†å‰²Url let imgUrl = imgUrlArray[imgUrlArray.length - 1]; //è·å–æ–‡ä»¶å let filename = imgUrl; let stream = fs.createWriteStream(path.join(dirPath, filename)); if (downloadUrl.indexOf(&#x27;http&#x27;) !== -1) &#123; request(downloadUrl).pipe(stream).on(&#x27;error&#x27;, (err) =&gt; &#123; console.log(err); &#125;).on(&#x27;close&#x27;, () =&gt; &#123; console.log(`æ–‡ä»¶ã€$&#123;filename&#125;ã€‘ä¸‹è½½å®Œ`); // callback(null, dest); &#125;) &#125; else &#123; console.log(`$&#123;downloadUrl&#125;æ–‡ä»¶æ‰¾ä¸åˆ°`); &#125;&#125;module.exports = downloadfile; splider.js 123456789101112131415161718192021222324252627282930313233343536const http = require(&#x27;http&#x27;);const cheerio = require(&#x27;cheerio&#x27;);let downLoad = require(&#x27;./downLoad&#x27;);let mavelUrl = &#x27;http://marvel.mtime.com/&#x27;http.get(mavelUrl, (res) =&gt; &#123; const &#123; statusCode &#125; = res; //çŠ¶æ€ç  const contentType = res.headers[&#x27;content-type&#x27;]; //è¯·æ±‚åˆ°çš„æ–‡ä»¶ç±»å‹ console.log(`è¯·æ±‚åˆ°çš„æ–‡ä»¶ç±»å‹` + contentType); // åšå®‰å…¨åˆ¤æ–­ let error; if (statusCode !== 200) &#123; error = new Error(&#x27;è¯·æ±‚å¤±è´¥.&#x27; + `Status Code: $&#123;statusCode&#125;é”™è¯¯`); &#125; else if (!/^text\\/html/.test(contentType)) &#123; error = new Error(&#x27;Invalid content-type. &#x27; + `Expected text/html but received $&#123;contentType&#125;`) &#125; if (error) &#123; //å¦‚æœå‡ºé”™çš„è¯ç›´æ¥æ¥åˆ°è¿™ä¸€è¡Œ console.error(error.message); res.resume(); //é‡ç½®ç¼“å­˜ return false; &#125; // æ•°æ®æ˜¯åˆ†æ®µçš„,æ¯ä¸€æ¬¡æ¥å—åˆ°ä¸€æ®µæ•°æ®éƒ½ä¼šè§¦å‘dataäº‹ä»¶ï¼Œchunkå°±æ˜¯æ•°æ®ç‰‡æ®µ // æ‰€ä»¥å¿…é¡»ç”¨ä¸€ä¸ªstringæ¥å½“æ€»chunkï¼Œæ¯ä¸€æ¬¡è¯·æ±‚ä¸€ä¸ªæ‹¼æ¥ä¸€ä¸ª let rawData = &#x27;&#x27;; res.on(&#x27;data&#x27;, (chunk) =&gt; &#123; rawData += chunk.toString(&#x27;UTF-8&#x27;); &#125;); res.on(&#x27;end&#x27;, () =&gt; &#123; let $ = cheerio.load(rawData); $(&#x27;img&#x27;).each((index, ele) =&gt; &#123; let imgSrc = $(ele).attr(&#x27;src&#x27;); downLoad(&#x27;http://marvel.mtime.com/&#x27; + imgSrc, index); &#125;) &#125;)&#125;).on(&#x27;error&#x27;, (err) =&gt; &#123; console.log(&#x27;è¯·æ±‚é”™è¯¯&#x27;);&#125;) æ–¹æ³•2ï¼š7. expressæ¡†æ¶ï¼ˆå†™apiï¼‰expressä¸­æ–‡æ–‡æ¡£ 7.1.ç®€è¦ç”¨æ³•å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œæ¥å£çš„æ„æˆè¦ç´ æœ‰å•¥ ip port pathname method (get post put delete) å†™ä¸€ä¸ªgetæ¥å£ 123456789101112131415const express = require(&#x27;express&#x27;);const app = express() //expresså®ä¾‹åŒ–// ç›‘å¬3000ç«¯å£app.listen(3000, () =&gt; &#123; console.log(&#x27;server start at localhost://3000&#x27;);&#125;)// å†™ä¸€ä¸ªgetæ¥å£app.get(&#x27;/user/login&#x27;, (req, res) =&gt; &#123; console.log(req.query); //æ¥å—åˆ°çš„å€¼ console.log(&#x27;ä½ å¥½&#x27;); res.send(&#123; status: &#x27;success&#x27; &#125;);&#125;)// åè®® http https åœ°å€æ ä¸­è¾“å…¥http://localhost:3000/user/login?username=wengkaimin&amp;ps=123456 æ§åˆ¶å°ä¸­å°±èƒ½æ¥å—åˆ°ä¼ è¿‡æ¥çš„æ•°æ®ï¼Œé€šè¿‡req.queryæ¥å—getæ–¹æ³•ä¼ è¿‡æ¥çš„å‚æ•° å†™ä¸€ä¸ªpostæ¥å£ expressä¸æä¾›è§£ææ¶ˆæ¯ä½“çš„åŠŸèƒ½ï¼Œæ‰€ä»¥req.bodyæ˜¯æ‹¿ä¸åˆ°ä¸»ä½“çš„ï¼Œè¿™è¾¹æä¾›äº†ä¸€ä¸ªç¬¬ä¸‰æ–¹æ’ä»¶ body-parser body-parser npm 1234567891011121314151617181920212223242526272829303132333435const express = require(&#x27;express&#x27;);const app = express() //expresså®ä¾‹åŒ–const bp = require(&#x27;body-parser&#x27;);// expressä¸­app.useè¡¨ç¤ºä½¿ç”¨ä¸€ä¸ªä¸­é—´ä»¶// parse application/x-www-form-urlencodedè§£æè¡¨å•æ ¼å¼æ•°æ®app.use(bp.urlencoded(&#123; extended: false &#125;))// parse application/jsonapp.use(bp.json());// ç›‘å¬3000ç«¯å£app.listen(3000, () =&gt; &#123; console.log(&#x27;server start at localhost://3000&#x27;);&#125;)// å†™ä¸€ä¸ªgetæ¥å£app.get(&#x27;/user/login&#x27;, (request, res) =&gt; &#123; console.log(request.query); console.log(&#x27;ä½ å¥½&#x27;); let &#123; username, ps &#125; = request.query; if (username === &#x27;weng&#x27; &amp;&amp; ps === &#x27;1234&#x27;) &#123; res.send(&#123; status: &#x27;success&#x27; &#125;); &#125; else &#123; res.send(&#x27;ç™»é™†å¤±è´¥&#x27;) &#125;&#125;);// å†™ä¸€ä¸ªpostæ¥å£app.post(&#x27;/user/reg&#x27;, (request, result) =&gt; &#123; // request.bodyè·å–æ•°æ®ï¼Œæ¶ˆæ¯ä½“ï¼Œè¯·æ±‚ä½“ // let &#123; us, ps &#125; = request.body; console.log(request.body); // expressä¸èƒ½ç›´æ¥è§£ææ¶ˆæ¯ä½“ // éœ€è¦ç¬¬ä¸‰æ–¹æ’ä»¶ body-parser result.send(&#123; status: 1 &#125;)&#125;)// åè®® http https 7.2 ä¸­é—´ä»¶ middlewear å†…ç½®ä¸­é—´ä»¶ static è‡ªå®šä¹‰ä¸­é—´ä»¶ï¼ˆå…¨å±€ï¼‰ï¼ˆå±€éƒ¨ï¼‰ ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶ï¼ˆbody-parse) (æ‹¦æˆªå™¨) 1234567891011121314151617181920212223242526272829const express = require(&#x27;express&#x27;);const app = express();// ä¸­é—´ä»¶// å…¨å±€ä¸­é—´ä»¶,æ‰€æœ‰è¯·æ±‚å‘é€ä¹‹å‰éƒ½è¦èµ°è¿™ä¸€æ­¥app.use(&#x27;/&#x27;, (req, res, next) =&gt; &#123; let &#123; token &#125; = req.query; if (token) &#123; res.send(&quot;OK&quot;); next(); //æ˜¯å¦ç»§ç»­å¾€ä¸‹æ‰§è¡Œ &#125; else &#123; res.send(&#x27;ç¼ºå°‘token&#x27;); &#125; &#125;)app.get(&#x27;/test1&#x27;, (requst, result) =&gt; &#123; console.log(&#x27;test1&#x27;) console.log(requst.query)&#125;)app.get(&#x27;/test2&#x27;, (requst, result) =&gt; &#123; console.log(&#x27;test2&#x27;)&#125;)app.listen(3000, () =&gt; &#123; console.log(&#x27;server start at localhost://3000&#x27;)&#125;) 7.3 é™æ€èµ„æºç›®å½• static æŒ‡å®šä¸€ä¸ªç›®å½•ï¼Œå¯ä»¥è¢«è®¿é—® åƒapacheçš„wwwä¸€æ · éƒ¨ç½²é™æ€èµ„æºæ–‡ä»¶ 1234567891011const express = require(&#x27;express&#x27;);const path = require(&#x27;path&#x27;);const app = express();const dirPath = path.join(__dirname, &#x27;/static&#x27;);console.log(dirPath);app.use(express.static(dirPath)); //å¯ä»¥ä»è¿™ä¸ªè·¯å¾„ç›´æ¥è·å–åˆ°èµ„æºapp.listen(3000, () =&gt; &#123; console.log(&#x27;server start at localhost://3000&#x27;)&#125;) 7.4 è·¯ç”± server.js 12345678910111213const express = require(&#x27;express&#x27;);const app = express();let userRouter = require(&#x27;./router/userRouter&#x27;);let foodRouter = require(&#x27;./router/foodRouter&#x27;);app.use(&#x27;/user&#x27;, userRouter);app.use(&#x27;/food&#x27;, foodRouter)app.listen(3000, () =&gt; &#123; console.log(&quot;server start localhost:3000&quot;);&#125;) userRouter.js 123456789101112const express = require(&#x27;express&#x27;);const router = express.Router();router.get(&#x27;/add&#x27;, (req, res) =&gt; &#123; res.send(&#x27;user add&#x27;)&#125;)router.get(&#x27;/del&#x27;, () =&gt; &#123; console.log(&#x27;user delete&#x27;)&#125;)module.exports = router 8. MongoDB éå…³ç³»å‹æ•°æ®åº“8.1 æŒ‡ä»¤åŸºæœ¬ mongodb æ•°æ®åº“å mongod å‘½ä»¤è¡Œå¯åŠ¨æ•°æ®åº“å‘½ä»¤ mongo å‘½ä»¤è¡Œæ“ä½œæ•°æ®åº“æŒ‡ä»¤ mongoose node æ“ä½œæ•°æ®åº“æ’ä»¶ ä¸­æ–‡æ–‡æ¡£ show dbs show collections","tags":["nodeJS"],"categories":["åç«¯","nodeJS"]},{"title":"flex3ä¸ªå±æ€§è¯¦è§£","path":"/2020/03/16/flex3ä¸ªå±æ€§è¯¦è§£/","content":"Flex 3ä¸ªå±æ€§è¯¦è§£ flexå±æ€§ flex:(flex-grow)(flex-shrink)(flex-basis) flex-grow ä¸€ä¸ªæ•°å­—ï¼Œè§„å®šé¡¹ç›®å°†ç›¸å¯¹äºå…¶ä»–çµæ´»çš„é¡¹ç›®è¿›è¡Œæ‰©å±•çš„é‡ï¼ˆæ”¾å¤§å±æ€§ï¼‰ flex-shrink ä¸€ä¸ªæ•°å­—ï¼Œè§„å®šé¡¹ç›®å°†ç›¸å¯¹äºå…¶ä»–çµæ´»çš„é¡¹ç›®è¿›è¡Œæ”¶ç¼©çš„é‡ï¼ˆç¼©å°å±æ€§ï¼‰ flex-basis é¡¹ç›®çš„é•¿åº¦ã€‚åˆæ³•å€¼ï¼šâ€autoâ€ã€â€inheritâ€ æˆ–ä¸€ä¸ªåè·Ÿ â€œ%â€ã€â€pxâ€ã€â€emâ€ æˆ–ä»»ä½•å…¶ä»–é•¿åº¦å•ä½çš„æ•°å­—ã€‚ï¼ˆåŸºæœ¬å®½åº¦ï¼‰ 1. flex: noneç­‰åŒäº ï¼ˆflex: 0 0 autoï¼‰ è¿™æ—¶å€™å®¹å™¨å®Œå…¨ä¸å†çµæ´»ã€‚å³ä¸èƒ½æ”¾å¤§ä¹Ÿä¸èƒ½ç¼©å°ã€‚ é™¤äº†å®ƒä¸å…è®¸ flex-shrink å±æ€§ï¼ˆä¸èƒ½ç¼©å°ï¼‰ï¼Œå³ä½¿å…ƒç´ å¯èƒ½ä¼šæº¢å‡ºã€‚ 2. flex:initial(flex: 0 1 auto )ç­‰åŒäºï¼ˆ0 autoï¼‰ flex-growä¸º0ï¼Œåˆ™å­˜åœ¨å‰©ä½™ç©ºé—´ä¹Ÿä¸æ”¾å¤§ flex-shrinkä¸º1ï¼Œåˆ™ç©ºé—´ä¸è¶³è¯¥é¡¹ç›®ç¼©å° z flex-basisä¸ºautoï¼Œåˆ™è¯¥é¡¹ç›®æœ¬æ¥çš„å¤§å° ,é•¿åº¦ç­‰äºçµæ´»é¡¹ç›®çš„é•¿åº¦ã€‚å¦‚æœè¯¥é¡¹ç›®æœªæŒ‡å®šé•¿åº¦ï¼Œåˆ™é•¿åº¦å°†æ ¹æ®å†…å®¹å†³å®šã€‚ 12345678910111213141516171819202122.parent &#123; display: flex; width: 600px; border: 1px solid #000;&#125;.parent&gt;div &#123; height: 100px;&#125;.item1 &#123; width: 100px; background-color: #666;&#125;.item2 &#123; width: 100px; background: blue;&#125;.item3 &#123; width: 100px; background: lightblue;&#125; 1234567&lt;body&gt; &lt;div class=&quot;parent&quot;&gt; &lt;div class=&quot;item1&quot;&gt;&lt;/div&gt; &lt;div class=&quot;item2&quot;&gt;&lt;/div&gt; &lt;div class=&quot;item3&quot;&gt;&lt;/div&gt; &lt;/div&gt;&lt;/body&gt; æ­¤æ—¶ï¼Œå½“å®¹å™¨å‰©ä½™ä¸€äº›ç©ºé—²ç©ºé—´æ—¶ï¼Œè¯¥å±æ€§ä½¿çµæ´»çš„é¡¹ç›®å˜å¾—ä¸çµæ´»ï¼Œå› ä¸ºå…¶ä¸èƒ½è‡ªç”±æ‹‰ä¼¸æ”¾å¤§ã€‚ ä½†æ˜¯å½“å®¹å™¨æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ—¶ï¼Œè¯¥å±æ€§å…è®¸å…¶ç¼©å°åˆ°é¡¹ç›®çš„æœ€å°å€¼ã€‚ è®¾ç½®å‰é¢ä¸¤ä¸ªå…ƒç´ ä¸ºflex: none, width:100px å…¨æ˜¯initialï¼Œwidthåˆ†åˆ«è®¾ç½®ä¸ºï¼š100px ï¼Œ100px ï¼Œ700pxï¼Œæ­¤æ—¶å·²ç»è¶…å‡ºäº†å®¹å™¨çš„å®½åº¦ï¼Œè¿™æ—¶å€™é‡Œå¤´çš„3ä¸ªå…ƒç´ è‡ªåŠ¨æ”¶ç¼© baseWidth: flex-basis ? flex-basis : width (flex-basisçš„ä¼˜å…ˆçº§æ¯”widthé«˜); allWidth: flexå…ƒç´ çš„flex-basiså’Œï¼Œæˆ–è€…widthå’Œå…¶çš„å’Œï¼Œçœ‹ä¼˜å…ˆçº§; overflowWidth: allwidth - çˆ¶å®¹å™¨width æ¯ä¸ªflexå…ƒç´ ç¼©å°å€¼è®¡ç®—ï¼š $$(baseWidth/allWidth) * overflowWidth$$ æ‰€ä»¥è¿™æ¬¡æƒ…å†µæ˜¯ï¼šdiv1å®½åº¦ä¸º100px - 100/900 * 300 = 66.66â€¦. 3. flex: autoç›¸å½“äº flex: 1 1 auto è¿™ä¸ªæ—¶å€™ï¼Œè¯¥å±æ€§ä½¿3ä¸ªitemå®Œå…¨çµæ´»ï¼Œå®ƒä»¬èƒ½å¤Ÿå¸æ”¶ä¸»è½´ä¸Šé¢å¤–çš„ç©ºé—´ã€‚æ—¢å¯ä»¥è‡ªç”±æ”¾å¤§ä¹Ÿå¯ä»¥è‡ªç”±ç¼©å°ã€‚ 4. flex:&lt; positive-number &gt; &lt;æ„ä¸º æ­£æ•°&gt;ç­‰åŒäº flex: &lt; positive-number &gt; 1 0px å½“ flex å–å€¼ä¸ºä¸€ä¸ªéè´Ÿæ•°å­—ï¼Œåˆ™è¯¥æ•°å­—ä¸º flex-grow çš„å€¼ï¼Œflex-shrink å– 1ï¼Œflex-basis å– 0%ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œè¯¥å±æ€§ä½¿å¼¹æ€§é¡¹ç›®å˜å¾—çµæ´»ï¼Œflexå…ƒç´ åœ¨ä¸»è½´æ–¹å‘ä¸Šçš„åˆå§‹å¤§å°flex-basisä¸ºé›¶ã€‚ é¡¹ç›®å°†æ ¹æ®å®¹å™¨çš„å¤§å°æŒ‰ç…§è‡ªèº«çš„æ¯”ä¾‹è‡ªç”±ä¼¸ç¼©ã€‚ æ ¹æ®ä»–ä»¬flex-growæ¥è®¡ç®—ä»–ä»¬åˆ†é…åˆ°çš„å®½åº¦ :$$flexGrow * flexWidth$$ $$flexWidth = (600-allFlexBasisWidth)/(1+1+2) = (600 - 0)/4 =150px$$ç”±äºflex:1 ,å…¶ä¸­çš„flex-basisæ˜¯ä¸º0pxçš„ï¼Œæ‰€ä»¥è¯´,è¦æ ¹æ®è‡ªå·±divçš„å®½åº¦æ¥å†³å®šå…ƒç´ çš„åŸºç¡€å®½åº¦ï¼Œå¦‚æœdivæ²¡è®¾ç½®å®½åº¦é‚£å°±æ ¹æ®å†…éƒ¨å…ƒç´ çš„å®½åº¦æ’‘å¼€çš„å®½åº¦ï¼Œä¾‹å¦‚ï¼š å¦‚æœè¿™æ—¶å€™ä¸€ä¸ªå…ƒç´ çš„flex-basisè®¾ç½®ä¸ºauto è¿™æ—¶å€™å°±éœ€è¦æ ¹æ®è¿™ä¸ªè®¾ç½®äº†autoå…ƒç´ çš„å®½åº¦æ¥è¿›è¡Œè®¡ç®—ï¼Œå› ä¸ºitem2æ²¡æœ‰è®¾ç½®widthæ‰€ä»¥å¾—æ ¹æ®ä»–çš„å†…å®¹å®½åº¦æ¥è®¡ç®—åˆ†é…åˆ°çš„å®½åº¦ã€‚ å½“ä»–æ²¡æœ‰è®¾ç½®flexå±æ€§çš„æ—¶å€™ï¼Œå†…å®¹å®½åº¦ä¸º99.08px æ‰€ä»¥ç®—ä»–åœ¨æˆä¸ºflexå…ƒç´ æ—¶å€™åˆ†é…åˆ°çš„å®½åº¦ä¸ºï¼š (600-99.08)/4=125.23 5. flex:&lt; positive-number &gt; xxpx ||%xxè¯¥å±æ€§å’Œä¸Šè¾¹çš„CSSæ¡ˆä¾‹ä¸€è‡´ï¼Œå³ å½“ flex å–å€¼ä¸ºä¸€ä¸ªéè´Ÿæ•°å­—å’Œä¸€ä¸ªé•¿åº¦ï¼ˆpxï¼‰æˆ–ç™¾åˆ†æ¯”ï¼ˆ%ï¼‰ï¼Œ åˆ™åˆ†åˆ«è§†ä¸º flex-grow å’Œ flex-basis çš„å€¼ï¼Œflex-shrink é»˜è®¤å– 1 ä¾‹é¢˜ï¼š 123456789101112131415161718192021222324252627&lt;style type=&quot;text/css&quot;&gt; .parent &#123; display: flex; width: 600px; border: 1px solid #000; &#125; .parent&gt;div &#123; height: 100px; &#125; .item1 &#123; background-color: #666; flex: 2 1 30%; &#125; .item2 &#123; width:100px; background: blue; flex: 2 1 auto; &#125; .item3 &#123; flex: 1 1 200px; background: lightblue; &#125;&lt;/style&gt; 1234567&lt;body&gt; &lt;div class=&quot;parent&quot;&gt; &lt;div class=&quot;item1&quot;&gt;&lt;/div&gt; &lt;div class=&quot;item2&quot;&gt;&lt;/div&gt; &lt;div class=&quot;item3&quot;&gt;&lt;/div&gt; &lt;/div&gt;&lt;/body&gt; è®¡ç®—å‡º3ä¸ªitemçš„å®½åº¦ å…ˆåˆ¤æ–­ä»–ä»¬å‡ ä¸ªçš„basisWidthå’Œæ˜¯å¦è¶…å‡ºäº†å®¹å™¨çš„å®½åº¦: 600*30% +200 + 0 = 380px &lt;600pxï¼Œæ•…ï¼Œå‰©ä½™çš„å®½åº¦ç”¨äºflexå…ƒç´ çš„å®½åº¦æ‰©å±• è®¡ç®—ä¼¸å±•å› å­ï¼š(600 - 380)/ (2+2+1) = 44 px å› æ­¤ä»–ä»¬æ‰€åˆ†é…åˆ°çš„å®½åº¦å„ä¸ºï¼š2 * 44+180 ï¼Œ2 * 44ï¼Œ1 * 44+200 6. å½’çº³æ¯æ¬¡å»è®¡ç®—ä¸€ä¸ªflexboxçš„å…ƒç´ å®½åº¦ flex-grow ä¸ä¸º0 çš„æ—¶å€™å¹¶ä¸”flex-basiså®½åº¦åŠ èµ·æ¥ä¸è¶…å‡ºå®¹å™¨å®½ï¼Œä»¥flex-basisä¸ºåŸºå‡†ç®—ä¼¸å±•å› å­ï¼Œå½“flex-growä¸º0æ—¶ï¼Œflex-basisæœ€å¤§ï¼Œwidthç¬¬äºŒã€‚ flex-grow ä¸ä¸º0çš„æ—¶å€™å¹¶ä¸”flex-basisä¸ºautoçš„æ—¶å€™ï¼Œè™½ç„¶æœ‰widthå€¼ï¼Œä½†è®¡ç®—æ”¶ç¼©å› å­æ—¶å€™è¿™ä¸€å—çš„flex-basisä¹Ÿåªèƒ½ç®—æ˜¯0.","tags":["flex"],"categories":["Css"]}]