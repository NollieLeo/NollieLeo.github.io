<!DOCTYPE html>
<html lang='zh-CN'>

<head>
  <meta name="generator" content="Hexo 6.3.0">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.18.5">
  <meta charset="utf-8">
  

  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://gcore.jsdelivr.net'>
  <link rel="preconnect" href="https://gcore.jsdelivr.net" crossorigin>
  <link rel='dns-prefetch' href='//unpkg.com'>

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  
  <title>åŸºäºçŒªé½¿é±¼å¹³å°çš„axiosç¼“å­˜å°è£… - ç¿å…ˆæ£®çš„åšå®¢</title>

  
    <meta name="description" content="éœ€æ±‚è¯´æ˜æƒ…å†µ1ï¼šçŒªé½¿é±¼å¹³å°æ˜¯ä¸ªç›¸å¯¹å¤æ‚çš„å¤šè¡¨æ ¼å¤šè¡¨å•æ•°æ®å¤„ç†å¹³å°ï¼Œæœ‰äº›æ¨¡å—çš„æ•°æ®é‡åºå¤§ï¼Œå¹¶ä¸”æœ‰äº›å–œæ¬¢åµŒå…¥åœ¨tabé¡µé¢å½“ä¸­ï¼Œå¦‚æœé¢‘ç¹çš„å»è®¿é—®è¿™äº›é¡µé¢å°±ä¼šé¢‘ç¹çš„è¯·æ±‚ï¼Œå¦‚æœæ•°æ®é‡åºå¤§ï¼Œæ¯æ¬¡è®¿é—®éƒ½ä¼šå»è¯·æ±‚æ•°æ®ï¼Œç­‰å¾…æ—¶é—´å°±å˜é•¿äº†ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªç•Œé¢ï¼š  è¿™ä¸ªé¡µé¢ç›¸å½“äºæ˜¯å†å²çš„æ‰§è¡Œè®°å½•ï¼Œå› ä¸ºæ•°æ®é‡åºå¤§ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¡µé¢è¯·æ±‚è¿‡åå“åº”é€Ÿåº¦è¾ƒæ…¢ï¼Œå‡è®¾æˆ‘åœ¨çŸ­æ—¶é—´å†…åˆ‡åˆ°åˆ«çš„è®°å½•åˆåˆ‡å›æ¥è¦çœ‹ï¼Œé‚£è¿˜å¾—é‡æ–°å†å»è¯·æ±‚è¿™100">
<meta property="og:type" content="article">
<meta property="og:title" content="åŸºäºçŒªé½¿é±¼å¹³å°çš„axiosç¼“å­˜å°è£…">
<meta property="og:url" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/index.html">
<meta property="og:site_name" content="ç¿å…ˆæ£®çš„åšå®¢">
<meta property="og:description" content="éœ€æ±‚è¯´æ˜æƒ…å†µ1ï¼šçŒªé½¿é±¼å¹³å°æ˜¯ä¸ªç›¸å¯¹å¤æ‚çš„å¤šè¡¨æ ¼å¤šè¡¨å•æ•°æ®å¤„ç†å¹³å°ï¼Œæœ‰äº›æ¨¡å—çš„æ•°æ®é‡åºå¤§ï¼Œå¹¶ä¸”æœ‰äº›å–œæ¬¢åµŒå…¥åœ¨tabé¡µé¢å½“ä¸­ï¼Œå¦‚æœé¢‘ç¹çš„å»è®¿é—®è¿™äº›é¡µé¢å°±ä¼šé¢‘ç¹çš„è¯·æ±‚ï¼Œå¦‚æœæ•°æ®é‡åºå¤§ï¼Œæ¯æ¬¡è®¿é—®éƒ½ä¼šå»è¯·æ±‚æ•°æ®ï¼Œç­‰å¾…æ—¶é—´å°±å˜é•¿äº†ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªç•Œé¢ï¼š  è¿™ä¸ªé¡µé¢ç›¸å½“äºæ˜¯å†å²çš„æ‰§è¡Œè®°å½•ï¼Œå› ä¸ºæ•°æ®é‡åºå¤§ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¡µé¢è¯·æ±‚è¿‡åå“åº”é€Ÿåº¦è¾ƒæ…¢ï¼Œå‡è®¾æˆ‘åœ¨çŸ­æ—¶é—´å†…åˆ‡åˆ°åˆ«çš„è®°å½•åˆåˆ‡å›æ¥è¦çœ‹ï¼Œé‚£è¿˜å¾—é‡æ–°å†å»è¯·æ±‚è¿™100">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/7.gif">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/image-20210624155243688.png">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/test.gif">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/image-20210625112724872.png">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/image-20210625113745262.png">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/image-20210625160815760.png">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/image-20210625173040963.png">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/image-20210625173136449.png">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/image-20210625211727335.png">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/image-20210625210606969.png">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/image-20210625210632981.png">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/image-20210626094315248.png">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/image-20210626094721131.png">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/image-20210626101834505.png">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/image-20210626111840112.png">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/image-20210626111852379.png">
<meta property="og:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/image-20210627124622241.png">
<meta property="article:published_time" content="2021-06-24T06:02:44.000Z">
<meta property="article:modified_time" content="2022-02-09T01:45:19.167Z">
<meta property="article:author" content="ç¿å…ˆæ£®">
<meta property="article:tag" content="js">
<meta property="article:tag" content="axios">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/NollieLeo/2021/06/24/%E5%9F%BA%E4%BA%8E%E7%8C%AA%E9%BD%BF%E9%B1%BC%E5%B9%B3%E5%8F%B0%E7%9A%84axios%E7%BC%93%E5%AD%98%E5%B0%81%E8%A3%85/7.gif">
  
  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="ç¿å…ˆæ£®çš„åšå®¢" type="application/atom+xml">
  

  
    
<link rel="stylesheet" href="/css/main.css">

  

  

  

  


  
</head>

<body>
  




  <div class='l_body' id='start'>
    <aside class='l_left' layout='post'>
    

  

<header class="header"><div class="logo-wrap"><a class="title" href="/"><div class="main" ff="title">ç¿å…ˆæ£®çš„åšå®¢</div></a></div>

<nav class="menu dis-select"></nav>
</header>


<div class="widgets">
<widget class="widget-wrapper search"><div class="widget-body"><div class="search-wrapper" id="search"><form class="search-form"><input type="text" class="search-input" id="search-input" data-filter="/blog/" placeholder="æ–‡ç« æœç´¢"><svg t="1670596976048" class="icon search-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2676" width="200" height="200"><path d="M938.2 832.6L723.8 618.1c-2.5-2.5-5.3-4.4-7.9-6.4 36.2-55.6 57.3-121.8 57.3-193.1C773.3 222.8 614.6 64 418.7 64S64 222.8 64 418.6c0 195.9 158.8 354.6 354.6 354.6 71.3 0 137.5-21.2 193.2-57.4 2 2.7 3.9 5.4 6.3 7.8L832.5 938c14.6 14.6 33.7 21.9 52.8 21.9 19.1 0 38.2-7.3 52.8-21.8 29.2-29.1 29.2-76.4 0.1-105.5M418.7 661.3C284.9 661.3 176 552.4 176 418.6 176 284.9 284.9 176 418.7 176c133.8 0 242.6 108.9 242.6 242.7 0 133.7-108.9 242.6-242.6 242.6" p-id="2677"></path></svg></form><div id="search-result"></div><div class="search-no-result">æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼</div></div></div></widget>


<widget class="widget-wrapper toc single" id="data-toc"><div class="widget-header cap dis-select"><span class="name">åŸºäºçŒªé½¿é±¼å¹³å°çš„axiosç¼“å­˜å°è£…</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E8%AF%B4%E6%98%8E"><span class="toc-text">éœ€æ±‚è¯´æ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%83%85%E5%86%B51%EF%BC%9A"><span class="toc-text">æƒ…å†µ1ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%83%85%E5%86%B52%EF%BC%9A"><span class="toc-text">æƒ…å†µ2ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%83%85%E5%86%B53%EF%BC%9A"><span class="toc-text">æƒ…å†µ3ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-text">éœ€æ±‚åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%88%86%E6%9E%90"><span class="toc-text">ç¼“å­˜åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%AC%A1%E7%9B%B8%E5%90%8C%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86"><span class="toc-text">å¤šæ¬¡ç›¸åŒè¯·æ±‚å¤„ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E8%B7%AF%E7%94%B1%E5%8F%96%E6%B6%88pending%E8%AF%B7%E6%B1%82"><span class="toc-text">åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-text">å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#axios%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="toc-text">axiosçš„å®ä¾‹åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E8%AF%86%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">æ ‡è¯†çš„å®ç°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%AE%9E%E7%8E%B0"><span class="toc-text">ç¼“å­˜å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE"><span class="toc-text">å­˜å‚¨æ•°æ®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%8B%A6%E6%88%AA%E5%99%A8%E5%AE%9E%E7%8E%B0"><span class="toc-text">è¯·æ±‚æ‹¦æˆªå™¨å®ç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">å“åº”æ‹¦æˆªå™¨çš„å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E8%B7%AF%E7%94%B1%E5%8F%96%E6%B6%88pending%E8%AF%B7%E6%B1%82-1"><span class="toc-text">åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">æ‹¦æˆªå™¨çš„å®ç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%AE%88%E5%8D%AB%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">è·¯ç”±å®ˆå«çš„å®ç°</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%97%E7%95%99%E9%97%AE%E9%A2%98"><span class="toc-text">é—ç•™é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E7%94%A8CancelToken%E5%8E%BB%E5%8F%96%E6%B6%88%E9%87%8D%E5%A4%8D%E8%AF%B7%E6%B1%82%E8%80%8C%E7%94%A8%E7%BC%93%E5%AD%98%E5%8E%9F%E7%90%86%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆä¸ç”¨CancelTokenå»å–æ¶ˆé‡å¤è¯·æ±‚è€Œç”¨ç¼“å­˜åŸç†ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0%E4%B8%80%EF%BC%9A"><span class="toc-text">åŸå› ä¸€ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0%E4%BA%8C"><span class="toc-text">åŸå› äºŒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0%E4%B8%89"><span class="toc-text">åŸå› ä¸‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%8B%A6%E6%88%AA%E5%99%A8%E7%9A%84%E6%B7%BB%E5%8A%A0%E9%A1%BA%E5%BA%8F%E4%BC%9A%E5%BD%B1%E5%93%8D%E5%88%B0%E7%BC%93%E5%AD%98%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆæ‹¦æˆªå™¨çš„æ·»åŠ é¡ºåºä¼šå½±å“åˆ°ç¼“å­˜ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%8F%96%E6%B6%88cancelAllRequest%E6%96%B9%E6%B3%95%E4%B8%AD%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%88%A0%E9%99%A4cache%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%9F"><span class="toc-text">è·¯ç”±å–æ¶ˆcancelAllRequestæ–¹æ³•ä¸­ä¸ºä»€ä¹ˆè¦åˆ é™¤cacheä¸­çš„æ•°æ®ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%BE%E7%82%B9%E8%A7%A3%E5%86%B3"><span class="toc-text">éš¾ç‚¹è§£å†³</span></a></li></ol></div></div></widget>




</div>


    </aside>
    <div class='l_main'>
      

      


<div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/">ä¸»é¡µ</a><span class="sep"></span><a class="cap breadcrumb" href="/">æ–‡ç« </a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/js/">js</a></div><div id="post-meta">å‘å¸ƒäº&nbsp;<time datetime="2021-06-24T06:02:44.000Z">2021-06-24</time></div></div>

<article class='md-text content post'>
<h1 class="article-title"><span>åŸºäºçŒªé½¿é±¼å¹³å°çš„axiosç¼“å­˜å°è£…</span></h1>
<h2 id="éœ€æ±‚è¯´æ˜"><a href="#éœ€æ±‚è¯´æ˜" class="headerlink" title="éœ€æ±‚è¯´æ˜"></a>éœ€æ±‚è¯´æ˜</h2><h3 id="æƒ…å†µ1ï¼š"><a href="#æƒ…å†µ1ï¼š" class="headerlink" title="æƒ…å†µ1ï¼š"></a>æƒ…å†µ1ï¼š</h3><p>çŒªé½¿é±¼å¹³å°æ˜¯ä¸ªç›¸å¯¹å¤æ‚çš„å¤šè¡¨æ ¼å¤šè¡¨å•æ•°æ®å¤„ç†å¹³å°ï¼Œæœ‰äº›æ¨¡å—çš„æ•°æ®é‡åºå¤§ï¼Œå¹¶ä¸”æœ‰äº›å–œæ¬¢åµŒå…¥åœ¨tabé¡µé¢å½“ä¸­ï¼Œå¦‚æœé¢‘ç¹çš„å»è®¿é—®è¿™äº›é¡µé¢å°±ä¼šé¢‘ç¹çš„è¯·æ±‚ï¼Œå¦‚æœæ•°æ®é‡åºå¤§ï¼Œæ¯æ¬¡è®¿é—®éƒ½ä¼šå»è¯·æ±‚æ•°æ®ï¼Œç­‰å¾…æ—¶é—´å°±å˜é•¿äº†ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªç•Œé¢ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="7.gif" alt="7"></p>
<p>è¿™ä¸ªé¡µé¢ç›¸å½“äºæ˜¯å†å²çš„æ‰§è¡Œè®°å½•ï¼Œå› ä¸ºæ•°æ®é‡åºå¤§ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¡µé¢è¯·æ±‚è¿‡åå“åº”é€Ÿåº¦è¾ƒæ…¢ï¼Œå‡è®¾æˆ‘åœ¨çŸ­æ—¶é—´å†…åˆ‡åˆ°åˆ«çš„è®°å½•åˆåˆ‡å›æ¥è¦çœ‹ï¼Œé‚£è¿˜å¾—é‡æ–°å†å»è¯·æ±‚è¿™1000å¤šæ¡çš„æ•°æ®ï¼Œè¿™ä¸ªæ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œç”¨æˆ·ç­‰å¾…æ—¶é—´å°±å˜é•¿äº†</p>
<h3 id="æƒ…å†µ2ï¼š"><a href="#æƒ…å†µ2ï¼š" class="headerlink" title="æƒ…å†µ2ï¼š"></a>æƒ…å†µ2ï¼š</h3><p>åœ¨ä¸€ä¸ªé¡µé¢æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œæˆ–è€…åœ¨æŸäº›ä¸æ­£å½“çš„äº¤äº’æ“ä½œä¸­ï¼Œç”¨æˆ·å¯èƒ½é¢‘ç¹çš„å‘åå°å»å‘é€åŒä¸€ä¸ªè¯·æ±‚ï¼ˆå‚æ•°urlç­‰å¾…éƒ½ä¸€æ ·ï¼‰ï¼Œæˆ–åˆæ˜¯å†æ¸²æŸ“é¡µé¢çš„ä¸€ç¬é—´è§¦å‘äº†å¤šæ¬¡åŒä¸€è¯·æ±‚ï¼Œè¿™æ ·å°±å¾ˆæµªè´¹å¸¦å®½ï¼Œå¤šæ¬¡è¯·æ±‚å‰ç«¯è¿˜éœ€è¦è¿›è¡Œå¤šæ¬¡çš„å“åº”å¤„ç†ï¼Œä¾‹å¦‚ä»¥ä¸‹æƒ…å†µ</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20210624155243688.png" alt="image-20210624155243688"></p>
<p>åœ¨æ¸²æŸ“é¡µé¢æ—¶ï¼ŒåŒæ—¶å‘é€äº†å¤šä¸ªç›¸åŒè¯·æ±‚ï¼Œå¤§å¤šæ—¶å€™æ˜¯é¡µé¢é€»è¾‘å¤„ç†çš„æœ‰é—®é¢˜ï¼Œå¤šæ¬¡å‘åå°è·å–æ•°æ®äº†ï¼Œæˆ–è€…æ˜¯æˆ‘é¢‘ç¹çš„å»ç‚¹å‡»ä¸€ä¸ªæ²¡æœ‰åšé˜²æŠ–çš„æŒ‰é’®æˆ–è€…æ²¡æœ‰èŠ‚æµçš„ä¸€äº›é¢‘ç¹è¯·æ±‚</p>
<h3 id="æƒ…å†µ3ï¼š"><a href="#æƒ…å†µ3ï¼š" class="headerlink" title="æƒ…å†µ3ï¼š"></a>æƒ…å†µ3ï¼š</h3><p>å‡è®¾æˆ‘é”™è¯¯çš„ç‚¹å‡»äº†ä¸€ä¸ªèœå•çš„åŒæ—¶åˆå»åˆ‡åˆ°äº†å¦å¤–ä¸€ä¸ªèœå•ï¼Œè¿™æ—¶å€™è™½ç„¶è¯´å·²ç»åˆ‡æ¢åˆ°äº†æƒ³è¦çš„èœå•è·¯ç”±ä¸‹å¯¹åº”çš„ç•Œé¢ï¼Œä½†æ˜¯ç”±äºä½ é”™è¯¯çš„æ“ä½œï¼Œè™½ç„¶ä¸Šä¸ªé¡µé¢åœ¨åˆ‡è·¯ç”±ç¬é—´è¢«é”€æ¯ï¼Œä½†æ˜¯åˆå§‹åŒ–é¡µé¢çš„ä¸€äº›è·å–åå°æ•°æ®çš„è¯·æ±‚å·²ç»å‘å‡ºå»äº†ï¼Œä½ è®¿é—®çš„å½“å‰é¡µé¢æ˜¯ä¸éœ€è¦è¿™äº›è¯·æ±‚çš„ã€‚ä¾‹å¦‚ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="test.gif" alt="test"></p>
<p>è¿™ä¸ªä¾‹å­å°±æ˜¯ï¼Œæˆ‘å…ˆç‚¹å‡»äº†ä»£ç ç®¡ç†çš„èœå•ï¼Œä»£ç ç®¡ç†æ¨¡å—ç»„ä»¶ç¬é—´è¢«åŠ è½½å‡ºæ¥ï¼Œå¹¶ä¸”å‘é€é¡µé¢è¯·æ±‚ï¼Œè¿™æ—¶å€™ä¸€ç¬é—´åˆ‡æ¢åˆ°åº”ç”¨æµæ°´çº¿çš„èœå•ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¼šçœ‹è§ï¼Œä»£ç ç®¡ç†æ¨¡å—çš„è¯·æ±‚å¾ˆå¤šæ²¡å¿…è¦çš„éƒ½å‘é€å‡ºå»äº†ï¼Œè¿™äº›è¯·æ±‚å¹¶ä¸æ˜¯æˆ‘ä»¬åº”ç”¨æµæ°´çº¿æ¨¡å—éœ€è¦ç”¨çš„åˆ°çš„ã€‚</p>
<p>å¦‚æœä¸Šä¸ªé¡µé¢çš„è¯·æ±‚å¾ˆæ…¢æˆ–è€…å¾ˆå¤šæƒ…å†µä¸‹ï¼Œéƒ½ä¼šå ç”¨ä¸å¿…è¦çš„èµ„æºä»¥åŠå‰ç«¯å¤„ç†æ—¶é—´ï¼Œå ç”¨èµ„æºã€‚</p>
<h2 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h2><ol>
<li>é’ˆå¯¹æƒ…å†µ1, æˆ‘ä»¬å¯ä»¥åšç¼“å­˜, ç±»ä¼¼äºDataSetçš„lookupï¼Œä½†åˆä¸å®Œå…¨ç±»ä¼¼ã€‚ä¹Ÿå¯ä»¥åšç±»ä¼¼tabçš„æ•°æ®ç¼“å­˜å¤„ç†ï¼Œ ä½†æ˜¯å¦‚æœé¡µé¢å¤šèµ·æ¥ï¼Œæˆ‘ä»¬å°±éœ€è¦å¤šæ¬¡åˆ†åˆ«å¯¹æ•°æ®è¿›è¡Œç¼“å­˜å¤„ç†ã€‚</li>
<li>é’ˆå¯¹ç¬¬äºŒç§çš„æƒ…å†µï¼Œå¯ä»¥å°†é‡å¤çš„è¯·æ±‚ç»™å–æ¶ˆæ‰ï¼Œæˆ–è€…è¯´åœ¨è¿™ä¸€ç¬é—´å‘é€çš„å¤šæ¬¡ç›¸åŒè¯·æ±‚éƒ½å…±ç”¨ç¬¬ä¸€æ¬¡å‘é€çš„é‚£ä¸ªè¯·æ±‚çš„å“åº”çŠ¶æ€ã€‚ä¸€äº›æŒ‰é’®æˆ–è€…é¢‘ç¹è¯·æ±‚çš„æ“ä½œåšèŠ‚æµå’Œé˜²æŠ–å¤„ç†ï¼Œè¿™ä¸ªå°±ä¸å†è¿™æ¬¡çš„è®¨è®ºèŒƒå›´å†…äº†</li>
<li>ç¬¬ä¸‰ç§æƒ…å†µåœ¨åˆ‡æ¢è·¯ç”±çš„æ—¶å€™å¯ä»¥æƒ³åŠæ³•æŠŠä¸Šä¸ªé¡µé¢è¿˜åœ¨pendingä¸­çš„è¯·æ±‚ç»™å–æ¶ˆæ‰</li>
<li>çŒªé½¿é±¼å¹³å°ç”¨çš„æ˜¯axios + DataSetæ¥è¿›è¡Œå‰åç«¯æ•°æ®äº¤äº’ä»¥åŠè¯·æ±‚å¤„ç†çš„ï¼Œæ‰€ä»¥åŸºäºä»–ä»¬è¦å¦‚ä½•å®Œç¾å®ç°å‘¢ï¼Ÿ</li>
</ol>
<p><strong>ç»¼ä¸Šæ‰€è¿°ï¼š</strong>æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªï¼Œèƒ½å¤Ÿå®ç°å–æ¶ˆï¼Œåˆèƒ½å®ç°ç¼“å­˜çš„ï¼Œé‡ç‚¹æ˜¯å®ç°ç›¸åŒè¯·æ±‚çš„çŠ¶æ€æ•°æ®çš„å…¬ç”¨ä»¥åŠä¸å½±å“datasetçš„ä½¿ç”¨çš„ä¸œè¥¿</p>
<p>å¯ä»¥æƒ³åˆ°çš„æ˜¯ï¼Œæˆ‘ä»¬è‚¯å®šæ˜¯è¦å¯¹axiosçš„æ‹¦æˆªå™¨æˆ–è€…ä¸€äº›ç‰¹æ®Šå±æ€§ä¾‹å¦‚axiosçš„é€‚é…å™¨ï¼Œåšå¤„ç†ã€‚</p>
<h3 id="ç¼“å­˜åˆ†æ"><a href="#ç¼“å­˜åˆ†æ" class="headerlink" title="ç¼“å­˜åˆ†æ"></a>ç¼“å­˜åˆ†æ</h3><p>å‚è€ƒçŒªé½¿é±¼lookupçš„ç¼“å­˜åŸç†ï¼Œä»¥ä¸‹æ”¾å‡ºlookupç¼“å­˜çš„éƒ¨åˆ†æºç ï¼›</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20210625112724872.png" alt="image-20210625112724872"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20210625113745262.png" alt="image-20210625113745262"></p>
<p>lookupé€šè¿‡æ ‡è¯†ç¡®å®šæ˜¯å¦ç¼“å­˜ï¼Œä¹‹åå°†é€‚é…å™¨è¿”å›çš„æœŸçº¦ç›´æ¥ç»™ä¸€ä¸ªæ–°å¾—æœŸçº¦ï¼Œä¹‹åå­˜å‚¨è¿™ä¸ªæ–°å¾—æœŸçº¦ï¼Œåœ¨ä¸‹æ¬¡å‘é€ç›¸åŒè¯·æ±‚æ—¶å€™ç›´æ¥å°†è¿™ä¸ªæœŸçº¦æŠ›ç»™å®ƒï¼Œä»è€Œå®ç°è¯·æ±‚çš„å¤ç”¨</p>
<p><strong>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½axios çš„ adpaterçš„åŸç†ï¼š</strong></p>
<p>æºç æ˜¯è¿™æ ·çš„</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20210625160815760.png" alt="image-20210625160815760"></p>
<p>å¯ä»¥çŸ¥é“çš„æ˜¯ï¼Œaxios çš„ transformRequestä»¥åŠä»–çš„å„ä¸ªè¯·æ±‚æ‹¦æˆªå™¨æ˜¯åœ¨returnè¿™ä¸ªæœŸçº¦ä¹‹å‰å‘ç”Ÿçš„ï¼Œä¹‹åè¯·æ±‚å®Œæˆï¼Œadapterå°†è¯·æ±‚åçš„ç»“æœä¼ é€’ç»™æœŸçº¦ï¼Œä¹‹åæœŸçº¦è½å®šï¼Œåé¢æ‰è§¦å‘å“åº”æ•°æ®è½¬æ¢ï¼ˆtransformReponseï¼‰ä»¥åŠå“åº”æ‹¦æˆªå™¨ï¼ˆè¿™ä¸ªé¡ºåºéå¸¸çš„é‡è¦ï¼‰ã€‚</p>
<p>æ—¢ç„¶è¦ç¼“å­˜ï¼Œä¸€å®šè¦æŠŠç¬¬ä¸€æ¬¡è½å®šçš„è¯·æ±‚æœŸçº¦ï¼Œæƒ³åŠæ³•ï¼ˆåŒ…å«äº†å“åº”ç æ•°æ®ç­‰ç­‰ç­‰ï¼‰å­˜å‚¨èµ·æ¥ï¼Œéœ€è¦ç”¨åˆ°çš„æ—¶å€™æ‰å»ä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥ç¡®å®šçš„æ˜¯æˆ‘ä»¬ç¼“å­˜éœ€è¦å¯¹adapterè¿›è¡Œæ“ä½œï¼Œå¹¶ä¸”åœ¨å“åº”å’Œè¯·æ±‚çš„æ‹¦æˆªå™¨ä¸­åšæ ‡è¯†ç­‰ç­‰æ“ä½œ</p>
<h3 id="å¤šæ¬¡ç›¸åŒè¯·æ±‚å¤„ç†"><a href="#å¤šæ¬¡ç›¸åŒè¯·æ±‚å¤„ç†" class="headerlink" title="å¤šæ¬¡ç›¸åŒè¯·æ±‚å¤„ç†"></a>å¤šæ¬¡ç›¸åŒè¯·æ±‚å¤„ç†</h3><p>ä¸€å¼€å§‹æˆ‘æƒ³ç”¨XMLHttpRequestçš„abortä¹Ÿå°±æ˜¯axiosçš„CancelTokenï¼ˆaxioså¯¹abortè¿›è¡Œäº†å°è£…ï¼‰å»å°†é¡µé¢æ­£åœ¨æ¸²æŸ“çš„æ—¶å€™ä¸€ä¸ªä¸ªé‡å¤çš„è¯·æ±‚cancelæ‰ï¼Œä½†æ˜¯è¿™æ ·æœ‰å¤šç§å¼Šç«¯ï¼Œç•™åˆ°æœ€åä¸€ç‚¹è®²ã€‚</p>
<p>å¤šæ¬¡ç›¸åŒè¯·æ±‚æ˜¯ä¸€ç¬é—´çš„äº‹æƒ…ï¼Œè¦åœ¨è¿™ä¸€ç¬é—´å¤ç”¨è¯·æ±‚å¿…é¡»ç”¨åˆ°ä¸Šé¢ç¼“å­˜æ‰€è¯´çš„å­˜å‚¨æœŸçº¦ã€‚</p>
<p>ä¸€ç¬é—´å’±ä»¬å°±å¯ä»¥å®šä¸€ä¸ªé»˜è®¤æ—¶é—´æˆ³ï¼Œä¾‹å¦‚1000msï¼Œè¿™ä¸ªæ—¶é—´æˆ³è¡¨ç¤ºçš„æ˜¯ï¼Œåœ¨è¿™1000msä¸­è¿›æ¥çš„è¯·æ±‚éƒ½å…±ç”¨ä¸€ä¸ªadapterçš„æœŸçº¦ï¼Œè¿™æ ·å®šä¹‰ä¸€ä¸ªé»˜è®¤æ—¶é—´æˆ³ï¼Œå°±å¯ä»¥åšåˆ°ç±»ä¼¼å–æ¶ˆé‡å¤è¯·æ±‚çš„ä½œç”¨ï¼ˆå®é™…ä¸Šæ˜¯ç”¨äº†ç¼“å­˜ï¼‰ã€‚</p>
<p>å½“ç„¶æ—¢ç„¶åŠ äº†ç¼“å­˜ï¼ŒåˆåŠ äº†æ—¶é—´æˆ³ï¼Œçµæ´»åº”ç”¨ä¸€ä¸‹å°±å¯ä»¥å®ç°ä¸€ä¸ªï¼Œåœ¨å¯¹åº”æ—¶é—´å†…ä¸å•å•æ˜¯1000msï¼Œæˆ‘å‘çš„ç›¸åŒè¯·æ±‚éƒ½å…±ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ—¶é—´æˆ³ç›´æ¥å®šä¹‰åœ¨axiosé»˜è®¤å±æ€§ä¸Šæˆ–è€…axiosåˆ›å»ºå‡ºæ¥çš„å®ä¾‹ä¸Šé¢ï¼Œå®šä¹‰é»˜è®¤å€¼1000msï¼Œä¹‹åå¦‚æœæƒ³è¦ç¼“å­˜æ—¶é—´é•¿ä¸€ç‚¹çš„è¯ç›´æ¥åœ¨datasetçš„transportå¯¹åº”çš„æ–¹æ³•é…ç½®é¡¹ä¸‹é¢æˆ–è€…æ˜¯axioså®ä¾‹ä¸Šæ·»åŠ æ—¶é—´æˆ³ï¼Œç”¨æ¥è¦†ç›–é»˜è®¤çš„æ—¶é—´æˆ³ï¼Œå› æ­¤å¯ä»¥å®ç°é•¿æ•ˆç¼“å­˜ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20210625173040963.png" alt="image-20210625173040963"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20210625173136449.png" alt="image-20210625173136449"></p>
<h3 id="åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚"><a href="#åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚" class="headerlink" title="åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚"></a>åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚</h3><p>è¿™é‡Œå¿…é¡»ç”¨åˆ°axiosçš„CancelTokenã€‚ä¸Šé¢è¯´åˆ°CancelTokençš„å…¶å®å°±æ˜¯å¯¹<code>XMLhttpRequest</code>çš„abortæ–¹æ³•è¿›è¡Œå°è£…ï¼Œ <code>XMLHttpRequest</code> å¯¹è±¡æ˜¯æˆ‘ä»¬å‘èµ·ä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„æ ¹æœ¬ï¼Œåœ¨å®ƒåº•ä¸‹æœ‰æ€ä¹ˆä¸€ä¸ªæ–¹æ³• <code>.abort()</code>ï¼Œå°±æ˜¯ä¸­æ–­ä¸€ä¸ªå·²è¢«å‘å‡ºçš„è¯·æ±‚ã€‚ </p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20210625211727335.png" alt="image-20210625211727335"></p>
<p> ç®€å•ç†è§£å°±æ˜¯é€šè¿‡ <code>new axios.CancelToken()</code>ç»™æ¯ä¸ªè¯·æ±‚å¸¦ä¸Šä¸€ä¸ªä¸“å±çš„CancelTokenï¼Œä¹‹åä¼šæ¥æ”¶åˆ°ä¸€ä¸ª<code>cancel()</code> å–æ¶ˆæ–¹æ³•ï¼Œç”¨äºåç»­çš„å–æ¶ˆåŠ¨ä½œã€‚ </p>
<p>æ‰€ä»¥ï¼Œæ¯æ¬¡è¯·æ±‚è¿›æ¥çš„æ—¶å€™å»è·å–æœ¬æ¬¡è¯·æ±‚çš„CancelTokenï¼Œä¹‹åå°†å…¶å­˜èµ·æ¥ï¼ˆè¿™é‡Œå‡è®¾ç”¨CancelQueueçš„ä¸€ä¸ªMapæ•°æ®ç±»å‹ï¼ˆ<code>Object.prototype.toString.call(CancelQueue) = &#39;[object Map]&#39;</code>ï¼‰ï¼‰ï¼Œä¹‹åå‡å¦‚è¿™ä¸ªè¯·æ±‚è½å®šäº†ï¼Œå°±å°†è¿™ä¸ªå­˜å‚¨CancelTokençš„è¯·æ±‚æ ‡è¯†åˆ é™¤ã€‚</p>
<p>å¦‚æœè¿™æ—¶å€™åˆ‡æ¢è·¯ç”±äº†ï¼Œæˆ‘ä»¬å°±å»CancelQueueä¸­ï¼Œéå†ä¸€éæ‰€æœ‰çš„è¯·æ±‚æ ‡è¯†ï¼ˆå› ä¸ºè¿™æ—¶å€™å†é˜Ÿåˆ—é‡Œå¤´çš„è‚¯å®šæ˜¯è¿˜åœ¨pendingçš„è¯·æ±‚ï¼‰ï¼Œè°ƒç”¨å…¶å­˜å‚¨çš„CancelTokenè°ƒç”¨cancelæ–¹æ³•è¿›è¡Œè¯·æ±‚å–æ¶ˆï¼Œå¹¶åˆ é™¤æ ‡è¯†ã€‚</p>
<pre><code class="js">// 1. è·å– axios CancelToken
const &#123; CancelToken &#125; = axios;

// 2. è·å–å½“å‰è¯·æ±‚çš„sourceï¼Œå¹¶ä¸”å°†å…¶cancelæ–¹æ³•å­˜å‚¨èµ·æ¥
const source = CancelToken.source();

// 3. ä¹‹åè°ƒç”¨è¿™ä¸ªcancelæ–¹æ³•
source.cancel();
</code></pre>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="axiosçš„å®ä¾‹åŒ–"><a href="#axiosçš„å®ä¾‹åŒ–" class="headerlink" title="axiosçš„å®ä¾‹åŒ–"></a>axiosçš„å®ä¾‹åŒ–</h3><p>é¦–å…ˆå®ä¾‹åŒ–axios(è¿™æ˜¯æˆ‘ä»¬å…¨å±€å°è£…çš„axios)ï¼Œåœ¨å…¶ä¸­åŠ å…¥ç¼“å­˜æ ‡è¯†ï¼Œæ ‡è¯†å¼€å¯ç¼“å­˜ï¼ˆé‡å¤è¯·æ±‚å…±ç”¨ï¼‰</p>
<pre><code class="js">const instance:AxiosStatic = axios.create(&#123;
  timeout: 30000,
  baseURL: API_HOST,
&#125;);

// è¿™é‡Œé…ç½®ä¸€ä¸ªç¼“å­˜è¯·æ±‚å¾—æ ‡è¯†
instance.defaults.enabledCancelCache = true;</code></pre>
<h3 id="æ ‡è¯†çš„å®ç°"><a href="#æ ‡è¯†çš„å®ç°" class="headerlink" title="æ ‡è¯†çš„å®ç°"></a>æ ‡è¯†çš„å®ç°</h3><p>å¯¹äºæ¯ä¸€ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ ‡è¯†ï¼Œæ ‡è¯†å”¯ä¸€ï¼Œæ ‡è¯†æ˜¯é€šè¿‡æ¯ä¸€ä¸ªè¯·æ±‚çš„<code>url</code>, <code>params</code>, <code>method</code>, ä»¥åŠ <code>data</code>å»ºç«‹æ ‡è¯†ï¼Œåªè¦é€šè¿‡è¿™4è€…å»ºç«‹çš„æ ‡è¯†ç›¸åŒï¼Œé‚£æˆ‘ä»¬å°±èƒ½ç¡®å®šæŸäº›è¯·æ±‚æ˜¯ç›¸åŒçš„ï¼Œ</p>
<p>å¦‚ä¸‹<code>getMark</code>æ˜¯å»ºç«‹ä¸»æ ‡è¯†ï¼Œ<code>getDataMark</code>æ˜¯å¯¹å“åº”ä½“å†…çš„dataçš„æ ‡è¯†</p>
<p>paramsè¦è¿›è¡Œå‚æ•°æ‹¼æ¥ï¼Œç°åœ¨ä¸»æµåŸºæœ¬åœ¨ç”¨<code>application/json</code>å½¢å¼ï¼ŒAxiosé»˜è®¤ä»¥è¿™ç§å½¢å¼å·¥ä½œï¼Œæˆ‘ä»¬ç»™åç«¯æ¥å£ä¼ é€’å‚æ•°ä¹Ÿç®€å• ï¼Œä½†æ˜¯æœ‰æ—¶å€™éœ€è¦ Content-Typeå¿…é¡»ä»¥application/x-www-form-urlencodedå½¢å¼ ï¼Œä»¥JSONæ ¼å¼åå°æ˜¯æ”¶ä¸åˆ°çš„ï¼Œè€Œè¿™æ—¶å€™å°±è¦è¿›è¡Œåºåˆ—åŒ–å¤„ç†ï¼ˆå…ˆå‰æ˜¯æœ‰å‰è¾ˆåœ¨è¿™é‡Œåšäº†å¤„ç†çš„ï¼‰ï¼Œä½†æ˜¯è¿™é‡Œä¸å¤šè¯´å‚æ•°åºåˆ—åŒ–</p>
<pre><code class="js">import &#123; get &#125; from &#39;lodash&#39;;
import &#123; AxiosRequestConfig &#125; from &#39;axios&#39;;
import JSONbig from &#39;json-bigint&#39;;
import paramsSerializer from &#39;./paramsSerializer&#39;;

// å•ç‹¬å¤„ç†dataï¼Œresponseé‡Œé¢è¿”å›çš„config.dataæ˜¯ä¸ªå­—ç¬¦ä¸²å¯¹è±¡
function getDataMark(data:any) &#123;
  let stringifyData = data;
  if (typeof stringifyData === &#39;string&#39;) &#123;
    stringifyData = JSONbig.parse(stringifyData);
  &#125;
  return stringifyData;
&#125;

// åŒºåˆ«è¯·æ±‚çš„å”¯ä¸€æ ‡è¯†ï¼Œè¿™é‡Œç”¨æ–¹æ³•å+è¯·æ±‚è·¯å¾„
// å¦‚æœä¸€ä¸ªé¡¹ç›®é‡Œæœ‰å¤šä¸ªä¸åŒbaseURLçš„è¯·æ±‚ + å‚æ•°
export default function getMark(config:AxiosRequestConfig) &#123;
  const getKey = (key:string) =&gt; get(config, key);

  // paramsæ ‡è¯†å¤„ç†ï¼Œå°†å…¶å¤„ç†æˆ?key=value&amp;key2=valueçš„å½¢å¼
  const tempQueryString = (getKey(&#39;paramsSerializer&#39;) ?? paramsSerializer)(getKey(&#39;params&#39;));

  // dataæ ‡è¯†å¤„ç†
  const dataMark = JSONbig.stringify(getDataMark(getKey(&#39;data&#39;)));

  // baseæ ‡è¯†
  const requestMark = [
    config?.method?.toLowerCase() || &#39;unknownMethod&#39;,
    config?.url,
  ];

  getKey(&#39;params&#39;) &amp;&amp; requestMark.push(tempQueryString);
  getKey(&#39;data&#39;) &amp;&amp; requestMark.push(dataMark);
  return requestMark.join(&#39;&amp;&#39;);
&#125;</code></pre>
<p>æœ€ç»ˆçš„æ‹¼æ¥å½¢å¼æ˜¯ <code>method &amp; url &amp; params &amp; data</code>çš„å½¢å¼ï¼Œ</p>
<p>ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªè¯·æ±‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20210625210606969.png" alt="image-20210625210606969"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20210625210632981.png" alt="image-20210625210632981"></p>
<p>æœ€ç»ˆæ‹¼æ¥å‡ºæ¥çš„æ˜¯</p>
<p><code>post&amp;http://172.23.16.92:30094/iam/choerodon/v1/permissions/menus/check-permissions&amp;tenantId=2&amp;[&quot;choerodon.code.organization.project.ps.create&quot;]</code></p>
<h3 id="ç¼“å­˜å®ç°"><a href="#ç¼“å­˜å®ç°" class="headerlink" title="ç¼“å­˜å®ç°"></a>ç¼“å­˜å®ç°</h3><p>è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨æ‹¦æˆªå™¨çš„å½¢å¼å»æ·»åŠ ç¼“å­˜é€»è¾‘ï¼Œä»¥ä¸‹æ˜¯æ·»åŠ äº†è¯·æ±‚æ‹¦æˆªå™¨</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20210626094315248.png" alt="image-20210626094315248"></p>
<p>ä¸‹é¢æ ‡çº¢çš„æ˜¯æ·»åŠ å“åº”æ‹¦æˆªå™¨</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20210626094721131.png" alt="image-20210626094721131"></p>
<p>è‡³äºè¿™é‡Œæ‹¦æˆªå™¨çš„é¡ºåºä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„ï¼Œåç»­å†è¯´</p>
<p>å…¶æ¬¡ï¼Œæˆ‘ä»¬è¦æ˜ç™½è¯·æ±‚çš„å‡ ç§æƒ…å†µ</p>
<p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªAè¯·æ±‚è¿›æ¥äº†</p>
<ol>
<li>è¿˜åœ¨pendingçš„æ—¶å€™ï¼Œåœ¨é»˜è®¤æ—¶é—´æˆ³å†…ï¼ˆ1000msï¼‰åˆè¿›æ¥äº†ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„Aè¯·æ±‚ï¼ˆé‡å¤äº†,å…±ç”¨çŠ¶æ€ï¼‰</li>
<li>Aè¯·æ±‚å·²ç»è½å®šäº†<strong>æˆåŠŸäº†</strong>ï¼Œåœ¨å®šä¹‰çš„æ—¶é—´æˆ³èŒƒå›´å†…åˆè¿›æ¥äº†å¤šä¸ªä¸€æ¨¡ä¸€æ ·çš„è¯·æ±‚ï¼ˆç¼“å­˜ï¼‰</li>
<li>Aè¯·æ±‚è½å®š<strong>å¤±è´¥äº†</strong>ï¼Œåœ¨å®šä¹‰çš„æ—¶é—´æˆ³èŒƒå›´å†…åˆè¿›æ¥äº†å¤šä¸ªä¸€æ¨¡ä¸€æ ·çš„è¯·æ±‚ï¼ˆä¸ç¼“å­˜ï¼‰</li>
</ol>
<p>æœ€åæ˜ç¡®éœ€è¦å­˜å‚¨åœ¨ç¼“å­˜å®ä¾‹ä¸­çš„æ•°æ®æ ¼å¼</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20210626101834505.png" alt="image-20210626101834505"></p>
<h4 id="å­˜å‚¨æ•°æ®"><a href="#å­˜å‚¨æ•°æ®" class="headerlink" title="å­˜å‚¨æ•°æ®"></a>å­˜å‚¨æ•°æ®</h4><p>æˆ‘ä»¬éœ€è¦ä»¥ä¸€ç§é”®å€¼å¯¹çš„å½¢å¼å»å­˜å‚¨ï¼Œå¯é€‰é¡¹å°±å±Objectæˆ–è€…Mapã€‚</p>
<p>ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬éœ€è¦é¢‘ç¹çš„å¯¹ç¼“å­˜çš„æ•°æ®è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ’å…¥ï¼Œèµ‹å€¼ï¼Œåˆ é™¤æ“ä½œç­‰ç­‰ã€‚</p>
<p>åœ¨å°æ•°é‡æ•°æ®æƒ…å†µä¸‹Objectçš„æŸ¥æ‰¾æ•°æ®ç›¸å¯¹Mapæ¥çš„å¿«ï¼Œä½†æ˜¯æ¶‰åŠæ›´å¤šæ’å…¥çš„å’Œåˆ é™¤çš„æƒ…å†µä¸‹éƒ½æ˜¯Mapæ€§èƒ½æ¥çš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”ç›¸åŒå†…å­˜ä¸‹Mapèƒ½å¤Ÿå­˜å‚¨æ›´å¤šçš„é”®å€¼å¯¹ï¼Œè¿™é‡Œæ˜¾ç„¶å­˜åœ¨åºå¤§æ•°æ®çš„æƒ…å†µ</p>
<p>äºæ˜¯è¿™é‡Œå°è£…ä¸€ä¸ª<code>AxiosCache</code>ç¼“å­˜ç±»ï¼Œç„¶åå†™ä¸€äº›ç§æœ‰æ–¹æ³•åœ¨é‡Œå¤´</p>
<pre><code class="js">class AxiosCache &#123;
  constructor() &#123;
    super();
    this.cacheData = new Map();
  &#125;

  get size() &#123;
    return this.cacheData.size;
  &#125;

  get(key) &#123;
    return this.cacheData.get(key);
  &#125;

  delete(key) &#123;
    this.cacheData.delete(key);
  &#125;

  has(key) &#123;
    return this.cacheData.has(key);
  &#125;

  set(key, value) &#123;
    this.cacheData.set(key, value);
  &#125;

  isEmpty() &#123;
    return !!this.cacheData.size;
  &#125;

  clear() &#123;
    this.cacheData = new Map();
  &#125;
&#125;
const axiosCache = new AxiosCache();</code></pre>
<h4 id="è¯·æ±‚æ‹¦æˆªå™¨å®ç°"><a href="#è¯·æ±‚æ‹¦æˆªå™¨å®ç°" class="headerlink" title="è¯·æ±‚æ‹¦æˆªå™¨å®ç°"></a>è¯·æ±‚æ‹¦æˆªå™¨å®ç°</h4><ol>
<li><p>å½“Aè¯·æ±‚è¿›æ¥æ—¶å€™å‘ç°å…ˆå‰å¹¶æ²¡æœ‰åœ¨ç¼“å­˜é˜Ÿåˆ—ä¸­åšè¿‡æ ‡è¯†ï¼Œä¹Ÿå°±æ˜¯è¯´æ ‡è¯†é‡Œå¤´ä¸å­˜åœ¨ä»¥ä¸Šçš„é‚£äº›å­—æ®µï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å°†Aè¯·æ±‚åšä¸ªæ ‡è¯†ï¼Œå¹¶ä¸”è®¾ç½®å®ƒçš„isPendingï¼ˆæ­£åœ¨è¯·æ±‚ï¼‰ä¸º<code>true</code></p>
<pre><code class="ts">axiosCache.set(cancelCacheKey, &#123;
    isPending: true,
&#125;);</code></pre>
</li>
<li><p>å½“Aè¯·æ±‚å·²ç»åšè¿‡æ ‡è¯†çš„æ—¶å€™ï¼Œè¿™æ—¶å€™åˆè¿›æ¥ä¸€ä¸ªA1è¯·æ±‚</p>
<p>å€˜è‹¥ç¬¬ä¸€æ¬¡åšè¿‡æ ‡è¯†çš„Aè¯·æ±‚å·²ç»ä¸æ˜¯åœ¨pendingçŠ¶æ€å¹¶ä¸”åœ¨è¿™æ¬¡è¯·æ±‚çš„æ—¶é—´æˆ³çš„èŒƒå›´å†…ï¼ˆåœ¨åé¢è®²å“åº”æ‹¦æˆªå™¨çš„æ—¶å€™ä¼šæŠŠAçš„isPendingå­—æ®µåœ¨æŸç§æ¡ä»¶ä¸‹è®¾ç½®ä¸º<code>false</code>, å¹¶ä¸”å­˜å‚¨Aè¯·æ±‚å“åº”åçš„æ•°æ®ï¼‰ï¼ŒA1è¯·æ±‚å°±ç›´æ¥å»å–Aç¼“å­˜çš„æ•°æ®</p>
<p>è¿™é‡Œå°±æ¶‰åŠåˆ°ä¸Šé¢æ‰€è¯´çš„é€‚é…å™¨çš„ç”¨å¤„ï¼Œç›´æ¥åœ¨A1è¯·æ±‚configçš„é€‚é…å™¨è¿”å›ä¸€ä¸ªæˆåŠŸè½å®šçš„æœŸçº¦ï¼Œé€šè¿‡æ ‡è¯†æ‹¿åˆ°cacheå®ä¾‹ä¸­ç¼“å­˜çš„æ•°æ®æ•°æ®ã€‚</p>
<pre><code class="ts">// isPendingä¸ºfalseçš„æƒ…å†µä¸‹ï¼Œå¹¶ä¸”åœ¨æ—¶é—´æˆ³çš„èŒƒå›´å†…
if (expire &amp;&amp; expire &gt; Date.now()) &#123;
  tempConfig.adapter = () =&gt; &#123;
    const resolveData: AxiosResponse = &#123;
      data,
      headers: tempConfig.headers,
      config: &#123;
        ...tempConfig,
        useCache: true,
      &#125;,
      // @ts-expect-error
      request: tempConfig,
    &#125;;
    return Promise.resolve(resolveData);
  &#125;;
&#125;</code></pre>
<p>è¿™é‡Œå®šä¹‰ä¸€ä¸ª<code>useCache</code>çš„å­—æ®µè¡¨æ˜è¿™ä¸ªæ˜¯å†ç”¨ç¼“å­˜æ•°æ®ï¼Œåç»­çš„å“åº”æ‹¦æˆªå™¨ä¸­ä¼šè®²åˆ°</p>
</li>
</ol>
<ol start="3">
<li><p>å½“Aè¯·æ±‚å·²ç»åšè¿‡æ ‡è¯†çš„æ—¶å€™ï¼Œè¿™æ—¶å€™åˆè¿›æ¥ä¸€ä¸ªA1è¯·æ±‚</p>
<p>å€˜è‹¥ç¬¬ä¸€æ¬¡åšè¿‡æ ‡è¯†çš„Aè¯·æ±‚è¿˜åœ¨pendingçš„çŠ¶æ€ï¼Œæˆ‘åˆæƒ³å…±ç”¨ç¼“å­˜æ•°æ®ï¼Œä½†æ˜¯å¹¶ä¸æ¸…æ¥šä»€ä¹ˆæ—¶å€™Aè¯·æ±‚æ‰ä¼šç»“æŸã€‚</p>
<p>è¿™æ—¶å€™æˆ‘ä»¬å°±æƒ³ï¼Œç”¨ä¸€ä¸ªå‘å¸ƒè®¢é˜…çš„æ¨¡å¼ï¼Œå°†A1è¯·æ±‚çš„<strong>æœŸçº¦è½å®šæ—¶æœº</strong>è®¢é˜…èµ·æ¥ï¼Œåœ¨Aè¯·æ±‚è½å®šçš„æ—¶å€™å‘Šè¯‰A1ä½ æ˜¯æ—¶å€™ä¹Ÿè¯¥è½å®šäº†å°±å»<strong>å‘å¸ƒ</strong>ä¿¡æ¯ï¼Œè¿™æ—¶å€™ç¼“å­˜çš„æ•°æ®å°±æ˜¯åœ¨Aè¯·æ±‚è½å®šæ—¶å€™ï¼Œå»å‘å¸ƒé¡ºä¾¿ç»™A1ä¼ é€’çš„.</p>
<blockquote>
<p>å…¶å®è¿™ä¸ªè¿‡ç¨‹å¯ä»¥æœ‰å¤šä¸ªA1è¿›æ¥</p>
</blockquote>
<p>å¦‚æœä¸å¥½ç†è§£çš„è¿™é‡Œæœ‰æµç¨‹å›¾</p>
<p>â€‹    <img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20210626111840112.png" alt="image-20210626111840112"></p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20210626111852379.png" alt="image-20210626111852379"></p>
<pre><code class="ts"> // è¯´æ˜æ‰¾åˆ°äº†è¯·æ±‚ä½†æ˜¯æ‰¾åˆ°çš„è¿™ä¸ªç¼“å­˜çš„è¯·æ±‚è¿˜åœ¨pendingï¼Œè¿™æ—¶å€™è®¢é˜…ä¸€ä¸ªæœŸçº¦å¾…ä¼šè¦ç”¨
 tempConfig.adapter = () =&gt; new Promise((resolve) =&gt; &#123;
     axiosEvent.once(cancelCacheKey, (res:unknown) =&gt; &#123;
       const resolveData: AxiosResponse = &#123;
         data: res,
         headers: tempConfig.headers,
         config: &#123;
           ...tempConfig,
           useCache: true,
         &#125;,
         // @ts-expect-error
         request: tempConfig,
       &#125;;
       resolve(resolveData);
     &#125;);
 &#125;);</code></pre>
<p>è¿™é‡ŒA1è¯·æ±‚è®¢é˜…äº†ä»¥ä¸€ä¸ªä»¥cancelCacheKeyä¸ºæ ‡è¯†çš„ä¿¡å·ã€‚</p>
</li>
</ol>
<p>è‡³äºAè¯·æ±‚è½å®šçš„æ—¶æœºï¼Œåˆ°å“åº”æ‹¦æˆªå™¨ä¸­åšå¤„ç†</p>
<ol start="4">
<li>å¦‚æœAè¯·æ±‚è¯·æ±‚å¤±è´¥æ€ä¹ˆåŠï¼Ÿé‚£è¿™æ—¶å€™æˆ‘ä»¬ä¸åšå¤„ç†ï¼Œä¹Ÿä¸åšæ ‡è¯†ï¼Œè¯·æ±‚å¤±è´¥èµ°çš„æ˜¯è¯·æ±‚å¤±è´¥çš„æ‹¦æˆªå™¨ã€‚</li>
</ol>
<p>ä»¥ä¸‹æ˜¯æ•´ä¸ªè¯·æ±‚æ‹¦æˆªå™¨ä»£ç </p>
<pre><code class="ts">import &#123; AxiosRequestConfig, AxiosResponse &#125; from &#39;axios&#39;;
import &#123; get &#125; from &#39;lodash&#39;;
import getMark, &#123; transformDataToString &#125; from &#39;../utils/getMark&#39;;
import &#123; axiosCache, axiosEvent &#125; from &#39;../instances&#39;;

export function handleCancelCacheRequest(config:AxiosRequestConfig) &#123;
  const tempConfig = config;
  // æ˜¯å¦å¼€å¯äº†ç¼“å­˜ï¼ˆå¤ç”¨é‡å¤è¯·æ±‚çŠ¶æ€ï¼‰
  const enabledCancelCache = get(tempConfig, &#39;enabledCancelCache&#39;);
  if (enabledCancelCache) &#123;
    // è·å–æ ‡è¯†
    const cancelCacheKey = getMark(tempConfig);

    if (!axiosCache.has(cancelCacheKey)) &#123;
      axiosCache.set(cancelCacheKey, &#123;&#125;);
    &#125;

    const &#123;
      data, // ç¼“å­˜çš„æ•°æ®
      isPending, // è¯·æ±‚æ˜¯å¦æ˜¯pendingçŠ¶æ€
      expire, // æ—¶é—´æˆ³
    &#125; = axiosCache.get(cancelCacheKey);

    if (isPending) &#123;
      // è¯´æ˜æ‰¾åˆ°äº†è¯·æ±‚ä½†æ˜¯æ‰¾åˆ°çš„è¿™ä¸ªç¼“å­˜çš„è¯·æ±‚è¿˜åœ¨pendingï¼Œè¿™æ—¶å€™è®¢é˜…ä¸€ä¸ªæœŸçº¦å¾…ä¼šè¦ç”¨
      tempConfig.adapter = () =&gt; new Promise((resolve) =&gt; &#123;
        axiosEvent.once(cancelCacheKey, (res:unknown) =&gt; &#123;
          const resolveData: AxiosResponse = &#123;
            data: res,
            headers: tempConfig.headers,
            config: &#123;
              ...tempConfig,
              useCache: true,
            &#125;,
            // @ts-expect-error
            request: tempConfig,
          &#125;;
          resolve(resolveData);
        &#125;);
      &#125;);
    &#125; else if (expire &amp;&amp; expire &gt; Date.now()) &#123;
      tempConfig.adapter = () =&gt; &#123;
        const resolveData: AxiosResponse = &#123;
          data: transformDataToString(data),
          headers: tempConfig.headers,
          config: &#123;
            ...tempConfig,
            useCache: true,
          &#125;,
          // @ts-expect-error
          request: tempConfig,
        &#125;;
        return Promise.resolve(resolveData);
      &#125;;
    &#125; else &#123;
      axiosCache.set(cancelCacheKey, &#123;
        isPending: true,
      &#125;);
    &#125;
  &#125;

  return tempConfig;
&#125;</code></pre>
<h4 id="å“åº”æ‹¦æˆªå™¨çš„å®ç°"><a href="#å“åº”æ‹¦æˆªå™¨çš„å®ç°" class="headerlink" title="å“åº”æ‹¦æˆªå™¨çš„å®ç°"></a>å“åº”æ‹¦æˆªå™¨çš„å®ç°</h4><p>å®ç°äº†è¯·æ±‚æ‹¦æˆªå™¨ä¹‹åï¼Œæˆ‘ä»¬æ¥å¤„ç†åœ¨å…ˆå‰æ‹¦æˆªå™¨ä¸­çš„ä¸€äº›å­—æ®µï¼Œä»¥åŠè¯·æ±‚å¤±è´¥çš„æ•°æ®å¤„ç†</p>
<ol>
<li><p>æˆ‘ä»¬å…ˆå¯¹å“åº”æˆåŠŸçš„çš„æ‹¦æˆªå™¨åšå¤„ç†</p>
<p>é¦–å…ˆæ˜¯å“åº”æˆåŠŸçš„æƒ…å†µä¸‹è€Œä¸”ä¹ŸæˆåŠŸæ‹¿åˆ°æƒ³è¦çš„æ•°æ®ï¼Œå‡è®¾è¿™ä¸ªå“åº”æˆåŠŸçš„è¯·æ±‚æ˜¯ä¸Šè¿°çš„Aè¯·æ±‚ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±åº”è¯¥è®°å½•ä¸‹Aè¯·æ±‚æœ€ç»ˆçš„æ‰€æœ‰æ•°æ®ä»¥åŠå®ƒéœ€è¦çš„ç¼“å­˜æ—¶é—´ï¼Œå¹¶ä¸”è®¾ç½®å®ƒisPendingå­—æ®µä¸ºfalseï¼Œæœ€é‡è¦çš„æ˜¯ç»™è®¢é˜…äº†cancelCacheKeyçš„ä¿¡æ¯çš„è¯·æ±‚ä»¬å‘å¸ƒä¸€ä¸ªä¿¡å·ï¼Œå‘Šè¯‰ä½ ä»¬å¯ä»¥æ¥æ‹¿æˆ‘çš„ï¼ˆAè¯·æ±‚ï¼‰æ•°æ®äº†ï¼</p>
<pre><code class="ts">if (enabledCancelCache &amp;&amp; !useCache) &#123;
    const finalData = resData;
    axiosCache.set(config?.cancelCacheKey || cancelCacheKey, &#123;
      data: finalData,
      isPending: false,
      expire: Date.now() + Number(enabledCancelCache) * 500,
    &#125;);
    // å‘å¸ƒè¿™ä¸ªä¿¡å·è®©æ‰€æœ‰è®¢é˜…äº†Açš„éƒ½èƒ½æ¥å—åˆ°ä¿¡æ¯
    axiosEvent.emit(cancelCacheKey, finalData);
&#125;</code></pre>
<p>è¿™é‡Œä¸ºä»€ä¹ˆè¦å¤šä¸€æ¬¡useCacheçš„åˆ¤æ–­å‘¢?</p>
<p>å› ä¸ºæˆ‘å…ˆå‰åœ¨è¯·æ±‚æ‹¦æˆªå™¨ä¸­å¤„ç†äº†adapterç”¨æ¥å¤„ç†ç¼“å­˜, èµ°å®Œäº†adapteræ‰ä¼šèµ°å“åº”æ‹¦æˆªå™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘åœ¨å“åº”æ‹¦æˆªå™¨é‡Œå¤´è¿˜å¾—åˆ¤æ–­ï¼Œè¿™æ¬¡åˆ°åº•æ˜¯èµ°çš„ç¼“å­˜ï¼Œè¿˜æ˜¯ç¬¬ä¸€æ¬¡éœ€è¦åšç¼“å­˜å‘¢ï¼Ÿæ‰€ä»¥æ‰çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘åœ¨ä¸Šé¢çš„adapteré‡Œå¤´åŠ å…¥äº†useCacheçš„å­—æ®µã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯Aè¯·æ±‚ç¬¬ä¸€æ¬¡è¿›æ¥ï¼ŒuseCacheå°±æ˜¯falseï¼Œå°±å¾—å»å­˜å€¼ï¼Œæ¥ä¸‹æ¥è¿›æ¥A1ï¼Œé‚£æˆ‘å°±å¾—èµ°ç¼“å­˜ï¼Œæˆ‘ä¸å†å»é‡æ–°è®¾ç½®æ–°å€¼äº†ã€‚</p>
</li>
</ol>
<ol start="2">
<li><p>æ²¡æœ‰æˆåŠŸæ‹¿åˆ°æƒ³è¦çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åç«¯è¿”å›é”™è¯¯ä¿¡æ¯çš„æƒ…å†µ</p>
<p>è¿™é‡Œæˆ‘ä»¬çš„åå°è¿”å›çš„é”™è¯¯æ ‡è¯†æ˜¯failedå­—æ®µï¼Œå°±ç›´æ¥å°†isPendingè®¾ç½®ä¸ºfalseä¸åšåç»­å¤„ç†ï¼Œå¹¶ä¸”å°†åœ¨è®¢é˜…äº†çš„è¯·æ±‚ä¿¡å·éƒ½åˆ é™¤(åˆ é™¤æ˜¯å› ä¸ºAè¯·æ±‚å¤±è´¥å°±å·²ç»æŠ¥é”™ï¼Œå…¶ä»–è¯·æ±‚å°±ä¸å¿…å†é‡å¤æŠ¥é”™)</p>
<pre><code class="js">axiosCache.set(cancelCacheKey, &#123;
  isPending: false,
&#125;);
axiosEvent.delete(cancelCacheKey);</code></pre>
</li>
<li><p>å½“ç„¶å“åº”å¤±è´¥æ‹¦æˆªå™¨ä¸­ä¹Ÿéœ€è¦åšä¸Šè¿°è¿™æ ·çš„å¤„ç†</p>
</li>
</ol>
<p>è¿™æ˜¯æœ€ç»ˆçš„å“åº”æˆåŠŸçš„æ‹¦æˆªå™¨ä»£ç ğŸ‘‡</p>
<pre><code class="js">import &#123; AxiosResponse &#125; from &#39;axios&#39;;
import get from &#39;lodash/get&#39;;
import &#123;
  prompt,
&#125; from &#39;@/utils&#39;;
import &#123; axiosCache, axiosEvent &#125; from &#39;../instances&#39;;
import getMark from &#39;../utils/getMark&#39;;

export default function handleResponseInterceptor(response:AxiosResponse) &#123;
  const resData = get(response, &#39;data&#39;);
  const config = get(response, &#39;config&#39;) || &#123;&#125;;

  const &#123; enabledCancelCache, useCache &#125; = config;
  const cancelCacheKey = getMark(config);
  if (get(response, &#39;status&#39;) === 204) &#123;
    return response;
  &#125;
  if (resData?.failed === true) &#123;
    axiosCache.set(cancelCacheKey, &#123;
      ...(axiosCache.get(cancelCacheKey) || &#123;&#125;),
      isPending: false,
    &#125;);

    if (!response?.config?.noPrompt) &#123;
      prompt(resData.message, &#39;error&#39;);
    &#125;
    throw resData;
  &#125;

  if (enabledCancelCache &amp;&amp; !useCache) &#123;
    const finalData = resData;
    axiosCache.set(config?.cancelCacheKey || cancelCacheKey, &#123;
      data: finalData,
      isPending: false,
      expire: Date.now() + Number(enabledCancelCache) * 500,
    &#125;);
    axiosEvent.emit(cancelCacheKey, finalData);
  &#125;

  return resData;
&#125;
</code></pre>
<h3 id="åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚-1"><a href="#åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚-1" class="headerlink" title="åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚"></a>åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚</h3><p>è¿™é‡Œçš„æ€è·¯å°±ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼ŒæŒ‰ç…§ä¸Šé¢éœ€æ±‚åˆ†ææ‰€è¯´çš„å­˜å‚¨cancelTokenç»™æ¯ä¸€ä¸ªè¯·æ±‚ï¼Œä¹‹ååˆ‡æ¢è·¯ç”±å°†pendingçš„è¯·æ±‚å–æ¶ˆæ‰</p>
<p>å› æ­¤æˆ‘ä»¬ä¸å•å•éœ€è¦å®ç°å­˜å‚¨cancelTokençš„ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿˜æœ‰å¤„ç†ä»–çš„æ‹¦æˆªå™¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç›‘å¬è·¯ç”±çš„å˜åŒ–ï¼Œæ‰¾åˆ°è¿™ä¸ªæ—¶æœºå°†æ‰€æœ‰pendingè¯·æ±‚cancelæ‰</p>
<h4 id="æ‹¦æˆªå™¨çš„å®ç°"><a href="#æ‹¦æˆªå™¨çš„å®ç°" class="headerlink" title="æ‹¦æˆªå™¨çš„å®ç°"></a>æ‹¦æˆªå™¨çš„å®ç°</h4><p>è¿™é‡Œæˆ‘ä»¬å°è£…ä¸€ä¸ªæ‹¦æˆªå™¨<code>routeCancelInterceptor</code></p>
<pre><code class="js">// æ·»åŠ åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚æ‹¦æˆªå™¨
instance.interceptors.request.use(routeCancelInterceptor); // 4</code></pre>
<p>éœ€è¦ä¸€ä¸ªå–æ¶ˆè¯·æ±‚çš„é˜Ÿï¼Œåˆ—äºæ˜¯å°è£…ä¸€ä¸ªå®ä¾‹ç”¨æ¥å­˜å‚¨å¯¹åº”çš„è¯·æ±‚ï¼ŒåŒ…å«ç›¸å¯¹åº”çš„getï¼Œsetï¼Œç­‰æ–¹æ³•ï¼Œæœ€é‡è¦çš„æ˜¯</p>
<p>cancelAllRequestæ–¹æ³•ï¼Œç”¨äºéå†æ‰€æœ‰å­˜å‚¨çš„pendingè¯·æ±‚ï¼Œä¹‹ååœ¨åˆ‡è·¯ç”±çš„æ—¶å€™ï¼Œéå†æ•°æ®å–æ¶ˆå®ƒã€‚è¿™é‡Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å¼•å…¥å‰é¢åšäº†ç¼“å­˜çš„axiosCacheï¼Œåå¤´ä¼šç»†è®²</p>
<pre><code class="js">import &#123; axiosCache &#125; from &#39;./index&#39;;

class RouteAxios &#123;
  constructor() &#123;
    this.pendingRequest = new Map();
  &#125;

  get size() &#123;
    return this.pendingRequest.size;
  &#125;

  get(key) &#123;
    return this.pendingRequest.get(key);
  &#125;

  delete(key) &#123;
    this.pendingRequest.delete(key);
  &#125;

  has(key) &#123;
    return this.pendingRequest.has(key);
  &#125;

  set(key, value) &#123;
    this.pendingRequest.set(key, value);
  &#125;

  isEmpty() &#123;
    return !!this.pendingRequest.size;
  &#125;

  clear() &#123;
    this.pendingRequest = new Map();
  &#125;

 cancelAllRequest() &#123;
    for (const [key, value] of this.pendingRequest) &#123;
      if (value?.cancel &amp;&amp; typeof value.cancel === &#39;function&#39;) &#123;
        value.cancel();
        axiosCache.delete(key); // è¿™é‡Œä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Ÿåç»­åœ¨è¯´
      &#125;
    &#125;
    this.clear();
  &#125;
&#125;
export const axiosRoutesCancel = new RouteAxios();

</code></pre>
<p>ä¹‹åè¦æˆ‘ä»¬å°±åœ¨è¯·æ±‚æ‹¦æˆªå™¨é‡Œå¤´å¤„ç†cancelToken</p>
<p>å½“ç„¶é¦–å…ˆä¹Ÿæ˜¯å…ˆæ£€æµ‹æ˜¯å¦æœ‰è¿™ä¸ª<code>enabledCancelRoute</code>å­—æ®µè¡¨æ˜æ˜¯å¦è¦å°†è¿™ä¸ªè¯·æ±‚åŠ å…¥åˆ‡æ¢è·¯ç”±å–æ¶ˆè¯·æ±‚çš„æ–¹æ¡ˆï¼Œä¹‹åè°ƒç”¨source()ï¼Œè·å–å­˜å‚¨å…¶<code>source.cancel</code>æ–¹æ³•ï¼Œé‡ç‚¹æ˜¯è¦åœ¨configä¸ŠåŠ å…¥cancelTokenï¼Œè¡¨æ˜è¿™ä¸ªè¯·æ±‚å¾…ä¼šå¯èƒ½ä¼šè¢«å–æ¶ˆï¼ˆç®€å•æ¥è®²è¿™ä¸ªæ ‡è¯†å¯¹åº”è¿™ä¸ªsource.cancelçš„æ‰§è¡Œç›®æ ‡ï¼‰</p>
<pre><code class="js">import axios, &#123; AxiosRequestConfig &#125; from &#39;axios&#39;;
import get from &#39;lodash/get&#39;;
import &#123; axiosRoutesCancel &#125; from &#39;../instances&#39;;
import getMark from &#39;../utils/getMark&#39;;

export function routeCancelInterceptor(config:AxiosRequestConfig) &#123;
  const tempConfig = config;
  const enabledCancelRoute = get(tempConfig, &#39;enabledCancelRoute&#39;);
  if (enabledCancelRoute) &#123;
    const cancelRouteKey = tempConfig?.cancelCacheKey || getMark(config);
    const &#123; CancelToken &#125; = axios;
    const source = CancelToken.source();
    tempConfig.cancelToken = source.token;
    axiosRoutesCancel.set(cancelRouteKey, &#123;
      cancel: source.cancel,
      name: cancelRouteKey,
    &#125;);
  &#125;

  return tempConfig;
&#125;
</code></pre>
<p>å¦‚æœè¯·æ±‚åœ¨è¿˜æ²¡åˆ‡æ¢è·¯ç”±çš„æ—¶å€™å°±å·²ç»å“åº”æˆåŠŸï¼ˆè¿™é‡Œä¸ç®¡æ˜¯å¦æ‹¿åˆ°æ­£ç¡®æ•°æ®ï¼‰ï¼Œå°±åº”è¯¥ç›´æ¥åˆ é™¤è¿™ä¸ªå­˜å‚¨çš„keyå€¼</p>
<p>è¿™é‡Œå°±åœ¨å“åº”æˆåŠŸçš„æ‹¦æˆªå™¨ä¸­å¤„ç†ï¼Œåœ¨å¤±è´¥æ‹¦æˆªå™¨ä¸­ä¹Ÿæ˜¯ä¸€æ ·çš„å¤„ç†æ–¹æ¡ˆ</p>
<pre><code class="js">if (enabledCancelRoute) &#123;
    axiosRoutesCancel.delete(cancelCacheKey);
&#125;</code></pre>
<h4 id="è·¯ç”±å®ˆå«çš„å®ç°"><a href="#è·¯ç”±å®ˆå«çš„å®ç°" class="headerlink" title="è·¯ç”±å®ˆå«çš„å®ç°"></a>è·¯ç”±å®ˆå«çš„å®ç°</h4><p>å®ç°äº†æ‹¦æˆªå™¨æˆ‘ä»¬è¿˜éœ€è¦ç®€å•çš„å®ç°ä¸€ä¸ªè·¯ç”±å®ˆå«ï¼Œç”¨æ¥ç›‘å¬è·¯ç”±å˜åŒ–</p>
<p>åœ¨å…¨å±€ï¼Œæˆ‘ä»¬å°è£…äº†ä¸€ä¸ªå«åšPermissionRouteçš„å®ˆå«ï¼Œè¿™å®ˆå«æ˜¯å¯¹<code>react-router-dom</code>çš„routeåšäº†å˜å‘å°è£…</p>
<pre><code class="ts">const PermissionRoute: React.FC&lt;PermissionRouteProps&gt; =()=&gt; React.ReactDOM</code></pre>
<p>ç»™è¿™ä¸ªç»„ä»¶é…ç½®å‚æ•°ï¼Œå«åš<code>enabledRouteChangedAjaxBlock</code>ï¼Œé»˜è®¤ä¸ºtrue, æ ‡è¯†è¿™ä¸ªè·¯ç”±ä¸‹çš„è¯·æ±‚ï¼Œåœ¨åˆ‡æ¢çš„æ—¶å€™éƒ½ä¼šè¢«å–æ¶ˆï¼Œå½“ç„¶æ¯ä¸ªè¯·æ±‚è‡ªå·±ä¹Ÿä¼šæ ‡è¯†è‡ªå·±æ˜¯å¦åœ¨åˆ‡æ¢è·¯ç”±çš„æ—¶å€™è¦è¢«å–æ¶ˆï¼Œåè€…çš„ä¼˜å…ˆçº§å¤§äºå‰è€…</p>
<p>ä¹‹åæˆ‘ä»¬å†™ä¸€ä¸ªç»„ä»¶é”€æ¯çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆè·¯ç”±åˆ‡æ¢çš„æ—¶å€™ï¼Œè¿™ä¸ªè·¯ç”±å¯¹åº”çš„è·¯ç”±å®ˆå«ç»„ä»¶å°±ä¼šè¢«é”€æ¯ï¼Œéšä¹‹é”€æ¯ï¼ˆå–æ¶ˆï¼‰çš„ä¹Ÿå°±æ˜¯å½“å‰é¡µé¢æ­£åœ¨pendingçš„è¯·æ±‚ï¼‰</p>
<pre><code class="js">useEffect(() =&gt; function () &#123;
    if (enabledRouteChangedAjaxBlock &amp;&amp; axiosRoutesCancel.size) &#123;
      axiosRoutesCancel.cancelAllRequest();
    &#125;
&#125;,
[location]);</code></pre>
<p>useEffectè¿”å›ä¸€ä¸ªé”€æ¯çš„å‡½æ•°ï¼Œå¹¶ä¸”cancelæ‰æ‰€æœ‰pendingè¯·æ±‚ã€‚</p>
<p>è¿™é‡Œå…·ä½“å¯ä»¥çœ‹çœ‹PermissionRouteçš„å°è£…ä»£ç ï¼Œæ–¹ä¾¿ç†è§£</p>
<pre><code class="ts">import React, &#123; useEffect, useMemo &#125; from &#39;react&#39;;
import &#123; Route, RouteProps, useLocation &#125; from &#39;react-router-dom&#39;;
import &#123; noaccess as NoAccess, Permission &#125; from &#39;@/index&#39;;
import useQueryString from &#39;@/hooks/useQueryString&#39;;
import Skeleton from &#39;@/containers/components/c7n/master/skeleton&#39;;
import &#123; axiosRoutesCancel &#125; from &#39;@/containers/components/c7n/tools/axios/instances&#39;;

interface PermissionRouteProps extends RouteProps &#123;
  service: string[] | ((type: &#39;project&#39; | &#39;organization&#39; | &#39;site&#39;) =&gt; string[]),
  enabledRouteChangedAjaxBlock: boolean,
&#125;
const isFunction = (something: unknown): something is Function =&gt; typeof something === &#39;function&#39;;

const PermissionRoute: React.FC&lt;PermissionRouteProps&gt; = (&#123; enabledRouteChangedAjaxBlock = true, service, ...rest &#125;) =&gt; &#123;
  const &#123; type &#125; = useQueryString();
  const location = useLocation();
  const codes = useMemo(() =&gt; (isFunction(service) ? service(type) : (service || [])), [service, type]);
  const route = (
    &lt;Route
      &#123;...rest&#125;
    /&gt;
  );

  useEffect(() =&gt; function () &#123;
    if (enabledRouteChangedAjaxBlock &amp;&amp; axiosRoutesCancel.size) &#123;
      axiosRoutesCancel.cancelAllRequest();
    &#125;
  &#125;,
  [location]);

  return (codes.length &gt; 0)
    ? (
      &lt;Permission
        service=&#123;codes&#125;
        noAccessChildren=&#123;&lt;NoAccess /&gt;&#125;
        defaultChildren=&#123;&lt;Skeleton /&gt;&#125;
      &gt;
        &#123;route&#125;
      &lt;/Permission&gt;
    )
    : (
      &lt;Route
        &#123;...rest&#125;
      /&gt;
    );
&#125;;
export default PermissionRoute;


// ç”¨æ³•
&lt;PermissionRoute
    service=&#123;[&#39;choerodon.code.project.project.overview.ps.default&#39;]&#125;
    exact
    path=&#123;`$&#123;match.url&#125;agile/project-overview`&#125;
    component=&#123;ProjectOverview&#125;
/&gt;</code></pre>
<h2 id="é—ç•™é—®é¢˜"><a href="#é—ç•™é—®é¢˜" class="headerlink" title="é—ç•™é—®é¢˜"></a>é—ç•™é—®é¢˜</h2><h3 id="ä¸ºä»€ä¹ˆä¸ç”¨CancelTokenå»å–æ¶ˆé‡å¤è¯·æ±‚è€Œç”¨ç¼“å­˜åŸç†ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸ç”¨CancelTokenå»å–æ¶ˆé‡å¤è¯·æ±‚è€Œç”¨ç¼“å­˜åŸç†ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸ç”¨CancelTokenå»å–æ¶ˆé‡å¤è¯·æ±‚è€Œç”¨ç¼“å­˜åŸç†ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¸ç”¨CancelTokenå»å–æ¶ˆé‡å¤è¯·æ±‚è€Œç”¨ç¼“å­˜åŸç†ï¼Ÿ</h3><p>æˆ‘ä»¬çŸ¥é“å–æ¶ˆé‡å¤è¯·æ±‚åŸç†æ˜¯abortï¼Œå®šä¹‰æ˜¯ï¼šè¯·æ±‚å¦‚æœå‘å‡ºï¼Œåˆ™ç«‹åˆ»ç»ˆæ­¢è¯·æ±‚ï¼›</p>
<h4 id="åŸå› ä¸€ï¼š"><a href="#åŸå› ä¸€ï¼š" class="headerlink" title="åŸå› ä¸€ï¼š"></a>åŸå› ä¸€ï¼š</h4><p>è¿™ä¸ªç»ˆæ­¢å°±å¾ˆå¾®å¦™ï¼Œç»ˆæ­¢ä¹‹åçš„è¯·æ±‚æˆ‘ä»¬å¯ä»¥çŸ¥é“å®ƒèµ°äº†å“åº”å¤±è´¥çš„æ‹¦æˆªå™¨ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å‰ç«¯è¿˜æ˜¯æŠŠæ•°æ®å‘ç»™äº†åç«¯ï¼Œåç«¯è¿˜ä¼šåšæ•°æ®å¤„ç†æ¯”å¦‚ï¼ˆpostï¼Œputç­‰ï¼‰ï¼Œåªæ˜¯ç»ˆæ­¢äº†ï¼Œä½†æ˜¯åç«¯å¹¶ä¸çŸ¥é“æˆ‘ä»¬ç»ˆæ­¢äº†è¯·æ±‚ï¼Œåªæ˜¯å‰ç«¯ç»ˆæ­¢æ²¡æœ‰åœ¨åƒå“åº”æˆåŠŸæ‹¦æˆªå™¨ä¸€æ ·å¯¹æ•°æ®åšå¤„ç†</p>
<p>ä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬è¦çš„æ•ˆæœä¸æ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬è¦çš„æ˜¯åœ¨é‚£ä¸€ç¬é—´çš„æ‰€æœ‰ç›¸åŒè¯·æ±‚çŠ¶æ€å¤ç”¨ï¼Œé‡å¤çš„è¯·æ±‚ä»¬æ˜¯ä¸å¯ä»¥åœ¨é‚£ä¸€ç¬é—´å†å‘é€ç»™åç«¯çš„ï¼Œè€Œæ˜¯åªæœ‰é‚£ä¸ªç¬¬ä¸€æ¬¡çš„è¯·æ±‚æ‰å‘å‡ºå»ï¼Œå¦‚æœä½¿ç”¨CancelTokenè¿™æ ·å°±æ²¡æœ‰æ„ä¹‰äº†</p>
<h4 id="åŸå› äºŒ"><a href="#åŸå› äºŒ" class="headerlink" title="åŸå› äºŒ"></a>åŸå› äºŒ</h4><p>abortä¼šå¯¼è‡´æµè§ˆå™¨ä¸­çš„networkä¸­ä¸€å †æŠ¥çº¢ï¼Œçœ‹ä¸Šå»æ¯”è¾ƒä¸ç¾è§‚ã€‚</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="image-20210627124622241.png" alt="image-20210627124622241"></p>
<h4 id="åŸå› ä¸‰"><a href="#åŸå› ä¸‰" class="headerlink" title="åŸå› ä¸‰"></a>åŸå› ä¸‰</h4><p>å¦‚æœç”¨äº†cancelTokenæˆ‘åˆæƒ³åšç¼“å­˜ï¼Œè¿˜ä¸å¦‚ç›´æ¥ç”¨ç¼“å­˜æ¥ï¼Œä¹Ÿå¯ä»¥è¾¾åˆ°æ•ˆæœ</p>
<h3 id="ä¸ºä»€ä¹ˆæ‹¦æˆªå™¨çš„æ·»åŠ é¡ºåºä¼šå½±å“åˆ°ç¼“å­˜ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ‹¦æˆªå™¨çš„æ·»åŠ é¡ºåºä¼šå½±å“åˆ°ç¼“å­˜ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ‹¦æˆªå™¨çš„æ·»åŠ é¡ºåºä¼šå½±å“åˆ°ç¼“å­˜ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ‹¦æˆªå™¨çš„æ·»åŠ é¡ºåºä¼šå½±å“åˆ°ç¼“å­˜ï¼Ÿ</h3><p>è¿™ä¹Ÿæ˜¯åœ¨ä¸Šé¢è®²axiosçš„adapterçš„æ—¶å€™æåŠè¿‡</p>
<p>è¯·æ±‚æ‹¦æˆªå™¨æ˜¯çš„æ‰§è¡Œé¡ºåºæ˜¯åæ·»åŠ çš„å…ˆæ‰§è¡Œ</p>
<p>å“åº”æ‹¦æˆªå™¨æ˜¯å…ˆæ·»åŠ çš„å…ˆæ‰§è¡Œ</p>
<p>ä¾‹å¦‚ï¼šæˆ‘ä»¬é¡¹ç›®çš„è¯·æ±‚æ‹¦æˆªå™¨æ˜¯è¿™æ ·æ·»åŠ çš„</p>
<pre><code class="js">// æ·»åŠ åˆ‡æ¢è·¯ç”±å–æ¶ˆpendingè¯·æ±‚æ‹¦æˆªå™¨
instance.interceptors.request.use(routeCancelInterceptor); // 4

// æ·»åŠ ç¼“å­˜(å¤ç”¨é‡å¤è¯·æ±‚)è¯·æ±‚æ‹¦æˆªå™¨
instance.interceptors.request.use(handleCancelCacheRequest, handleRequestError); // 3

// åˆ†é¡µæ•°æ®è½¬æ¢æ‹¦æˆªå™¨
instance.interceptors.request.use(transformRequestPage); // 2

// æ·»åŠ å¤´éƒ¨æ‹¦æˆªå™¨ï¼Œ ä»¥åŠè¯·æ±‚å¤±è´¥æ‹¦æˆªå™¨
instance.interceptors.request.use(addCustomHeader); // 1</code></pre>
<p>æŒ‰é¡ºåºæ˜¯ä»ä¸‹åˆ°ä¸Šæ‰§è¡Œï¼ŒæŒ‰ç…§æ ‡æ³¨çš„1ï¼Œ2ï¼Œ3ï¼Œ4æ‰§è¡Œ</p>
<p>å“åº”æ‹¦æˆªå™¨æ˜¯è¿™æ ·çš„</p>
<pre><code class="js">// æ·»åŠ å“åº”æ‹¦æˆªå™¨
instance.interceptors.response.use(transformResponsePage); // 1
instance.interceptors.response.use(handleResponseInterceptor, handelResponseError); // 2</code></pre>
<h3 id="è·¯ç”±å–æ¶ˆcancelAllRequestæ–¹æ³•ä¸­ä¸ºä»€ä¹ˆè¦åˆ é™¤cacheä¸­çš„æ•°æ®ï¼Ÿ"><a href="#è·¯ç”±å–æ¶ˆcancelAllRequestæ–¹æ³•ä¸­ä¸ºä»€ä¹ˆè¦åˆ é™¤cacheä¸­çš„æ•°æ®ï¼Ÿ" class="headerlink" title="è·¯ç”±å–æ¶ˆcancelAllRequestæ–¹æ³•ä¸­ä¸ºä»€ä¹ˆè¦åˆ é™¤cacheä¸­çš„æ•°æ®ï¼Ÿ"></a>è·¯ç”±å–æ¶ˆcancelAllRequestæ–¹æ³•ä¸­ä¸ºä»€ä¹ˆè¦åˆ é™¤cacheä¸­çš„æ•°æ®ï¼Ÿ</h3><h2 id="éš¾ç‚¹è§£å†³"><a href="#éš¾ç‚¹è§£å†³" class="headerlink" title="éš¾ç‚¹è§£å†³"></a>éš¾ç‚¹è§£å†³</h2>

<div class="article-footer reveal fs14"><section id="license"><div class="header"><span>è®¸å¯åè®®</span></div><div class="body"><p>æœ¬æ–‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</div></section></div>

</article>

<div class="related-wrap reveal" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">è¾ƒæ–°æ–‡ç« </div><a href="/2021/07/01/js%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/">jså¸¸è§é¢è¯•é¢˜</a></div><div class="item" id="next"><div class="note">è¾ƒæ—©æ–‡ç« </div><a href="/2021/06/20/%E7%AE%97%E6%B3%95%E4%B9%8B%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E6%89%80%E6%9C%89%E8%B7%AF%E5%BE%84/">ç®—æ³•ä¹‹äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„</a></div></section></div>








      
<footer class="page-footer reveal fs12"><hr><div class="text"><p>æœ¬ç«™ç”± <a href="/">@anonymity</a> ä½¿ç”¨ <a href="https://github.com/xaoxuu/hexo-theme-stellar">Stellar</a> ä¸»é¢˜åˆ›å»ºã€‚<br>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</div></footer>

      <div class='float-panel mobile-only blur' style='display:none'>
  <button type='button' class='sidebar-toggle mobile' onclick='sidebar.toggle()'>
    <svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path></svg>
  </button>
</div>

    </div>
  </div>
  <div class='scripts'>
    <script type="text/javascript">
  const stellar = {
    // æ‡’åŠ è½½ css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // ä» butterfly å’Œ volantis è·å¾—çµæ„Ÿ
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // é»˜è®¤å¼‚æ­¥ï¼Œå¦‚æœéœ€è¦åŒæ­¥ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ {} å³å¯
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.version = '1.18.5';
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.18.5';
  stellar.config = {
    date_suffix: {
      just: 'åˆšåˆš',
      min: 'åˆ†é’Ÿå‰',
      hour: 'å°æ—¶å‰',
      day: 'å¤©å‰',
      month: 'ä¸ªæœˆå‰',
    },
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://gcore.jsdelivr.net/npm/jquery@3.6.2/dist/jquery.min.js'
  };

  if ('local_search') {
    stellar.search = {};
    stellar.search.service = 'local_search';
    if (stellar.search.service == 'local_search') {
      let service_obj = Object.assign({}, {"field":"all","path":"/search.json","content":true,"sort":"-date"});
      stellar.search[stellar.search.service] = service_obj;
    }
  }

  // stellar js
  stellar.plugins.stellar = Object.assign({"sites":"/js/plugins/sites.js","friends":"/js/plugins/friends.js","ghinfo":"/js/plugins/ghinfo.js","timeline":"/js/plugins/timeline.js","linkcard":"/js/plugins/linkcard.js","fcircle":"/js/plugins/fcircle.js","weibo":"/js/plugins/weibo.js"});

  stellar.plugins.marked = Object.assign("https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js");
  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/vanilla-lazyload@17.8.3/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.css","js":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.js"});
  }
  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://gcore.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://gcore.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.fancybox = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js","css":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css","selector":".swiper-slide img"});
  }
  if ('false' == 'true') {
    stellar.plugins.heti = Object.assign({"enable":false,"css":"https://unpkg.com/heti@0.9.2/umd/heti.min.css","js":"https://unpkg.com/heti@0.9.2/umd/heti-addon.min.js"});
  }
</script>

<!-- required -->

  
<script src="/js/main.js" async></script>



<!-- optional -->



<!-- inject -->


  </div>
</body>
</html>
