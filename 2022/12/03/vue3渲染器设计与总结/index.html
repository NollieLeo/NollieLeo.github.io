<!DOCTYPE html>
<html lang='zh-CN'>

<head>
  <meta name="generator" content="Hexo 6.3.0">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.18.5">
  <meta charset="utf-8">
  

  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://gcore.jsdelivr.net'>
  <link rel="preconnect" href="https://gcore.jsdelivr.net" crossorigin>
  <link rel='dns-prefetch' href='//unpkg.com'>

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  
  <title>vue3æ¸²æŸ“å™¨è®¾è®¡ä¸æ€»ç»“ - ç¿å…ˆæ£®çš„åšå®¢</title>

  
    <meta name="description" content="å‰ç½®æ¦‚å¿µè™šæ‹Ÿ domvdomï¼Œè™šæ‹Ÿ dom å°±æ˜¯ç”¨æ¥è¡¨ç¤ºçœŸå®çš„ dom å…ƒç´ çš„å±æ€§æˆ–è€…ç‰¹ç‚¹çš„ä¸€å¥—æ•°æ®ç»“æ„ï¼Œå’ŒçœŸå® dom ä¸€æ ·å…·æœ‰æ ‘å½¢ç»“æ„ï¼Œå…·æœ‰è®¸å¤šæ ‘å½¢èŠ‚ç‚¹ vnode å¯ä»¥ç®€è¦çš„è¡¨ç¤º 123456789const vnode &#x3D; &amp;#123;  type: &quot;h1&quot;,  children: [    &amp;#123;      type: &quot;h2&quot;,">
<meta property="og:type" content="article">
<meta property="og:title" content="vue3æ¸²æŸ“å™¨è®¾è®¡ä¸æ€»ç»“">
<meta property="og:url" content="https://github.com/NollieLeo/2022/12/03/vue3%E6%B8%B2%E6%9F%93%E5%99%A8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="ç¿å…ˆæ£®çš„åšå®¢">
<meta property="og:description" content="å‰ç½®æ¦‚å¿µè™šæ‹Ÿ domvdomï¼Œè™šæ‹Ÿ dom å°±æ˜¯ç”¨æ¥è¡¨ç¤ºçœŸå®çš„ dom å…ƒç´ çš„å±æ€§æˆ–è€…ç‰¹ç‚¹çš„ä¸€å¥—æ•°æ®ç»“æ„ï¼Œå’ŒçœŸå® dom ä¸€æ ·å…·æœ‰æ ‘å½¢ç»“æ„ï¼Œå…·æœ‰è®¸å¤šæ ‘å½¢èŠ‚ç‚¹ vnode å¯ä»¥ç®€è¦çš„è¡¨ç¤º 123456789const vnode &#x3D; &amp;#123;  type: &quot;h1&quot;,  children: [    &amp;#123;      type: &quot;h2&quot;,">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/Users/leo/Library/Application%20Support/marktext/images/2022-12-03-20-32-21-image.png">
<meta property="og:image" content="https://github.com/Users/leo/Library/Application%20Support/marktext/images/2022-12-05-00-37-36-image.png">
<meta property="og:image" content="https://github.com/Users/leo/Library/Application%20Support/marktext/images/2022-12-05-00-50-37-image.png">
<meta property="og:image" content="https://github.com/Users/leo/Library/Application%20Support/marktext/images/2022-12-05-00-53-03-image.png">
<meta property="og:image" content="file:///Users/leo/Library/Application%20Support/marktext/images/2022-12-09-22-45-02-image.png">
<meta property="article:published_time" content="2022-12-03T11:39:37.000Z">
<meta property="article:modified_time" content="2023-02-01T13:23:29.703Z">
<meta property="article:author" content="ç¿å…ˆæ£®">
<meta property="article:tag" content="Vue">
<meta property="article:tag" content="diff">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/Users/leo/Library/Application%20Support/marktext/images/2022-12-03-20-32-21-image.png">
  
  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="ç¿å…ˆæ£®çš„åšå®¢" type="application/atom+xml">
  

  
    
<link rel="stylesheet" href="/css/main.css">

  

  
    <link rel="shortcut icon" href="/assets/avatar.png">
  

  

  


  
</head>

<body>
  




  <div class='l_body' id='start'>
    <aside class='l_left' layout='post'>
    

  

<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/assets/avatar.png" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">ç¿å…ˆæ£®çš„åšå®¢</div><div class="sub cap">ä¹Œæ‹‰</div></a></div>

<nav class="menu dis-select"><a class="nav-item active" href="/">åšå®¢</a><a class="nav-item" href="/wiki/">é¡¹ç›®</a><a class="nav-item" href="/notes/">ç¬”è®°</a><a class="nav-item" href="/more/">æ›´å¤š</a></nav>
</header>


<div class="widgets">
<widget class="widget-wrapper search"><div class="widget-body"><div class="search-wrapper" id="search"><form class="search-form"><input type="text" class="search-input" id="search-input" data-filter="/blog/" placeholder="æ–‡ç« æœç´¢"><svg t="1670596976048" class="icon search-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2676" width="200" height="200"><path d="M938.2 832.6L723.8 618.1c-2.5-2.5-5.3-4.4-7.9-6.4 36.2-55.6 57.3-121.8 57.3-193.1C773.3 222.8 614.6 64 418.7 64S64 222.8 64 418.6c0 195.9 158.8 354.6 354.6 354.6 71.3 0 137.5-21.2 193.2-57.4 2 2.7 3.9 5.4 6.3 7.8L832.5 938c14.6 14.6 33.7 21.9 52.8 21.9 19.1 0 38.2-7.3 52.8-21.8 29.2-29.1 29.2-76.4 0.1-105.5M418.7 661.3C284.9 661.3 176 552.4 176 418.6 176 284.9 284.9 176 418.7 176c133.8 0 242.6 108.9 242.6 242.7 0 133.7-108.9 242.6-242.6 242.6" p-id="2677"></path></svg></form><div id="search-result"></div><div class="search-no-result">æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼</div></div></div></widget>


<widget class="widget-wrapper toc single" id="data-toc"><div class="widget-header cap dis-select"><span class="name">vue3æ¸²æŸ“å™¨è®¾è®¡ä¸æ€»ç»“</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E6%A6%82%E5%BF%B5"><span class="toc-text">å‰ç½®æ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F-dom"><span class="toc-text">è™šæ‹Ÿ dom</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-text">æ¸²æŸ“å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD"><span class="toc-text">æŒ‚è½½</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-text">å®ç°æ¸²æŸ“å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86"><span class="toc-text">ç®€å•çš„æ¸²æŸ“åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E5%90%88-reactivity"><span class="toc-text">ç»“åˆ reactivity</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B8%B2%E6%9F%93%E5%99%A8"><span class="toc-text">è‡ªå®šä¹‰æ¸²æŸ“å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E5%87%BD%E6%95%B0"><span class="toc-text">å·¥å‚å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E6%9B%B4%E6%96%B0%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-text">åŠ å…¥æ›´æ–°çš„æ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#patch-%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0"><span class="toc-text">patch ç®€å•å®ç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-mountElement-%E6%8C%82%E8%BD%BD"><span class="toc-text">å®ç° mountElement æŒ‚è½½</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%A1%B9%E5%BD%A2%E5%BC%8F%E6%8A%BD%E7%A6%BB"><span class="toc-text">é…ç½®é¡¹å½¢å¼æŠ½ç¦»</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E5%92%8C%E6%9B%B4%E6%96%B0"><span class="toc-text">æŒ‚è½½å’Œæ›´æ–°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E8%8A%82%E7%82%B9%E6%8C%82%E8%BD%BD"><span class="toc-text">å­èŠ‚ç‚¹æŒ‚è½½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E8%8A%82%E7%82%B9%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-text">æŒ‚è½½èŠ‚ç‚¹çš„å±æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%8C%9FHTML-attribute-%E5%92%8C-DOM-properties-%E5%8C%BA%E5%88%AB"><span class="toc-text">ğŸŒŸHTML attribute å’Œ DOM properties åŒºåˆ«</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E7%A1%AE%E7%9A%84%E8%AE%BE%E7%BD%AE%E8%8A%82%E7%82%B9%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-text">æ­£ç¡®çš„è®¾ç½®èŠ‚ç‚¹çš„å±æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7%E5%A4%84%E7%90%86"><span class="toc-text">å¸ƒå°”ç±»å‹å±æ€§å¤„ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AA%E8%AF%BB%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7%E5%A4%84%E7%90%86"><span class="toc-text">åªè¯»ç±»å‹å±æ€§å¤„ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E5%8F%96%E5%B9%B3%E5%8F%B0%E6%97%A0%E5%85%B3%E4%BB%A3%E7%A0%81"><span class="toc-text">æå–å¹³å°æ— å…³ä»£ç </span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#class-%E5%92%8C-style-%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-text">class å’Œ style çš„å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-normalizeClass"><span class="toc-text">å®ç° normalizeClass</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-class"><span class="toc-text">è®¾ç½® class</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E6%93%8D%E4%BD%9C"><span class="toc-text">å¸è½½æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B-dom-%E4%B8%8E-vnode-%E8%81%94%E7%B3%BB"><span class="toc-text">å»ºç«‹ dom ä¸ vnode è”ç³»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9%E9%80%A0-render-%E5%87%BD%E6%95%B0"><span class="toc-text">æ”¹é€  render å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85-unmount"><span class="toc-text">å°è£… unmount</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%BA%E5%88%86-vnode-%E7%B1%BB%E5%9E%8B"><span class="toc-text">åŒºåˆ† vnode ç±»å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-text">äº‹ä»¶å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E4%BA%8B%E4%BB%B6%E5%92%8C%E6%9B%B4%E6%96%B0"><span class="toc-text">ç»‘å®šäº‹ä»¶å’Œæ›´æ–°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%B1%9E%E6%80%A7%E4%BB%A5%E5%8F%8A%E5%AD%90%E8%8A%82%E7%82%B9"><span class="toc-text">æ›´æ–°å±æ€§ä»¥åŠå­èŠ‚ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-props-%E5%8F%98%E5%8C%96%E6%9B%B4%E6%96%B0"><span class="toc-text">å®ç° props å˜åŒ–æ›´æ–°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%BA%E6%89%8B%E6%94%B9%E9%80%A0-patchProps-%E5%87%BD%E6%95%B0"><span class="toc-text">é¡ºæ‰‹æ”¹é€  patchProps å‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C-class-%E6%9B%B4%E6%96%B0"><span class="toc-text">æ“ä½œ class æ›´æ–°</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%A0%B7%E5%BC%8F%E7%9A%84%E6%9B%B4%E6%96%B0"><span class="toc-text">æ“ä½œæ ·å¼çš„æ›´æ–°</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E4%BA%8B%E4%BB%B6%E7%9A%84%E6%9B%B4%E6%96%B0"><span class="toc-text">æ“ä½œäº‹ä»¶çš„æ›´æ–°</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E5%B1%9E%E6%80%A7%E7%9A%84%E6%9B%B4%E6%96%B0"><span class="toc-text">æ“ä½œå±æ€§çš„æ›´æ–°</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0-children-%E8%8A%82%E7%82%B9"><span class="toc-text">æ›´æ–° children èŠ‚ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%96%B0%E5%AD%90%E8%8A%82%E7%82%B9%E6%98%AF%E6%96%87%E6%9C%AC%E8%8A%82%E7%82%B9"><span class="toc-text">1. æ–°å­èŠ‚ç‚¹æ˜¯æ–‡æœ¬èŠ‚ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%96%B0%E5%AD%90%E8%8A%82%E7%82%B9%E6%98%AF%E4%B8%80%E7%BB%84"><span class="toc-text">2. æ–°å­èŠ‚ç‚¹æ˜¯ä¸€ç»„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%96%B0%E5%AD%90%E8%8A%82%E7%82%B9%E5%95%A5%E4%B9%9F%E6%B2%A1%E6%9C%89"><span class="toc-text">3. æ–°å­èŠ‚ç‚¹å•¥ä¹Ÿæ²¡æœ‰</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B"><span class="toc-text">ç‰¹æ®ŠèŠ‚ç‚¹ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E8%8A%82%E7%82%B9%E5%92%8C%E6%B3%A8%E9%87%8A%E8%8A%82%E7%82%B9%E5%A4%84%E7%90%86"><span class="toc-text">æ–‡æœ¬èŠ‚ç‚¹å’Œæ³¨é‡ŠèŠ‚ç‚¹å¤„ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fragment"><span class="toc-text">Fragment</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#diff-%E7%AE%97%E6%B3%95"><span class="toc-text">diff ç®—æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84-diff-%E7%AE%97%E6%B3%95"><span class="toc-text">ç®€å•çš„ diff ç®—æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E7%AB%AF-diff-%E7%AE%97%E6%B3%95"><span class="toc-text">åŒç«¯ diff ç®—æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F-diff-%E7%AE%97%E6%B3%95"><span class="toc-text">å¿«é€Ÿ diff ç®—æ³•</span></a></li></ol></li></ol></li></ol></div></div></widget>




</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="https://github.com/NollieLeo" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/assets/logo-github.svg"/></a></div></footer>

    </aside>
    <div class='l_main'>
      

      


<div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/">ä¸»é¡µ</a><span class="sep"></span><a class="cap breadcrumb" href="/">æ–‡ç« </a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/Vue/">Vue</a></div><div id="post-meta">å‘å¸ƒäº&nbsp;<time datetime="2022-12-03T11:39:37.000Z">2022-12-03</time></div></div>

<article class='md-text content post'>
<h1 class="article-title"><span>vue3æ¸²æŸ“å™¨è®¾è®¡ä¸æ€»ç»“</span></h1>
<h1 id="å‰ç½®æ¦‚å¿µ"><a href="#å‰ç½®æ¦‚å¿µ" class="headerlink" title="å‰ç½®æ¦‚å¿µ"></a>å‰ç½®æ¦‚å¿µ</h1><h2 id="è™šæ‹Ÿ-dom"><a href="#è™šæ‹Ÿ-dom" class="headerlink" title="è™šæ‹Ÿ dom"></a>è™šæ‹Ÿ dom</h2><p>vdomï¼Œè™šæ‹Ÿ dom å°±æ˜¯ç”¨æ¥è¡¨ç¤ºçœŸå®çš„ dom å…ƒç´ çš„å±æ€§æˆ–è€…ç‰¹ç‚¹çš„ä¸€å¥—æ•°æ®ç»“æ„ï¼Œå’ŒçœŸå® dom ä¸€æ ·å…·æœ‰æ ‘å½¢ç»“æ„ï¼Œå…·æœ‰è®¸å¤šæ ‘å½¢èŠ‚ç‚¹ vnode</p>
<p>å¯ä»¥ç®€è¦çš„è¡¨ç¤º</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vnode = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;h1&quot;</span>,</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;h2&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: <span class="string">&quot;æˆ‘æ˜¯h2&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="æ¸²æŸ“å™¨"><a href="#æ¸²æŸ“å™¨" class="headerlink" title="æ¸²æŸ“å™¨"></a>æ¸²æŸ“å™¨</h2><p>æ¸²æŸ“å™¨çš„åŸºæœ¬ä½œç”¨å°±æ˜¯æŠŠè™šæ‹Ÿ dom æ¸²æŸ“ä¸ºå¹³å°ä¸Šé¢çš„çœŸå® å…ƒç´ ï¼Œæµè§ˆå™¨ä¸Šå°±æ˜¯çœŸå®çš„ dom å…ƒç´ ã€‚</p>
<h2 id="æŒ‚è½½"><a href="#æŒ‚è½½" class="headerlink" title="æŒ‚è½½"></a>æŒ‚è½½</h2><p>mountedï¼Œæ„æ€å°±æ˜¯æ¸²æŸ“å™¨è¯»å–è§£æ vnode/vdom å±æ€§ä¹‹åï¼Œä½¿ç”¨çœŸå®çš„ dom å½¢å¼å¹¶ä¸”è¡¨ç°åœ¨é¡µé¢ä¸Š/æˆ–è€…æ˜¯å…·ä½“çš„é¡µé¢æŸä¸ªä½ç½®ä¸Š</p>
<h1 id="å®ç°æ¸²æŸ“å™¨"><a href="#å®ç°æ¸²æŸ“å™¨" class="headerlink" title="å®ç°æ¸²æŸ“å™¨"></a>å®ç°æ¸²æŸ“å™¨</h1><h2 id="ç®€å•çš„æ¸²æŸ“åŸç†"><a href="#ç®€å•çš„æ¸²æŸ“åŸç†" class="headerlink" title="ç®€å•çš„æ¸²æŸ“åŸç†"></a>ç®€å•çš„æ¸²æŸ“åŸç†</h2><p><strong>renderer</strong>: æ¸²æŸ“å‡½æ•°</p>
<p>å°±æ˜¯é€šè¿‡ innerHTML çš„å½¢å¼å°†ç¬¬ä¸€ä¸ªå‚æ•° domString æ’å…¥åˆ°å¯¹åº”å®¹å™¨å½“ä¸­</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">renderer</span>(<span class="params">domString, container</span>) &#123;</span><br><span class="line">  container.<span class="property">innerHTML</span> = domString;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">renderer</span>(<span class="string">&quot;&lt;h1&gt;vue3 renderer&lt;/h1&gt;&quot;</span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>));</span><br></pre></td></tr></table></figure>

<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/Users/leo/Library/Application%20Support/marktext/images/2022-12-03-20-32-21-image.png" alt></p>
<h3 id="ç»“åˆ-reactivity"><a href="#ç»“åˆ-reactivity" class="headerlink" title="ç»“åˆ reactivity"></a>ç»“åˆ reactivity</h3><p>å¼•å…¥ vue3 çš„ reactivity åŒ…ï¼Œä»–ä¼šåœ¨å…¨å±€æš´éœ²ä¸€ä¸ª VueReactivity å˜é‡</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/npm/@vue/reactivity@3.2.45/dist/reactivity.global.min.js">cdn åœ°å€</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/@vue/reactivity@3.2.45/dist/reactivity.global.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; renderer &#125; <span class="keyword">from</span> <span class="string">&quot;./render.js&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> &#123; effect, ref &#125; = <span class="title class_">VueReactivity</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">effect</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">renderer</span>(</span></span><br><span class="line"><span class="language-javascript">      <span class="string">`&lt;h1&gt;vue3 renderer times: <span class="subst">$&#123;count.value&#125;</span>&lt;/h1&gt;`</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">    );</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    count.<span class="property">value</span>++;</span></span><br><span class="line"><span class="language-javascript">  &#125;, <span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡å¼•å…¥ vue3 çš„ reactivityï¼Œæˆ‘ä»¬èƒ½å¤Ÿå®ç°ä¸€ä¸ªåŠ¨æ€æ¸²æŸ“çš„åŸºæœ¬é€»è¾‘</p>
<h2 id="è‡ªå®šä¹‰æ¸²æŸ“å™¨"><a href="#è‡ªå®šä¹‰æ¸²æŸ“å™¨" class="headerlink" title="è‡ªå®šä¹‰æ¸²æŸ“å™¨"></a>è‡ªå®šä¹‰æ¸²æŸ“å™¨</h2><blockquote>
<p>vue3 ä¸­çš„æ¸²æŸ“å™¨ï¼Œæ˜¯è®¾è®¡ä¸ºé€šç”¨å¯é…ç½®çš„ï¼Œå³å¯å®ç°æ¸²æŸ“åˆ°ä»»æ„ç›®æ ‡çš„å¹³å°ä¸Šï¼Œæˆ‘ä»¬ç›®å‰è¯´çš„ç›®æ ‡å¹³å°ï¼Œå…ˆæŒ‡å®šæµè§ˆå™¨ï¼›åç»­å¯ä»¥å°†ä¸€äº›å¯æŠ½è±¡çš„ API æŠ½ç¦»ï¼Œä½¿å¾—æ¸²æŸ“å™¨çš„æ ¸å¿ƒä¸ä¾èµ–ä¸æµè§ˆå™¨çš„ api</p>
<p>è¿™ä¹Ÿå°±æ˜¯ vue çš„æ ¸å¿ƒä¹‹ä¸€ï¼Œå°†ç›¸å…³æµè§ˆå™¨çš„ api å°è£…åˆ°äº†<strong>runtime-dom</strong>çš„ä¸€ä¸ªåŒ…ï¼Œæä¾›äº†å¾ˆå¤šé’ˆå¯¹æµè§ˆå™¨çš„ dom apiï¼Œå±æ€§ä»¥åŠäº‹ä»¶å¤„ç†</p>
</blockquote>
<h3 id="å·¥å‚å‡½æ•°"><a href="#å·¥å‚å‡½æ•°" class="headerlink" title="å·¥å‚å‡½æ•°"></a>å·¥å‚å‡½æ•°</h3><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª createRenderer çš„å·¥å‚å‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨, å¹¶ä¸”æŠ›å‡ºè®¸å¤šçš„æ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** åˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createRenderer</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">render</span> = (<span class="params">vnode, container</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åç»­ä¼šæœ‰å„ç§æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; render &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹‹åè¿›è¡Œç›¸å…³çš„æ¸²æŸ“è°ƒç”¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> renderer = <span class="title function_">createRenderer</span>();</span><br><span class="line">renderer.<span class="title function_">render</span>(vNode, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="åŠ å…¥æ›´æ–°çš„æ¦‚å¿µ"><a href="#åŠ å…¥æ›´æ–°çš„æ¦‚å¿µ" class="headerlink" title="åŠ å…¥æ›´æ–°çš„æ¦‚å¿µ"></a>åŠ å…¥æ›´æ–°çš„æ¦‚å¿µ</h3><p>ç¬¬ä¸€æ¬¡è°ƒç”¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">renderer.<span class="title function_">render</span>(vNode, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ¬¡è°ƒç”¨æ¸²æŸ“çš„æ—¶å€™è¿˜æ˜¯åœ¨åŒä¸€ä¸ª container ä¸Šè°ƒç”¨çš„</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">renderer.<span class="title function_">render</span>(newVNode, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>ç”±äºé¦–æ¬¡çš„æ¸²æŸ“å·²ç»å°†å¯¹åº”çš„ dom æ¸²æŸ“åˆ°äº† container å†…éƒ¨äº†ï¼Œæ‰€ä»¥å†æ¬¡è°ƒç”¨ render å‡½æ•°çš„æ—¶å€™ï¼Œæ¸²æŸ“ä¸€ä¸ªæ–°çš„è™šæ‹Ÿ domï¼Œå°±å•å•æ˜¯åšä¸€ä¸ªç®€å•çš„æŒ‚è½½çš„åŠ¨ä½œäº†ï¼Œè€Œæ˜¯è¦è¿›è¡Œæ›´æ–°å¯¹æ¯”ï¼Œæ‰¾å‡ºå˜åŠ¨çš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åš - <strong>æ‰“è¡¥ä¸ï¼ˆæ›´æ–°ï¼‰</strong></p>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥ç›¸å…³çš„æ”¹é€ ä¸€ä¸‹ä»£ç ï¼š</p>
<p>å¼•å…¥ä¸€ä¸ªæ›´æ–°çš„æ¦‚å¿µå¤„ç†çš„é€»è¾‘</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** åˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createRenderer</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">render</span> = (<span class="params">vnode, container</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (vnode) &#123;</span><br><span class="line">      <span class="comment">// æ–°çš„nodeå­˜åœ¨çš„æƒ…å†µï¼Œå°†å…¶æ—§çš„vnodeä¸€èµ·ä¼ é€’ç»™patchå‡½æ•°è¿›è¡Œè¡¥ä¸çš„æ›´æ–°</span></span><br><span class="line">      <span class="title function_">patch</span>(container.<span class="property">_vnode</span>, vnode, container);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (container.<span class="property">_vnode</span>) &#123;</span><br><span class="line">        <span class="comment">// æ—§çš„vnodeå­˜åœ¨ï¼Œæ–°çš„vnodeä¸å­˜åœ¨çš„æƒ…å†µï¼Œè¯´æ˜æ˜¯ä¸€ä¸ª unmountï¼ˆå¸è½½ï¼‰çš„æ“ä½œ</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œåªéœ€è¦å°†containerå†…domæ¸…ç©ºå°±å¯ä»¥, ç›®å‰æš‚æ—¶è¿™æ ·æ¸…ç©º</span></span><br><span class="line">        container.<span class="property">innerHTML</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ¯ä¸€æ¬¡éƒ½éœ€è¦ä¿å­˜ä¸Šä¸€æ¬¡çš„vnodeï¼Œå­˜å‚¨åœ¨containerä¸‹</span></span><br><span class="line">    container.<span class="property">_vnode</span> = vnode; <span class="comment">// æš‚æ—¶ä½¿ç”¨è¿™æ®µä»£ç æ¸…ç©ºï¼Œåç»­ä¼šå®Œå–„</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; render &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="patch-ç®€å•å®ç°"><a href="#patch-ç®€å•å®ç°" class="headerlink" title="patch ç®€å•å®ç°"></a>patch ç®€å•å®ç°</h4><p>å…¶ä¸­ patch çš„å‡½æ•°ï¼Œæ˜¯æœ€æœ€é‡è¦çš„ä¸€ä¸ªæ¸²æŸ“å™¨çš„æ ¸å¿ƒï¼Œä¸»è¦æ˜¯åšåˆå§‹åŒ–å’Œç›¸å…³çš„ diff æ“ä½œ</p>
<p>ç›®å‰è¿›è¡Œç®€å•å®ç°ï¼Œåç»­ç€é‡è¯´</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æ›´æ–°å¯¹æ¯” */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">n1, n2, container</span>) &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœä¸å­˜åœ¨</span></span><br><span class="line">  <span class="keyword">if</span> (!n1) &#123;</span><br><span class="line">    <span class="title function_">mountElement</span>(n2, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// n1å­˜åœ¨çš„æƒ…å†µä¸‹é¢ï¼Œæˆ‘ä»¬è¿›è¡Œæ›´æ–°ï¼ˆæ‰“è¡¥ä¸ï¼‰</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>n1: è€çš„ vnode</p>
</li>
<li><p>n2: æ–°çš„ vnode</p>
</li>
<li><p>container: å®¹å™¨</p>
</li>
</ul>
<p>å¦‚æœä¸å­˜åœ¨æ—§çš„ vnode çš„æƒ…å†µä¸‹ï¼Œè¯´æ˜åªæ˜¯éœ€è¦è¿›è¡Œå…ƒç´ çš„æŒ‚è½½å³å¯</p>
<h4 id="å®ç°-mountElement-æŒ‚è½½"><a href="#å®ç°-mountElement-æŒ‚è½½" class="headerlink" title="å®ç° mountElement æŒ‚è½½"></a>å®ç° mountElement æŒ‚è½½</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æŒ‚è½½ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºdomå…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(vnode.<span class="property">type</span>);</span><br><span class="line">  <span class="comment">//å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">children</span> === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// åªéœ€è¦è®¾ç½®å…ƒç´ çš„textContentçš„å±æ€§å³å¯</span></span><br><span class="line">    el.<span class="property">textContent</span> = vnode.<span class="property">children</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">  container.<span class="title function_">appendChild</span>(el);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ vnode çš„ type æ ‡ç­¾åç§°åˆ›å»ºä¸€ä¸ªæ–°çš„ dom å…ƒç´ ï¼Œæ¥ç€å¤„ç† childrenï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²çš„ç±»å‹ï¼Œè¯´æ˜æ˜¯æ–‡æœ¬çš„ child èŠ‚ç‚¹ï¼Œç›´æ¥è®¾ç½® textContent å°±å¯ä»¥äº†ï¼Œä¹‹å appendChild æ’å…¥å®¹å™¨å½“ä¸­</p>
<h3 id="é…ç½®é¡¹å½¢å¼æŠ½ç¦»"><a href="#é…ç½®é¡¹å½¢å¼æŠ½ç¦»" class="headerlink" title="é…ç½®é¡¹å½¢å¼æŠ½ç¦»"></a>é…ç½®é¡¹å½¢å¼æŠ½ç¦»</h3><p>å› ä¸ºæˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ªç›¸å½“äºæ˜¯ä¸ä¾èµ–äºå¹³å°çš„ä¸€ä¸ªé€šç”¨æ¸²æŸ“å™¨ï¼Œæ‰€ä»¥ï¼Œéœ€è¦å°†ä¸Šè¿°æ‰€ç”¨åˆ°çš„æ‰€æœ‰ä¾èµ–äºæµè§ˆå™¨çš„ api éƒ½ç»™æŠ½ç¦»å‡ºæ¥ï¼Œå®ç°ç‹¬ç«‹å°è£…çš„é…ç½®é¡¹</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æŠ½ç¦»<strong>mountElement</strong>å‡½æ•°ä½¿ç”¨åˆ°çš„ä¸€äº›æµè§ˆå™¨æ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æµè§ˆå™¨ç«¯çš„ç›¸å…³api */</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">BROWSER_APIS</span> = &#123;</span><br><span class="line">  <span class="comment">// ç”¨äºåˆ›å»ºå…ƒç´ </span></span><br><span class="line">  <span class="title function_">createElement</span>(<span class="params">tag</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">createElement</span>(tag);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** ç”¨äºè®¾ç½®å…ƒç´ çš„æ–‡æœ¬èŠ‚ç‚¹ */</span></span><br><span class="line">  <span class="title function_">setElementText</span>(<span class="params">el, text</span>) &#123;</span><br><span class="line">    el.<span class="property">textContent</span> = text;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** ç»™ç‰¹å®šçš„parentä¸‹æ·»åŠ æŒ‡å®šçš„å…ƒç´  */</span></span><br><span class="line">  <span class="title function_">insert</span>(<span class="params">el, parent, anchor = <span class="literal">null</span></span>) &#123;</span><br><span class="line">    parent.<span class="title function_">insertBefore</span>(el, anchor);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="variable constant_">BROWSER_APIS</span>;</span><br></pre></td></tr></table></figure>

<p>ä¹‹åæˆ‘ä»¬æ”¹é€ <strong>createRenderer</strong>å‡½æ•°</p>
<p>å°†ç›¸å…³çš„ api ä»¥ options çš„å½¢å¼ä¼ å…¥</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** åˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createRenderer</span>(<span class="params">options</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; createElement, insert, setElementText &#125; = options;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** æŒ‚è½½ */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** æ›´æ–°å¯¹æ¯” */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">n1, n2, container</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** æ¸²æŸ“æ–¹æ³• */</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">render</span> = (<span class="params">vnode, container</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; render &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; createRenderer &#125;;</span><br></pre></td></tr></table></figure>

<p>ä¹‹åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¼ é€’è¿›æ¥çš„å¯é…ç½®çš„ apis å»å®ç°ç›¸å…³çš„æ¸²æŸ“å™¨æ“ä½œ</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹é€ <strong>mountElement</strong>å¹¶ä¸”ä½¿ç”¨åˆ°ç›¸å…³çš„ apis</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æŒ‚è½½ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºdomå…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> el = <span class="title function_">createElement</span>(vnode.<span class="property">type</span>); <span class="comment">// â•</span></span><br><span class="line">  <span class="comment">//å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">children</span> === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// åªéœ€è¦è®¾ç½®å…ƒç´ çš„textContentçš„å±æ€§å³å¯</span></span><br><span class="line">    <span class="title function_">setElementText</span>(e, vnode.<span class="property">children</span>); <span class="comment">// â•</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">  <span class="title function_">insert</span>(el, container); <span class="comment">// â•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é€šè¿‡äº†ä»¥ä¸Šé…ç½®ä¹‹åï¼Œæ¸²æŸ“å™¨å°†ä¸ä»…ä»…å¯ä»¥åœ¨æµè§ˆå™¨ç«¯è¿›è¡Œä½¿ç”¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®ä¸åŒçš„å¹³å°ï¼Œä¼ å…¥ä¸åŒçš„è‡ªå®šä¹‰çš„ç›¸å…³ api å‚æ•°</p>
</blockquote>
<h1 id="æŒ‚è½½å’Œæ›´æ–°"><a href="#æŒ‚è½½å’Œæ›´æ–°" class="headerlink" title="æŒ‚è½½å’Œæ›´æ–°"></a>æŒ‚è½½å’Œæ›´æ–°</h1><h2 id="å­èŠ‚ç‚¹æŒ‚è½½"><a href="#å­èŠ‚ç‚¹æŒ‚è½½" class="headerlink" title="å­èŠ‚ç‚¹æŒ‚è½½"></a>å­èŠ‚ç‚¹æŒ‚è½½</h2><p>ä¸Šè¿°æˆ‘ä»¬åªè€ƒè™‘åˆ°äº†ä¸€ä¸ª vnode çš„ children ä¸º string çš„æƒ…å†µä¸‹çš„æŒ‚è½½ï¼Œä½¿ç”¨ <strong>setElementText</strong> å¯¹å…ƒç´ è¿›è¡ŒæŒ‚è½½ï¼Œä½†æ˜¯ children å¯èƒ½å­˜åœ¨å¤šä¸ª vnode é string ç±»å‹çš„æƒ…å†µ</p>
<p><strong>ä¾‹å¦‚</strong>ï¼šä»¥ä¸‹çš„ vnodeï¼Œæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vNode = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;div&quot;</span>,</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;p&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: <span class="string">&quot;111&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;p&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: <span class="string">&quot;222&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤éœ€è¦æ”¹é€ æŒ‚è½½å‡½æ•°ï¼Œä½¿å…¶å…·æœ‰æŒ‚è½½å­èŠ‚ç‚¹çš„èƒ½åŠ›ã€‚è¿™é‡ŒåŠ å…¥ä¸€å±‚ children èŠ‚ç‚¹çš„åˆ¤æ–­</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºdomå…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> el = <span class="title function_">createElement</span>(vnode.<span class="property">type</span>);</span><br><span class="line">  <span class="comment">//å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">children</span> === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// åªéœ€è¦è®¾ç½®å…ƒç´ çš„textContentçš„å±æ€§å³å¯</span></span><br><span class="line">    <span class="title function_">setElementText</span>(el, vnode.<span class="property">children</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(vnode.<span class="property">children</span>)) &#123;</span><br><span class="line">    <span class="comment">// â•</span></span><br><span class="line">    <span class="comment">// å¦‚æœchildrenæ˜¯æ•°ç»„ï¼Œåˆ™ä¾¿éå†æ¯ä¸€ä¸ªå­—èŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨patchçš„æ–¹æ³•</span></span><br><span class="line">    vnode.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">patch</span>(<span class="literal">null</span>, child, el);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">  <span class="title function_">insert</span>(el, container);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æŒ‚è½½èŠ‚ç‚¹çš„å±æ€§"><a href="#æŒ‚è½½èŠ‚ç‚¹çš„å±æ€§" class="headerlink" title="æŒ‚è½½èŠ‚ç‚¹çš„å±æ€§"></a>æŒ‚è½½èŠ‚ç‚¹çš„å±æ€§</h2><p>ä¸€ä¸ªå…ƒç´ å¯ä»¥ç”¨å¤šä¸ªå±æ€§æ¥è¿›è¡Œæè¿°ï¼Œå½“ç„¶æ˜ å°„åˆ°è™šæ‹Ÿ dom ä¸Šçš„è¯ï¼Œç”¨ä¸€ä¸ª props çš„å±æ€§è¿›è¡Œè¡¨ç¤ºã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vNode = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;div&quot;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&quot;foo&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;p&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: <span class="string">&quot;111&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;p&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: <span class="string">&quot;222&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤æˆ‘ä»¬åœ¨æŒ‚è½½å…ƒç´ çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦å°†è¿™äº›å±æ€§å€¼æ¸²æŸ“åˆ°å¯¹åº”çš„å…ƒç´ ä¸Šé¢</p>
<p>æ”¹é€ æŒ‚è½½å‡½æ•°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºdomå…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> el = <span class="title function_">createElement</span>(vnode.<span class="property">type</span>);</span><br><span class="line">  <span class="comment">//å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">children</span> === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// åªéœ€è¦è®¾ç½®å…ƒç´ çš„textContentçš„å±æ€§å³å¯</span></span><br><span class="line">    <span class="title function_">setElementText</span>(el, vnode.<span class="property">children</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(vnode.<span class="property">children</span>)) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœchildrenæ˜¯æ•°ç»„ï¼Œåˆ™ä¾¿éå†æ¯ä¸€ä¸ªå­—èŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨patchçš„æ–¹æ³•</span></span><br><span class="line">    vnode.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">patch</span>(<span class="literal">null</span>, child, el);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†props, å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œå¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">props</span>) &#123;</span><br><span class="line">    <span class="comment">// â•</span></span><br><span class="line">    <span class="comment">// éå†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> vnode.<span class="property">props</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (key <span class="keyword">in</span> el) &#123;</span><br><span class="line">        <span class="keyword">const</span> prop = vnode.<span class="property">props</span>[key];</span><br><span class="line">        <span class="comment">// è°ƒç”¨setAttributeå°†å±æ€§è®¾ç½®åˆ°å…ƒç´ ä¸Š</span></span><br><span class="line">        el.<span class="title function_">setAttribute</span>(key, prop); <span class="comment">// ğŸŒŸ</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">  <span class="title function_">insert</span>(el, container);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ ‡è®°â€œğŸŒŸâ€œçš„åœ°æ–¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>el[key] = vnode.props[key]</code>ï¼Œä½†æ˜¯ç”±äºè¿™éƒ½æ˜¯å±äºç›´æ¥æ“ä½œ dom å¯¹è±¡çš„è¡Œä¸ºï¼Œæ‰€ä»¥éƒ½ä¼šå­˜åœ¨ç¼ºé™·ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æƒ³åŠæ³•å¦‚ä½•çš„æ­£ç¡®è®¾ç½®å…ƒç´ çš„å±æ€§</p>
<h3 id="ğŸŒŸHTML-attribute-å’Œ-DOM-properties-åŒºåˆ«"><a href="#ğŸŒŸHTML-attribute-å’Œ-DOM-properties-åŒºåˆ«" class="headerlink" title="ğŸŒŸHTML attribute å’Œ DOM properties åŒºåˆ«"></a>ğŸŒŸHTML attribute å’Œ DOM properties åŒºåˆ«</h3><p>HTML attribute æŒ‡çš„å°±æ˜¯å®šä¹‰åœ¨ HMTL æ ‡ç­¾ä¸Šçš„å±æ€§</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;my-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;foo&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>document æ–‡æ¡£è§£æä¹‹åï¼Œä¼šç”Ÿæˆä¸€ä¸ªä¸ä¹‹ç›¸ç¬¦çš„ dom å…ƒç´ å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸Šé¢åŒ…å«äº†å¾ˆå¤šçš„å±æ€§</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/Users/leo/Library/Application%20Support/marktext/images/2022-12-05-00-37-36-image.png" alt></p>
<p>è¿™äº›å°±æ˜¯æ‰€è°“çš„ dom propertyã€‚</p>
<p><strong>ä¸¤è€…çš„åŒºåˆ†</strong>å¤§è‡´å¦‚ä¸‹</p>
<ol>
<li><p>å¾ˆå¤šçš„ HTMl attribute åœ¨ DOM å¯¹è±¡ä¸Šé¢éƒ½æœ‰ä¸ä¹‹åŒåçš„ DOM propertiesï¼Œä½†æ˜¯å‘½åè§„åˆ™å´ä¸ä¸€æ ·</p>
<p><strong>ä¾‹å¦‚</strong>ï¼šHTML attribute çš„ <strong>class</strong> å¯¹åº”çš„ dom property å°±æ˜¯ <strong>className</strong></p>
</li>
<li><p>ä¸¤è€…å­˜åœ¨å…³è”ï¼šä¾‹å¦‚ä¸Šè¿°è®¾ç½®äº† HTML attribute çš„ id ä¸ºâ€˜fooâ€™ï¼Œé‚£ä¹ˆå¯¹åº”çš„ DOM properties å½“ä¸­å­˜åœ¨ç›¸åŒå±æ€§åç§°ä¸º id ä¹Ÿä¸º fooï¼Œ<strong>ä¸¤è€…å¯ä»¥å½“ä½œç›´æ¥æ˜ å°„çš„å…³ç³»</strong></p>
</li>
<li><p>å¹¶ä¸æ˜¯éƒ½å­˜åœ¨ç›´æ¥ç›´æ¥æ˜ å°„å…³ç³»ï¼šä¾‹å¦‚ value å±æ€§ï¼Œä¸Šè¿° input è®¾ç½®äº† value å€¼ï¼Œä½†æ˜¯åœ¨ DOM properties å¯¹åº”çš„å€¼ä¸ä»…ä»…æ˜¯ valueï¼Œè¿˜æœ‰ defaultValue å€¼ï¼›å¦‚æœåç»­åœ¨ input æ¡†ä¸­è¾“å…¥äº†å…¶ä»–çš„ value å€¼ bar</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/Users/leo/Library/Application%20Support/marktext/images/2022-12-05-00-50-37-image.png" alt></p>
<p>ç„¶åæˆ‘ä»¬å†å»è¯»å–å…¶ç›¸å…³çš„ HTML Attribute å’Œ DOM properties ä¼šå‘ç°</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/Users/leo/Library/Application%20Support/marktext/images/2022-12-05-00-53-03-image.png" alt></p>
<p>å…¶å® HTML Attribute åªæ˜¯åšäº†ä¸€ä¸ª<strong>åˆå§‹å€¼çš„èµ‹å€¼</strong>ï¼Œä½†æ˜¯å´æ˜¯å¯¹å…¶ä»–çš„ DOM property ä¹Ÿæœ‰ç›¸å…³å½±å“</p>
</li>
<li><p>éæ³•å±æ€§å€¼ä¼šè¢«æµè§ˆå™¨æ ¡éªŒå¤„ç†æ‰ï¼šä¾‹å¦‚æˆ‘ä»¬åœ¨ <strong>input</strong> çš„ HTML attribute ä¸Šé¢è®¾ç½®äº†ä¸€ä¸ª <strong>type</strong> ç­‰äºä¸€ä¸ªâ€˜fooâ€˜çš„å±æ€§ï¼Œé‚£ä¹ˆä¼šè¢«æµè§ˆå™¨è‡ªåŠ¨å¤„ç†æ‰ã€‚æœ€ç»ˆæˆ‘ä»¬è¯»å– DOM property çš„æ—¶å€™ï¼Œæ˜¯è¢«çŸ«æ­£ä¹‹åçš„å€¼ â€˜<strong>text</strong>â€™</p>
</li>
</ol>
<blockquote>
<p>HTMl Atrribute çš„ä½œç”¨å°±æ˜¯è®¾ç½®ä¸ä¹‹å¯¹åº”çš„ DOM properties çš„åˆå§‹å€¼</p>
</blockquote>
<p>æ‰€ä»¥æŒ‰ç…§ä¸Šè¿°çš„ HTML attribute å’Œ DOM props çš„åŒºåˆ«ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹é€ ç›¸å…³çš„ mountElement çš„æ“ä½œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºdomå…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> el = <span class="title function_">createElement</span>(vnode.<span class="property">type</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(el);</span><br><span class="line">  <span class="comment">//å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">children</span> === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// åªéœ€è¦è®¾ç½®å…ƒç´ çš„textContentçš„å±æ€§å³å¯</span></span><br><span class="line">    <span class="title function_">setElementText</span>(el, vnode.<span class="property">children</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(vnode.<span class="property">children</span>)) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœchildrenæ˜¯æ•°ç»„ï¼Œåˆ™ä¾¿éå†æ¯ä¸€ä¸ªå­—èŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨patchçš„æ–¹æ³•</span></span><br><span class="line">    vnode.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">patch</span>(<span class="literal">null</span>, child, el);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†props, å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œå¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">props</span>) &#123;</span><br><span class="line">    <span class="comment">// éå†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> vnode.<span class="property">props</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = vnode.<span class="property">props</span>[key]; <span class="comment">// è·å–propså¯¹åº”keyçš„value</span></span><br><span class="line">      <span class="comment">// dom propertieså­˜åœ¨çš„æƒ…å†µ</span></span><br><span class="line">      <span class="keyword">if</span> (key <span class="keyword">in</span> el) &#123;</span><br><span class="line">        el[key] = value;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®çš„å±æ€§æ²¡æœ‰å¯¹åº”çš„DOM propertiesçš„æƒ…å†µï¼Œè°ƒç”¨setAttributeå°†å±æ€§è®¾ç½®åˆ°å…ƒç´ ä¸Š</span></span><br><span class="line">        el.<span class="title function_">setAttribute</span>(key, value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">  <span class="title function_">insert</span>(el, container);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ­£ç¡®çš„è®¾ç½®èŠ‚ç‚¹çš„å±æ€§"><a href="#æ­£ç¡®çš„è®¾ç½®èŠ‚ç‚¹çš„å±æ€§" class="headerlink" title="æ­£ç¡®çš„è®¾ç½®èŠ‚ç‚¹çš„å±æ€§"></a>æ­£ç¡®çš„è®¾ç½®èŠ‚ç‚¹çš„å±æ€§</h3><p><a href>æµè§ˆ</a>å™¨ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬è§£æ HTML æ–‡ä»¶ä¸­çš„ dom å…ƒç´ ï¼Œä»¥åŠç›¸å…³çš„ props çš„å±æ€§è®¾ç½®æ“ä½œã€‚</p>
<p>ä½†æ˜¯åœ¨ vue ä¸­ï¼Œå› ä¸ºç”¨åˆ°äº†è‡ªèº«çš„æ¨¡æ¿æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨è§£æç›¸å…³çš„èŠ‚ç‚¹çš„æ—¶å€™éœ€è¦è‡ªèº«å¤„ç†è¿™äº›å±æ€§çš„æŒ‚è½½æ“ä½œ</p>
<h4 id="å¸ƒå°”ç±»å‹å±æ€§å¤„ç†"><a href="#å¸ƒå°”ç±»å‹å±æ€§å¤„ç†" class="headerlink" title="å¸ƒå°”ç±»å‹å±æ€§å¤„ç†"></a>å¸ƒå°”ç±»å‹å±æ€§å¤„ç†</h4><p>ä¾‹å¦‚ä¸‹é¢è¿™æ®µ html ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">disabled</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æµè§ˆå™¨ä¸­ä¼šå°†å…¶å±æ€§ <strong>disabled</strong> è‡ªåŠ¨çŸ«æ­£ä¸º disabled=true</p>
<p>åœ¨ç›®å‰çš„æˆ‘ä»¬æ¸²æŸ“å™¨ä¸­ï¼Œç±»ä¼¼ä¸ç­‰ä»·äºå¦‚ä¸‹ vnode</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vNode = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;button&quot;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">disabled</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆåœ¨æŒ‚è½½çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨è®¾ç½®æ–¹æ³•å°†ç©ºå­—ç¬¦ä¸² è®¾ç½®åˆ° dom å±æ€§ä¸Šé¢ã€‚</p>
<p>ç±»ä¼¼äºï¼š<code>el.disabled=&#39;&#39;</code></p>
<p>ä½†æ˜¯ç”±äºæµè§ˆå™¨çš„è‡ªåŠ¨çŸ«æ­£åŠŸèƒ½ï¼Œä¼šå°†æˆ‘ä»¬çš„ç©ºå­—ç¬¦ä¸²ï¼Œè‡ªåŠ¨çŸ«æ­£ä¸º falseï¼Œè¿™å°±ä¸ç¬¦åˆç”¨æˆ·çš„æœ¬æ„äº†ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬è¦å¯¹è¿™ç§ DOM attribute å¸ƒå°”ç±»å‹çš„å±æ€§ï¼Œåœ¨èµ‹å€¼çš„æ—¶å€™åŠ å…¥ä¸€å±‚åˆ¤æ–­</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºdomå…ƒç´ </span></span><br><span class="line">  <span class="comment">// ... çœç•¥ä»£ç </span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†props, å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œå¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">props</span>) &#123;</span><br><span class="line">    <span class="comment">// éå†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> vnode.<span class="property">props</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = vnode.<span class="property">props</span>[key]; <span class="comment">// è·å–propså¯¹åº”keyçš„value</span></span><br><span class="line">      <span class="comment">// dom propertieså­˜åœ¨çš„æƒ…å†µ</span></span><br><span class="line">      <span class="keyword">if</span> (key <span class="keyword">in</span> el) &#123;</span><br><span class="line">        <span class="comment">// è·å–è¿™ä¸ªDOM propertieså…ƒç´ çš„å±æ€§ç±»å‹</span></span><br><span class="line">        <span class="keyword">const</span> type = <span class="keyword">typeof</span> el[key]; <span class="comment">// â•</span></span><br><span class="line">        <span class="comment">// å¦‚æœåŸç”Ÿå±æ€§ç±»å‹ä¸ºå¸ƒå°”ç±»å‹ï¼Œå¹¶ä¸”valueæ˜¯ç©ºçš„å­—ç¬¦ä¸²çš„è¯ï¼Œç»™ä»–å€¼çŸ«æ­£ä¸ºtrue</span></span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">&quot;boolean&quot;</span> &amp;&amp; value === <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">          <span class="comment">// â•</span></span><br><span class="line">          el[key] = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// å…¶ä»–æƒ…å†µ</span></span><br><span class="line">          el[key] = value;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®çš„å±æ€§æ²¡æœ‰å¯¹åº”çš„DOM propertiesçš„æƒ…å†µï¼Œè°ƒç”¨setAttributeå°†å±æ€§è®¾ç½®åˆ°å…ƒç´ ä¸Š</span></span><br><span class="line">        el.<span class="title function_">setAttribute</span>(key, value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">  <span class="title function_">insert</span>(el, container);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åªè¯»ç±»å‹å±æ€§å¤„ç†"><a href="#åªè¯»ç±»å‹å±æ€§å¤„ç†" class="headerlink" title="åªè¯»ç±»å‹å±æ€§å¤„ç†"></a>åªè¯»ç±»å‹å±æ€§å¤„ç†</h4><p>DOM properties å½“ä¸­è¿˜å­˜åœ¨å¾ˆå¤šåªè¯»çš„å±æ€§ï¼Œä¾‹å¦‚ï¼šform</p>
<p>å¦‚ä¸‹ä¾‹å­ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;form1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">form</span>=<span class="string">&quot;form1&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼ <code>form</code> è¿™ç§ DOM properties åœ¨æ‰€æœ‰çš„ form æ§ä»¶ä¸Šéƒ½æ˜¯ï¼Œåªè¯»çš„å±æ€§çš„ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡ <code>setAttribute</code>æ¥è®¾ç½®ä»–çš„å±æ€§ï¼Œæ‰€ä»¥è¿™æ—¶å€™è¿˜å¾—è¦ä¿®æ”¹æˆ‘ä»¬çš„é€»è¾‘ï¼Œåˆ¤æ–­å½“å‰çš„å±æ€§åœ¨æµè§ˆå™¨ä¸­æ˜¯å¦æ˜¯åªè¯»çš„ï¼Œå¦‚æœæ˜¯åŒ¹é…ä¸Šè¿™ç§åªè¯»çš„æƒ…å†µçš„å±æ€§ï¼Œä½¿ç”¨<code>setAttribute</code>æ¥è¿›è¡Œèµ‹å€¼</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦åº”è¯¥ä½œä¸ºDOM propertiesçš„è®¾ç½®</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">shouldSetAsProps</span>(<span class="params">el, key, value</span>) &#123;</span><br><span class="line">  <span class="comment">// å¯¹ç‰¹æ®Šåªè¯»å±æ€§çš„å¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (key === <span class="string">&quot;form&quot;</span> &amp;&amp; el.<span class="property">tagName</span> === <span class="string">&quot;INPUT&quot;</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> key <span class="keyword">in</span> el;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºdomå…ƒç´ </span></span><br><span class="line">  <span class="comment">// ... çœç•¥ä»£ç </span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†props, å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œå¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">props</span>) &#123;</span><br><span class="line">    <span class="comment">// éå†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> vnode.<span class="property">props</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = vnode.<span class="property">props</span>[key]; <span class="comment">// è·å–propså¯¹åº”keyçš„value</span></span><br><span class="line">      <span class="comment">// dom propertieså­˜åœ¨çš„æƒ…å†µ</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">shouldSetAsProps</span>(el, key, value)) &#123;</span><br><span class="line">        <span class="comment">// è·å–è¿™ä¸ªDOM propertieså…ƒç´ çš„å±æ€§ç±»å‹</span></span><br><span class="line">        <span class="keyword">const</span> type = <span class="keyword">typeof</span> el[key];</span><br><span class="line">        <span class="comment">// å¦‚æœåŸç”Ÿå±æ€§ç±»å‹ä¸ºå¸ƒå°”ç±»å‹ï¼Œå¹¶ä¸”valueæ˜¯ç©ºçš„å­—ç¬¦ä¸²çš„è¯ï¼Œç»™ä»–å€¼çŸ«æ­£ä¸ºtrue</span></span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">&quot;boolean&quot;</span> &amp;&amp; value === <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">          el[key] = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          el[key] = value;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®çš„å±æ€§æ²¡æœ‰å¯¹åº”çš„DOM propertiesçš„æƒ…å†µï¼Œè°ƒç”¨setAttributeå°†å±æ€§è®¾ç½®åˆ°å…ƒç´ ä¸Š</span></span><br><span class="line">        el.<span class="title function_">setAttribute</span>(key, value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">  <span class="title function_">insert</span>(el, container);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æå–å¹³å°æ— å…³ä»£ç "><a href="#æå–å¹³å°æ— å…³ä»£ç " class="headerlink" title="æå–å¹³å°æ— å…³ä»£ç "></a>æå–å¹³å°æ— å…³ä»£ç </h4><p>æˆ‘ä»¬å°†éå† props æ—¶å€™çš„ åˆ¤æ–­è®¾å€¼çš„ä»£ç ï¼Œæå–åˆ° BROWSE_APIS å½“ä¸­ï¼Œä½œä¸ºæµè§ˆå™¨ç«¯çš„æ–¹æ³•ï¼Œå–åä¸º<code>patchProps</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** å°†å±æ€§è®¾ç½®ç›¸å…³çš„æ“ä½œå°è£…åˆ°patchPropsçš„å‡½æ•°ä¸­ï¼Œå¹¶ä½œä¸ºæ¸²æŸ“å™¨é€‰é¡¹ä¼ é€’ */</span></span><br><span class="line">  <span class="title function_">patchProps</span>(<span class="params">el, key, preValue, nextValue</span>) &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦åº”è¯¥ä½œä¸ºDOM propertiesçš„è®¾ç½®</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">shouldSetAsProps</span>(<span class="params">el, key, value</span>) &#123;</span><br><span class="line">      <span class="comment">// å¯¹ç‰¹æ®Šåªè¯»å±æ€§çš„å¤„ç†</span></span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&quot;form&quot;</span> &amp;&amp; el.<span class="property">tagName</span> === <span class="string">&quot;INPUT&quot;</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="comment">// ...è¿˜æœ‰æ›´å¤šç‰¹æ®Šå¤„ç†æƒ…å†µtodo</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(vnode.<span class="property">props</span>, key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// dom propertieså­˜åœ¨çš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">shouldSetAsProps</span>(el, key, nextValue)) &#123;</span><br><span class="line">      <span class="comment">// è·å–è¿™ä¸ªDOM propertieså…ƒç´ çš„å±æ€§ç±»å‹</span></span><br><span class="line">      <span class="keyword">const</span> type = <span class="keyword">typeof</span> el[key];</span><br><span class="line">      <span class="comment">// å¦‚æœåŸç”Ÿå±æ€§ç±»å‹ä¸ºå¸ƒå°”ç±»å‹ï¼Œå¹¶ä¸”valueæ˜¯ç©ºçš„å­—ç¬¦ä¸²çš„è¯ï¼Œç»™ä»–å€¼çŸ«æ­£ä¸ºtrue</span></span><br><span class="line">      <span class="keyword">if</span> (type === <span class="string">&quot;boolean&quot;</span> &amp;&amp; nextValue === <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        el[key] = <span class="literal">true</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        el[key] = nextValue;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// è®¾ç½®çš„å±æ€§æ²¡æœ‰å¯¹åº”çš„DOM propertiesçš„æƒ…å†µï¼Œè°ƒç”¨setAttributeå°†å±æ€§è®¾ç½®åˆ°å…ƒç´ ä¸Š</span></span><br><span class="line">      el.<span class="title function_">setAttribute</span>(key, nextValue);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆåœ¨ mountElement ä¸­å°±è¿™æ ·è°ƒç”¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºdomå…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> el = <span class="title function_">createElement</span>(vnode.<span class="property">type</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(el);</span><br><span class="line">  <span class="comment">//å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">children</span> === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// åªéœ€è¦è®¾ç½®å…ƒç´ çš„textContentçš„å±æ€§å³å¯</span></span><br><span class="line">    <span class="title function_">setElementText</span>(el, vnode.<span class="property">children</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(vnode.<span class="property">children</span>)) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœchildrenæ˜¯æ•°ç»„ï¼Œåˆ™ä¾¿éå†æ¯ä¸€ä¸ªå­—èŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨patchçš„æ–¹æ³•</span></span><br><span class="line">    vnode.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">patch</span>(<span class="literal">null</span>, child, el);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†props, å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œå¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">props</span>) &#123;</span><br><span class="line">    <span class="comment">// éå†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> vnode.<span class="property">props</span>) &#123;</span><br><span class="line">      <span class="title function_">patchProps</span>(el, key, <span class="literal">null</span>, vnode.<span class="property">props</span>[key]); <span class="comment">// â•</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">  <span class="title function_">insert</span>(el, container);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="class-å’Œ-style-çš„å¤„ç†"><a href="#class-å’Œ-style-çš„å¤„ç†" class="headerlink" title="class å’Œ style çš„å¤„ç†"></a>class å’Œ style çš„å¤„ç†</h3><p>åœ¨ vue ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ 3 ç§æ–¹å¼å»ä¼ é€’ä¸€ä¸ª class çš„å€¼</p>
<p>å­—ç¬¦ä¸²</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;foo bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯¹è±¡</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">:class</span>=<span class="string">&quot;&#123; foo:true,  bar:false &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ•°ç»„</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">:class</span>=<span class="string">&quot;[&#x27;foo bar&#x27;, &#123;foo:true,  bar:false &#125;]&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ— è®ºæ˜¯ä½•ç§ç»“æ„ï¼Œæˆ‘ä»¬æœ€ç»ˆè½¬åŒ–åˆ° vNode ä¸Šé¢éƒ½æ˜¯è¦æˆä¸ºä¸€ä¸ªå­—ç¬¦ä¸²çš„</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vNode = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;p&quot;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">class</span>: <span class="string">&quot;foo bar&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤åœ¨ç”Ÿæˆ vnode çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ normalizeClass çš„æ–¹æ³•å»è½¬æ¢ class</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vNode = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;p&quot;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">class</span>: <span class="title function_">normalizeClass</span>([</span><br><span class="line">      <span class="string">&quot;foo&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">foo</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">bar</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ]),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="å®ç°-normalizeClass"><a href="#å®ç°-normalizeClass" class="headerlink" title="å®ç° normalizeClass"></a>å®ç° normalizeClass</h4><p>normalizeClass</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æ ¼å¼åŒ–class */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeClass</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isString</span>(value)) &#123;</span><br><span class="line">    res = value;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isArray</span>(value)) &#123;</span><br><span class="line">    <span class="comment">// ç±»ä¼¼æ•°ç»„ join(&#x27; &#x27;)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; value.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> normalized = <span class="title function_">normalizeClass</span>(value[i]);</span><br><span class="line">      <span class="keyword">if</span> (normalized) &#123;</span><br><span class="line">        res += normalized + <span class="string">&quot; &quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isObject</span>(value)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> name <span class="keyword">in</span> value) &#123;</span><br><span class="line">      <span class="keyword">if</span> (value[name]) &#123;</span><br><span class="line">        res += name + <span class="string">&quot; &quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">trim</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è®¾ç½®-class"><a href="#è®¾ç½®-class" class="headerlink" title="è®¾ç½® class"></a>è®¾ç½® class</h4><p>è®¾ç½® dom class å±æ€§çš„æ–¹å¼æœ‰å¤šç§ï¼Œ<code>setAttribute</code>, <code>el.className</code>, <code>el.classList</code></p>
<p>å…¶ä¸­<code>el.className</code>çš„æ€§èƒ½æœ€å¥½<br>å› æ­¤æˆ‘ä»¬æ”¹ä¹‹æˆ‘ä»¬çš„<code>patchProps</code>æ–¹æ³•</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** å°†å±æ€§è®¾ç½®ç›¸å…³çš„æ“ä½œå°è£…åˆ°patchPropsçš„å‡½æ•°ä¸­ï¼Œå¹¶ä½œä¸ºæ¸²æŸ“å™¨é€‰é¡¹ä¼ é€’ */</span></span><br><span class="line">  <span class="title function_">patchProps</span>(<span class="params">el, key, preValue, nextValue</span>) &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦åº”è¯¥ä½œä¸ºDOM propertiesçš„è®¾ç½®</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">shouldSetAsProps</span>(<span class="params">el, key, value</span>) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">&quot;class&quot;</span>) &#123; <span class="comment">// â•</span></span><br><span class="line">      el.<span class="property">className</span> = nextValue || <span class="string">&quot;&quot;</span>;  <span class="comment">// â•</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">shouldSetAsProps</span>(el, key, nextValue)) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ style ä¹Ÿæ˜¯ç±»ä¼¼çš„å¤„ç†æ–¹æ¡ˆï¼Œåªä¸è¿‡åœ¨ vue ä¸­è°ƒç”¨çš„æ˜¯<code>normalizeStyle</code>çš„æ–¹æ³•</p>
<h2 id="å¸è½½æ“ä½œ"><a href="#å¸è½½æ“ä½œ" class="headerlink" title="å¸è½½æ“ä½œ"></a>å¸è½½æ“ä½œ</h2><p>ä¸Šè¿°è¯´åˆ°ï¼Œæˆ‘ä»¬åœ¨ render å‡½æ•°ä¸­ä½¿ç”¨äº† <code>container.innerHTML = &#39;&#39;</code>çš„æ–¹å¼å»æ¸…ç©ºå¸è½½;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æ¸²æŸ“æ–¹æ³• */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">render</span> = (<span class="params">vnode, container</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (vnode) &#123;</span><br><span class="line">    <span class="comment">// æ–°çš„nodeå­˜åœ¨çš„æƒ…å†µï¼Œå°†å…¶æ—§çš„vnodeä¸€èµ·ä¼ é€’ç»™patchå‡½æ•°è¿›è¡Œè¡¥ä¸çš„æ›´æ–°</span></span><br><span class="line">    <span class="title function_">patch</span>(container.<span class="property">_vnode</span>, vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (container.<span class="property">_vnode</span>) &#123;</span><br><span class="line">      <span class="comment">// æ—§çš„vnodeå­˜åœ¨ï¼Œæ–°çš„vnodeä¸å­˜åœ¨çš„æƒ…å†µï¼Œè¯´æ˜æ˜¯ä¸€ä¸ª unmountï¼ˆå¸è½½ï¼‰çš„æ“ä½œ</span></span><br><span class="line">      <span class="comment">// è¿™é‡Œåªéœ€è¦å°†containerå†…domæ¸…ç©ºå°±å¯ä»¥</span></span><br><span class="line">      container.<span class="property">innerHTML</span> = <span class="string">&quot;&quot;</span>; <span class="comment">// âœ¨</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ¯ä¸€æ¬¡éƒ½éœ€è¦ä¿å­˜ä¸Šä¸€æ¬¡çš„vnodeï¼Œå­˜å‚¨åœ¨containerä¸‹</span></span><br><span class="line">  container.<span class="property">_vnode</span> = vnode;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¹ˆåšä¸ä¸¥è°¨ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>
<ol>
<li>å®¹å™¨çš„å†…å®¹å¯èƒ½æ˜¯æŸä¸ªç»„ä»¶æˆ–è€…å¤šä¸ªæ¸²æŸ“çš„ï¼Œåœ¨å¸è½½çš„æ—¶å€™åº”è¯¥å»è§¦å‘ç»„ä»¶ç›¸å…³çš„å¸è½½ç”Ÿå‘½å‘¨æœŸå‡½æ•°</li>
<li>è‡ªå®šä¹‰æŒ‡ä»¤ï¼Œæ²¡åŠæ³•æ­£ç¡®æ‰§è¡Œ</li>
<li>dom èº«ä¸Šç»‘å®šçš„ä¸€äº›äº‹ä»¶ï¼Œä¸ä¼šè¿›è¡Œç§»é™¤</li>
</ol>
<p>æ­£ç¡®çš„å¸è½½æ–¹å¼ï¼š</p>
<ol>
<li><p>æ ¹æ® vnode å¯¹è±¡è·å–å…¶å…³è”çš„çœŸå® dom å…ƒç´ </p>
</li>
<li><p>ä½¿ç”¨åŸç”Ÿçš„ dom ç§»é™¤æ“ä½œå°†å…¶ç§»é™¤</p>
</li>
</ol>
<h3 id="å»ºç«‹-dom-ä¸-vnode-è”ç³»"><a href="#å»ºç«‹-dom-ä¸-vnode-è”ç³»" class="headerlink" title="å»ºç«‹ dom ä¸ vnode è”ç³»"></a>å»ºç«‹ dom ä¸ vnode è”ç³»</h3><p>è¦æƒ³æ ¹æ® vnode å¯¹è±¡è·å–å…¶å…³è”çš„çœŸå® dom å…ƒç´ ï¼Œé¦–å…ˆå¿…é¡»è¦å…ˆå»ºç«‹è”ç³»</p>
<p>åœ¨æŒ‚è½½é˜¶æ®µæˆ‘ä»¬åˆ©ç”¨ <code>createElement</code>åˆ›å»ºäº†çœŸå®çš„ domï¼Œä¹‹åå°†å…¶ç»‘å®šåœ¨ vnode ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥å°† vNode å’ŒçœŸå® dom ä¹‹é—´çš„è”ç³»å»ºç«‹èµ·æ¥</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºdomå…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> el = <span class="title function_">createElement</span>(vnode.<span class="property">type</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(el);</span><br><span class="line">  vnode.<span class="property">el</span> = el; <span class="comment">// å°†å…¶åˆ›å»ºå‡ºæ¥çš„domæ·»åŠ åˆ°vnodeä¸Šï¼Œå»ºç«‹è”ç³» â•</span></span><br><span class="line">  <span class="comment">//å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">children</span> === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(vnode.<span class="property">children</span>)) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†props, å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œå¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">props</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">  <span class="title function_">insert</span>(el, container);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ”¹é€ -render-å‡½æ•°"><a href="#æ”¹é€ -render-å‡½æ•°" class="headerlink" title="æ”¹é€  render å‡½æ•°"></a>æ”¹é€  render å‡½æ•°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æ¸²æŸ“æ–¹æ³• */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">render</span> = (<span class="params">vnode, container</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (vnode) &#123;</span><br><span class="line">    <span class="comment">// æ–°çš„nodeå­˜åœ¨çš„æƒ…å†µï¼Œå°†å…¶æ—§çš„vnodeä¸€èµ·ä¼ é€’ç»™patchå‡½æ•°è¿›è¡Œè¡¥ä¸çš„æ›´æ–°</span></span><br><span class="line">    <span class="title function_">patch</span>(container.<span class="property">_vnode</span>, vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (container.<span class="property">_vnode</span>) &#123;</span><br><span class="line">      <span class="comment">// æ—§çš„vnodeå­˜åœ¨ï¼Œæ–°çš„vnodeä¸å­˜åœ¨çš„æƒ…å†µï¼Œè¯´æ˜æ˜¯ä¸€ä¸ª unmountï¼ˆå¸è½½ï¼‰çš„æ“ä½œ</span></span><br><span class="line">      <span class="comment">// æ ¹æ®vnodeè·å–è¦å¸è½½çš„çœŸå®domå…ƒç´ </span></span><br><span class="line">      <span class="keyword">const</span> el = container.<span class="property">_vnode</span>.<span class="property">el</span>; <span class="comment">// â•</span></span><br><span class="line">      <span class="comment">// è·å–elçš„çˆ¶çº§å…ƒç´ </span></span><br><span class="line">      <span class="keyword">const</span> parent = el.<span class="property">parentNode</span>; <span class="comment">// â•</span></span><br><span class="line">      <span class="comment">// è°ƒç”¨removeChildåˆ é™¤å…ƒç´ </span></span><br><span class="line">      <span class="keyword">if</span> (parent) parent.<span class="title function_">removeChild</span>(el); <span class="comment">// â•</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ¯ä¸€æ¬¡éƒ½éœ€è¦ä¿å­˜ä¸Šä¸€æ¬¡çš„vnodeï¼Œå­˜å‚¨åœ¨containerä¸‹</span></span><br><span class="line">  container.<span class="property">_vnode</span> = vnode;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­çš„ container._vnode ä»£è¡¨çš„å°±æ˜¯æ—§çš„ vnodeï¼ˆå³å°†è¦è¢«å¸è½½çš„ï¼‰ï¼Œç”±äºæˆ‘ä»¬ä¹‹å‰ç»‘å®šä¸Šäº†ç›¸å…³çš„ dom åœ¨ vnode ä¸Šï¼Œå°±å¯ä»¥è°ƒç”¨å…¶çˆ¶çº§çš„ç§»é™¤å…ƒç´ çš„æ“ä½œ</p>
<h3 id="å°è£…-unmount"><a href="#å°è£…-unmount" class="headerlink" title="å°è£… unmount"></a>å°è£… unmount</h3><p>å°†ä¸Šè¿°çš„å¸è½½æ“ä½œå°è£…æˆä¸€ä¸ª unmount çš„å‡½æ•°ï¼Œæ–¹ä¾¿åç»­åŠŸèƒ½å¢åŠ </p>
<p>unmount</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** å¸è½½æ“ä½œ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">unmount</span>(<span class="params">vnode</span>) &#123;</span><br><span class="line">  <span class="comment">// æ ¹æ®vnodeè·å–è¦å¸è½½çš„çœŸå®domå…ƒç´ </span></span><br><span class="line">  <span class="comment">// è·å–elçš„çˆ¶çº§å…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> parent = vnode.<span class="property">el</span>.<span class="property">parentNode</span>;</span><br><span class="line">  <span class="keyword">if</span> (parent) &#123;</span><br><span class="line">    parent.<span class="title function_">removeChild</span>(vnode.<span class="property">el</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>render</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">render</span> = (<span class="params">vnode, container</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (vnode) &#123;</span><br><span class="line">    <span class="comment">// æ–°çš„nodeå­˜åœ¨çš„æƒ…å†µï¼Œå°†å…¶æ—§çš„vnodeä¸€èµ·ä¼ é€’ç»™patchå‡½æ•°è¿›è¡Œè¡¥ä¸çš„æ›´æ–°</span></span><br><span class="line">    <span class="title function_">patch</span>(container.<span class="property">_vnode</span>, vnode, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (container.<span class="property">_vnode</span>) &#123;</span><br><span class="line">      <span class="comment">// æ—§çš„vnodeå­˜åœ¨ï¼Œæ–°çš„vnodeä¸å­˜åœ¨çš„æƒ…å†µï¼Œè¯´æ˜æ˜¯ä¸€ä¸ª unmountï¼ˆå¸è½½ï¼‰çš„æ“ä½œ</span></span><br><span class="line">      <span class="title function_">unmount</span>(container.<span class="property">_vnode</span>); <span class="comment">// â•</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ¯ä¸€æ¬¡éƒ½éœ€è¦ä¿å­˜ä¸Šä¸€æ¬¡çš„vnodeï¼Œå­˜å‚¨åœ¨containerä¸‹</span></span><br><span class="line">  container.<span class="property">_vnode</span> = vnode;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="åŒºåˆ†-vnode-ç±»å‹"><a href="#åŒºåˆ†-vnode-ç±»å‹" class="headerlink" title="åŒºåˆ† vnode ç±»å‹"></a>åŒºåˆ† vnode ç±»å‹</h2><p>åœ¨ render å‡½æ•°ä¸­ï¼Œvnode å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œä¼šå°†è€çš„ vnode å’Œæ–°çš„ vnode éƒ½ä¼ é€’ç»™ patch å‡½æ•°å»åšä¸€ä¸ªæ›´æ–°ï¼Œå½“ç„¶æ˜¯æˆ‘ä»¬çš„ node çš„ç±»å‹éƒ½æ˜¯ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ‰æœ‰å»åšæ¯”è¾ƒçš„æ„ä¹‰ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vnode = &#123; <span class="attr">type</span>: <span class="string">&quot;p&quot;</span> &#125;; <span class="comment">//ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼š</span></span><br><span class="line"><span class="keyword">const</span> vnode = &#123; <span class="attr">type</span>: <span class="string">&quot;input&quot;</span> &#125;; <span class="comment">// ç¬¬äºŒæ¬¡æ¸²æŸ“</span></span><br></pre></td></tr></table></figure>

<p>è¿™ç§æƒ…å†µå°±æ²¡æœ‰å¯¹æ¯”æ›´æ–°çš„ä¸€ä¸ªå¿…è¦äº†ã€‚</p>
<p>è¿™ç§æƒ…å†µä¸‹ï¼š</p>
<ol>
<li><p>å…ˆå»å¸è½½ p å…ƒç´ </p>
</li>
<li><p>å†å°† input æŒ‚è½½åˆ°å®¹å™¨ä¸­</p>
</li>
</ol>
<p>å› æ­¤æˆ‘ä»¬éœ€è¦æ”¹é€  patch çš„ä»£ç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æ›´æ–°å¯¹æ¯”, å¹¶ä¸”åšæŒ‚è½½ç›¸å…³çš„åŠŸèƒ½ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">n1, n2, container</span>) &#123;</span><br><span class="line">  <span class="comment">// n1è€èŠ‚ç‚¹å­˜åœ¨ï¼Œå¯¹æ¯”n1å’Œn2çš„ç±»å‹</span></span><br><span class="line">  <span class="keyword">if</span> (n1 &amp;&amp; n1.<span class="property">type</span> !== n2.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="comment">// â•</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ–°æ—§vnodeçš„ç±»å‹ä¸åŒï¼Œåˆ™ç›´æ¥å°†æ—§çš„vnodeå¸è½½</span></span><br><span class="line">    <span class="title function_">unmount</span>(n1); <span class="comment">// â•</span></span><br><span class="line">    n1 = <span class="literal">null</span>; <span class="comment">// â•</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœä¸å­˜åœ¨</span></span><br><span class="line">  <span class="keyword">if</span> (!n1) &#123;</span><br><span class="line">    <span class="title function_">mountElement</span>(n2, container);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// n1å­˜åœ¨çš„æƒ…å†µä¸‹é¢ï¼Œæˆ‘ä»¬è¿›è¡Œæ›´æ–°ï¼ˆæ‰“è¡¥ä¸ï¼‰</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æƒ…å†µéƒ½æ˜¯ vnode ä¸ºæ™®é€šæ ‡ç­¾å…ƒç´ çš„ç±»å‹æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç¨å¾®æ”¹é€ ä¸€äº›å¯¹ç»„ä»¶ç±»å‹ç­‰ç­‰çš„æ”¯æŒ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æ›´æ–°å¯¹æ¯”, å¹¶ä¸”åšæŒ‚è½½ç›¸å…³çš„åŠŸèƒ½ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">n1, n2, container</span>) &#123;</span><br><span class="line">  <span class="comment">// n1è€èŠ‚ç‚¹å­˜åœ¨ï¼Œå¯¹æ¯”n1å’Œn2çš„ç±»å‹</span></span><br><span class="line">  <span class="keyword">if</span> (n1 &amp;&amp; n1.<span class="property">type</span> !== n2.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ–°æ—§vnodeçš„ç±»å‹ä¸åŒï¼Œåˆ™ç›´æ¥å°†æ—§çš„vnodeå¸è½½</span></span><br><span class="line">    <span class="title function_">unmount</span>(n1);</span><br><span class="line">    n1 = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; type &#125; = n2;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> type === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// è¯´æ˜æ˜¯æ™®é€šçš„æ ‡ç­¾å…ƒç´ </span></span><br><span class="line">    <span class="keyword">if</span> (!n1) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœä¸å­˜åœ¨, å°±è¿›è¡ŒæŒ‚è½½</span></span><br><span class="line">      <span class="title function_">mountElement</span>(n2, container);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// n1å­˜åœ¨çš„æƒ…å†µä¸‹é¢ï¼Œæˆ‘ä»¬è¿›è¡Œæ›´æ–°ï¼ˆæ‰“è¡¥ä¸ï¼‰</span></span><br><span class="line">      <span class="title function_">patchElement</span>(n1, n2);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> type === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// ç»„ä»¶</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å…¶ä»–</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="äº‹ä»¶å¤„ç†"><a href="#äº‹ä»¶å¤„ç†" class="headerlink" title="äº‹ä»¶å¤„ç†"></a>äº‹ä»¶å¤„ç†</h2><p>é¦–å…ˆæˆ‘ä»¬è¦åœ¨ vnode ä¸­å»æè¿°äº‹ä»¶ï¼Œå‡å®šä¸€ä¸ªè§„åˆ™ï¼Œä»¥å­—ç¬¦ä¸² on å¼€å¤´çš„éƒ½è§†ä½œäº‹ä»¶</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vnode = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;p&quot;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">onClick</span>: <span class="function">() =&gt;</span> &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">children</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="ç»‘å®šäº‹ä»¶å’Œæ›´æ–°"><a href="#ç»‘å®šäº‹ä»¶å’Œæ›´æ–°" class="headerlink" title="ç»‘å®šäº‹ä»¶å’Œæ›´æ–°"></a>ç»‘å®šäº‹ä»¶å’Œæ›´æ–°</h3><p>äº‹ä»¶ç»‘å®šå’Œæ›´æ–°æˆ‘ä»¬å°±éœ€è¦åœ¨ patchProps å‡½æ•°ä¸­åšç›¸å…³çš„å¤„ç†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** å°†å±æ€§è®¾ç½®ç›¸å…³çš„æ“ä½œå°è£…åˆ°patchPropsçš„å‡½æ•°ä¸­ï¼Œå¹¶ä½œä¸ºæ¸²æŸ“å™¨é€‰é¡¹ä¼ é€’ */</span></span><br><span class="line"> <span class="title function_">patchProps</span>(<span class="params">el, key, preValue, nextValue</span>) &#123;</span><br><span class="line">   <span class="comment">// åŒ¹é…äº‹ä»¶ï¼Œä»¥onå¼€å¤´</span></span><br><span class="line">   <span class="keyword">if</span> (<span class="regexp">/^on/</span>.<span class="title function_">test</span>(key)) &#123; <span class="comment">// â•</span></span><br><span class="line">     <span class="comment">// æ ¹æ®å±æ€§åç§°å¾—åˆ°å¯¹åº”çš„äº‹ä»¶åç§°</span></span><br><span class="line">     <span class="keyword">const</span> name = key.<span class="title function_">slice</span>(<span class="number">2</span>).<span class="title function_">toLowerCase</span>(); <span class="comment">// â•</span></span><br><span class="line">     <span class="comment">// ç§»é™¤ä¸Šä¸€æ¬¡ç»‘å®šçš„äº‹ä»¶å¤„ç†å‡½æ•°</span></span><br><span class="line">     prevValue &amp;&amp; el.<span class="title function_">removeEventListener</span>(name, prevValue); <span class="comment">// â•</span></span><br><span class="line">     <span class="comment">// ç»‘å®šäº‹ä»¶, nextvalueä¸ºäº‹ä»¶å‡½æ•°</span></span><br><span class="line">     el.<span class="title function_">addEventListener</span>(name, nextValue); <span class="comment">// â•</span></span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">&quot;class&quot;</span>) &#123;</span><br><span class="line">     <span class="comment">// ...</span></span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">shouldSetAsProps</span>(el, key, nextValue)) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="comment">// ...</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>æŒ‰å¦‚ä¸Šçš„é€»è¾‘ï¼Œå°±æ˜¯ç›¸å½“äºæ¯æ¬¡æ›´æ–°éƒ½è¦å»ç§»é™¤ä¹‹å‰ç»‘å®šçš„å‡½æ•°ï¼Œç„¶åå†å¯¹æ–°çš„å€¼é‡æ–°è¿›è¡Œç›‘å¬ã€‚ä½†æ˜¯è¿™ä¹ˆåšæ€§èƒ½å¹¶ä¸æ˜¯æœ€ä¼˜çš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç»‘å®šä¸€ä¸ªä¼ªé€ çš„äº‹ä»¶å¤„ç†å‡½æ•° invokerï¼Œç„¶åæŠŠçœŸæ­£çš„äº‹ä»¶å¤„ç†å‡½æ•°è®¾ç½®ä¸º invoker.valueï¼Œåç»­æ›´æ–°å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ–° invoker.value å€¼å°±å¯ä»¥</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** å°†å±æ€§è®¾ç½®ç›¸å…³çš„æ“ä½œå°è£…åˆ°patchPropsçš„å‡½æ•°ä¸­ï¼Œå¹¶ä½œä¸ºæ¸²æŸ“å™¨é€‰é¡¹ä¼ é€’ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">patchProps</span>(<span class="params">el, key, prevValue, nextValue</span>) &#123;</span><br><span class="line">  <span class="comment">// åŒ¹é…äº‹ä»¶ï¼Œä»¥onå¼€å¤´</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/^on/</span>.<span class="title function_">test</span>(key)) &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰el.veiä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå­˜åœ¨äº‹ä»¶åç§°åˆ°äº‹ä»¶å¤„ç†å‡½æ•°çš„æ˜ å°„</span></span><br><span class="line">    <span class="keyword">const</span> invokers = el.<span class="property">_vei</span> || (el.<span class="property">_vei</span> = &#123;&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–è¯¥å…ƒç´ ä¼ªé€ çš„äº‹ä»¶å¤„ç†å‡½æ•°, æ ¹æ®key</span></span><br><span class="line">    <span class="keyword">let</span> invoker = invokers[key];</span><br><span class="line">    <span class="comment">// æ ¹æ®å±æ€§åç§°å¾—åˆ°å¯¹åº”çš„äº‹ä»¶åç§°</span></span><br><span class="line">    <span class="keyword">const</span> name = key.<span class="title function_">slice</span>(<span class="number">2</span>).<span class="title function_">toLowerCase</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nextValue) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!invoker) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰invokerï¼Œä¸ºé¦–æ¬¡ç›‘å¬ï¼Œåˆ™å»ä¼ªé€ ä¸€ä¸ªç¼“å­˜åˆ°el.veiä¸­</span></span><br><span class="line">        invoker = el.<span class="property">_vei</span>[key] = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// å¦‚æœinvokeræ˜¯æ•°ç»„çš„æƒ…å†µï¼Œéœ€è¦éå†æ‰§è¡Œ</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(invoker.<span class="property">value</span>)) &#123;</span><br><span class="line">            invoker.<span class="property">value</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">fn</span>) =&gt;</span> <span class="title function_">fn</span>(e));</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// è¿™é‡Œæ‰æ˜¯å¤„ç†çœŸæ­£çš„äº‹ä»¶å‡½æ•°</span></span><br><span class="line">            invoker.<span class="title function_">value</span>(e);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// èµ‹å€¼äº‹ä»¶å¤„ç†å‡½æ•°åˆ°invokerçš„valueä¸Š</span></span><br><span class="line">        invoker.<span class="property">value</span> = nextValue;</span><br><span class="line">        <span class="comment">// ç»‘å®šinvoker</span></span><br><span class="line">        el.<span class="title function_">addEventListener</span>(name, invoker);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å­˜åœ¨invokerè¯´æ˜æ˜¯æ›´æ–°ï¼Œåªéœ€è¦æ›´æ–°invoker.valueå€¼å°±è¡Œ</span></span><br><span class="line">        invoker.<span class="property">value</span> = nextValue;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (invoker) &#123;</span><br><span class="line">      <span class="comment">// æ–°çš„äº‹ä»¶å‡½æ•°ä¸å­˜åœ¨ï¼Œéœ€è¦é”€æ¯invoker</span></span><br><span class="line">      el.<span class="title function_">removeEventListener</span>(name, invoker);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">&quot;class&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">shouldSetAsProps</span>(el, key, nextValue)) &#123;</span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>invokersï¼šå­˜äº‹ä»¶åç§°ä¸å¯¹åº”å‡½æ•°çš„æ˜ å°„</p>
</li>
<li><p>el._veiï¼švue event invokerï¼Œåœ¨ el ä¸Šç¼“å­˜ invoker</p>
</li>
</ul>
<h2 id="æ›´æ–°å±æ€§ä»¥åŠå­èŠ‚ç‚¹"><a href="#æ›´æ–°å±æ€§ä»¥åŠå­èŠ‚ç‚¹" class="headerlink" title="æ›´æ–°å±æ€§ä»¥åŠå­èŠ‚ç‚¹"></a>æ›´æ–°å±æ€§ä»¥åŠå­èŠ‚ç‚¹</h2><blockquote>
<p>æ›´æ–°å¿…å®šæ¶‰åŠåˆ°æ•´ä¸ª vnode ä¸Šé¢çš„å±æ€§çš„å˜åŒ–ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹çš„å±æ€§ä»¥åŠèŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„å˜åŒ–</p>
</blockquote>
<p>å…ƒç´ çš„æŒ‚è½½æ˜¯ç”± mountElement è§¦å‘çš„</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æŒ‚è½½å‡½æ•°è°ƒç”¨ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mountElement</span>(<span class="params">vnode, container</span>) &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºdomå…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> el = <span class="title function_">createElement</span>(vnode.<span class="property">type</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(el);</span><br><span class="line">  vnode.<span class="property">el</span> = el; <span class="comment">// å°†å…¶åˆ›å»ºå‡ºæ¥çš„domæ·»åŠ åˆ°vnodeä¸Šï¼Œå»ºç«‹è”ç³»</span></span><br><span class="line">  <span class="comment">//å¤„ç†å­èŠ‚ç‚¹, å¦‚æœå­èŠ‚ç‚¹æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨å…ƒç´ å…·æœ‰æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.<span class="property">children</span> === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// åªéœ€è¦è®¾ç½®å…ƒç´ çš„textContentçš„å±æ€§å³å¯</span></span><br><span class="line">    <span class="title function_">setElementText</span>(el, vnode.<span class="property">children</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(vnode.<span class="property">children</span>)) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœchildrenæ˜¯æ•°ç»„ï¼Œåˆ™ä¾¿éå†æ¯ä¸€ä¸ªå­—èŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨patchçš„æ–¹æ³•</span></span><br><span class="line">    vnode.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">patch</span>(<span class="literal">null</span>, child, el);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†props, å­˜åœ¨çš„æƒ…å†µä¸‹è¿›è¡Œå¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">props</span>) &#123;</span><br><span class="line">    <span class="comment">// éå†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> vnode.<span class="property">props</span>) &#123;</span><br><span class="line">      <span class="title function_">patchProps</span>(el, key, <span class="literal">null</span>, vnode.<span class="property">props</span>[key]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">  <span class="title function_">insert</span>(el, container);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æŒ‚è½½å­èŠ‚ç‚¹çš„æ—¶å€™ï¼Œé¦–å…ˆæœ‰ä¸¤ç§çš„ç±»å‹çš„åŒºåˆ†</p>
<ul>
<li><p>å­—ç¬¦ä¸²ï¼šå…·æœ‰æ–‡æœ¬çš„å­èŠ‚ç‚¹</p>
</li>
<li><p>æ•°ç»„ï¼šå¤šä¸ªå­èŠ‚ç‚¹</p>
</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼Œå­èŠ‚ç‚¹åˆ†ä¸º 3 ç§ç±»å‹ï¼š</p>
<ol>
<li><p>æ²¡æœ‰å­èŠ‚ç‚¹çš„æƒ…å†µ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vnode = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;div&quot;</span>,</span><br><span class="line">  <span class="attr">children</span>: <span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å­—ç¬¦ä¸²çš„æƒ…å†µ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vnode = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;div&quot;</span>,</span><br><span class="line">  <span class="attr">children</span>: <span class="string">&quot;222&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ•°ç»„çš„æƒ…å†µ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vnode = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;div&quot;</span>,</span><br><span class="line">  <span class="attr">children</span>: [<span class="string">&quot;111&quot;</span>, &#123; <span class="attr">type</span>: <span class="string">&quot;p&quot;</span> &#125;],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>å¯¹åº”åˆ°æ›´æ–°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯¹åº”çš„æ–°æ—§èŠ‚ç‚¹éƒ½åˆ†åˆ«æ˜¯ 3 ç§æƒ…å†µ</p>
<img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="file:///Users/leo/Library/Application%20Support/marktext/images/2022-12-09-22-45-02-image.png" title alt width="592">

<p>æ¥ä¸‹æ¥æˆ‘ä»¬å»å®ç° <strong>patchElement</strong>å‡½æ•°</p>
<ul>
<li><p>n1: æ—§ vnode</p>
</li>
<li><p>n2: æ–° vnode</p>
</li>
</ul>
<p><strong>å®ç°æ­¥éª¤</strong></p>
<ol>
<li><p>é¦–å…ˆæˆ‘ä»¬å»æ›´æ–°ä»–ä»¬çš„ <strong>props</strong> çš„å˜åŒ–ï¼Œè°ƒç”¨ä¹‹å‰å°è£…å¥½çš„ <strong>patchProps</strong> å‡½æ•°åšæ›´æ–°å˜åŒ–</p>
</li>
<li><p>ä¹‹åå»æ›´æ–°ä»–ä»¬çš„ <strong>children</strong>ï¼Œè¿™é‡Œè¦å¯¹ä»¥ä¸Š <strong>9</strong> ç§çš„æƒ…å†µè¿›è¡Œè¦†ç›–ã€‚</p>
</li>
</ol>
<h3 id="å®ç°-props-å˜åŒ–æ›´æ–°"><a href="#å®ç°-props-å˜åŒ–æ›´æ–°" class="headerlink" title="å®ç° props å˜åŒ–æ›´æ–°"></a>å®ç° props å˜åŒ–æ›´æ–°</h3><p><strong>å®ç° props çš„æ›´æ–°</strong></p>
<ol>
<li><p>ä»æ–°çš„ props å‚æ•°ä¸­æ‰¾å‡ºæ—§çš„ props ä¸­ä¸ä¹‹å¯¹åº”çš„ key valueï¼Œè°ƒç”¨ pacthProps æ–¹æ³•å¯¹ dom å…ƒç´ è¿›è¡Œå¯¹æ¯”æ›´æ–°</p>
</li>
<li><p>ä»æ—§çš„ props ä¸­æ‰¾å‡ºä¸å­˜åœ¨æ–° props ä¸­çš„å±æ€§ï¼Œè°ƒç”¨ pacthProps çš„æ–¹æ³•è¿›è¡Œ dom å±æ€§çš„å¸è½½</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æ›´æ–°å­èŠ‚ç‚¹ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">pacthElement</span>(<span class="params">n1, n2</span>) &#123;</span><br><span class="line">  n2.<span class="property">el</span> = n1.<span class="property">el</span>;</span><br><span class="line">  <span class="keyword">const</span> el = n2.<span class="property">el</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">props</span>: oldProps &#125; = n1;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">props</span>: newProps &#125; = n2;</span><br><span class="line">  <span class="comment">// step 1 æ›´æ–°props</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> newProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (newProps[key] !== oldProps[key]) &#123;</span><br><span class="line">      <span class="title function_">patchProps</span>(el, key, oldProps[key], newProps[key]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> oldProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(key <span class="keyword">in</span> newProps)) &#123;</span><br><span class="line">      <span class="title function_">patchProps</span>(el, key, oldProps[key], <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// step 2ï¼šæ›´æ–°children</span></span><br><span class="line">  <span class="title function_">pacthChildren</span>(n1, n2, el);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é¡ºæ‰‹æ”¹é€ -patchProps-å‡½æ•°"><a href="#é¡ºæ‰‹æ”¹é€ -patchProps-å‡½æ•°" class="headerlink" title="é¡ºæ‰‹æ”¹é€  patchProps å‡½æ•°"></a>é¡ºæ‰‹æ”¹é€  patchProps å‡½æ•°</h4><p>æˆ‘ä»¬ä¾æ® patchProps çš„å„ä¸ªåˆ†æ”¯ï¼Œå»ç›¸å¯¹åº”å°è£…æˆ‘ä»¬çš„æ›´æ–°æ–¹æ³•</p>
<p>æœ€ç»ˆçš„æ”¹é€ å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¯”å¯¹propsåšæ›´æ–°</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">patchProp</span> = (<span class="params">el, key, prevValue, nextValue</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (key === <span class="string">&quot;class&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// classçš„å¤„ç†</span></span><br><span class="line">    <span class="title function_">patchClass</span>(el, nextValue);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">&quot;style&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// styleçš„å¤„ç†</span></span><br><span class="line">    <span class="title function_">patchStyle</span>(el, prevValue, nextValue);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/^on[^a-z]/</span>.<span class="title function_">test</span>(key)) &#123;</span><br><span class="line">    <span class="comment">// äº‹ä»¶çš„å¤„ç†</span></span><br><span class="line">    <span class="title function_">patchEvent</span>(el, key, nextValue);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å…¶ä»–å±æ€§çš„å¤„ç†</span></span><br><span class="line">    <span class="title function_">patchAttr</span>(el, key, nextValue);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="æ“ä½œ-class-æ›´æ–°"><a href="#æ“ä½œ-class-æ›´æ–°" class="headerlink" title="æ“ä½œ class æ›´æ–°"></a>æ“ä½œ class æ›´æ–°</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æ¯”å¯¹classå±æ€§ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">patchClass</span>(<span class="params">el, value</span>) &#123;</span><br><span class="line">  <span class="comment">// æ ¹æ®æœ€æ–°å€¼è®¾ç½®ç±»å</span></span><br><span class="line">  <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">    el.<span class="title function_">removeAttribute</span>(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    el.<span class="property">className</span> = value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æ“ä½œæ ·å¼çš„æ›´æ–°"><a href="#æ“ä½œæ ·å¼çš„æ›´æ–°" class="headerlink" title="æ“ä½œæ ·å¼çš„æ›´æ–°"></a>æ“ä½œæ ·å¼çš„æ›´æ–°</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æ¯”å¯¹classå±æ€§ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">patchStyle</span>(<span class="params">el, prev, next</span>) &#123;</span><br><span class="line">  <span class="comment">// æ›´æ–°style</span></span><br><span class="line">  <span class="keyword">const</span> style = el.<span class="property">style</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> next) &#123;</span><br><span class="line">    <span class="comment">// ç”¨æœ€æ–°çš„ç›´æ¥è¦†ç›–</span></span><br><span class="line">    style[key] = next[key];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (prev) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> prev) &#123;</span><br><span class="line">      <span class="comment">// è€çš„æœ‰æ–°çš„æ²¡æœ‰åˆ é™¤</span></span><br><span class="line">      <span class="keyword">if</span> (next[key] == <span class="literal">null</span>) &#123;</span><br><span class="line">        style[key] = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æ“ä½œäº‹ä»¶çš„æ›´æ–°"><a href="#æ“ä½œäº‹ä»¶çš„æ›´æ–°" class="headerlink" title="æ“ä½œäº‹ä»¶çš„æ›´æ–°"></a>æ“ä½œäº‹ä»¶çš„æ›´æ–°</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** åˆ›å»ºä¸€ä¸ªinvoker */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createInvoker</span>(<span class="params">initialValue</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">invoker</span> = (<span class="params">e</span>) =&gt; invoker.<span class="title function_">value</span>(e);</span><br><span class="line">  invoker.<span class="property">value</span> = initialValue;</span><br><span class="line">  <span class="keyword">return</span> invoker;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** æ¯”å¯¹äº‹ä»¶æ›´æ–° */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">patchEvent</span>(<span class="params">el, rawName, nextValue</span>) &#123;</span><br><span class="line">  <span class="comment">// æ›´æ–°äº‹ä»¶</span></span><br><span class="line">  <span class="keyword">const</span> invokers = el.<span class="property">_vei</span> || (el.<span class="property">_vei</span> = &#123;&#125;);</span><br><span class="line">  <span class="keyword">const</span> exisitingInvoker = invokers[rawName]; <span class="comment">// æ˜¯å¦ç¼“å­˜è¿‡</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (nextValue &amp;&amp; exisitingInvoker) &#123;</span><br><span class="line">    exisitingInvoker.<span class="property">value</span> = nextValue;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> name = rawName.<span class="title function_">slice</span>(<span class="number">2</span>).<span class="title function_">toLowerCase</span>(); <span class="comment">// è½¬åŒ–äº‹ä»¶æ˜¯å°å†™çš„</span></span><br><span class="line">    <span class="keyword">if</span> (nextValue) &#123;</span><br><span class="line">      <span class="comment">// ç¼“å­˜å‡½æ•°</span></span><br><span class="line">      <span class="keyword">const</span> invoker = (invokers[rawName] = <span class="title function_">createInvoker</span>(nextValue));</span><br><span class="line">      el.<span class="title function_">addEventListener</span>(name, invoker);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (exisitingInvoker) &#123;</span><br><span class="line">      el.<span class="title function_">removeEventListener</span>(name, exisitingInvoker);</span><br><span class="line">      invokers[rawName] = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="æ“ä½œå±æ€§çš„æ›´æ–°"><a href="#æ“ä½œå±æ€§çš„æ›´æ–°" class="headerlink" title="æ“ä½œå±æ€§çš„æ›´æ–°"></a>æ“ä½œå±æ€§çš„æ›´æ–°</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æ¯”å¯¹dom propertiesæˆ–è€…æ˜¯html attributes */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">patchAttr</span>(<span class="params">el, key, value</span>) &#123;</span><br><span class="line">    <span class="comment">// æ›´æ–°å±æ€§</span></span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœå€¼ä¸å­˜åœ¨ï¼Œè¯´æ˜æ˜¯å¸è½½propsçš„æ“ä½œ</span></span><br><span class="line">      el.<span class="title function_">removeAttribute</span>(key);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">shouldSetAsProps</span>(el, key, nextValue)) &#123;</span><br><span class="line">        <span class="comment">// dom propertieså­˜åœ¨çš„æƒ…å†µ</span></span><br><span class="line">        <span class="comment">// è·å–è¿™ä¸ªDOM propertieså…ƒç´ çš„å±æ€§ç±»å‹</span></span><br><span class="line">        <span class="keyword">const</span> type = <span class="keyword">typeof</span> el[key];</span><br><span class="line">        <span class="comment">// å¦‚æœåŸç”Ÿå±æ€§ç±»å‹ä¸ºå¸ƒå°”ç±»å‹ï¼Œå¹¶ä¸”valueæ˜¯ç©ºçš„å­—ç¬¦ä¸²çš„è¯ï¼Œç»™ä»–å€¼çŸ«æ­£ä¸ºtrue</span></span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">&quot;boolean&quot;</span> &amp;&amp; nextValue === <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">          el[key] = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          el[key] = nextValue;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        el.<span class="title function_">setAttribute</span>(key, value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ›´æ–°-children-èŠ‚ç‚¹"><a href="#æ›´æ–°-children-èŠ‚ç‚¹" class="headerlink" title="æ›´æ–° children èŠ‚ç‚¹"></a>æ›´æ–° children èŠ‚ç‚¹</h3><p>å¯¹ç…§ä»¥ä¸Š 3*3 çš„èŠ‚ç‚¹æƒ…å†µ</p>
<h4 id="1-æ–°å­èŠ‚ç‚¹æ˜¯æ–‡æœ¬èŠ‚ç‚¹"><a href="#1-æ–°å­èŠ‚ç‚¹æ˜¯æ–‡æœ¬èŠ‚ç‚¹" class="headerlink" title="1. æ–°å­èŠ‚ç‚¹æ˜¯æ–‡æœ¬èŠ‚ç‚¹"></a>1. æ–°å­èŠ‚ç‚¹æ˜¯æ–‡æœ¬èŠ‚ç‚¹</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æ›´æ–°children */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">pacthChildren</span>(<span class="params">n1, n2, container</span>) &#123;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ–°å­èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦æ˜¯æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> n2.<span class="property">children</span> === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// å½“æ–°èŠ‚ç‚¹ä¸ºæ–‡æœ¬èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¦‚æœæ—§èŠ‚ç‚¹æ˜¯ä¸€ç»„å­çš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦é€ä¸ªå»å¸è½½ï¼Œå…¶ä»–æƒ…å†µå•¥ä¹Ÿä¸åš</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(n1.<span class="property">children</span>)) &#123;</span><br><span class="line">      n1.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> <span class="title function_">unmount</span>(node));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æœ€åè®¾ç½®æ–°çš„èŠ‚ç‚¹å†…å®¹</span></span><br><span class="line">    <span class="title function_">setElementText</span>(container, n2.<span class="property">children</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-æ–°å­èŠ‚ç‚¹æ˜¯ä¸€ç»„"><a href="#2-æ–°å­èŠ‚ç‚¹æ˜¯ä¸€ç»„" class="headerlink" title="2. æ–°å­èŠ‚ç‚¹æ˜¯ä¸€ç»„"></a>2. æ–°å­èŠ‚ç‚¹æ˜¯ä¸€ç»„</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æ›´æ–°children */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">pacthChildren</span>(<span class="params">n1, n2, container</span>) &#123;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ–°å­èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦æ˜¯æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> n2.<span class="property">children</span> === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(n2.<span class="property">children</span>)) &#123;</span><br><span class="line">    <span class="comment">// å½“æ–°çš„å­èŠ‚ç‚¹æ˜¯ä¸€ç»„</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬åˆ¤æ–­æ—§çš„å­èŠ‚ç‚¹æ˜¯å¦ä¹Ÿæ˜¯ä¸€ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(n1.<span class="property">children</span>)) &#123;</span><br><span class="line">      <span class="comment">// diffç®—æ³• todo</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// åˆ°è¿™é‡Œï¼Œå­˜åœ¨ä¸¤ç§æƒ…å†µï¼Œè¦ä¹ˆæ˜¯æ–‡æœ¬èŠ‚ç‚¹è¦ä¹ˆæ— </span></span><br><span class="line">      <span class="comment">// ä»€ä¹ˆæƒ…å†µä¸‹éƒ½å»æ¸…ç©ºï¼Œç„¶åå°†ä¸€ç»„æ–°çš„å­èŠ‚ç‚¹æ·»åŠ è¿›æ¥</span></span><br><span class="line">      <span class="title function_">setElementText</span>(container, <span class="string">&quot;&quot;</span>);</span><br><span class="line">      n2.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> <span class="title function_">patch</span>(<span class="literal">null</span>, node, container));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>diff ç®—æ³•ï¼Œç›®å‰å…ˆç”¨å‚»ç“œé€»è¾‘å®ç°ï¼Œå…¨éƒ¨å¸è½½ç„¶åå†å…¨éƒ¨æŒ‚è½½</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">n1.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> <span class="title function_">unmount</span>(node));</span><br><span class="line">n2.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> <span class="title function_">patch</span>(<span class="literal">null</span>, node, container));</span><br></pre></td></tr></table></figure>

<h4 id="3-æ–°å­èŠ‚ç‚¹å•¥ä¹Ÿæ²¡æœ‰"><a href="#3-æ–°å­èŠ‚ç‚¹å•¥ä¹Ÿæ²¡æœ‰" class="headerlink" title="3. æ–°å­èŠ‚ç‚¹å•¥ä¹Ÿæ²¡æœ‰"></a>3. æ–°å­èŠ‚ç‚¹å•¥ä¹Ÿæ²¡æœ‰</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æ›´æ–°children */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">pacthChildren</span>(<span class="params">n1, n2, container</span>) &#123;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ–°å­èŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦æ˜¯æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> n2.<span class="property">children</span> === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// å½“æ–°èŠ‚ç‚¹ä¸ºæ–‡æœ¬èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¦‚æœæ—§èŠ‚ç‚¹æ˜¯ä¸€ç»„å­çš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦é€ä¸ªå»å¸è½½ï¼Œå…¶ä»–æƒ…å†µå•¥ä¹Ÿä¸åš</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(n1.<span class="property">children</span>)) &#123;</span><br><span class="line">      n1.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> <span class="title function_">unmount</span>(node));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æœ€åè®¾ç½®æ–°çš„èŠ‚ç‚¹å†…å®¹</span></span><br><span class="line">    <span class="title function_">setElementText</span>(container, n2.<span class="property">children</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(n2.<span class="property">children</span>)) &#123;</span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ°è¿™é‡Œï¼Œè¯´æ˜æ–°çš„å­èŠ‚ç‚¹ä¸å­˜åœ¨</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ—§çš„èŠ‚ç‚¹æ˜¯ä¸€ç»„å­èŠ‚ç‚¹ï¼Œåªéœ€è¦é€ä¸ªå¸è½½å°±å¯ä»¥</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(n1.<span class="property">children</span>)) &#123;</span><br><span class="line">      n1.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> <span class="title function_">unmount</span>(node));</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> n1.<span class="property">children</span> === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// æ—§èŠ‚ç‚¹æ˜¯æ–‡æœ¬ï¼Œæ¸…ç©º</span></span><br><span class="line">      <span class="title function_">setElementText</span>(container, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…¶ä»–æƒ…å†µä¸ç”¨ç®¡</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç‰¹æ®ŠèŠ‚ç‚¹ç±»å‹"><a href="#ç‰¹æ®ŠèŠ‚ç‚¹ç±»å‹" class="headerlink" title="ç‰¹æ®ŠèŠ‚ç‚¹ç±»å‹"></a>ç‰¹æ®ŠèŠ‚ç‚¹ç±»å‹</h2><p>ä¸€èˆ¬æˆ‘ä»¬ç”¨ vnode æè¿°èŠ‚ç‚¹ï¼Œéƒ½æ˜¯ç”¨ type å»æè¿°èŠ‚ç‚¹ç±»å‹</p>
<p>ä½†æ˜¯ åƒ æ–‡æœ¬èŠ‚ç‚¹ æ³¨é‡ŠèŠ‚ç‚¹ ä»¥åŠ vue3 çš„ fragmentï¼Œéƒ½è¾ƒä¸ºç‰¹æ®Š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Fragment</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æ³¨é‡ŠèŠ‚ç‚¹ --&gt;</span></span><br><span class="line">  æ–‡æœ¬èŠ‚ç‚¹</span><br><span class="line"><span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ–‡æœ¬èŠ‚ç‚¹å’Œæ³¨é‡ŠèŠ‚ç‚¹å¤„ç†"><a href="#æ–‡æœ¬èŠ‚ç‚¹å’Œæ³¨é‡ŠèŠ‚ç‚¹å¤„ç†" class="headerlink" title="æ–‡æœ¬èŠ‚ç‚¹å’Œæ³¨é‡ŠèŠ‚ç‚¹å¤„ç†"></a>æ–‡æœ¬èŠ‚ç‚¹å’Œæ³¨é‡ŠèŠ‚ç‚¹å¤„ç†</h3><p>è¿™ä¸¤è€…å¯¹äºæ™®é€šæ ‡ç­¾èŠ‚ç‚¹æ¥è¯´ï¼Œä¸å…·å¤‡æ ‡ç­¾åç§°ï¼Œæ‰€ä»¥éœ€è¦æ¡†æ¶è®¤ä¸ºçš„å»åˆ›é€ ä¸€äº›å”¯ä¸€çš„æ ‡è¯†ï¼Œå¹¶ä¸”å°†å…¶ä½œä¸ºæ³¨é‡ŠèŠ‚ç‚¹å’Œæ–‡æœ¬èŠ‚ç‚¹çš„ type</p>
<p>æè¿°æ–‡æœ¬å’Œæ³¨é‡ŠèŠ‚ç‚¹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ å…¥äººä¸ºçš„æ–‡æœ¬èŠ‚ç‚¹æ ‡è¯†</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Text</span> = <span class="title class_">Symbol</span>();</span><br><span class="line"><span class="keyword">const</span> newVnode = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="title class_">Text</span>,</span><br><span class="line">  <span class="attr">children</span>: <span class="string">&quot;æ–‡æœ¬èŠ‚ç‚¹&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// åŠ å…¥äººä¸ºçš„æ³¨é‡ŠèŠ‚ç‚¹æ ‡è¯†</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Comment</span> = <span class="title class_">Symbol</span>();</span><br><span class="line"><span class="keyword">const</span> newVnode = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="title class_">Comment</span>,</span><br><span class="line">  <span class="attr">children</span>: <span class="string">&quot;æ³¨é‡Šçš„èŠ‚ç‚¹&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åŠ å…¥ä¸¤è€…ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨ patch ä¸­å»åšç›¸å…³çš„æ”¹é€ </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æ›´æ–°å¯¹æ¯”, å¹¶ä¸”åšæŒ‚è½½ç›¸å…³çš„åŠŸèƒ½ */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">n1, n2, container</span>) &#123;</span><br><span class="line">    <span class="comment">// n1è€èŠ‚ç‚¹å­˜åœ¨ï¼Œå¯¹æ¯”n1å’Œn2çš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (n1 &amp;&amp; n1.<span class="property">type</span> !== n2.<span class="property">type</span>) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæ–°æ—§vnodeçš„ç±»å‹ä¸åŒï¼Œåˆ™ç›´æ¥å°†æ—§çš„vnodeå¸è½½</span></span><br><span class="line">      <span class="title function_">unmount</span>(n1);</span><br><span class="line">      n1 = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; type &#125; = n2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> type === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// ....</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> type === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// ç»„ä»¶</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="title class_">Text</span>) &#123;</span><br><span class="line">      <span class="comment">// æ–‡æœ¬æ ‡ç­¾</span></span><br><span class="line">      <span class="keyword">if</span> (!n1) &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨åŸç”ŸcreateTextNodeå»åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">const</span> el = (n2.<span class="property">el</span> = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(n2.<span class="property">children</span>));</span><br><span class="line">        <span class="comment">// å°†æ–‡æœ¬èŠ‚ç‚¹æ’å…¥åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">        <span class="title function_">insert</span>(el, container);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ—§çš„vnodeå­˜åœ¨ï¼Œåªéœ€è¦ä½¿ç”¨å¿ƒå¾—æ–‡æœ¬èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹æ›´æ–°æ—§æ–‡æœ¬èŠ‚ç‚¹å°±å¯ä»¥äº†</span></span><br><span class="line">        <span class="keyword">const</span> el = (n2.<span class="property">el</span> = n1.<span class="property">el</span>);</span><br><span class="line">        <span class="keyword">if</span> (n2.<span class="property">children</span> !== n1.<span class="property">children</span>) &#123;</span><br><span class="line">          el.<span class="property">nodeValue</span> = n2.<span class="property">children</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ä¸Šè¿°ç”¨åˆ°äº†ç›¸å…³æµè§ˆå™¨çš„ api æˆ‘ä»¬éœ€è¦ç»™ä»–æå–å‡ºæ¥<code>document.createTextNode</code>ä»¥åŠ<code>el.nodeValue</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æµè§ˆå™¨ç«¯çš„ç›¸å…³api */</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">BROWSER_APIS</span> = &#123;</span><br><span class="line">  <span class="comment">// ç”¨äºåˆ›å»ºå…ƒç´ </span></span><br><span class="line">  <span class="title function_">createElement</span>(<span class="params">tag</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** ç”¨äºè®¾ç½®å…ƒç´ çš„æ–‡æœ¬èŠ‚ç‚¹ */</span></span><br><span class="line">  <span class="title function_">setElementText</span>(<span class="params">el, text</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** ç»™ç‰¹å®šçš„parentä¸‹æ·»åŠ æŒ‡å®šçš„å…ƒç´  */</span></span><br><span class="line">  <span class="title function_">insert</span>(<span class="params">el, parent, anchor = <span class="literal">null</span></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹ */</span></span><br><span class="line">  <span class="title function_">createText</span>(<span class="params">text</span>) &#123;</span><br><span class="line">    <span class="comment">// â•</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(text);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** è®¾ç½®æ–‡æœ¬å€¼ */</span></span><br><span class="line">  <span class="title function_">setText</span>(<span class="params">el, text</span>) &#123;</span><br><span class="line">    <span class="comment">// â•</span></span><br><span class="line">    el.<span class="property">nodeValue</span> = text;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** å°†å±æ€§è®¾ç½®ç›¸å…³çš„æ“ä½œå°è£…åˆ°patchPropsçš„å‡½æ•°ä¸­ï¼Œå¹¶ä½œä¸ºæ¸²æŸ“å™¨é€‰é¡¹ä¼ é€’ */</span></span><br><span class="line">  <span class="title function_">patchProps</span>(<span class="params">el, key, prevValue, nextValue</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å¤„ç†æ³¨é‡Šçš„èŠ‚ç‚¹å’Œå…¶ç±»ä¼¼ï¼Œè°ƒç”¨åŸç”Ÿçš„ <code>document.createComment</code>å‡½æ•°æ¥åˆ›å»ºå³å¯</p>
<h3 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h3><p>Fragment å’Œ tex ä»¥åŠæ³¨é‡Šç±»ä¼¼ï¼Œtype ä¹Ÿéœ€è¦äººä¸ºåŠ å…¥æ ‡è¯†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Fragment</span> = <span class="title class_">Symbol</span>();</span><br></pre></td></tr></table></figure>

<p>åœ¨é¡¹ç›®ä¸­ç»å¸¸ä¼šæœ‰ç±»ä¼¼è¿™æ ·çš„ vNodeï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vNode = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;ul&quot;</span>,</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Fragment</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;li&quot;</span>,</span><br><span class="line">          <span class="attr">children</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;li&quot;</span>,</span><br><span class="line">          <span class="attr">children</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç”±äº Fragment æœ¬èº«æ˜¯ä¸å±äºä¸€ä¸ªçœŸæ­£çš„èŠ‚ç‚¹çš„ï¼Œæ‰€ä»¥åœ¨åšæ¸²æŸ“çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦æ¸²æŸ“å®ƒçš„å­èŠ‚ç‚¹å°±å¯ä»¥äº†</p>
<p>å› æ­¤æˆ‘ä»¬æ”¹é€  patch å‡½æ•°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æ›´æ–°å¯¹æ¯”, å¹¶ä¸”åšæŒ‚è½½ç›¸å…³çš„åŠŸèƒ½ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">n1, n2, container</span>) &#123;</span><br><span class="line">  <span class="comment">// n1è€èŠ‚ç‚¹å­˜åœ¨ï¼Œå¯¹æ¯”n1å’Œn2çš„ç±»å‹</span></span><br><span class="line">  <span class="keyword">if</span> (n1 &amp;&amp; n1.<span class="property">type</span> !== n2.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ–°æ—§vnodeçš„ç±»å‹ä¸åŒï¼Œåˆ™ç›´æ¥å°†æ—§çš„vnodeå¸è½½</span></span><br><span class="line">    <span class="title function_">unmount</span>(n1);</span><br><span class="line">    n1 = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; type &#125; = n2;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> type === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> type === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// ç»„ä»¶</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="title class_">Text</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="title class_">Fragment</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯ ç‰‡æ®µèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (!n1) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœä¸å­˜åœ¨æ—§èŠ‚ç‚¹çš„è¯ï¼Œåªéœ€è¦å°†Fragmentçš„childrené€ä¸ªæŒ‚è½½å°±å¯ä»¥</span></span><br><span class="line">      n2.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> <span class="title function_">patch</span>(<span class="literal">null</span>, node, container));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæ—§çš„vnodeå­˜åœ¨çš„è¯ï¼Œ åˆ™åªéœ€è¦æ›´æ–°fragmentçš„childrenå°±å¯ä»¥</span></span><br><span class="line">      <span class="title function_">pacthChildren</span>(n1, n2, container);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¹¶ä¸”å¯¹äºæˆ‘ä»¬åœ¨å¸è½½çš„æ—¶å€™ï¼Œä¹Ÿè¦åšç›¸å…³çš„å¤„ç†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** å¸è½½æ“ä½œ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">unmount</span>(<span class="params">vnode</span>) &#123;</span><br><span class="line">  <span class="comment">// åœ¨å¸è½½çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯å¸è½½çš„vnodeç±»å‹ä¸ºFragmentï¼Œ åˆ™éœ€è¦å¸è½½ä»–çš„children</span></span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">type</span> === <span class="title class_">Fragment</span>) &#123;</span><br><span class="line">    vnode.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> <span class="title function_">unmount</span>(node));</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ ¹æ®vnodeè·å–è¦å¸è½½çš„çœŸå®domå…ƒç´ </span></span><br><span class="line">  <span class="comment">// è·å–elçš„çˆ¶çº§å…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> parent = vnode.<span class="property">el</span>.<span class="property">parentNode</span>;</span><br><span class="line">  <span class="keyword">if</span> (parent) &#123;</span><br><span class="line">    parent.<span class="title function_">removeChild</span>(vnode.<span class="property">el</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åé¢å†è¯´ diff</p>
</blockquote>
<h2 id="diff-ç®—æ³•"><a href="#diff-ç®—æ³•" class="headerlink" title="diff ç®—æ³•"></a>diff ç®—æ³•</h2><p>// todoâ€¦.</p>
<h3 id="ç®€å•çš„-diff-ç®—æ³•"><a href="#ç®€å•çš„-diff-ç®—æ³•" class="headerlink" title="ç®€å•çš„ diff ç®—æ³•"></a>ç®€å•çš„ diff ç®—æ³•</h3><h3 id="åŒç«¯-diff-ç®—æ³•"><a href="#åŒç«¯-diff-ç®—æ³•" class="headerlink" title="åŒç«¯ diff ç®—æ³•"></a>åŒç«¯ diff ç®—æ³•</h3><h3 id="å¿«é€Ÿ-diff-ç®—æ³•"><a href="#å¿«é€Ÿ-diff-ç®—æ³•" class="headerlink" title="å¿«é€Ÿ diff ç®—æ³•"></a>å¿«é€Ÿ diff ç®—æ³•</h3>

<div class="article-footer reveal fs14"><section id="license"><div class="header"><span>è®¸å¯åè®®</span></div><div class="body"><p>æœ¬æ–‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</div></section></div>

</article>

<div class="related-wrap reveal" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">è¾ƒæ–°æ–‡ç« </div><a href="/2023/01/28/diff%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E5%92%8C%E6%80%BB%E7%BB%93/">diffç®—æ³•åŸç†å’Œæ€»ç»“</a></div><div class="item" id="next"><div class="note">è¾ƒæ—©æ–‡ç« </div><a href="/2022/11/09/%E5%8F%8C%E5%87%BB%E4%BA%8B%E4%BB%B6%E5%92%8C%E5%8D%95%E6%9C%BA%E4%BA%8B%E4%BB%B6%E5%86%B2%E7%AA%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">åŒå‡»äº‹ä»¶å’Œå•æœºäº‹ä»¶å†²çªè§£å†³æ–¹æ¡ˆ</a></div></section></div>








      
<footer class="page-footer reveal fs12"><hr><div class="text"><p>æœ¬ç«™ç”± <a href="/">@anonymity</a> ä½¿ç”¨ <a href="https://github.com/xaoxuu/hexo-theme-stellar">Stellar</a> ä¸»é¢˜åˆ›å»ºã€‚<br>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</div></footer>

      <div class='float-panel mobile-only blur' style='display:none'>
  <button type='button' class='sidebar-toggle mobile' onclick='sidebar.toggle()'>
    <svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path></svg>
  </button>
</div>

    </div>
  </div>
  <div class='scripts'>
    <script type="text/javascript">
  const stellar = {
    // æ‡’åŠ è½½ css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // ä» butterfly å’Œ volantis è·å¾—çµæ„Ÿ
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // é»˜è®¤å¼‚æ­¥ï¼Œå¦‚æœéœ€è¦åŒæ­¥ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ {} å³å¯
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.version = '1.18.5';
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.18.5';
  stellar.config = {
    date_suffix: {
      just: 'åˆšåˆš',
      min: 'åˆ†é’Ÿå‰',
      hour: 'å°æ—¶å‰',
      day: 'å¤©å‰',
      month: 'ä¸ªæœˆå‰',
    },
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://gcore.jsdelivr.net/npm/jquery@3.6.2/dist/jquery.min.js'
  };

  if ('local_search') {
    stellar.search = {};
    stellar.search.service = 'local_search';
    if (stellar.search.service == 'local_search') {
      let service_obj = Object.assign({}, {"field":"all","path":"/search.json","content":true,"sort":"-date"});
      stellar.search[stellar.search.service] = service_obj;
    }
  }

  // stellar js
  stellar.plugins.stellar = Object.assign({"sites":"/js/plugins/sites.js","friends":"/js/plugins/friends.js","ghinfo":"/js/plugins/ghinfo.js","timeline":"/js/plugins/timeline.js","linkcard":"/js/plugins/linkcard.js","fcircle":"/js/plugins/fcircle.js","weibo":"/js/plugins/weibo.js"});

  stellar.plugins.marked = Object.assign("https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js");
  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/vanilla-lazyload@17.8.3/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.css","js":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.js"});
  }
  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://gcore.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://gcore.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.fancybox = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js","css":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css","selector":".swiper-slide img"});
  }
  if ('false' == 'true') {
    stellar.plugins.heti = Object.assign({"enable":false,"css":"https://unpkg.com/heti@0.9.2/umd/heti.min.css","js":"https://unpkg.com/heti@0.9.2/umd/heti-addon.min.js"});
  }
</script>

<!-- required -->

  
<script src="/js/main.js" async></script>



<!-- optional -->



<!-- inject -->


  </div>
</body>
</html>
